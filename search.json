[{"title":"æœåŠ¡å™¨ç›´ä¼ æ–‡ä»¶åˆ°slack","path":"/2026/01/29/533/","content":"æœ€è¿‘ä¸€æ®µæ—¶é—´ç»å¸¸æœ‰ä¸€äº›æ•°æ®å¯¼å‡ºç›¸å…³çš„å·¥ä½œï¼Œéœ€è¦ä»æœåŠ¡å™¨å¯¼å‡º CSV / Excel ç­‰æ–‡ä»¶ç»™ Sales åŒå­¦æŸ¥çœ‹ï¼Œè€Œ Sales çš„æ—¥å¸¸æ²Ÿé€šåŸºæœ¬éƒ½åœ¨ Slack ä¸Šå®Œæˆã€‚ å¦‚æœé‡‡ç”¨ä¼ ç»Ÿæ–¹å¼ï¼š æœåŠ¡å™¨ â†’ ä¸‹è½½åˆ°æœ¬åœ° â†’ å†ä¸Šä¼ åˆ° Slack é—®é¢˜éå¸¸æ˜æ˜¾ï¼š æ–‡ä»¶ç¨å¾®ä¸€å¤§ï¼Œä¸‹è½½ + ä¸Šä¼ éå¸¸æ…¢ ä¸‹åˆ 4 ç‚¹ä¹‹åç½‘é€Ÿæ˜æ˜¾ä¸‹é™ï¼ˆå¯èƒ½æ”¾å¯’å‡äº† ğŸ¤·ï¼‰ ä¸¥é‡ä¾èµ–æœ¬åœ°ç½‘ç»œï¼Œæ•ˆç‡ä¸å¯æ§ æ“ä½œæ­¥éª¤å¤šï¼Œä¸åˆ©äºé‡å¤æ‰§è¡Œ å› æ­¤å°±äº§ç”Ÿäº†ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼š èƒ½ä¸èƒ½è®©æœåŠ¡å™¨ç›´æ¥æŠŠæ–‡ä»¶ä¼ åˆ° Slackï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šå®Œå…¨å¯ä»¥ã€‚ ä¸€ã€æ•´ä½“æ€è·¯æ ¸å¿ƒæ€è·¯å¾ˆç®€å•ï¼š æ–‡ä»¶æœ¬èº«å°±åœ¨æœåŠ¡å™¨ä¸Š Slack æä¾›äº†å®˜æ–¹ API ç”¨äºæ–‡ä»¶ä¸Šä¼  åœ¨æœåŠ¡å™¨ä¸Šé€šè¿‡è„šæœ¬ï¼Œç›´æ¥è°ƒç”¨ Slack API ä¸Šä¼ æ–‡ä»¶ è¿™æ ·å¯ä»¥åšåˆ°ï¼š æ–‡ä»¶ ä¸ç»è¿‡æœ¬åœ° å®Œå…¨ä¾èµ–æœåŠ¡å™¨ç½‘ç»œ é€‚åˆå¤§æ–‡ä»¶ã€æ‰¹é‡å¯¼å‡º å¯è„šæœ¬åŒ–ã€å¯è‡ªåŠ¨åŒ– æœ€ç»ˆæ•°æ®æµå˜ä¸ºï¼š æœåŠ¡å™¨ â†’ Slack äºŒã€åˆ›å»º Slack Appé¦–å…ˆéœ€è¦ä¸€ä¸ª Slack Appï¼Œç”¨äºè·å–ä¸Šä¼ æ–‡ä»¶æ‰€éœ€çš„ Tokenã€‚ 1. æ–°å»º Appè®¿é—®ï¼š https://api.slack.com/apps ç‚¹å‡» Create New Appï¼Œé€‰æ‹©ä½ çš„ Workspaceã€‚ 2. é…ç½® OAuth &amp; Permissionsåœ¨ OAuth &amp; Permissions ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å¸¸ç”¨æƒé™ï¼ˆæ ¹æ®å®é™…éœ€è¦è°ƒæ•´ï¼‰ï¼š files:write chat:write channels:readï¼ˆå¦‚æœéœ€è¦ï¼‰ é…ç½®å®Œæˆåï¼Œå®‰è£… App åˆ° Workspaceï¼Œå³å¯æ‹¿åˆ°ï¼š Bot User OAuth Token æ ¼å¼ä¸€èˆ¬ä¸ºï¼šxoxb-xxxx ä¸‰ã€æœåŠ¡å™¨ä¸Šä¼ è„šæœ¬ä¸‹é¢æ˜¯ä¸€ä¸ª å¯ç›´æ¥åœ¨æœåŠ¡å™¨è¿è¡Œçš„ Python è„šæœ¬ï¼Œç”¨äºï¼š ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®š Slack Channel æ”¯æŒ Threadï¼ˆå¯ä¼ æ¶ˆæ¯é“¾æ¥ï¼‰ æ”¯æŒ @ æŒ‡å®šç”¨æˆ· ä¸Šä¼ å®Œæˆåè¾“å‡ºæ–‡ä»¶é“¾æ¥ 1. è„šæœ¬ä»£ç #!/usr/bin/env python3# -*- coding: utf-8 -*-# file_uploader.pyimport osimport sysimport timeimport refrom slack_sdk import WebClientimport configSLACK_TOKEN = config.slack_tokenDEFAULT_MENTION = &quot;xxxx&quot;# ---------------- utils ----------------def log(msg: str): &quot;&quot;&quot;Print timestamped logs to stdout.&quot;&quot;&quot; ts = time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;) print(f&quot;[&#123;ts&#125;] &#123;msg&#125;&quot;, flush=True)def parse_thread_ts(thread_link: str) -&gt; str: &quot;&quot;&quot; Convert a Slack message link to thread_ts. Example: https://workspace.slack.com/archives/xxxx/p1731398999934122 Returns: 1731398999.934122 &quot;&quot;&quot; match = re.search(r&#x27;/p(\\d&#123;16&#125;)&#x27;, thread_link) if not match: raise ValueError(f&quot;Invalid Slack message link: &#123;thread_link&#125;&quot;) ts_raw = match.group(1) return f&quot;&#123;ts_raw[:-6]&#125;.&#123;ts_raw[-6:]&#125;&quot;# ---------------- main ----------------def main(): if len(sys.argv) &lt; 3: print(&quot;Usage: python file_uploader.py &lt;channel_id&gt; &lt;file_path&gt; [thread_link_or_ts] [user_ids...]&quot;) sys.exit(1) channel_id = sys.argv[1] file_path = sys.argv[2] thread_input = sys.argv[3] if len(sys.argv) &gt; 3 else None user_ids = sys.argv[4:] if len(sys.argv) &gt; 4 else [DEFAULT_MENTION] if not os.path.isfile(file_path): raise RuntimeError(&quot;File not found&quot;) filename = os.path.basename(file_path) file_size = os.path.getsize(file_path) thread_ts = None if thread_input: if thread_input.startswith(&quot;http&quot;): thread_ts = parse_thread_ts(thread_input) else: thread_ts = thread_input log(f&quot;Preparing to upload: &#123;filename&#125;&quot;) log(f&quot;File size: &#123;file_size / 1024 / 1024:.2f&#125; MB&quot;) client = WebClient(token=SLACK_TOKEN) mentions = &quot; &quot;.join(f&quot;&lt;@&#123;uid&#125;&gt;&quot; for uid in user_ids) with open(file_path, &quot;rb&quot;) as f: kwargs = &#123; &quot;file&quot;: f, &quot;title&quot;: filename, &quot;channel&quot;: channel_id, &quot;initial_comment&quot;: ( f&quot;âœ… New file uploaded: *&#123;filename&#125;* &quot; f&quot;(&#123;file_size / 1024 / 1024:.2f&#125; MB) &#123;mentions&#125;&quot; ), &#125; if thread_ts: kwargs[&quot;thread_ts&quot;] = thread_ts response = client.files_upload_v2(**kwargs) file_info = response[&quot;file&quot;] log(&quot;âœ… Upload completed successfully&quot;) log(f&quot;ğŸ“ File link: &#123;file_info.get(&#x27;permalink&#x27;)&#125;&quot;)if __name__ == &quot;__main__&quot;: main() å››ã€è¿è¡Œæ–¹å¼åŸºæœ¬ç”¨æ³• python3 file_uploader.py &lt;channel_id&gt; &lt;file_path&gt; ä¸Šä¼ åˆ°æŒ‡å®š Threadï¼ˆæ¨èï¼‰ python3 file_uploader.py \\ channel_id \\ /data/sai.csv \\ https://contactout.slack.com/archives/xxx/p1769005211787589 è„šæœ¬ä¼šè‡ªåŠ¨è§£æ Slack æ¶ˆæ¯é“¾æ¥ï¼Œè½¬æ¢ä¸º thread_tsã€‚ äº”ã€æ•ˆæœè¯´æ˜æ–‡ä»¶ç›´æ¥ä»æœåŠ¡å™¨ä¸Šä¼ åˆ° Slackï¼Œä¸ä¾èµ–æœ¬åœ°ç½‘ç»œï¼Œä¸Šä¼ å®Œæˆåï¼ŒSales å¯ç«‹å³åœ¨ Slackä¸­ä¸‹è½½ã€‚","tags":["Linux"],"categories":["Linux"]},{"title":"ä½¿ç”¨æœ¬åœ° SSH Key å®ç°æœåŠ¡å™¨ä¹‹é—´ç›´æ¥ä¼ è¾“æ–‡ä»¶","path":"/2026/01/24/532/","content":"åœ¨æœåŠ¡å™¨è¿ç»´å’Œæ•°æ®å¤„ç†ä¸­ï¼Œç»å¸¸éœ€è¦åœ¨æœåŠ¡å™¨ A å’ŒæœåŠ¡å™¨ B ä¹‹é—´ä¼ è¾“æ–‡ä»¶ï¼Œä½†æœ¬èº« Aä¸ B åˆä¸æ˜¯å’Œç›´æ¥äº’é€šã€‚ å¦‚æœé‡‡ç”¨â€œæœåŠ¡å™¨ â†’ æœ¬åœ° â†’ æœåŠ¡å™¨â€çš„æ–¹å¼ï¼Œé€Ÿåº¦æ…¢ã€æ­¥éª¤å¤šï¼Œæ•ˆç‡å¾ˆä½ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä¸´æ—¶ä½¿ç”¨æœ¬åœ° key å»ä¼ è¾“ã€‚ ä¸€ã€å‰ææ¡ä»¶ æœ¬åœ°å·²ç»å­˜åœ¨å¯ç”¨çš„ SSH ç§é’¥ï¼ˆä¾‹å¦‚ ~/.ssh/id_rsaï¼‰ æœ¬åœ°å¯ä»¥é€šè¿‡è¯¥ key ç™»å½•æœåŠ¡å™¨ A,B æœåŠ¡å™¨ A å¯ä»¥è®¿é—®æœåŠ¡å™¨ Bï¼ˆç½‘ç»œå¯è¾¾ï¼‰ äºŒã€æ ¸å¿ƒæ€è·¯ ä½¿ç”¨ scp -i æ˜¾å¼æŒ‡å®šæœ¬åœ° SSH Keyï¼Œåœ¨å‘½ä»¤ä¸­å®ŒæˆæœåŠ¡å™¨ä¹‹é—´çš„æ–‡ä»¶ç›´ä¼ ã€‚ æ–‡ä»¶ä¼ è¾“è·¯å¾„ä¸ºï¼š Server A â†’ Server B ä¸ç»è¿‡æœ¬åœ°ä¸‹è½½ä¸ä¸Šä¼ ã€‚ ä¸‰ã€å®æ“æ­¥éª¤scp ~/.ssh/id_rsa user@serverA:~/.ssh/id_rsa_localssh user@serverAscp -i ~/.ssh/id_rsa_local fileA user@serverB:/data/ æ‰§è¡Œåï¼Œæ–‡ä»¶ä¼š ç›´æ¥ä»æœåŠ¡å™¨ A ä¼ è¾“åˆ°æœåŠ¡å™¨ Bã€‚ å››ã€scp å¸¸ç”¨å‚æ•°è¯´æ˜ï¼ˆé‡ç‚¹ï¼‰ä¸‹é¢æ˜¯å¸¸è§ä¸”å®ç”¨çš„ scp å‚æ•°è¯´æ˜ï¼š å‚æ•° è¯´æ˜ ç¤ºä¾‹ -i &lt;identity_file&gt; æŒ‡å®š SSH ç§é’¥æ–‡ä»¶ scp -i ~/.ssh/id_rsa ... -r é€’å½’å¤åˆ¶ç›®å½•ï¼ˆå¤åˆ¶æ–‡ä»¶å¤¹å¿…åŠ ï¼‰ scp -i ~/.ssh/id_rsa -r /data/dir ... -P æŒ‡å®š SSH ç«¯å£ï¼ˆå¤§å†™ Pï¼‰ scp -i ~/.ssh/id_rsa -P 2222 ... -C å¯ç”¨å‹ç¼©ï¼ˆé€‚åˆæ–‡æœ¬ç±»æˆ–ç½‘ç»œè¾ƒæ…¢åœºæ™¯ï¼‰ scp -i ~/.ssh/id_rsa -C ... -v æ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼ˆæ’æŸ¥è¿æ¥é—®é¢˜æ—¶ä½¿ç”¨ï¼‰ scp -i ~/.ssh/id_rsa -v ... äº”ã€å®‰å…¨æ€§è¯´æ˜ âœ… æ˜ç¡®æŒ‡å®š -iï¼Œé¿å…è¯¯ç”¨å…¶ä»– key âŒ ä¸å»ºè®®æœåŠ¡å™¨ä¹‹é—´é•¿æœŸå…±äº«ç§é’¥ï¼Œå»ºè®®ä½¿ç”¨ååˆ é™¤","tags":["Linux"],"categories":["Linux"]},{"title":"è¾¾è¾¾ä¸€å‘¨å²è®°","path":"/2025/10/12/528/","content":"äº²çˆ±çš„å¥³å„¿ï¼Œæ˜¯ç™½å¤©ç© high äº†å—ï¼Ÿåç‚¹ç¡ä¸‹ï¼Œä¸€ä¸ªå¤šå°æ—¶ï¼Œå·²ç»é†’äº† 2 æ¬¡äº†ã€‚ æ—¶é—´è¿‡å¾—å¥½å¿«ï¼Œä½ ä»Šå¤©éƒ½ä¸€å‘¨å²äº†ã€‚å¦ˆå¦ˆæœ€è¿‘å¸¸è·Ÿæˆ‘æ„Ÿå¹ï¼šæ—¶é—´è¿‡å¾—å¥½å¿«ï¼Œä¸€æ™ƒéƒ½è¿™ä¹ˆé•¿çš„å°äººå„¿äº†ã€‚ å»å¹´çš„è¿™ä¸ªæ—¶å€™ï¼Œä½ åˆšåˆšçœ‹è§è¿™ä¸ªä¸–ç•Œã€‚é‚£å¤©å‡ºç”Ÿçš„å‰é¢å…¨éƒ½æ˜¯ç”·å­©ï¼Œæˆ‘å¿ƒæƒ³ï¼šä½ ä¸ä¼šä¹Ÿæ˜¯ä¸ªå°å­å§ã€‚å¯å½“ä½ è¢«æŠ¤å£«æ¨å‡ºæ¥çš„æ—¶å€™ï¼Œæˆ‘æ–­å®šä½ è‚¯å®šæ˜¯ä¸ªå¥³å¨ƒå¨ƒï¼Œå°å°ä¸€åªï¼Œé—­ç€çœ¼ç›ï¼Œå¥½å®‰é™ï¼Œå¥½ç²¾è‡´ã€‚æ™šä¸ŠæŠ¤å·¥å–‚å¥¶åå‡†å¤‡æŠŠä½ äº¤ç»™æˆ‘ï¼Œæˆ‘å‹æ ¹ä¸æ•¢æŠ±ï¼Œæˆ‘æ€•æŠŠä½ æŠ±åäº†ï¼Œæˆ‘è®©å¥¹æŠŠä½ ç›´æ¥æ”¾åœ¨æ‘‡ç¯®é‡Œã€‚ä½ åœ¨æ‘‡ç¯®é‡Œï¼Œå°å°ä¸€åªï¼Œæ‰‹ç»†ç»†çš„è„šç»†ç»†çš„ï¼Œå¥½å®‰é™ï¼Œæˆ‘ä¼šæ—¶ä¸æ—¶å»æ¢æ¢ä½ çš„é¼»æ¯ã€‚ä½é™¢é‚£å‡ å¤©ï¼Œä½ å’Œéš”å£åºŠçš„å°å¼Ÿå¼Ÿéƒ½å·²ç»åäººäº†ï¼Œå› ä¸ºä½ ä¿©å“­èµ·æ¥å¯å¤§å£°äº†ï¼Œç®€ç›´å°±æ˜¯äºŒé‡å”±ã€‚ ç¬¬ä¸€ä¸ªæœˆï¼Œåœ¨åŒ»é™¢ç¬¬äºŒæ™šå°±ç»å†äº†å‘›å¥¶ï¼Œçˆ¸çˆ¸å½“æ—¶åˆšå¥½å»å–å¥¶ï¼Œå¦ˆå¦ˆæ‰‹ä¸Šé’ˆç®¡æ²¡æ‹”å°±ç›´æ¥æŠŠä½ æŠ±èµ·æ¥ï¼Œä¸‡å¹¸éš”å£æŠ¤å·¥åŠæ—¶çœ‹åˆ°è¿…é€Ÿå¤„ç†ã€‚å‡ºé™¢åçˆ¸çˆ¸æ²¡æœ‰åŠæ—¶ç§Ÿé»„ç–¸ä»ªï¼Œä½ é»„ç–¸æ€¥é€Ÿå‡é«˜ï¼Œå»äº†ä¸¤æ¬¡åŒ»é™¢ï¼Œä¸€æ¬¡æ²¡åˆ°ä¸´ç•Œå€¼ï¼Œä¸€æ¬¡æ²¡åºŠä½ï¼Œæ‰€ä»¥æ²¡æœ‰ä½é™¢ã€‚åé¢å¥½åœ¨æœ‰æœˆå«‚çš„å¸®å¿™ï¼Œæ…¢æ…¢åœ°é»„ç–¸é™åˆ°æ­£å¸¸å€¼äº†ã€‚çˆ·çˆ·å¤–å…¬å¤–å©†å’Œå°å§¨ä¹Ÿä»è€å®¶è¿‡æ¥çœ‹ä½ äº†ï¼Œä½ ä¸€å¤©èƒ½ç¡å¥½ä¹…å¥½ä¹…ï¼Œå¤´å‘ç¨€ç¨€ç–ç–ï¼Œä¸­é—´ç”šè‡³æ²¡æœ‰ï¼Œåœ°ä¸­æµ·å‘å‹ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸ä¼¼ä¹è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œå¾ˆå¤šäº‹åšå¾—ä¸å‘¨åˆ°ã€‚ ç¬¬äºŒä¸ªæœˆï¼Œå› ä¸ºå¼€äº†åœ°æš–ï¼Œä½ é•¿äº†å¥½å¤šçƒ­ç–¹ï¼Œæœˆå«‚çš„è¯è†ä¸ç®¡ç”¨ï¼Œå¥½åœ¨å¦ˆå¦ˆæœæ–­ç»™ä½ ç”¨äº†ä¹‹å‰å›¤çš„æ¶¦è‚¤éœœï¼Œæ¸æ¸å°±å¥½äº†ã€‚ä½ ç»å¸¸è¶´ç€ç¡è§‰ï¼Œæ‰€ä»¥èƒ€æ°”è¿˜å¥½ã€‚æœˆå«‚ä¸‹æˆ·äº†ï¼Œå¥¶å¥¶å¼€å§‹å¸¦ä½ ç¡è§‰äº†ï¼Œå§‘å§‘å¸¦ç€å“¥å“¥å§å§æ¥çœ‹ä½ äº†ï¼Œä½ çš„ä½“é‡å·²ç»è¿‡10æ–¤äº†ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸å¥½åƒè¿˜æ²¡æœ‰ç»™ä½ æ¢è¿‡å°¿ä¸æ¹¿ï¼Œä½†ä¼šå„ç§æŠ±å§¿äº†ã€‚ ç¬¬ä¸‰ä¸ªæœˆï¼Œæˆ‘ä»¬åº¦è¿‡äº†å…ƒæ—¦ï¼Œå»æ‰“äº†åˆèƒç—…æ¯’æŠ—ä½“ã€‚æ‰“é’ˆçš„æŠ¤å£«é˜¿å§¨å«ä½ å°èƒ–å­äº†ï¼Œå›æ¥ä½ å°±åŒå¥¶äº†ã€‚ä½ æ¯å¤©éœ€è¦å¥¶å¥¶å“„ç¡ï¼Œæœ‰æ—¶å€™ç”šè‡³10ç‚¹å¤šæ‰ç¡ã€‚å¦ˆå¦ˆè¯´æˆ‘ä»¬åº”è¯¥è°ƒæ•´å“„ç¡éš¾åº¦ï¼Œåˆšå¼€å§‹ä¸¤å¤©ä½ å“­å¾—æ’•å¿ƒè£‚è‚ºï¼Œä½†ç»“æœä¸€å‘¨çš„è®­ç»ƒï¼Œä½ æ¸æ¸åœ°é€‚åº”äº†ï¼Œå¥¶å¥¶å¯ä»¥å‡ åˆ†é’ŸæŠŠä½ å“„ç¡äº†ã€‚ä½ çš„å¤´å‘é•¿é•¿äº†ï¼Œä¸å†æ˜¯åœ°ä¸­æµ·å‘å‹äº†ï¼Œä½ è¢«å«å°å¼Ÿå¼Ÿäº†ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸åœ¨å¥¶å¥¶çš„æŒ‡å¯¼ä¸‹ç»™ä½ å–‚å¥¶æ‹å—äº†ï¼Œæ¯æ¬¡æ‹å—ä½ å°å°çš„è‡‚å¼¯æŠ±ç€æˆ‘å¤§å¤§çš„å¤´ï¼Œçˆ¸çˆ¸å¥½å¹¸ç¦ã€‚ ç¬¬å››ä¸ªæœˆï¼Œæˆ‘ä»¬åº¦è¿‡äº†æ˜¥èŠ‚ï¼Œä½ åœ¨å®¶å¿™ç€ç»ƒä¹ æŠ¬å¤´ï¼Œæˆ‘ä»¬å¶å°”ä¼šå¸¦ä½ å»æ¥¼ä¸Šé˜³å°æ™’æ™’å¤ªé˜³ï¼Œä½ çš„çœ¼ç›åœ¨é˜³å…‰çš„åˆºæ¿€ä¸‹çä¸å¼€ã€‚ä½ 100å¤©äº†ï¼Œæˆ‘ä»¬ç®€å•åº†ç¥äº†ä¸€ä¸‹ã€‚ä½ æœ‰æ—¶å€™æ˜¯ä¸ªå°è¯ç—¨ï¼Œå¥¶å¥¶å–‚å¥¶åï¼Œä½ ä¼šè·Ÿå¥¶å¥¶å’¿å’¿å‘€å‘€è¯´ä¸ªä¸åœã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸å¦ˆå¦ˆä¹Ÿè¯•ç€å¸¦ä½ ç¡è§‰ã€‚ ç¬¬äº”ä¸ªæœˆï¼Œä¸‰æœˆä»½ä¹‹ååŸºæœ¬ä¸¤å‘¨è¦å»ç¬¬ä¸€æ¬¡ç–«è‹—ï¼Œä¸è¿‡ä½ åŸºæœ¬éƒ½å¾ˆä¹–ï¼Œå“­äº†ä¸¤åˆ†é’Ÿå°±å¥½äº†ã€‚æ‰“äº”è”çš„æ—¶å€™å‘çƒ­è¿‡ä¸€æ¬¡ï¼Œç‰©ç†é™æ¸©å°±é€€äº†ã€‚ä½ è¿˜ç»å†äº†çœŸæ­£çš„åŒå¥¶æœŸï¼Œå¥½åœ¨æŒç»­æ—¶é—´ä¸é•¿ã€‚æˆ‘ä»¬å¼€å§‹å¤–å‡ºäº†ï¼Œæ¯å¤©ä¸‹åˆä¼šåœ¨å¤–é¢ç¡ä¸€è§‰ã€‚ä½ ä¹Ÿå¼€å§‹å°è¯•å®‰å…¨åº§æ¤…ï¼Œä½ è¿˜ç®—é…åˆã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸å¸¦ä½ åè…°å‡³å»é›å¼¯äº†ã€‚ ç¬¬å…­ä¸ªæœˆï¼Œä½“æ£€çš„æ—¶å€™ä½ å·²ç»68å˜ç±³ï¼Œ8.3kgäº†ã€‚ä½ è·Ÿ4ä¸ªæœˆçš„å®å®åœ¨ä¸€èµ·ï¼Œçªç„¶å‘ç°ä½ å¥½å¤§åªäº†ã€‚å› ä¸ºå¤–å©†ç”Ÿç—…ï¼Œæˆ‘ä»¬ä¸´æ—¶å›å®¶äº†ä¸€æ¬¡ï¼Œä½ å·²ç»å¯ä»¥åœ¨å®‰å…¨åº§æ¤…ä¹–ä¹–åå‡ ä¸ªå°æ—¶äº†ã€‚ä½ ä¹Ÿèƒ½åå¾—å¾ˆç¨³äº†ï¼Œç¿»èº«ä¹Ÿæ¸æ¸ get äº†ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸ç»å¸¸å¸¦ä½ å¤–å‡ºäº†ï¼Œä¹Ÿå› ä¸ºä½ ï¼Œè·Ÿå°åŒºé‡Œå¾ˆå¤šå¥¶å¥¶ç†Ÿæ‚‰äº†ã€‚ ç¬¬ä¸ƒä¸ªæœˆï¼Œä½“æ£€æ—¶å·²ç»è¶…è¿‡8kgäº†ï¼Œå¤§è¿åŠ¨æœ‰ç‚¹è½åã€‚æˆ‘ä»¬åˆ†é…äº†ä»»åŠ¡ï¼Œçˆ¸çˆ¸è´Ÿè´£å¤§è¿åŠ¨ï¼Œå¦ˆå¦ˆè´Ÿè´£è¾…é£Ÿï¼Œå¥¶å¥¶è´Ÿè´£ç¡è§‰ï¼Œæˆ‘ä»¬ä»¨å°±å›´ç€ä½ è½¬å•Šã€‚å› ä¸ºå¤ªå¥¶å¥¶ç”Ÿæ—¥ï¼Œå¥¶å¥¶å›å»äº†å‡ å¤©ï¼Œçˆ¸çˆ¸è¯·å‡ä¸€å‘¨ç…§é¡¾ä½ ï¼Œä½†çˆ¸çˆ¸å–‚å¥¶ä½ ä¸å’‹å–ï¼Œç´§æ€¥å¬å›å¥¶å¥¶ã€‚å¥¶å¥¶å›æ¥ä¹‹åä½ åˆå¥½å¥½å–å¥¶äº†ã€‚åé¢åˆç»å†äº†ä¸€æ¬¡åŒå¥¶ï¼Œåªèƒ½å–‚ç³Šæ¶‚å¥¶å–‚äº†å¥½å¤šå¤©ã€‚å¦ˆå¦ˆå¼€å§‹ç»™ä½ åšä½ è¾…é£Ÿäº†ï¼Œä¸€å£å£åœ°ï¼Œä½ åƒå¾—å¾ˆä¸é”™ã€‚å¤§è¿åŠ¨ä¸Šé¢ï¼Œç¿»èº«å·²ç»ç›¸å½“ç†Ÿç»ƒäº†ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸å°è¯•äº†ä¸€ä¸‹ç‹¬ç«‹å¸¦ä½ ç¡è§‰ï¼ˆå¹¶ä¸å¯é ï¼‰ï¼Œè·Ÿä½ å‰ƒäº†åŒæ¬¾å°æ¿å¯¸ã€‚ ç¬¬å…«ä¸ªæœˆï¼Œä½ ä¾æ—§ä¸ä¼šçˆ¬ï¼Œæ²¡æœ‰å‡ºç‰™ï¼Œæˆ‘ä»¬æ¨è¿Ÿäº†ä¸¤å‘¨ä½“æ£€ã€‚çˆ¸çˆ¸ã€å¥¶å¥¶ã€å¦ˆå¦ˆè½®ç•ªæ‹–ç€è‚šå­ç»ƒä¹ äº†2å‘¨ï¼Œä½ æ…¢æ…¢å°±ä¼šæ‰‹è†çˆ¬äº†ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸å¸¦ä½ æŠ±ä½›è„šï¼Œç»ƒä¹ çˆ¬ã€‚ ç¬¬ä¹ä¸ªæœˆï¼Œä½ çˆ±åƒè¾…é£Ÿï¼Œçˆ±åƒç±³é¥­ï¼Œå¥¶å–å¾—ä¹Ÿå¥½ã€‚ä½“é‡æ¥åˆ°9.4kgï¼Œèº«é«˜74.3ï¼Œå¤§è¿åŠ¨éƒ½æ˜¯90å¤šåˆ†ï¼Œç›¸å½“æ£’ã€‚æ‰“å®Œéº»è…®é£ç–«è‹—åä¸€å‘¨ï¼Œå‘çƒ§äº†3å¤©ï¼Œåƒäº†ç¾æ—ä¹‹åæ¢å¤äº†ã€‚ä½ ä¸€ç‚¹éƒ½ä¸çˆ±åƒè¿™ç”œç”œçš„è¯ï¼Œå¹¸äºå¦ˆå¦ˆçœ‹åˆ°æ”»ç•¥ä¹°äº†æ³¨å°„å™¨ï¼Œä¸ç»è¿‡ä½ çš„èˆŒå¤´å‘³è•¾ç»™ä½ å–‚è¯ï¼Œä½ ä¹Ÿèƒ½åƒä¸‹å»äº†ï¼ˆå¦ˆå¦ˆä¸Šå¤§åˆ†ï¼‰ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸å¦ˆå¦ˆç»™ä½ æ­å»ºäº†æ”€çˆ¬æ¶ï¼Œä½ ç©äº†ä¸¤æ¬¡ï¼Œä¼¼ä¹å¹¶ä¸æ„Ÿå†’ï¼ˆä¸¤ä¸ªæœˆåä½ å¼€å§‹ç©èµ·æ”€çˆ¬æ¶äº†ï¼‰ã€‚çˆ¸çˆ¸å‚æ™šç»å¸¸å¸¦ä½ å‡ºé—¨äº†ï¼Œä½ è¶Šæ¥è¶Šé»‘äº†ã€‚ ç¬¬åä¸ªæœˆï¼Œå¦ˆå¦ˆæ”¾æš‘å‡ï¼Œæˆ‘ä»¬å›è€å®¶äº†ã€‚æœ¬æ¥è®¡åˆ’åŠå‘¨å²å®´åå¤šå¾…ä¸€é˜µã€‚å¯æ˜¯å¥¶å¥¶ä¸å¹¸å—ä¼¤ï¼Œç»™ä½ åšé¥­ä¹Ÿä¸æ–¹ä¾¿ï¼Œä½ åˆå¼€å§‹ä¾¿ç§˜æµé¼»æ¶•ï¼Œæ— å¥ˆæˆ‘ä»¬å°±æå‰å›æ¥äº†ï¼Œçˆ·çˆ·åœ¨å®¶ç…§é¡¾å¥¶å¥¶ã€‚ è¿™ä¸ªæœˆï¼Œå°‘äº†å¥¶å¥¶çš„ç…§é¡¾ï¼Œçˆ¸çˆ¸å¦ˆå¦ˆæ»¡è´Ÿè·å·¥ä½œï¼Œå°¤å…¶æ˜¯å¦ˆå¦ˆã€‚ä½ å…¨é æ¯ä¹³æ’‘ç€ï¼Œæˆäº†å¦ˆå¦ˆçš„äººå½¢æŒ‚ä»¶ã€‚æˆ‘ä»¬éƒ½æ²¡æƒ³åˆ°ï¼Œç¬¬åä¸ªæœˆä½ å®ç°äº†çº¯æ¯ä¹³å–‚å…»ã€‚ ç¬¬åä¸€ä¸ªæœˆï¼Œä½ å¯èƒ½ä¸ä¹ æƒ¯æ²¡æœ‰å¥¶å¥¶é™ªç¡å–‚å¥¶ï¼Œæ™šä¸Šåªèƒ½é å¦ˆå¦ˆå¥¶ç¡äº†ï¼Œä¸çˆ±å–å¥¶ç²‰äº†ã€‚å¥¶é‡ä»500æ‰åˆ°100ï¼Œç”šè‡³å‡ åã€‚çˆ¸çˆ¸å¦ˆå¦ˆå®åœ¨å¿™ä¸è¿‡æ¥ï¼Œè¯·äº†é˜¿å§¨ï¼Œä½ å¯¹é˜¿å§¨ä¸æ’æ–¥ï¼Œä½†ä¹Ÿæ²¡æœ‰å¤ªäº²è¿‘ã€‚æœ‰ä¸€å¤©é˜¿å§¨å‘ç°ä½ å‡ºç‰™äº†ï¼Œæ¯æ¬¡å“­å’Œç¬‘éƒ½èƒ½çœ‹åˆ°ï¼Œå°å°çš„ï¼Œå¥½å¯çˆ±ã€‚æœ‰ä¸€å¤©ä¸­åˆï¼Œçˆ¸çˆ¸å¸¦ä½ çš„æ—¶å€™è‡ªå·±ç¡ç€ï¼Œä½ æ‰¶ç€å›´æ ï¼Œä»åºŠä¸Šæ‘”äº†ä¸‹æ¥ã€‚ä¸‡å¹¸ä½ æ²¡äº‹ï¼Œä¹Ÿæ²¡æœ‰å¿ƒç†é˜´å½±ï¼Œå½“å¤©æ™šä¸Šåˆç»§ç»­åœ¨é‚£ç©ï¼Œå¯çˆ¸çˆ¸åˆ°ä»Šå¤©éƒ½ä¸æ•¢ç”¨é‚£ä¸ªå›´æ äº†ã€‚å› ä¸ºå–å¥¶ä¸å¥½ï¼Œç¡çœ ä¹Ÿä¸å¥½ã€‚æˆ‘ä»¬åˆå»ä½“æ£€äº†ä¸€æ¬¡ï¼Œä½ ä½“é‡å¢é•¿ä¸å¤Ÿå¥½ï¼Œåˆå¼€å§‹ä¾¿ç§˜äº†ã€‚åŒ»ç”Ÿå»ºè®®æ™šä¸Šç»™ä½ å°‘å–ï¼Œä¸è¦å¥¶ç¡ã€‚ è¿™ä¸ªæœˆï¼Œçˆ¸çˆ¸ç»™ä½ ç†å‘äº†ï¼Œä¹°äº†è‡ªè¡Œè½¦ï¼Œæœ‰æ—¶å€™ä¼šéª‘è½¦å¸¦ä½ é›å¼¯ï¼Œä½ ååœ¨åº§æ¤…ä¸Šï¼Œé…·é…·åœ°ï¼Œé¢æ— è¡¨æƒ…ã€‚ ç¬¬åäºŒæœˆï¼Œå–å¥¶ç²‰å°‘ï¼Œè¾…é£Ÿä¹Ÿä¸å¥½å¥½åƒäº†ã€‚ä½ è·Ÿé˜¿å§¨ç†Ÿç»œäº†ï¼Œé˜¿å§¨èƒ½å“„ç¡ä½ äº†ï¼Œå›½åº†å‰ï¼Œçˆ¸çˆ¸æ™šä¸Šä¹Ÿèƒ½æŠŠä½ å“„ç¡äº†ï¼Œå¦ˆå¦ˆå»ä¸Šç­æ›´å®‰å¿ƒäº†ã€‚å°è¯•æ™šä¸Šå°½é‡å°‘ç»™ä½ å–å¥¶ï¼Œä½ å–å¥¶ç¨ç¨å¥½äº†ä¸€ç‚¹ç‚¹ã€‚æœ€è¿‘å¦ˆå¦ˆç»™ä½ æ–°æ¢äº†å¥¶ç“¶ï¼ˆå¦ˆå¦ˆæœ‰ä¸€æ¬¡ä¸Šå¤§åˆ†ï¼‰ï¼Œä½ å–å¥¶å¥½åƒå¥½ä¸€ä¸¢ä¸¢ã€‚å¯èƒ½å› ä¸ºå‡ºç‰™ä¸é€‚ï¼Œè¾…é£Ÿåƒå¾—é‚£å«ä¸€ä¸ªå·®ã€‚å¦ˆå¦ˆå’Œé˜¿å§¨çœŸèƒ½å˜ç€èŠ±åšï¼Œæ„æ­»å¥¹ä¿©äº†ã€‚ è¿™ä¸ªæœˆï¼Œä½ å·²ç»èƒ½å¬æ‡‚å¥½å¤šè¯äº†ã€‚å¦ˆå¦ˆæ‹¿ç€å°æµ·é©¬ï¼Œå°å¤œç¯ï¼Œæ‰‹é“¾ï¼Œè®©ä½ ä¸€ä¸ªä¸ªæ‹¿åˆ°å¥¹æ‰‹ä¸Šï¼Œä½ å·²ç»èƒ½å‡†ç¡®æ— è¯¯åœ°åšåˆ°äº†ã€‚çˆ¸çˆ¸æ™šä¸Šå“„ä½ ç¡è§‰ï¼ŒæŒ‡äº†å‡ æ¬¡æœˆäº®ï¼Œç¬¬äºŒå¤©å†é—®ä½ ï¼Œä½ ä¹Ÿèƒ½æŒ‡ç»™çˆ¸çˆ¸çœ‹äº†ã€‚ ä¸€å¹´ï¼Œä½ ä½“é‡é•¿äº†ä¸¤å€å¤šï¼Œèº«é«˜é•¿äº†30å˜ç±³ï¼Œä½ å¸¦ç»™çˆ¸å¦ˆï¼Œå¸¦ç»™è¿™ä¸ªå¤§å®¶åº­å¤ªå¤šæ¬¢ä¹ã€‚ è¾¾è¾¾å‘€ï¼Œä½ æ…¢æ…¢é•¿å¤§å§ï¼çˆ¸çˆ¸å¦ˆå¦ˆå¸Œæœ›ä½ å¥å¥åº·åº·ï¼Œå¹³å¹³å®‰å®‰ï¼Œå¼€å¼€å¿ƒå¿ƒçš„ã€‚ è¾¾è¾¾ä¸€å‘¨å²è®°äºæ‰¬å·2025-10-12","tags":["è¾¾è¾¾"],"categories":["dada"]},{"title":"Laravelé™æµRedis throttle","path":"/2025/07/07/224/","content":"åœ¨ Laravel 11 ä¸­ï¼ŒRedis::throttle æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºå®ç°å¯¹ API æˆ–ç‰¹å®šæ“ä½œçš„é€Ÿç‡é™åˆ¶ã€‚é€šè¿‡ä½¿ç”¨ Redis ä½œä¸ºåç«¯å­˜å‚¨ï¼ŒRedis::throttle å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…å¯ä»¥æ‰§è¡Œçš„è¯·æ±‚æ¬¡æ•°ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Redis::throttleï¼Œå…¶ä¸»è¦æ–¹æ³•ã€æ³¨æ„äº‹é¡¹ï¼Œå¹¶ä¸ RateLimiter è¿›è¡Œå¯¹æ¯”ã€‚ 1. Redis::throttle çš„åŸºæœ¬ä½¿ç”¨Redis::throttle æ˜¯ Laravel æä¾›çš„ä¸€ä¸ªåŸºäº Redis çš„é€Ÿç‡é™åˆ¶å·¥å…·ã€‚å®ƒå…è®¸ä½ è½»æ¾åœ°é™åˆ¶æŸä¸ªæ“ä½œåœ¨ç‰¹å®šæ—¶é—´å†…çš„æ‰§è¡Œæ¬¡æ•°ã€‚ 1.1 åŸºæœ¬è¯­æ³•use Illuminate\\Support\\Facades\\Redis;Redis::throttle(&#x27;key&#x27;)-&gt;allow(10)-&gt;every(60)-&gt;then(function () &#123; // æ­£å¸¸æ‰§è¡Œæ“ä½œ&#125;, function () &#123; // è¶…è¿‡é€Ÿç‡é™åˆ¶æ—¶çš„å›è°ƒ&#125;); key: ç”¨äºæ ‡è¯†é€Ÿç‡é™åˆ¶çš„å”¯ä¸€é”®ã€‚ allow(10): åœ¨æŒ‡å®šçš„æ—¶é—´çª—å£å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°ã€‚ every(60): æ—¶é—´çª—å£çš„é•¿åº¦ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ then: å½“è¯·æ±‚æœªè¶…è¿‡é™åˆ¶æ—¶æ‰§è¡Œçš„å›è°ƒã€‚ ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°æ˜¯å¯é€‰çš„ï¼Œç”¨äºå¤„ç†è¶…è¿‡é™åˆ¶æ—¶çš„é€»è¾‘ã€‚ 1.2 ç¤ºä¾‹å‡è®¾ä½ å¸Œæœ›é™åˆ¶ç”¨æˆ·æ¯åˆ†é’Ÿåªèƒ½å‘é€ 5 æ¡æ¶ˆæ¯ï¼š use Illuminate\\Support\\Facades\\Redis;Redis::throttle(&#x27;send-message:&#x27; . $user-&gt;id)-&gt;allow(5)-&gt;every(60)-&gt;then(function () use ($user) &#123; // å‘é€æ¶ˆæ¯çš„é€»è¾‘ $this-&gt;sendMessage($user, $message);&#125;, function () &#123; // è¶…è¿‡é™åˆ¶æ—¶çš„å¤„ç† return response(&#x27;Too many attempts. Please try again later.&#x27;, 429);&#125;); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsend-message: åŠ ä¸Šç”¨æˆ· ID ä½œä¸ºé”®ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·çš„é€Ÿç‡é™åˆ¶æ˜¯ç‹¬ç«‹çš„ã€‚ 2. ä¸»è¦æ–¹æ³•2.1 allow(int $maxAttempts)è®¾ç½®åœ¨ä¸€å®šæ—¶é—´çª—å£å†…å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°ã€‚ 2.2 every(int $decaySeconds)è®¾ç½®æ—¶é—´çª—å£çš„é•¿åº¦ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ 2.3 then(callable $callback, callable $failureCallback = null) $callback: å½“è¯·æ±‚æœªè¶…è¿‡é™åˆ¶æ—¶æ‰§è¡Œçš„å›è°ƒã€‚ $failureCallback: å½“è¯·æ±‚è¶…è¿‡é™åˆ¶æ—¶æ‰§è¡Œçš„å›è°ƒï¼ˆå¯é€‰ï¼‰ã€‚ 2.4 block(int $timeout)è®¾ç½®å½“è¯·æ±‚è¶…è¿‡é™åˆ¶æ—¶ï¼Œé˜»å¡ç”¨æˆ·çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·æ— æ³•å†æ¬¡å‘èµ·è¯·æ±‚ã€‚ Redis::throttle(&#x27;key&#x27;)-&gt;allow(10)-&gt;every(60)-&gt;block(10)-&gt;then(function () &#123; // æ­£å¸¸æ‰§è¡Œæ“ä½œ&#125;, function () &#123; // è¶…è¿‡é€Ÿç‡é™åˆ¶æ—¶çš„å›è°ƒ&#125;); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœç”¨æˆ·è¶…è¿‡äº†é€Ÿç‡é™åˆ¶ï¼Œä»–ä»¬å°†è¢«é˜»å¡ 10 ç§’ã€‚ 3. æ³¨æ„äº‹é¡¹3.1 Redis è¿æ¥ç¡®ä¿ä½ çš„ Laravel åº”ç”¨å·²ç»æ­£ç¡®é…ç½®äº† Redis è¿æ¥ã€‚ä½ å¯ä»¥åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®REDIS_HOSTã€REDIS_PASSWORD ç­‰å‚æ•°ã€‚ 3.2 é”®çš„å”¯ä¸€æ€§Redis::throttle çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œé€šå¸¸ä½ ä¼šä½¿ç”¨ç”¨æˆ· IDã€IP åœ°å€æˆ–å…¶ä»–å”¯ä¸€æ ‡è¯†ç¬¦æ¥æ„é€ é”®ã€‚ 3.3 é˜»å¡æ—¶é—´ä½¿ç”¨ block æ–¹æ³•æ—¶ï¼Œç¡®ä¿è®¾ç½®çš„é˜»å¡æ—¶é—´åˆç†ï¼Œé¿å…ç”¨æˆ·é•¿æ—¶é—´æ— æ³•æ“ä½œã€‚ 3.4 åˆ†å¸ƒå¼ç¯å¢ƒåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼ŒRedis::throttle å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œå› ä¸º Redis æ˜¯ä¸€ä¸ªé›†ä¸­å¼çš„å­˜å‚¨ç³»ç»Ÿã€‚ç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨éƒ½è¿æ¥åˆ°åŒä¸€ä¸ª Redis å®ä¾‹ã€‚ 4. ä¸ RateLimiter çš„å¯¹æ¯”Laravel è¿˜æä¾›äº† RateLimiter å·¥å…·ï¼Œå®ƒä¸ Redis::throttle ç±»ä¼¼ï¼Œä½†æœ‰ä¸€äº›åŒºåˆ«ï¼š 4.1 é…ç½®æ–¹å¼RateLimiter é€šå¸¸åœ¨ app/Providers/RouteServiceProvider.php ä¸­é…ç½®ï¼Œè€ŒRedis::throttle å¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ã€‚ use Illuminate\\Cache\\RateLimiting\\Limit;use Illuminate\\Support\\Facades\\RateLimiter;RateLimiter::for(&#x27;api&#x27;, function ($request) &#123; return Limit::perMinute(60)-&gt;by($request-&gt;user()?-&gt;id ?: $request-&gt;ip());&#125;); 4.2 çµæ´»æ€§Redis::throttle æ›´åŠ çµæ´»ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œè€Œ RateLimiter é€šå¸¸ç”¨äºè·¯ç”±ä¸­é—´ä»¶ä¸­ã€‚ 4.3 ä½¿ç”¨åœºæ™¯ Redis::throttle æ›´é€‚åˆåœ¨ä»£ç ä¸­ç›´æ¥æ§åˆ¶é€Ÿç‡é™åˆ¶ï¼Œä¾‹å¦‚åœ¨æœåŠ¡ç±»æˆ–æ§åˆ¶å™¨ä¸­ã€‚ä¸€èˆ¬æ˜¯åˆ†é’Ÿçº§åˆ«ã€‚ RateLimiter æ›´é€‚åˆåœ¨å…¨å±€èŒƒå›´å†…å¯¹è·¯ç”±è¿›è¡Œé€Ÿç‡é™åˆ¶ã€‚ç§’çº§ã€‚ 4.4 æ€§èƒ½ä¸¤è€…éƒ½åŸºäº Redisï¼Œæ€§èƒ½å·®å¼‚ä¸å¤§ã€‚é€‰æ‹©ä½¿ç”¨å“ªä¸ªå·¥å…·ä¸»è¦å–å†³äºä½ çš„ä½¿ç”¨åœºæ™¯å’Œåå¥½ã€‚ 5. æ€»ç»“Redis::throttle æ˜¯ Laravel ä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„é€Ÿç‡é™åˆ¶å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆåœ¨ä»£ç ä¸­ç›´æ¥æ§åˆ¶æ“ä½œçš„æ‰§è¡Œé¢‘ç‡ã€‚é€šè¿‡åˆç†ä½¿ç”¨ allowã€every å’Œ block æ–¹æ³•ï¼Œä½ å¯ä»¥è½»æ¾å®ç°å¯¹ç”¨æˆ·è¯·æ±‚çš„é™åˆ¶ã€‚ä¸ RateLimiter ç›¸æ¯”ï¼ŒRedis::throttle æ›´åŠ çµæ´»ï¼Œé€‚åˆåœ¨ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œå¯ä»¥æœ‰æ•ˆæå‡åº”ç”¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚","tags":["Laravel","jwt"],"categories":["PHP"]},{"title":"å¦‚ä½•æŒ‚è½½ç£ç›˜","path":"/2025/04/29/527/","content":"æŸ¥çœ‹ç£ç›˜ä¿¡æ¯ ğŸ”é¦–å…ˆï¼Œä½¿ç”¨ lsblk å‘½ä»¤æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„ç£ç›˜ä¿¡æ¯ï¼š lsblk è¾“å‡ºç¤ºä¾‹ï¼š NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTsda 8:0 0 50G 0 disk â”œâ”€sda1 8:1 0 1G 0 part /bootâ””â”€sda2 8:2 0 49G 0 part â”œâ”€centos_host-root 253:0 0 45.1G 0 lvm / â””â”€centos_host-swap 253:1 0 3.9G 0 lvm [SWAP]sdb 8:16 0 300G 0 disk lsblk å‘½ä»¤è¯¦è§£ ğŸ“šlsblkï¼ˆlist block devicesï¼‰å‘½ä»¤ç”¨äºåˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰å—è®¾å¤‡ï¼Œå®ƒèƒ½å¤Ÿä»¥æ ‘çŠ¶ç»“æ„æ˜¾ç¤ºç£ç›˜åŠå…¶åˆ†åŒºä¿¡æ¯ã€‚ ä¸»è¦æ˜¾ç¤ºå†…å®¹åŒ…æ‹¬ï¼š NAME: è®¾å¤‡åç§° MAJ:MIN: ä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å· RM: æ˜¯å¦ä¸ºå¯ç§»åŠ¨è®¾å¤‡ï¼ˆ1è¡¨ç¤ºå¯ç§»åŠ¨ï¼Œ0è¡¨ç¤ºä¸å¯ç§»åŠ¨ï¼‰ SIZE: è®¾å¤‡å¤§å° RO: æ˜¯å¦ä¸ºåªè¯»è®¾å¤‡ï¼ˆ1è¡¨ç¤ºåªè¯»ï¼Œ0è¡¨ç¤ºå¯è¯»å†™ï¼‰ TYPE: è®¾å¤‡ç±»å‹ï¼ˆdiskè¡¨ç¤ºç£ç›˜ï¼Œpartè¡¨ç¤ºåˆ†åŒºï¼Œlvmè¡¨ç¤ºé€»è¾‘å·ç®¡ç†ï¼‰ MOUNTPOINT: æŒ‚è½½ç‚¹ä½ç½® å¸¸ç”¨é€‰é¡¹ï¼š lsblk -f: æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ lsblk -m: æ˜¾ç¤ºè®¾å¤‡çš„æƒé™ä¿¡æ¯ lsblk -d: ä»…æ˜¾ç¤ºç£ç›˜ï¼Œä¸æ˜¾ç¤ºåˆ†åŒº lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT: è‡ªå®šä¹‰æ˜¾ç¤ºç‰¹å®šåˆ— æŒ‚è½½æ­¥éª¤ ğŸ“ä»¥ä¸‹æ˜¯å°† sdb æŒ‚è½½åˆ° /data ç›®å½•çš„è¯¦ç»†æ­¥éª¤ï¼ˆé€‚ç”¨äº CentOS å’Œå…¶ä»–å¸¸è§ Linux å‘è¡Œç‰ˆï¼‰ï¼š 1. åˆ›å»ºæŒ‚è½½ç‚¹ ğŸ“mkdir -p /data 2. ç£ç›˜åˆ†åŒº ğŸ”§ä½¿ç”¨ fdisk å‘½ä»¤å¯¹ç£ç›˜è¿›è¡Œåˆ†åŒºï¼š fdisk /dev/sdb åœ¨äº¤äº’ç•Œé¢ä¸­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š n - åˆ›å»ºæ–°åˆ†åŒº p - é€‰æ‹©ä¸»åˆ†åŒº 1 - åˆ†åŒºå· æŒ‰å›è½¦ä½¿ç”¨é»˜è®¤å¼€å§‹/ç»“æŸä½ç½®ï¼ˆæˆ–æ ¹æ®éœ€æ±‚è®¾ç½®ï¼‰ w - å†™å…¥å¹¶é€€å‡º fdisk å‘½ä»¤è¯¦è§£ ğŸ”ªfdisk æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºå’Œç®¡ç†ç£ç›˜åˆ†åŒºè¡¨çš„å¼ºå¤§å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªäº¤äº’å¼ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·å¯¹ç£ç›˜è¿›è¡Œå„ç§åˆ†åŒºæ“ä½œã€‚ ä¸»è¦åŠŸèƒ½ï¼š åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹åˆ†åŒº æ›´æ”¹åˆ†åŒºç±»å‹ æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ åˆ›å»ºå’Œç®¡ç†å¤šç§åˆ†åŒºè¡¨ç±»å‹ï¼ˆMBRã€GPTç­‰ï¼‰ å¸¸ç”¨äº¤äº’å¼å‘½ä»¤ï¼š p: æ˜¾ç¤ºå½“å‰ç£ç›˜çš„åˆ†åŒºè¡¨ n: åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒº d: åˆ é™¤ä¸€ä¸ªåˆ†åŒº t: æ›´æ”¹åˆ†åŒºç±»å‹ l: åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„åˆ†åŒºç±»å‹ m: æ˜¾ç¤ºå¸®åŠ©èœå• w: å†™å…¥åˆ†åŒºè¡¨å¹¶é€€å‡º q: ä¸ä¿å­˜æ›´æ”¹å¹¶é€€å‡º åˆ†åŒºç±»å‹ï¼š ä¸»åˆ†åŒºï¼ˆPrimaryï¼‰ï¼šæœ€å¤šå¯åˆ›å»º4ä¸ª æ‰©å±•åˆ†åŒºï¼ˆExtendedï¼‰ï¼šä½œä¸ºé€»è¾‘åˆ†åŒºçš„å®¹å™¨ï¼Œæœ€å¤šåªèƒ½æœ‰1ä¸ª é€»è¾‘åˆ†åŒºï¼ˆLogicalï¼‰ï¼šåˆ›å»ºåœ¨æ‰©å±•åˆ†åŒºå†…ï¼Œä»ç¼–å·5å¼€å§‹ æ³¨æ„äº‹é¡¹ï¼š ä¿®æ”¹åˆ†åŒºè¡¨å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œæ“ä½œå‰åº”å¤‡ä»½é‡è¦æ•°æ® é‡æ–°åˆ†åŒºåï¼Œæ–°åˆ†åŒºè¡¨å¯èƒ½éœ€è¦é‡å¯ç³»ç»Ÿåæ‰èƒ½ç”Ÿæ•ˆ æ­£åœ¨ä½¿ç”¨çš„ç£ç›˜æ— æ³•ç›´æ¥ä¿®æ”¹åˆ†åŒºè¡¨ 3. æ ¼å¼åŒ–åˆ†åŒº ğŸ’¾mkfs.xfs /dev/sdb1 # æˆ–ä½¿ç”¨ mkfs.ext4ï¼Œæ ¹æ®ä½ å–œæ¬¢çš„æ–‡ä»¶ç³»ç»Ÿ mkfs.xfs å‘½ä»¤è¯¦è§£ ğŸ“Šmkfs.xfs æ˜¯ç”¨äºåˆ›å»º XFS æ–‡ä»¶ç³»ç»Ÿçš„å‘½ä»¤ï¼ŒXFS æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼Œç‰¹åˆ«é€‚åˆå¤§å‹æ–‡ä»¶å’Œå¤§å®¹é‡å­˜å‚¨è®¾å¤‡ã€‚ XFS æ–‡ä»¶ç³»ç»Ÿç‰¹ç‚¹ï¼š é«˜å¯æ‰©å±•æ€§ï¼Œæ”¯æŒæœ€å¤§ 16EB çš„æ–‡ä»¶ç³»ç»Ÿå’Œ 8EB çš„æ–‡ä»¶ é«˜æ€§èƒ½ï¼Œç‰¹åˆ«é€‚åˆå¤§å‹å­˜å‚¨ç³»ç»Ÿå’Œå¤šå¤„ç†å™¨ç³»ç»Ÿ æ”¯æŒæ—¥å¿—è®°å½•ï¼Œæä¾›æ›´å¥½çš„æ•°æ®å®Œæ•´æ€§ä¿éšœ æ”¯æŒåœ¨çº¿è°ƒæ•´å¤§å°ï¼ˆä»…æ”¯æŒæ‰©å¤§ï¼Œä¸æ”¯æŒç¼©å°ï¼‰ ä¼˜åŒ–çš„ç©ºé—´åˆ†é…å’Œç®¡ç†ç®—æ³• å¸¸ç”¨é€‰é¡¹ï¼š -f: å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œå³ä½¿è®¾å¤‡çœ‹èµ·æ¥è¢«å ç”¨ -b size=X: æŒ‡å®šå—å¤§å°ï¼Œé»˜è®¤ä¸º4KB -s size=X: æŒ‡å®šæ‰‡åŒºå¤§å° -L label: æŒ‡å®šå·æ ‡åç§° -q: å®‰é™æ¨¡å¼ï¼Œå‡å°‘è¾“å‡ºä¿¡æ¯ -d name=value: è®¾ç½®æ•°æ®æ®µé€‰é¡¹ -i name=value: è®¾ç½®ç´¢å¼•èŠ‚ç‚¹é€‰é¡¹ ç¤ºä¾‹ç”¨æ³•ï¼š # åˆ›å»ºåŸºæœ¬XFSæ–‡ä»¶ç³»ç»Ÿmkfs.xfs /dev/sdb1# åˆ›å»ºå¸¦æœ‰å·æ ‡çš„XFSæ–‡ä»¶ç³»ç»Ÿmkfs.xfs -L DATA_DISK /dev/sdb1# åˆ›å»ºå—å¤§å°ä¸º8KBçš„XFSæ–‡ä»¶ç³»ç»Ÿmkfs.xfs -b size=8192 /dev/sdb1# å¼ºåˆ¶åˆ›å»ºå¹¶æŒ‡å®šæ—¥å¿—å¤§å°mkfs.xfs -f -l size=128m /dev/sdb1 ä¸å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„æ¯”è¾ƒï¼š XFS: é€‚åˆå¤§å‹æ–‡ä»¶ç³»ç»Ÿå’Œé«˜æ€§èƒ½éœ€æ±‚ ext4: æ›´é€šç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå…¼å®¹æ€§å¥½ BTRFS: æ–°å‹æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒå¿«ç…§ã€å­å·ç­‰åŠŸèƒ½ F2FS: é’ˆå¯¹é—ªå­˜è®¾å¤‡ä¼˜åŒ–çš„æ–‡ä»¶ç³»ç»Ÿ mkfs.ext4 å‘½ä»¤è¯¦è§£ ğŸ“˜mkfs.ext4 æ˜¯ç”¨äºåˆ›å»º ext4 æ–‡ä»¶ç³»ç»Ÿçš„å‘½ä»¤ã€‚ext4ï¼ˆfourth extended filesystemï¼‰æ˜¯ Linux ç³»ç»Ÿä¸­æœ€å¹¿æ³›ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸€ï¼Œæ˜¯ ext2 å’Œ ext3 çš„åç»§ç‰ˆæœ¬ï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œå¯é æ€§ã€‚ ext4 æ–‡ä»¶ç³»ç»Ÿç‰¹ç‚¹ï¼š å‘åå…¼å®¹ ext2 å’Œ ext3 æ–‡ä»¶ç³»ç»Ÿ æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ç³»ç»Ÿå’Œæ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§ 1EB æ–‡ä»¶ç³»ç»Ÿï¼Œæœ€å¤§ 16TB æ–‡ä»¶ï¼‰ æé«˜äº†æ–‡ä»¶ç³»ç»Ÿçš„å¯é æ€§å’Œæ•°æ®å®Œæ•´æ€§ æ”¹è¿›çš„æ—¶é—´æˆ³ç²¾åº¦ï¼ˆçº³ç§’çº§ï¼‰ æŒä¹…é¢„åˆ†é…åŠŸèƒ½ï¼Œå‡å°‘æ–‡ä»¶ç¢ç‰‡ å»¶è¿Ÿåˆ†é…æŠ€æœ¯ï¼Œæé«˜æ€§èƒ½å¹¶å‡å°‘ç¢ç‰‡ æ”¯æŒæ—¥å¿—æ ¡éªŒå’Œï¼Œæé«˜äº†æ—¥å¿—çš„å¯é æ€§ æ”¯æŒåœ¨çº¿ç¢ç‰‡æ•´ç†å’Œåœ¨çº¿è°ƒæ•´å¤§å°ï¼ˆæ‰©å¤§å’Œç¼©å°ï¼‰ å¸¸ç”¨é€‰é¡¹ï¼š -b size: æŒ‡å®šå—å¤§å°ï¼ˆ1024, 2048, 4096å­—èŠ‚ç­‰ï¼‰ -c: åˆ›å»ºå‰æ£€æŸ¥åå— -L label: è®¾ç½®æ–‡ä»¶ç³»ç»Ÿå·æ ‡ -m reserved-blocks-percentage: è®¾ç½®ä¸ºç³»ç»Ÿä¿ç•™çš„å—ç™¾åˆ†æ¯”ï¼Œé»˜è®¤ä¸º5% -O [^]feature[,...]: è®¾ç½®æˆ–å–æ¶ˆæ–‡ä»¶ç³»ç»Ÿç‰¹æ€§ -j: åˆ›å»ºå¸¦æ—¥å¿—çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆåœ¨ext4ä¸­é»˜è®¤å¼€å¯ï¼‰ -E extended-options: è®¾ç½®æ‰©å±•é€‰é¡¹ -F: å¼ºåˆ¶åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ ç¤ºä¾‹ç”¨æ³•ï¼š # åˆ›å»ºåŸºæœ¬ext4æ–‡ä»¶ç³»ç»Ÿmkfs.ext4 /dev/sdb1# åˆ›å»ºå¸¦å·æ ‡çš„ext4æ–‡ä»¶ç³»ç»Ÿmkfs.ext4 -L DATA_DRIVE /dev/sdb1# åˆ›å»ºæœ‰è¾ƒå°‘ç³»ç»Ÿä¿ç•™ç©ºé—´çš„ext4æ–‡ä»¶ç³»ç»Ÿmkfs.ext4 -m 2 /dev/sdb1# åˆ›å»ºå—å¤§å°ä¸º2KBçš„ext4æ–‡ä»¶ç³»ç»Ÿå¹¶æ£€æŸ¥åå—mkfs.ext4 -b 2048 -c /dev/sdb1# ä½¿ç”¨ç‰¹å®šç‰¹æ€§åˆ›å»ºext4æ–‡ä»¶ç³»ç»Ÿmkfs.ext4 -O dir_index,extent,flex_bg /dev/sdb1 ext4 ä¸å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„å¯¹æ¯”ï¼š ext4: ç¨³å®šã€å…¼å®¹æ€§å¼ºã€é€‚åˆå¤§å¤šæ•°é€šç”¨åœºæ™¯ XFS: æ€§èƒ½æ›´å¥½ä½†åŠŸèƒ½ç›¸å¯¹è¾ƒå°‘ï¼Œæ›´é€‚åˆå¤§å‹æ–‡ä»¶ç³»ç»Ÿ ext3: ext4çš„å‰èº«ï¼ŒåŠŸèƒ½è¾ƒå°‘ä½†æ›´ç¨³å®š BTRFS: æ›´ç°ä»£åŒ–ï¼Œæœ‰æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚å¿«ç…§ï¼‰ï¼Œä½†æˆç†Ÿåº¦è¾ƒä½ F2FS: é’ˆå¯¹SSDå’Œé—ªå­˜è®¾å¤‡ä¼˜åŒ– ä½•æ—¶é€‰æ‹© ext4ï¼š éœ€è¦å¹¿æ³›å…¼å®¹æ€§æ—¶ï¼ˆå‡ ä¹æ‰€æœ‰Linuxå‘è¡Œç‰ˆéƒ½æ”¯æŒï¼‰ éœ€è¦åœ¨å„ç§ç¯å¢ƒä¸‹çš„ç¨³å®šæ€§æ—¶ éœ€è¦åœ¨æ–‡ä»¶ç³»ç»Ÿå®¹é‡å’Œæ€§èƒ½é—´å–å¾—å¹³è¡¡æ—¶ ç³»ç»Ÿå¯åŠ¨åˆ†åŒºå’Œå¸¸è§„æ•°æ®åˆ†åŒº 4. æŒ‚è½½åˆ†åŒº ğŸ”—mount /dev/sdb1 /data 5. è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ âš™ï¸ è·å–åˆ†åŒºçš„ UUIDï¼šblkid /dev/sdb1 è¾“å‡ºç¤ºä¾‹ï¼š /dev/sdb1: UUID=&quot;puresai-xxxx&quot; TYPE=&quot;xfs&quot; ç¼–è¾‘ /etc/fstab æ–‡ä»¶ï¼š vim /etc/fstab æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ›¿æ¢å®é™…çš„ UUID å’Œæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼‰ï¼š UUID=puresai-xxxx /data xfs defaults 0 0 æ³¨æ„äº‹é¡¹ âš ï¸ ç¡®ä¿åœ¨æ“ä½œå‰å¤‡ä»½é‡è¦æ•°æ® ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œè¿™äº›å‘½ä»¤ å»ºè®®åœ¨æ“ä½œå‰ç¡®è®¤ç£ç›˜è®¾å¤‡åç§°æ­£ç¡® å¦‚æœä½¿ç”¨å…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼Œè¯·ç›¸åº”ä¿®æ”¹æ ¼å¼åŒ–å‘½ä»¤å’Œ fstab é…ç½®","tags":["shell"],"categories":["shell"]},{"title":"æŸ¥æ‰¾ä¸€å †gzæ–‡ä»¶æ˜¯å¦å«æœ‰æŸäº›å­—ç¬¦ä¸²","path":"/2025/04/23/526/","content":"find . -name &quot;aaaa*.jsonl.gz&quot; | xargs -P 4 -I &#123;&#125; sh -c &#x27;echo &quot;Searching &#123;&#125;...&quot;; zgrep &quot;xxx&quot; &quot;&#123;&#125;&quot;&#x27; // outputSearching ./aaaa_00.jsonl.gz...Searching ./aaaa_01.jsonl.gz...Searching ./aaaa_02.jsonl.gz...Searching ./aaaa_03.jsonl.gz...&#123;&quot;fullName&quot;:&quot;xxx&quot;,&quot;firstName&quot;:&quot;aaa&quot;...","tags":["shell"],"categories":["shell"]},{"title":"2024,è¿™ä¸€å¹´","path":"/2025/01/28/2024/","content":"å¤§å®¶æ–°å¹´å¿«ä¹ï¼ å»å¹´æ²¡å†™å¹´ç»ˆæ€»ç»“ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰è®¡åˆ’æ¯”å¯¹ã€‚ å·¥ä½œå·¥ä½œæ—¶é•¿æ˜æ˜¾çŸ­äºå»å¹´ï¼Œå°‘æœ‰æ—¶é•¿è¶…è¿‡9å°æ—¶ï¼Œå¤§éƒ¨åˆ†æ—¶é—´åœ¨5-7å°æ—¶ã€‚å·¥ä½œå†…å®¹ä¹Ÿæ²¡æœ‰å¤ªå¤§å˜åŠ¨ï¼Œæ²¡æœ‰å¤ªå¤§çªç ´ã€‚ç›¸æ¯”å»å¹´ï¼Œå¾ˆå¤šä»»åŠ¡è¦é¡ºæ‰‹å¾—å¤šï¼Œæ•ˆç‡ä¹Ÿé«˜äº†ä¸å°‘ã€‚ 3æœˆä»½å‰éš†å¡èšä¼šäº†ä¸€æ¬¡ï¼Œéš¾å¾—å’ŒåŒäº‹ä¸€èµ·ï¼Œç©å¾—å¾ˆå¼€å¿ƒã€‚å‘ç°å‡ ä¸ªåŒäº‹çº¿ä¸Šçº¿ä¸‹åˆ¤è‹¥ä¸¤äººã€‚ ä¸€æ™ƒè¿™ä»½å·¥ä½œå·²ç»åšäº†2å¹´å¤šï¼Œæ¯•ä¸šåæœ€é•¿çš„ä¸€æ®µå·¥ä½œç»å†äº†ï¼Œå“ˆå“ˆã€‚å¯ä»¥å¾ˆå¥½åšåˆ° WLBï¼Œå›¢é˜Ÿæ°›å›´æå¥½ã€‚ å­¦ä¹ å°´å°¬ï¼Œä»Šå¹´æ²¡æœ‰å®Œæ•´è¯»å®Œä¸€æœ¬ä¹¦ã€‚æŠ€æœ¯ç±»ä¹¦ç±ä¹Ÿå°±æ˜¯éœ€è¦çš„æ—¶å€™çœ‹çœ‹ï¼Œæ²¡æœ‰å®Œæ•´é˜…è¯»ã€‚è‚²å„¿ç±»çš„ä¹¦å€’æ˜¯çœ‹äº†äº›ã€‚ è‹±è¯­æ–¹é¢ï¼Œä»å»å¹´12æœˆåº•åˆ°æœ¬æœˆ25å·ï¼Œæµåˆ©è¯´ä¸€å…±394å¤©ï¼Œæ‰“å¡388å¤©ï¼Œ334å°æ—¶ã€‚è¾¹å­¦è¾¹ç”¨ï¼Œæœ‰æé«˜ï¼Œä½†å¼€ä¼šæˆ‘è¿˜æ˜¯ä¸å¤ªèƒ½å¬æ‡‚ï¼Œçœ‹æ¥å¾—è¯•è¯•å…¶ä»–æ–¹æ³•æé«˜å¬åŠ›äº†ã€‚ç¬¬ä¸€æ¬¡å‡ºå›½ï¼Œè‹±æ–‡å¤§èƒ†è¯´ï¼Œåˆ«äººä¹Ÿèƒ½æ‡‚ã€‚ æ²¡æœ‰è¾“å…¥ï¼Œè¾“å‡ºè‡ªç„¶å°‘äº†ï¼Œä»Šå¹´å…¬ä¼—å·æ²¡æœ‰æ›´æ–°ï¼Œåšå®¢æ–‡ç« ä¹Ÿæ˜¯è¿‘äº”å¹´æœ€å°‘çš„ä¸€å¹´ã€‚ ç”Ÿæ´»ä¸»é¢˜è¯â€”â€”å¥”æ³¢ã€‚ å¾ˆå¿™çš„ä¸€å¹´ï¼Œå±…å®¶åŠå…¬ï¼Œä½†è¡Œé©¶é‡Œç¨‹è¶…è¿‡å‰é¢2å¹´ã€‚çäº‹å¾ˆå¤šï¼Œä¸ŠåŠå¹´å¦»å­æ€€å­•ï¼Œæ¯å¤© 24 å°æ—¶å‡ ä¹æ»¡æ»¡å½“å½“ï¼Œä¸‹åŠå¹´å­©å­å‡ºç”Ÿï¼Œä¾æ—§å¾ˆå¿™ã€‚è¿˜å¥½å®¶äººçš„å¸®åŠ©ï¼Œè®©æˆ‘èƒ½å®‰å¿ƒå·¥ä½œã€‚ æ¹¿ç–¹10æœˆä¸­æ—¬å†æ¬¡çˆ†å‘ï¼Œè‡³ä»Šæœªæ„ˆï¼Œè¯•ç€çœ‹çœ‹ä¸­åŒ»ï¼Œè°ƒç†ä¸€é˜µæœ‰æ²¡æœ‰æ•ˆæœã€‚ side projectsåˆä½œäº†å‡ ä¸ªå°é¡¹ç›®ï¼Œæœ‰æ—¶å€™ä¼šå¾ˆå¿™ï¼Œä¸å½±å“å·¥ä½œç”Ÿæ´»çš„å‰æä¸‹ï¼Œä¼šç»§ç»­åšåšã€‚ å°è¯•åšäº§å“ï¼Œç›®å‰è¿˜åœ¨åˆå§‹é˜¶æ®µã€‚ æ€»ç»“æ„Ÿè°¢æˆ‘çš„å¦»å­ï¼Œå¯¹æˆ‘è¿‘ä¹æ— æ¡ä»¶çš„æ”¯æŒã€‚ æ„Ÿè°¢æˆ‘çš„æ¯äº²ï¼Œå¯¹æˆ‘çš„åŒ…å®¹å’Œç†è§£ã€‚ æ„Ÿè°¢æˆ‘çš„åŒäº‹ä¼™ä¼´ï¼Œå¯¹æˆ‘çš„å¸®åŠ©ä¸æ”¯æŒã€‚ æ„Ÿè°¢å®¶äººæœ‹å‹çš„æ”¯æŒã€‚ æ„Ÿè°¢æˆ‘çš„å®å®ã€‚ æ–°å¹´è®¡åˆ’ åšå¥½è¾¾è¾¾çš„æ”¯æŒå·¥ä½œ åš2ä¸ªæœ‰ç”¨çš„äº§å“ çªç ´ï¼Ÿ ä½œæ¯è°ƒæ•´ï¼Œæ§åˆ¶æ¹¿ç–¹ ç”²è¾°æ­£æœˆåˆäº”äºæ‰¬å·2025å¹´02æœˆ02æ—¥","tags":["oneyear"],"categories":["oneyear"]},{"title":"Python3è™šæ‹Ÿç¯å¢ƒvenv","path":"/2024/11/24/520/","content":"å¤šé¡¹ç›®å…±å­˜çš„æœåŠ¡å™¨ï¼Œæ¯ä¸ªé¡¹ç›®ä¾èµ–çš„åŒ…å¯èƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚é¡¹ç›®Aéœ€è¦ utilset 0.0.3, é¡¹ç›®Béœ€è¦utilset 0.4ï¼Œè¿™æ—¶å€™å°±éœ€è¦éš”ç¦»å¼€ï¼Œvenvå°±æ˜¯ç”¨æ¥ä¸ºä¸€ä¸ªåº”ç”¨åˆ›å»ºä¸€å¥—â€œéš”ç¦»â€çš„Pythonè¿è¡Œç¯å¢ƒã€‚ venv æ”¯æŒåˆ›å»ºè½»é‡çš„â€œè™šæ‹Ÿç¯å¢ƒâ€ï¼Œæ¯ä¸ªè™šæ‹Ÿç¯å¢ƒå°†æ‹¥æœ‰å®ƒä»¬è‡ªå·±ç‹¬ç«‹çš„å®‰è£…åœ¨å…¶ site ç›®å½•ä¸­çš„ Python è½¯ä»¶åŒ…é›†åˆã€‚ è™šæ‹Ÿç¯å¢ƒæ˜¯åœ¨ç°æœ‰çš„ Python å®‰è£…ç‰ˆåŸºç¡€ä¹‹ä¸Šåˆ›å»ºçš„ï¼Œè¿™è¢«ç§°ä¸ºè™šæ‹Ÿç¯å¢ƒçš„â€œåŸºç¡€â€Pythonï¼Œå¹¶ä¸”è¿˜å¯é€‰æ‹©ä¸åŸºç¡€ç¯å¢ƒä¸­çš„è½¯ä»¶åŒ…éš”ç¦»å¼€æ¥ï¼Œè¿™æ ·åªæœ‰åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ˜¾å¼å®‰è£…çš„è½¯ä»¶åŒ…æ‰æ˜¯å¯ç”¨çš„ã€‚ åˆ›å»ºmkdir puresaicd puresaiâœ puresai ls -lhtotal 0âœ puresai python3 -m venv .âœ puresai ls -lh total 8drwxr-xr-x 12 sai staff 384B Nov 24 19:45 bindrwxr-xr-x 2 sai staff 64B Nov 24 19:45 includedrwxr-xr-x 3 sai staff 96B Nov 24 19:45 lib-rw-r--r-- 1 sai staff 111B Nov 24 19:45 pyvenv.cfg å¯ä»¥å‘ç°æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹å’Œä¸€ä¸ªpyvenv.cfgæ–‡ä»¶ï¼š æ¿€æ´»binç›®å½•ä¸‹æœ‰ä¸ª activateï¼ŒLinux/Macç”¨ source bin/activateï¼ŒWindowsç”¨bin/activate.batæ¿€æ´»è¯¥venvç¯å¢ƒã€‚ puresai$ source bin/activate(puresai) $ æ³¨æ„åˆ°å‘½ä»¤æç¤ºç¬¦å˜äº†ï¼Œæœ‰ä¸ª(puresai)å‰ç¼€ï¼Œè¡¨ç¤ºå½“å‰ç¯å¢ƒæ˜¯ä¸€ä¸ªåä¸ºpuresaiçš„Pythonç¯å¢ƒã€‚ ä¸‹é¢æ­£å¸¸å®‰è£…å„ç§ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¹¶è¿è¡Œpythonå‘½ä»¤ï¼š pip3 install utilset==0.0.3Collecting utilset==0.0.3 Using cached utilset-0.0.3-py3-none-any.whl (4.8 kB)Installing collected packages: utilsetSuccessfully installed utilset-0.0.3WARNING: You are using pip version 21.2.4; however, version 24.3.1 is available.You should consider upgrading via the &#x27;/Users/sai/puresai/bin/python3 -m pip install --upgrade pip&#x27; command.(puresai) åœ¨venvç¯å¢ƒä¸‹ï¼Œç”¨pipå®‰è£…çš„åŒ…éƒ½è¢«å®‰è£…åˆ° puresai è¿™ä¸ªç¯å¢ƒä¸‹ï¼Œå…·ä½“ç›®å½•æ˜¯ puresai/lib/python3.x/site-packagesï¼Œå› æ­¤ï¼Œç³»ç»ŸPythonç¯å¢ƒä¸å—ä»»ä½•å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œpuresai ç¯å¢ƒæ˜¯ä¸“é—¨é’ˆå¯¹puresaiè¿™ä¸ªåº”ç”¨åˆ›å»ºçš„ã€‚ é€€å‡ºå½“å‰çš„ puresai ç¯å¢ƒï¼Œä½¿ç”¨deactivateå‘½ä»¤ï¼š (puresai) $ deactivate æ­¤æ—¶å°±å›åˆ°äº†æ­£å¸¸çš„ç¯å¢ƒï¼Œç°åœ¨pipæˆ–pythonå‡æ˜¯åœ¨ç³»ç»ŸPythonç¯å¢ƒä¸‹æ‰§è¡Œã€‚ å®Œå…¨å¯ä»¥é’ˆå¯¹æ¯ä¸ªåº”ç”¨åˆ›å»ºç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œè¿™æ ·å°±å¯ä»¥å¯¹æ¯ä¸ªåº”ç”¨çš„Pythonç¯å¢ƒè¿›è¡Œéš”ç¦»ã€‚ åŸç†venvæ˜¯å¦‚ä½•åˆ›å»ºâ€œç‹¬ç«‹â€çš„Pythonè¿è¡Œç¯å¢ƒçš„å‘¢ï¼ŸåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç³»ç»ŸPythoné“¾æ¥æˆ–å¤åˆ¶ä¸€ä»½åˆ°venvçš„ç¯å¢ƒï¼Œç”¨å‘½ä»¤source activateè¿›å…¥ä¸€ä¸ªvenvç¯å¢ƒæ—¶ï¼Œvenvä¼šä¿®æ”¹ç›¸å…³ç¯å¢ƒå˜é‡ï¼Œè®©å‘½ä»¤pythonå’Œpipå‡æŒ‡å‘å½“å‰çš„venvç¯å¢ƒã€‚ å¦‚æœä¸å†ä½¿ç”¨æŸä¸ªvenvï¼Œä¾‹å¦‚puresaiï¼Œåˆ é™¤å®ƒä¹Ÿå¾ˆç®€å•ã€‚é¦–å…ˆç¡®è®¤è¯¥venvæ²¡æœ‰å¤„äºâ€œæ¿€æ´»â€çŠ¶æ€ï¼Œç„¶åç›´æ¥æŠŠæ•´ä¸ªç›®å½•puresaiåˆ æ‰å°±è¡Œã€‚ å‚è€ƒ venv","tags":["python"],"categories":["python"]},{"title":"æ’æŸ¥Linuxç£ç›˜ç©ºé—´ä¸è¶³çš„é—®é¢˜","path":"/2024/10/24/530/","content":"æœ€è¿‘å‡ å¤©æ”¶åˆ°ç›‘æ§é€šçŸ¥æœåŠ¡å™¨ A ç£ç›˜å‰©ä½™å°äº10% çš„æƒ…å†µã€‚ æ’æŸ¥å¤§æ–‡ä»¶ï¼š [root@syskf175 ~]# find / -type f -size +100M -exec ls -lh &#123;&#125; \\;-r--------. 1 root root 128T Oct 24 17:32 /proc/kcorefind: â€˜/proc/30420/task/30420/fdinfo/5â€™: No such file or directoryfind: â€˜/proc/30420/fdinfo/6â€™: No such file or directory-rw-------. 1 root root 128M Oct 24 13:26 /sys/devices/pci0000:00/0000:00:0f.0/resource1_wc-rw-------. 1 root root 128M Oct 24 13:26 /sys/devices/pci0000:00/0000:00:0f.0/resource1-rw-r--r--. 1 root root 169M Apr 13 2024 /var/lib/rpm/Packages-rw-r-----. 1 root root 1.1G Oct 24 17:32 /var/lib/docker/containers/3138d971f20379b6c956f1766ec643232e677d622adf37c83520860f54c57415/3138d971f20379b6c956f1766ec643232e677d622adf37c83520860f54c57415-json.log-rw-r-----. 1 root root 1.6G Oct 22 10:30 /var/lib/docker/containers/dcc20350d4e75259ac2999565c23717d809f457c198b6e7c338e1ca1460a1404/dcc20350d4e75259ac2999565c23717d809f457c198b6e7c338e1ca1460a1404-json.log-rw-r-----. 1 root root 29G Oct 24 17:32 /var/lib/docker/containers/ff9662f09d5348efd572445db6b0716b6397e3341e6e538703aac722cepuresai/ff9662f09d5348efd572445db6b0716b6397e3341e6e538703aac722cepuresai-json.log-rw-r--r--. 1 root root 147M Apr 3 2024 /var/cache/yum/x86_64/7/updates/gen/primary_db.sqlite-rw-r--r--. 1 root root 102M Apr 13 2024 /usr/lib/locale/locale-archive-rwxr-xr-x. 1 root root 138M Feb 14 2022 /usr/lib64/firefox/libxul.so èƒ½çœ‹åˆ°æœ‰ä¸ª 29G çš„å¤§æ–‡ä»¶ï¼Œè€ƒè™‘æ˜¯ docker å®¹å™¨æ—¥å¿—ï¼Œä¿ç•™æ„ä¹‰ä¸å¤§ã€‚ æ¸…ç©ºå³å¯ï¼š truncate -s 0 /var/lib/docker/containers/ff9662f09d5348efd572445db6b0716b6397e3341e6e538703aac722cepuresai/ff9662f09d5348efd572445db6b0716b6397e3341e6e538703aac722cepuresai-json.log çœ‹åˆ°å‰©ä½™ç©ºé—´è¶³å¤Ÿäº†ï¼Œä¸ç”¨æŒ‚è½½æ–°ç£ç›˜äº†ã€‚","tags":["Linux"],"categories":["Linux"]},{"title":"python3è¯»å–csv _csv.Error: line contains NUL","path":"/2024/09/22/525/","content":"python3 è¯»å–ç¨å¤§ä¸€ç‚¹çš„ CSV æ–‡ä»¶æ—¶ï¼Œç»å¸¸ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯: for row in csv_reader: _csv.Error: line contains NUL å‡ºç° _csv.Error: line contains NUL é”™è¯¯é€šå¸¸æ˜¯å› ä¸º CSV æ–‡ä»¶ä¸­å­˜åœ¨ä¸å¯è§çš„ NUL å­—ç¬¦ï¼ˆç©ºå­—ç¬¦ï¼‰ï¼Œè¿™ä¼šå¹²æ‰° Python çš„ csv.readerã€‚è¿™æ˜¯æ–‡ä»¶è¯»å–çš„é—®é¢˜ï¼Œé€šå¸¸å‘ç”Ÿåœ¨æ–‡ä»¶ç¼–ç æˆ–æ ¼å¼å¼‚å¸¸æ—¶ã€‚ æ‰€ä»¥æ›¿æ¢æ‰å°±è¡Œï¼š with open(&quot;puresai.csv&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;, newline=&#x27;&#x27;) as f: # æ›¿æ¢æ‰ NUL å­—ç¬¦ content = f.read().replace(&#x27;\\0&#x27;, &#x27;&#x27;) csv_reader = csv.reader(content.splitlines()) # é€è¡Œè¯»å–æ•°æ® for row in csv_reader: count += 1 .... è¿è¡Œæ—¶æœ‰å‘ç°ä¼šè¢« Killed, ä¼°è®¡æ˜¯æ–‡ä»¶å¤ªå¤§ï¼Œå†…å­˜çˆ†äº†ï¼Œæ”¹æˆæŒ‰è¡Œæ›¿æ¢å°±è¡Œã€‚ with open(&quot;puresai.csv&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;, newline=&#x27;&#x27;) as f: # ä½¿ç”¨ csv æ¨¡å—é€è¡Œè¯»å– CSV æ•°æ® csv_reader = csv.reader((line.replace(&#x27;\\0&#x27;, &#x27;&#x27;) for line in f)) # é€è¡Œå»é™¤ NUL å­—ç¬¦ # é€è¡Œè¯»å–æ•°æ® for row in csv_reader: count += 1 ... é«˜é¢‘é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ï¼Œå¸Œæœ›å¯¹ä½ æœ‰ç”¨ã€‚","tags":["python"],"categories":["python"]},{"title":"mysqlå¦‚ä½•ä½¿ç”¨ä¸å®šæ•°é‡çš„æŸ¥è¯¢","path":"/2024/08/16/471/","content":"where in æŸ¥è¯¢æ˜¯å¾ˆå¸¸è§çš„ï¼Œä½†ä½ çŸ¥é“ python3 ä¸­æ€ä¹ˆå†™å—ï¼Ÿ è¯ä¸å¤šè¯´ç›´æ¥ä¸Š sample import pymysqlimport configsql = &quot;&quot;&quot;SELECT abc, MAX(last_updated) as last_updatedFROM xxxWHERE abc IN (&#123;&#125;)&quot;&quot;&quot;class Runner(object): ... def phone_exist(self, abc): sai = [] placeholders = &quot;, &quot;.join([&quot;%s&quot;] * len(abc)) query = trovo_sql.format(placeholders) self.cursor.execute(query, abc) rows = self.cursor.fetchall() for row in rows: sai.append(row[&quot;abc&quot;]) return sai return sai","tags":["python"],"categories":["python"]},{"title":"è§£å†³webmanäº‹åŠ¡ä¸ç”Ÿæ•ˆçš„é—®é¢˜","path":"/2024/08/07/521/","content":"èƒŒæ™¯ä¸Šå‘¨ QA åé¦ˆç»™æˆ‘è¯´ï¼Œä»»åŠ¡æ·»åŠ å¤±è´¥äº†ï¼Œä½†ä»»åŠ¡è®°å½•å¤šäº†ä¸€æ¡ï¼Œæˆ‘æƒ³æˆ‘ç”¨äº†äº‹åŠ¡æŒ‰ç†ä¸åº”è¯¥å•Šã€‚ å®šä½æ£€æŸ¥ä»£ç é€»è¾‘æ£€æŸ¥é¡¹ç›®ä»£ç ï¼Œï¼ˆä½¿ç”¨çš„ webman ï¼‰ Db::beginTransaction();try &#123; // çœç•¥ä¸šåŠ¡ä»£ç  throw new \\Exception(&#x27;mode é”™è¯¯&#x27;);&#125; catch (\\Exception $e ) &#123; Db::rollback();&#125; é€»è¾‘çœ‹ä¼¼æ— è¯¯ï¼Œå¤±è´¥åç¡®å®æç¤ºäº†ï¼Œä½†ä¹Ÿç¡®å®å¤šäº†æ¡æ•°æ®ã€‚ æŸ¥æ‰‹å†ŒæŸ¥æ‰‹å†Œ https://www.workerman.net/doc/webman/others/transaction.html çœ‹åˆ° è¿™é‡Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»ä½¿ç”¨\\Throwableè€Œä¸èƒ½ä½¿ç”¨\\Exceptionï¼Œå› ä¸ºä¸šåŠ¡å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½è§¦å‘Errorï¼Œå®ƒå¹¶ä¸å±äºException ä¿®æ”¹Exception ä¸º Throwableï¼Œæœ¬åœ°æµ‹è¯•ï¼Œè¿˜æ˜¯ä¸€æ ·çš„æƒ…å†µã€‚ ç¤¾åŒºæœç´¢ç„¶åæ’æŸ¥æ˜¯ä¸æ˜¯connection æŒ‡å®šé—®é¢˜ï¼ˆæœç´¢ç¤¾åŒºé—®é¢˜ï¼‰ï¼Œå‘ç°æˆ‘ä½¿ç”¨çš„ Model æ²¡æœ‰æŒ‡å®šï¼ŒæŒ‰é€»è¾‘æ˜¯é›†æˆäº†çˆ¶ç±» protected $connection = â€˜plugin.admin.mysqlâ€™; å°è¯•ç›´æ¥æŒ‡å®šä¸‹ï¼Œprotected $connection = â€˜mysqlâ€™; ç„¶åï¼Œ Db::connection(&#x27;mysql&#x27;)-&gt;beginTransaction();try&#123; // çœç•¥ä¸šåŠ¡ä»£ç  throw new \\Exception(&#x27;mode é”™è¯¯&#x27;);&#125; catch (\\Throwable $e) &#123; Db::connection(&#x27;mysql&#x27;)-&gt;rollback();&#125; å†æ¬¡æµ‹è¯•ï¼Œæ·»åŠ ä»»åŠ¡å¤±è´¥åï¼Œæ²¡æœ‰æ–°å¢ä¸€æ¡è®°å½•ï¼Œè‡ªå¢å€¼å¤œæ·»åŠ äº†ä¸€ä¸ªï¼Œè¯´æ˜äº‹åŠ¡å›æ»šæˆåŠŸäº†ã€‚ å¥½äº†ï¼Œè¿™æ¬¡ debug è¯´æ˜ä¹Ÿæ°å¥½å†™å‡ºæ¥å…·ä½“çš„æ’æŸ¥æ­¥éª¤ã€‚ä½ æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Œæ¬¢è¿è¯„è®ºåŒºç•™è¨€ï¼","tags":["webman"],"categories":["webman"]},{"title":"python3æŸ¥è¯¢esè¶…æ—¶","path":"/2024/08/01/520/","content":"scroll æŸ¥è¯¢æ˜¯å¾ˆå¸¸è§çš„ï¼Œå½“ä½¿ç”¨æ—¶ï¼Œæç¤ºé”™è¯¯ï¼Œ socket.timeout: The read operation timed outDuring handling of the above exception, another exception occurred: è€Œ python çš„ scroll æŸ¥è¯¢æ˜¯æ²¡æœ‰æŸ¥è¯¢æ—¶é—´è®¾ç½®çš„ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ es è¿æ¥çš„è¶…æ—¶å‚æ•°æ¥å¤„ç†ã€‚ es = Elasticsearch(hosts=url, timeout=60, retry_on_timeout=True) æ”¹åŠ¨ä¹‹åï¼Œ å°± ok äº†ã€‚","tags":["python"],"categories":["python"]},{"title":"æ£€æŸ¥æ˜¯å¦åœ¨ä¼ä¸šå¾®ä¿¡ä¸­","path":"/2024/04/21/512/","content":"å°±æ˜¯æ ¹æ® userAgent åˆ¤æ–­ï¼Œæ³¨æ„ä¸‹ ä¼ä¸šå¾®ä¿¡ç¯å¢ƒ UA ä¹Ÿä¼šåŒ…å« micromessengerï¼Œ æ³¨æ„ä¸‹å°±è¡Œã€‚ let ua = window.navigator.userAgent.toLowerCase();if (ua.indexOf(&quot;wxwork&quot;) != -1) &#123; console.log(&quot;ä¼ä¸šå¾®ä¿¡ç¯å¢ƒ&quot;)&#125; else if (ua.indexOf(&quot;micromessenger&quot;) != -1) &#123; console.log(&quot;å¾®ä¿¡ç¯å¢ƒ&quot;)&#125; else &#123; console.log(&quot;å…¶ä»–&quot;)&#125;","categories":["js"]},{"title":"åšä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç›‘æ§ä¼ä¸šå¾®ä¿¡é€šçŸ¥","path":"/2024/04/14/511/","content":"ä»£ç é€»è¾‘ç®€å•ï¼Œæ£€æŸ¥æœåŠ¡å™¨ç£ç›˜å†…å­˜CPUå ç”¨ï¼Œè¶…è¿‡è®¾å®šçš„é˜ˆå€¼å°±å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥ã€‚ ä¸»è¦ä»£ç import psutilimport requestsimport jsonimport loggingimport clickimport osfrom datetime import datetimeimport socketclass ServerMonitor: def __init__(self, webhook_url, threshold=90, server_name=&quot;Server&quot;): self.webhook_url = webhook_url self.threshold = threshold self.server_name = server_name logging.basicConfig( level=logging.INFO, handlers=[ logging.FileHandler(f&quot;&#123;os.path.basename(__file__)&#125;.log&quot;, &quot;a&quot;, &quot;utf-8&quot;), ], format=&quot;%(asctime)s %(levelname)s %(message)s&quot;, datefmt=&quot;%m-%d %H:%M:%S&quot;, ) def check_server_status(self): cpu_percent = psutil.cpu_percent(interval=1) cpu_count = psutil.cpu_count() memory = psutil.virtual_memory() disk_usage = psutil.disk_usage(&#x27;/&#x27;) system_load = psutil.getloadavg() if (cpu_percent &gt; self.threshold or memory.percent &gt; self.threshold or disk_usage.percent &gt; self.threshold or system_load[0] &gt; self.threshold): return True else: return False def send_notification(self): disk_usage = psutil.disk_usage(&#x27;/&#x27;) memory = psutil.virtual_memory() cpu_count = psutil.cpu_count() system_load = psutil.getloadavg() current_time = datetime.now().strftime(&quot;%Y-%m-%d %H:%M:%S&quot;) msg = f&quot;&#123;self.server_name&#125; &#123;current_time&#125; &quot; msg += f&quot;**CPUåˆ©ç”¨ç‡ï¼š** &#123;psutil.cpu_percent(interval=1)&#125;% (&#123;cpu_count&#125; cores) &quot; msg += f&quot;**å†…å­˜ä½¿ç”¨ï¼š** &#123;memory.percent&#125;% (å†…å­˜æ€»å¤§å°ï¼š&#123;self.bytes_to_gb(memory.total)&#125;GB) &quot; msg += f&quot;**ç£ç›˜åˆ©ç”¨ç‡ï¼š** &#123;disk_usage.percent&#125;% (å‰©ä½™ç£ç›˜ç©ºé—´ï¼š&#123;self.bytes_to_gb(disk_usage.free)&#125;GB) &quot; msg += f&quot;**ç³»ç»Ÿè´Ÿè½½ï¼š** &#123;system_load[0]:.2f&#125; &quot; is_exception = self.check_server_status() if is_exception: logging.info(&quot;æœåŠ¡å™¨è¿è¡Œ%s: %s&quot;, &#x27;å¼‚å¸¸&#x27; if is_exception else &#x27;æ­£å¸¸&#x27;, msg) if is_exception: msg += f&quot;&lt;font color=&#x27;warning&#x27;&gt;**æœåŠ¡å™¨è¿è¡Œå¼‚å¸¸, è¯·å°½å¿«å¤„ç†!**&lt;/font&gt; &quot; else: msg += f&quot;æœåŠ¡å™¨è¿è¡Œæ­£å¸¸ &quot; message = &#123;&quot;msgtype&quot;: &quot;markdown&quot;, &quot;markdown&quot;: &#123;&quot;content&quot;: msg&#125;&#125; response = requests.post( self.webhook_url, data=json.dumps(message), headers=&#123;&#x27;Content-Type&#x27;: &#x27;application/json&#x27;&#125;) if response.status_code == 200: logging.info(&quot;æ¶ˆæ¯å‘é€æˆåŠŸï¼&quot;) else: logging.error(f&quot;æ¶ˆæ¯å‘é€å¤±è´¥: &#123;response.status_code&#125;&quot;) else: logging.info(&quot;æœåŠ¡å™¨è¿è¡Œæ­£å¸¸: %s&quot;, msg) @staticmethod def bytes_to_gb(bytes): gb = bytes / (1024**3) return round(gb, 2)@click.command()@click.option(&quot;--webhook_url&quot;, required=True, help=&quot;ä¼ä¸šå¾®ä¿¡æœºå™¨äººçš„Webhook&quot;)@click.option(&quot;--threshold&quot;, default=90, required=True, help=&quot;å‘Šè­¦é˜ˆå€¼&quot;)@click.option(&quot;--server_name&quot;, default=&quot;Server&quot;, required=True, help=&quot;æœåŠ¡å™¨åç§°&quot;)def main(webhook_url, threshold, server_name): server_monitor = ServerMonitor(webhook_url, threshold, server_name) server_monitor.send_notification()if __name__ == &quot;__main__&quot;: main() å®šæ—¶ä»»åŠ¡ç›´æ¥æ”¾ crontab å°±è¡Œï¼Œæ¯”å¦‚æ¯5åˆ†ä¹‹æ£€æŸ¥ä¸€æ¬¡ã€‚ crontab -e */5 * * * * /usr/bin/python3 /root/monitor.py --webhook_url=&quot;https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx&quot; --server_name=&quot;puresai blog&quot; --threshold=90 &gt;/dev/null 2&gt;&amp;1 &amp;","tags":["python"],"categories":["python"]},{"title":"å¦‚ä½•å‘å¸ƒä¸€ä¸ªpipåŒ…","path":"/2024/03/21/510/","content":"å‡†å¤‡æ³¨å†Œå·è´¦å·ï¼š https://pypi.org/account/register/ ç¼–ç code pip install buildpip install twinepip install setuptools wheeltouch setup.py setup.py from setuptools import setupfrom os import pathprint(path.abspath(path.dirname(__file__)))with open( path.join(path.abspath(path.dirname(__file__)), &#x27;README.md&#x27;), encoding=&#x27;utf-8&#x27;) as f: long_description = f.read()setup( name=&#x27;utilset&#x27;, version=&#x27;0.0.1&#x27;, author=&#x27;puresai&#x27;, url=&#x27;https://github.com/puresai/utilset&#x27;, description=&quot;util sets&quot;, long_description_content_type=&quot;text/markdown&quot;, long_description=long_description, packages=[&#x27;utilset&#x27;], install_requires=[], platforms=[&quot;all&quot;], classifiers=[ &#x27;Intended Audience :: Developers&#x27;, &#x27;Operating System :: OS Independent&#x27;, &#x27;Natural Language :: Chinese (Simplified)&#x27;, &#x27;Programming Language :: Python :: 3.5&#x27;, &#x27;Programming Language :: Python :: 3.6&#x27;, &#x27;Programming Language :: Python :: 3.7&#x27;, &#x27;Programming Language :: Python :: 3.8&#x27;, &#x27;Topic :: Software Development :: Libraries&#x27; ],) deploy python3 setup.py checkrm -rf distpython3 -m buildpython3 -m twine upload dist/* apitokenupload ä¹‹å‰æ˜¯å¯ä»¥è¾“å…¥ç”¨æˆ·åå¯†ç çš„ï¼Œä½†æ˜¯å‡ å¹´æœ‰æ‰€å˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ apitoken ä¸Šä¼ ã€‚ å¯ä»¥ç‚¹å‡»å‰å¾€ https://pypi.org/manage/account/ æ–°å»ºä¸€ä¸ª apitokenï¼Œç„¶åæ–°å»ºä¸ª ~/.pypirc [distutils] index-servers=pypi[pypi] repository: https://upload.pypi.org/legacy/ username = __token__ password = pypi-xxxx-xxx source ~/.pypirc ç„¶åä¸Šä¼ å°±è¡Œï¼ŒæˆåŠŸä¸Šä¼ åå°±å¯ä»¥åœ¨pypiè´¦æˆ·ä¸‹çœ‹åˆ°è‡ªå·±çš„é¡¹ç›® https://pypi.org/manage/projects/äº†ï¼Œå¯ä»¥ install åä½¿ç”¨äº†ã€‚","tags":["python"],"categories":["python"]},{"title":"vueæ·±åº¦é€‰æ‹©å™¨-å­ç»„ä»¶æ ·å¼","path":"/2024/01/28/506/","content":"vue æ¯æ¬¡ç¼–è¯‘åçš„ class å¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œnameè¿™ç§æƒ…å†µï¼Œæ€ä¹ˆå»ä¿®æ”¹ CSS å‘¢ï¼Ÿ å•ç‹¬åŠ ä¸ª class è®¾ç½® ä½¿ç”¨ deep .bg-greg :deep(.van-grid-item__content)&#123; background: #bbb;&#125;","tags":["vue"],"categories":["debug"]},{"title":"MySQLå¤§é‡æ•°æ®insertå¤±è´¥çš„é—®é¢˜","path":"/2024/01/19/505/","content":"æ˜¨å¤©å¤„ç†æ•°æ®å‘ç°ï¼Œæœ‰ä¸ªè¡¨çš„ä¸»é”®æ˜¯VARCHARç±»å‹ï¼Œæ•°æ®é‡è¶…ä¸€äº¿ï¼Œä¸æ–¹ä¾¿éå†ï¼Œåˆ ä¸»é”®å†åŠ ä¸»é”®æ“ä½œè¶…æ—¶ï¼Œæç¤ºå»ºè®®å»ºä¸ªæ–°è¡¨ï¼Œç„¶å insertã€‚ ä¸‹é¢æ˜¯æˆ‘çš„æ­¥éª¤: æ–°å»ºè¡¨ï¼š CREATE TABLE `sai_new` ( `id` BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY, `fid` VARCHAR(20) NOT NULL, `xxx` VARCHAR(32) NOT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ROW_FORMAT=COMPRESSED; æ’å…¥æ•°æ®ï¼š INSERT INTO `sai_new` (`fid`, `xxx`, `live_city`) SELECT `id`, `xxx`, `live_city` FROM `sai_13_old`; è¿™æ­¥å¾ˆæ…¢ï¼Œæœ€åç›´æ¥æŠ¥é”™ã€‚ ERROR 1206 (HY000): The total number of locks exceeds the lock table size SHOW VARIABLES LIKE &#x27;innodb_buffer_pool_size&#x27;;+-------------------------+-------------+| Variable_name | Value |+-------------------------+-------------+| innodb_buffer_pool_size | 134217728 |+-------------------------+-------------+1 row in set (0.08 sec) è°ƒå¤§ï¼š SET GLOBAL innodb_buffer_pool_size = 13421772800; çœ‹ä¸‹æœ‰æ²¡æœ‰æ”¹æˆåŠŸ: å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥è¿™æ ·ã€‚12.5Gï¼Œå¢å¤§ä¸ºåŸæ¥çš„100å€ã€‚ SELECT @@innodb_buffer_pool_size/1024/1024/1024;+------------------------------------------+| @@innodb_buffer_pool_size/1024/1024/1024 |+------------------------------------------+| 12.500000000000 |+------------------------------------------+1 row in set (0.26 sec) ç»§ç»­ insert, å¥–åŠ±äº†2å°æ—¶45åˆ†36ç§’åï¼Œæ•°æ®è¿ç§»æˆåŠŸã€‚ è¯è¯´è¿™ç£ç›˜å†™å…¥ä¹Ÿæ˜¯çœŸçš„æ…¢ã€‚ innodb_buffer_pool_sizeinnodb_buffer_pool_size æ˜¯ç¼“å†²æ± å¤§å°ï¼Œå¿…é¡»å§‹ç»ˆç­‰äº innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances æˆ–å…¶å€æ•°ã€‚ä¸»è¦å½±å“è¯»ï¼Œä¸”è¦æ³¨æ„è¿™ä¸ªå‚æ•°å¢å¤§ä¼šå¢å¤§å†…å­˜å ç”¨ã€‚ æ›´å¤šçœ‹æ‰‹å†Œï¼š 15.8.3.1 Configuring InnoDB Buffer Pool Size","tags":["mysql"],"categories":["MySQL"]},{"title":"issues python3","path":"/2023/12/01/501/","content":"Just for record python3 pip install timeout pip3 install lxml raise ReadTimeoutError(self._pool, None, &quot;Read timed out.&quot;) pip._vendor.urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host=&#39;files.pythonhosted.org&#39;, port=443): Read timed out. pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple lxml â€˜intâ€™ object does not support indexingpgsql = &quot;&quot;&quot;SELECT id, employee_count FROM companyWHERE id = %s&quot;&quot;&quot;pg_cursor.execute(pgsql, (row[&quot;member_id&quot;])) pg_cursor.execute(pgsql, (row[â€œmember_idâ€],)) not all arguments converted during string formattingIncorrect number of arguments most likely due to a circular importpython3 marisa_trie.pyTraceback (most recent call last): File â€œ/Users/sai/Documents/user-sai/ignore/marisa_trie.pyâ€, line 1, in import marisa_trie File â€œ/Users/sai/Documents/user-sai/ignore/marisa_trie.pyâ€, line 3, in trie = marisa_trie.Trie([uâ€™key1â€™, uâ€™key2â€™, uâ€™key12â€™])AttributeError: partially initialized module â€˜marisa_trieâ€™ has no attribute â€˜Trieâ€™ (most likely due to a circular import) rename filename to another name","tags":["python"],"categories":["python"]},{"title":"python3åˆå¹¶listå¹¶å»é‡","path":"/2023/11/24/500/","content":"æœ€ç®€å•çš„æ˜¯éå†ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚ä¸‹é¢ä»‹ç»è½¬æˆset æ–¹æ³• è½¬æˆ setproduct_id_list = [&#x27;10047&#x27;, &#x27;8156&#x27;, &#x27;10788&#x27;, &#x27;12&#x27;]current = [&#x27;1&#x27;, &#x27;200&#x27;, &#x27;10047&#x27;, &#x27;34&#x27;]product_id_list.extend(current)print(&#x27;,&#x27;.join(set(product_id_list)))# ä¹Ÿå¯ä»¥è¿™æ ·å†™product_ids = &#x27;,&#x27;.join((item) for item in set(product_id_list))print(product_ids)","tags":["python"],"categories":["python"]},{"title":"ä½¿ç”¨mpdfç”Ÿæˆpdf","path":"/2023/11/07/490/","content":"html ç”Ÿæˆ pdf æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ï¼Œæœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ mpdfã€‚ å¯¹äºå¦‚ä½•å¯»æ‰¾éœ€è¦çš„åº“ï¼Œæˆ‘ä¸€èˆ¬æ˜¯ github ä¸ŠæŒ‰è¯­è¨€å»æœç´¢ï¼Œç”¨starå€’åºæ’ï¼Œä¸€èˆ¬ä¼šå°è¯•ç”¨å‰é¢å‡ ä¸ªä¸”æ¯”è¾ƒæ´»è·ƒçš„é¡¹ç›®ï¼Œç„¶åçœ‹æ•ˆæœä¸éœ€æ±‚åŒ¹é…åº¦ã€‚ å®‰è£…å¿…é¡»å¼€å¯ PHP mbstring å’Œ gd æ‰©å±•ã€‚æŸäº›é«˜çº§åŠŸèƒ½å¯èƒ½éœ€è¦é¢å¤–çš„æ‰©å±•ï¼Œä¾‹å¦‚ç”¨äºå‹ç¼©è¾“å‡ºå’ŒåµŒå…¥èµ„æºï¼ˆä¾‹å¦‚å­—ä½“ï¼‰çš„ zlib ã€ç”¨äºç”Ÿæˆæ¡å½¢ç çš„ bcmath æˆ–ç”¨äºå­—ç¬¦é›†çš„ xml è½¬æ¢å’Œ SVG å¤„ç†ã€‚ ä½¿ç”¨ composer å®‰è£…å³å¯ã€‚ composer require mpdf/mpdf ä½¿ç”¨$mpdf = new \\Mpdf\\Mpdf([ &#x27;autoScriptToLang&#x27; =&gt; true, &#x27;autoLangToFont&#x27; =&gt; true]);$html = &#x27;&lt;div style=&quot;margin: 0 auto; width: 600px; padding: 40px 20px; font-size: 20px;&quot;&gt;&lt;div style=&quot;font-size: 50px; padding: 16px 0; text-align: center; color: red; font-weight: 900; border-bottom: 4px solid red;&quot;&gt; è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•pdf&lt;/div&gt;&lt;div style=&quot;line-height: 40px; margin-top: 30px; height: 500px; margin-top: 30px; letter-spacing: 2px;&quot;&gt; &lt;p style=&quot;text-indent: 2em; &quot;&gt; æ„Ÿè°¢puresaiçš„å¤§åŠ›æ”¯æŒï¼ &lt;/p&gt;&lt;/div&gt;&lt;div style=&quot;height: 40px; text-align: right; letter-spacing: 2px;&quot;&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 32px; text-align: right; letter-spacing: 1px;&quot;&gt;&#x27;. date(&#x27;Yå¹´mæœˆdæ—¥&#x27;).&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;;$mpdf-&gt;WriteHTML($html);$path = dirname(__DIR__).&#x27;/public/pdf/puresai.pdf&#x27;;$mpdf-&gt;OutputFile($path); ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ¥çœ‹ä¸€ä¸‹æ•ˆæœã€‚ æ„Ÿè°¢ https://github.com/mpdf/mpdf","tags":["php"],"categories":["php"]},{"title":"python3å‘é€slacké€šçŸ¥","path":"/2023/10/04/497/","content":"from slack_sdk import WebClientfrom slack_sdk.errors import SlackApiErrorToken = &quot;xoxb-xx-xx-xxx&quot;client = WebClient(token=Token)channel_id = &quot;xxx&quot;try: result = client.chat_postMessage(channel=channel_id, text=&quot;Hello!&quot;) print(result)except SlackApiError as e: print(f&quot;Error: &#123;e&#125;&quot;)","tags":["python"],"categories":["python"]},{"title":"ä¼ä¸šå¾®ä¿¡å®¡æ‰¹æ¥å£è¸©å‘","path":"/2023/09/11/496/","content":"æˆ‘å¯¹æ¥çš„æ˜¯ä¼ä¸šå†…éƒ¨åº”ç”¨çš„apiã€‚ å¯¹æ¥æœ‰å‡ ç‚¹è¦æ³¨æ„ï¼š ä¸ä½¿ç”¨åº”ç”¨çš„æ¨¡æ¿ï¼Œè²Œä¼¼æ˜¯ä¸ªé˜‰å‰²ç‰ˆ å®¡æ‰¹æ¨¡æ¿è¦é¢„å…ˆè®¾ç½®ï¼Œå¯¹äºæœåŠ¡ç«¯apiå¯¹æ¥æ¥è¯´ï¼Œä¸èƒ½ä¿®æ”¹ï¼Œå¦‚æœæ˜¯jssdkè°ƒç”¨å®¡æ‰¹æµç¨‹å¼•æ“ï¼Œå¯ä»¥è‡ªå®šä¹‰æµç¨‹ å®¡æ‰¹å›è°ƒè®¾ç½®æ—¶ï¼Œéœ€è¦å…ˆéªŒè¯ä¸€ä¸‹ï¼ŒéªŒè¯èµ°çš„æ˜¯GETè¯·æ±‚ï¼Œä¸æ˜¯POSTè¯·æ±‚ æœ‰é—®é¢˜ç¤¾åŒºæé—®ï¼Œç¤¾åŒºçš„å®˜æ–¹å›ç­”è¿˜æ˜¯éå¸¸å¿«çš„ å®¡æ‰¹åº”ç”¨å¯ä»¥å•ç‹¬è®¾ç½®åˆ†çº§ç®¡ç†å‘˜ å®¡æ‰¹å¯è§èŒƒå›´è¦æ³¨æ„ï¼Œä¸èƒ½è®¾ç½®çš„æ¯”æ¨¡æ¿å¯è§èŒƒå›´è¿˜å°","tags":["php"],"categories":["php"]},{"title":"python3å®ç°bitmap","path":"/2023/08/11/492/","content":"æˆ‘å·²ç»å°è£…ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ import unittestfrom utilset import Bitmapclass TestBitmap(unittest.TestCase): def test_bitmap(self): bm = Bitmap.Bitmap(10) bm.set(2) bm.set(7) self.assertTrue(bm.test(2)) self.assertFalse(bm.test(3))if __name__ == &quot;__main__&quot;: unittest.main() æºç ï¼š import arrayclass BitMap(object): BITMASK = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80] BIT_CNT = [bin(i).count(&quot;1&quot;) for i in range(256)] def __init__(self, maxnum=0): nbytes = (maxnum + 7) // 8 self.bitmap = array.array(&quot;B&quot;, [0 for i in range(nbytes)]) def __del__(self): pass def set(self, pos): &quot;&quot;&quot; Set the value of bit@pos to 1 &quot;&quot;&quot; self.bitmap[pos // 8] |= self.BITMASK[pos % 8] def reset(self, pos): &quot;&quot;&quot; Reset the value of bit@pos to 0 &quot;&quot;&quot; self.bitmap[pos // 8] &amp;= ~self.BITMASK[pos % 8] def flip(self, pos): &quot;&quot;&quot; Flip the value of bit@pos &quot;&quot;&quot; self.bitmap[pos // 8] ^= self.BITMASK[pos % 8] def count(self): &quot;&quot;&quot; Count bits set &quot;&quot;&quot; return sum([self.BIT_CNT[x] for x in self.bitmap]) def size(self): &quot;&quot;&quot; Return size &quot;&quot;&quot; return len(self.bitmap) * 8 def test(self, pos): &quot;&quot;&quot; Return bit value &quot;&quot;&quot; return (self.bitmap[pos // 8] &amp; self.BITMASK[pos % 8]) != 0 def any(self): &quot;&quot;&quot; Test if any bit is set &quot;&quot;&quot; return self.count() &gt; 0 def none(self): &quot;&quot;&quot; Test if no bit is set &quot;&quot;&quot; return self.count() == 0 def all(self): &quot;&quot;&quot; Test if all bits are set &quot;&quot;&quot; return (self.count() + 7) // 8 * 8 == self.size() def nonzero(self): &quot;&quot;&quot; Get all non-zero bits &quot;&quot;&quot; return [i for i in range(self.size()) if self.test(i)] def tostring(self): &quot;&quot;&quot; Convert BitMap to string &quot;&quot;&quot; return &quot;&quot;.join([(&quot;%s&quot; % bin(x)[2:]).zfill(8) for x in self.bitmap[::-1] ]) def __str__(self): &quot;&quot;&quot; Overloads string operator &quot;&quot;&quot; return self.tostring() def __getitem__(self, item): &quot;&quot;&quot; Return a bit when indexing like a array &quot;&quot;&quot; return self.test(item) def __setitem__(self, key, value): &quot;&quot;&quot; Sets a bit when indexing like a array &quot;&quot;&quot; if value is True: self.set(key) elif value is False: self.reset(key) else: raise Exception(&quot;Use a boolean value to assign to a bitfield&quot;) def tohexstring(self): &quot;&quot;&quot; Returns a hexadecimal string &quot;&quot;&quot; val = self.tostring() st = &quot;&#123;0:0x&#125;&quot;.format(int(val, 2)) return st.zfill(len(self.bitmap) * 2) @classmethod def fromhexstring(cls, hexstring): &quot;&quot;&quot; Construct BitMap from hex string &quot;&quot;&quot; bitstring = format( int(hexstring, 16), &quot;0&quot; + str(len(hexstring) / 4) + &quot;b&quot;) return cls.fromstring(bitstring) @classmethod def fromstring(cls, bitstring): &quot;&quot;&quot; Construct BitMap from string &quot;&quot;&quot; nbits = len(bitstring) bm = cls(nbits) for i in range(nbits): if bitstring[-i - 1] == &quot;1&quot;: bm.set(i) elif bitstring[-i - 1] != &quot;0&quot;: raise Exception(&quot;Invalid bit string!&quot;) return bm å‚è€ƒï¼š https://github.com/wanji/bitmap","tags":["python"],"categories":["python"]},{"title":"è§£å†³ç§»åŠ¨ç«¯ç‚¹å‡»æ”¾å¤§å‡ºç°xè½´æ»šåŠ¨æ¡é—®é¢˜","path":"/2023/08/02/492/","content":"æµ‹è¯•ä¸€ä¸ªç§»åŠ¨ç«¯é¡¹ç›®æ—¶ï¼Œç‚¹å‡»è¾“å…¥æ¡†å‡†å¤‡è¾“å…¥æ—¶ï¼Œå´æ”¾å¤§åˆ‡å‡ºç°xè½´æ–¹å‘çš„å›ºå®šæ¡ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ è§£å†³å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸€è¡Œ meta å£°æ˜ã€‚ &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0&quot;&gt; è¿™è¡Œ meta æ ‡ç­¾çš„ä½œç”¨æ˜¯è®©å½“å‰viewportçš„å®½åº¦ç­‰äºè®¾å¤‡çš„å®½åº¦ï¼ŒåŒæ—¶ä¸å…è®¸ç”¨æˆ·æ‰‹åŠ¨ç¼©æ”¾è¿™æ ·å°±ä¸ä¼šå‡ºç°æ¨ªå‘æ»šåŠ¨æ¡ã€‚ å±æ€§è¯´æ˜ width: æ§åˆ¶ viewport çš„å¤§å°ï¼Œå¯ä»¥æŒ‡å®šçš„ä¸€ä¸ªå€¼æˆ–è€…ç‰¹æ®Šçš„å€¼ï¼Œå¦‚ device-width ä¸ºè®¾å¤‡çš„å®½åº¦ï¼ˆå•ä½ä¸ºç¼©æ”¾ä¸º 100% æ—¶çš„ CSS çš„åƒç´ ï¼‰ã€‚ height: å’Œ width ç›¸å¯¹åº”ï¼ŒæŒ‡å®šé«˜åº¦ã€‚ initial-scale: åˆå§‹ç¼©æ”¾å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œæ˜¯é¡µé¢å¤§å°çš„ä¸€ä¸ªä¹˜æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®åˆå§‹ç¼©æ”¾ä¸º 1.0ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢ä¸ç¼©æ”¾ã€‚ maximum-scale:æœ€å¤§ç¼©æ”¾ã€‚å³å…è®¸çš„æœ€å¤§ç¼©æ”¾ç¨‹åº¦ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæµ®ç‚¹å€¼ï¼Œç”¨ä»¥æŒ‡å‡ºé¡µé¢å¤§å°ä¸å±å¹•å¤§å°ç›¸æ¯”çš„æœ€å¤§ä¹˜æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å°†è¿™ä¸ªå€¼è®¾ç½®ä¸º2.0ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡µé¢æœ€å¤šèƒ½æ”¾å¤§2å€ã€‚ minimum-scale:æœ€å°ç¼©æ”¾ã€‚å³å…è®¸çš„æœ€å°ç¼©æ”¾ç¨‹åº¦ã€‚ç±»æ¯” maximum-scale user-scalable:ç”¨æˆ·è°ƒæ•´ç¼©æ”¾ã€‚å³ç”¨æˆ·æ˜¯å¦èƒ½æ”¹å˜é¡µé¢ç¼©æ”¾ç¨‹åº¦ã€‚å¦‚æœè®¾ç½®ä¸ºyesåˆ™æ˜¯å…è®¸ç”¨æˆ·å¯¹å…¶è¿›è¡Œæ”¹å˜ï¼Œåä¹‹ä¸ºnoã€‚é»˜è®¤å€¼æ˜¯yesã€‚ä¹Ÿå¯ä»¥æ˜¯0å’Œ1ã€‚æ³¨æ„ï¼šå¦‚æœä½ å°†å…¶è®¾ç½®ä¸ºnoï¼Œé‚£ä¹ˆminimum-scale å’Œ maximum-scaleéƒ½å°†è¢«å¿½ç•¥ï¼Œå› ä¸ºæ ¹æœ¬ä¸å¯èƒ½ç¼©æ”¾ã€‚ å¦å¤–ï¼š target-densitydpi:å€¼å¯ä»¥ä¸ºä¸€ä¸ªæ•°å€¼æˆ– high-dpi ã€ medium-dpiã€ low-dpiã€ device-dpi è¿™å‡ ä¸ªå­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªã€‚å®‰å“ä¸­æ”¯æŒï¼Œå½“ target-densitydpi=device-dpi æ—¶ï¼Œ cssä¸­çš„1pxä¼šç­‰äºç‰©ç†åƒç´ ä¸­çš„1pxã€‚ å‚è€ƒ ç¦æ­¢ç§»åŠ¨ç«¯safariæµè§ˆå™¨åŒå‡»æ”¾å¤§äº‹ä»¶ ç§»åŠ¨ç«¯é€‚é…ä¹‹ä¸‰ï¼šä½¿ç”¨metaæ ‡ç­¾è®¾ç½®viewport","tags":["web"],"categories":["web"]},{"title":"Vantå¤šå›¾å‹ç¼©åä¸Šä¼ çš„è§£å†³è¿‡ç¨‹","path":"/2023/07/25/491/","content":"å‰ä¸€é˜µç”¨ Vant å†™ä¸€ä¸ªé¡¹ç›®ï¼Œé‡åˆ°å¤šå›¾å‹ç¼©ä¸Šä¼ çš„é—®é¢˜ï¼Œä»Šå¤©å°±è§£å†³è¿‡ç¨‹åšä¸€ä¸ªç®€å•çš„åˆ†äº«ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ ä½¿ç”¨ van-uploader ç»„ä»¶&lt;van-uploader v-model=&quot;images&quot; multiple :after-read=&quot;afterRead&quot; upload-icon=&quot;plus&quot; /&gt; afterRead å®ç°ä¸Šä¼ æ“ä½œï¼Œå¯¹åº”çš„åç«¯ä»£ç è¾ƒç®€å•ï¼Œæˆ‘è¿™é‡Œå°±çœç•¥äº†ï¼ˆå…¶å®å°±æ˜¯è¿”å›çŠ¶æ€å’Œåœ°å€ï¼‰ã€‚è¿™é‡Œä¸ºäº†æ•ˆæœï¼Œå¢åŠ äº†ä¸Šä¼ ä¸­ï¼Œä¸Šä¼ æˆåŠŸè¿™äº›çŠ¶æ€ã€‚ const afterRead = (file) =&gt; &#123; if (file instanceof Array) &#123; file.forEach((v, i) =&gt; &#123; v.status = &#x27;uploading&#x27;; v.message = &#x27;ä¸Šä¼ ä¸­...&#x27;; uploadImage(v.file).then((res)=&gt;&#123; ... v.status = &#x27;success&#x27;; v.message = &#x27;ä¸Šä¼ æˆåŠŸ&#x27;; &#125;).catch((err) =&gt; &#123; v.status = &#x27;failed&#x27;; v.message = &#x27;ä¸Šä¼ å¤±è´¥&#x27;; &#125;) &#125;) &#125; else &#123; file.status = &#x27;uploading&#x27;; file.message = &#x27;ä¸Šä¼ ä¸­...&#x27;; uploadImage(file.file).then((res)=&gt;&#123; console.log(res) ... file.status = &#x27;success&#x27;; file.message = &#x27;ä¸Šä¼ æˆåŠŸ&#x27;; &#125;).catch((err) =&gt; &#123; file.status = &#x27;failed&#x27;; file.message = &#x27;ä¸Šä¼ å¤±è´¥&#x27;; &#125;) &#125;&#125; å‹ç¼©å‹ç¼©å…¶å®å¯ä»¥åç«¯å®ç°ï¼Œä¹Ÿå¯ä»¥å‰ç«¯å‹ç¼©åä¸Šä¼ ï¼Œè¿˜å¯ä»¥ç¬¬ä¸‰æ–¹sdkï¼Œè¿™é‡Œä¸ºäº†ç®€å•ï¼ˆæˆæœ¬ï¼‰ï¼Œç›´æ¥é€‰æ‹©å‰ç«¯å‹ç¼©åä¸Šä¼ ã€‚ å‰ç«¯å‹ç¼©å¯ä»¥è‡ªå·±å®ç°ï¼Œæˆ‘çš„js æ°´å¹³ä¸€èˆ¬èˆ¬ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ç°æˆçš„ compressorjsï¼Œè¿™ä¹Ÿæ˜¯ Vant æ¨èä½¿ç”¨çš„ã€‚ ç…§ç€å®˜ç½‘çš„ä¾‹å­ï¼Œæˆ‘ä»¬å‘ç° before-read æ”¯æŒè¿”å› Promiseã€‚ const beforeRead = (file) =&gt; new Promise(resolve =&gt; &#123; new Compressor(file, &#123; strict: false, quality: 0.6, // å‹ç¼©è´¨é‡ maxWidth: 1980, // æœ€å¤§å®½åº¦ maxHeight: 1980, convertTypes: [&#x27;image/jpeg&#x27;], // è½¬æ¢æ ¼å¼ convertSize: 500000, // 500k æ–‡ä»¶ç±»å‹åŒ…å«åœ¨convertTypesåˆ—è¡¨ä¸­çš„æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶å¤§å°è¶…è¿‡æ­¤å€¼çš„æ–‡ä»¶å°†è¢«è½¬æ¢ä¸ºjpegã€‚ success: resolve, error(err) &#123; showFailToast(err.message); &#125;, &#125;); &#125;); æµ‹è¯•ä¸Šä¼ å•å¼ ï¼Œæ²¡æ¯›ç—…ã€‚ä¸Šä¼ å¤šå¼ å°±å‘ç°æ…¢å¾—å¾ˆï¼Œä¸ºå•¥æ…¢ï¼Ÿä¸€æ˜¯æ²¡å‹ç¼©ï¼ŒäºŒæ˜¯æˆ‘çš„å¸¦å®½å°ã€‚ è§£å†³è¿™é‡Œæ˜¯å› ä¸ºå¤šå¼ ä¸Šä¼ ï¼Œfile å…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ²¡ç»è¿‡å‹ç¼©ã€‚ é‚£æˆ‘æƒ³ï¼Œé‚£è¡Œï¼Œé‚£æˆ‘å°±åˆ¤æ–­ä¸€ä¸‹ï¼š if (Array.isArray(file)) &#123; let compressPromises = []; file.forEach(function(v)&#123; compressPromises.push(new Promise(resolve =&gt; &#123; new Compressor(file, &#123; strict: false, quality: 0.6, maxWidth: 1980, maxHeight: 1980, convertTypes: [&#x27;image/jpeg&#x27;], convertSize: 500000, success: resolve, error(err) &#123; showFailToast(err.message); &#125;, &#125;); &#125;)); &#125;) return compressPromises&#125; else &#123; return new Promise(resolve =&gt; &#123; new Compressor(file, &#123; strict: false, quality: 0.6, maxWidth: 1980, maxHeight: 1980, convertTypes: [&#x27;image/jpeg&#x27;], convertSize: 500000, success: resolve, error(err) &#123; showFailToast(err.message); &#125;, &#125;); &#125;)&#125; æµ‹è¯•ä¸€æ³¢ï¼Œ åŸå›¾2.5Mï¼Œè¿™é‡Œè¿˜æ˜¯2Må¤šã€‚è¿™åˆæ˜¯ä¸ºæ¯›ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ before-read ç¡®å®æ”¯æŒè¿”å› Promiseï¼Œä½†æˆ‘ä»¬ä¸Šé¢çš„compressPromiseså¹¶ä¸æ˜¯ Promiseï¼Œè€Œæ˜¯ä¸€ä¸ª Promise æ•°ç»„ã€‚ ç»§ç»­æ”¹ï¼Œæ€ä¹ˆæŠŠè¿™äº› Promise åˆèµ·æ¥å‘¢ï¼Ÿ æŸ¥çœ‹Promise æ–‡æ¡£ï¼Œæœ‰è¿™ä¸ªæ–¹æ³• Promise.all() ã€‚ ç»§ç»­æ”¹ï¼š æ—¢ç„¶é€šç”¨ï¼Œæˆ‘ä»¬ä¸å¦¨ç¨å¾®å°è£…ä¸‹ã€‚ import Compressor from &#x27;compressorjs&#x27;import &#123; showFailToast &#125; from &#x27;vant&#x27;function compressorOne(file)&#123; return new Promise(resolve =&gt; &#123; new Compressor(file, &#123; strict: false, quality: 0.6, maxWidth: 1980, maxHeight: 1980, convertTypes: [&#x27;image/jpeg&#x27;], convertSize: 500000, success: resolve, error(err) &#123; showFailToast(err.message); &#125;, &#125;); &#125;)&#125;export function compressor(file)&#123; if (Array.isArray(file)) &#123; let compressPromises = []; file.forEach(function(v)&#123; compressPromises.push(compressorOne(v)); &#125;) return Promise.all(compressPromises) &#125; else &#123; return compressorOne(file) &#125;&#125; beforeRead è¿™é‡Œç›´æ¥è°ƒç”¨å°è£…çš„ compressor const beforeRead = (file) =&gt; &#123; return compressor(file)&#125; æµ‹è¯•ã€‚ å¯ä»¥çœ‹åˆ° size ç¡®å®æ¯”ä¹‹å‰å°äº†å¾ˆå¤šï¼Œåªæœ‰200käº†ã€‚ PS: å¯¹äº compressorjs çš„å‚æ•°å¯ä»¥æŒ‰éœ€è°ƒæ•´ æ€»ç»“è¿™é‡Œå…¶å®è´¹æ—¶é—´çš„ä¸»è¦æ˜¯å¤šå›¾å‹ç¼©çš„å°è£…ï¼Œå…¶ä»–éƒ½ä¸æ€ä¹ˆè´¹äº‹ã€‚é‡åˆ°é—®é¢˜ï¼Œå¦‚æœæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œæˆ‘çš„å»ºè®®æ˜¯å…ˆå»æœç´¢ï¼Œæœç´¢æœ‰ä¸¤å—ï¼Œä¸€å—æµè§ˆå™¨ï¼Œä¸€å—æ˜¯ github é¡¹ç›®çš„ issueã€‚ä¸€èˆ¬éƒ½èƒ½æ‰¾åˆ°ç­”æ¡ˆï¼Œä½†ä¹Ÿå¯èƒ½å¹¶ä¸èƒ½è§£å†³ï¼Œæˆ‘ä»¬å°±è‡ªå·±æŸ¥æ‰¾æ–‡æ¡£ç”šè‡³é˜…è¯»æºç ã€‚å‰©ä¸‹å°±æ˜¯ä»£å…¥æµ‹è¯•ã€‚","tags":["vant"],"categories":["vant"]},{"title":"Pythonä¸­stripå¤šå­—ç¬¦æ…é‡ä½¿ç”¨","path":"/2023/07/22/490/","content":"Pythonä¸­stripï¼Œæ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œç»å¸¸ç”¨æ¥å»é™¤ç©ºæ ¼ï¼Œä½†æœ€è¿‘å‘ç°ä¸€ä¸ªå‘ï¼Œå¦‚æœæ˜¯å¤šå­—ç¬¦ä½¿ç”¨stripï¼Œåƒä¸‡æ…é‡ã€‚ çœ‹ä¾‹å­ï¼š &gt;&gt;&gt; str = &#x27;abc123abc&#x27;&gt;&gt;&gt; print(str.strip(&#x27;a&#x27;))bc123abc&gt;&gt;&gt; print(str.strip(&#x27;abc&#x27;))123&gt;&gt;&gt; print(str.strip(&#x27;ab&#x27;))c123abc&gt;&gt;&gt; print(str.strip(&#x27;cba&#x27;))123&gt;&gt;&gt; print(str.strip(&#x27;cc&#x27;))abc123ab&gt;&gt;&gt; print(str.strip(&#x27;ca&#x27;))bc123ab&gt;&gt;&gt; print(str.strip(&#x27;cbaass&#x27;))123 print(str.strip(&#39;cba&#39;)) è¿™ä¸ªè¿”å›123å°±æ¯”è¾ƒè¯¡å¼‚äº†ã€‚ å»ºè®®å»é™¤å¤šå­—ç¬¦è¿˜æ˜¯è€ƒè™‘ä½¿ç”¨ replace , strip ä¸é€‚åˆã€‚","tags":["python"],"categories":["python"]},{"title":"äººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾4","path":"/2023/05/28/484/","content":"æœ¬æ–‡æ˜¯æå®¢æ—¶é—´ä¸“æ ã€Šäººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾ã€‹çš„ç¬”è®°ã€‚ ç»†èŠ‚æ‰“ç£¨ ç»†èŠ‚çš„æŠ“å–å¿…é¡»æ¥æºäºè§‚å¯Ÿï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„æ–¹æ³•ã€‚ ç²¾ç¡®è”æƒ³ è”æƒ³å…±æƒ…çš„ç»†èŠ‚ è”æƒ³é‚£äº›è®©ä½ è§‰å¾—å¼‚å¸¸ã€ä¼šäº§ç”Ÿåå·®çš„ç»†èŠ‚ å€ŸåŠ©é“å…·è¿ç”¨äººç‰©ã€äº‹ä»¶èº«è¾¹ä¸ä¹‹å…³ç³»å¯†åˆ‡çš„ä¸œè¥¿ï¼Œæ¥å‡¸æ˜¾å®ƒçš„ç‰¹ç‚¹ã€‚ é€æ­¥ç»†åŒ–ç»†èŠ‚å°±æ˜¯è¦æŠŠæ¨¡ç³Šçš„å˜æˆå…·ä½“çš„ã€‚ æ³¨æ„äº‹é¡¹: è¯¦ç•¥å¾—å½“ ä¸è¦æ— ç”¨çš„ç»†èŠ‚ é£è¯é€ å¥åŸºæœ¬åŸåˆ™æ˜¯ï¼šè¦æ­£ç¡®åœ°ä½¿ç”¨è¯­æ³•ã€å¥æ³•å’Œè¯è¯­ï¼Œä¸è¦å‡ºç°ç—…å¥ä¸é”™å¥ã€‚ åŸºæœ¬æ–¹æ³•æ˜¯ï¼šåŸ¹å…»è¯­æ„Ÿã€‚ è¯è¯­ï¼š ç²¾ç¡®å‡ç»ƒï¼ˆä¿®é¥°å°½å¯èƒ½æ˜¯ä¸ºäº†ä¸»é¢˜æœåŠ¡ï¼Œèƒ½çœåˆ™çœï¼‰ åŠ¨æ€æ„Ÿè¡¨è¾¾ å¥å¼ï¼š è¯­å¥é¡ºåº æ‰“ç ´å¸¸è§„ï¼ˆè®©å¥å­æœ‰å¿«æœ‰æ…¢ï¼Œè®©å¥å­æœ‰ä¸åŒçš„è§†è§’ã€‚ï¼‰ æœ‰æ•ˆä¿®æ”¹ä¸‰æ­¥ä¿®æ”¹æ³•ï¼š å…ˆå¢åå‡å®è§‚æŠŠæ¡å…¨ç¯‡ï¼Œæ³¨æ„å™è¿°è·ç¦»ã€‚ ä¸¤ä¸ªè§†è§’ï¼š å†…éƒ¨è§†è§’ï¼ˆå‘ˆç°ï¼‰ æ¦‚è¿°æ€§è§†è§’ï¼ˆè¡¨å•ï¼‰è®ºæ®å¤„ç† è¿è´¯æ€§ å¯»æ‰¾é‚£äº›ç»†å°è€Œå¤šä½™çš„ç»“æ„ï¼Œæ‰¾ä¸œè¥¿æ›¿æ¢å®ƒæˆ–è€…åˆ æ‰å®ƒã€‚ è®¾è®¡ä¸€ä¸ªå¥½çš„è·¯æ ‡ï¼Œå½“ç„¶ï¼Œå¦‚æœè¿™ä¸ªè·¯æ ‡æ²¡æœ‰æ„ä¹‰ï¼Œé‚£å°±ä¸è¦ç”¨å®ƒã€‚ ä¿®æ”¹æ–‡ç« çš„æ—¶å€™ï¼Œä½ ä¸€å®šè¦è¯»å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥é»˜å¿µã€‚è¦çŸ¥é“ï¼Œè¯­æ„Ÿå¯ä»¥æå¤§é™åº¦åœ°å¸®åŠ©ä½ çš„ä¿®æ”¹ã€‚","tags":["reading"],"categories":["reading"]},{"title":"äººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾3","path":"/2023/05/07/483/","content":"æœ¬æ–‡æ˜¯æå®¢æ—¶é—´ä¸“æ ã€Šäººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾ã€‹çš„ç¬”è®°ã€‚ å¼€ç¯‡åˆ¶èƒœå¯»æ‰¾ç¥ç§˜æˆ–å†²çªå“ªäº›é—®é¢˜æ˜¯è¯»è€…æœ€å…³å¿ƒçš„ï¼Œå“ªäº›å› ç´ æ˜¯æœ€èƒ½è®©ä»–ä»¬æœ‰ä»£å…¥æ„Ÿçš„ã€‚ç¡®å®šæœ€ç²¾å½©çš„å…ƒç´ ã€‚ ä¸‰æ­¥èµ° è®°å½•æœ€ç¥ç§˜ã€å†²çªçš„éƒ¨åˆ† æ‹†åˆ†è¿™ä¸ªéƒ¨åˆ†ï¼Œæ‹†åˆ†æˆä»»åŠ¡ã€äº‹ä»¶ã€åœ°ç‚¹ã€æ—¶é—´ç­‰ï¼Œæ‰¾å‡ºå…¶ä¸­1-2ä¸ªå°å…ƒç´ æ”¾å¤§ ä¸ºè¿™äº›æ”¾å¤§çš„ç‰¹è´¨å»ºç«‹ç”»é¢ ä¸¤ç§å¼€å¤´æ¨¡å¼ ç»¼è¿°å‹ è°¢æ¢¦é¥ã€Šå›½ç‹åœ¨é¢†åœ°ã€‹ ç»†èŠ‚å‹ ã€Šå¤–å–éª‘æ‰‹ï¼Œå›°åœ¨ç³»ç»Ÿé‡Œã€‹ ç”ŸåŠ¨å™äº‹å™è¿°èŠ‚å¥éƒè¾¾å¤«ã€Šæ•…éƒ½çš„ç§‹ã€‹ é€Ÿåº¦æ„Ÿ â€“ æ˜¯é€šè¿‡çŸ­å¥ã€ç®€å•å¥å¼æ¥å®ç°çš„ã€‚ç›¸åï¼Œå¦‚æœä½ å†™çš„å¥å¼è¿‡äºå¤æ‚ï¼Œå®ƒå°±ä¼šæ‹–æ…¢ä½ çš„è¡¨è¾¾ã€‚ åŠ›é‡æ„Ÿ â€“ æ’æ¯”ï¼Œ è°ƒæ•´å¥å­çš„è¯­åºï¼ˆå…³é”®çš„è¯è¯­æ”¾åœ¨å¼€å¤´æˆ–è€…ç»“å°¾ï¼‰ å˜åŒ–æ„Ÿ â€“ å¥å¼å¥å‹çš„å˜åŒ– æ¨ç»§æ–Œã€Šå¯Œå£«åº·â€œå…«è¿è·³â€è‡ªæ€ä¹‹è°œã€‹ å™äº‹ç­–ç•¥ï¼ˆé€’è¿›ï¼‰ å¤šçº¿å™äº‹ ç”µè§†å‰§ã€Šæ²‰é»˜çš„çœŸç›¸ã€‹ ç¯çº¿å™äº‹ ç”µå½±ã€Šææ€–çš„é‚®è½®ã€‹ å¤šçº¿å™äº‹ï¼Œå®ƒçš„åº”ç”¨å¾ˆå¹¿æ³›ï¼Œå…³é”®æ˜¯è¦å›´ç»•ä¸»é¢˜ç¡®å®šä¸»çº¿ï¼›ç¯å½¢å™äº‹ï¼Œå®ƒæ¯”è¾ƒé€‚åˆé‚£ç§ï¼Œäº‹ä»¶æˆ–è€…äººç‰©éš¾ä»¥é€ƒè„±å®¿å‘½çš„é¢˜æï¼Œç”Ÿæ´»ä¸­ä¹Ÿå¾ˆå¸¸è§ã€‚ äººç‰©å‡ºåœºæœ€æ ¹æœ¬çš„æ–¹æ³•å°±æ˜¯è¦æœ‰ç¥ç§˜æ„Ÿã€è¦æœ‰å†²çª ä½¿ç”¨å¼•è¯­ åˆ¶ä½œæ‚¬å¿µ ç»†èŠ‚æå†™ ç¯å¢ƒæè¿° ã€Šçº¢æ¥¼æ¢¦ã€‹ç‹ç†™å‡¤çš„å‡ºåœº è¿›é˜¶ï¼š ä¸ä»…å¯ä»¥åˆ¶é€ æ‚¬å¿µï¼Œè¿˜å¯ä»¥åˆ¶é€ é”™è§‰å’Œå†²çªã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªå¸¸è§çš„å†™ä½œæŠ€å·§ï¼šç”¨ç¯å¢ƒæ˜­ç¤ºäººç‰©çš„å‘½è¿ï¼Œè®©ç¯å¢ƒä¸å‘½è¿ç›¸å‘¼åº”ï¼›è®©ä¸»è§’æ™šç™»åœºï¼Œä»è€Œé¿å…è¿™ä¸ªä¸»è§’ç»™è¯»è€…å¸¦æ¥çš„é™Œç”Ÿæ„Ÿã€‚ å¾®ä¿¡å…¬ä¼—å·å¾€äº‹å‰çƒ§çš„æ–‡ç« ã€Šå†¯å°åˆšç‹æœ”ä»¬çš„é»‘å†å²ã€‹å¶äº¬çš„å‡ºåœº","tags":["reading"],"categories":["reading"]},{"title":"äººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾2","path":"/2023/04/29/482/","content":"æœ¬æ–‡æ˜¯æå®¢æ—¶é—´ä¸“æ ã€Šäººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾ã€‹çš„ç¬”è®°ã€‚ å¦‚ä½•æ‰“é€ å¥½çš„å†™ä½œä¸»é¢˜ï¼Ÿä¼˜è´¨çš„è¾“å…¥æ˜¯è¾“å‡ºçš„åˆšéœ€ã€‚ æ‰“å¼€å®½åº¦ï¼šè·¨é¢†åŸŸæ€è€ƒï¼ˆå‘æ•£æ€ç»´ï¼‰ é€‚åˆäºå¼€æ”¾æ€§è¯é¢˜ ä¸åŒçš„åˆ†ç±»æ„å‘³ç€ä¸åŒçš„è§‚å¯Ÿè§†è§’ã€‚ æ”¿æ²»è§’åº¦ ç»æµè§’åº¦ æ–‡åŒ–è§’åº¦â€¦.. æŒ–æ˜æ·±åº¦ï¼šç”±è¡¨åŠé‡Œï¼ˆé€»è¾‘æ€ç»´ï¼‰ é€‚ç”¨äºå¯¹æŸä¸ªç°è±¡çš„åˆ†æï¼Œå…³é”®ç‚¹æ˜¯ç»†è‡´è§‚å¯Ÿ æ‰“å¼€å®½åº¦ï¼šè·¨é¢†åŸŸæ€è€ƒã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºå¼€æ”¾æ€§è®®é¢˜çš„å†™ä½œï¼Œæ¯”å¦‚å¥³æ€§è®®é¢˜ã€æ³•æ²»è®®é¢˜ç­‰ã€‚è¦æƒ³çœŸæ­£æŒæ¡è¿™ä¸ªæ–¹æ³•ï¼Œå¹³æ—¥é‡Œä¸€å®šè¦å¤šåŠ ç»ƒä¹ ï¼Œé”»ç‚¼è‡ªå·±çš„å‘æ•£æ€ç»´ã€‚ æŒ–æ˜æ·±åº¦ï¼šç”±è¡¨åŠé‡Œã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºåˆ†æç°è±¡çš„å†™ä½œï¼Œæ¯”å¦‚äº‹æ•…åŸå› ç­‰ç­‰ã€‚æŒæ¡è¿™ä¸ªæ–¹æ³•çš„å…³é”®åˆ™æ˜¯å¤šé—®ä¸ºä»€ä¹ˆï¼Œåœ¨æ¢ç©¶ç­”æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ”¶è·ã€‚ è°‹ç¯‡å¸ƒå±€ å¦‚ä½•ä¸ºä½ çš„æ–‡ç« æ‰¾åˆ°ä¸»å¿ƒéª¨ï¼Ÿ æ€ä¹ˆåœ¨ä¸»å¿ƒéª¨çš„åŸºç¡€ä¸Šé•¿å‡ºéª¨æ¶ï¼Ÿ æ€ä¹ˆå±•å¼€éª¨æ¶ï¼Ÿ ä¸»å¿ƒéª¨â€“ä¸€å¥è¯æ³•åˆ™ä¸€ä¸ªå¥å­æ¸…æ™°åœ°æ¦‚æ‹¬æ•´ç¯‡æ–‡ç« ã€‚å…ˆç¡®å®šä»·å€¼ï¼ˆæ‰¾å…³é”®è¯ï¼‰ï¼Œå†é«˜åº¦æ¦‚æ‹¬ã€‚ ä¸‰æ®µå¼ç»“æ„ è§¦å‘â€“å¯¼ç«ç´¢ å†²çªâ€“æ‰¾åˆ°çŸ›ç›¾ï¼Œè®©è¯»è€…å¯¹å†…å®¹äº§ç”Ÿè®¤åŒã€‚ è§£å†³â€“åˆ«å¿˜äº†æ ¹æ®è§£å†³éƒ¨åˆ†çš„å†…å®¹ï¼Œæƒ³å‡ºä¸€ä¸ªæœ‰éŸµå‘³çš„æ”¶å°¾ã€‚ å±•å¼€éª¨æ¶ æ—¶é—´ ç©ºé—´","tags":["reading"],"categories":["reading"]},{"title":"äººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾1","path":"/2023/04/25/481/","content":"æœ¬æ–‡æ˜¯æå®¢æ—¶é—´ä¸“æ ã€Šäººäººéƒ½ç”¨å¾—ä¸Šçš„å†™ä½œè¯¾ã€‹çš„ç¬”è®°ã€‚ å¦‚ä½•é˜…è¯»å¸®åŠ©å†™ä½œï¼Ÿ ä¼˜è´¨çš„è¾“å…¥æ˜¯è¾“å‡ºçš„åˆšéœ€ å†™ä½œæ˜¯å»ºç«‹åœ¨é˜…è¯»é‡çš„åŸºç¡€ä¸Šçš„ï¼Œä¸€å®šè¦å¤šçœ‹ã€‚ è¯»ä»€ä¹ˆï¼Ÿé˜…è¯»æ ‘ï¼š æ ¹ â€“ ç»å…¸ä½œå“ â€“ é¡ºåºæ˜¯å…ˆè¯»åŸºæœ¬åŸç†ï¼Œå†è¯»é€šå²ã€‚ï¼ˆä¸å±€é™ç‰¹å®šé¢†åŸŸï¼‰ æå¹² â€“ æœŸåˆŠã€è¡Œä¸šæ–°é—»ã€åˆ†ææŠ¥å‘Šã€æ”¿åºœå‘å¸ƒçš„ä¿¡æ¯ç­‰ å¶ â€“ è‡ªåª’ä½“ã€ç¤¾åª’ æ€ä¹ˆè¯»ï¼ŸåŒºåˆ†å¼é˜…è¯»ï¼š æ·±åº¦é˜…è¯» â€“ ç»å…¸ æ³›è¯» æç‚¼è§‚ç‚¹ï¼š ç†è§£è§‚ç‚¹ï¼ˆè¾¹è¯»è¾¹åˆ’é‡ç‚¹ï¼‰ å‰”é™¤é—®é¢˜ å­¦ä¼šè”æƒ³ è¿‡å»è¯»è¿‡çš„ è‡ªå·±æ›¾ç»çš„ä½“éªŒï¼Œæ„Ÿæ‚Ÿ æ­£åœ¨å‘ç”Ÿçš„äº‹ éšæ—¶è®°å½• æœ‰ç« æ³•ï¼ˆåˆ†ç±»ï¼šè§‚ç‚¹ã€è¡¨ç°æ‰‹æ³•ã€è‡ªæˆ‘æ„Ÿæƒ³ï¼‰ è®°å½•çµæ„Ÿ å¥½æ–‡ç« çš„æ ‡å¿— è¡Œæ–‡èŠ‚å¥ï¼šç®€å•å³ç¾ æ–‡å­—è¡¨è¿°ï¼šç¡®ä¿å‡†ç¡®ï¼Œå†çœ‹è¯è—» ä¸»é¢˜åˆ»ç”»ï¼šé²œæ˜ä¸å¦ï¼Œçªå‡ºä¸å¦ â€œä»¥æ­£åˆâ€ â€“ ç”¨è¯»è€…ç†Ÿæ‚‰çš„è§£è¯»æ–¹å¼ã€ç†Ÿæ‚‰çš„æ„è±¡å»è®²ä½ çš„ä¸»é¢˜ï¼Œâ€œä»¥å¥‡èƒœâ€ â€“ å¼ºè°ƒä½œè€…è‡ªå·±çš„æ€è€ƒï¼Œåˆ©ç”¨ä½ çš„ç‹¬ç‰¹è§‚å¯Ÿåˆ›é€ æ€§åœ°å»è§£é‡Šè¯»è€…æ²¡æœ‰æ³¨æ„åˆ°çš„ä¸œè¥¿ã€‚ å†™ä½œè¯¯åŒº åœ¨å…‹æœæ¶ä¹ ä¸Šï¼Œè¿Ÿåˆ°æ€»æ¯”ä¸åšå¼ºã€‚ æ»¥ç”¨å½¢å®¹è¯å’Œè¿è¯ æ»¥ç”¨ä¸ä»…æŒ‡ä½¿ç”¨å½¢å®¹è¯ä¸å‡†ç¡®ï¼Œè¿˜æœ‰å †ç Œå½¢å®¹è¯ ä¸æ»¥ç”¨ï¼Œä¸æ˜¯ä¸ç”¨ï¼Œè€Œæ˜¯ç”¨ç²¾å½“ æƒ³ä¸å‡ºæ¥ç²¾å‡†çš„å½¢å®¹è¯å°±ä¸è¦ç”¨ è¿è¯ç”¨å¾—è¿‡å¤šï¼Œä¼šå½±å“å¥å­çš„èŠ‚å¥å’Œç¾æ„Ÿ é™¤éé€»è¾‘è¡¨è¾¾å®¹æ˜“æ··æ·†ï¼Œå¦åˆ™ï¼Œæ…ç”¨è¿è¯ ä¸­è¥¿æ–‡åŒ– æ»¥ç”¨è¢«å­—å¥ï¼ˆä¸­æ–‡çš„æ­£å¸¸è¡¨è¾¾ï¼Œæ˜¯ä¸»è¯­ + åŠ¨è¯ + åè¯ï¼Œè¦æ”¹å˜å¥å¼é¡ºåºï¼Œä¸€å®šè¦æœ‰ç‰¹åˆ«çš„åŸå› ã€‚ï¼‰ å–œæ¬¢ç”¨å¼±åŠ¨è¯ï¼Œæ¯”å¦‚ï¼šé€ æˆã€è¿›è¡Œ æ­¤ç±»åŠ¨è¯ å–œæ¬¢ç”¨ä»å¥ éšæ„å †ç Œæ®µè½ç¼ºä¹é€»è¾‘æ€ç»´æ€»ç»“ å†™ä½œçš„ç¬¬ä¸€è¦åŠ¡å°±æ˜¯è¦æ¸…æ¥šçš„è¡¨è¾¾ä¿¡æ¯ ä¿¡æ¯åˆ†ä¸‰ç±»ï¼š è®°è¿°ä¿¡æ¯ï¼šç”¨äºæè¿°äº‹ç‰©çš„æƒ…å†µå’Œç°è±¡ä¿¡æ¯ è¯„ä»·ä¿¡æ¯ï¼šä»·å€¼åˆ¤æ–­ è§„èŒƒä¿¡æ¯ï¼šäº‹ç‰©åº”è¯¥æœ‰çš„çŠ¶æ€ä»¥åŠäººè¯¥é‡‡å–çš„è¡ŒåŠ¨æˆ‘ä»¬è¦æ ¹æ®ä¸åŒçš„æ–‡æœ¬ï¼Œä½¿ç”¨ä¸åŒçš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œå¯¹ä¸“ä¸šè®ºæ–‡æ¥è®²ï¼Œå¤šç”¨è®°è¿°ä¿¡æ¯ï¼Œå› ä¸ºå‡†ç¡®ï¼›å¯¹ç§‘æ™®æ–‡ç« ï¼Œå°±è¦å¤šç”¨äº›è¯„ä»·ä¿¡æ¯ï¼Œæ–¹ä¾¿ç†è§£ã€‚","tags":["reading"],"categories":["reading"]},{"title":"excelè®¡ç®—ç©ºç™½æ•°é‡","path":"/2023/04/09/480/","content":"æœ€è¿‘ç»å¸¸ä½¿ç”¨ excel åšä¸€äº›ç»Ÿè®¡ï¼Œå¤‡æ³¨ä¸€ä¸‹ã€‚ ç»Ÿè®¡æŸåˆ—ä¸ä¸ºç©ºæ•°é‡=COUNTA(O2:O1657)=COUNTA(Q2:Q1657) ç»Ÿè®¡æŸåˆ—ä¸ºç©ºæ•°é‡=COUNTBLANK(J2:J3319) ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡=COUNTIFS(M2:M12095,&quot;&quot;,O2:O12095,&quot;&quot;)=COUNTIFS(O2:O1657,&quot;&quot;,Q2:Q1657,&quot;&quot;) ç»Ÿè®¡æŸä¸¤åˆ—éƒ½ä¸ºç©ºæ•°é‡æ€»è¡Œæ•°å‡å»ä¸Šé¢çš„","tags":["office"],"categories":["office"]},{"title":"MySQLçš„exists","path":"/2023/02/13/473/","content":"ç›¸è¾ƒäº inï¼Œexists å…¶å®æ²¡æœ‰ç‰¹åˆ«é«˜é¢‘çš„ä½¿ç”¨ã€‚exists è¯­å¥å¹¶ä¸é‚£ä¹ˆå®¹æ˜“è¯»ã€‚ä»Šå¤©æˆ‘ä»¬æ¥ä½¿ç”¨ä¸€ä¸‹: mock dataCREATE TABLE `users` ( `id` int unsigned NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, `status` tinyint(1) NOT NULL DEFAULT &#x27;1&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;CREATE TABLE `user_logs` ( `id` int unsigned NOT NULL AUTO_INCREMENT, `user_id` int unsigned NOT NULL, `content` varchar(255) NOT NULL, `created_at` timestamp NULL DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci; æ’å…¥æµ‹è¯•æ•°æ®: INSERT INTO `users`(id, name) VALUES(1, &#x27;sai&#x27;);INSERT INTO `users`(id, name) VALUES(2, &#x27;os&#x27;);INSERT INTO `users`(id, name) VALUES(3, &#x27;jack&#x27;);INSERT INTO `users`(id, name) VALUES(4, &#x27;kai&#x27;);INSERT INTO `users`(id, name) VALUES(5, &#x27;tom&#x27;);INSERT INTO `users`(id, name) VALUES(6, &#x27;peter&#x27;);INSERT INTO `users`(id, name) VALUES(7, &#x27;li&#x27;);INSERT INTO `users`(id, name) VALUES(8, &#x27;bob&#x27;);INSERT INTO `users`(id, name) VALUES(9, &#x27;wuliuqi&#x27;);INSERT INTO `users`(id, name) VALUES(10, &#x27;awesome&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(1, &#x27;create post&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(1, &#x27;delete post: 1&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(1, &#x27;delete post: 55&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(2, &#x27;delete post: 23&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(3, &#x27;delete post:34&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(4, &#x27;delete post:40&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(4, &#x27;add post&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(4, &#x27;delete post:99&#x27;);INSERT INTO `user_logs`(user_id, content) VALUES(4, &#x27;delete post:140&#x27;); åˆ¤æ–­æ˜¯å¦å­˜åœ¨æˆ‘ä»¬ä½¿ç”¨ exists åˆ¤æ–­æŸæ¡è®°å½•æ˜¯å¦å­˜åœ¨: mysql&gt; select exists (select * from `users` where id = 1);+---------------------------------------------+| exists (select * from `users` where id = 1) |+---------------------------------------------+| 1 |+---------------------------------------------+1 row in set (0.00 sec)mysql&gt; select exists (select * from `users` where id = 13);+----------------------------------------------+| exists (select * from `users` where id = 13) |+----------------------------------------------+| 0 |+----------------------------------------------+1 row in set (0.00 sec) å­æŸ¥è¯¢exists æ›´å¤šç”¨äºå­æŸ¥è¯¢: SELECT * FROM `user_logs` WHERE EXISTS ( SELECT * FROM `users` WHERE `users`.id = `user_logs`.user_id and `users`.id = 1); ä½ çŸ¥é“ä¼šè¾“å‡ºä»€ä¹ˆå—? å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªè¯­å¥æ—¶æ˜¯è¿™ä¹ˆç†è§£çš„, where åé¢çš„æ˜¯1ï¼Œæ‰€ä»¥ä¼šåˆ—å‡ºæ‰€æœ‰çš„ user_logs ã€‚ æ˜¾ç„¶æˆ‘çš„ç†è§£æ˜¯: SELECT * FROM `user_logs` WHERE 1; ä½†è¾“å‡ºæ‰“è„¸äº† ğŸ˜¢ +----+---------+-----------------+---------------------+| id | user_id | content | created_at |+----+---------+-----------------+---------------------+| 1 | 1 | create post | 2023-02-14 08:54:59 || 2 | 1 | delete post: 1 | 2023-02-14 08:54:59 || 3 | 1 | delete post: 55 | 2023-02-14 08:54:59 |+----+---------+-----------------+---------------------+3 rows in set (0.00 sec) å…¶å®ä¸Šé¢çš„è¯­å¥ä¸ä¸‹é¢çš„è¯­å¥ç»“æœä¸€è‡´çš„ã€‚ SELECT * FROM `user_logs` WHERE user_id in ( SELECT id FROM `users` WHERE `users`.id = 1); SELECT `user_logs`.* FROM `user_logs` LEFT JOIN `users` ON `users`.id = `user_logs`.user_id WHERE `users`.id = 1; in è¿˜æ˜¯ existså¯¹äºå¾ˆå¤šåšå®¢ä¸­æåˆ°çš„ in é€‚åˆäºå¤–è¡¨å¤§è€Œå­æŸ¥è¯¢è¡¨å°çš„æƒ…å†µï¼Œexists é€‚åˆäºå¤–è¡¨å°è€Œå­æŸ¥è¯¢è¡¨å¤§çš„æƒ…å†µï¼Œå…¶å®å¹¶ä¸å‡†ç¡®ã€‚MySQL æ‰‹å†Œä¸­æåˆ°ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ materialization ï¼Œä¼˜åŒ–å™¨åˆæ˜¯ä¼šé‡å†™æŸ¥è¯¢ï¼Œå³å¯èƒ½ä¼šå°† in è½¬æˆ existsã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µæ€§èƒ½å…¶å®æ˜¯æ²¡ä»€ä¹ˆå·®åˆ«çš„ã€‚ä½†æ˜¯ç»™å¤§è¡¨åŠ ç´¢å¼•ä¸€èˆ¬æ˜¯æœ‰æ•ˆçš„ã€‚ å‚è€ƒ Optimizing Subqueries with Materialization","tags":["mysql"],"categories":["MySQL"]},{"title":"Redis hyperloglogè¯¯åˆ¤","path":"/2023/02/05/472/","content":"HyperLogLog æ˜¯ Redis çš„ä¸€ç§æ•°æ®ç±»å‹ã€‚åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸº æ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚HyperLogLog çš„å…¸å‹åº”ç”¨åœºæ™¯å°±æ˜¯è®¡ç®— uvã€‚ ä½†æ˜¯ HyperLogLog æ˜¯å­˜åœ¨è¯¯åˆ¤çš„ï¼Œå®˜æ–¹ä»‹ç»å…¶æ ‡å‡†è¯¯å·®ä¸º0.81%ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³ç²¾ç¡®çš„ç»Ÿè®¡ uvï¼Œä»…ä»…ä½¿ç”¨ HyperLogLog æ˜¯ä¸å¤Ÿçš„ã€‚ æˆ‘ä»¬ä¸å¦¨æµ‹è¯•ä¸‹ï¼š import Redisimport hashlibdef md5(text: str): return hashlib.md5(text.encode()).hexdigest()Redis_conn = Redis.Redis(host=&quot;localhost&quot;, port=6379, db=0)Redis_conn.auth(&quot;123456&quot;)for i in range(1000): if Redis_conn.pfadd(&quot;hyperloglog-test&quot;, md5(str(i))) == 0: print(i) è¾“å‡ºå¦‚ä¸‹ï¼š âœ user-sai git:(main) âœ— python3 codesnippets/python/hyperloglog.py193294406527579588616688706764770846872876880888941975984991 å¯ä»¥çœ‹åˆ°æ˜¯æœ‰ä¸€äº›è¯¯åˆ¤çš„ã€‚ å› è€Œï¼Œå¦‚æœéœ€è¦å¾ˆç²¾ç¡®åœ°åšç±»ä¼¼å»é‡è®¡æ•°ä»»åŠ¡ï¼Œ HyperLogLog å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆï¼Œå³ä¾¿ HyperLogLog åˆå¿«åˆèŠ‚çœå†…å­˜ã€‚ å‚è€ƒï¼š Redis new data structure: the HyperLogLog","tags":["Redis"],"categories":["Redis"]},{"title":"2022,è¿™ä¸€å¹´","path":"/2023/01/21/2022/","content":"å…ˆç¥ç¦å„ä½é™¤å¤•å¿«ä¹ï¼Œå…”å¹´å‰ç¥¥é¡ºæ„ã€‚ åˆåˆ°äº†è‡ªå·±å¹´ç»ˆæ€»ç»“çš„æ—¶å€™äº†ï¼Œçœ‹äº†ä¸‹å»å¹´çš„è®¡åˆ’ï¼Œå®Œæˆå¾—éƒ½ä¸æ€ä¹ˆæ ·ï¼Œç½¢äº†ç½¢äº†ã€‚ å¦‚æœç”¨ä¸€ä¸ªè¯æè¿°å³å°†è¿‡å»çš„ä¸€å¹´ï¼Œæˆ‘æƒ³æ²¡æœ‰æ¯”â€œé­”å¹»â€æ›´å¥½çš„äº†ã€‚è¿™ä¸€å¹´å‘ç”Ÿäº†å¾ˆå¤šäº‹ï¼Œæœ‰äº›äº‹ä¹Ÿè®¸è¿™ä¸€è¾ˆå­å†ä¹Ÿä¸æƒ³ç»å†äº†ï¼Œä½†åˆæ„Ÿè§‰å¥½ä¸çœŸåˆ‡ã€‚ä¹Ÿè®¸ç”Ÿæ´»å°±æ˜¯è¿™èˆ¬è’è¯æ— å¸¸ã€‚ ç”Ÿæ´»æ²¡æœ‰ä»€ä¹ˆæ¯”å¾—è€Œå¤±å»æ›´è®©äººé—æ†¾çš„äº†ã€‚å¹´ä¸­æœ‰ä¸€é˜µæˆ‘å¯¹çäº‹æœ‰ä¸€ç§å¾ˆå¼ºçš„æ— åŠ›æ„Ÿï¼Œä¸çŸ¥æ‰€æªï¼Œä½†åˆä¸å¾—ä¸ç–²äºåº”ä»˜ï¼Œè¿™æ„Ÿè§‰å¾ˆç³Ÿã€‚å½“äº‹æƒ…å¤±å»æ§åˆ¶çš„æ„Ÿè§‰ï¼ŒçœŸçš„è®©äººå¾ˆéš¾å—ï¼Œåªèƒ½è¢«è¿«æ¥å—ï¼Œä¸çŸ¥é“è¿™æ˜¯ä¸æ˜¯ä¸‰åè€Œç«‹çš„å¿…ç»ä¹‹è·¯ã€‚ è®©æˆ‘æ„Ÿå—æœ€æ·±çš„æ˜¯ï¼Œé™ªä¼´æ˜¯å¾ˆé‡è¦çš„ï¼Œå¥¹ä¸è‡³äºè®©æˆ‘è·Œå…¥æƒ…æ„Ÿçš„æ·±æ¸Šï¼Œæ›´å¤šçš„æ˜¯è®©æˆ‘ä»è¿™æ— åŠ©ä¸­æ‰¾åˆ°å¸Œæœ›ã€‚æ„Ÿè°¢æˆ‘çš„å¦»å­ï¼Œè¿™ä¸€å¹´è·Ÿæˆ‘ç»å†äº†é‚£ä¹ˆå¤šï¼Œä½†ä¸€ç›´ä¸æ–­æ¿€åŠ±æˆ‘ï¼ŒåŒ…å®¹æˆ‘ï¼Œè€Œå¥¹è‡ªå·±ä¸€ç›´ä¿æŒç§¯æçš„å¿ƒæ€ï¼Œç»™äºˆæˆ‘å……åˆ†çš„ä¿¡ä»»ã€‚ å·¥ä½œå› ä¸ºæŸäº›åŸå› æœ€ç»ˆç¦»èŒäº†ï¼Œç´¢æ€§ç¦»å¼€äº†å—äº¬ï¼Œå»åˆ°æ‰¬å·ï¼Œç©ºçª—å‡ ä¸ªæœˆåï¼Œæœ€ç»ˆæœºç¼˜å·§åˆä¹‹ä¸‹æ‰¾äº†ä¸€ä»½ remote å·¥ä½œã€‚è¿™æ˜¯å¹´åˆæ²¡æœ‰æ–™åˆ°çš„ï¼Œä¹Ÿç®—æ˜¯å› ç¥¸å¾—ç¦å§ï¼æ²¡æƒ³åˆ°è¿™ä¹ˆå¿«èƒ½ç»“æŸå¼‚åœ°ï¼Œè¿™ä¹Ÿç®—æ˜¯è®©å¦»å­å¹¸ç¦æ„Ÿæå‡çš„ä¸€ä»¶äº‹å§ï¼ æ–°çš„å·¥ä½œçœŸçš„è¦æ„Ÿè°¢åŒäº‹çš„ä¿¡ä»»å’Œå¸®åŠ©ã€å‹å–„ï¼Œå¦‚ä»Šä¹Ÿç®—èå…¥å…¶ä¸­äº†å§ï¼ å·¥ä½œçš„ä¸»è¦è¯­è¨€ä¹Ÿåœ¨è½¬å˜ä¸º pythonã€sqlï¼Œæƒ³æƒ³è¿™äº›å¹´ï¼Œä½¿ç”¨è¿‡çš„ç¼–ç¨‹è¯­è¨€ï¼Œjsã€phpã€goã€pythonï¼Œè¡Œä¸šæœ‰ç”µå•†ã€æ•™è‚²ã€æ¸¸æˆã€O2Oç­‰ã€‚çœŸçš„æ˜¯è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ã€‚æ„Ÿå—å°±æ˜¯å¥½å¥½å­¦ä¹ å§ï¼Œä¸ç®¡æ˜¯æ·±åº¦åº¦è¿˜æ˜¯å¹¿åº¦ï¼Œåœ¨ä½ æœ‰æ‰€ä½™åŠ›çš„æ—¶å€™ï¼Œå¤šå­¦ä¸€äº›æ€»æ²¡åå¤„ã€‚ å­¦ä¹ ä»äº”æœˆä»½å†³å®šè€ƒç ”ï¼Œåˆ°ç«¯åˆèŠ‚ä¹‹åå¼€å§‹å¤‡è€ƒçœ‹ä¹¦ï¼Œå†åˆ°å¤±ä¸šå…¨èŒè€ƒç ”ï¼Œå†åˆ°å›å®¶è€ƒç ”ã€‚æ²¡æ–™åˆ°çš„æ˜¯ï¼Œè€ƒè¯•å‰ä¸€å¤©æ™šä¸Šå¼€å§‹å‘çƒ§ï¼Œå‡Œæ™¨äº”ç‚¹å·¦å³æ‰ç¡ç€ï¼Œç¬¬äºŒå¤©åšæŒå®Œä¸Šåˆçš„è€ƒè¯•ï¼Œå‡ºè€ƒåœºæ•´ä¸ªäººéƒ½æœ‰ç‚¹è™šè„±ï¼Œå…¨èº«é…¸ç–¼ï¼Œä¸‹æ¥¼èƒ½æ˜æ˜¾æ„Ÿè§‰è…¿åœ¨æŠ–ã€‚å›åˆ°å®¾é¦†å«å”¤äº†å¥½ä¸€ä¼šï¼Œå®åœ¨å—ä¸äº†æ‰åƒäº†é€€çƒ§è¯ï¼Œåˆä¼‘åç²¾ç¥å¥½å¤šäº†ï¼ŒåšæŒè€ƒå®Œä¸‹åˆçš„è‹±è¯­äºŒã€‚ å¥½åœ¨åªæœ‰ä¸€å¤©è€ƒè¯•ï¼Œä¹Ÿç®—ä¸å¹¸ä¸­çš„ä¸‡å¹¸ã€‚æš‚æ—¶ä¹Ÿä¸æƒ³é‚£ä¹ˆå¤šï¼Œæˆç»©å‡ºæ¥å†è¯´å…¶ä»–çš„å§ï¼ å¯¹äºéå…¨è€ƒç ”ï¼Œæˆ‘çš„å»ºè®®æ˜¯å°½æ—©ç¡®å®šå°½æ—©å‡†å¤‡ï¼Œåˆ«ä¿¡ä»€ä¹ˆä¸‰ä¸ªæœˆä¸Šå²¸ï¼Œè¸è¸å®å®å‡†å¤‡æŒ‰è®¡åˆ’èµ°æ‰æ˜¯ç‹é“ã€‚ è™½ç„¶ 2022 è¿™ä¸€å¹´å¤ªè¿‡é­”å¹»ï¼Œä½†å¤šå°‘æ€»æœ‰äº›æˆé•¿ï¼Œä¸æ„Ÿæ¿€è¿™ä¸€å¹´ï¼Œæ„Ÿæ¿€æˆ‘è‡ªå·±ï¼Œæ„Ÿæ¿€èº«è¾¹äººï¼Œç»å†äº†è¿™ä¸€åˆ‡ï¼Œä»ç„¶å¿ƒå­˜å–„è‰¯ï¼Œå……æ»¡å¸Œæœ›ã€‚ è¿‡å»å°±è®©å®ƒè¿‡å»å§ï¼Œä¸å¦‚â€åƒé¥­æ—¶åƒé¥­ï¼Œç¡è§‰æ—¶ç¡è§‰â€ã€‚æœ€åï¼Œç…§ä¾‹ç«‹ä¸€ä¸‹ flagï¼š æ–°å¹´è®¡åˆ’ï¼š æŠ€æœ¯å­¦ä¹ ï¼Œts\\react è¿åŠ¨å‡é‡ è¯»ä¹¦ 30 æœ¬ æ‹è§†é¢‘ æœ€åï¼Œå¸Œæœ›å¤§å®¶æ–°çš„ä¸€å¹´èº«ä½“å¥åº·ï¼Œäººæ°‘å¸å¤šä¸€å¹´ï¼Œçƒ¦æ¼å°‘ä¸€ç‚¹ã€‚ å£¬å¯…é™¤å¤•äºå®‰åº†2022å¹´01æœˆ31æ—¥","tags":["oneyear"],"categories":["oneyear"]},{"title":"pythonå¦‚ä½•è·³å‡ºå¤šå±‚å¾ªç¯","path":"/2023/01/13/471/","content":"php break åé¢æ˜¯å¯ä»¥å¸¦æ•°é‡ï¼Œè¡¨ç¤ºè·³å‡ºçš„å±‚æ•°ï¼Œpythonå¦‚ä½•è·³å‡ºå¤šå±‚å¾ªç¯å‘¢ï¼Ÿ ä»¥ python3 ä»£ç ä¸ºä¾‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ã€‚ æ‰“åŒ…å‡½æ•°ï¼Œä½¿ç”¨ returndef sai(): for i in range(10): for j in range(10): if i + j &gt; 13: return i, jprint(sai()) å°†å¾ªç¯é€»è¾‘æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œæ»¡è¶³æ¡ä»¶ç›´æ¥ return å˜é‡æ ‡è®°def flag(): btn = False for i in range(10): for j in range(10): if i + j &gt; 13: btn = True break if btn: break print(i, j)flag() ä½¿ç”¨ btn æ ‡è®°ï¼Œbtn == True åˆ™ç»§ç»­è·³å‡ºã€‚ for/elsedef loop(): for i in range(10): for j in range(10): if i + j &gt; 13: break else: continue break print(i, j)loop() raise Exceptionclass Break(Exception): passtry: for i in range(10): for j in range(10): if i + j &gt; 13: raise Breakexcept Break: print(i, j) æ€»æ„Ÿè§‰è¿™ä¸ªæ–¹æ³•ä¸å¤ªä¼˜é›…ã€‚ ä»¥ä¸Šå‡ ç§æ–¹æ³•å°±æ˜¯é’ˆå¯¹å¤šå±‚å¾ªç¯çš„è·³å‡ºï¼Œæˆ‘ä¸ªäººå€¾å‘äºæŠ½è±¡ä¸ªå‡½æ•°ï¼Œå½“ç„¶äº†ï¼Œä¹ æƒ¯å“ªç§å¦‚ä½ æ‰€æƒ³ã€‚ å¦‚æœæœ‰å…¶ä»–å¥½çš„æ–¹å¼ï¼Œæ¬¢è¿åˆ†äº«ã€‚","tags":["python"],"categories":["python"]},{"title":"git pull ä¸€ç›´å¤±è´¥","path":"/2023/01/09/470/","content":"æœ€è¿‘åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ git pull é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå¦‚æœä½ ä¹Ÿé‡åˆ°ï¼Œå¸Œæœ›æˆ‘çš„åˆ†äº«å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ No such file or directory.å…ˆæ˜¯é‡åˆ°è¿™ä¸ªé”™è¯¯ git pullWarning: Identity file /home/sai/.ssh/sai not accessible: No such file or directory. æç¤ºæ˜¯æ²¡æœ‰æ–‡ä»¶ï¼Œæˆ‘ä»¬å»æ–°å»ºä¸€ä¸‹å³å¯ã€‚ ä½†æ˜¯åº”è¯¥æ–°å»ºæ–‡ä»¶é‡Œé¢æ˜¯ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿ æŸ¥çœ‹äº†ä¸‹ git config git config -lsafe.directory=/src/abccore.repositoryformatversion=0core.filemode=truecore.bare=falsecore.logallrefupdates=truecore.sshcommand=ssh -i ~/.ssh/sairemote.origin.url=git@github.com:puresai/code.git å¯ä»¥çœ‹åˆ°å®šä¹‰äº† sshcommand å¯¹äº core.sshCommand å¦‚æœè®¾ç½®äº†è¿™ä¸ªå˜é‡ï¼Œå½“git fetchå’Œgit pushéœ€è¦è¿æ¥åˆ°è¿œç¨‹ç³»ç»Ÿæ—¶ï¼Œå®ƒä»¬å°†ä½¿ç”¨æŒ‡å®šçš„å‘½ä»¤è€Œä¸æ˜¯sshã€‚è¯¥å‘½ä»¤ä¸GIT_SSH_COMMANDç¯å¢ƒå˜é‡çš„å½¢å¼ç›¸åŒï¼Œåœ¨è®¾ç½®ç¯å¢ƒå˜é‡æ—¶å°†è¢«è¦†ç›–ã€‚ æˆ‘ä»¬å¤åˆ¶ ~/.ssh/id_rsa å³å¯ã€‚ cp ~/.ssh/id_rsa ~/.ssh/sai å®Œæˆè¿™ä¸€æ­¥ä¹‹åï¼Œæœ‰é‡åˆ°é—®é¢˜ã€‚ git pullERROR: Repository not found.fatal: Could not read from remote repository.Please make sure you have the correct access rightsand the repository exists. è¿™ä¸ªé—®é¢˜èŠ±äº†æˆ‘ä¸å°‘æ—¶é—´ï¼Œå»github ssh keys å‘ç°æœåŠ¡å™¨ä¸Šçš„ id_rsa.pub å·²ç»åŠ äº†ã€‚ æœ€åé‡æ–°ç”Ÿæˆ ssh-keygen -t rsa -C &quot;puresai&quot; éœ€è¦ä¸€æ­¥æ­¥ç¡®è®¤ï¼Œä¼šå‘ç° id_rsa.pub å’Œ id_rsa å·²ç»ç”Ÿæˆã€‚å‰å¾€ github æ·»åŠ  id_rsa.pub ã€‚ git pullAlready up to date.","tags":["git"],"categories":["CI"]},{"title":"pythonå¦‚ä½•éå†listå¹¶åˆ é™¤å…ƒç´ ","path":"/2022/11/14/461/","content":"åœ¨å¼€å‘åœºæ™¯ä¸­ï¼Œpython éå†listå¹¶åˆ é™¤å…¶ä¸­éƒ¨åˆ†å…ƒç´ æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ã€‚æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼š ç°åœ¨æœ‰ä¸€ä¸ªlist [1,2,4,-1,-4,1,9,-7,0], å¦‚ä½•åˆ é™¤listä¸­ä¸ºè´Ÿæ•°çš„å…ƒç´ ã€‚ èªæ˜å¦‚æˆ‘ï¼Œä¸éš¾æƒ³åˆ°ï¼Œéå†åˆ¤æ–­åˆ é™¤å‘—ï¼soeasyï¼ l = [1,2,4,-1,-4,1,9,-7,0]for item in l: if item &lt; 0: l.remove(item)print(l) æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹è¾“å‡ºï¼š [1, 2, 4, -4, 1, 9, 0] Wow~ remove å‡½æ•°ç”¨äºç§»é™¤åˆ—è¡¨ä¸­æŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ å¥½åŠï¼Œæˆ‘ä½¿ç”¨indexåˆ é™¤ã€‚ l = [1,2,4,-1,-4,1,9,-7,0]for (i, item) in enumerate(l): if item &lt; 0: del l[i]print(l) å†æ¥ä¸€æ³¢ï¼š [1, 2, 4, -4, 1, 9, 0] é¢é¢ã€‚è²Œä¼¼ä¸å¯¹ï¼Œæˆ‘ä»¬ä¸å¦¨æ‰“å°ä¸€ä¸‹ï¼š l = [1,2,4,-1,-4,1,9,-7,0]for (i, item) in enumerate(l): print(l) if item &lt; 0: del l[i]print(l) python3 test_list.py[1, 2, 4, -1, -4, 1, 9, -7, 0][1, 2, 4, -1, -4, 1, 9, -7, 0][1, 2, 4, -1, -4, 1, 9, -7, 0][1, 2, 4, -1, -4, 1, 9, -7, 0][1, 2, 4, -4, 1, 9, -7, 0][1, 2, 4, -4, 1, 9, -7, 0][1, 2, 4, -4, 1, 9, -7, 0][1, 2, 4, -4, 1, 9, 0] èƒ½çœ‹å‡ºæ¥åˆ é™¤åå…¶å® index å˜åŒ–ï¼Œå¯¼è‡´éƒ¨åˆ†å…ƒç´ æ¼åˆ äº†ã€‚ é‚£ä¹ˆåˆ°åº•å¦‚ä½•æ­£ç¡®æ“ä½œå‘¢ï¼Ÿ filterl = [1,2,4,-1,-4,1,9,-7,0]def filter_small(item): if item &lt; 0: return False return Truetmplist = filter(filter_small, l)print(list(tmplist)) éœ€è¦æ³¨æ„python2å’ŒPython3çš„filteræ˜¯æœ‰åŒºåˆ«å“ˆï¼ [1, 2, 4, 1, 9, 0] è¯­æ³•ç³–l = [1,2,4,-1,-4,1,9,-7,0]l = [x for x in l if x &gt;= 0]print(l) æ³¨æ„è¿™é‡Œæ¡ä»¶ï¼Œæ˜¯&gt;=0ï¼Œå°±æ˜¯æŠŠéæ•´æ•°ä¿ç•™ã€‚ å€’åºéå†æ­£å‘éå†åˆ é™¤å…ƒç´ indexå˜åŒ–ï¼Œé‚£æˆ‘å€’åºéå†æ²¡æ¯›ç—…å§ l = [1,2,4,-1,-4,1,9,-7,0]for item in range(len(l) - 1, -1, -1): if l[item] &lt; 0: del l[item]print(l) å½“ç„¶äº†ï¼Œå…¶å®è¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚åˆ›å»ºä¸ªæ–°çš„ listï¼Œåˆ¤æ–­åæ’å…¥ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆç®€å•çš„ã€‚ å…³äºlistéå†åˆ é™¤å°±ä»‹ç»è¿™ä¹ˆå¤šäº†ï¼Œå†™å®Œä»£ç åŠ¡å¿…è€è€å®å®å„ç§æƒ…å†µæµ‹è¯•å¥½ï¼Œä¸è¦æƒ³å½“ç„¶ï¼Œå°±åŒ†åŒ†å‘å¸ƒå“Ÿï¼","tags":["python"],"categories":["python"]},{"title":"Problems encountered when using mysql8, and how to solve them","path":"/2022/10/31/460/","content":"environment osx 12.5.1 mysql8.0.30 Public Key Retrieval is not alloweddb manager: DBeaver Right click your connection, choose â€œEdit Connectionâ€ On the â€œConnection settingsâ€ screen (main screen) click on â€œEdit Driver Settingsâ€ Click on â€œConnection propertiesâ€, (In recent versions it named â€œDriver propertiesâ€) Right click the â€œuser propertiesâ€ area and choose â€œAdd new propertyâ€ Add two properties: â€œuseSSLâ€(false) and â€œallowPublicKeyRetrievalâ€(true) Forget password Click system settings On the â€œsystem settingsâ€ panel, Click on the MySQL icon below Click â€˜Initailize Databaseâ€™ button Then enter a new password, and select a type of the password encryption Restart the MySQL reference https://stackoverflow.com/questions/50379839/connection-java-mysql-public-key-retrieval-is-not-allowed","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLå¤§æ‰¹é‡æ•°æ®å¯¼å…¥","path":"/2022/10/22/450/","content":"ç›®æ ‡åƒä¸‡è¡Œçš„çš„ json æ•°æ®æˆ–è€… CSV å¿«é€Ÿå¯¼å…¥ MYSQL çš„åœºæ™¯ã€‚ è§£å†³æ–¹æ¡ˆè„šæœ¬ä»£ç ä½¿ç”¨ php / python æˆ–è€…ä½ ç†Ÿæ‚‰çš„è¯­è¨€ï¼ŒæŒ‰è¡Œè§£æï¼Œæ’å…¥ã€‚ tipsï¼š ä¸€æ¬¡è§£æå¤šè¡Œï¼Œæäº¤æ•ˆç‡ åˆ†ç»„æ’å…¥ï¼Œå‡å°‘ MySQL æ’å…¥æ¬¡æ•° æ³¨æ„å†…å­˜ æ¯æ¬¡è§£æçš„è¡Œæ•°å’Œæ¯æ¬¡æ’å…¥çš„è¡Œæ•°æŒ‰å…·ä½“æƒ…å†µ ï¼Œä¸»è¦è€ƒè™‘è¿è¡Œå†…å­˜å’ŒMySQLçš„å‹åŠ›æƒ…å†µã€‚ load dataå¯¹äº CSV æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ SQLï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼Œæˆ–è€…é…åˆå…¶ä»–è„šæœ¬ä½¿ç”¨ã€‚ LOAD DATA LOCAL INFILE &#x27;/xxx.csv&#x27; INTO TABLE linkedinFIELDS TERMINATED BY &#x27;,&#x27; LINES TERMINATED BY &#x27; &#x27; IGNORE 1 LINES (@C1,@C2,@C3,@C4)set company=@C1,website=upper(@C2),address=concat(@C3, &quot;-&quot;,@C4),imported_at=now(),zip=if(now()&lt;&#x27;1988-01-01&#x27;,&#x27;1&#x27;,&#x27;2&#x27;);LOAD DATA LOCAL INFILE &#x27;/puresai.json&#x27; INTO TABLE oscomeFIELDS TERMINATED BY &#x27;,&#x27; LINES TERMINATED BY &#x27;\\r &#x27;; mysqlimportå¯¹äº CSV æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ ./mysqlimport -u root -p --local --delete --fields-terminated-by=&quot;,&quot; --lines-terminated-by=&quot;\\r &quot; --ignore-lines=1 --columns=company,website testdata &#x27;/puresai.csv&#x27; MySQL Shellmysqlsh mysql://root:123456@127.0.0.1:3366 -- util import-table puresai.json &quot;data_b*&quot; data_d.tsv.zst --schema=mydb --table=twitter --osBucketName=mybucketmysql-py&gt; util.import_table([&quot;./puresai.csv&quot;],&#123;&quot;schema&quot;:&quot;testdata&quot;,&quot;table&quot;:&quot;test&quot;,&quot;dialect&quot;:&quot;csv&quot;,&quot;columns&quot;:[1,2,3,4,5,6,7,8,9,10,11,12],&quot;decodeColumns&quot;:&#123;&quot;company&quot;:&quot;@1&quot;,&quot;website&quot;:&quot;@2&quot;,&quot;url&quot;:&quot;@3&quot;,&quot;address&quot;:&quot;@4&quot;,&quot;zip&quot;:&quot;@5&quot;,&#125;,&quot;skipRows&quot;:1,&quot;showProgress&quot;:True,&quot;threads&quot;: 3&#125;);mysql-py&gt; util.import_table([&quot;./puresai.json.gz&quot;],&#123;&quot;schema&quot;:&quot;testdata&quot;,&quot;table&quot;:&quot;twitter&quot;,&quot;dialect&quot;:&quot;json&quot;,&quot;columns&quot;:[1,2,3,4,5,6,7,8,9,10,11,12],&quot;decodeColumns&quot;:&#123;&quot;id&quot;:&quot;@1&quot;,&quot;name&quot;:&quot;@2&quot;&#125;,&quot;skipRows&quot;:1,&quot;showProgress&quot;:True,&quot;threads&quot;: 3&#125;); æ€»ç»“å¯¹äº CSV æˆ–è€…æ ¼å¼åŒ–æ–‡æœ¬ä½¿ç”¨ mysqlimportã€load data éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œè€Œè„šæœ¬è§£ææ˜¯æœ€æœ‰æ™®é€‚æ€§çš„ï¼Œå‡å¦‚éœ€è¦æ‰“å°æ—¥å¿—ã€è¿›åº¦æˆ–è€…å­—æ®µå˜æ›´ï¼Œä½¿ç”¨ php/python ç­‰å»è§£ææ›´ä¸ºçµæ´»ã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"VSCode æ’ä»¶æ¨è","path":"/2022/09/29/441/","content":"VSCode æ’ä»¶æ¨èï¼š gitæ’ä»¶ é¢œå€¼æ‰©å±• æ•ˆç‡æå‡ æ‹“å±•å·¥å…· æ‘¸ ğŸŸ é±¼","tags":["VSCode"],"categories":["å¼€æºåˆ°"]},{"title":"kuberneteå®æˆ˜ç¯‡-PVC","path":"/2022/09/16/435/","content":"Kubernetes å¯¹äºæœ‰çŠ¶æ€çš„æ—¥æœŸåº”ç”¨æˆ–è€…å¯¹äºæ•°æ®éœ€è¦æŒä¹…åŒ–çš„åº”ç”¨ï¼Œå°±éœ€è¦æ›´å¯é çš„å­˜å‚¨æ¥ä¿å­˜åº”ç”¨äº§ç”Ÿçš„é‡è¦æ•°æ®äº†ã€‚è¿™é‡Œéœ€è¦çš„å°±æ˜¯æŒä¹…å·ï¼ˆPersistentVolumeï¼‰å’Œ æŒä¹…å·ç”³é¢†ï¼ˆPersistentVolumeClaimï¼‰ã€‚ æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š PV PVC StorageClass StatefulSet Service æŒä¹…å·ï¼ˆPersistentVolumeï¼ŒPVï¼‰æ˜¯é›†ç¾¤ä¸­çš„ä¸€å—å­˜å‚¨ï¼Œå¯ä»¥äº‹å…ˆä¾›åº”ï¼Œæˆ–è€…ä½¿ç”¨å­˜å‚¨ç±»ï¼ˆStorage Classï¼‰æ¥åŠ¨æ€ä¾›åº”ã€‚ æŒä¹…å·æ˜¯é›†ç¾¤èµ„æºï¼Œå°±åƒèŠ‚ç‚¹ä¹Ÿæ˜¯é›†ç¾¤èµ„æºä¸€æ ·ã€‚PV æŒä¹…å·å’Œæ™®é€šçš„ Volume ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ å·æ’ä»¶æ¥å®ç°çš„ï¼Œåªæ˜¯å®ƒä»¬æ‹¥æœ‰ç‹¬ç«‹äºä»»ä½•ä½¿ç”¨ PV çš„ Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ­¤ API å¯¹è±¡ä¸­è®°è¿°äº†å­˜å‚¨çš„å®ç°ç»†èŠ‚ï¼Œæ— è®ºå…¶èƒŒåæ˜¯ NFSã€iSCSI è¿˜æ˜¯ç‰¹å®šäºäº‘å¹³å°çš„å­˜å‚¨ç³»ç»Ÿã€‚ æŒä¹…å·ç”³é¢†ï¼ˆPersistentVolumeClaimï¼ŒPVCï¼‰è¡¨è¾¾çš„æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨çš„è¯·æ±‚ã€‚æ¦‚å¿µä¸Šä¸ Pod ç±»ä¼¼ã€‚ Pod ä¼šè€—ç”¨èŠ‚ç‚¹èµ„æºï¼Œè€Œ PVC ç”³é¢†ä¼šè€—ç”¨ PV èµ„æºã€‚Pod å¯ä»¥è¯·æ±‚ç‰¹å®šæ•°é‡çš„èµ„æºï¼ˆCPU å’Œå†…å­˜ï¼‰ï¼›åŒæ · PVC ç”³é¢†ä¹Ÿå¯ä»¥è¯·æ±‚ç‰¹å®šçš„å¤§å°å’Œè®¿é—®æ¨¡å¼ ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥è¦æ±‚ PV å·èƒ½å¤Ÿä»¥ ReadWriteOnceã€ReadOnlyMany æˆ– ReadWriteMany æ¨¡å¼ä¹‹ä¸€æ¥æŒ‚è½½ï¼Œå‚è§è®¿é—®æ¨¡å¼ï¼‰ã€‚ ä¸‹é¢ä»¥ influxdb ä¸ºä¾‹å­ï¼š # å•ç‹¬å¼„ä¸ªNamespace influxdbapiVersion: v1kind: Namespacemetadata: name: influxdb---# é…ç½®æ–‡ä»¶å¼„ä¸ªConfigMapï¼Œä¾¿äºä¿®æ”¹apiVersion: v1kind: ConfigMapmetadata: name: influxdb-config namespace: influxdbdata: influxdb.conf: &gt;- [meta] dir = &quot;/var/lib/influxdb/meta&quot; [coordinator] log-queries-after = &quot;60s&quot; max-select-series = 10000 write-timeout = &quot;30s&quot; [data] dir = &quot;/var/lib/influxdb/data&quot; engine = &quot;tsm1&quot; wal-dir = &quot;/var/lib/influxdb/wal&quot; cache-max-memory-size = &quot;0&quot; cache-snapshot-memory-size = &quot;256m&quot; index-version = &quot;tsi1&quot; max-index-log-file-size = &quot;64k&quot; max-series-per-database = 3000000 max-values-per-tag = 100000---## PersistentVolumeClaimapiVersion: v1kind: PersistentVolumeClaimmetadata: name: influxdb-data namespace: influxdbspec: accessModes: - ReadWriteOnce storageClassName: csi-xxx # éœ€è‡ªå®šä¹‰ resources: requests: storage: 16Gi # æŒ‰éœ€é…ç½®ï¼Œå­˜å‚¨æ•°æ®è¾ƒå¤šå¯é€‚å½“æ”¾å¤§---# influxdb æœ‰çŠ¶æ€åº”ç”¨apiVersion: apps/v1kind: StatefulSetmetadata: labels: app: influxdb name: influxdb namespace: influxdbspec: replicas: 1 selector: matchLabels: app: influxdb serviceName: influxdb template: metadata: labels: app: influxdb spec: containers: - image: influxdb:1.8.10 name: influxdb ports: - containerPort: 8086 name: influxdb volumeMounts: - mountPath: /var/lib/influxdb name: data - name: influxdb-config mountPath: /etc/influxdb/influxdb.conf readOnly: true subPath: influxdb.conf volumes: - name: data persistentVolumeClaim: claimName: influxdb-data - name: timezone-config # æ—¶åŒº hostPath: path: /usr/share/zoneinfo/Asia/Shanghai - name: influxdb-config configMap: defaultMode: 0600 name: influxdb-config---# æé«˜ç«¯å£ï¼Œæ–¹ä¾¿å…¶ä»– pod è°ƒç”¨apiVersion: v1kind: Servicemetadata: name: influxdb namespace: influxdbspec: ports: - name: influxdb port: 8086 targetPort: 8086 selector: app: influxdb type: ClusterIP","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kuberneteå®æˆ˜ç¯‡-CronJob","path":"/2022/08/31/434/","content":"æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š CronJob kubectl delete, kubectl logs CronJob æœ‰ç‚¹ç±»ä¼¼Linuxçš„crontabã€‚ # cronjob.yamlapiVersion: batch/v1kind: CronJobmetadata: name: hellospec: # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59) # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23) # â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆçš„æŸå¤© (1 - 31) # â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12) # â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘¨çš„æŸå¤© (0 - 6)ï¼ˆå‘¨æ—¥åˆ°å‘¨ä¸€ï¼‰ # â”‚ â”‚ â”‚ â”‚ â”‚ æˆ–è€…æ˜¯ sunï¼Œmonï¼Œtueï¼Œwebï¼Œthuï¼Œfriï¼Œsat # â”‚ â”‚ â”‚ â”‚ â”‚ # â”‚ â”‚ â”‚ â”‚ â”‚ # * * * * * schedule: &quot;*/1 * * * *&quot; jobTemplate: spec: template: spec: containers: - name: hello image: busybox imagePullPolicy: IfNotPresent args: - /bin/sh - -c - date; sleep 30; echo Hello, puresai from the Kubernetes cluster restartPolicy: OnFailure kubectl apply -f cronjob.yaml è¿è¡Œæ²¡é—®é¢˜ï¼ŒåŠ å…¥å‘ç°jobæœ‰é—®é¢˜ï¼Œéœ€è¦ç«‹å³ç»ˆæ­¢æ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚ä½•åˆ é™¤æ­£åœ¨è¿è¡Œçš„ jobï¼Ÿ kubectl delete pod xxx å¯ä»¥çœ‹è§ç«‹å³ç”Ÿæˆäº†å¦ä¸€ä¸ªï¼Œç»§ç»­deleteã€‚ kubectl delete pod xxx â€“grace-period 0 â€“force è™½ç„¶å¼ºåˆ¶æ€æ­»äº†ä¸€ä¸ªï¼Œä½†è¿˜æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªï¼Œæœ‰ä¸€æ¬¡å¤±è´¥äº†ã€‚ è™½ç„¶åˆ é™¤å¯¹åº”çš„podï¼Œä½†æ˜¯k8sä¼šè®¤ä¸ºè¿™ä¸ªpodæ‰§è¡Œå¤±è´¥ï¼Œé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„podï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åˆ é™¤æºå¤´ cronjobï¼Œç„¶åæ€æ‰æ‰§è¡Œä¸­çš„podã€‚PS: cj æ˜¯ cronjobçš„åˆ«å kubectl delete cj hellokubectl delete pod xxx â€“grace-period 0 â€“force","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kuberneteå®æˆ˜ç¯‡-å…¬å¸ƒåº”ç”¨","path":"/2022/08/22/433/","content":"æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š Ingress LoadBalancer Ingressæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰éƒ¨ç½²Deploymentçš„Serviceï¼Œå…·ä½“å®ç°ï¼š apiVersion: networking.k8s.io/v1kind: Ingressmetadata: # Ingress çš„åå­—ï¼Œä»…ç”¨äºæ ‡è¯† name: sai-ingress spec: # Ingress ä¸­å®šä¹‰ L7 è·¯ç”±è§„åˆ™ rules: # æ ¹æ® virtual hostname è¿›è¡Œè·¯ç”±ï¼ˆè¯·ä½¿ç”¨æ‚¨è‡ªå·±çš„åŸŸåï¼‰ - host: sai.puresai.com http: paths: - path: &quot;/&quot; pathType: Prefix backend: service: name: sai # æŒ‡å®šåç«¯çš„ Service ä¸ºä¹‹å‰åˆ›å»ºçš„ sai port: number: 80 LoadBalanceråœ¨ä½¿ç”¨æ”¯æŒå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„äº‘æä¾›å•†çš„æœåŠ¡æ—¶ï¼Œè®¾ç½®Â typeÂ çš„å€¼ä¸ºÂ &quot;LoadBalancer&quot;ï¼Œ å°†ä¸º Service æä¾›è´Ÿè½½å‡è¡¡å™¨ã€‚ è´Ÿè½½å‡è¡¡å™¨æ˜¯å¼‚æ­¥åˆ›å»ºçš„ï¼Œå…³äºè¢«æä¾›çš„è´Ÿè½½å‡è¡¡å™¨çš„ä¿¡æ¯å°†ä¼šé€šè¿‡ Service çš„Â status.loadBalancerÂ å­—æ®µå‘å¸ƒå‡ºå»ã€‚ apiVersion: v1kind: Servicemetadata: name: sai-lbspec: selector: app: sai ports: - protocol: TCP port: 80 targetPort: 80 clusterIP: 10.0.171.239 type: LoadBalancerstatus: loadBalancer: ingress: - ip: 192.0.2.127 æ¥è‡ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„æµé‡å°†ç›´æ¥é‡å®šå‘åˆ°åç«¯ Pod ä¸Šï¼Œä¸è¿‡å®é™…å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™è¦ä¾èµ–äºäº‘æä¾›å•†ã€‚ æ¯”å¦‚ä½¿ç”¨ucloudï¼š apiVersion: v1kind: Servicemetadata: name: ucloud-nginx-out-tcp-new labels: app: ucloud-nginx-out-tcp-new annotations: # ä»£è¡¨ULBç½‘ç»œç±»å‹ï¼Œouterä¸ºå¤–ç½‘ï¼Œinnerä¸ºå†…ç½‘ï¼›outerä¸ºé»˜è®¤å€¼ï¼Œæ­¤å¤„å¯çœç•¥ã€‚ &quot;service.beta.kubernetes.io/ucloud-load-balancer-type&quot;: &quot;outer&quot; # è¡¨ç¤ºULBåè®®ç±»å‹ï¼Œtcpä¸udpç­‰ä»·ï¼Œè¡¨ç¤ºULB4ï¼›httpä¸httpSç­‰ä»·ï¼Œè¡¨ç¤ºULB7ï¼›tcpä¸ºé»˜è®¤å€¼ï¼Œæ­¤å¤„å¯çœç•¥ã€‚ &quot;service.beta.kubernetes.io/ucloud-load-balancer-vserver-protocol&quot;: &quot;tcp&quot; # bandwidthä¸‹é»˜è®¤ä¸º2Mpbs,å»ºè®®æ˜¾å¼å£°æ˜å¸¦å®½å¤§å°ï¼Œé¿å…è´¹ç”¨è¶…æ ‡ã€‚ &quot;service.beta.kubernetes.io/ucloud-load-balancer-eip-bandwidth&quot;: &quot;2&quot; # ä»˜è´¹æ¨¡å¼ï¼Œæ”¯æŒmonthï¼Œyearï¼Œdynamicï¼Œé»˜è®¤ä¸ºmonth &quot;service.beta.kubernetes.io/ucloud-load-balancer-eip-chargetype&quot;: &quot;month&quot; # ä»˜è´¹æ—¶é•¿ï¼Œé»˜è®¤ä¸º1ï¼Œchargetypeä¸ºdynimicæ—¶æ— æ•ˆ &quot;service.beta.kubernetes.io/ucloud-load-balancer-eip-quantity&quot;: &quot;1&quot; spec: type: LoadBalancer ports: - protocol: TCP port: 80 targetPort: 80 selector: app: ucloud-nginx-out-tcp-new","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kuberneteå®æˆ˜ç¯‡-Deploymentéƒ¨ç½²","path":"/2022/08/11/431/","content":"æˆ‘ä»¬ä»¥éƒ¨ç½²ä¸€ä¸ªå¯è®¿é—®httpæœåŠ¡çš„ä¸ºä¾‹ï¼Œæ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š ConfigMap Service Deployment kubectl port-forward ç¼–å†™yaml# sai-config.yaml# å®šä¹‰ ConfigMapapiVersion: v1kind: ConfigMapmetadata: # å…ƒæ•°æ®ï¼Œå®šä¹‰åŸºæœ¬å±æ€§å’Œä¿¡æ¯ name: sai-config # åç§°data: config.yaml: |- name: sai0556 mode: debug addr: :8080 hi: w~o~w---# å®šä¹‰ ServiceapiVersion: v1kind: Servicemetadata: name: sai labels: # æ ‡ç­¾ app: saispec: # æè¿° ports: - protocol: TCP port: 80 # Serviceçš„è™šæ‹Ÿç«¯å£ targetPort: 8080 # å®¹å™¨æš´éœ²çš„ç«¯å£ selector: # é€‰æ‹©å™¨ï¼Œå¯¹åº”ä¸‹é¢çš„ Deploymentçš„ labels app: sai---# å®šä¹‰ DeploymentapiVersion: apps/v1kind: Deploymentmetadata: name: saispec: replicas: 1 # åˆ›å»ºåº”ç”¨ç¨‹åºå®ä¾‹ä¸ªæ•° selector: # æ ‡ç­¾é€‰æ‹©å™¨ matchLabels: # é€‰æ‹©åŒ…å«æ ‡ç­¾app:saiçš„èµ„æº app: sai template: # æ¨¡æ¿ metadata: labels: app: sai spec: containers: - name: sai image: puresai/k8s-configmap-sai:0.2 imagePullPolicy: IfNotPresent command: - &#x27;/app/puresai&#x27; volumeMounts: # æ•°æ®å·æŒ‚è½½ - name: config mountPath: /app/config.yaml readOnly: true subPath: config.yaml volumes: # æŒ‚è½½çš„å…·ä½“ä¿¡æ¯ï¼Œè¿™é‡Œä½¿ç”¨çš„ configMap - name: config configMap: defaultMode: 0600 name: sai-config åº”ç”¨kubectl apply -f sai-config.yaml æµ‹è¯•ä½¿ç”¨ kubectl æŸ¥çœ‹ kubectl get deploymentkubectl get service æµ‹è¯•ï¼š # port-forward å¯ä»¥å°†é›†ç¾¤æ˜ å°„åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿debugkubectl port-forward svc/sai 8088:80 å¯ä»¥çœ‹åˆ°è¯·æ±‚æ˜¯æˆåŠŸï¼ http://127.0.0.1:8088/ å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ NodePort apiVersion: v1kind: Servicemetadata: name: sai labels: # æ ‡ç­¾ app: saispec: # æè¿° type: NodePort ports: - protocol: TCP port: 8080 nodePort: 31080 selector: app: sai","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kuberneteå®æˆ˜ç¯‡-å¤–éƒ¨æœåŠ¡","path":"/2022/08/10/432/","content":"æ¶‰åŠçš„çŸ¥è¯†ç‚¹ï¼š Service Endpoints å¤–éƒ¨æœåŠ¡ Serviceéœ€æ³¨æ„ Service æ˜¯ä¸€ä¸ªä¸å¸¦ selector çš„ï¼Œå¦åˆ™å°±ä¼šè‡ªåŠ¨åˆ›å»º Endpointï¼Œname ä¿æŒä¸€è‡´å³å¯ã€‚ apiVersion: v1kind: Servicemetadata: name: to-externalspec: type: NodePort ports: - port: 80 nodePort: 31081 protocol: TCP---apiVersion: v1kind: Endpointsmetadata: name: to-externalsubsets:- addresses: - ip: 11.50.24.32 ports: - port: 80 è¿™æ ·å°±å¯ä»¥é€šè¿‡ http://127.0.0.1:31081 è®¿é—®äº†ã€‚","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kubernetesåŸºç¡€ç¯‡-é•œåƒ","path":"/2022/08/01/423/","content":"é•œåƒ imageé•œåƒåç§°å¦‚æœä½ ä¸æŒ‡å®šä»“åº“çš„ä¸»æœºåï¼ŒKubernetes è®¤ä¸ºä½ åœ¨ä½¿ç”¨ Docker å…¬å…±ä»“åº“ã€‚åœ¨é•œåƒåç§°ä¹‹åï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼ˆTagï¼‰ã€‚ é•œåƒæ ‡ç­¾å¯ä»¥åŒ…å«å°å†™å­—æ¯ã€å¤§å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€å¥ç‚¹ï¼ˆ.ï¼‰å’Œè¿å­—ç¬¦ï¼ˆ-ï¼‰ã€‚ å…³äºåœ¨é•œåƒæ ‡ç­¾ä¸­ä½•å¤„å¯ä»¥ä½¿ç”¨åˆ†éš”å­—ç¬¦ï¼ˆ_ã€-Â å’ŒÂ .ï¼‰è¿˜æœ‰ä¸€äº›é¢å¤–çš„è§„åˆ™ã€‚ å¦‚æœä½ ä¸æŒ‡å®šæ ‡ç­¾ï¼ŒKubernetes è®¤ä¸ºä½ æƒ³ä½¿ç”¨æ ‡ç­¾Â latestã€‚ é•œåƒæ‹‰å–ç­–ç•¥imagePullPolicyï¼š IfNotPresentï¼šåªæœ‰å½“é•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨æ—¶æ‰ä¼šæ‹‰å–ã€‚ Alwaysï¼šæ¯å½“ kubelet å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œkubelet ä¼šæŸ¥è¯¢å®¹å™¨çš„é•œåƒä»“åº“ï¼Œ å°†åç§°è§£æä¸ºä¸€ä¸ªé•œåƒæ‘˜è¦ã€‚ å¦‚æœ kubelet æœ‰ä¸€ä¸ªå®¹å™¨é•œåƒï¼Œå¹¶ä¸”å¯¹åº”çš„æ‘˜è¦å·²åœ¨æœ¬åœ°ç¼“å­˜ï¼Œkubelet å°±ä¼šä½¿ç”¨å…¶ç¼“å­˜çš„é•œåƒï¼› å¦åˆ™ï¼Œkubelet å°±ä¼šä½¿ç”¨è§£æåçš„æ‘˜è¦æ‹‰å–é•œåƒï¼Œå¹¶ä½¿ç”¨è¯¥é•œåƒæ¥å¯åŠ¨å®¹å™¨ã€‚ Neverï¼šKubelet ä¸ä¼šå°è¯•è·å–é•œåƒã€‚å¦‚æœé•œåƒå·²ç»ä»¥æŸç§æ–¹å¼å­˜åœ¨æœ¬åœ°ï¼Œ kubelet ä¼šå°è¯•å¯åŠ¨å®¹å™¨ï¼›å¦åˆ™ï¼Œä¼šå¯åŠ¨å¤±è´¥ã€‚ é»˜è®¤é•œåƒæ‹‰å–ç­–ç•¥å½“ä½ ï¼ˆæˆ–æ§åˆ¶å™¨ï¼‰å‘ API æœåŠ¡å™¨æäº¤ä¸€ä¸ªæ–°çš„ Pod æ—¶ï¼Œä½ çš„é›†ç¾¤ä¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è®¾ç½®Â imagePullPolicyÂ å­—æ®µï¼š å¦‚æœä½ çœç•¥äº†Â imagePullPolicyÂ å­—æ®µï¼Œå¹¶ä¸”å®¹å™¨é•œåƒçš„æ ‡ç­¾æ˜¯Â :latestï¼ŒÂ imagePullPolicyÂ ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºÂ Alwaysã€‚ å¦‚æœä½ çœç•¥äº†Â imagePullPolicyÂ å­—æ®µï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå®¹å™¨é•œåƒçš„æ ‡ç­¾ï¼ŒÂ imagePullPolicyÂ ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºÂ Alwaysã€‚ å¦‚æœä½ çœç•¥äº†Â imagePullPolicyÂ å­—æ®µï¼Œå¹¶ä¸”ä¸ºå®¹å™¨é•œåƒæŒ‡å®šäº†éÂ :latestÂ çš„æ ‡ç­¾ï¼ŒÂ imagePullPolicyÂ å°±ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºÂ IfNotPresentã€‚ ä½¿ç”¨ç§æœ‰ä»“åº“ä»ç§æœ‰ä»“åº“è¯»å–é•œåƒæ—¶å¯èƒ½éœ€è¦å¯†é’¥ã€‚ å‡­è¯å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼æä¾›: é…ç½®èŠ‚ç‚¹å‘ç§æœ‰ä»“åº“è¿›è¡Œèº«ä»½éªŒè¯ æ‰€æœ‰ Pod å‡å¯è¯»å–ä»»ä½•å·²é…ç½®çš„ç§æœ‰ä»“åº“ éœ€è¦é›†ç¾¤ç®¡ç†å‘˜é…ç½®èŠ‚ç‚¹ é¢„æ‹‰é•œåƒ æ‰€æœ‰ Pod éƒ½å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ä¸Šç¼“å­˜çš„æ‰€æœ‰é•œåƒ éœ€è¦æ‰€æœ‰èŠ‚ç‚¹çš„ root è®¿é—®æƒé™æ‰èƒ½è¿›è¡Œè®¾ç½® åœ¨ Pod ä¸­è®¾ç½® ImagePullSecrets åªæœ‰æä¾›è‡ªå·±å¯†é’¥çš„ Pod æ‰èƒ½è®¿é—®ç§æœ‰ä»“åº“ ç‰¹å®šäºå‚å•†çš„æ‰©å±•æˆ–è€…æœ¬åœ°æ‰©å±• å¦‚æœä½ åœ¨ä½¿ç”¨å®šåˆ¶çš„èŠ‚ç‚¹é…ç½®ï¼Œä½ ï¼ˆæˆ–è€…äº‘å¹³å°æä¾›å•†ï¼‰å¯ä»¥å®ç°è®©èŠ‚ç‚¹ å‘å®¹å™¨ä»“åº“è®¤è¯çš„æœºåˆ¶ moreé•œåƒ","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kubernetesåŸºç¡€ç¯‡-kubectl","path":"/2022/07/31/422/","content":"kubectlKubectl å‘½ä»¤è¡Œå·¥å…·ç®¡ç† Kubernetes é›†ç¾¤ã€‚ kubectl åœ¨ $HOME/.kube ç›®å½•ä¸­æŸ¥æ‰¾ä¸€ä¸ªåä¸º config çš„é…ç½®æ–‡ä»¶ã€‚ ä½ å¯ä»¥é€šè¿‡è®¾ç½® KUBECONFIG ç¯å¢ƒå˜é‡æˆ–è®¾ç½® â€“kubeconfig å‚æ•°æ¥æŒ‡å®šå…¶å®ƒ kubeconfig æ–‡ä»¶ã€‚ å®‰è£…macOS# installbrew install kubectl # testkubectl version --client# è‡ªåŠ¨è¡¥å…¨å·¥å…·echo source &lt;(kubectl completion zsh) &gt;&gt; ~/.zshrc è¯­æ³•ä½¿ç”¨ä»¥ä¸‹è¯­æ³• kubectl ä»ç»ˆç«¯çª—å£è¿è¡Œå‘½ä»¤ï¼š kubectl [command] [TYPE] [NAME] [flags] å…¶ä¸­ commandã€TYPEã€NAME å’Œ flags åˆ†åˆ«æ˜¯ï¼š commandï¼šæŒ‡å®šè¦å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚ createã€getã€describeã€deleteã€‚ TYPEï¼šæŒ‡å®šèµ„æºç±»å‹ã€‚èµ„æºç±»å‹ä¸åŒºåˆ†å¤§å°å†™ï¼Œ å¯ä»¥æŒ‡å®šå•æ•°ã€å¤æ•°æˆ–ç¼©å†™å½¢å¼ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤è¾“å‡ºç›¸åŒçš„ç»“æœ: kubectl get pod pod1kubectl get pods pod1kubectl get po pod1 NAMEï¼šæŒ‡å®šèµ„æºçš„åç§°ã€‚åç§°åŒºåˆ†å¤§å°å†™ã€‚ å¦‚æœçœç•¥åç§°ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰èµ„æºçš„è¯¦ç»†ä¿¡æ¯ kubectl get podsã€‚ åœ¨å¯¹å¤šä¸ªèµ„æºæ‰§è¡Œæ“ä½œæ—¶ï¼Œä½ å¯ä»¥æŒ‰ç±»å‹å’Œåç§°æŒ‡å®šæ¯ä¸ªèµ„æºï¼Œæˆ–æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼š è¦æŒ‰ç±»å‹å’Œåç§°æŒ‡å®šèµ„æºï¼š è¦å¯¹æ‰€æœ‰ç±»å‹ç›¸åŒçš„èµ„æºè¿›è¡Œåˆ†ç»„ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šTYPE1 name1 name2 name&lt;#&gt;ã€‚ ä¾‹å­ï¼škubectl get pod example-pod1 example-pod2 åˆ†åˆ«æŒ‡å®šå¤šä¸ªèµ„æºç±»å‹ï¼šTYPE1/name1 TYPE1/name2 TYPE2/name3 TYPE&lt;#&gt;/name&lt;#&gt;ã€‚ ä¾‹å­ï¼škubectl get pod/example-pod1 replicationcontroller/example-rc1 ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æŒ‡å®šèµ„æºï¼š-f file1 -f file2 -f file&lt;#&gt; ä½¿ç”¨ YAML è€Œä¸æ˜¯ JSON å› ä¸º YAML æ›´å®¹æ˜“ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”¨äºé…ç½®æ–‡ä»¶æ—¶ã€‚ ä¾‹å­ï¼škubectl get -f ./pod.yaml flags: æŒ‡å®šå¯é€‰çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ -s æˆ– -server å‚æ•°æŒ‡å®š Kubernetes API æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ã€‚ PS: ä»å‘½ä»¤è¡ŒæŒ‡å®šçš„å‚æ•°ä¼šè¦†ç›–é»˜è®¤å€¼å’Œä»»ä½•ç›¸åº”çš„ç¯å¢ƒå˜é‡ã€‚ å¦‚æœä½ éœ€è¦å¸®åŠ©ï¼Œä»ç»ˆç«¯çª—å£è¿è¡Œ kubectl help ã€‚ æŸ¥çœ‹æ›´å¤šæ“ä½œ ç¤ºä¾‹ï¼šå¸¸ç”¨æ“ä½œä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹é›†æ¥å¸®åŠ©ä½ ç†Ÿæ‚‰è¿è¡Œå¸¸ç”¨ kubectl æ“ä½œï¼š kubectl apply - ä»¥æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥ä¸ºå‡†åº”ç”¨æˆ–æ›´æ–°èµ„æºã€‚ # ä½¿ç”¨ example-service.yaml ä¸­çš„å®šä¹‰åˆ›å»ºæœåŠ¡ã€‚kubectl apply -f example-service.yaml# ä½¿ç”¨ example-controller.yaml ä¸­çš„å®šä¹‰åˆ›å»º replication controllerã€‚kubectl apply -f example-controller.yaml# ä½¿ç”¨ &lt;directory&gt; è·¯å¾„ä¸‹çš„ä»»æ„ .yaml, .yml, æˆ– .json æ–‡ä»¶ åˆ›å»ºå¯¹è±¡ã€‚kubectl apply -f &lt;directory&gt; kubectl get - åˆ—å‡ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºã€‚ # ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰ podã€‚kubectl get pods# ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰ podï¼Œå¹¶åŒ…å«é™„åŠ ä¿¡æ¯(å¦‚èŠ‚ç‚¹å)ã€‚kubectl get pods -o wide# ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºå…·æœ‰æŒ‡å®šåç§°çš„å‰¯æœ¬æ§åˆ¶å™¨ã€‚æç¤ºï¼šä½ å¯ä»¥ä½¿ç”¨åˆ«å &#x27;rc&#x27; ç¼©çŸ­å’Œæ›¿æ¢ &#x27;replicationcontroller&#x27; èµ„æºç±»å‹ã€‚kubectl get replicationcontroller &lt;rc-name&gt;# ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰å‰¯æœ¬æ§åˆ¶å™¨å’ŒæœåŠ¡ã€‚kubectl get rc,services# ä»¥çº¯æ–‡æœ¬è¾“å‡ºæ ¼å¼åˆ—å‡ºæ‰€æœ‰å®ˆæŠ¤ç¨‹åºé›†ï¼ŒåŒ…æ‹¬æœªåˆå§‹åŒ–çš„å®ˆæŠ¤ç¨‹åºé›†ã€‚kubectl get ds --include-uninitialized# åˆ—å‡ºåœ¨èŠ‚ç‚¹ server01 ä¸Šè¿è¡Œçš„æ‰€æœ‰ podkubectl get pods --field-selector=spec.nodeName=server01 kubectl describe - æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºçš„è¯¦ç»†çŠ¶æ€ï¼Œé»˜è®¤æƒ…å†µä¸‹åŒ…æ‹¬æœªåˆå§‹åŒ–çš„èµ„æºã€‚ # æ˜¾ç¤ºåç§°ä¸º &lt;node-name&gt; çš„èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚kubectl describe nodes &lt;node-name&gt;# æ˜¾ç¤ºåä¸º &lt;pod-name&gt; çš„ pod çš„è¯¦ç»†ä¿¡æ¯ã€‚kubectl describe pods/&lt;pod-name&gt;# æ˜¾ç¤ºç”±åä¸º &lt;rc-name&gt; çš„å‰¯æœ¬æ§åˆ¶å™¨ç®¡ç†çš„æ‰€æœ‰ pod çš„è¯¦ç»†ä¿¡æ¯ã€‚# è®°ä½ï¼šå‰¯æœ¬æ§åˆ¶å™¨åˆ›å»ºçš„ä»»ä½• pod éƒ½ä»¥å¤åˆ¶æ§åˆ¶å™¨çš„åç§°ä¸ºå‰ç¼€ã€‚kubectl describe pods &lt;rc-name&gt;# æè¿°æ‰€æœ‰çš„ podï¼Œä¸åŒ…æ‹¬æœªåˆå§‹åŒ–çš„ podkubectl describe pods Note: kubectl get å‘½ä»¤é€šå¸¸ç”¨äºæ£€ç´¢åŒä¸€èµ„æºç±»å‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºã€‚ å®ƒå…·æœ‰ä¸°å¯Œçš„å‚æ•°ï¼Œå…è®¸ä½ ä½¿ç”¨ -o æˆ– --output å‚æ•°è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ã€‚ä½ å¯ä»¥æŒ‡å®š -w æˆ– --watch å‚æ•°ä»¥å¼€å§‹è§‚å¯Ÿç‰¹å®šå¯¹è±¡çš„æ›´æ–°ã€‚ kubectl describe å‘½ä»¤æ›´ä¾§é‡äºæè¿°æŒ‡å®šèµ„æºçš„è®¸å¤šç›¸å…³æ–¹é¢ã€‚å®ƒå¯ä»¥è°ƒç”¨å¯¹ API æœåŠ¡å™¨ çš„å¤šä¸ª API è°ƒç”¨æ¥ä¸ºç”¨æˆ·æ„å»ºè§†å›¾ã€‚ ä¾‹å¦‚ï¼Œè¯¥ kubectl describe node å‘½ä»¤ä¸ä»…æ£€ç´¢æœ‰å…³èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿˜æ£€ç´¢åœ¨å…¶ä¸Šè¿è¡Œçš„ pod çš„æ‘˜è¦ï¼Œä¸ºèŠ‚ç‚¹ç”Ÿæˆçš„äº‹ä»¶ç­‰ã€‚ kubectl delete - ä»æ–‡ä»¶ã€stdin æˆ–æŒ‡å®šæ ‡ç­¾é€‰æ‹©å™¨ã€åç§°ã€èµ„æºé€‰æ‹©å™¨æˆ–èµ„æºä¸­åˆ é™¤èµ„æºã€‚ # ä½¿ç”¨ pod.yaml æ–‡ä»¶ä¸­æŒ‡å®šçš„ç±»å‹å’Œåç§°åˆ é™¤ podã€‚kubectl delete -f pod.yaml# åˆ é™¤æ‰€æœ‰å¸¦æœ‰ &#x27;&lt;label-key&gt;=&lt;label-value&gt;&#x27; æ ‡ç­¾çš„ Pod å’ŒæœåŠ¡ã€‚kubectl delete pods,services -l &lt;label-key&gt;=&lt;label-value&gt;# åˆ é™¤æ‰€æœ‰ podï¼ŒåŒ…æ‹¬æœªåˆå§‹åŒ–çš„ podã€‚kubectl delete pods --all kubectl exec - å¯¹ pod ä¸­çš„å®¹å™¨æ‰§è¡Œå‘½ä»¤ã€‚ # ä» pod &lt;pod-name&gt; ä¸­è·å–è¿è¡Œ &#x27;date&#x27; çš„è¾“å‡ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ¥è‡ªç¬¬ä¸€ä¸ªå®¹å™¨ã€‚kubectl exec &lt;pod-name&gt; -- date# è¿è¡Œè¾“å‡º &#x27;date&#x27; è·å–åœ¨å®¹å™¨çš„ &lt;container-name&gt; ä¸­ pod &lt;pod-name&gt; çš„è¾“å‡ºã€‚kubectl exec &lt;pod-name&gt; -c &lt;container-name&gt; -- date# è·å–ä¸€ä¸ªäº¤äº’ TTY å¹¶è¿è¡Œ /bin/bash &lt;pod-name &gt;ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ¥è‡ªç¬¬ä¸€ä¸ªå®¹å™¨ã€‚kubectl exec -ti &lt;pod-name&gt; -- /bin/bash kubectl logs - æ‰“å° Pod ä¸­å®¹å™¨çš„æ—¥å¿—ã€‚ # ä» pod è¿”å›æ—¥å¿—å¿«ç…§ã€‚kubectl logs &lt;pod-name&gt;# ä» pod &lt;pod-name&gt; å¼€å§‹æµå¼ä¼ è¾“æ—¥å¿—ã€‚è¿™ç±»ä¼¼äº &#x27;tail -f&#x27; Linux å‘½ä»¤ã€‚kubectl logs -f &lt;pod-name&gt;","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kubernetesåŸºç¡€ç¯‡-ç»„ä»¶","path":"/2022/07/29/422/","content":"Kubernetesç»„ä»¶æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯¹é›†ç¾¤åšå‡ºå…¨å±€å†³ç­–(æ¯”å¦‚è°ƒåº¦)ï¼Œä»¥åŠæ£€æµ‹å’Œå“åº”é›†ç¾¤äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼Œå½“ä¸æ»¡è¶³éƒ¨ç½²çš„ replicas å­—æ®µæ—¶ï¼Œå¯åŠ¨æ–°çš„ podï¼‰ã€‚ æ§åˆ¶å¹³é¢ç»„ä»¶å¯ä»¥åœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ ç„¶è€Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œè®¾ç½®è„šæœ¬é€šå¸¸ä¼šåœ¨åŒä¸€ä¸ªè®¡ç®—æœºä¸Šå¯åŠ¨æ‰€æœ‰æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œ å¹¶ä¸”ä¸ä¼šåœ¨æ­¤è®¡ç®—æœºä¸Šè¿è¡Œç”¨æˆ·å®¹å™¨ã€‚ è¯·å‚é˜…ä½¿ç”¨ kubeadm æ„å»ºé«˜å¯ç”¨æ€§é›†ç¾¤ ä¸­å…³äºè·¨å¤šæœºå™¨æ§åˆ¶å¹³é¢è®¾ç½®çš„ç¤ºä¾‹ã€‚ kube-apiserverAPI æœåŠ¡å™¨æ˜¯ Kubernetes æ§åˆ¶é¢çš„ç»„ä»¶ï¼Œ è¯¥ç»„ä»¶å…¬å¼€äº† Kubernetes APIã€‚ API æœåŠ¡å™¨æ˜¯ Kubernetes æ§åˆ¶é¢çš„å‰ç«¯ã€‚ Kubernetes API æœåŠ¡å™¨çš„ä¸»è¦å®ç°æ˜¯ kube-apiserverã€‚ kube-apiserver è®¾è®¡ä¸Šè€ƒè™‘äº†æ°´å¹³ä¼¸ç¼©ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯é€šè¿‡éƒ¨ç½²å¤šä¸ªå®ä¾‹è¿›è¡Œä¼¸ç¼©ã€‚ ä½ å¯ä»¥è¿è¡Œ kube-apiserver çš„å¤šä¸ªå®ä¾‹ï¼Œå¹¶åœ¨è¿™äº›å®ä¾‹ä¹‹é—´å¹³è¡¡æµé‡ã€‚ etcdetcd æ˜¯å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ã€‚ æ‚¨çš„ Kubernetes é›†ç¾¤çš„ etcd æ•°æ®åº“é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’ã€‚ è¦äº†è§£ etcd æ›´æ·±å±‚æ¬¡çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ etcd æ–‡æ¡£ã€‚ kube-scheduleræ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œè´Ÿè´£ç›‘è§†æ–°åˆ›å»ºçš„ã€æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹ï¼ˆnodeï¼‰çš„ Podsï¼Œé€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œã€‚ è°ƒåº¦å†³ç­–è€ƒè™‘çš„å› ç´ åŒ…æ‹¬å•ä¸ª Pod å’Œ Pod é›†åˆçš„èµ„æºéœ€æ±‚ã€ç¡¬ä»¶/è½¯ä»¶/ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®ä½ç½®ã€å·¥ä½œè´Ÿè½½é—´çš„å¹²æ‰°å’Œæœ€åæ—¶é™ã€‚ kube-controller-managerè¿è¡Œæ§åˆ¶å™¨è¿›ç¨‹çš„æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚ ä»é€»è¾‘ä¸Šè®²ï¼Œæ¯ä¸ªæ§åˆ¶å™¨éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œ ä½†æ˜¯ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œå®ƒä»¬éƒ½è¢«ç¼–è¯‘åˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œã€‚ è¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬: èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: è´Ÿè´£åœ¨èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº” ä»»åŠ¡æ§åˆ¶å™¨ï¼ˆJob controllerï¼‰: ç›‘æµ‹ä»£è¡¨ä¸€æ¬¡æ€§ä»»åŠ¡çš„ Job å¯¹è±¡ï¼Œç„¶ååˆ›å»º Pods æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ç›´è‡³å®Œæˆ ç«¯ç‚¹æ§åˆ¶å™¨ï¼ˆEndpoints Controllerï¼‰: å¡«å……ç«¯ç‚¹(Endpoints)å¯¹è±¡(å³åŠ å…¥ Service ä¸ Pod) æœåŠ¡å¸æˆ·å’Œä»¤ç‰Œæ§åˆ¶å™¨ï¼ˆService Account &amp; Token Controllersï¼‰: ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤å¸æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ cloud-controller-manageräº‘æ§åˆ¶å™¨ç®¡ç†å™¨æ˜¯æŒ‡åµŒå…¥ç‰¹å®šäº‘çš„æ§åˆ¶é€»è¾‘çš„ æ§åˆ¶å¹³é¢ç»„ä»¶ã€‚ äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ä½¿å¾—ä½ å¯ä»¥å°†ä½ çš„é›†ç¾¤è¿æ¥åˆ°äº‘æä¾›å•†çš„ API ä¹‹ä¸Šï¼Œ å¹¶å°†ä¸è¯¥äº‘å¹³å°äº¤äº’çš„ç»„ä»¶åŒä¸ä½ çš„é›†ç¾¤äº¤äº’çš„ç»„ä»¶åˆ†ç¦»å¼€æ¥ã€‚ cloud-controller-manager ä»…è¿è¡Œç‰¹å®šäºäº‘å¹³å°çš„æ§åˆ¶å›è·¯ã€‚ å¦‚æœä½ åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­è¿è¡Œ Kubernetesï¼Œæˆ–è€…åœ¨æœ¬åœ°è®¡ç®—æœºä¸­è¿è¡Œå­¦ä¹ ç¯å¢ƒï¼Œ æ‰€éƒ¨ç½²çš„ç¯å¢ƒä¸­ä¸éœ€è¦äº‘æ§åˆ¶å™¨ç®¡ç†å™¨ã€‚ ä¸ kube-controller-manager ç±»ä¼¼ï¼Œcloud-controller-manager å°†è‹¥å¹²é€»è¾‘ä¸Šç‹¬ç«‹çš„ æ§åˆ¶å›è·¯ç»„åˆåˆ°åŒä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¾›ä½ ä»¥åŒä¸€è¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚ ä½ å¯ä»¥å¯¹å…¶æ‰§è¡Œæ°´å¹³æ‰©å®¹ï¼ˆè¿è¡Œä¸æ­¢ä¸€ä¸ªå‰¯æœ¬ï¼‰ä»¥æå‡æ€§èƒ½æˆ–è€…å¢å¼ºå®¹é”™èƒ½åŠ›ã€‚ ä¸‹é¢çš„æ§åˆ¶å™¨éƒ½åŒ…å«å¯¹äº‘å¹³å°é©±åŠ¨çš„ä¾èµ–ï¼š èŠ‚ç‚¹æ§åˆ¶å™¨ï¼ˆNode Controllerï¼‰: ç”¨äºåœ¨èŠ‚ç‚¹ç»ˆæ­¢å“åº”åæ£€æŸ¥äº‘æä¾›å•†ä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å·²è¢«åˆ é™¤ è·¯ç”±æ§åˆ¶å™¨ï¼ˆRoute Controllerï¼‰: ç”¨äºåœ¨åº•å±‚äº‘åŸºç¡€æ¶æ„ä¸­è®¾ç½®è·¯ç”± æœåŠ¡æ§åˆ¶å™¨ï¼ˆService Controllerï¼‰: ç”¨äºåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤äº‘æä¾›å•†è´Ÿè½½å‡è¡¡å™¨ Node ç»„ä»¶èŠ‚ç‚¹ç»„ä»¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‚ kubeletä¸€ä¸ªåœ¨é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ï¼ˆnodeï¼‰ä¸Šè¿è¡Œçš„ä»£ç†ã€‚ å®ƒä¿è¯å®¹å™¨ï¼ˆcontainersï¼‰éƒ½ è¿è¡Œåœ¨ Pod ä¸­ã€‚ kubelet æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿è¿™äº› PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ kubelet ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ã€‚ kube-proxykube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œ å®ç° Kubernetes æœåŠ¡ï¼ˆServiceï¼‰ æ¦‚å¿µçš„ä¸€éƒ¨åˆ†ã€‚ kube-proxy ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ã€‚è¿™äº›ç½‘ç»œè§„åˆ™å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ å¦‚æœæ“ä½œç³»ç»Ÿæä¾›äº†æ•°æ®åŒ…è¿‡æ»¤å±‚å¹¶å¯ç”¨çš„è¯ï¼Œkube-proxy ä¼šé€šè¿‡å®ƒæ¥å®ç°ç½‘ç»œè§„åˆ™ã€‚å¦åˆ™ï¼Œ kube-proxy ä»…è½¬å‘æµé‡æœ¬èº«ã€‚ å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰å®¹å™¨è¿è¡Œç¯å¢ƒæ˜¯è´Ÿè´£è¿è¡Œå®¹å™¨çš„è½¯ä»¶ã€‚ Kubernetes æ”¯æŒå®¹å™¨è¿è¡Œæ—¶ï¼Œä¾‹å¦‚ Dockerã€ containerdã€CRI-O ä»¥åŠ Kubernetes CRI (å®¹å™¨è¿è¡Œç¯å¢ƒæ¥å£) çš„å…¶ä»–ä»»ä½•å®ç°ã€‚ æ’ä»¶ï¼ˆAddonsï¼‰æ’ä»¶ä½¿ç”¨ Kubernetes èµ„æºï¼ˆDaemonSetã€ Deploymentç­‰ï¼‰å®ç°é›†ç¾¤åŠŸèƒ½ã€‚ å› ä¸ºè¿™äº›æ’ä»¶æä¾›é›†ç¾¤çº§åˆ«çš„åŠŸèƒ½ï¼Œæ’ä»¶ä¸­å‘½åç©ºé—´åŸŸçš„èµ„æºå±äº kube-system å‘½åç©ºé—´ã€‚ ä¸‹é¢æè¿°ä¼—å¤šæ’ä»¶ä¸­çš„å‡ ç§ã€‚æœ‰å…³å¯ç”¨æ’ä»¶çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§ æ’ä»¶ï¼ˆAddonsï¼‰ã€‚ DNSå°½ç®¡å…¶ä»–æ’ä»¶éƒ½å¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„å¿…éœ€ç»„ä»¶ï¼Œä½†å‡ ä¹æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”è¯¥ æœ‰é›†ç¾¤ DNSï¼Œ å› ä¸ºå¾ˆå¤šç¤ºä¾‹éƒ½éœ€è¦ DNS æœåŠ¡ã€‚ é›†ç¾¤ DNS æ˜¯ä¸€ä¸ª DNS æœåŠ¡å™¨ï¼Œå’Œç¯å¢ƒä¸­çš„å…¶ä»– DNS æœåŠ¡å™¨ä¸€èµ·å·¥ä½œï¼Œå®ƒä¸º Kubernetes æœåŠ¡æä¾› DNS è®°å½•ã€‚ Kubernetes å¯åŠ¨çš„å®¹å™¨è‡ªåŠ¨å°†æ­¤ DNS æœåŠ¡å™¨åŒ…å«åœ¨å…¶ DNS æœç´¢åˆ—è¡¨ä¸­ã€‚ Web ç•Œé¢Dashboard æ˜¯ Kubernetes é›†ç¾¤çš„é€šç”¨çš„ã€åŸºäº Web çš„ç”¨æˆ·ç•Œé¢ã€‚ å®ƒä½¿ç”¨æˆ·å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥åŠé›†ç¾¤æœ¬èº«å¹¶è¿›è¡Œæ•…éšœæ’é™¤ã€‚ Kuboard æ˜¯ä¸€æ¬¾åŸºäºKubernetesçš„å¾®æœåŠ¡ç®¡ç†ç•Œé¢ï¼Œç›¸è¾ƒäºDashboard æ¦‚å¿µæ›´å¼ºå¤§ã€‚ å®¹å™¨èµ„æºç›‘æ§å®¹å™¨èµ„æºç›‘æ§ å°†å…³äºå®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ•°æ®åº“ä¸­ï¼Œå¹¶æä¾›ç”¨äºæµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢ã€‚ é›†ç¾¤å±‚é¢æ—¥å¿—é›†ç¾¤å±‚é¢æ—¥å¿— æœºåˆ¶è´Ÿè´£å°†å®¹å™¨çš„æ—¥å¿—æ•°æ® ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­ï¼Œè¯¥å­˜å‚¨èƒ½å¤Ÿæä¾›æœç´¢å’Œæµè§ˆæ¥å£ã€‚","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"kubernetesåŸºç¡€ç¯‡-æ¦‚å¿µ","path":"/2022/07/24/421/","content":"Kubernetes æ˜¯ä»€ä¹ˆï¼ŸKubernetes æ˜¯ç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼Œæ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¼€æºç³»ç»Ÿã€‚ Kubernetes è¿™ä¸ªåå­—æºäºå¸Œè…Šè¯­ï¼Œæ„ä¸ºâ€œèˆµæ‰‹â€æˆ–â€œé£è¡Œå‘˜â€ã€‚k8s è¿™ä¸ªç¼©å†™æ˜¯å› ä¸º k å’Œ s ä¹‹é—´æœ‰å…«ä¸ªå­—ç¬¦çš„å…³ç³»ã€‚ Kubernetesåœ¨ 2014 å¹´å®ç°å¼€æºï¼Œæºè‡ªGoogleå†…éƒ¨ç¼–æ’å·¥å…· Borg ã€‚ éƒ¨ç½²å›æº¯1. ä¼ ç»Ÿéƒ¨ç½²æ—¶ä»£ï¼š æ—©æœŸï¼Œå„ä¸ªç»„ç»‡æœºæ„åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚æ— æ³•ä¸ºç‰©ç†æœåŠ¡å™¨ä¸­çš„åº”ç”¨ç¨‹åºå®šä¹‰èµ„æºè¾¹ç•Œï¼Œè¿™ä¼šå¯¼è‡´èµ„æºåˆ†é…é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåº”ç”¨ç¨‹åºå ç”¨å¤§éƒ¨åˆ†èµ„æºçš„æƒ…å†µï¼Œ ç»“æœå¯èƒ½å¯¼è‡´å…¶ä»–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¸‹é™ã€‚ ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œæ¯ä¸ªåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ç”±äºèµ„æºåˆ©ç”¨ä¸è¶³è€Œæ— æ³•æ‰©å±•ï¼Œ å¹¶ä¸”ç»´æŠ¤è®¸å¤šç‰©ç†æœåŠ¡å™¨çš„æˆæœ¬å¾ˆé«˜ã€‚ 2. è™šæ‹ŸåŒ–éƒ¨ç½²æ—¶ä»£ï¼š ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œå¼•å…¥äº†è™šæ‹ŸåŒ–ã€‚è™šæ‹ŸåŒ–æŠ€æœ¯å…è®¸ä½ åœ¨å•ä¸ªç‰©ç†æœåŠ¡å™¨çš„ CPU ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰ã€‚ è™šæ‹ŸåŒ–å…è®¸åº”ç”¨ç¨‹åºåœ¨ VM ä¹‹é—´éš”ç¦»ï¼Œå¹¶æä¾›ä¸€å®šç¨‹åº¦çš„å®‰å…¨ï¼Œå› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ ä¸èƒ½è¢«å¦ä¸€åº”ç”¨ç¨‹åºéšæ„è®¿é—®ã€‚ è™šæ‹ŸåŒ–æŠ€æœ¯èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç‰©ç†æœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¹¶ä¸”å› ä¸ºå¯è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°åº”ç”¨ç¨‹åº è€Œå¯ä»¥å®ç°æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ï¼Œé™ä½ç¡¬ä»¶æˆæœ¬ç­‰ç­‰ã€‚ æ¯ä¸ª VM æ˜¯ä¸€å°å®Œæ•´çš„è®¡ç®—æœºï¼Œåœ¨è™šæ‹ŸåŒ–ç¡¬ä»¶ä¹‹ä¸Šè¿è¡Œæ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬å…¶è‡ªå·±çš„æ“ä½œç³»ç»Ÿã€‚ 3. å®¹å™¨éƒ¨ç½²æ—¶ä»£ï¼š å®¹å™¨ç±»ä¼¼äº VMï¼Œä½†æ˜¯å®ƒä»¬å…·æœ‰è¢«æ”¾å®½çš„éš”ç¦»å±æ€§ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ã€‚ å› æ­¤ï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„ã€‚å®¹å™¨ä¸ VM ç±»ä¼¼ï¼Œå…·æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ã€‚ ç”±äºå®ƒä»¬ä¸åŸºç¡€æ¶æ„åˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥è·¨äº‘å’Œ OS å‘è¡Œç‰ˆæœ¬è¿›è¡Œç§»æ¤ã€‚ å®¹å™¨å› å…·æœ‰è®¸å¤šä¼˜åŠ¿è€Œå˜å¾—æµè¡Œèµ·æ¥ã€‚ä¸‹é¢åˆ—å‡ºçš„æ˜¯å®¹å™¨çš„ä¸€äº›å¥½å¤„ï¼š æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½²ï¼šä¸ä½¿ç”¨ VM é•œåƒç›¸æ¯”ï¼Œæé«˜äº†å®¹å™¨é•œåƒåˆ›å»ºçš„ç®€ä¾¿æ€§å’Œæ•ˆç‡ã€‚ æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²ï¼šé€šè¿‡å¿«é€Ÿç®€å•çš„å›æ»šï¼ˆç”±äºé•œåƒä¸å¯å˜æ€§ï¼‰ï¼Œæ”¯æŒå¯é ä¸”é¢‘ç¹çš„ å®¹å™¨é•œåƒæ„å»ºå’Œéƒ¨ç½²ã€‚ å…³æ³¨å¼€å‘ä¸è¿ç»´çš„åˆ†ç¦»ï¼šåœ¨æ„å»º/å‘å¸ƒæ—¶è€Œä¸æ˜¯åœ¨éƒ¨ç½²æ—¶åˆ›å»ºåº”ç”¨ç¨‹åºå®¹å™¨é•œåƒï¼Œ ä»è€Œå°†åº”ç”¨ç¨‹åºä¸åŸºç¡€æ¶æ„åˆ†ç¦»ã€‚ å¯è§‚å¯Ÿæ€§ï¼šä¸ä»…å¯ä»¥æ˜¾ç¤ºæ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¿¡æ¯å’ŒæŒ‡æ ‡ï¼Œè¿˜å¯ä»¥æ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µå’Œå…¶ä»–æŒ‡æ ‡ä¿¡å·ã€‚ è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§çš„ç¯å¢ƒä¸€è‡´æ€§ï¼šåœ¨ä¾¿æºå¼è®¡ç®—æœºä¸Šä¸åœ¨äº‘ä¸­ç›¸åŒåœ°è¿è¡Œã€‚ è·¨äº‘å’Œæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆæœ¬çš„å¯ç§»æ¤æ€§ï¼šå¯åœ¨ Ubuntuã€RHELã€CoreOSã€æœ¬åœ°ã€ Google Kubernetes Engine å’Œå…¶ä»–ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒçš„ç®¡ç†ï¼šæé«˜æŠ½è±¡çº§åˆ«ï¼Œä»åœ¨è™šæ‹Ÿç¡¬ä»¶ä¸Šè¿è¡Œ OS åˆ°ä½¿ç”¨é€»è¾‘èµ„æºåœ¨ OS ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚ æ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡ï¼šåº”ç”¨ç¨‹åºè¢«åˆ†è§£æˆè¾ƒå°çš„ç‹¬ç«‹éƒ¨åˆ†ï¼Œ å¹¶ä¸”å¯ä»¥åŠ¨æ€éƒ¨ç½²å’Œç®¡ç† - è€Œä¸æ˜¯åœ¨ä¸€å°å¤§å‹å•æœºä¸Šæ•´ä½“è¿è¡Œã€‚ èµ„æºéš”ç¦»ï¼šå¯é¢„æµ‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚ èµ„æºåˆ©ç”¨ï¼šé«˜æ•ˆç‡å’Œé«˜å¯†åº¦ã€‚ Kubernetesçš„åŠŸèƒ½Kubernetes æä¾›ä»¥ä¸‹ç‰¹æ€§: æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ å­˜å‚¨ç¼–æ’ è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š è‡ªåŠ¨å®Œæˆé›†è£…è®¡ç®— è‡ªæˆ‘ä¿®å¤ å¯†é’¥ä¸é…ç½®ç®¡ç† Kubernetes çš„è¾¹ç•ŒKubernetes ä¸æ˜¯ä¼ ç»Ÿçš„ã€åŒ…ç½—ä¸‡è±¡çš„ PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ç³»ç»Ÿã€‚ ç”±äº Kubernetes åœ¨å®¹å™¨çº§åˆ«è€Œä¸æ˜¯åœ¨ç¡¬ä»¶çº§åˆ«è¿è¡Œï¼Œå®ƒæä¾›äº† PaaS äº§å“å…±æœ‰çš„ä¸€äº›æ™®éé€‚ç”¨çš„åŠŸèƒ½ï¼Œ ä¾‹å¦‚éƒ¨ç½²ã€æ‰©å±•ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘è§†ã€‚ ä½†æ˜¯ï¼ŒKubernetes ä¸æ˜¯å•ä½“ç³»ç»Ÿï¼Œé»˜è®¤è§£å†³æ–¹æ¡ˆéƒ½æ˜¯å¯é€‰å’Œå¯æ’æ‹”çš„ã€‚ Kubernetes æä¾›äº†æ„å»ºå¼€å‘äººå‘˜å¹³å°çš„åŸºç¡€ï¼Œä½†æ˜¯åœ¨é‡è¦çš„åœ°æ–¹ä¿ç•™äº†ç”¨æˆ·çš„é€‰æ‹©å’Œçµæ´»æ€§ã€‚ Kubernetesï¼š ä¸é™åˆ¶æ”¯æŒçš„åº”ç”¨ç¨‹åºç±»å‹ã€‚ Kubernetes æ—¨åœ¨æ”¯æŒæå…¶å¤šç§å¤šæ ·çš„å·¥ä½œè´Ÿè½½ï¼ŒåŒ…æ‹¬æ— çŠ¶æ€ã€æœ‰çŠ¶æ€å’Œæ•°æ®å¤„ç†å·¥ä½œè´Ÿè½½ã€‚ å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å¯ä»¥åœ¨ Kubernetes ä¸Šå¾ˆå¥½åœ°è¿è¡Œã€‚ ä¸éƒ¨ç½²æºä»£ç ï¼Œä¹Ÿä¸æ„å»ºä½ çš„åº”ç”¨ç¨‹åºã€‚ æŒç»­é›†æˆ(CI)ã€äº¤ä»˜å’Œéƒ¨ç½²ï¼ˆCI/CDï¼‰å·¥ä½œæµå–å†³äºç»„ç»‡çš„æ–‡åŒ–å’Œåå¥½ä»¥åŠæŠ€æœ¯è¦æ±‚ã€‚ ä¸æä¾›åº”ç”¨ç¨‹åºçº§åˆ«çš„æœåŠ¡ä½œä¸ºå†…ç½®æœåŠ¡ï¼Œä¾‹å¦‚ä¸­é—´ä»¶ï¼ˆä¾‹å¦‚ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼‰ã€ æ•°æ®å¤„ç†æ¡†æ¶ï¼ˆä¾‹å¦‚ï¼ŒSparkï¼‰ã€æ•°æ®åº“ï¼ˆä¾‹å¦‚ï¼Œmysqlï¼‰ã€ç¼“å­˜ã€é›†ç¾¤å­˜å‚¨ç³»ç»Ÿ ï¼ˆä¾‹å¦‚ï¼ŒCephï¼‰ã€‚è¿™æ ·çš„ç»„ä»¶å¯ä»¥åœ¨ Kubernetes ä¸Šè¿è¡Œï¼Œå¹¶ä¸”/æˆ–è€…å¯ä»¥ç”±è¿è¡Œåœ¨ Kubernetes ä¸Šçš„åº”ç”¨ç¨‹åºé€šè¿‡å¯ç§»æ¤æœºåˆ¶ï¼ˆä¾‹å¦‚ï¼Œ å¼€æ”¾æœåŠ¡ä»£ç†ï¼‰æ¥è®¿é—®ã€‚ ä¸è¦æ±‚æ—¥å¿—è®°å½•ã€ç›‘è§†æˆ–è­¦æŠ¥è§£å†³æ–¹æ¡ˆã€‚ å®ƒæä¾›äº†ä¸€äº›é›†æˆä½œä¸ºæ¦‚å¿µè¯æ˜ï¼Œå¹¶æä¾›äº†æ”¶é›†å’Œå¯¼å‡ºæŒ‡æ ‡çš„æœºåˆ¶ã€‚ ä¸æä¾›æˆ–ä¸è¦æ±‚é…ç½®è¯­è¨€/ç³»ç»Ÿï¼ˆä¾‹å¦‚ jsonnetï¼‰ï¼Œå®ƒæä¾›äº†å£°æ˜æ€§ APIï¼Œ è¯¥å£°æ˜æ€§ API å¯ä»¥ç”±ä»»æ„å½¢å¼çš„å£°æ˜æ€§è§„èŒƒæ‰€æ„æˆã€‚ ä¸æä¾›ä¹Ÿä¸é‡‡ç”¨ä»»ä½•å…¨é¢çš„æœºå™¨é…ç½®ã€ç»´æŠ¤ã€ç®¡ç†æˆ–è‡ªæˆ‘ä¿®å¤ç³»ç»Ÿã€‚ æ­¤å¤–ï¼ŒKubernetes ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–æ’ç³»ç»Ÿï¼Œå®é™…ä¸Šå®ƒæ¶ˆé™¤äº†ç¼–æ’çš„éœ€è¦ã€‚ ç¼–æ’çš„æŠ€æœ¯å®šä¹‰æ˜¯æ‰§è¡Œå·²å®šä¹‰çš„å·¥ä½œæµç¨‹ï¼šé¦–å…ˆæ‰§è¡Œ Aï¼Œç„¶åæ‰§è¡Œ Bï¼Œå†æ‰§è¡Œ Cã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼ŒKubernetes åŒ…å«ä¸€ç»„ç‹¬ç«‹çš„ã€å¯ç»„åˆçš„æ§åˆ¶è¿‡ç¨‹ï¼Œ è¿™äº›è¿‡ç¨‹è¿ç»­åœ°å°†å½“å‰çŠ¶æ€é©±åŠ¨åˆ°æ‰€æä¾›çš„æ‰€éœ€çŠ¶æ€ã€‚ å¦‚ä½•ä» A åˆ° C çš„æ–¹å¼æ— å…³ç´§è¦ï¼Œä¹Ÿä¸éœ€è¦é›†ä¸­æ§åˆ¶ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ ä¸”åŠŸèƒ½æ›´å¼ºå¤§ã€ç³»ç»Ÿæ›´å¥å£®ã€æ›´ä¸ºå¼¹æ€§å’Œå¯æ‰©å±•ã€‚","tags":["k8s-learing"],"categories":["k8s-learing"]},{"title":"jwtéªŒè¯å¤±è´¥çš„é—®é¢˜","path":"/2022/07/20/410/","content":"jwt åº”è¯¥æ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸­ä¹Ÿæœ‰ç”¨åˆ°ï¼Œæœ€è¿‘å‡ºç°å‡ æ¬¡é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹ï¼Œæˆ–è®¸èƒ½å¸®åŠ©åˆ°å¤§å®¶ã€‚ PS: æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ github.com/dgrijalva/jwt-go Token not active yetå‰é¢å‡ ä¸ªæœˆå‡ºç°è¿‡æç¤º Token not active yetï¼Œåé¢è¶Šæ¥è¶Šé¢‘ç¹ï¼ŒåŸå› å…¶å®å°±æ˜¯ nbf è¿™ä¸ªæ—¶é—´æˆ³æ¯”éªŒè¯ jwt çš„æ—¶é—´è¿Ÿã€‚ Token used before issued, Couldnâ€™t handle this tokenè¿™ä¸¤å¤©å‡ºç°ä¸€æ¬¡ Couldnâ€™t handle this tokenï¼Œ æ‰“å°æ—¥å¿—çŸ¥é“æ˜¯ Token used before issuedï¼ŒåŸå› æ˜¯ iat è¿™ä¸ªæ—¶é—´æˆ³æ¯”éªŒè¯ jwt çš„æ—¶é—´è¿Ÿã€‚ å…¶å®è§£å†³æ¯”è¾ƒç®€å•ï¼ŒæŠŠé‚£ä¸¤ä¸ªæ—¶é—´å‡å»60sã€‚ æ ¹æœ¬åŸå› åº”è¯¥æ˜¯å¤šå°æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´ï¼Œå¯èƒ½å·®äº†ä¸€ä¸¢ä¸¢ï¼Œå‡ºç°ç­¾å‘æ—¶é—´æ¯”éªŒè¯æ—¶é—´è¿Ÿçš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åŒæ­¥æ—¶é—´ï¼ˆæˆ‘ä¸ºå•¥ä¸ç”¨â€”å› ä¸ºæœ‰ç‚¹éº»çƒ¦ï¼‰ jwt æ–‡æ¡£å’Œå·¥å…·å‚è€ƒï¼š rfc7519 jwt.io","tags":["jwt"],"categories":["jwt"]},{"title":"æ·±å…¥å‰–æKubernetesä¹‹Pod","path":"/2022/07/05/409/","content":"Podï¼Œæ˜¯ Kubernetes é¡¹ç›®ä¸­çš„æœ€å°ç¼–æ’å•ä½ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ‰®æ¼”ä¼ ç»ŸåŸºç¡€è®¾æ–½é‡Œâ€œè™šæ‹Ÿæœºâ€çš„è§’è‰²ï¼›è€Œå®¹å™¨ï¼Œåˆ™æ˜¯è¿™ä¸ªè™šæ‹Ÿæœºé‡Œè¿è¡Œçš„ç”¨æˆ·ç¨‹åºã€‚ å‡¡æ˜¯è°ƒåº¦ã€ç½‘ç»œã€å­˜å‚¨ï¼Œä»¥åŠå®‰å…¨ç›¸å…³çš„å±æ€§ï¼ŒåŸºæœ¬ä¸Šæ˜¯ Pod çº§åˆ«çš„ã€‚ ğŸŒ° apiVersion: v1kind: Podmetadata: name: lifecycle-demospec: containers: - name: lifecycle-demo-container image: nginx lifecycle: postStart: exec: command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;echo Hello from the postStart handler &gt; /usr/share/message&quot;] preStop: exec: command: [&quot;/usr/sbin/nginx&quot;,&quot;-s&quot;,&quot;quit&quot;] ç”Ÿå‘½å‘¨æœŸPod ç”Ÿå‘½å‘¨æœŸï¼š(ä¸»è¦ä½“ç°åœ¨ Pod API å¯¹è±¡çš„Status éƒ¨åˆ†) Pendingã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼ŒPod çš„ YAML æ–‡ä»¶å·²ç»æäº¤ç»™äº† Kubernetesï¼ŒAPI å¯¹è±¡å·²ç»è¢«åˆ›å»ºå¹¶ä¿å­˜åœ¨ Etcd å½“ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ª Pod é‡Œæœ‰äº›å®¹å™¨å› ä¸ºæŸç§åŸå› è€Œä¸èƒ½è¢«é¡ºåˆ©åˆ›å»ºã€‚æ¯”å¦‚ï¼Œè°ƒåº¦ä¸æˆåŠŸã€‚ Runningã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒPod å·²ç»è°ƒåº¦æˆåŠŸï¼Œè·Ÿä¸€ä¸ªå…·ä½“çš„èŠ‚ç‚¹ç»‘å®šã€‚å®ƒåŒ…å«çš„å®¹å™¨éƒ½å·²ç»åˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­ã€‚ Succeededã€‚è¿™ä¸ªçŠ¶æ€æ„å‘³ç€ï¼ŒPod é‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”å·²ç»é€€å‡ºäº†ã€‚è¿™ç§æƒ…å†µåœ¨è¿è¡Œä¸€æ¬¡æ€§ä»»åŠ¡æ—¶æœ€ä¸ºå¸¸è§ã€‚ Failedã€‚è¿™ä¸ªçŠ¶æ€ä¸‹ï¼ŒPod é‡Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥ä¸æ­£å¸¸çš„çŠ¶æ€ï¼ˆé 0 çš„è¿”å›ç ï¼‰é€€å‡ºã€‚è¿™ä¸ªçŠ¶æ€çš„å‡ºç°ï¼Œæ„å‘³ç€ä½ å¾—æƒ³åŠæ³• Debug è¿™ä¸ªå®¹å™¨çš„åº”ç”¨ï¼Œæ¯”å¦‚æŸ¥çœ‹ Pod çš„ Events å’Œæ—¥å¿—ã€‚ Unknownã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸çŠ¶æ€ï¼Œæ„å‘³ç€ Pod çš„çŠ¶æ€ä¸èƒ½æŒç»­åœ°è¢« kubelet æ±‡æŠ¥ç»™ kube-apiserverï¼Œè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ä¸»ä»èŠ‚ç‚¹ï¼ˆMaster å’Œ Kubeletï¼‰é—´çš„é€šä¿¡å‡ºç°äº†é—®é¢˜ã€‚ æ›´è¿›ä¸€æ­¥åœ°ï¼ŒPod å¯¹è±¡çš„ Status å­—æ®µï¼Œè¿˜å¯ä»¥å†ç»†åˆ†å‡ºä¸€ç»„ Conditionsã€‚è¿™äº›ç»†åˆ†çŠ¶æ€çš„å€¼åŒ…æ‹¬ï¼šPodScheduledã€Readyã€Initializedï¼Œä»¥åŠ Unschedulableã€‚å®ƒä»¬ä¸»è¦ç”¨äºæè¿°é€ æˆå½“å‰ Status çš„å…·ä½“åŸå› æ˜¯ä»€ä¹ˆã€‚ æ¯”å¦‚ï¼ŒPod å½“å‰çš„ Status æ˜¯ Pendingï¼Œå¯¹åº”çš„ Condition æ˜¯ Unschedulableï¼Œè¿™å°±æ„å‘³ç€å®ƒçš„è°ƒåº¦å‡ºç°äº†é—®é¢˜ã€‚ Projected VolumeKubernetes æ”¯æŒçš„ Projected Volume ä¸€å…±æœ‰å››ç§ï¼š Secret ConfigMap Downward API ServiceAccountToken SecretSecret æœ€å…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼Œè«è¿‡äºå­˜æ”¾æ•°æ®åº“çš„ Credential ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š apiVersion: v1kind: Podmetadata: name: test-projected-volume spec: containers: - name: test-secret-volume image: busybox args: - sleep - &quot;86400&quot; volumeMounts: - name: mysql-cred mountPath: &quot;/projected-volume&quot; readOnly: true volumes: - name: mysql-cred projected: sources: - secret: name: user - secret: name: pass è¿™é‡Œç”¨åˆ°çš„æ•°æ®åº“çš„ç”¨æˆ·åã€å¯†ç ï¼Œæ­£æ˜¯ä»¥ Secret å¯¹è±¡çš„æ–¹å¼äº¤ç»™ Kubernetes ä¿å­˜çš„ã€‚å®Œæˆè¿™ä¸ªæ“ä½œçš„æŒ‡ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š cat ./username.txtsaicat ./password.txt123456 kubectl create secret generic user --from-file=./username.txtkubectl create secret generic pass --from-file=./password.txt å…¶ä¸­ï¼Œusername.txt å’Œ password.txt æ–‡ä»¶é‡Œï¼Œå­˜æ”¾çš„å°±æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼›è€Œ user å’Œ passï¼Œåˆ™æ˜¯æˆ‘ä¸º Secret å¯¹è±¡æŒ‡å®šçš„åå­—ã€‚è€Œæˆ‘æƒ³è¦æŸ¥çœ‹è¿™äº› Secret å¯¹è±¡çš„è¯ï¼Œåªè¦æ‰§è¡Œä¸€æ¡ kubectl get å‘½ä»¤å°±å¯ä»¥äº†ï¼š kubectl get secretsNAME TYPE DATA AGEuser Opaque 1 51spass Opaque 1 51s éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSecret å¯¹è±¡è¦æ±‚è¿™äº›æ•°æ®å¿…é¡»æ˜¯ç»è¿‡ Base64 è½¬ç çš„ï¼Œä»¥å…å‡ºç°æ˜æ–‡å¯†ç çš„å®‰å…¨éšæ‚£ã€‚ ConfigMapä¸ Secret çš„åŒºåˆ«åœ¨äºï¼ŒConfigMap ä¿å­˜çš„æ˜¯ä¸éœ€è¦åŠ å¯†çš„ã€åº”ç”¨æ‰€éœ€çš„é…ç½®ä¿¡æ¯ã€‚è€Œ ConfigMap çš„ç”¨æ³•å‡ ä¹ä¸ Secret å®Œå…¨ç›¸åŒï¼šä½ å¯ä»¥ä½¿ç”¨ kubectl create configmap ä»æ–‡ä»¶æˆ–è€…ç›®å½•åˆ›å»º ConfigMapï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç¼–å†™ ConfigMap å¯¹è±¡çš„ YAML æ–‡ä»¶ã€‚ Downward APIå®ƒçš„ä½œç”¨æ˜¯ï¼šè®© Pod é‡Œçš„å®¹å™¨èƒ½å¤Ÿç›´æ¥è·å–åˆ°è¿™ä¸ª Pod API å¯¹è±¡æœ¬èº«çš„ä¿¡æ¯ã€‚ apiVersion: v1kind: Podmetadata: name: test-downwardapi-volume labels: zone: us-est-coast cluster: test-cluster1 rack: rack-22spec: containers: - name: client-container image: k8s.gcr.io/busybox command: [&quot;sh&quot;, &quot;-c&quot;] args: - while true; do if [[ -e /etc/podinfo/labels ]]; then echo -en &#x27; &#x27;; cat /etc/podinfo/labels; fi; sleep 5; done; volumeMounts: - name: podinfo mountPath: /etc/podinfo readOnly: false volumes: - name: podinfo projected: sources: - downwardAPI: items: - path: &quot;labels&quot; fieldRef: fieldPath: metadata.labels åœ¨è¿™ä¸ª Pod çš„ YAML æ–‡ä»¶ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œå£°æ˜äº†ä¸€ä¸ª projected ç±»å‹çš„ Volumeã€‚åªä¸è¿‡è¿™æ¬¡ Volume çš„æ•°æ®æ¥æºï¼Œå˜æˆäº† Downward APIã€‚è€Œè¿™ä¸ª Downward API Volumeï¼Œåˆ™å£°æ˜äº†è¦æš´éœ² Pod çš„ metadata.labels ä¿¡æ¯ç»™å®¹å™¨ã€‚ é€šè¿‡è¿™æ ·çš„å£°æ˜æ–¹å¼ï¼Œå½“å‰ Pod çš„ Labels å­—æ®µçš„å€¼ï¼Œå°±ä¼šè¢« Kubernetes è‡ªåŠ¨æŒ‚è½½æˆä¸ºå®¹å™¨é‡Œçš„ /etc/podinfo/labels æ–‡ä»¶ã€‚ PS:éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDownward API èƒ½å¤Ÿè·å–åˆ°çš„ä¿¡æ¯ï¼Œä¸€å®šæ˜¯ Pod é‡Œçš„å®¹å™¨è¿›ç¨‹å¯åŠ¨ä¹‹å‰å°±èƒ½å¤Ÿç¡®å®šä¸‹æ¥çš„ä¿¡æ¯ã€‚è€Œå¦‚æœä½ æƒ³è¦è·å– Pod å®¹å™¨è¿è¡Œåæ‰ä¼šå‡ºç°çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œå®¹å™¨è¿›ç¨‹çš„ PIDï¼Œé‚£å°±è‚¯å®šä¸èƒ½ä½¿ç”¨ Downward API äº†ï¼Œè€Œåº”è¯¥è€ƒè™‘åœ¨ Pod é‡Œå®šä¹‰ä¸€ä¸ª sidecar å®¹å™¨ã€‚ ServiceAccountTokenä¸€ç§ç‰¹æ®Šçš„ Secret ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼ŒKubernetes å·²ç»ä¸ºä½ æä¾›äº†ä¸€ä¸ªçš„é»˜è®¤â€œæœåŠ¡è´¦æˆ·â€ï¼ˆdefault Service Accountï¼‰ã€‚å¹¶ä¸”ï¼Œä»»ä½•ä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes é‡Œçš„ Podï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé»˜è®¤çš„ Service Accountï¼Œè€Œæ— éœ€æ˜¾ç¤ºåœ°å£°æ˜æŒ‚è½½å®ƒã€‚ å®¹å™¨å¥åº·æ£€æŸ¥å’Œæ¢å¤æœºåˆ¶apiVersion: v1kind: Podmetadata: labels: test: liveness name: test-liveness-execspec: containers: - name: liveness image: busybox args: - /bin/sh - -c - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600 livenessProbe: exec: command: - cat - /tmp/healthy initialDelaySeconds: 5 periodSeconds: 5 åœ¨è¿™ä¸ª Pod ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæœ‰è¶£çš„å®¹å™¨ã€‚å®ƒåœ¨å¯åŠ¨ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯åœ¨ /tmp ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ª healthy æ–‡ä»¶ï¼Œä»¥æ­¤ä½œä¸ºè‡ªå·±å·²ç»æ­£å¸¸è¿è¡Œçš„æ ‡å¿—ã€‚è€Œ 30 s è¿‡åï¼Œå®ƒä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åˆ é™¤æ‰ã€‚ ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¿™æ ·çš„ livenessProbeï¼ˆå¥åº·æ£€æŸ¥ï¼‰ã€‚å®ƒçš„ç±»å‹æ˜¯ execï¼Œè¿™æ„å‘³ç€ï¼Œå®ƒä¼šåœ¨å®¹å™¨å¯åŠ¨åï¼Œåœ¨å®¹å™¨é‡Œé¢æ‰§è¡Œä¸€å¥æˆ‘ä»¬æŒ‡å®šçš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼šâ€œcat /tmp/healthyâ€ã€‚è¿™æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶å­˜åœ¨ï¼Œè¿™æ¡å‘½ä»¤çš„è¿”å›å€¼å°±æ˜¯ 0ï¼ŒPod å°±ä¼šè®¤ä¸ºè¿™ä¸ªå®¹å™¨ä¸ä»…å·²ç»å¯åŠ¨ï¼Œè€Œä¸”æ˜¯å¥åº·çš„ã€‚è¿™ä¸ªå¥åº·æ£€æŸ¥ï¼Œåœ¨å®¹å™¨å¯åŠ¨ 5 s åå¼€å§‹æ‰§è¡Œï¼ˆinitialDelaySeconds: 5ï¼‰ï¼Œæ¯ 5 s æ‰§è¡Œä¸€æ¬¡ï¼ˆperiodSeconds: 5ï¼‰ã€‚ ä½ ä¸å¦¨å°è¯•ä¸€ä¸‹è¿è¡Œè¿™ä¸ªpodï¼Œæš´éœ²ä¸€ä¸ªå¥åº·å‡äº§ url å’Œ ç›‘å¬ç«¯å£æ˜¯éå¸¸å¸¸è§çš„ã€‚ å¯¹äº Web æœåŠ¡åº”ç”¨ï¼Œ PSï¼šKubernetes ä¸­å¹¶æ²¡æœ‰ Docker çš„ Stop è¯­ä¹‰ã€‚æ‰€ä»¥è™½ç„¶æ˜¯ Restartï¼ˆé‡å¯ï¼‰ï¼Œä½†å®é™…å´æ˜¯é‡æ–°åˆ›å»ºäº†å®¹å™¨ã€‚ restartPolicyï¼Œæ”¹å˜ Pod çš„æ¢å¤ç­–ç•¥ Alwaysï¼šåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œåªè¦å®¹å™¨ä¸åœ¨è¿è¡ŒçŠ¶æ€ï¼Œå°±è‡ªåŠ¨é‡å¯å®¹å™¨ï¼› OnFailure: åªåœ¨å®¹å™¨ å¼‚å¸¸æ—¶æ‰è‡ªåŠ¨é‡å¯å®¹å™¨ï¼› Never: ä»æ¥ä¸é‡å¯å®¹å™¨ã€‚ è®°ä½å¦‚ä¸‹ä¸¤ä¸ªåŸºæœ¬çš„è®¾è®¡åŸç†å³å¯ï¼š åªè¦ Pod çš„ restartPolicy æŒ‡å®šçš„ç­–ç•¥å…è®¸é‡å¯å¼‚å¸¸çš„å®¹å™¨ï¼ˆæ¯”å¦‚ï¼šAlwaysï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ª Pod å°±ä¼šä¿æŒ Running çŠ¶æ€ï¼Œå¹¶è¿›è¡Œå®¹å™¨é‡å¯ã€‚å¦åˆ™ï¼ŒPod å°±ä¼šè¿›å…¥ Failed çŠ¶æ€ ã€‚ å¯¹äºåŒ…å«å¤šä¸ªå®¹å™¨çš„ Podï¼Œåªæœ‰å®ƒé‡Œé¢æ‰€æœ‰çš„å®¹å™¨éƒ½è¿›å…¥å¼‚å¸¸çŠ¶æ€åï¼ŒPod æ‰ä¼šè¿›å…¥ Failed çŠ¶æ€ã€‚ æ›´è¯¦ç»†æ¨èçœ‹çœ‹ï¼š Pod çš„ç”Ÿå‘½å‘¨æœŸ kubernetesä¹‹å®¹å™¨æ¢é’ˆ(liveness and readiness probe) PodPresetå¼€å‘äººå‘˜åªéœ€è¦æäº¤ä¸€ä¸ªåŸºæœ¬çš„ã€éå¸¸ç®€å•çš„ Pod YAMLï¼ŒKubernetes å°±å¯ä»¥è‡ªåŠ¨ç»™å¯¹åº”çš„ Pod å¯¹è±¡åŠ ä¸Šå…¶ä»–å¿…è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ labelsï¼Œannotationsï¼Œvolumes ç­‰ç­‰ã€‚è€Œè¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥æ˜¯è¿ç»´äººå‘˜äº‹å…ˆå®šä¹‰å¥½çš„ã€‚ ğŸŒ° apiVersion: settings.k8s.io/v1alpha1kind: PodPresetmetadata: name: allow-databasespec: selector: matchLabels: role: frontend # è¿™é‡Œå¾ˆé‡è¦ env: - name: DB_PORT value: &quot;6379&quot; volumeMounts: - mountPath: /cache name: cache-volume volumes: - name: cache-volume emptyDir: &#123;&#125;---apiVersion: v1kind: Podmetadata: name: sai labels: app: sai role: frontend # è¿™é‡Œå¾ˆé‡è¦spec: containers: - name: website image: nginx ports: - containerPort: 80 kubectl get pod sai -o yamlapiVersion: v1kind: Podmetadata: name: sai labels: app: sai role: frontend annotations: podpreset.admission.kubernetes.io/podpreset-allow-database: &quot;resource version&quot;spec: containers: - name: website image: nginx volumeMounts: - mountPath: /cache name: cache-volume ports: - containerPort: 80 env: - name: DB_PORT value: &quot;6379&quot; volumes: - name: cache-volume emptyDir: &#123;&#125; è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™ä¸ª Pod é‡Œå¤šäº†æ–°æ·»åŠ çš„ labelsã€envã€volumes å’Œ volumeMount çš„å®šä¹‰ï¼Œå®ƒä»¬çš„é…ç½®è·Ÿ PodPreset çš„å†…å®¹ä¸€æ ·ã€‚æ­¤å¤–ï¼Œè¿™ä¸ª Pod è¿˜è¢«è‡ªåŠ¨åŠ ä¸Šäº†ä¸€ä¸ª annotation è¡¨ç¤ºè¿™ä¸ª Pod å¯¹è±¡è¢« PodPreset æ”¹åŠ¨è¿‡ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒPodPreset é‡Œå®šä¹‰çš„å†…å®¹ï¼Œåªä¼šåœ¨ Pod API å¯¹è±¡è¢«åˆ›å»ºä¹‹å‰è¿½åŠ åœ¨è¿™ä¸ªå¯¹è±¡æœ¬èº«ä¸Šï¼Œè€Œä¸ä¼šå½±å“ä»»ä½• Pod çš„æ§åˆ¶å™¨çš„å®šä¹‰ã€‚","tags":["k8s"],"categories":["k8s"]},{"title":"æ·±å…¥å‰–æKubernetesä¹‹å®¹å™¨åŸºç¡€ç¯‡","path":"/2022/07/01/406/","content":"å®¹å™¨æœ¬èº«æ²¡æœ‰ä»·å€¼ï¼Œæœ‰ä»·å€¼çš„æ˜¯â€œå®¹å™¨ç¼–æ’â€ã€‚ è¿›ç¨‹int pid = clone(main_function, stack_size, SIGCHLD, NULL); int pid = clone(main_function, stack_size, CLONE_NEWPID | SIGCHLD, NULL); éš”ç¦»ç”¨æˆ·è¿è¡Œåœ¨å®¹å™¨é‡Œçš„åº”ç”¨è¿›ç¨‹ï¼Œè·Ÿå®¿ä¸»æœºä¸Šçš„å…¶ä»–è¿›ç¨‹ä¸€æ ·ï¼Œéƒ½ç”±å®¿ä¸»æœºæ“ä½œç³»ç»Ÿç»Ÿä¸€ç®¡ç†ï¼Œåªä¸è¿‡è¿™äº›è¢«éš”ç¦»çš„è¿›ç¨‹æ‹¥æœ‰é¢å¤–è®¾ç½®è¿‡çš„ Namespace å‚æ•°ã€‚è€Œ Docker é¡¹ç›®åœ¨è¿™é‡Œæ‰®æ¼”çš„è§’è‰²ï¼Œæ›´å¤šçš„æ˜¯æ—è·¯å¼çš„è¾…åŠ©å’Œç®¡ç†å·¥ä½œã€‚ åŸºäº Linux Namespace çš„éš”ç¦»æœºåˆ¶ç›¸æ¯”äºè™šæ‹ŸåŒ–æŠ€æœ¯ä¹Ÿæœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯ï¼šéš”ç¦»å¾—ä¸å½»åº•ã€‚ é¦–å…ˆï¼Œæ—¢ç„¶å®¹å™¨åªæ˜¯è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šçš„ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå¤šä¸ªå®¹å™¨ä¹‹é—´ä½¿ç”¨çš„å°±è¿˜æ˜¯åŒä¸€ä¸ªå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚ å…¶æ¬¡ï¼Œåœ¨ Linux å†…æ ¸ä¸­ï¼Œæœ‰å¾ˆå¤šèµ„æºå’Œå¯¹è±¡æ˜¯ä¸èƒ½è¢« Namespace åŒ–çš„ï¼Œæœ€å…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼šæ—¶é—´ã€‚ Linux Control GroupLinux Cgroups æœ€ä¸»è¦çš„ä½œç”¨ï¼Œå°±æ˜¯é™åˆ¶ä¸€ä¸ªè¿›ç¨‹ç»„èƒ½å¤Ÿä½¿ç”¨çš„èµ„æºä¸Šé™ï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå¸¦å®½ç­‰ç­‰ã€‚ mount -t cgroupcgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls) è¿›å…¥ /sys/fs/cgroup/cpu ç›®å½•ä¸‹ï¼š root@ubuntu:/sys/fs/cgroup/cpu$ mkdir containerroot@ubuntu:/sys/fs/cgroup/cpu$ ls container/cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us cpu.shares notify_on_releasecgroup.procs cpu.cfs_quota_us cpu.rt_runtime_us cpu.stat tasks è¿™ä¸ªç›®å½•å°±ç§°ä¸ºä¸€ä¸ªâ€œæ§åˆ¶ç»„â€ã€‚ä½ ä¼šå‘ç°ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ä½ æ–°åˆ›å»ºçš„ container ç›®å½•ä¸‹ï¼Œè‡ªåŠ¨ç”Ÿæˆè¯¥å­ç³»ç»Ÿå¯¹åº”çš„èµ„æºé™åˆ¶æ–‡ä»¶ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨åå°æ‰§è¡Œè¿™æ ·ä¸€æ¡è„šæœ¬ï¼š while : ; do : ; done &amp;[1] 226 æ˜¾ç„¶ï¼Œå®ƒæ‰§è¡Œäº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå¯ä»¥æŠŠè®¡ç®—æœºçš„ CPU åƒåˆ° 100%ï¼Œæ ¹æ®å®ƒçš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªè„šæœ¬åœ¨åå°è¿è¡Œçš„è¿›ç¨‹å·ï¼ˆPIDï¼‰æ˜¯ 226ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ top æŒ‡ä»¤æ¥ç¡®è®¤ä¸€ä¸‹ CPU æœ‰æ²¡æœ‰è¢«æ‰“æ»¡ï¼š $ top%Cpu0 :100.0 us, 0.0 sy, 0.0 ni, 0.0 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st åœ¨è¾“å‡ºé‡Œå¯ä»¥çœ‹åˆ°ï¼ŒCPU çš„ä½¿ç”¨ç‡å·²ç» 100% äº†ï¼ˆ%Cpu0 :100.0 usï¼‰ã€‚ è€Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹ container ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œçœ‹åˆ° container æ§åˆ¶ç»„é‡Œçš„ CPU quota è¿˜æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼ˆå³ï¼š-1ï¼‰ï¼ŒCPU period åˆ™æ˜¯é»˜è®¤çš„ 100 msï¼ˆ100000 usï¼‰ï¼š cat /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us -1cat /sys/fs/cgroup/cpu/container/cpu.cfs_period_us 100000 æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›æ–‡ä»¶çš„å†…å®¹æ¥è®¾ç½®é™åˆ¶ã€‚ æ¯”å¦‚ï¼Œå‘ container ç»„é‡Œçš„ cfs_quota æ–‡ä»¶å†™å…¥ 20 msï¼ˆ20000 usï¼‰ï¼š echo 20000 &gt; /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us ç»“åˆå‰é¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥èƒ½æ˜ç™½è¿™ä¸ªæ“ä½œçš„å«ä¹‰ï¼Œå®ƒæ„å‘³ç€åœ¨æ¯ 100 ms çš„æ—¶é—´é‡Œï¼Œè¢«è¯¥æ§åˆ¶ç»„é™åˆ¶çš„è¿›ç¨‹åªèƒ½ä½¿ç”¨ 20 ms çš„ CPU æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹åªèƒ½ä½¿ç”¨åˆ° 20% çš„ CPU å¸¦å®½ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠè¢«é™åˆ¶çš„è¿›ç¨‹çš„ PID å†™å…¥ container ç»„é‡Œçš„ tasks æ–‡ä»¶ï¼Œä¸Šé¢çš„è®¾ç½®å°±ä¼šå¯¹è¯¥è¿›ç¨‹ç”Ÿæ•ˆäº†ï¼š echo 226 &gt; /sys/fs/cgroup/cpu/container/tasks æˆ‘ä»¬å¯ä»¥ç”¨ top æŒ‡ä»¤æŸ¥çœ‹ä¸€ä¸‹ï¼š $ top%Cpu0 : 20.3 us, 0.0 sy, 0.0 ni, 79.7 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st å¯ä»¥çœ‹åˆ°ï¼Œè®¡ç®—æœºçš„ CPU ä½¿ç”¨ç‡ç«‹åˆ»é™åˆ°äº† 20%ï¼ˆ%Cpu0 : 20.3 usï¼‰ã€‚ é™¤ CPU å­ç³»ç»Ÿå¤–ï¼ŒCgroups çš„æ¯ä¸€é¡¹å­ç³»ç»Ÿéƒ½æœ‰å…¶ç‹¬æœ‰çš„èµ„æºé™åˆ¶èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼š blkioï¼Œä¸ºâ€‹â€‹â€‹å—â€‹â€‹â€‹è®¾â€‹â€‹â€‹å¤‡â€‹â€‹â€‹è®¾â€‹â€‹â€‹å®šâ€‹â€‹â€‹I/O é™â€‹â€‹â€‹åˆ¶ï¼Œä¸€èˆ¬ç”¨äºç£ç›˜ç­‰è®¾å¤‡ï¼› cpusetï¼Œä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„ CPU æ ¸å’Œå¯¹åº”çš„å†…å­˜èŠ‚ç‚¹ï¼› memoryï¼Œä¸ºè¿›ç¨‹è®¾å®šå†…å­˜ä½¿ç”¨çš„é™åˆ¶ã€‚ Linux Cgroups çš„è®¾è®¡è¿˜æ˜¯æ¯”è¾ƒæ˜“ç”¨çš„ï¼Œç®€å•ç²—æš´åœ°ç†è§£å‘¢ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå­ç³»ç»Ÿç›®å½•åŠ ä¸Šä¸€ç»„èµ„æºé™åˆ¶æ–‡ä»¶çš„ç»„åˆã€‚è€Œå¯¹äº Docker ç­‰ Linux å®¹å™¨é¡¹ç›®æ¥è¯´ï¼Œå®ƒä»¬åªéœ€è¦åœ¨æ¯ä¸ªå­ç³»ç»Ÿä¸‹é¢ï¼Œä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªæ§åˆ¶ç»„ï¼ˆå³åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼‰ï¼Œç„¶ååœ¨å¯åŠ¨å®¹å™¨è¿›ç¨‹ä¹‹åï¼ŒæŠŠè¿™ä¸ªè¿›ç¨‹çš„ PID å¡«å†™åˆ°å¯¹åº”æ§åˆ¶ç»„çš„ tasks æ–‡ä»¶ä¸­å°±å¯ä»¥äº†ã€‚ docker run -it --cpu-period=100000 --cpu-quota=20000 ubuntu /bin/bash èµ„æºç›®å½•ä¸­ï¼š cat /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_period_us 100000cat /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_quota_us 20000 Cgroups å¯¹èµ„æºçš„é™åˆ¶èƒ½åŠ›ä¹Ÿæœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œè¢«æåŠæœ€å¤šçš„è‡ªç„¶æ˜¯ /proc æ–‡ä»¶ç³»ç»Ÿçš„é—®é¢˜ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼ŒLinux ä¸‹çš„ /proc ç›®å½•å­˜å‚¨çš„æ˜¯è®°å½•å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¿é—®è¿™äº›æ–‡ä»¶ï¼ŒæŸ¥çœ‹ç³»ç»Ÿä»¥åŠå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨æƒ…å†µã€å†…å­˜å ç”¨ç‡ç­‰ï¼Œè¿™äº›æ–‡ä»¶ä¹Ÿæ˜¯ top æŒ‡ä»¤æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯çš„ä¸»è¦æ•°æ®æ¥æºã€‚ ä½†æ˜¯ï¼Œä½ å¦‚æœåœ¨å®¹å™¨é‡Œæ‰§è¡Œ top æŒ‡ä»¤ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒæ˜¾ç¤ºçš„ä¿¡æ¯å±…ç„¶æ˜¯å®¿ä¸»æœºçš„ CPU å’Œå†…å­˜æ•°æ®ï¼Œè€Œä¸æ˜¯å½“å‰å®¹å™¨çš„æ•°æ®ã€‚ é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯ï¼Œ/proc æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸çŸ¥é“ç”¨æˆ·é€šè¿‡ Cgroups ç»™è¿™ä¸ªå®¹å™¨åšäº†ä»€ä¹ˆæ ·çš„èµ„æºé™åˆ¶ï¼Œå³ï¼š/proc æ–‡ä»¶ç³»ç»Ÿä¸äº†è§£ Cgroups é™åˆ¶çš„å­˜åœ¨ã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªé—®é¢˜å¿…é¡»è¿›è¡Œä¿®æ­£ï¼Œå¦åˆ™åº”ç”¨ç¨‹åºåœ¨å®¹å™¨é‡Œè¯»å–åˆ°çš„ CPU æ ¸æ•°ã€å¯ç”¨å†…å­˜ç­‰ä¿¡æ¯éƒ½æ˜¯å®¿ä¸»æœºä¸Šçš„æ•°æ®ï¼Œè¿™ä¼šç»™åº”ç”¨çš„è¿è¡Œå¸¦æ¥éå¸¸å¤§çš„å›°æƒ‘å’Œé£é™©ã€‚è¿™ä¹Ÿæ˜¯åœ¨ä¼ä¸šä¸­ï¼Œå®¹å™¨åŒ–åº”ç”¨ç¢°åˆ°çš„ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼Œä¹Ÿæ˜¯å®¹å™¨ç›¸è¾ƒäºè™šæ‹Ÿæœºå¦ä¸€ä¸ªä¸å°½å¦‚äººæ„çš„åœ°æ–¹ã€‚ [DOCKERåŸºç¡€æŠ€æœ¯ï¼šLINUX NAMESPACEï¼ˆä¸Šï¼‰]https://coolshell.cn/articles/17010.html) å¯¹ Docker é¡¹ç›®æ¥è¯´ï¼Œå®ƒæœ€æ ¸å¿ƒçš„åŸç†å®é™…ä¸Šå°±æ˜¯ä¸ºå¾…åˆ›å»ºçš„ç”¨æˆ·è¿›ç¨‹ï¼š å¯ç”¨ Linux Namespace é…ç½®ï¼› è®¾ç½®æŒ‡å®šçš„ Cgroups å‚æ•°ï¼› åˆ‡æ¢è¿›ç¨‹çš„æ ¹ç›®å½•ï¼ˆChange Rootï¼‰ã€‚ å¦å¤–ï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œrootfs åªæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ã€é…ç½®å’Œç›®å½•ï¼Œå¹¶ä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤éƒ¨åˆ†æ˜¯åˆ†å¼€å­˜æ”¾çš„ï¼Œæ“ä½œç³»ç»Ÿåªæœ‰åœ¨å¼€æœºå¯åŠ¨æ—¶æ‰ä¼šåŠ è½½æŒ‡å®šç‰ˆæœ¬çš„å†…æ ¸é•œåƒã€‚ æ‰€ä»¥è¯´ï¼Œrootfs åªåŒ…æ‹¬äº†æ“ä½œç³»ç»Ÿçš„â€œèº¯å£³â€ï¼Œå¹¶æ²¡æœ‰åŒ…æ‹¬æ“ä½œç³»ç»Ÿçš„â€œçµé­‚â€ã€‚ Docker å…¬å¸åœ¨å®ç° Docker é•œåƒæ—¶å¹¶æ²¡æœ‰æ²¿ç”¨ä»¥å‰åˆ¶ä½œ rootfs çš„æ ‡å‡†æµç¨‹ï¼Œè€Œæ˜¯åšäº†ä¸€ä¸ªå°å°çš„åˆ›æ–°ï¼š Docker åœ¨é•œåƒçš„è®¾è®¡ä¸­ï¼Œå¼•å…¥äº†å±‚ï¼ˆlayerï¼‰çš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·åˆ¶ä½œé•œåƒçš„æ¯ä¸€æ­¥æ“ä½œï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¢é‡ rootfsã€‚ å½“ç„¶ï¼Œè¿™ä¸ªæƒ³æ³•ä¸æ˜¯å‡­ç©ºè‡†é€ å‡ºæ¥çš„ï¼Œè€Œæ˜¯ç”¨åˆ°äº†ä¸€ç§å«ä½œè”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰çš„èƒ½åŠ›ã€‚","tags":["k8s"],"categories":["k8s"]},{"title":"æ·±å…¥å‰–æKubernetesä¹‹Dockerç¯‡","path":"/2022/07/01/405/","content":"åˆå‡ºèŒ…åºPaaS ä¹‹æ‰€ä»¥èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·å¤§è§„æ¨¡éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤é‡Œï¼Œæ˜¯å› ä¸ºå®ƒæä¾›äº†ä¸€å¥—åº”ç”¨æ‰“åŒ…çš„åŠŸèƒ½ã€‚ç„¶è€Œä¸€æ—¦ç”¨ä¸Šäº† PaaSï¼Œç”¨æˆ·å°±å¿…é¡»ä¸ºæ¯ç§è¯­è¨€ã€æ¯ç§æ¡†æ¶ï¼Œç”šè‡³æ¯ä¸ªç‰ˆæœ¬çš„åº”ç”¨ç»´æŠ¤ä¸€ä¸ªæ‰“å¥½çš„åŒ…ã€‚è¿™ä¸ªæ‰“åŒ…è¿‡ç¨‹ï¼Œæ²¡æœ‰ä»»ä½•ç« æ³•å¯å¾ªï¼Œæ›´éº»çƒ¦çš„æ˜¯ï¼Œæ˜æ˜åœ¨æœ¬åœ°è¿è¡Œå¾—å¥½å¥½çš„åº”ç”¨ï¼Œå´éœ€è¦åšå¾ˆå¤šä¿®æ”¹å’Œé…ç½®å·¥ä½œæ‰èƒ½åœ¨ PaaS é‡Œè¿è¡Œèµ·æ¥ã€‚è€Œè¿™äº›ä¿®æ”¹å’Œé…ç½®ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç»éªŒå¯ä»¥å€Ÿé‰´ï¼ŒåŸºæœ¬ä¸Šå¾—é ä¸æ–­è¯•é”™ï¼Œç›´åˆ°ä½ æ‘¸æ¸…æ¥šäº†æœ¬åœ°åº”ç”¨å’Œè¿œç«¯ PaaS åŒ¹é…çš„â€œè„¾æ°”â€æ‰èƒ½å¤Ÿæå®šã€‚ æœ€åç»“å±€æ˜¯ï¼Œç¡®å®æ˜¯èƒ½ä¸€é”®éƒ¨ç½²äº†ï¼Œä½†æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªä¸€é”®éƒ¨ç½²ï¼Œç”¨æˆ·ä¸ºæ¯ä¸ªåº”ç”¨æ‰“åŒ…çš„å·¥ä½œå¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼Œè´¹å°½å¿ƒæœºã€‚ Docker çš„å‡ºç°æ”¹å˜äº†è¿™ä¸€ç°çŠ¶ï¼ŒDocker é•œåƒè§£å†³äº†æ‰“åŒ…æ•´ä¸ªæ ¹æœ¬æ€§çš„é—®é¢˜ã€‚è¿™ä¹Ÿæˆä¸ºäº† Docker é¡¹ç›®æˆåŠŸçš„å…³é”®ã€‚ æ‰€è°“ Docker é•œåƒï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ã€‚å¤§å¤šæ•° Docker é•œåƒæ˜¯ç›´æ¥ç”±ä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•æ„æˆçš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‹ç¼©åŒ…é‡Œçš„å†…å®¹è·Ÿä½ æœ¬åœ°å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ Docker é•œåƒæœ€å‰å®³çš„åœ°æ–¹åœ¨äºï¼Œåªè¦æœ‰è¿™ä¸ªå‹ç¼©åŒ…åœ¨æ‰‹ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨æŸç§æŠ€æœ¯åˆ›å»ºä¸€ä¸ªâ€œæ²™ç›’â€ï¼Œåœ¨â€œæ²™ç›’â€ä¸­è§£å‹è¿™ä¸ªå‹ç¼©åŒ…ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œä½ çš„ç¨‹åºäº†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªå‹ç¼©åŒ…åŒ…å«äº†å®Œæ•´çš„æ“ä½œç³»ç»Ÿæ–‡ä»¶å’Œç›®å½•ï¼Œä¹Ÿå°±æ˜¯åŒ…å«äº†è¿™ä¸ªåº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–ï¼Œæ‰€ä»¥ä½ å¯ä»¥å…ˆç”¨è¿™ä¸ªå‹ç¼©åŒ…åœ¨æœ¬åœ°è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œå®Œæˆä¹‹åï¼Œå†æŠŠè¿™ä¸ªå‹ç¼©åŒ…ä¸Šä¼ åˆ°äº‘ç«¯è¿è¡Œã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å®Œå…¨ä¸éœ€è¦è¿›è¡Œä»»ä½•é…ç½®æˆ–è€…ä¿®æ”¹ï¼Œå› ä¸ºè¿™ä¸ªå‹ç¼©åŒ…èµ‹äºˆäº†ä½ ä¸€ç§æå…¶å®è´µçš„èƒ½åŠ›ï¼šæœ¬åœ°ç¯å¢ƒå’Œäº‘ç«¯ç¯å¢ƒçš„é«˜åº¦ä¸€è‡´ï¼ é‚£ä¹ˆåªéœ€è¦ï¼š docker build &quot;æŸä¸ªé•œåƒ&quot;docker run &quot;æ•´ä¸ªé•œåƒ&quot; Docker é¡¹ç›®ç»™ PaaS ä¸–ç•Œå¸¦æ¥çš„â€œé™ç»´æ‰“å‡»â€ï¼Œå…¶å®æ˜¯æä¾›äº†ä¸€ç§éå¸¸ä¾¿åˆ©çš„æ‰“åŒ…æœºåˆ¶ã€‚è¿™ç§æœºåˆ¶ç›´æ¥æ‰“åŒ…äº†åº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œä»è€Œä¿è¯äº†æœ¬åœ°ç¯å¢ƒå’Œäº‘ç«¯ç¯å¢ƒçš„é«˜åº¦ä¸€è‡´ï¼Œé¿å…äº†ç”¨æˆ·é€šè¿‡â€œè¯•é”™â€æ¥åŒ¹é…ä¸¤ç§ä¸åŒè¿è¡Œç¯å¢ƒä¹‹é—´å·®å¼‚çš„ç—›è‹¦è¿‡ç¨‹ã€‚ å´­éœ²å¤´è§’Docker é¡¹ç›®ä¹‹æ‰€ä»¥èƒ½å–å¾—å¦‚æ­¤é«˜çš„å…³æ³¨ï¼Œä¸€æ–¹é¢æ˜¯å®ƒè§£å†³äº†åº”ç”¨æ‰“åŒ…å’Œå‘å¸ƒè¿™ä¸€å›°æ‰°è¿ç»´äººå‘˜å¤šå¹´çš„æŠ€æœ¯éš¾é¢˜ï¼›è€Œå¦ä¸€æ–¹é¢ï¼Œå°±æ˜¯å› ä¸ºå®ƒç¬¬ä¸€æ¬¡æŠŠä¸€ä¸ªçº¯åç«¯çš„æŠ€æœ¯æ¦‚å¿µï¼Œé€šè¿‡éå¸¸å‹å¥½çš„è®¾è®¡å’Œå°è£…ï¼Œäº¤åˆ°äº†æœ€å¹¿å¤§çš„å¼€å‘è€…ç¾¤ä½“æ‰‹é‡Œã€‚ è§£å†³äº†åº”ç”¨æ‰“åŒ…è¿™ä¸ªæ ¹æœ¬æ€§çš„é—®é¢˜ï¼ŒåŒå¼€å‘è€…ä¸ç”Ÿä¿±æ¥çš„çš„äº²å¯†å…³ç³»ï¼Œå†åŠ ä¸Š PaaS æ¦‚å¿µå·²ç»æ·±å…¥äººå¿ƒçš„å®Œç¾å¥‘æœºï¼Œæˆä¸º Docker è¿™ä¸ªæŠ€æœ¯ä¸Šçœ‹ä¼¼å¹³æ·¡æ— å¥‡çš„é¡¹ç›®ä¸€ä¸¾èµ°çº¢çš„é‡è¦åŸå› ã€‚ Docker é¡¹ç›®ä»å‘å¸ƒä¹‹åˆå°±å…¨é¢å‘åŠ›ï¼Œä»æŠ€æœ¯ã€ç¤¾åŒºã€å•†ä¸šã€å¸‚åœºå…¨æ–¹ä½äº‰å–åˆ°çš„å¼€å‘è€…ç¾¤ä½“ï¼Œå®é™…ä¸Šæ˜¯ä¸ºæ­¤åå¸å¼•æ•´ä¸ªç”Ÿæ€åˆ°è‡ªå®¶â€œPaaSâ€ä¸Šçš„ä¸€ä¸ªé“ºå«ã€‚åªä¸è¿‡è¿™æ—¶ï¼Œâ€œPaaSâ€çš„å®šä¹‰å·²ç»å…¨ç„¶ä¸æ˜¯ Cloud Foundry æè¿°çš„é‚£ä¸ªæ ·å­ï¼Œè€Œæ˜¯å˜æˆäº†ä¸€å¥—ä»¥ Docker å®¹å™¨ä¸ºæŠ€æœ¯æ ¸å¿ƒï¼Œä»¥ Docker é•œåƒä¸ºæ‰“åŒ…æ ‡å‡†çš„ã€å…¨æ–°çš„â€œå®¹å™¨åŒ–â€æ€è·¯ã€‚ ç¾¤é›„å¹¶èµ·Docker å…¬å¸åœ¨ 2014 å¹´å°±å·²ç»å®šå¥½äº†å¹³å°åŒ–çš„å‘å±•æ–¹å‘ï¼Œå¹¶ä¸”ç»å¯¹ä¸ä¼šè·Ÿ CoreOS åœ¨å¹³å°å±‚é¢å¼€å±•ä»»ä½•åˆä½œï¼Œåœ¨ 2014 å¹´ 12 æœˆçš„ DockerCon ä¸Šå‘å¸ƒäº† Swarm ã€‚ # å•æœº Docker é¡¹ç›®ï¼šdocker run &quot;æˆ‘çš„å®¹å™¨&quot;# å¤šæœº Docker é¡¹ç›®ï¼šdocker run -H &quot;æˆ‘çš„ Swarm é›†ç¾¤ API åœ°å€&quot; &quot;æˆ‘çš„å®¹å™¨&quot; Fig é¡¹ç›®ç¬¬ä¸€æ¬¡æå‡ºäº†â€œå®¹å™¨ç¼–æ’â€ï¼ˆContainer Orchestrationï¼‰çš„æ¦‚å¿µï¼Œè¢«æ”¶è´­åæ”¹åä¸º Composeï¼Œå®ƒæˆäº† Docker å…¬å¸åˆ°ç›®å‰ä¸ºæ­¢ç¬¬äºŒå¤§å—æ¬¢è¿çš„é¡¹ç›®ï¼Œä¸€ç›´åˆ°ä»Šå¤©ä¹Ÿä¾ç„¶è¢«å¾ˆå¤šäººä½¿ç”¨ã€‚ ç”±æ­¤ï¼ŒDocker å…¬å¸ Docker Composeã€Swarm å’Œ Machineâ€œä¸‰ä»¶å¥—â€ï¼Œåœ¨é‡æ–°å®šä¹‰ PaaS çš„æ–¹å‘ä¸Šèµ°å‡ºäº†æœ€å…³é”®çš„ä¸€æ­¥ã€‚ è€Œ Mesos ç¤¾åŒºå‡­å€Ÿè¶…å¤§è§„æ¨¡é›†ç¾¤çš„ç®¡ç†ç»éªŒå’Œé€šè¿‡ Marathon å®ç°äº†è¯¸å¦‚åº”ç”¨æ‰˜ç®¡å’Œè´Ÿè½½å‡è¡¡çš„ PaaS åŠŸèƒ½ä¹‹åï¼Œè¿›åŒ–æˆäº†ä¸€ä¸ªé«˜åº¦æˆç†Ÿçš„ PaaS é¡¹ç›®ç»„åˆ Mesos+Marathonï¼Œä»è€Œå æ®äº†å®¹å™¨åŒ–æµªæ½®ä¸­çš„ä¸€å¸­ä¹‹åœ°ã€‚ CoreOSã€RedHat å®Œå…¨åœ¨è¿™ä¸€æ—¶æœŸè¢« Docker å…¬å¸å‹åˆ¶äº†ã€‚ å°˜åŸƒè½å®š2014 å¹´ 6 æœˆï¼ŒGoogle å…¬å¸è¯ç”Ÿ Kubernetes é¡¹ç›®ã€‚è€Œè¿™ä¸ªé¡¹ç›®ï¼Œä¸ä»…æŒ½æ•‘äº†å½“æ—¶çš„ CoreOS å’Œ RedHatï¼Œè¿˜å¦‚åŒå½“å¹´ Docker é¡¹ç›®çš„æ¨ªç©ºå‡ºä¸–ä¸€æ ·ï¼Œå†ä¸€æ¬¡æ”¹å˜äº†æ•´ä¸ªå®¹å™¨å¸‚åœºçš„æ ¼å±€ã€‚ Docker æ€¥é€Ÿæ‰©å¼ çš„åŒæ—¶ï¼Œç¤¾åŒºä¹Ÿå‡ºç°å¯¹ Docker å…¬å¸å•†ä¸šåŒ–æˆ˜ç•¥çš„ç§ç§é¡¾è™‘çš„å£°éŸ³ã€‚Docker å…¬å¸åœ¨ Docker å¼€æºé¡¹ç›®çš„å‘å±•ä¸Šï¼Œå§‹ç»ˆä¿æŒç€ç»å¯¹çš„æƒå¨å’Œå‘è¨€æƒï¼Œå¹¶åœ¨å¤šä¸ªåœºåˆç”¨å®é™…è¡ŒåŠ¨æŒ‘æˆ˜åˆ°äº†å…¶ä»–ç©å®¶ï¼ˆæ¯”å¦‚ï¼ŒCoreOSã€RedHatï¼Œç”šè‡³è°·æ­Œå’Œå¾®è½¯ï¼‰çš„åˆ‡èº«åˆ©ç›Šã€‚ 2015 å¹´ 6 æœˆ 22 æ—¥ï¼Œç”± Docker å…¬å¸ç‰µå¤´ï¼ŒCoreOSã€Googleã€RedHat ç­‰å…¬å¸å…±åŒå®£å¸ƒï¼ŒDocker å…¬å¸å°† Libcontainer æå‡ºï¼Œå¹¶æ”¹åä¸º RunC é¡¹ç›®ï¼Œäº¤ç”±ä¸€ä¸ªå®Œå…¨ä¸­ç«‹çš„åŸºé‡‘ä¼šç®¡ç†ï¼Œç„¶åä»¥ RunC ä¸ºä¾æ®ï¼Œå¤§å®¶å…±åŒåˆ¶å®šä¸€å¥—å®¹å™¨å’Œé•œåƒçš„æ ‡å‡†å’Œè§„èŒƒ OCIï¼ˆ Open Container Initiative ï¼‰ã€‚OCI çš„æå‡ºï¼Œæ„åœ¨å°†å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒçš„å®ç°ä» Docker é¡¹ç›®ä¸­å®Œå…¨å‰¥ç¦»å‡ºæ¥ã€‚è¿™æ ·åšï¼Œä¸€æ–¹é¢å¯ä»¥æ”¹å–„ Docker å…¬å¸åœ¨å®¹å™¨æŠ€æœ¯ä¸Šä¸€å®¶ç‹¬å¤§çš„ç°çŠ¶ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¸ºå…¶ä»–ç©å®¶ä¸ä¾èµ–äº Docker é¡¹ç›®æ„å»ºå„è‡ªçš„å¹³å°å±‚èƒ½åŠ›æä¾›äº†å¯èƒ½ã€‚ OCI å¹¶æ²¡æœ‰æ”¹å˜ Docker ä¸€å®¶ç‹¬å¤§çš„ç°çŠ¶ï¼Œä½† Googleã€RedHat ç­‰å¼€æºåŸºç¡€è®¾æ–½é¢†åŸŸç©å®¶ä»¬ï¼Œå…±åŒç‰µå¤´å‘èµ·äº†ä¸€ä¸ªåä¸º CNCFï¼ˆCloud Native Computing Foundationï¼‰çš„åŸºé‡‘ä¼šæ”¹å˜äº†ç¤¾åŒºçš„æ ¼å±€ã€‚ CNCF åŸºé‡‘ä¼šçš„ç›®çš„å…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼šå®ƒå¸Œæœ›ï¼Œä»¥ Kubernetes é¡¹ç›®ä¸ºåŸºç¡€ï¼Œå»ºç«‹ä¸€ä¸ªç”±å¼€æºåŸºç¡€è®¾æ–½é¢†åŸŸå‚å•†ä¸»å¯¼çš„ã€æŒ‰ç…§ç‹¬ç«‹åŸºé‡‘ä¼šæ–¹å¼è¿è¥çš„å¹³å°çº§ç¤¾åŒºï¼Œæ¥å¯¹æŠ—ä»¥ Docker å…¬å¸ä¸ºæ ¸å¿ƒçš„å®¹å™¨å•†ä¸šç”Ÿæ€ã€‚ è€Œä¸ºäº†æ‰“é€ å‡ºè¿™æ ·ä¸€ä¸ªå›´ç»• Kubernetes é¡¹ç›®çš„â€œæŠ¤åŸæ²³â€ï¼ŒCNCF ç¤¾åŒºå°±éœ€è¦è‡³å°‘ç¡®ä¿ä¸¤ä»¶äº‹æƒ…ï¼š Kubernetes é¡¹ç›®å¿…é¡»èƒ½å¤Ÿåœ¨å®¹å™¨ç¼–æ’é¢†åŸŸå–å¾—è¶³å¤Ÿå¤§çš„ç«äº‰ä¼˜åŠ¿ CNCF ç¤¾åŒºå¿…é¡»ä»¥ Kubernetes é¡¹ç›®ä¸ºæ ¸å¿ƒï¼Œè¦†ç›–è¶³å¤Ÿå¤šçš„åœºæ™¯ åœ¨å®¹å™¨ç¼–æ’é¢†åŸŸï¼ŒKubernetes é¡¹ç›®éœ€è¦é¢å¯¹æ¥è‡ª Docker å…¬å¸å’Œ Mesos ç¤¾åŒºä¸¤ä¸ªæ–¹å‘çš„å‹åŠ›ã€‚ä¸éš¾çœ‹å‡ºï¼ŒSwarm å’Œ Mesos å®é™…ä¸Šåˆ†åˆ«ä»ä¸¤ä¸ªä¸åŒçš„æ–¹å‘è®²å‡ºäº†è‡ªå·±æœ€æ“…é•¿çš„æ•…äº‹ï¼šSwarm æ“…é•¿çš„æ˜¯è·Ÿ Docker ç”Ÿæ€çš„æ— ç¼é›†æˆï¼Œè€Œ Mesos æ“…é•¿çš„åˆ™æ˜¯å¤§è§„æ¨¡é›†ç¾¤çš„è°ƒåº¦ä¸ç®¡ç†ã€‚ è¿™ä¸¤ä¸ªæ–¹å‘ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°äººåšå®¹å™¨é›†ç¾¤ç®¡ç†é¡¹ç›®æ—¶æœ€å®¹æ˜“æƒ³åˆ°çš„ä¸¤ä¸ªå‡ºå‘ç‚¹ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒKubernetes é¡¹ç›®å¦‚æœç»§ç»­åœ¨è¿™ä¸¤ä¸ªæ–¹å‘ä¸Šåšæ–‡ç« ææ€•å°±ä¸å¤ªæ˜æ™ºäº†ã€‚ æ‰€ä»¥è¿™ä¸€æ¬¡ï¼ŒKubernetes é€‰æ‹©çš„åº”å¯¹æ–¹å¼æ˜¯ï¼šBorgã€‚ å¦‚æœä½ çœ‹è¿‡ Kubernetes é¡¹ç›®æ—©æœŸçš„ GitHub Issue å’Œ Feature çš„è¯ï¼Œå°±ä¼šå‘ç°å®ƒä»¬å¤§å¤šæ¥è‡ªäº Borg å’Œ Omega ç³»ç»Ÿçš„å†…éƒ¨ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§è½åˆ° Kubernetes é¡¹ç›®ä¸Šï¼Œå°±æ˜¯ Podã€Sidecar ç­‰åŠŸèƒ½å’Œè®¾è®¡æ¨¡å¼ã€‚ è¿™å°±è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆ Kubernetes å‘å¸ƒåï¼Œå¾ˆå¤šäººâ€œæŠ±æ€¨â€å…¶è®¾è®¡æ€æƒ³è¿‡äºâ€œè¶…å‰â€çš„åŸå› ï¼šKubernetes é¡¹ç›®çš„åŸºç¡€ç‰¹æ€§ï¼Œå¹¶ä¸æ˜¯å‡ ä¸ªå·¥ç¨‹å¸ˆçªç„¶â€œæ‹è„‘è¢‹â€æƒ³å‡ºæ¥çš„ä¸œè¥¿ï¼Œè€Œæ˜¯ Google å…¬å¸åœ¨å®¹å™¨åŒ–åŸºç¡€è®¾æ–½é¢†åŸŸå¤šå¹´æ¥å®è·µç»éªŒçš„æ²‰æ·€ä¸å‡åã€‚è¿™ï¼Œæ­£æ˜¯ Kubernetes é¡¹ç›®èƒ½å¤Ÿä»ä¸€å¼€å§‹å°±é¿å…åŒ Swarm å’Œ Mesos ç¤¾åŒºåŒè´¨åŒ–çš„é‡è¦æ‰‹æ®µã€‚ CNCF å®ç°äº†ç›®æ ‡ä¸€ä¹‹åçš„ä»»åŠ¡å°±æ˜¯ï¼Œå¦‚ä½•æŠŠè¿™äº›å…ˆè¿›çš„æ€æƒ³é€šè¿‡æŠ€æœ¯æ‰‹æ®µåœ¨å¼€æºç¤¾åŒºè½åœ°ï¼Œå¹¶åŸ¹è‚²å‡ºä¸€ä¸ªè®¤åŒè¿™äº›ç†å¿µçš„ç”Ÿæ€ï¼Ÿè¿™æ—¶ï¼ŒRedHat å°±å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚ å½“æ—¶ï¼ŒKubernetes å›¢é˜Ÿè§„æ¨¡å¾ˆå°ï¼Œèƒ½å¤ŸæŠ•å…¥çš„å·¥ç¨‹èƒ½åŠ›ä¹Ÿååˆ†ç´§å¼ ï¼Œè€Œè¿™æ°æ°æ˜¯ RedHat çš„é•¿å¤„ã€‚æ›´éš¾å¾—çš„æ˜¯ï¼ŒRedHat æ˜¯ä¸–ç•Œä¸Šä¸ºæ•°ä¸å¤šçš„ã€èƒ½çœŸæ­£ç†è§£å¼€æºç¤¾åŒºè¿ä½œå’Œé¡¹ç›®ç ”å‘çœŸè°›çš„åˆä½œä¼™ä¼´ã€‚ æ‰€ä»¥ï¼ŒRedHat ä¸ Google è”ç›Ÿçš„æˆç«‹ï¼Œä¸ä»…ä¿è¯äº† RedHat åœ¨ Kubernetes é¡¹ç›®ä¸Šçš„å½±å“åŠ›ï¼Œä¹Ÿæ­£å¼å¼€å¯äº†å®¹å™¨ç¼–æ’é¢†åŸŸâ€œä¸‰å›½é¼ç«‹â€çš„å±€é¢ã€‚ ä» 2017 å¹´å¼€å§‹ï¼ŒDocker å…¬å¸å…ˆæ˜¯å°† Docker é¡¹ç›®çš„å®¹å™¨è¿è¡Œæ—¶éƒ¨åˆ† Containerd æèµ ç»™ CNCF ç¤¾åŒºï¼Œæ ‡å¿—ç€ Docker é¡¹ç›®å·²ç»å…¨é¢å‡çº§æˆä¸ºä¸€ä¸ª PaaS å¹³å°ï¼›ç´§æ¥ç€ï¼ŒDocker å…¬å¸å®£å¸ƒå°† Docker é¡¹ç›®æ”¹åä¸º Mobyï¼Œç„¶åäº¤ç»™ç¤¾åŒºè‡ªè¡Œç»´æŠ¤ï¼Œè€Œ Docker å…¬å¸çš„å•†ä¸šäº§å“å°†å æœ‰ Docker è¿™ä¸ªæ³¨å†Œå•†æ ‡ã€‚ Docker å…¬å¸è¿™äº›ä¸¾æªèƒŒåçš„å«ä¹‰éå¸¸æ˜ç¡®ï¼šå®ƒå°†å…¨é¢æ”¾å¼ƒåœ¨å¼€æºç¤¾åŒºåŒ Kubernetes ç”Ÿæ€çš„ç«äº‰ï¼Œè½¬è€Œä¸“æ³¨äºè‡ªå·±çš„å•†ä¸šä¸šåŠ¡ï¼Œå¹¶ä¸”é€šè¿‡å°† Docker é¡¹ç›®æ”¹åä¸º Moby çš„ä¸¾åŠ¨ï¼Œå°†åŸæœ¬å±äº Docker ç¤¾åŒºçš„ç”¨æˆ·è½¬åŒ–æˆäº†è‡ªå·±çš„å®¢æˆ·ã€‚ 2017 å¹´ 10 æœˆï¼ŒDocker å…¬å¸å‡ºäººæ„æ–™åœ°å®£å¸ƒï¼Œå°†åœ¨è‡ªå·±çš„ä¸»æ‰“äº§å“ Docker ä¼ä¸šç‰ˆä¸­å†…ç½® Kubernetes é¡¹ç›®ï¼Œè¿™æ ‡å¿—ç€æŒç»­äº†è¿‘ä¸¤å¹´ä¹‹ä¹…çš„â€œç¼–æ’ä¹‹äº‰â€è‡³æ­¤è½ä¸‹å¸·å¹•ã€‚ 2018 å¹´ 1 æœˆ 30 æ—¥ï¼ŒRedHat å®£å¸ƒæ–¥èµ„ 2.5 äº¿ç¾å…ƒæ”¶è´­ CoreOSã€‚ 2018 å¹´ 3 æœˆ 28 æ—¥ï¼Œè¿™ä¸€åˆ‡çº·äº‰çš„å§‹ä½œä¿‘è€…ï¼ŒDocker å…¬å¸çš„ CTO Solomon Hykes å®£å¸ƒè¾èŒï¼Œæ›¾ç»çº·çº·æ‰°æ‰°çš„å®¹å™¨æŠ€æœ¯åœˆå­ï¼Œåˆ°æ­¤å°˜åŸƒè½å®šã€‚","tags":["k8s"],"categories":["k8s"]},{"title":"gitåˆ é™¤æ•æ„Ÿæ–‡ä»¶çš„æäº¤å†å²","path":"/2022/06/23/403/","content":"ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‡ºç°è¿‡ git è¯¯æäº¤æ•æ„Ÿä¿¡æ¯çš„æƒ…å†µï¼Œå¦‚æœæ˜¯ç§æœ‰åº“è¿˜å¥½ï¼ŒåŠ å…¥æ˜¯å…¬æœ‰åº“å°±éå¸¸å±é™©äº†ï¼Œæˆ‘ä¹‹å‰çš„åº”å¯¹æªæ–½æ˜¯â€”â€“æ•´ä¸ªåº“åˆ é™¤ï¼Œé‡æ–°å»ºä¸ªä»“åº“æäº¤ã€‚ä½†å®é™…æ²¡å¿…è¦è¿™æ ·ï¼Œæ¯”è¾ƒ git history ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚ # config.yaml ä¸ºæ•æ„Ÿæ–‡ä»¶git filter-branch --force --index-filter &#x27;git rm --cached --ignore-unmatch config.yaml&#x27; --prune-empty --tag-name-filter cat -- --all# éšä¾¿ä¿®æ”¹ä¸ªæ–‡ä»¶ï¼Œåšç‚¹æ— å…³ç—›ç—’çš„ä¿®æ”¹å•¥çš„git commit -am &quot;puresai&quot; # å¼ºåˆ¶ pushgit push origin --force --all Thatâ€™s all!","tags":["git"],"categories":["CI"]},{"title":"gormè¯»å†™åˆ†ç¦»","path":"/2022/06/05/402/","content":"ä¹‹å‰åŒäº‹åé¦ˆ MySQL ä¸»åº“å‹åŠ›è¶Šæ¥è¶Šå¤§ï¼Œè™½ç„¶ä¸»ä»åŒæ­¥æ—©å°±å·²ç»æœ‰äº†ï¼Œä½†å‡çº§ gorm ä¹‹åä¸€ç›´æ²¡æœ‰å¼•å…¥è¯»å†™åˆ†ç¦»ï¼Œä¾¿å•†é‡ç€åŠ å…¥è¯»å†™åˆ†ç¦»å‡è½»ä¸»åº“å‹åŠ›ã€‚å¦‚ä»Šå·²ä¸Šçº¿ä¸¤æœˆæœ‰ä½™äº†ï¼Œæ¯”è¾ƒç¨³å®šï¼Œä»Šå¤©æ¥åˆ†äº«ä¸€ä¸‹åˆ©ç”¨ gorm å®ç°è¯»å†™åˆ†ç¦»ã€‚ gorm çš„è¯»å†™åˆ†ç¦»æ˜¯å·²æ‰©å±•æ’ä»¶çš„å½¢å¼å®ç°çš„ï¼Œå³ dbresolver é…ç½®æ–‡ä»¶db: separation: true # é…ç½®æ˜¯å¦ä½¿ç”¨è¯»å†™åˆ†ç¦»ï¼Œæ–¹ä¾¿æ”¹é…ç½®åˆ‡æ¢ master: &quot;root:123456@tcp(127.0.0.1:3306)/a0001_chat?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot; slave: - &quot;root:123456@tcp(127.0.0.1:3307)/a0001_chat?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot; - &quot;root:123456@tcp(127.0.0.1:3308)/a0001_chat?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot; ä¸»è¦ä»£ç package mainimport (\t&quot;fmt&quot;\t&quot;time&quot;\t&quot;github.com/pkg/errors&quot;\t&quot;github.com/sirupsen/logrus&quot;\t&quot;github.com/spf13/viper&quot;\t&quot;gorm.io/driver/mysql&quot;\t&quot;gorm.io/gorm&quot;\t&quot;gorm.io/plugin/dbresolver&quot;)var (\tMainDB *gorm.DB)func main() &#123;\tviper.SetConfigName(&quot;config&quot;)\tviper.SetConfigType(&quot;yaml&quot;)\tviper.AddConfigPath(&quot;.&quot;)\terr := viper.ReadInConfig()\tif err != nil &#123; panic(fmt.Errorf(&quot;Fatal error config file: %w &quot;, err))\t&#125;\tMainDB, err = ConnectDB()\tif err != nil &#123; panic(fmt.Errorf(&quot;Fatal MainDB config file: %w &quot;, err))\t&#125;\terr = MainDB.Raw(&quot;select version()&quot;).Error\tif err != nil &#123; logrus.Infof(&quot;err=%+v&quot;, err) return\t&#125;\tlogrus.Info(&quot;puresai&quot;)&#125;func ConnectDB() (d *gorm.DB, err error) &#123;\tif viper.GetBool(&quot;db.separation&quot;) &#123; return ConnectRWDB()\t&#125;\tdsn := viper.GetString(&quot;db.master&quot;)\td, err = gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)\tif err != nil &#123; return nil, errors.Wrap(err, &quot;æ•°æ®åº“è¿æ¥å¤±è´¥&quot;)\t&#125;\tdb, err := d.DB()\tif err != nil &#123; return nil, errors.Wrap(err, &quot;è·å–æ•°æ®åº“å®ä¾‹å¤±è´¥&quot;)\t&#125;\tdb.SetMaxIdleConns(10)\tdb.SetConnMaxLifetime(time.Hour)\treturn d, nil&#125;func ConnectRWDB() (d *gorm.DB, err error) &#123;\tlogrus.Info(&quot;ä½¿ç”¨è¯»å†™åˆ†ç¦»&quot;)\tdsn := viper.GetString(&quot;db.master&quot;)\td, err = gorm.Open(mysql.New(mysql.Config&#123; DSN: dsn,\t&#125;))\tif err != nil &#123; return nil, err\t&#125;\treplicas := []gorm.Dialector&#123;&#125;\tfor i, s := range viper.GetStringSlice(&quot;db.slave&quot;) &#123; cfg := mysql.Config&#123; DSN: s, &#125; logrus.Infof(&quot;è¯»å†™åˆ†ç¦»-%d-%s&quot;, i, s) replicas = append(replicas, mysql.New(cfg))\t&#125;\td.Use( dbresolver.Register(dbresolver.Config&#123; Sources: []gorm.Dialector&#123;mysql.New(mysql.Config&#123; DSN: dsn, &#125;)&#125;, Replicas: replicas, Policy: dbresolver.RandomPolicy&#123;&#125;, &#125;). SetMaxIdleConns(10). SetConnMaxLifetime(time.Hour). SetMaxOpenConns(200),\t)\treturn d, nil&#125; ä¸»è¦ä»£ç å°±æ˜¯: d.Use( dbresolver.Register(dbresolver.Config&#123; Sources: []gorm.Dialector&#123;mysql.New(mysql.Config&#123; DSN: dsn, &#125;)&#125;, Replicas: replicas, Policy: dbresolver.RandomPolicy&#123;&#125;, &#125;),\t) moreè¿™é‡Œåªæ˜¯åšä¸ªdemoï¼Œçœç•¥äº†ä¸šåŠ¡ä»£ç ï¼Œæ‰€ä»¥æé†’ä¸€ä¸‹ åŠ¡å¿…æµ‹è¯•ä¸‹å…·ä½“ä¸šåŠ¡ æ³¨æ„å†™åç«‹å³è¯»çš„é—®é¢˜ æ³¨æ„dbä¸ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ è¿æ¥æ± å’Œè¶…æ—¶è®¾ç½®æ ¹æ®ä¸šåŠ¡å®šä¹‰ å‚è€ƒ gorm DBResolver","tags":["gorm"],"categories":["go"]},{"title":"MySQLç´¢å¼•æç¤º-å¼ºåˆ¶ç´¢å¼•å’Œå¿½ç•¥ç´¢å¼•","path":"/2022/06/02/401/","content":"èƒŒæ™¯æ˜¨å¤©åœ¨è¿­ä»£æ–°åŠŸèƒ½æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤§è¡¨ï¼Œåƒä¸‡çº§æ•°æ®ï¼Œå¤§æ¦‚ç»“æ„å¦‚ä¸‹ï¼š CREATE TABLE `msg` ( `id` int(11) NOT NULL AUTO_INCREMENT, `uid` bigint(20) NOT NULL COMMENT &#x27;ç”¨æˆ·id&#x27;, `nickname` varchar(128) CHARACTER SET utf8mb4 NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;ç”¨æˆ·æ˜µç§°&#x27;, `room_id` int(11) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æˆ¿é—´id&#x27;, `msg` varchar(256) CHARACTER SET utf8mb4 DEFAULT NULL, `add_time` int(11) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æ·»åŠ æ—¶é—´&#x27;, `del_flag` tinyint(2) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡è®°&#x27;, `check_status` tinyint(2) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;å®¡æ ¸çŠ¶æ€&#x27;, PRIMARY KEY (`id`), KEY `idx` (`room_id`,`add_time`,`check_status`)) ENGINE=InnoDB DEFAULT CHARSET=utf8; æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š SELECT * FROM `msg` WHERE room_id = 225928 AND (add_time &gt;= 1653926400 and add_time &lt; 1654012800) AND uid not in (1111111,2222222) ORDER BY id desc LIMIT 10; Explain æ‰§è¡Œä¹‹åå‘ç° key æ˜¯ PRIMARYï¼Œ possible_keys æ˜¯ idxã€‚å½“ç„¶ï¼ŒExplain çš„æ˜¾ç¤ºä¿¡æ¯å¹¶ä¸ä¸€å®šæ­£ç¡®ï¼Œå®é™…æŸ¥è¯¢ä¸€ä¸‹è¯•è¯•çœ‹ï¼ˆå»ºè®®åœ¨mysqlè´Ÿè½½ä¸é«˜æ—¶è¯•éªŒï¼Œå¾ˆæ…¢çš„å“¦ï¼‰ æ…¢å‡ºå¤©é™…äº†ï¼ï¼ï¼ è§£é‡Šä¸è§£å†³è¯´æ˜å¯èƒ½å¦‚ Explain æ˜¾ç¤ºï¼Œæ²¡èµ°idxè¿™ä¸ªç´¢å¼•ï¼Œè€Œæ‰«æäº†å…¨è¡¨ã€‚MySQL çš„æŸ¥è¯¢ä¼˜åŒ–å¹¶ä¸å®Œå…¨å¯é ï¼Œå®ƒè®¤ä¸ºå…¨è¡¨æ‰«æä»£ä»·æ›´å°æ—¶ï¼Œä¼šæŒ‰å…¨è¡¨æ‰«æèµ°é€æ¸ç´¢å¼•ã€‚ é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿ Index Hints ç´¢å¼•æç¤ºMySQL æœ‰ä¸‰ç§ç´¢å¼•æç¤ºï¼š USE ç”¨æŒ‡å®šçš„æŸä¸ªç´¢å¼•å»åšæŸ¥è¯¢ï¼Œä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ï¼ˆå¯ä»¥æŒ‡å®šå¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯MySQLä¹Ÿå¯èƒ½ä¸ä¼šç”¨æŒ‡å®šçš„è¿™äº›ç´¢å¼•ï¼‰ FORCE å¼ºåˆ¶MySQLä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•æŸ¥è¯¢ IGNORE ä¸è¦ä½¿ç”¨æŸäº›ç´¢å¼•æŸ¥è¯¢ ä¸Šé¢é‡åˆ°çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Force SELECT * FROM `msg` FORCE INDEX(index_team_id_add_time)WHERE room_id = 225928 AND (add_time &gt;= 1653926400 and add_time &lt; 1654012800) AND uid not in (1111111,2222222) ORDER BY id desc LIMIT 10; æˆ‘ä»¬æ‰§è¡Œä¸€ä¸‹çœ‹çœ‹ï¼šå¤šæµ‹è¯•å‡ æ¬¡ï¼Œå‘ç°ç¡®å®å¿«äº†å¾ˆå¤šï¼Œè¾¾æˆé¢„æœŸæ•ˆæœã€‚ more ç´¢å¼•æç¤ºå»ºè®®é…åˆ explain ä½¿ç”¨ æµ‹è¯•çš„æ—¶å€™åŠ¡å¿…åœ¨æµé‡è°·åº•ï¼Œä»¥å…å½±å“ç”Ÿäº§ å‚è€ƒï¼š Index Hints MySQLç´¢å¼•æç¤º","tags":["sql"],"categories":["db"]},{"title":"protoæ–‡ä»¶ç”Ÿæˆgoä»£ç ","path":"/2022/05/25/400/","content":"æœ€è¿‘ä¿®æ”¹å†å²é¡¹ç›®çš„æ—¶å€™ï¼Œæœ‰ä½¿ç”¨åˆ° protoæ–‡ä»¶ç”Ÿæˆgoä»£ç ï¼Œæœ‰è¸©ä¸€ä¸‹å‘ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚ å¼€å§‹å‰å¦‚æœä¸ç†Ÿæ‚‰Protobufè¯­æ³•å¯ä»¥å…ˆçœ‹è¿™ç¯‡-Protobufè¯­æ³•ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ç”Ÿäº§å·¥å…·è¯·å…ˆæ‰§è¡Œï¼š go get -u github.com/golang/protobuf/protogo get -u github.com/golang/protobuf/protoc-gen-gogo get -u github.com/micro/micro/v2/cmd/protoc-gen-micro å°è¯•ç¼–å†™ proto æ–‡ä»¶æˆ‘ä»¬å…ˆæ–°å»ºcommon.protoï¼š syntax = &quot;proto3&quot;; //è¯­æ³•å£°æ˜enum TypeHello &#123; Unuse = 0; Morning = 1; Afernoon = 2; Evening = 3;&#125; protoc ç”Ÿæˆ .pb.goprotoc --proto_path=./ --micro_out=. --go_out=. *.proto é”™è¯¯åˆ†æèƒ½çœ‹åˆ°é”™è¯¯å…¶å®æ˜¯protoc-gen-goæŠ¥å‡ºçš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š ä½¿ç”¨ go_package å‚æ•° å‘½ä»¤è¡Œä½¿ç”¨â€“go_opt=M æˆ‘æ¯”è¾ƒå»ºè®®ä½¿ç”¨ go_packageï¼Œå½“å¤šä¸ªprotoæ–‡ä»¶æœ‰ä¾èµ–æ—¶ï¼Œä½¿ç”¨ go_package æ¯”è¾ƒæ¸…æ™°ï¼Œä½¿ç”¨ â€“go_opt=M å¯èƒ½è¦éº»çƒ¦å¾—å¤šï¼Œç”šè‡³å‡ºé”™ã€‚è¯¸å¦‚ä»¥ä¸‹ï¼š // common.protosyntax = &quot;proto3&quot;; //è¯­æ³•å£°æ˜package common; //åŒ…å// go_package ä½¿ç”¨ go mod éœ€è¦çš„è·¯å¾„å³å¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ç§æœ‰ gitlab packageoption go_package = &quot;github.com/puresai/go-learing/micro/hello/common&quot;;enum TypeHello &#123; Unuse = 0; Morning = 1; Afernoon = 2; Evening = 3;&#125; ç”Ÿæˆæ—¶åŠ¡å¿…åŠ ä¸Š â€“go_out=paths=source_relativeï¼Œå…·ä½“è¯´æ˜å¯è§æ–‡æœ«è¯´æ˜ã€‚ protoc --proto_path=. --go_out=paths=source_relative:. -I=../common *.proto è¿™é‡Œæˆ‘ä»¬ç¨å¾®å¼„å¤æ‚ä¸€ç‚¹ï¼Œhello.proto ä¾èµ– common.proto: syntax = &quot;proto3&quot;; //è¯­æ³•å£°æ˜import &quot;common.proto&quot;; // ä¾èµ–package hello; option go_package=&quot;github.com/puresai/go-learing/micro/hello/hello&quot;;// å®šä¹‰æœåŠ¡service Demo &#123; rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;// è¯·æ±‚æ•°æ®æ ¼å¼message HelloRequest &#123; string name = 1;&#125;// å“åº”æ•°æ®æ ¼å¼message HelloReply &#123; common.TypeHello hello = 2; string message = 1;&#125; æ³¨æ„è¿™é‡Œå¤šäº†ä¸ª micro_outï¼Œè¿™æ—¶éœ€è¦ protoc-gen-microçš„ï¼Œä¼šå¤šç”Ÿæˆä¸€ä¸ª.pb.micro.goæ–‡ä»¶ã€‚ protoc --proto_path=. --go_out=paths=source_relative:. --micro_out=paths=source_relative:. -I=../common *.proto æ–‡ä»¶ç”Ÿæˆäº†ï¼Œä½¿ç”¨go-microï¼ˆV2ï¼‰å†™ä¸€ä¸ªç®€å•çš„demoã€‚ package mainimport (\t&quot;context&quot;\t&quot;fmt&quot;\t&quot;log&quot;\t&quot;os&quot;\t&quot;os/signal&quot;\t&quot;syscall&quot;\t&quot;time&quot;\t&quot;github.com/puresai/go-learing/micro/hello/common&quot;\t&quot;github.com/puresai/go-learing/micro/hello/hello&quot;\t&quot;github.com/micro/go-micro/v2&quot;\t_ &quot;github.com/micro/go-plugins/registry/kubernetes/v2&quot;\t&quot;github.com/sirupsen/logrus&quot;)const (\tServiceName = &quot;hello-server&quot;)type HelloServer struct&#123;&#125;func (s *HelloServer) SayHello(ctx context.Context, req *hello.HelloRequest, res *hello.HelloReply) error &#123;\tres.Message = &quot;hello &quot; + req.Name\tres.Hello = common.TypeHello_Afernoon\treturn nil&#125;func main() &#123;\tservice := micro.NewService( // Set service name micro.Name(ServiceName), micro.AfterStart(func() error &#123; fmt.Println(&quot;starting...&quot;) return nil &#125;), micro.Address(&quot;:8089&quot;),\t)\tservice.Init()\thello.RegisterDemoHandler(service.Server(), &amp;HelloServer&#123;&#125;)\tgo func() &#123; if err := service.Run(); err != nil &#123; log.Fatal(err) &#125;\t&#125;()\tstop := make(chan os.Signal)\tsignal.Notify(stop, syscall.SIGTERM, syscall.SIGINT, os.Interrupt)\tgo func() &#123; tick := time.NewTicker(3 * time.Second) for &#123; select &#123; case &lt;-stop: tick.Stop() default: &lt;-tick.C client() &#125; &#125;\t&#125;()\tselect &#123;\tcase &lt;-stop: logrus.Infof(&quot;got exit signal, shutdown&quot;)\t&#125;&#125;func client() &#123;\tservice := micro.NewService(micro.Name(ServiceName + &quot;client&quot;))\tc := hello.NewDemoService(ServiceName, service.Client())\t// å‘èµ·RPCè°ƒç”¨\trsp, err := c.SayHello(context.TODO(), &amp;hello.HelloRequest&#123;Name: &quot;puresai&quot;&#125;)\tif err != nil &#123; fmt.Println(err)\t&#125;\t// æ‰“å°è¿”å›å€¼\tfmt.Println(rsp.Message)&#125; å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡protocç”Ÿæˆçš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ morepathsç”Ÿæˆçš„æ–‡ä»¶åœ¨è¾“å‡ºç›®å½•ä¸­çš„.pb.goä½ç½®å–å†³äºâ€“go_out æ ‡è¯†ç¬¦ã€‚æœ‰ä»¥ä¸‹æ¨¡å¼ï¼š paths=import: è¾“å‡ºæ–‡ä»¶å°†æ”¾ç½®åœ¨ä»¥ Go åŒ…çš„å¯¼å…¥è·¯å¾„å‘½åçš„ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œprotos/buzz.protoÂ å…·æœ‰ Go å¯¼å…¥è·¯å¾„çš„è¾“å…¥æ–‡ä»¶ä¼šexample.com/project/protos/fizzÂ å¯¼è‡´è¾“å‡ºæ–‡ä»¶ä½äºexample.com/project/protos/fizz/buzz.pb.go.Â paths module=$PREFIX: è¾“å‡ºæ–‡ä»¶å°†æ”¾ç½®åœ¨ä»¥ Go åŒ…çš„å¯¼å…¥è·¯å¾„å‘½åçš„ç›®å½•ä¸­ï¼Œä½†ä»è¾“å‡ºæ–‡ä»¶åä¸­åˆ é™¤æŒ‡å®šçš„ç›®å½•å‰ç¼€ã€‚ä¾‹å¦‚ï¼Œprotos/buzz.protoÂ å…·æœ‰ Go å¯¼å…¥è·¯å¾„example.com/project/protos/fizzå¹¶Â example.com/projectæŒ‡å®šä¸ºmoduleå‰ç¼€çš„è¾“å…¥æ–‡ä»¶ä¼šç”Ÿæˆä½äºprotos/fizz/buzz.pb.go.Â åœ¨æ¨¡å—è·¯å¾„ä¹‹å¤–ç”Ÿæˆä»»ä½• Go åŒ…éƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚æ­¤æ¨¡å¼å¯¹äºå°†ç”Ÿæˆçš„æ–‡ä»¶ç›´æ¥è¾“å‡ºåˆ° Go æ¨¡å—å¾ˆæœ‰ç”¨ã€‚ paths=source_relative: è¾“å‡ºæ–‡ä»¶ä¸è¾“å…¥æ–‡ä»¶æ”¾åœ¨ç›¸åŒçš„ç›¸å¯¹ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡ä»¶protos/buzz.protoÂ å¯¼è‡´è¾“å‡ºæ–‡ä»¶ä½äºprotos/buzz.pb.go.é»˜è®¤æ˜¯ç¬¬ä¸€ç§ `paths=import å…¶å®å†™æ–‡ç« çš„æ—¶å€™æˆ‘ä¹Ÿå°è¯•äº†ä¸‹ä½¿ç”¨Mï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š // è¿™é‡Œå†™æ³•æœ‰ç‚¹ç‰¹æ®Šå“¦ï¼Œæ³¨æ„ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨æ–‡ä»¶åŒä¸€ç›®å½•è¿è¡Œï¼Œæ‰€ä»¥ common.proto=../commonï¼Œè¿™æ ·ç”Ÿæˆçš„packageæ‰ä¼šæ˜¯commonï¼Œè‹¥æ˜¯ common.proto=./ç”Ÿæˆå°±æ˜¯ä¸‹åˆ’çº¿äº†protoc --proto_path=./ --micro_out=. --go_out=. --go_opt=Mcommon.proto=../common *.proto è™½ç„¶è¿™æ ·ä¹Ÿèƒ½ç”Ÿæˆï¼Œä½†ç”Ÿæˆä»£ç å¹¶ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼ˆimportéƒ¨åˆ†åªæ˜¯ä¸ªç›¸å¯¹è·¯å¾„ï¼Œæˆ–è®¸æ¢æˆç±»ä¼¼example.com/project/protos/fizzä¹Ÿèƒ½ç”Ÿæˆï¼‰ã€‚å¦‚æœæ„Ÿå…´è¶£ï¼Œæˆ‘æ›´å»ºè®®å¯ä»¥é˜…è¯»å‚è€ƒæ–‡ç« ï¼Œè‡ªè‡ªå·±ï¼Œæˆ‘ç”¨é”™äº†ä¹Ÿæœªå°ä¸å¯èƒ½å‘¢ï¼Ÿ å‚è€ƒ: Go Generated Code How to: use a shared protobuf schema (in golang)","tags":["Protobuf"],"categories":["go"]},{"title":"influxdbæ•°æ®è¿ç§»","path":"/2022/03/07/391/","content":"ä¹‹å‰å…¬å¸ç”¨çš„influxdbæ˜¯ç›´æ¥ä¹°çš„influxdbå®ä¾‹ï¼Œæœ€è¿‘å‚å•†äº§å“ä¸‹çº¿ï¼Œä¸å¾—ä¸è¿ç§»åˆ°è‡ªå·±çš„æœºå™¨ï¼Œä»¥ä¸‹æ˜¯è¿ç§»è¿‡ç¨‹ã€‚ è€ƒè™‘ç”Ÿäº§æœ‰ç°æˆçš„k8sé›†ç¾¤ï¼Œinfluxdbå®˜ç½‘æ–‡æ¡£ä¹Ÿæœ‰k8séƒ¨ç½²è¯´æ˜ï¼Œä¾¿ç›´æ¥å°†influxdbéƒ¨ç½²åˆ°k8sä¸­ã€‚ï¼ˆç‰ˆæœ¬1.8.x) éƒ¨ç½²æ–°çš„influxdbéƒ¨ç½²çš„yamlæ–‡ä»¶å¦‚ä¸‹ï¼š # å•ç‹¬å¼„ä¸ªns influxdbapiVersion: v1kind: Namespacemetadata: name: influxdb---# é…ç½®æ–‡ä»¶å¼„ä¸ªConfigMapï¼Œä¾¿äºä¿®æ”¹apiVersion: v1kind: ConfigMapmetadata: name: influxdb-config namespace: influxdbdata: influxdb.conf: &gt;- [meta] dir = &quot;/var/lib/influxdb/meta&quot; [coordinator] log-queries-after = &quot;60s&quot; max-select-series = 10000 write-timeout = &quot;30s&quot; [data] dir = &quot;/var/lib/influxdb/data&quot; engine = &quot;tsm1&quot; wal-dir = &quot;/var/lib/influxdb/wal&quot; cache-max-memory-size = &quot;0&quot; cache-snapshot-memory-size = &quot;256m&quot; index-version = &quot;tsi1&quot; max-index-log-file-size = &quot;64k&quot; max-series-per-database = 3000000 max-values-per-tag = 100000---## æŒ‚ä¸ªPersistentVolumeClaimapiVersion: v1kind: PersistentVolumeClaimmetadata: name: influxdb-data namespace: influxdbspec: accessModes: - ReadWriteOnce storageClassName: csi-xxx # è‡ªè¡Œé…ç½® resources: requests: storage: 8Gi # æŒ‰éœ€é…ç½®ï¼Œå­˜å‚¨æ•°æ®è¾ƒå¤šå¯é€‚å½“æ”¾å¤§---apiVersion: apps/v1kind: StatefulSetmetadata: labels: app: influxdb name: influxdb namespace: influxdbspec: replicas: 1 selector: matchLabels: app: influxdb serviceName: influxdb template: metadata: labels: app: influxdb spec: containers: - image: uhub.service.ucloud.cn/tv1234pub/influxdb:1.8.10 name: influxdb ports: - containerPort: 8086 name: influxdb volumeMounts: - mountPath: /var/lib/influxdb name: data - name: influxdb-config mountPath: /etc/influxdb/influxdb.conf readOnly: true subPath: influxdb.conf volumes: - name: data persistentVolumeClaim: claimName: influxdb-data - name: timezone-config hostPath: path: /usr/share/zoneinfo/Asia/Shanghai - name: influxdb-config configMap: defaultMode: 0600 name: influxdb-config---apiVersion: v1kind: Servicemetadata: name: influxdb namespace: influxdbspec: ports: - name: influxdb port: 8086 targetPort: 8086 selector: app: influxdb type: ClusterIP dump å†å²æ•°æ®dump éœ€è¦å¼€å¯ 8088 ç«¯å£ influxd backup -portable -host 172.16.xx.xxx:8088 sai-snapshot æ¢å¤æ•°æ®ä¸Šä¼  kubectl cp -r sai-snapshot influxdb/influxdb-0:/root/ influxd restore -portable ./sai-snapshot éªŒè¯influxå®¢æˆ·ç«¯æŸ¥éªŒæ•°æ®å³å¯ã€‚","tags":["influxdb"],"categories":["sql"]},{"title":"vimå¿«æ·æ“ä½œåˆ é™¤,ç§»åŠ¨","path":"/2022/02/24/390/","content":"æ¨¡å¼ å‘½ä»¤æ¨¡å¼(è¿›å…¥å³æ­¤æ¨¡å¼) è¾“å…¥æ¨¡å¼(è¾“å…¥iåˆ‡æ¢åˆ°æ­¤æ¨¡å¼) åº•çº¿å‘½ä»¤æ¨¡å¼(ESCç„¶å:) å¸¸ç”¨ï¼ˆä¸ç‰¹æ®Šè¯´æ˜éƒ½åœ¨å‘½ä»¤æ¨¡å¼ï¼Œå¸¦:çš„åº•çº¿å‘½ä»¤æ¨¡å¼ï¼‰ç©ºæ ¼é”® å‘å³ç§»åŠ¨ä¸€æ ¼x åˆ é™¤åé¢çš„å­—ç¬¦,åˆ é™¤3ä¸ªå­—ç¬¦å°±æ˜¯3x X åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦ dd åˆ é™¤ä¸€è¡Œ D åˆ é™¤åˆ°è¡Œå°¾caw æ”¹å†™å•è¯ J åˆ é™¤æ¢è¡Œç¬¦ï¼Œä½¿ä¸‹ä¸€è¡Œå¹¶ä¸Šæ¥,nJ:è¿æ¥åé¢çš„nè¡Œu æ’¤é”€ä¸Šä¸€æ¬¡æ“ä½œ U æ’¤é”€å½“å‰è¡Œçš„æ‰€æœ‰ä¿®æ”¹i åœ¨å…‰æ ‡å‰æ’å…¥I åœ¨è¡Œé¦–æ’å…¥ a åœ¨å…‰æ ‡åæ’å…¥A åœ¨è¡Œæœ«æ’å…¥o åœ¨å½“å‰è¡Œçš„ä¸‹é¢å¦èµ·ä¸€è¡Œï¼Œå¹¶å˜ä¸ºæ’å…¥æ¨¡å¼O åœ¨å½“å‰è¡Œä¸Šé¢å¦èµ·ä¸€è¡Œï¼Œå˜ä¸ºæ’å…¥æ¨¡å¼bã€3bã€wã€3w å‘å‰\\åç§»åŠ¨å‡ ä¸ªå•è¯ï¼Œæ ‡ç‚¹ä¹Ÿç®—ä¸€ä¸ªå•è¯ã€‚ç›¸åº”çš„å¤§å†™çŠ¶æ€ä¸ºä¸å«æ ‡ç‚¹ï¼Œå³åªæŠŠç©ºæ ¼å’Œæ¢è¡Œç¬¦ä½œä¸ºå•è¯é—´éš”ç¬¦ã€‚$ ç§»åŠ¨åˆ°è¡Œå°¾ï¼Œ3$ç§»åŠ¨åˆ°3è¡Œåçš„è¡Œå°¾^ ç§»åŠ¨åˆ°è¡Œé¦–ï¼Œ0ä¹Ÿæ˜¯+ ç§»åˆ°ä¸‹ä¸€è¡Œçš„è¡Œé¦–- ç§»åˆ°ä¸Šä¸€è¡Œçš„è¡Œé¦–f æœç´¢å‘½ä»¤ï¼Œå°å†™æ—¶å‘åæœç´¢ï¼ˆç”¨æ¥å®šä½ï¼‰å¦‚ fxï¼šå®šä½åˆ°ä¸‹ä¸€ä¸ªxä¸ŠFx å®šä½åˆ°ä¸Šä¸€ä¸ªxä¸Šï¼Œé‡å¤æ—¶ï¼Œå¯ç”¨;æˆ–, ä¸è¿‡ , è¡¨ç¤ºåæ–¹å‘% è·³åˆ°ç›¸å¯¹åº”çš„æ‹¬å·ä¸Šï¼Œç¼–ç¨‹æ—¶å¸¸ç”¨33G è·³è½¬åˆ°33è¡Œ æ­¤æ—¶æŒ‰``å¯ä»¥è¿”å›åˆ°åŸæ¥è¡Œgg æ–‡ä»¶å¤´ G æ–‡ä»¶å°¾30% è·³è½¬åˆ°æ–‡ä»¶çš„30%å¤„Hä¸ºHomeMä¸ºMiddleLä¸ºLastå½“å‰å±å¹•çš„ä¸Šä¸­ä¸‹ä½ç½®ï¼Œå¤§å°å†™çš†å¯Ctrl+G:æ˜¾ç¤ºå½“å‰ä½ç½®set number:è®¾ç½®æ˜¾ç¤ºè¡Œå·ï¼Œset nonumber:å…³é—­æ˜¾ç¤ºctrl+u\\d å‘ä¸Š\\ä¸‹æ»šåŠ¨åŠå±ctrl+e\\y å‘ä¸Š\\ä¸‹æ»šåŠ¨ä¸€è¡Œctrl+b\\f å‘ä¸Š\\ä¸‹æ»šåŠ¨ä¸€å± è¿™ä¸ªæ¯”è¾ƒå®ç”¨ï¼Œè®°ä½ã€‚zz å°†å½“å‰è¡Œæ»šåŠ¨äºå±å¹•ä¸­é—´ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä¸Šä¸‹æ–‡ zt ç½®é¡¶zb ç½®å°¾/string æŸ¥æ‰¾stringï¼Œå›è½¦åï¼ŒæŒ‰né”®å¯ä»¥è·³åˆ°ä¸‹ä¸€ä¸ªï¼ŒNä¸Šä¸€ä¸ªï¼Œå¦å¤–æŒ‰/é”®åï¼ŒæŒ‰ä¸Šä¸‹é”®å¯ä»¥æ‰¾åˆ°ä»¥å‰æŸ¥æ‰¾çš„è®°å½•ï¼ŒåŒæ ·çš„ ï¼šä¹Ÿæœ‰è®°å½•?/string åŒä¸Šï¼Œé»˜è®¤å‘ä¸ŠæŸ¥æ‰¾% åŒ¹é…åˆ°ç›¸åº”æ‹¬å·å¤„&gt;&gt; å‘å³ç§»åŠ¨æœ¬è¡Œä¸€æ®µè·ç¦» &lt;&lt; å‘å·¦ç§»åŠ¨æœ¬è¡Œä¸€æ®µè·ç¦» 3&lt;&lt; æŠŠä¸‹é¢3è¡Œï¼ˆåŒ…æ‹¬æœ¬è¡Œï¼‰ï¼Œå‘å·¦ç§»åŠ¨ä¸€æ®µè·ç¦» :20,30&gt;&gt; æŠŠ20è¡Œåˆ°30è¡Œå‘å³ç§»åŠ¨ä¸€æ®µè·ç¦»:set ignorecase å¤§å°å†™æ— å…³:set noignorecase å¤§å°å†™æ•æ„Ÿ* æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå…‰æ ‡æ‰€åœ¨å•è¯ # æŸ¥æ‰¾ä¸Šä¸€ä¸ª:set hlsearch é«˜äº®æ˜¾ç¤ºæŸ¥æ‰¾ç»“æœ:set nohlsearch å–æ¶ˆé«˜äº®:nohlsearch å»æ‰å½“å‰æ˜¾ç¤ºçš„é«˜å®Œï¼ˆä¸€æ¬¡æ€§ï¼‰:set paste æ ¼å¼åŒ–ç²˜è´´:set ruler è®¾ç½®åœ¨çª—å£å³ä¸‹è§’æ˜¾ç¤ºè¡Œå·ï¼Œä¸ä¸Šé¢çš„å¥½å¤„æ˜¯ï¼ŒèŠ‚çœç©ºé—´:wq ä¿å­˜é€€å‡º:q! ä¸¢å¼ƒä¿®æ”¹é€€å‡º:q æ­£å¸¸é€€å‡º","tags":["vim"],"categories":["linux"]},{"title":"2021,è¿™ä¸€å¹´","path":"/2022/01/31/2021/","content":"å…ˆç¥å¤§å®¶é™¤å¤•å¿«ä¹ï¼Œé˜–å®¶å¹¸ç¦ï¼ï¼ï¼ è™½ç„¶å·¥ä½œä¸Šå¹¶æ²¡æœ‰è¦æ±‚åšå¹´ç»ˆæ€»ç»“ï¼Œè¿˜æ˜¯ç…§ä¾‹è‡ªå·±åšä¸€ä¸‹æ€»ç»“å§ï¼ å›å¤´ç¿»çœ‹å»å¹´çš„è®¡åˆ’ï¼Œå®Œæˆäº†ä¸€åŠï¼Œé©¬é©¬è™è™ã€‚ å·¥ä½œä¸ŠåŠå¹´åŸºæœ¬éƒ½åœ¨ä¸ºå·¥ä½œçš„äº‹å¿™æ´»ï¼Œæ¢äº†åŸå¸‚ï¼Œæ¢äº†å·¥ä½œï¼Œæ¢äº†å²—ä½ï¼Œä»å‡†å¤‡åˆ°çŠ¹è±«åˆ°è¿·èŒ«å†åˆ°è½å®šï¼Œå‰å‰ååèŠ±äº†ä¸‰ä¸ªå¤šæœˆï¼Œå¥½åœ¨æœ€åæ‰¾åˆ°è‡ªå·±å¿ƒä»ªçš„å²—ä½ï¼Œç»è¿‡è¿™åŠå¹´å¤šçš„å·¥ä½œï¼Œæ€»ä½“è¿˜æ˜¯éå¸¸æ»¡æ„çš„ï¼Œä¸ç®¡æ˜¯å·¥ä½œå†…å®¹ï¼Œè¿˜æ˜¯æ°›å›´ç¯å¢ƒã€‚ è¯­è¨€ç®—æ˜¯æ­£å¼è½¬æˆgolangäº†ï¼Œä¹Ÿæ·±å…¥ä½¿ç”¨äº†k8sã€ESã€microserviceã€devopsç­‰è‡ªå·±ä¸€ç›´æƒ³æœ‰å¤§é‡å®è·µçš„ï¼Œä¹Ÿå¯ä»¥å°†è‡ªå·±çš„æƒ³æ³•åº”ç”¨äºå®é™…åœºæ™¯ä¸­ï¼Œè¿™æ˜¯éå¸¸æœ‰è¶£ä¸”æœ‰æˆå°±æ„Ÿçš„ã€‚è™½ç„¶ä¸åŠ ç­ï¼Œä½†æ¯”ä¹‹å‰çš„å·¥ä½œå¯†åº¦è¦é«˜ï¼Œå¼ºåº¦ä¹Ÿæ›´å¤§ï¼Œä½†è¿˜èƒ½æ‰¿å—ï¼Œä¹åœ¨å…¶ä¸­ã€‚ ç”Ÿæ´»ä¸‹åŠå¹´ä¸»è¦å°±åœ¨å¿™ç»“å©šçš„äº‹æƒ…ï¼Œç»ˆäºåœ¨å¹´åº•å®Œæˆäº†äººç”Ÿå¤§äº‹ï¼ŒåŠäº†å©šç¤¼é¢†äº†è¯ï¼Œæœ‰äº†æˆ‘ä»¬çš„å°å®¶ã€‚ è·Ÿéšè‡ªå·±è®¸ä¹…çš„æ¹¿ç–¹ï¼Œè¿˜æ˜¯å®¹æ˜“å¤å‘ï¼Œå»äº†çš®ç ”æ‰€è²Œä¼¼ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ•ˆæœï¼Œä½†è²Œä¼¼èƒ½å’Œå¹³ç›¸å¤„äº†ã€‚å¹´æœ«åŠäº†ä¸ªå¥èº«æœˆå¡ï¼Œæ¸¸æ³³æ…¢è·‘ï¼Œæ¯æ¬¡é”»ç‚¼å›æ¥æµ‘èº«èˆ’ç•…ã€‚ å…¶ä»–è¶ç€æ¢å·¥ä½œé—´éš™ä¸åª³å¦‡å»ç©äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œåª³å¦‡è›®å¼€å¿ƒï¼Œç­‰ç–«æƒ…å¥½äº†ï¼Œä»Šå¹´å¯ä»¥ç»§ç»­å®‰æ’ä¸Šã€‚ åŸºé‡‘å…ƒæ—¦å‰è¿˜ä¸é”™ï¼Œå…ƒæ—¦åæƒ¨ä¸å¿ç¹ï¼Œè¿˜ä¼šç»§ç»­æŒæœ‰ï¼Œæ¯•ç«Ÿé•¿æœŸçœ‹å¥½ï¼Œä¸æ…Œã€‚ ä»Šå¹´æƒ…ç»ªç®¡ç†åšå¾—ä¸åˆ°ä½ï¼Œç‰¹åˆ«æ˜¯å¯¹èº«è¾¹äººï¼Œè¿™æ˜¯æ¥å¹´éœ€è¦æ³¨æ„çš„ï¼Œä¿®èº«ä¹Ÿä¿®å¿ƒã€‚ æ–°å¹´è®¡åˆ’ å¤šè¿åŠ¨ï¼Œæ³¨æ„ä¼‘æ¯ æ³¨æ„é¥®é£Ÿï¼Œæ³¨æ„èº«ä½“å„é¡¹æŒ‡æ ‡ äº§å“åŒ–å°è¯• è‡ªåª’ä½“æ·±å…¥å°è¯• å¤šè¯»ä¹¦ï¼ŒéæŠ€æœ¯æ–¹é¢çš„ æœ€åï¼Œç¥ç¦å¤§å®¶èº«ä½“å¥åº·ï¼Œå¹³å¹³å®‰å®‰ï¼Œå¼€å¼€å¿ƒå¿ƒï¼Œå¸Œæœ›ç–«æƒ…èµ¶ç´§è¿‡å»ã€‚ è¾›ä¸‘é™¤å¤•äºå®‰åº†2022å¹´01æœˆ31æ—¥","tags":["oneyear"],"categories":["oneyear"]},{"title":"goæ€§èƒ½å·¥å…·pprof","path":"/2022/01/29/385/","content":"Go è¯­è¨€è‡ªå¸¦çš„ pprof åº“å°±å¯ä»¥åˆ†æç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œå¹¶ä¸”æä¾›å¯è§†åŒ–çš„åŠŸèƒ½ã€‚å®ƒåŒ…å«ä¸¤ä¸ªç›¸å…³çš„åº“ï¼š runtime/pprofå¯¹äºåªè·‘ä¸€æ¬¡çš„ç¨‹åºï¼Œä¾‹å¦‚æ¯å¤©åªè·‘ä¸€æ¬¡çš„ç¦»çº¿é¢„å¤„ç†ç¨‹åºï¼Œè°ƒç”¨ pprof åŒ…æä¾›çš„å‡½æ•°ï¼Œæ‰‹åŠ¨å¼€å¯æ€§èƒ½æ•°æ®é‡‡é›†ã€‚ net/http/pprofå¯¹äºåœ¨çº¿æœåŠ¡ï¼Œå¯¹äºä¸€ä¸ª HTTP Serverï¼Œè®¿é—® pprof æä¾›çš„ HTTP æ¥å£ï¼Œè·å¾—æ€§èƒ½æ•°æ®ã€‚å½“ç„¶ï¼Œå®é™…ä¸Šè¿™é‡Œåº•å±‚ä¹Ÿæ˜¯è°ƒç”¨çš„ runtime/pprof æä¾›çš„å‡½æ•°ï¼Œå°è£…æˆæ¥å£å¯¹å¤–æä¾›ç½‘ç»œè®¿é—®ã€‚ å› ä¸ºè‡ªå·±ç”¨ginæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ä½¿ç”¨github.com/gin-contrib/pprofï¼Œå…¶å®å†…éƒ¨ä¹Ÿå°±æ˜¯ä¸Šé¢ä¸¤ä¸ªåº“ã€‚ä½¿ç”¨éå¸¸ç®€å•ã€‚ var debugHttp *http.Serverfunc runPPROF() &#123;\tg := gin.New()\tg.Use(gin.Recovery())\tg.Use(gin.Logger())\tpprof.Register(g) // ä½¿ç”¨9000ç«¯å£å¼€å¯httpæœåŠ¡\tdebugHttp = &amp;http.Server&#123; Addr: &quot;:9000&quot;, Handler: g,\t&#125;\tdebugHttp.ListenAndServe()&#125; å¼€å¯ä¹‹åå¯ä»¥webè®¿é—® http://127.0.0.1:9000/debug/pprof/å¯ä»¥æŸ¥çœ‹å®æ—¶æ•°æ®ï¼Œ å½“ç„¶ä¹Ÿå¯ä»¥æŸ¥çœ‹æŸä¸ªæ—¶é—´æ®µçš„æ€§èƒ½æƒ…å†µï¼š // ç›‘å¬60sæ€§èƒ½æƒ…å†µï¼Œé»˜è®¤è¿›å…¥å‘½ä»¤è¡Œgo tool pprof http://127.0.0.1:9000/debug/pprof/profile\\?seconds\\=60 // æœ¬åœ°å¯åŠ¨httpæœåŠ¡æŸ¥çœ‹ï¼Œéœ€è¦è£…graphvizæ’ä»¶go tool pprof -http=:8080 ~/pprof/pprof.go.samples.cpu.032.pb.gz å¯ä»¥åˆ‡æ¢çœ‹å ç”¨æœ€é«˜çš„ï¼Œè¿˜æœ‰ç«ç„°å›¾ç­‰ç­‰ï¼Œç›¸å½“å¥½ç”¨ï¼Œä¸€èˆ¬æ€§èƒ½ç“¶é¢ˆå°±åœ¨å ç”¨æ¯”è¾ƒå¤šçš„ã€‚ PS: æœ‰æ—¶å€™çº¿ä¸Šå¯èƒ½æ²¡æœ‰å¼€å¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨perfå»debugæŸ¥çœ‹å ç”¨èµ„æºæ¯”è¾ƒå¤šçš„ã€‚ // 19323 ç«¯å£å·perf record -p 19323perf report å‚è€ƒï¼š æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹ pprof","tags":["go"],"categories":["go"]},{"title":"supervisord","path":"/2022/01/29/384/","content":"ç›¸ä¿¡å¤§å¤šæ•°äººéƒ½ç”¨è¿‡ python ç‰ˆæœ¬çš„ supervisor ï¼Œé‚£ä¹ˆä½ çŸ¥é“ go ç‰ˆæœ¬çš„ supervisor å—ï¼Ÿ ochinchina/supervisordochinchina/supervisordæºç  ä¸‹è½½åœ°å€ æºç å®‰è£…ï¼š git clone https://github.com/ochinchina/supervisord.git// åˆ‡æ¢åˆ°éœ€è¦çš„ç‰ˆæœ¬åˆ†æ”¯git checkout v0.7.3 // linux ç¼–è¯‘å®‰è£…// 64ä½ç‰ˆæœ¬env GOOS=linux GOARCH=amd64 go build -o supervisord_linux_amd64 é…ç½®æ–‡ä»¶demo // å†…ç½‘åœ°å€[inet_http_server]port = :9001// UIåœ°å€[supervisorctl]serverurl=http://127.0.0.1:9001// è¿›ç¨‹é…ç½®[program:hello]directory = Work/golang/command =stdout_logfile = stderr_logfile = autostart = trueuser=// depends_on=B, C å¯åŠ¨å‘½ä»¤ supervisord -c supervisor.conf -d ctl å‘½ä»¤ // ä¸æ˜¯9001ç«¯å£ï¼ŒåŠ¡å¿…æŒ‡å®š-så‚æ•°supervisord ctl -s=http://localhost:9010 statussupervisord ctl -s=http://localhost:9010 status program-1 program-2...supervisord ctl -s=http://localhost:9010 status group:*supervisord ctl stop program-1 program-2...supervisord ctl stop group:*supervisord ctl stop allsupervisord ctl -s=http://localhost:9010 start program-1 program-2...supervisord ctl start group:*supervisord ctl start allsupervisord ctl shutdownsupervisord ctl reloadsupervisord ctl signal &lt;signal_name&gt; &lt;process_name&gt; &lt;process_name&gt; ...supervisord ctl signal allsupervisord ctl pid &lt;process_name&gt;supervisord ctl fg &lt;process_name&gt;","tags":["go"],"categories":["supervisord"]},{"title":"goå®ç°LRU","path":"/2022/01/16/383/","content":"å‰ä¸€æ®µæ—¶é—´é‡æ„èŠå¤©æœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦å®šæœŸå»æ£€æµ‹Cç«¯é•¿è¿æ¥çš„æ´»è·ƒæƒ…å†µï¼Œå½“æ£€æµ‹åˆ°é•¿é“¾æ¥å¤±å»å¿ƒè·³60såï¼Œä¸»åŠ¨é‡Šæ”¾æ‰ä»¥èŠ‚çœå†…å­˜å¼€é”€ã€‚éœ€è¦æ£€æµ‹æ‰€æœ‰çš„é•¿è¿æ¥æ˜¾ç„¶æ˜¯ä¸å¤ªæ˜æ™ºçš„åšæ³•ï¼Œå› è€Œæƒ³åˆ°äº†ä½¿ç”¨LRUç®—æ³•ï¼Œä»æœ€ä¸æ´»è·ƒçš„è¿æ¥æ£€æµ‹ï¼Œå½“æ£€æµ‹åˆ°æŸä¸ªè¿æ¥çš„æ´»è·ƒæ—¶é—´å¤§äºæœ€è¿‘ä¸€åˆ†é’Ÿï¼Œåç»­çš„è¿æ¥å°±æ— éœ€æ£€æµ‹äº†ã€‚ LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ã€‚ package lruimport (\t&quot;container/list&quot;)type Link struct &#123;\tID int\tActiveTime int&#125;type Lru struct &#123;\tmaxSize int // æœ€å¤§å®¹é‡\tlist *list.List // é“¾è¡¨\tcache map[*Link]*list.Element // map&#125;func newLru(max int) *Lru &#123;\treturn &amp;Lru&#123; maxSize: max, cache: map[*Link]*list.Element&#123;&#125;, list: list.New(),\t&#125;&#125;func (l *Lru) Push(key *Link) &#123; // å·²å­˜åœ¨ï¼Œè°ƒæ•´é“¾è¡¨é¡ºåº\tif e, ok := l.cache[key]; ok &#123; l.list.MoveToFront(e)\t&#125; else &#123; row := l.list.PushFront(key) l.cache[key] = row\t&#125; // æˆ‘è¿™é‡Œæ— éœ€æ£€æµ‹é•¿åº¦\tfor l.maxSize &gt; 0 &amp;&amp; l.list.Len() &gt; l.maxSize &#123; l.removePassive()\t&#125;&#125;func (l *Lru) CheckPassive() (*Link, bool) &#123;\te := l.list.Back()\tif e == nil &#123; return nil, false\t&#125;\tlink := e.Value.(*Link)\treturn link, true&#125;func (l *Lru) Remove(key *Link) &#123;\tif e, ok := l.cache[key]; ok &#123; l.list.Remove(e) delete(l.cache, key)\t&#125;&#125;func (l *Lru) Len() int &#123;\treturn l.list.Len()&#125;func (l *Lru) removePassive() &#123;\te := l.list.Back()\tl.list.Remove(e)\tdelete(l.cache, e.Value.(*Link))&#125; æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š package lruimport &quot;testing&quot;func TestLRU(t *testing.T) &#123;\tlru := newLru(10)\tfor i := 0; i &lt; 20; i++ &#123; link1 := &amp;Link&#123;i, i + 1642262400&#125; lru.Push(link1)\t&#125;\told, _ := lru.CheckPassive()\tt.Logf(&quot;CheckPassive:%+v&quot;, old)\tt.Log(&quot;len=&quot;, lru.Len())\tfor true &#123; item, ok := lru.CheckPassive() if !ok &#123; break &#125; t.Logf(&quot;Remove:%+v&quot;, item) lru.Remove(item)\t&#125;\told, _ = lru.CheckPassive()\tt.Logf(&quot;CheckPassive:%+v&quot;, old)\tt.Log(&quot;len=&quot;, lru.Len())&#125; æˆ‘ä»¬çœ‹ä¸€ä¸‹è¾“å‡ºï¼š çœ‹æ•ˆæœæ˜¯okçš„ã€‚åˆ«ç€æ€¥åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œè®°å¾—å‹æµ‹å¯¹æ¯”ä¸‹å†å®æ–½å“¦ï¼ å‚è€ƒï¼š golang å®ç° LRU","tags":["go"],"categories":["go"]},{"title":"goæœ‰ç¼“å†²channelå’Œæ— ç¼“å†²channel","path":"/2022/01/11/382/","content":"æˆ‘ä»¬éƒ½çŸ¥é“é€šé“ï¼ˆchannelï¼‰åˆ†ä¸¤ç§ï¼š ç¼“å†²é€šé“ éç¼“å†²é€šé“// ç¼“å†²é€šé“ch1 := make(chan int, 10)ch2 := make(chan bool, 2)// éç¼“å†²é€šé“ch3 := make(chan int)ch4 := make(chan bool, 0) å‘é€é€šé“æ•°æ®// åˆ›å»ºä¸€ä¸ªç©ºæ¥å£é€šé“ï¼Œæ³¨æ„å®šä¹‰çš„é€šé“ç±»å‹æœ‰ch := make(chan interface&#123;&#125;)// å°†0æ”¾å…¥é€šé“ä¸­ch &lt;- 0// å°†helloå­—ç¬¦ä¸²æ”¾å…¥é€šé“ä¸­ch &lt;- &quot;hello&quot; æ¥æ”¶é€šé“æ•°æ® é˜»å¡æ¥æ”¶æ•°æ® data := &lt;-ch æ‰§è¡Œè¯¥è¯­å¥æ—¶å°†ä¼šé˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ•°æ®å¹¶èµ‹å€¼ç»™ data å˜é‡ã€‚ éé˜»å¡æ¥æ”¶æ•°æ® // dataï¼šè¡¨ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®ã€‚æœªæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œdata ä¸ºé€šé“ç±»å‹çš„é›¶å€¼// okï¼šè¡¨ç¤ºæ˜¯å¦æ¥æ”¶åˆ°æ•°æ®ã€‚data, ok := &lt;-ch éé˜»å¡çš„é€šé“æ¥æ”¶æ–¹æ³•å¯èƒ½é€ æˆé«˜çš„ CPU å ç”¨ï¼Œå› æ­¤ä½¿ç”¨éå¸¸å°‘ã€‚å¦‚æœéœ€è¦å®ç°æ¥æ”¶è¶…æ—¶æ£€æµ‹ï¼Œå¯ä»¥é…åˆ select å’Œè®¡æ—¶å™¨ channel è¿›è¡Œï¼Œå¯ä»¥å‚è§åé¢çš„å†…å®¹ã€‚ æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ® &lt;-ch å¾ªç¯æ¥æ”¶ package mainimport ( &quot;fmt&quot; &quot;time&quot;)func main() &#123; ch := make(chan int) // å¼€å¯ä¸€ä¸ªå¹¶å‘åŒ¿åå‡½æ•° go func() &#123; for i := 3; i &gt;= 0; i-- &#123; ch &lt;- i time.Sleep(time.Second) &#125; &#125;() // éå†æ¥æ”¶é€šé“æ•°æ® for data := range ch &#123; fmt.Println(data) if data == 0 &#123; break &#125; &#125;&#125; å…³é—­é€šé“ch := make(chan string)...close(ch) é€šé“ç‰¹æ€§: åŒä¸€ä¸ªé€šé“ï¼Œå‘é€æ“ä½œä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œæ¥æ”¶æ“ä½œä¹‹é—´ä¹Ÿæ˜¯äº’æ–¥çš„ï¼ˆå¹¶å‘å®‰å…¨ï¼‰ å‘é€æ“ä½œå’Œæ¥æ”¶æ“ä½œä¸­å¯¹å…ƒç´ å€¼çš„å¤„ç†éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ã€‚ å‘é€æ“ä½œåœ¨å®Œå…¨å®Œæˆä¹‹å‰ä¼šè¢«é˜»å¡ï¼Œæ¥æ”¶æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ã€‚ å¯¹äºç¼“å†²é€šé“ï¼šå¦‚æœé€šé“å·²æ»¡ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰å‘é€æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰å…ƒç´ å€¼è¢«æ¥æ”¶èµ°ï¼›å¦‚æœé€šé“å·²ç©ºï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰æ¥æ”¶æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰æ–°çš„å…ƒç´ å€¼å‡ºç°ã€‚å¯¹äºéç¼“å†²é€šé“ï¼šæ— è®ºæ˜¯å‘é€æ“ä½œè¿˜æ˜¯æ¥æ”¶æ“ä½œï¼Œä¸€å¼€å§‹æ‰§è¡Œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é…å¯¹çš„æ“ä½œä¹Ÿå¼€å§‹æ‰§è¡Œï¼Œæ‰ä¼šç»§ç»­ä¼ é€’ã€‚ æ³¨æ„ç‚¹ï¼šå…³é—­é€šé“è¦åœ¨å‘é€æ–¹å…³é—­ï¼Œå…³é—­åå¦‚æœchannelå†…è¿˜æœ‰å…ƒç´ ï¼Œå¹¶ä¸ä¼šå¯¹æ¥ä¸‹æ¥çš„æ¥æ”¶äº§ç”Ÿå½±å“å•å‘é€šé“æœ€ä¸»è¦çš„ç”¨é€”å°±æ˜¯çº¦æŸå…¶ä»–ä»£ç çš„è¡Œä¸ºé€šè¿‡å‡½æ•°çš„å‚æ•°ç±»å‹æˆ–è€…è¿”å›å€¼ç±»å‹æ¥é™åˆ¶ï¼ˆGoçš„è¯­æ³•ç³–ï¼‰ã€‚ func(ch chan&lt;- int) //ä¼ å…¥åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°é‡Œé¢è°ƒç”¨chåªèƒ½å‘é€func() (ch &lt;-chan int) //è¿”å›åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°å¤–é¢é‡Œé¢è°ƒç”¨chåªèƒ½æ¥æ”¶ é‚£ä¹ˆéç¼“å†²é€šé“æ˜¯ä¸æ˜¯å°±æ˜¯ç¼“å†²sizeä¸º1çš„ç¼“å†²é€šé“å‘¢ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹ï¼š func TestChan(t *testing.T) &#123;\tch := make(chan int)\tch &lt;- 1\tgo func() &#123; &lt;-ch\t&#125;()\tch &lt;- 2&#125;func TestChan2(t *testing.T) &#123;\tch := make(chan int, 1)\tch &lt;- 1\tgo func() &#123; &lt;-ch\t&#125;()\tch &lt;- 2&#125; go test è¿è¡Œä¸€ä¸‹ï¼Œä¼šå‘ç°TestChané˜»å¡ä½äº†ï¼Œch &lt;- 1 ä¸èƒ½å†™åœ¨go func å‰é¢ï¼Œé‚£ä¹ˆéç¼“å†²é€šé“æ˜¾ç„¶ä¸æ˜¯å°±æ˜¯ç¼“å†²sizeä¸º1çš„ç¼“å†²é€šé“ã€‚éç¼“å†²é€šé“åƒæ˜¯ä»¥å‰çš„å¿«é€’å‘˜ï¼Œå¿…é¡»æœ‰æ”¶è´§äººå½“é¢æ¥æ”¶æˆåŠŸï¼Œå¦åˆ™ä»–ä¼šç­‰ç€ä½ é€è´§ï¼Œæœ‰ç¼“å†²é€šé“æ›´åƒæ˜¯ç°åœ¨çš„å¿«é€’å‘˜ï¼Œç›´æ¥æ”¾åœ¨é©¿ç«™æˆ–è€…å¿«é€’æŸœï¼Œé™¤éé©¿ç«™å¿«é€’æŸœæ»¡äº†ï¼Œå¦åˆ™ä»–å°±èƒ¡å¡ï¼Œä¸ç®¡ä½ åœ¨ä¸åœ¨å®¶ï¼Œæœ‰æ²¡æœ‰æ¥æ”¶æˆåŠŸã€‚","tags":["go"],"categories":["go"]},{"title":"kubebuilderå®æˆ˜ä¹‹äºŒ","path":"/2021/11/30/382/","content":"æ–°å»ºé¡¹ç›® go mod init elastic-web kubebuilder init â€“domain com.puresai kubebuilder create api --group sai --version v1 --kind ElasticWeb /*Copyright 2021.Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);you may not use this file except in compliance with the License.You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an &quot;AS IS&quot; BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.*/package v1import (\t&quot;fmt&quot;\t&quot;github.com/spf13/cast&quot;\tmetav1 &quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;)type ElasticWebSpec struct &#123;\t// é•œåƒ\tImage string `json:&quot;image&quot;`\t// ç«¯å£\tPort *int `json:&quot;port&quot;`\t// å•ä¸ª pod çš„ qps\tSingleQPS *int `json:&quot;singleQPS&quot;`\t// æ€» qps\tTotalQPS *int `json:&quot;totalQPS&quot;`&#125;// ElasticWebStatus defines the observed state of ElasticWebtype ElasticWebStatus struct &#123;\t// å®é™… qps\tRealQPS *int `json:&quot;realQPS&quot;`&#125;type ElasticWeb struct &#123;\tmetav1.TypeMeta `json:&quot;,inline&quot;`\tmetav1.ObjectMeta `json:&quot;metadata,omitempty&quot;`\tSpec ElasticWebSpec `json:&quot;spec,omitempty&quot;`\tStatus ElasticWebStatus `json:&quot;status,omitempty&quot;`&#125;func (web *ElasticWeb) String() string &#123;\trealQPS := &quot;&quot;\tif web.Status.RealQPS == nil &#123; realQPS = &quot;nil&quot;\t&#125; else &#123; realQPS = cast.ToString(*web.Status.RealQPS)\t&#125;\treturn fmt.Sprintf(&quot;Image [%s], Port [%d], SingleQPS [%d], TotalQPS [%d], RealQPS [%s]&quot;, web.Spec.Image, *web.Spec.Port, *web.Spec.SingleQPS, *web.Spec.TotalQPS, realQPS)&#125;// ElasticWebList contains a list of ElasticWebtype ElasticWebList struct &#123;\tmetav1.TypeMeta `json:&quot;,inline&quot;`\tmetav1.ListMeta `json:&quot;metadata,omitempty&quot;`\tItems []ElasticWeb `json:&quot;items&quot;`&#125;func init() &#123;\tSchemeBuilder.Register(&amp;ElasticWeb&#123;&#125;, &amp;ElasticWebList&#123;&#125;)&#125; è®¾ç½®RBACæƒé™ï¼š elasticweb_controller.go: //+kubebuilder:rbac:groups=k8s.com.puresai,resources=elasticwebs,verbs=get;list;watch;create;update;patch;delete//+kubebuilder:rbac:groups=k8s.com.puresai,resources=elasticwebs/status,verbs=get;update;patch//+kubebuilder:rbac:groups=k8s.com.puresai,resources=elasticwebs/finalizers,verbs=update// RBAC æ–°å¢//+kubebuilder:rbac:groups=apps,resources=deployments,verbs=get;list;watch;create;update;patch;delete//+kubebuilder:rbac:groups=core,resources=services,verbs=get;list;watch;create;update;patch;delete ä»£ç æ¯”è¾ƒæ¯ç‡¥ï¼Œä¸»è¦æ–¹æ³•éƒ½åœ¨controllerï¼Œ getExpectReplicas createServiceIfNotExists createDeployment Reconcile(é»˜è®¤) å¯å‚è€ƒï¼šhttps://github.com/puresai/kubebuilder-demo/tree/master/elasticWeb ç¼–ç å®Œæˆåï¼š make install kubectl api-versions|grep â€œk8s.comâ€ æœ€åå¯ä»¥æ‰§è¡Œ make run apiVersion: v1kind: Namespacemetadata: name: sai-test labels: name: test---apiVersion: k8s.com.puresai/v1kind: ElasticWebmetadata: namespace: sai-test name: elasticweb-samplespec: # Add fields here image: nginx:1.20.2-alpine port: 80 singleQPS: 1000 totalQPS: 8800 kubectl apply -f config/samples/k8s_v1_elasticweb.yaml å‚è€ƒï¼š kubebuilderå®æˆ˜ä¹‹äº”ï¼šoperatorç¼–ç ","tags":["k8s"],"categories":["Kubernetes"]},{"title":"kubebuilderå®æˆ˜ä¹‹ä¸€","path":"/2021/11/21/381/","content":"å®‰è£…å‡†å¤‡ï¼šdockerã€kubectlã€golang å®‰è£… kustomizecd $GOPATH/binGOBIN=$(pwd)/ GO111MODULE=on go get sigs.k8s.io/kustomize/kustomize/v3 å®‰è£… kubebuilderæ ¹æ®ä½ ç”µè„‘çš„ GOOS å’Œ GOARCH å»ä¸‹è½½ å¯¹åº”çš„ç‰ˆæœ¬ï¼Œç„¶åæŠŠæ–‡ä»¶æŒªåˆ° /usr/local/bin/kubebuilderï¼Œæ‰§è¡Œ kubebuilder version mkdir -p $GOPATH/src/saicd $GOPATH/src/sai# åŠ¡å¿…åœ¨gopathç›®å½•æ‰§è¡Œï¼Œå¦åˆ™æŠ¥é”™kubebuilder init --domain com.sai# å¯æœ‰å¯æ— çš„ä¸€æ­¥go mod tidy# makemake âœ sai tree â”œâ”€â”€ Dockerfileâ”œâ”€â”€ Makefileâ”œâ”€â”€ PROJECTâ”œâ”€â”€ binâ”‚ â”œâ”€â”€ controller-genâ”‚ â””â”€â”€ managerâ”œâ”€â”€ configâ”‚ â”œâ”€â”€ defaultâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â”œâ”€â”€ manager_auth_proxy_patch.yamlâ”‚ â”‚ â””â”€â”€ manager_config_patch.yamlâ”‚ â”œâ”€â”€ managerâ”‚ â”‚ â”œâ”€â”€ controller_manager_config.yamlâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â””â”€â”€ manager.yamlâ”‚ â”œâ”€â”€ prometheusâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â””â”€â”€ monitor.yamlâ”‚ â””â”€â”€ rbacâ”‚ â”œâ”€â”€ auth_proxy_client_clusterrole.yamlâ”‚ â”œâ”€â”€ auth_proxy_role.yamlâ”‚ â”œâ”€â”€ auth_proxy_role_binding.yamlâ”‚ â”œâ”€â”€ auth_proxy_service.yamlâ”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”œâ”€â”€ leader_election_role.yamlâ”‚ â”œâ”€â”€ leader_election_role_binding.yamlâ”‚ â”œâ”€â”€ role_binding.yamlâ”‚ â””â”€â”€ service_account.yamlâ”œâ”€â”€ go.modâ”œâ”€â”€ go.sumâ”œâ”€â”€ hackâ”‚ â””â”€â”€ boilerplate.go.txtâ””â”€â”€ main.go7 directories, 26 files åˆ›å»ºAPI(CRDå’ŒController)kubebuilder create api --version v1beta1 --kind Sai --group sai âœ sai tree.â”œâ”€â”€ Dockerfileâ”œâ”€â”€ Makefileâ”œâ”€â”€ PROJECTâ”œâ”€â”€ apiâ”‚ â””â”€â”€ v1beta1â”‚ â”œâ”€â”€ groupversion_info.goâ”‚ â”œâ”€â”€ sai_types.goâ”‚ â””â”€â”€ zz_generated.deepcopy.goâ”œâ”€â”€ binâ”‚ â”œâ”€â”€ controller-genâ”‚ â””â”€â”€ managerâ”œâ”€â”€ configâ”‚ â”œâ”€â”€ crdâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â”œâ”€â”€ kustomizeconfig.yamlâ”‚ â”‚ â””â”€â”€ patchesâ”‚ â”‚ â”œâ”€â”€ cainjection_in_sais.yamlâ”‚ â”‚ â””â”€â”€ webhook_in_sais.yamlâ”‚ â”œâ”€â”€ defaultâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â”œâ”€â”€ manager_auth_proxy_patch.yamlâ”‚ â”‚ â””â”€â”€ manager_config_patch.yamlâ”‚ â”œâ”€â”€ managerâ”‚ â”‚ â”œâ”€â”€ controller_manager_config.yamlâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â””â”€â”€ manager.yamlâ”‚ â”œâ”€â”€ prometheusâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â””â”€â”€ monitor.yamlâ”‚ â”œâ”€â”€ rbacâ”‚ â”‚ â”œâ”€â”€ auth_proxy_client_clusterrole.yamlâ”‚ â”‚ â”œâ”€â”€ auth_proxy_role.yamlâ”‚ â”‚ â”œâ”€â”€ auth_proxy_role_binding.yamlâ”‚ â”‚ â”œâ”€â”€ auth_proxy_service.yamlâ”‚ â”‚ â”œâ”€â”€ kustomization.yamlâ”‚ â”‚ â”œâ”€â”€ leader_election_role.yamlâ”‚ â”‚ â”œâ”€â”€ leader_election_role_binding.yamlâ”‚ â”‚ â”œâ”€â”€ role_binding.yamlâ”‚ â”‚ â”œâ”€â”€ sai_editor_role.yamlâ”‚ â”‚ â”œâ”€â”€ sai_viewer_role.yamlâ”‚ â”‚ â””â”€â”€ service_account.yamlâ”‚ â””â”€â”€ samplesâ”‚ â””â”€â”€ sai_v1beta1_sai.yamlâ”œâ”€â”€ controllersâ”‚ â”œâ”€â”€ sai_controller.goâ”‚ â””â”€â”€ suite_test.goâ”œâ”€â”€ go.modâ”œâ”€â”€ go.sumâ”œâ”€â”€ hackâ”‚ â””â”€â”€ boilerplate.go.txtâ””â”€â”€ main.go13 directories, 38 files æ„å»ºå’Œéƒ¨ç½²CRD make installoutputï¼šUnable to connect to the server: dial tcp: lookup kubernetes.docker.internal on 192.168.0.1:53: no such hostmake: *** [install] Error 1 æŠŠ127.0.0.1 kubernetes.docker.internal åŠ å…¥æœ¬åœ°hostsé‡æ–°æ‰§è¡Œmake install å³å¯ã€‚ /Users/sai/go/src/sai/bin/controller-gen rbac:roleName=manager-role crd webhook paths=&quot;./...&quot; output:crd:artifacts:config=config/crd/bases/Users/sai/go/src/sai/bin/kustomize build config/crd | kubectl apply -f -customresourcedefinition.apiextensions.k8s.io/sais.sai.com.sai created ç¼–è¯‘å’Œè¿è¡Œcontroller æ‰“å¼€ /Users/sai/go/src/sai/controllers/sai_controller.go , è‡ªè¡Œå¢åŠ é€»è¾‘ã€‚ Demo: func (r *SaiReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) &#123;\t_ = log.FromContext(ctx)\t// TODO(user): your logic here\tfmt.Println(&quot;------sai builder used by puresai-----&quot;)\treturn ctrl.Result&#123;&#125;, nil&#125; # sai.yamlapiVersion: sai.com.sai/v1beta1kind: Saimetadata: name: sai-demo kubectl apply -f sai.yamlâœ kubectl get SaiNAME AGEsai-demo 79s åˆ¶ä½œdockeré•œåƒä¿®æ”¹ä¸‹dockerfile # Build the manager binaryFROM golang:1.16 as builderWORKDIR /workspace# Copy the Go Modules manifestsCOPY go.mod go.modCOPY go.sum go.sum# cache deps before building and copying source so that we don&#x27;t need to re-download as much# and so that source changes don&#x27;t invalidate our downloaded layer# æ”¹æ”¹æ”¹è¿™é‡Œ------RUN go env -w GOPROXY=https://goproxy.cn,directRUN go mod download# Copy the go sourceCOPY main.go main.goCOPY api/ api/COPY controllers/ controllers/# BuildRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -o manager main.go# Use distroless as minimal base image to package the manager binary# Refer to https://github.com/GoogleContainerTools/distroless for more details# æ”¹æ”¹æ”¹è¿™é‡Œ------FROM katanomi/distroless-static:nonrootWORKDIR /COPY --from=builder /workspace/manager .USER 65532:65532ENTRYPOINT [&quot;/manager&quot;] make docker-build docker-push IMG=puresai/kubebuilder-demo æ“ä½œæˆåŠŸå³å¯ï¼ å‚è€ƒï¼š kubebuilderå®æˆ˜ä¹‹ä¸€ï¼šå‡†å¤‡å·¥ä½œkubebuilderå®æˆ˜ä¹‹ä¸€ï¼šå‡†å¤‡å·¥ä½œ","tags":["k8s"],"categories":["Kubernetes"]},{"title":"ElasticSearchçš„ILMé”™è¯¯é—®é¢˜æ’æŸ¥","path":"/2021/11/15/380/","content":"ä»Šå¤©çœ‹åˆ°ç”Ÿäº§çš„esé›†ç¾¤æœ‰æŠ¥é”™ï¼š &#123;&quot;type&quot;: &quot;server&quot;, &quot;timestamp&quot;: &quot;2021-11-15T14:19:15,189Z&quot;, &quot;level&quot;: &quot;ERROR&quot;, &quot;component&quot;: &quot;o.e.x.i.IndexLifecycleRunner&quot;, &quot;cluster.name&quot;: &quot;elasticsearch&quot;, &quot;node.name&quot;: &quot;elasticsearch-master-2&quot;, &quot;message&quot;: &quot;policy [sai-log] for index [sai-detail-2021-11-02] failed on step [&#123;\\&quot;phase\\&quot;:\\&quot;hot\\&quot;,\\&quot;action\\&quot;:\\&quot;rollover\\&quot;,\\&quot;name\\&quot;:\\&quot;check-rollover-ready\\&quot;&#125;]. Moving to ERROR step&quot;, &quot;cluster.uuid&quot;: &quot;dscxSgouRw--mhyuj5Y2fw&quot;, &quot;node.id&quot;: &quot;9yklgtqpTNuQU25hIOWkxQ&quot; , &quot;stacktrace&quot;: [&quot;java.lang.IllegalArgumentException: setting [index.lifecycle.rollover_alias] for index [sai-detail-2021-11-02] is empty or not defined&quot;,&quot;at org.elasticsearch.xpack.core.ilm.WaitForRolloverReadyStep.evaluateCondition(WaitForRolloverReadyStep.java:65) [x-pack-core-7.10.1.jar:7.10.1]&quot;,&quot;at org.elasticsearch.xpack.ilm.IndexLifecycleRunner.runPeriodicStep(IndexLifecycleRunner.java:174) [x-pack-ilm-7.10.1.jar:7.10.1]&quot;,&quot;at org.elasticsearch.xpack.ilm.IndexLifecycleService.triggerPolicies(IndexLifecycleService.java:327) [x-pack-ilm-7.10.1.jar:7.10.1]&quot;,&quot;at org.elasticsearch.xpack.ilm.IndexLifecycleService.triggered(IndexLifecycleService.java:265) [x-pack-ilm-7.10.1.jar:7.10.1]&quot;,&quot;at org.elasticsearch.xpack.core.scheduler.SchedulerEngine.notifyListeners(SchedulerEngine.java:183) [x-pack-core-7.10.1.jar:7.10.1]&quot;,&quot;at org.elasticsearch.xpack.core.scheduler.SchedulerEngine$ActiveSchedule.run(SchedulerEngine.java:216) [x-pack-core-7.10.1.jar:7.10.1]&quot;,&quot;at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]&quot;,&quot;at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]&quot;,&quot;at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]&quot;,&quot;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]&quot;,&quot;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]&quot;,&quot;at java.lang.Thread.run(Thread.java:832) [?:?]&quot;] &#125; è·ŸåŒäº‹ä¸€èµ·æŸ¥çœ‹äº†ä¸‹ï¼Œå‘ç°kibanaçš„Index Managementç•Œé¢ï¼Œæœ‰é”™è¯¯æç¤ºï¼š åé¢åŒäº‹ä¿®æ”¹äº†ILMï¼Œé”™è¯¯æ¶ˆå¤±ã€‚ ä¸‹ç­å›å®¶ï¼Œå»æŸ¥äº†æ—¥å¿—ï¼Œå‘ç°é”™è¯¯ä»åœ¨ï¼Œçœ‹æ¥ç¾èª‰è§£å†³é—®é¢˜ï¼Œ GET /sai-log-2021-11-13/_ilm/explainoutputï¼š&#123; &quot;indices&quot; : &#123; &quot;sai-log-2021-11-13&quot; : &#123; &quot;index&quot; : &quot;sai-log-2021-11-13&quot;, &quot;managed&quot; : false &#125; &#125;&#125; POST /sai-log-2021-11-13/_ilm/retryoutput:&#123; &quot;error&quot; : &#123; &quot;root_cause&quot; : [ &#123; &quot;type&quot; : &quot;illegal_argument_exception&quot;, &quot;reason&quot; : &quot;cannot retry an action for an index [sai-log-2021-11-13] that has not encountered an error when running a Lifecycle Policy&quot; &#125; ], &quot;type&quot; : &quot;illegal_argument_exception&quot;, &quot;reason&quot; : &quot;cannot retry an action for an index [sai-log-2021-11-13] that has not encountered an error when running a Lifecycle Policy&quot; &#125;, &quot;status&quot; : 400&#125; å‰å¾€kibanaçš„ILMç•Œé¢ï¼Œç»‘å®šILMç­–ç•¥åˆ°index template GET /sai-log-2021-11-13/_ilm/explainoutput:&#123; &quot;indices&quot; : &#123; &quot;sai-log-2021-11-13&quot; : &#123; &quot;index&quot; : &quot;sai-log-2021-11-13&quot;, &quot;managed&quot; : true, &quot;policy&quot; : &quot;sai-log&quot;, &quot;lifecycle_date_millis&quot; : 1636732801982, &quot;age&quot; : &quot;2.94d&quot;, &quot;phase&quot; : &quot;hot&quot;, &quot;phase_time_millis&quot; : 1636986555834, &quot;action&quot; : &quot;rollover&quot;, &quot;action_time_millis&quot; : 1636733356166, &quot;step&quot; : &quot;check-rollover-ready&quot;, &quot;step_time_millis&quot; : 1636986555834, &quot;is_auto_retryable_error&quot; : true, &quot;failed_step_retry_count&quot; : 211, &quot;phase_execution&quot; : &#123; &quot;policy&quot; : &quot;sai-log&quot;, &quot;phase_definition&quot; : &#123; &quot;min_age&quot; : &quot;0ms&quot;, &quot;actions&quot; : &#123; &quot;rollover&quot; : &#123; &quot;max_size&quot; : &quot;30gb&quot;, &quot;max_age&quot; : &quot;60d&quot; &#125; &#125; &#125;, &quot;version&quot; : 3, &quot;modified_date_in_millis&quot; : 1636960453087 &#125; &#125; &#125;&#125; è§£å†³äº†ï¼Ÿ å‰å¾€kibanaçš„Index Managementç•Œé¢ï¼Œä¾æ—§å­˜åœ¨ 42 indices have lifecycle errorsã€‚ æ‰‹åŠ¨æ¥ä¸€ä¸‹ï¼š POST /sai-log-2021-11-13/_ilm/retryoutput:&#123; &quot;acknowledged&quot; : true&#125; é‡å¤explainï¼Œå‘ç°è¾“å‡ºä¸€è‡´ï¼Œå†å»kibanaçš„Index Managementç•Œé¢ç…ç…ï¼š è¿˜æœ‰ä¸€ä¸ªï¼Œretryå‘½ä»¤å¤„ç†ä¸‹å³å¯ã€‚ åŸºæœ¬ç®—æ˜¯è§£å†³äº†ã€‚ å‚è€ƒï¼š Troubleshooting index lifecycle management errorse","tags":["ElasticSearch"],"categories":["ElasticSearch"]},{"title":"MACé‡ç½®ç³»ç»Ÿåå„ç§è½¯ä»¶å®‰è£…","path":"/2021/10/30/376/","content":"å‰ä¸€é˜µMBPçš„ç”µæ± å‡ºç°é—®é¢˜ï¼Œé‡ç½®äº†ç³»ç»Ÿï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢è¿™äº›ã€‚ åŸºç¡€ç±»gitæ‰“å¼€gitä¸‹è½½åœ°å€ ä¸‹è½½gitåå®‰è£…å³å¯ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œgitåº”è¯¥æ˜¯åŸºç¡€ï¼Œbrewå¯¹gitä¹Ÿæœ‰ä¾èµ–ï¼Œæˆ‘ä¸€å¼€å§‹å°±è£…ä¸Šã€‚ å®‰è£…brewbrew å®Œå…¨æ˜¯ä¸ºäº†å®‰è£…å„ç§è½¯ä»¶æ–¹ä¾¿ã€‚ /bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot; å®‰è£…oh my zshç¾åŒ–ä¸€ä¸‹å‘½ä»¤è¡Œï¼Œçœ‹ç€å¿ƒæƒ…æ„‰æ‚¦ã€‚ sh -c &quot;$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)&quot; è®¾ç½®è¯­æ³•é«˜äº® â€“ zsh-syntax-highlighting git clone https://github.com/zsh-users/zsh-syntax-highlighting.git echo â€œsource ${(q-)PWD}/zsh-syntax-highlighting/zsh-syntax-highlighting.zshâ€ &gt;&gt; ${ZDOTDIR:-$HOME}/.zshrc source ./zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ç¾åŒ–ä¹‹åèˆ’æœå¤šäº†ã€‚ å‘½ä»¤è¡Œè¡¥å…¨https://mimosa-pudica.net/zsh-incremental.html cd ~/.oh-my-zsh/plugins/mkdir -p incrcd incr å°†ä¸Šé¢é“¾æ¥ä¸‹è½½çš„æ–‡ä»¶ç§»åŠ¨åˆ°incræ–‡ä»¶å¤¹ä¸­ echo &quot;source ~/.oh-my-zsh/plugins/incr/incr*.zsh&quot; &gt;&gt; ~/.zshrcsource ~/.zshrc å®‰è£…å„ç§è½¯ä»¶brew å‚»ç“œå¼å®‰è£…æœ‰äº†brew ä»¥åå®‰è£…ååˆ†ç®€å• brew install nodebrew install yarnbrew install mysql@5.7....... yarnå’Œnpmå»ºè®®æ›¿æ¢å›½å†…æºï¼ˆå¼€VPNå°±ä¸éœ€è¦äº†ï¼‰ï¼š // yarn ğŸŒ°yarn config set registry https://registry.npm.taobao.orgyarn config set sass_binary_site &quot;https://npm.taobao.org/mirrors/node-sass/&quot;yarn config set phantomjs_cdnurl &quot;http://cnpmjs.org/downloads&quot;yarn config set electron_mirror &quot;https://npm.taobao.org/mirrors/electron/&quot;yarn config set sqlite3_binary_host_mirror &quot;https://foxgis.oss-cn-shanghai.aliyuncs.com/&quot;yarn config set profiler_binary_host_mirror &quot;https://npm.taobao.org/mirrors/node-inspector/&quot;yarn config set chromedriver_cdnurl &quot;https://cdn.npm.taobao.org/dist/chromedriver&quot; å®˜ç½‘å®‰è£…è€ŒåƒRedis è¿™ç±»ï¼Œç»å¸¸éœ€è¦æ”¹é…ç½®ç”šè‡³æ˜¯å®éªŒå¸ƒç½®é›†ç¾¤çš„ï¼Œæˆ‘è¿˜æ˜¯ä¹ æƒ¯å®˜ç½‘ä¸‹è½½å®‰è£…ï¼Œä¾¿äºæ“ä½œé…ç½®ã€å„ç§æ£é¼“ã€‚ http://download.Redis.io/releases/Redis-6.0.6.tar.gz æ­¤å¤–ï¼Œdockerã€vscodeã€go è¿™ç±»éƒ½å¯ä»¥å‰å¾€å®˜ç½‘ä¸‹è½½ï¼Œä¸‹é¢ä»¥ go ä¸ºä¾‹ã€‚ å¯¹äºvscodeã€è°·æ­Œæµè§ˆå™¨ç­‰æä¾›äº†è´¦å·åŒæ­¥çš„ï¼Œå»ºè®®é‡ç½®ç³»ç»Ÿå‰è®¾ç½®åŒæ­¥ï¼Œåç»­é‡æ–°å®‰è£…ç™»å½•åŒæ­¥ä¹¦ç­¾ã€é…ç½®ã€æ’ä»¶ç­‰ï¼Œç®€ç›´æ˜¯å¤ªçˆ½äº†ã€‚ å®‰è£… gohttps://golang.google.cn/dl/ ä¸‹è½½éœ€è¦çš„ç‰ˆæœ¬å³å¯ã€‚ ç®€å•é…ç½®ï¼š // ä½¿ç”¨ goproxy.cn ä»£ç†åŠ é€Ÿgo env -w GOPROXY=https://goproxy.cn// ç§æœ‰ä»“åº“go env -w GOPRIVATE=git.puresai.cngit config --global url.&quot;git@git.puresai.cn:&quot;.insteadOf https://git.puresai.cn å…¶ä»–å…¶ä»–è½¯ä»¶å¯æŒ‰éœ€å‰å¾€appstoreæˆ–è½¯ä»¶å®˜ç½‘å³å¯ï¼Œå»ºè®®å®˜ç½‘ä¸‹è½½æ›´å¿«ã€‚","tags":["mac"],"categories":["mac"]},{"title":"goä½¿ç”¨ç§æœ‰module","path":"/2021/10/30/375/","content":"å‡å¦‚è‡ªå»ºgitï¼Œä½†åˆéœ€è¦ä½¿ç”¨é‡Œé¢çš„åº“ï¼Œå°±éœ€è¦é…ç½®ç§æœ‰ä»“åº“å¯ç”¨ã€‚ å¦‚æœæ²¡æœ‰é…ç½®git ssh keyï¼Œå¯å‚ç…§gitè§£å†³æ€»è¦è¾“å…¥å¯†ç çš„é—®é¢˜ è‡ªè¡Œé…ç½®ã€‚ ç„¶åï¼Œåªéœ€è¦æ‰§è¡Œï¼š // ç§æœ‰åº“go env -w GOPRIVATE=git.puresai.cn// é…ç½® git.puresai.cn åº“ä½¿ç”¨ git@git.puresai.cn æ‹‰å–ï¼Œä¸»è¦åé¢çš„ : ä¸å¯ä»¥ä¸¢äº†git config --global url.&quot;git@git.puresai.cn:&quot;.insteadOf https://git.puresai.cn è¿™æ ·å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¦‚æœæ²¡é…ç½®git çš„ ssh keyï¼Œå°±ä¸èƒ½ä½¿ç”¨&#x67;&#105;&#116;&#64;&#103;&#105;&#x74;&#46;&#x70;&#x75;&#x72;&#x65;&#115;&#97;&#x69;&#46;&#99;&#110;ï¼Œå¯ä»¥æŠŠurl æ¢æˆhttps + ç”¨æˆ·åå¯†ç çš„æ ¼å¼ï¼š https://puresai:123456@git.puresai.cn","tags":["go"],"categories":["go"]},{"title":"goå±€éƒ¨å˜é‡:=è¦æ³¨æ„ä½œç”¨åŸŸ","path":"/2021/09/15/372/","content":"ç°è±¡ä»Šå¤©å†™æ¥å£å†™äº†è¿™ä¹ˆä¸ªä»£ç ï¼š // ä¼ªä»£ç func abc(id int64) ([]*model, error) &#123;\tkey := &quot;abc&quot;\tcache, err := Redis.Get(key).Bytes()\tvar res []*model\tif err != nil &#123; res, err := service.GetFromDB(id) if err != nil &#123; return res, err &#125; Redis.Set(key, gostring.JsonEncode(res), 2*time.Minute)\t&#125; else &#123; json.Unmarshal(cache, &amp;res)\t&#125;\treturn res, nil&#125; ç„¶åæœ¬åœ°æµ‹è¯•æ¥å£ï¼Œå‘ç°æ²¡æœ‰å‘½ä¸­Redisæ—¶ï¼Œres æ€»æ˜¯ nullï¼Œååˆ†å¥‡æ€ªã€‚ Testä»”ç»†çœ‹çœ‹ï¼Œä½ èƒ½çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å—ï¼Ÿ çœ‹åˆ°æ–‡ç« æ ‡é¢˜ï¼Œåº”è¯¥èƒ½çŒœåˆ°å§ï¼ æˆ‘ä»¬å†™ä¸ªtest package testsimport (\t&quot;errors&quot;\t&quot;testing&quot;)func TestVar(t *testing.T) &#123;\tvar a int64\tbtn := true\tif btn &#123; a, err := 2, errors.New(&quot;11&quot;) t.Log(&quot;btn&quot;, a, err)\t&#125;\tt.Log(a)&#125; è¿è¡Œä¸€ä¸‹ï¼Œ whyï¼Ÿç»“æœçœ‹å‡ºæ¥äº†å—ï¼Ÿå°±æ˜¯å› ä¸ºä½¿ç”¨äº† ##:=## çš„ç¼˜æ•…ï¼Œå˜é‡åœ¨ if å†…éƒ¨æ‰æœ‰æ•ˆï¼Œä¸å½±å“ if å¤–éƒ¨å˜é‡ï¼Œä¿®æ”¹ä¹Ÿå°±ç®€å•äº†ï¼š ...res, err = service.GetFromDB(id)... å»æ‰:å³å¯ã€‚ è¿™æ˜¯ä½¿ç”¨goçš„:=éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå˜é‡ä½œç”¨åŸŸéœ€è¦æ³¨æ„å“¦ï¼","tags":["go"],"categories":["go"]},{"title":"docker-composeæ­å»ºELK","path":"/2021/09/10/370/","content":"githubå·²ç»æœ‰äººå¼„å¥½äº†ï¼Œç›´æ¥cloneä¸€ä¸‹ï¼Œ git clone https://github.com/deviantony/docker-elk.git è¿›å…¥kibanaç›®å½•kibana.ymlä¿®æ”¹å¯†ç ï¼Œæ³¨æ„å­—ç¬¦ä¸²åŠ å¼•å·ã€‚ å†è¿›å…¥docker-compose.ymlä¿®æ”¹eså¯†ç ï¼Œæ³¨æ„å­—ç¬¦ä¸²åŠ å¼•å·ã€‚ # å¯åŠ¨docker compose up -d tips: æ‹‰å–docker.elastic.coçš„é•œåƒè´¼æ…¢ï¼Œå»ºè®®æ¢æˆé˜¿é‡Œäº‘æˆ–å…¶ä»–å›½å†…é•œåƒã€‚ esæ’ä»¶å¯ä»¥ä¸‹è½½åˆ°elasticsearch/pluginsï¼Œç„¶åæŒ‚è½½ä¸€ä¸‹ï¼Œæˆ–è€…æ„å»ºé•œåƒè¿‡ç¨‹ä¸­copyè¿›å»ã€‚ ä¸‹é¢æ˜¯æˆ‘ä¿®æ”¹çš„docker-compose.ymlï¼Œå¯ä¾›å‚è€ƒã€‚ version: &#x27;3.2&#x27;services: elasticsearch: build: context: elasticsearch/ args: ELK_VERSION: $ELK_VERSION volumes: - type: bind source: ./elasticsearch/config/elasticsearch.yml target: /usr/share/elasticsearch/config/elasticsearch.yml read_only: true - type: volume source: elasticsearch target: /usr/share/elasticsearch/data # å¢åŠ  es æ’ä»¶ - type: bind source: ./elasticsearch/plugins target: /usr/share/elasticsearch/plugins ports: - &quot;9200:9200&quot; - &quot;9300:9300&quot; environment: ES_JAVA_OPTS: &quot;-Xmx256m -Xms256m&quot; ELASTIC_PASSWORD: &quot;123456&quot; discovery.type: single-node networks: - elk logstash: build: context: logstash/ args: ELK_VERSION: $ELK_VERSION volumes: - type: bind source: ./logstash/config/logstash.yml target: /usr/share/logstash/config/logstash.yml read_only: true - type: bind source: ./logstash/pipeline target: /usr/share/logstash/pipeline read_only: true ports: - &quot;5044:5044&quot; - &quot;5000:5000/tcp&quot; - &quot;5000:5000/udp&quot; - &quot;9600:9600&quot; environment: LS_JAVA_OPTS: &quot;-Xmx256m -Xms256m&quot; networks: - elk depends_on: - elasticsearch kibana: build: context: kibana/ args: ELK_VERSION: $ELK_VERSION volumes: - type: bind source: ./kibana/config/kibana.yml target: /usr/share/kibana/config/kibana.yml read_only: true ports: - &quot;5601:5601&quot; networks: - elk depends_on: - elasticsearchnetworks: elk: driver: bridgevolumes: elasticsearch: å¯åŠ¨æˆåŠŸå°±å¯ä»¥è¿›kibanaç©è€äº†ï¼Œes æ¯”è¾ƒåƒæœºå™¨å†…å­˜ï¼Œä½†ç›¸æ¯” gitlab æ„Ÿè§‰å¥½ä¸€ä¸¢ä¸¢ã€‚","tags":["Docker","ElasticSearch"],"categories":["ElasticSearch"]},{"title":"GithubProfile","path":"/2021/08/15/362/","content":"å‡ ä¸ªæœˆå‰å‘ç°github çš„ public profile å¼€æ”¾äº†æ–°åŠŸèƒ½ï¼Œåº”è¯¥å¼€æ”¾æ—¶é—´è›®ä¹…çš„ï¼Œä½†å¯èƒ½å¹¶æ²¡æœ‰å¤ªå¤šäººå…³æ³¨ï¼Œä»Šå¤©æ¥è¯´è¯´æ€ä¹ˆä½¿ç”¨ï¼ŒçœŸæ˜¯ç®€å•ã€‚ æ–°å»ºåŒåä»“åº“puresaiæ¯”å¦‚æˆ‘ï¼Œæ–°å»ºä»“åº“ï¼šhttps://github.com/puresai/puresai ç„¶åä¼šæœ‰é¡¹ç›®å³ä¾§ä¼šæç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä»“åº“ï¼Œæ­¤ä»“åº“çš„ readme ä¼šæ˜¾ç¤ºåœ¨ public profile ã€‚ ç¼–è¾‘readmeä½ å¯ä»¥è‡ªè¡Œåˆ›æ„ï¼Œmakedownè¯­æ³•ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ https://github.com/anuraghazra/github-readme-stats åšä¸€äº›é…·ç‚«ä¸€ç‚¹çš„æ•ˆæœã€‚ æ¯”å¦‚æˆ‘çš„ï¼š ### ğŸ‘‹ Hi there , [I&#x27;m puresai!](https://github.oscome.cn) ![puresai](https://visitor-badge.glitch.me/badge?page_id=puresai.puresai)- ğŸ”­ Iâ€™m currently working in NanJing, China.- ğŸŒ± Iâ€™m currently learning kubernetes, go, micro service...- ğŸ“« How to reach me: sai0556@qq.com- ğŸ’¬ Ask me about anything [here](https://github.com/puresai/puresai/issues)- &lt;a href=&quot;/images/qiniu/wechat.png&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://cdn.buymeacoffee.com/buttons/v2/default-red.png&quot; alt=&quot;Buy Me A Coffee&quot; width=&quot;150&quot; &gt;&lt;/a&gt;![Anurag&#x27;s GitHub stats](https://github-readme-stats.vercel.app/api?username=puresai&amp;show_icons=true&amp;theme=tokyonight)![Top Langs](https://github-readme-stats.vercel.app/api/top-langs/?username=puresai&amp;&amp;hide=javascript,html,css,blade&amp;layout=compact&amp;theme=material-palenight) ä¿å­˜å‘å¸ƒå³å¯ã€‚ çœ‹çœ‹æ•ˆæœå§ï¼ ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œçœ‹åˆ°åˆ«äºº profile å¥½çš„æ•ˆæœä¹Ÿå¯ä»¥å»çœ‹ä¸‹æºç è´´åˆ°è‡ªå·±çš„ä»“åº“ä½¿ç”¨å“ˆï¼","tags":["github"],"categories":["github"]},{"title":"boltdbçš„ä½¿ç”¨","path":"/2021/08/08/361/","content":"Bolt is a pure Go key/value store inspired by Howard Chuâ€™s LMDB project. The goal of the project is to provide a simple, fast, and reliable database for projects that donâ€™t require a full database server such as Postgres or MySQL. bolt æ˜¯ä¸€ä¸ªç®€å•çš„kvæ•°æ®åº“ï¼Œä½¿ç”¨åŠå…¶ç®€å•ï¼Œç›®å‰githubé¡¹ç›®å¤„äºåªè¯»çŠ¶æ€ã€‚ æ•°æ®åº“è¿æ¥package mainimport (\t&quot;log&quot;\t&quot;github.com/boltdb/bolt&quot;)func main() &#123;\t// æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šæ–°å»ºæ–‡ä»¶\tdb, err := bolt.Open(&quot;sai.db&quot;, 0600, nil)\tif err != nil &#123; log.Fatal(err)\t&#125;\tdefer db.Close()\t...&#125; äº‹åŠ¡// è¯»å†™err := db.Update(func(tx *bolt.Tx) error &#123;\t...\treturn nil&#125;)// åªè¯»ï¼Œé‡Œé¢åªèƒ½è¿›è¡Œè¯»å–æ“ä½œerr := db.View(func(tx *bolt.Tx) error &#123;\t...\treturn nil&#125;) å¸¸ç”¨æ“ä½œ// åˆ›å»ºä¸€ä¸ªbucketï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªtableb, _ := tx.CreateBucketIfNotExists([]byte(&quot;sai0556&quot;))// æ–°å¢b.Put([]byte(&quot;a&quot;), []byte(&quot;11&quot;))b.Put([]byte(&quot;b&quot;), []byte(&quot;22&quot;))// å–v := b.Get([]byte(&quot;a&quot;))fmt.Printf(&quot;The a is: %s &quot;, v)// åˆ é™¤b.Delete([]byte(&quot;a&quot;))// æ¸¸æ ‡éå†/*First() Move to the first key.Last() Move to the last key.Seek() Move to a specific key.Next() Move to the next key.Prev() Move to the previous key*/c := b.Cursor()for k, v := c.First(); k != nil; k, v = c.Next() &#123; fmt.Printf(&quot;key=%s, value=%s &quot;, k, v)&#125;// ForEach éå†b.ForEach(func(k, v []byte) error &#123; fmt.Printf(&quot;key=%s, value=%s &quot;, k, v) return nil&#125;)// åˆ é™¤buckettx.DeleteBucket([]byte(&quot;sai0556&quot;)) ä½¿ç”¨å¾ˆç®€å•ï¼Œä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š åªè¯»Viewä¸­ï¼Œä¸èƒ½ä½¿ç”¨ç¼–è¾‘ã€åˆ é™¤ã€æ–°å¢ç­‰å†™æ“ä½œï¼Œä¼šäº§ç”Ÿé”™è¯¯ å› ä¸ºåº•å±‚ä½¿ç”¨äº†è¯»å†™é”ï¼Œè¿›è¡Œå†™æ“ä½œï¼Œè¦å°½å¯èƒ½å¿«ï¼Œæ›´ä¸è¦å¼€å¯é•¿äº‹åŠ¡ï¼Œä¼šé€ æˆé˜»å¡ï¼Œå½±å“æ€§èƒ½ æ›´å¤šè¯´æ˜å¯å‚è€ƒï¼š https://pkg.go.dev/github.com/boltdb/bolt@v1.3.1 https://github.com/boltdb/bolt","tags":["boltdb"],"categories":["db"]},{"title":"nsqåŸºç¡€çŸ¥è¯†ä¸ç®€å•demo","path":"/2021/07/31/360/","content":"NSQ A realtime distributed messaging platform ä¼˜åŠ¿ åŸºäºgolang åˆ†å¸ƒå¼ æ°´å¹³æ‰©å±• è‡ªå¸¦UIï¼Œæ“ä½œå‹å¥½ å¤šè¯­è¨€client ç»„ä»¶ ç»„ä»¶ åŠŸèƒ½ nsqd æ¥æ”¶ã€æ’é˜Ÿå’Œå‘å®¢æˆ·ç«¯ä¼ é€’æ¶ˆæ¯çš„å®ˆæŠ¤è¿›ç¨‹ nsqlookupd ç®¡ç†æ‹“æ‰‘ä¿¡æ¯çš„å®ˆæŠ¤è¿›ç¨‹ nsqadmin Web UIï¼Œç”¨äºå®æ—¶æŸ¥çœ‹èšåˆçš„é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯å¹¶æ‰§è¡Œå„ç§ç®¡ç†ä»»åŠ¡ utilities å¸¸è§åŸºç¡€åŠŸèƒ½ã€æ•°æ®æµå¤„ç†å·¥å…·ï¼Œå¦‚nsq_statã€nsq_tailã€nsq_to_fileã€nsq_to_httpã€nsq_to_nsqã€to_nsq nsqdå®ƒå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä½†é€šå¸¸ä¸nsqlookupd å®ä¾‹ä¸€èµ·é…ç½®åœ¨é›†ç¾¤ä¸­ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†å®£å¸ƒä¸»é¢˜å’Œé¢‘é“ä»¥ä¾›å‘ç°ï¼‰ã€‚ å®ƒä¾¦å¬ä¸¤ä¸ª TCP ç«¯å£ï¼Œä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯ï¼Œå¦ä¸€ä¸ªç”¨äº HTTP APIã€‚å®ƒå¯ä»¥é€‰æ‹©åœ¨ç¬¬ä¸‰ä¸ªç«¯å£ä¸Šä¾¦å¬ HTTPSã€‚ nsqlookupdæœ‰ä¸¤ä¸ªæ¥å£ï¼šnsqdç”¨äºå¹¿æ’­çš„TCP æ¥å£å’Œç”¨äºå®¢æˆ·ç«¯æ‰§è¡Œå‘ç°å’Œç®¡ç†æ“ä½œçš„ HTTP æ¥å£ã€‚ MACå®‰è£… brew install nsqnsqlookupdnsqd â€“lookupd-tcp-address=127.0.0.1:4160 â€“broadcast-address=127.0.0.1nsqadmin â€“lookupd-http-address=127.0.0.1:4161 go-nsq// producerpackage nsqimport (\t&quot;context&quot;\t&quot;fmt&quot;\t&quot;time&quot;\t&quot;github.com/nsqio/go-nsq&quot;\t&quot;github.com/spf13/cast&quot;)// ä¸»å‡½æ•°func Send(ctx context.Context, cancel context.CancelFunc, topic string) &#123;\tdefer cancel()\tstr := &quot;127.0.0.1:4150&quot;\tfmt.Println(&quot;address: &quot;, str)\tproducer, err := nsq.NewProducer(str, nsq.NewConfig())\tif err != nil &#123; panic(err)\t&#125;\tproducer.SetLogger(nil, 0)\tfor i := 0; i &lt; 5; i++ &#123; msg := &quot;puresai, &quot; + cast.ToString(i) fmt.Println(&quot;publish&quot;, msg, producer.Publish(topic, []byte(msg))) time.Sleep(time.Second * 1)\t&#125;\t&lt;-ctx.Done()\tproducer.Stop()\tfmt.Println(&quot;producer exit&quot;)&#125; // consumerpackage nsqimport (\t&quot;context&quot;\t&quot;fmt&quot;\t&quot;time&quot;\t&quot;github.com/nsqio/go-nsq&quot;)// æ¶ˆè´¹è€…type Consumer struct&#123;&#125;// ä¸»å‡½æ•°func Receive(ctx context.Context, cancel context.CancelFunc, topic string) &#123;\tdefer cancel()\t// address := &quot;127.0.0.1:4161&quot;\tchannel := topic + &quot;-channel&quot;\tcfg := nsq.NewConfig()\tcfg.LookupdPollInterval = time.Second * 2\tc, err := nsq.NewConsumer(topic, channel, cfg)\tif err != nil &#123; panic(err)\t&#125;\tc.SetLogger(nil, 0) //å±è”½ç³»ç»Ÿæ—¥å¿—\tc.AddConcurrentHandlers(&amp;Consumer&#123;&#125;, 3)\t//å»ºç«‹NSQLookupdè¿æ¥\t// if err := c.ConnectToNSQLookupd(address); err != nil &#123;\t// panic(err)\t// &#125;\t//å»ºç«‹å¤šä¸ªnsqdè¿æ¥\tif err := c.ConnectToNSQDs([]string&#123;&quot;127.0.0.1:4150&quot;&#125;); err != nil &#123; panic(err)\t&#125;\t&lt;-ctx.Done()\tc.Stop()\tfmt.Println(&quot;consumer exit&quot;)&#125;// å¤„ç†æ¶ˆæ¯func (*Consumer) HandleMessage(msg *nsq.Message) error &#123;\tfmt.Println(&quot;receive&quot;, msg.NSQDAddress, &quot;message:&quot;, string(msg.Body))\treturn nil&#125; // nsq_testpackage nsqimport (\t&quot;context&quot;\t&quot;os&quot;\t&quot;os/signal&quot;\t&quot;syscall&quot;\t&quot;testing&quot;\t&quot;time&quot;)func TestReceive(t *testing.T) &#123;\ttopic := &quot;sai0556&quot;\tctx, cancel := context.WithCancel(context.Background())\tdefer cancel()\tgo Send(ctx, cancel, topic)\tgo Receive(ctx, cancel, topic)\tsig := make(chan os.Signal)\tsignal.Notify(sig, syscall.SIGTERM, syscall.SIGINT)\tt.Log(&quot;å¼€å§‹ç›‘å¬&quot;)\tselect &#123;\tcase &lt;-ctx.Done(): t.Log(&quot;ctx done&quot;) return\tcase &lt;-sig: t.Log(&quot;signal exit...&quot;) cancel() time.Sleep(2 * time.Second) return\t&#125;\t// send(topic)&#125; æµ‹è¯•èµ°ä¸€æ³¢ï¼Œ å¯¹äºNSQï¼Œè‡ªå·±ä¹Ÿæ˜¯åˆšåˆšä½¿ç”¨ï¼Œç»™æˆ‘çš„æ„Ÿè§‰æ˜¯ç›¸å½“å¥½ä¸Šæ‰‹ï¼Œä¹‹å‰æœ‰ç”¨è¿‡RabbitMQï¼Œnsqç›¸æ¯”æ¥è¯´æ›´ç®€å•ï¼Œå¯èƒ½æ˜¯go-clientç›¸å¯¹å¥½ç”¨ä¸€äº›å§ã€‚åç»­æœ‰å…¶ä»–å€¼å¾—åˆ†äº«çš„ç‚¹å†ç»§ç»­è¡¥å……ã€‚å¦‚æœ‰éœ€è¦äº¤æµï¼Œå¯è”ç³»æˆ‘email/qqã€‚ å‚è€ƒ nsq","tags":["nsq"],"categories":["MQ"]},{"title":"VSCodeè°ƒè¯•goç¨‹åº","path":"/2021/07/07/355/","content":"åœ¨é¡¹ç›®ç›®å½•æ–°å»ºï¼Œ.vscode/launch.json &#123; &quot;version&quot;: &quot;0.2.0&quot;, // ç‰ˆæœ¬å¥½ &quot;configurations&quot;: [ &#123; &quot;name&quot;: &quot;app&quot;, // åç§° &quot;type&quot;: &quot;go&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;mode&quot;: &quot;auto&quot;, &quot;program&quot;: &quot;$&#123;cwd&#125;&quot;, &quot;env&quot;: &#123;&quot;DebugEnv&quot;:&quot;1&quot;&#125;, // ç¯å¢ƒå˜é‡ &quot;args&quot;: [&quot;--config&quot;,&quot;./config-local.yaml&quot;, &quot;--listen&quot;, &quot;:8087&quot;] // å¯åŠ¨å‚æ•° &#125; ]&#125; å¯¹äºprogram: $&#123;workspaceRoot&#125; VSCodeå½“å‰æ‰“å¼€çš„æ–‡ä»¶å¤¹$&#123;file&#125; å½“å‰æ‰“å¼€çš„æ–‡ä»¶$&#123;relativeFile&#125; ç›¸å¯¹äºworkspaceRootçš„ç›¸å¯¹è·¯å¾„$&#123;fileBasename&#125; å½“å‰æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶å$&#123;fileDirname&#125; æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œæ˜¯ç»å¯¹è·¯å¾„$&#123;fileExtname&#125; å½“å‰æ‰“å¼€æ–‡ä»¶çš„æ‹“å±•åï¼Œå¦‚.json$&#123;cwd&#125; å¯åŠ¨æ—¶ä»»åŠ¡è¿è¡Œç¨‹åºçš„å½“å‰å·¥ä½œç›®å½• ç„¶åè¿è¡Œ-ã€‹å¯åŠ¨è°ƒè¯•ï¼Œå°±èƒ½è·‘èµ·æ¥äº†ï¼Œå¯ä»¥æ‰“æ–­ç‚¹è°ƒè¯•äº†ã€‚ æ–­ç‚¹ç‚¹å‡»ä»£ç è¡Œå·¦ä¾§å³å¯ï¼Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚","tags":["go"],"categories":["debug"]},{"title":"ä½¿ç”¨ConfigMapä½œä¸ºå®¹å™¨çš„é…ç½®æ–‡ä»¶","path":"/2021/06/26/350/","content":"æ„å»ºdemoé•œåƒè‡ªå·±åˆ¶ä½œä¸ªé•œåƒæ–¹ä¾¿æµ‹è¯•ã€‚ go mod init k8s-configmap-demo main.go package mainimport (\t&quot;fmt&quot;\t&quot;net/http&quot;\t&quot;github.com/gin-gonic/gin&quot;\t&quot;github.com/spf13/pflag&quot;\t&quot;github.com/spf13/viper&quot;)var (\tconf = pflag.StringP(&quot;config&quot;, &quot;c&quot;, &quot;&quot;, &quot;config filepath&quot;))type Config struct &#123;\tName string&#125;// å¯¹å¤–çš„åˆå§‹åŒ–é…ç½®æ–¹æ³•func configRun(cfg string) error &#123;\tc := Config&#123; Name: cfg,\t&#125;\tif err := c.init(); err != nil &#123; return err\t&#125;\treturn nil&#125;func (c *Config) init() error &#123;\tif c.Name != &quot;&quot; &#123; viper.SetConfigFile(c.Name)\t&#125; else &#123; // é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯./config.yaml viper.AddConfigPath(&quot;.&quot;) viper.SetConfigName(&quot;config&quot;)\t&#125;\tviper.SetConfigType(&quot;yaml&quot;)\t// viperè§£æé…ç½®æ–‡ä»¶\terr := viper.ReadInConfig() if err != nil &#123; panic(fmt.Errorf(&quot;Fatal error config file: %s &quot;, err))\t&#125;\treturn nil&#125;func main() &#123;\tpflag.Parse()\t// åˆå§‹åŒ–é…ç½®\tif err := configRun(*conf); err != nil &#123; panic(err)\t&#125;\tgin.SetMode(viper.GetString(&quot;mode&quot;))\tg := gin.New()\tg = LoadRoute(g)\tg.Run(viper.GetString(&quot;addr&quot;))&#125;func LoadRoute(g *gin.Engine) *gin.Engine &#123;\tg.Use(gin.Recovery())\t// 404\tg.NoRoute(func (c *gin.Context) &#123; c.String(http.StatusNotFound, &quot;404 not found&quot;);\t&#125;)\tg.GET(&quot;/&quot;, Index)\treturn g&#125;// è¿”å›type Response struct &#123;\tCode int `json:&quot;code&quot;`\tMessage string `json:&quot;message&quot;`\tData interface&#123;&#125; `json:&quot;data&quot;`&#125;// apiè¿”å›ç»“æ„func ApiResponse(c *gin.Context, code int, message string, data interface&#123;&#125;) &#123;\tc.JSON(http.StatusOK, Response&#123; Code: code, Message: message, Data: data,\t&#125;)&#125;func Index(c *gin.Context) &#123;\tApiResponse(c, 0, &quot;success&quot;, viper.GetString(&quot;hi&quot;))&#125; ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¯»å–config,è¿è¡Œä¸€ä¸ªgin httpæœåŠ¡ï¼Œè¿”å›é…ç½®é¡¹[hi]çš„å­—ç¬¦ä¸²ã€‚ config.yaml name: demo2mode: debugaddr: :8080hi: w~o~w Dockerfile FROM golang:alpine AS builderENV CGO_ENABLED 0ENV GOPROXY https://goproxy.cn,directWORKDIR /appADD go.mod .ADD go.sum .RUN go mod downloadCOPY main.go .RUN go build -o puresai main.goFROM alpineWORKDIR /appCOPY --from=builder /app/puresai /app/puresaiADD config.yaml .CMD [&quot;./puresai&quot;] æ„å»ºï¼š docker build -t k8s-configmap-demo:0.2 .docker tag k8s-configmap-demo:0.2 puresai/k8s-configmap-demo:0.2 æäº¤é•œåƒåˆ°hubdocker logindocker push puresai/k8s-configmap-demo:0.2 k8sçš„é…ç½®æˆ‘ä½¿ç”¨çš„æ˜¯Kuboardï¼Œä¸‹é¢çš„æ“ä½œéƒ½æ˜¯åœ¨Kuboardæ‰§è¡Œ ConfigMapé…ç½®åˆ›å»ºConfigMap:è¿›å…¥defaultç©ºé—´ &gt; èµ„æº &gt; é…ç½®å­—å…¸ï¼š åç§° sai é…ç½®æ•°æ®åç§° config.yaml é…ç½®å†…å®¹ config.yamlé‡Œçš„å†…å®¹ åˆ›å»ºè´Ÿè½½é…ç½®å¯å‚ç…§ä¸‹é¢æˆªå›¾ï¼Œæ³¨æ„å‡ å¤„ï¼š æ•°æ®å· Volumeï¼Œé€‰æ‹©configMap è¿è¡Œå®¹å™¨ç»„podçš„Commandå’ŒæŒ‚è½½ç‚¹ ä¿å­˜åå³å¯ã€‚ æœ€åè´´å‡ºç”Ÿæˆçš„yamlæ–‡ä»¶ apiVersion: v1kind: ConfigMapmetadata: # å…ƒæ•°æ®ï¼Œå®šä¹‰åŸºæœ¬å±æ€§å’Œä¿¡æ¯ name: sai-config # åç§°data: config.yaml: |- name: sai0556 mode: debug addr: :8080 hi: w~o~w---apiVersion: v1kind: Servicemetadata: name: sai labels: # æ ‡ç­¾ app: saispec: # æè¿° ports: - protocol: TCP port: 80 targetPort: 8080 selector: app: sai---apiVersion: apps/v1kind: Deploymentmetadata: name: saispec: replicas: 3 # åˆ›å»ºåº”ç”¨ç¨‹åºå®ä¾‹ä¸ªæ•° selector: # æ ‡ç­¾é€‰æ‹©å™¨ matchLabels: # é€‰æ‹©åŒ…å«æ ‡ç­¾app:saiçš„èµ„æº app: sai template: # æ¨¡æ¿ metadata: labels: app: sai spec: containers: - name: sai image: puresai/k8s-configmap-demo:0.2 imagePullPolicy: IfNotPresent command: - &#x27;/app/puresai&#x27; volumeMounts: - name: config mountPath: /app/config.yaml readOnly: true subPath: config.yaml volumes: - name: config configMap: defaultMode: 0600 name: sai-config","tags":["kubernetes"],"categories":["kubernetes"]},{"title":"é¢†åŸŸé©±åŠ¨è®¾è®¡","path":"/2021/06/10/345/","content":"é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain Driven Designï¼‰çš„æ¦‚å¿µå‡ºç°äº 2003 å¹´ï¼Œä¸æ•æ·ç›¸æ¯”ï¼ŒDDD åœ¨æå‡ºä¹‹åçš„å¾ˆå¤šå¹´éƒ½æ²¡æœ‰ç§°å¾—ä¸Šâ€œæµè¡Œâ€ï¼Œç”šè‡³è¯´ä»æœªçœŸæ­£æµè¡Œè¿‡ã€‚ä¸€éƒ¨åˆ†æ˜¯å› ä¸º DDD æ¶‰åŠäº†ä¸€äº›æ–°çš„åè¯å’Œæ¦‚å¿µï¼ˆæ¯”å¦‚èšåˆã€é™ç•Œä¸Šä¸‹æ–‡å’Œé¢†åŸŸç­‰ï¼‰ï¼Œåœ¨ç¼ºä¹å…·ä½“å®è·µæ¡ˆä¾‹çš„åœºæ™¯ä¸‹ï¼Œè¾ƒéš¾ç†è§£è¿™äº›æŠ½è±¡æ¦‚å¿µï¼Œè¿™å¯¼è‡´äº†å­¦ä¹ å’Œåº”ç”¨ DDD çš„åˆæœŸé˜¶æ®µå°±å˜å¾—ä¸å¤ªé¡ºç•…ï¼Œå¼€å‘äººå‘˜å¯èƒ½å¹¶ä¸èƒ½é¢†ä¼šåˆ°å…¶ä¸­çš„è®¾è®¡æ€æƒ³åŠå…¶å¸¦æ¥çš„ä»·å€¼ã€‚ä½†æ˜¯åœ¨å°èŒƒå›´ç¾¤ä½“å†…ï¼Œé€æ¸æœ‰ä¸€æ‰¹å·¥ç¨‹å¸ˆå¼€å§‹èƒ½å¤ŸæŒæ§è¿™ç§å»ºæ¨¡æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ DDD æ¥è®¾è®¡å‡ºå…·æœ‰è¾ƒé«˜ä¸šåŠ¡å¤æ‚æ€§çš„è½¯ä»¶åº”ç”¨ã€‚ 2013å¹´åï¼Œåˆ†å¸ƒå¼çš„åŸºç¡€è®¾æ–½é€æ¸æˆç†Ÿã€‚Martin Fowler äº 2014 å¹´å‘è¡¨äº†ç³»ç»Ÿé˜è¿°å¾®æœåŠ¡çš„æ–‡ç« ï¼Œå¾®æœåŠ¡æ¶æ„å¼€å§‹å…´èµ·ã€‚è½¯ä»¶å·¥ç¨‹å¸ˆä»¬å‘ç°å°†å•ä½“åº”ç”¨é‡‡ç”¨å¾®æœåŠ¡æ¶æ„è¿›è¡Œåˆ’åˆ†éœ€è¦å¤§é‡çš„å®è·µç»éªŒå’Œç†è®ºåŸºç¡€ä½œæŒ‡å¯¼ï¼Œå¦åˆ™ä¸èƒ½å®Œå…¨ä½“ç°å¾®æœåŠ¡æ¶æ„æ‰€å¸¦æ¥çš„ä¼˜åŠ¿ã€‚ä¸è¿‡æ—©æœŸç†Ÿæ‚‰ DDD æ€æƒ³çš„å¼€å‘è€…å‘ç°ï¼ŒDDD å¯ä»¥æœ‰æ•ˆåœ°æ ¹æ®ä¸šåŠ¡å¯¹å¤æ‚è½¯ä»¶ç³»ç»Ÿè¿›è¡Œæ‹†è§£ï¼Œå¾®æœåŠ¡æ¶æ„ä¸ DDD ç›¸å¾—ç›Šå½°ã€‚æŒ‰ç…§è½¯ä»¶å·¥ç¨‹çš„æ€æƒ³ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¾®æœåŠ¡æ—¶ï¼Œéœ€è¦æ»¡è¶³é«˜å†…èšã€ä½è€¦åˆçš„è¦æ±‚ã€‚è€Œæ ¹æ® DDD çš„æ€æƒ³ï¼Œå¯ä»¥å°†é™ç•Œä¸Šä¸‹æ–‡ä¸å¾®æœåŠ¡è¿›ç¨‹å¯¹åº”èµ·æ¥ã€‚DDD ä¸­é™ç•Œä¸Šä¸‹æ–‡çš„æ¦‚å¿µå¾ˆå¥‘åˆåŒ¹é…å¾®æœåŠ¡è¦æ±‚ï¼Œè¿™ä¸¤è€…éƒ½å¼ºè°ƒä»ä¸šåŠ¡è§’åº¦è¿›è¡Œåˆ’åˆ†ï¼Œä»¥åº”å¯¹æ—¥ç›Šå¤æ‚çš„è½¯ä»¶ç³»ç»Ÿã€‚ç”±æ­¤ï¼ŒDDD è¿æ¥äº†å®ƒçš„é«˜é€Ÿå‘å±•å’Œæ¨å¹¿æ—¶æœŸã€‚ DDD ä¸æ˜¯è¯­è¨€ï¼Œä¸æ˜¯æ¡†æ¶ï¼Œä¸æ˜¯æ¶æ„ï¼Œè€Œæ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸€ç§æ–¹æ³•è®ºï¼Œå®ƒå¯ä»¥åˆ†ç¦»ä¸šåŠ¡å¤æ‚åº¦å’ŒæŠ€æœ¯å¤æ‚åº¦ï¼›DDD ä¹Ÿå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„äº‹ç‰©ï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡çš„æå‡ï¼Œæœ€ç»ˆç›®æ ‡è¿˜æ˜¯é«˜å†…èšã€ä½è€¦åˆã€‚ Eric Evansåœ¨ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ä¸€ä¹¦ä¸­ï¼Œæå‡ºäº†ç»å…¸çš„å››å±‚æ¶æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç”¨æˆ·ç•Œé¢User Interfaceè´Ÿè´£ç»™ç”¨æˆ·å±•ç¤ºä¿¡æ¯ï¼Œå¹¶è§£é‡Šç”¨æˆ·å‘½ä»¤ã€‚ åº”ç”¨å±‚Applicationè´Ÿè´£åè°ƒåº”ç”¨ç¨‹åºçš„æ´»åŠ¨ã€‚ä¸åŒ…æ‹¬ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¿å­˜ä¸šåŠ¡å¯¹è±¡çš„çŠ¶æ€ï¼Œä½†èƒ½ä¿å­˜åº”ç”¨ç¨‹åºä»»åŠ¡è¿‡ç¨‹çš„çŠ¶æ€ã€‚ é¢†åŸŸå±‚Domainè´Ÿè´£ä¸šåŠ¡é¢†åŸŸçš„ä¿¡æ¯å’ŒçŠ¶æ€çš„ä¿å­˜å’Œç»´æŠ¤ã€‚ä¸šåŠ¡å¯¹è±¡çš„æŒä¹…åŒ–å’Œå®ƒä»¬çš„çŠ¶æ€å¯èƒ½ä¼šå§”æ‰˜ç»™åŸºç¡€è®¾æ–½å±‚ã€‚ åŸºç¡€è®¾æ–½å±‚Infrastructureè´Ÿè´£æ”¯æŒå…¶ä»–å±‚æ¬¡ï¼Œæä¾›åŸºç¡€çš„æ¶ˆæ¯ä¼ é€’ã€æ•°æ®æŒä¹…åŒ–ç­‰åŠŸèƒ½ã€‚å®ƒæä¾›å±‚ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’ï¼Œå®ç°ä¸šåŠ¡å¯¹è±¡çš„æŒä¹…åŒ–ï¼ŒåŒ…å«å¯¹ç”¨æˆ·ç•Œé¢å±‚çš„æ”¯æŒæ€§åº“ç­‰ã€‚ æˆ‘ä»¬ä»¥è´­ç‰©è½¦ä¸‹è®¢å•åŠŸèƒ½ä¸ºä¾‹æ¥è§£é‡Šè¿™å„ä¸ªå±‚é¢çš„ä½œç”¨ï¼š ç”¨æˆ·ç•Œé¢å±‚æä¾›ä¸‹å•çš„æ¥å£ åº”ç”¨å±‚è´Ÿè´£é€»è¾‘çš„æ•´åˆï¼Œå¦‚è´­ç‰©è½¦æ¸…ç©ºã€æ£€æŸ¥åº“å­˜ç­‰ é¢†åŸŸå±‚å°†è´­ç‰©è½¦ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å°è£…åˆ°ä¸€ä¸ª ShoppingCar å¯¹è±¡ä¸­ï¼Œè°ƒç”¨ shoppingCar.orderä¸‹è®¢å•ï¼Œä¸šåŠ¡æœåŠ¡çš„é‡å¿ƒä»ç”Ÿæˆè®¢å•è¡¨ä¸­çš„è®°å½•è½¬ç§»åˆ°è´­ç‰©è½¦å¯¹è±¡æœ¬èº« åº•å±‚æ•°æ®åº“ä¸­å¦‚ä½•ç”Ÿæˆè¿™æ¡è®°å½•å¹¶ä¸å±äºæˆ‘ä»¬çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè¿™å¯¹åº” DDD ä¸­çš„åŸºç¡€è®¾æ–½å±‚ï¼Œç”± Repository æˆ–è€… Dao ç­‰æ•°æ®äº¤äº’å¯¹è±¡è´Ÿè´£å»æŒä¹…åŒ–æˆ‘ä»¬å¯¹é¢†åŸŸæ¨¡å‹ä¸‹è¾¾çš„æŒ‡ä»¤æ‰€äº§ç”Ÿçš„æ•°æ®åº“å˜åŒ–ã€‚","tags":["DDD"],"categories":["design"]},{"title":"Protobufè¯­æ³•","path":"/2021/05/27/340/","content":"Protobufæ˜¯Protocol Bufferçš„ç®€ç§°ï¼Œå®ƒæ˜¯Googleå…¬å¸å¼€å‘çš„ä¸€ç§æ•°æ®æè¿°è¯­è¨€ï¼Œç”¨äºæè¿°ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®æ ¼å¼ï¼Œå¹³å°æ— å…³ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•ï¼Œå¸¸ç”¨äºRPCç³»ç»Ÿå’ŒæŒç»­æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚ å­—æ®µè§„åˆ™å­—æ®µæ ¼å¼ é™å®šä¿®é¥°ç¬¦ | æ•°æ®ç±»å‹ | å­—æ®µåç§° | = | å­—æ®µç¼–ç å€¼ | [å­—æ®µé»˜è®¤å€¼] é™å®šä¿®é¥°ç¬¦ requiredã€optionalã€repeated Requiredï¼šè¡¨ç¤ºæ˜¯ä¸€ä¸ªå¿…é¡»å­—æ®µ Optionalï¼šè¡¨ç¤ºä¸€ä¸ªå¯é€‰å­—æ®µã€‚å¯¹äºæ¥æ”¶æ–¹ï¼Œå¦‚æœèƒ½å¤Ÿè¯†åˆ«å¯é€‰å­—æ®µå°±è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚æœæ— æ³•è¯†åˆ«ï¼Œåˆ™å¿½ç•¥è¯¥å­—æ®µ Repeatedï¼šè¡¨ç¤ºè¯¥å­—æ®µå¯ä»¥åŒ…å«0-Nä¸ªå…ƒç´ ã€‚å…¶ä¸­ç‰¹æ€§å’Œoptionalä¸€æ ·ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡å¯ä»¥åŒ…å«å¤šä¸ªå€¼ã€‚å¯ä»¥çœ‹åšæ˜¯åœ¨ä¼ é€’ä¸€ä¸ªæ•°ç»„çš„å€¼ æ•°æ®ç±»å‹Protobufå®šä¹‰äº†ä¸€å¥—åŸºæœ¬æ•°æ®ç±»å‹ï¼š .proto ç±»å‹ Notes C++ Type Java Type Python Type Go Type Ruby Type C# Type PHP Type Dart Type double double double float float64 Float double float double float float float float float32 Float float float double int32 ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç¼–ç è´Ÿæ•°çš„æ•ˆç‡ä½ - å¦‚æœæ‚¨çš„å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨sint32ã€‚ int32 int int int32 Fixnum or Bignum (as required) int integer int int64 ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç¼–ç è´Ÿæ•°çš„æ•ˆç‡ä½ - å¦‚æœæ‚¨çš„å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨sint64ã€‚ int64 long int/long[] int64 Bignum long integer/string[] Int64 uint32 ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç  uint32 int int/long uint32 Fixnum or Bignum (as required) uint integer int uint64 ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç . uint64 long int/long uint64 Bignum ulong integer/string[] Int64 sint32 ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç­¾åçš„intå€¼ã€‚è¿™äº›æ¯”å¸¸è§„int32æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°ã€‚ int32 int int int32 Fixnum or Bignum (as required) int integer int sint64 ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç­¾åçš„intå€¼ã€‚è¿™äº›æ¯”å¸¸è§„int64æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°ã€‚ int64 long int/long int64 Bignum long integer/string[] Int64 fixed32 æ€»æ˜¯å››ä¸ªå­—èŠ‚ã€‚å¦‚æœå€¼é€šå¸¸å¤§äº228ï¼Œåˆ™æ¯”uint32æ›´æœ‰æ•ˆã€‚ uint32 int int/long uint32 Fixnum or Bignum (as required) uint integer int fixed64 æ€»æ˜¯å…«ä¸ªå­—èŠ‚ã€‚å¦‚æœå€¼é€šå¸¸å¤§äº256ï¼Œåˆ™æ¯”uint64æ›´æœ‰æ•ˆ uint64 long int/long[] uint64 Bignum ulong integer/string[] Int64 sfixed32 æ€»æ˜¯å››ä¸ªå­—èŠ‚ int32 int int int32 Fixnum or Bignum (as required) int integer int sfixed64 æ€»æ˜¯å…«ä¸ªå­—èŠ‚ int64 long int/long int64 Bignum long integer/string[] Int64 bool bool boolean bool bool TrueClass/FalseClass bool boolean bool string å­—ç¬¦ä¸²å¿…é¡»å§‹ç»ˆåŒ…å«UTF-8ç¼–ç æˆ–7ä½ASCIIæ–‡æœ¬ï¼Œä¸”ä¸èƒ½è¶…è¿‡232ã€‚ string String str/unicode string String (UTF-8) string string String bytes å¯ä»¥åŒ…å«ä¸è¶…è¿‡232çš„ä»»æ„å­—èŠ‚åºåˆ—ã€‚ string ByteString str []byte String (ASCII-8BIT) ByteString string List å­—æ®µåç§°å­—æ®µåç§°çš„å‘½åä¸Cã€Javaç­‰è¯­è¨€çš„å˜é‡å‘½åæ–¹å¼å‡ ä¹æ˜¯ç›¸åŒçš„protobuf å»ºè®®å­—æ®µçš„å‘½åé‡‡ç”¨ä»¥ä¸‹åˆ’çº¿åˆ†éš”çš„é©¼å³°å¼ å­—æ®µç¼–ç å€¼æœ‰äº†è¯¥å€¼ï¼Œé€šä¿¡åŒæ–¹æ‰èƒ½äº’ç›¸è¯†åˆ«å¯¹æ–¹çš„å­—æ®µï¼Œç›¸åŒçš„ç¼–ç å€¼ï¼Œå…¶é™å®šä¿®é¥°ç¬¦å’Œæ•°æ®ç±»å‹å¿…é¡»ç›¸åŒï¼Œç¼–ç å€¼çš„å–å€¼èŒƒå›´ä¸ºï¼š1 ~ 2^32 (4294967296)å…¶ä¸­ 1 ~ 15çš„ç¼–ç æ—¶é—´å’Œç©ºé—´æ•ˆç‡éƒ½æ˜¯æœ€é«˜çš„ï¼Œç¼–ç å€¼è¶Šå¤§ï¼Œå…¶ç¼–ç çš„æ—¶é—´å’Œç©ºé—´æ•ˆç‡å°±è¶Šä½1900 ~ 2000 ç¼–ç å€¼ä¸º Google protobuf ç³»ç»Ÿå†…éƒ¨ä¿ç•™å€¼ï¼Œå»ºè®®ä¸è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ å­—æ®µé»˜è®¤å€¼å½“åœ¨ä¼ é€’æ•°æ®æ—¶ï¼Œå¯¹äºrequiredæ•°æ®ç±»å‹ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®å€¼ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ä¼ é€’åˆ°å¯¹ç«¯ å®šä¹‰service å¦‚æœæƒ³è¦å°†æ¶ˆæ¯ç±»å‹ç”¨åœ¨ RPC ç³»ç»Ÿä¸­ï¼Œå¯ä»¥åœ¨ .protoæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª RPC æœåŠ¡æ¥å£ï¼Œprotocol buffer ç¼–è¯‘å™¨ä¼šæ ¹æ®æ‰€é€‰æ‹©çš„ä¸åŒè¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç  ç”Ÿæˆçš„æ¥å£ä»£ç ä½œä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„çº¦å®šï¼ŒæœåŠ¡ç«¯å¿…é¡»å®ç°å®šä¹‰çš„æ‰€æœ‰æ¥å£æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨åŒåæ–¹æ³•å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ï¼ˆå³ä¾¿ä¸šåŠ¡ä¸Šä¸éœ€è¦å‚æ•°ä¹Ÿå¿…é¡»æŒ‡å®šä¸€ä¸ªè¯·æ±‚æ¶ˆæ¯ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¸€ä¸ªç©ºmessageï¼‰ æ¯”å¦‚ï¼Œæƒ³è¦å®šä¹‰ä¸€ä¸ª RPC æœåŠ¡å¹¶å…·æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ SearchRequest å¹¶è¿”å›ä¸€ä¸ª SearchResponseï¼Œæ­¤æ—¶å¯ä»¥åœ¨.protoæ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š service SearchService &#123;\trpc Search(SearchRequest) returns (SearchResponse) &#123;&#125;&#125; å®šä¹‰Message ä¸€ä¸ª message ç±»å‹å®šä¹‰æè¿°äº†ä¸€ä¸ªè¯·æ±‚æˆ–å“åº”çš„æ¶ˆæ¯æ ¼å¼ï¼Œå¯ä»¥åŒ…å«å¤šç§ç±»å‹å­—æ®µ å­—æ®µåç”¨å°å†™ï¼Œè½¬ä¸º go æ–‡ä»¶åè‡ªåŠ¨å˜ä¸ºå¤§å†™ï¼Œmessage å°±ç›¸å½“äºç»“æ„ä½“ æ·»åŠ æ›´å¤š Message ç±»å‹ä¸€ä¸ª .proto æ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªæ¶ˆæ¯ç±»å‹ï¼Œä¸€èˆ¬ç”¨äºåŒæ—¶å®šä¹‰å¤šä¸ªç›¸å…³çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚åœ¨åŒä¸€ä¸ª .proto æ–‡ä»¶ä¸­åŒæ—¶å®šä¹‰æœç´¢è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ï¼š // å£°æ˜ä½¿ç”¨çš„ protobuf ç‰ˆæœ¬syntax = &quot;proto3&quot;message SearchRequest &#123;\tstring query = 1;\tint32 page_number = 2;\tint32 result_per_page = ;&#125;message SearchResponse &#123;&#125; ä½¿ç”¨å…¶ä»– Messagemessage æ”¯æŒåµŒå¥—ä½¿ç”¨ï¼Œä½œä¸ºå¦ä¸€ä¸ª message ä¸­çš„å­—æ®µç±»å‹ message SearchResponse &#123;\trepeated Result results = 1;&#125;message Result &#123;\tstring url = 1;\tstring title = 2;\trepeated string snippets = ;&#125; Message åµŒå¥—çš„ä½¿ç”¨æ”¯æŒåµŒå¥—æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¯ä»¥åŒ…å«å¦ä¸€ä¸ªæ¶ˆæ¯ä½œä¸ºå­—æ®µã€‚ä¹Ÿå¯ä»¥åœ¨æ¶ˆæ¯å†…å®šä¹‰ä¸€ä¸ªæ–°çš„æ¶ˆæ¯ã€‚ å†…éƒ¨å£°æ˜çš„ message ç±»å‹åç§°åªå¯åœ¨å†…éƒ¨ç›´æ¥ä½¿ç”¨ï¼š message SearchResponse &#123;\tmessage Result &#123; string url = 1; string title = 2; repeated string snippets = ;\t&#125;\trepeated Result results = 1;&#125; å¤šå±‚åµŒå¥—ï¼š message Outer &#123;\tmessage A &#123; message Inner &#123; int64 ival = 1; bool booly = 2; &#125;\t&#125;\tmessage B &#123; message Inner &#123; int64 ival = 1; bool booly = 2; &#125;\t&#125;&#125; æ˜ å°„å­—æ®µæ¯ä¸ªæ˜ å°„å­—æ®µä¼šåœ¨Goçš„ç»“æ„ä½“ä¸­ç”Ÿæˆä¸€ä¸ªmap[TKey]TValueç±»å‹çš„å­—æ®µï¼Œå…¶ä¸­TKeyæ˜¯å­—æ®µçš„é”®ç±»å‹TValueæ˜¯å­—æ®µçš„å€¼ç±»å‹ã€‚å¯¹äºä¸‹é¢è¿™ä¸ªæ¶ˆæ¯å®šä¹‰ï¼š message Bar &#123;&#125;message Baz &#123; map&lt;string, Bar&gt; foo = 1;&#125; ç¼–è¯‘å™¨ç”ŸæˆGoç»“æ„ä½“ type Baz struct &#123; Foo map[string]*Bar&#125; æšä¸¾ç»™å‡ºå¦‚ä¸‹æšä¸¾ message SearchRequest &#123; enum Corpus &#123; UNIVERSAL = 0; WEB = 1; IMAGES = 2; LOCAL = 3; NEWS = 4; PRODUCTS = 5; VIDEO = 6; &#125; Corpus corpus = 1; ...&#125; ç¼–è¯‘å™¨å°†ä¼šç”Ÿæˆä¸€ä¸ªæšä¸¾ç±»å‹å’Œä¸€ç³»åˆ—è¯¥ç±»å‹çš„å¸¸é‡ã€‚ .proto æ–‡ä»¶ç¼–è¯‘ä»£ç  é€šè¿‡å®šä¹‰å¥½çš„ .proto æ–‡ä»¶ç”Ÿæˆ Goã€PHPã€Javaã€Pythonç­‰ä»£ç ï¼Œéœ€è¦å®‰è£…ç¼–è¯‘å™¨ protocã€‚ ä½¿ç”¨ protobuf ç¼–è¯‘å™¨ä¸åŒçš„è¯­è¨€ç”Ÿæˆçš„ä»£ç æ ¼å¼ä¸åŒï¼Œæ¯”å¦‚Goï¼šç”Ÿæˆä¸€ä¸ª .pb.go æ–‡ä»¶ï¼Œæ¯ä¸ªæ¶ˆæ¯ç±»å‹å¯¹åº”ä¸€ä¸ªç»“æ„ä½“ã€‚ å…·ä½“protocå®‰è£…å’Œä»£ç ç”Ÿæˆå¯è§ï¼šgRPCåˆä½“éªŒ ä¹Ÿæœ‰çœ‹åˆ°éƒ¨åˆ†é¡¹ç›®ä½¿ç”¨protobufå»æ›¿ä»£jsonå»è¿›è¡Œå‰åç«¯æ•°æ®äº¤æ¢ã€‚ å‚è€ƒï¼š Protobuf è¯­æ³• Protobufè¯­è¨€æŒ‡å— Protobufç”ŸæˆGoä»£ç æŒ‡å—","tags":["Protobuf"],"categories":["go"]},{"title":"golangçš„å•å¼•å·åŒå¼•å·åå¼•å·","path":"/2021/04/29/335/","content":"å•å¼•å·Single quoteï¼Œè¡¨ç¤ºbyteç±»å‹æˆ–runeç±»å‹ï¼Œå¯¹åº” uint8å’Œint32ç±»å‹ï¼Œé»˜è®¤æ˜¯ rune ç±»å‹ã€‚byteç”¨æ¥å¼ºè°ƒæ•°æ®æ˜¯raw dataï¼Œè€Œä¸æ˜¯æ•°å­—ï¼›è€Œruneç”¨æ¥è¡¨ç¤ºUnicodeçš„code pointã€‚ åŒå¼•å·Double quoteï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šæ˜¯å­—ç¬¦æ•°ç»„ã€‚å¯ä»¥ç”¨ç´¢å¼•å·è®¿é—®æŸå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥ç”¨len()å‡½æ•°æ¥è·å–å­—ç¬¦ä¸²æ‰€å çš„å­—èŠ‚é•¿åº¦ã€‚ åå¼•å·Back quoteï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œä¸åŒå¼•å·ä¸åŒï¼Œå®ƒä¸æ”¯æŒä»»ä½•è½¬ä¹‰åºåˆ—ï¼Œä½†æ”¯æŒæ¢è¡Œä¹¦å†™ã€‚å­—é¢é‡ raw literal string çš„æ„æ€æ˜¯ï¼Œä½ å®šä¹‰æ—¶å†™çš„å•¥æ ·ï¼Œå®ƒå°±å•¥æ ·ï¼Œä½ æœ‰æ¢è¡Œï¼Œå®ƒå°±æ¢è¡Œã€‚ä½ å†™è½¬ä¹‰å­—ç¬¦ï¼Œå®ƒä¹Ÿå°±å±•ç¤ºè½¬ä¹‰å­—ç¬¦ã€‚ a := &#x27;a&#x27;b := &quot;b aa&quot;c := `c3ww`var d byte = &#x27;d&#x27;fmt.Println(b)fmt.Println(c)fmt.Printf(&quot;Single quote type:%T &quot;, a)fmt.Printf(&quot;Double quote type:%T &quot;, b)fmt.Printf(&quot;Back quote type:%T &quot;, c)fmt.Printf(&quot;Single quote type:%T &quot;, d)output:------baac 3wwSingle quote type:int32Double quote type:stringBack quote type:stringSingle quote type:uint8","tags":["go"],"categories":["go"]},{"title":"MACå®‰è£…rabbitmqæ‰©å±•","path":"/2021/04/29/333/","content":"PHPç»“åˆrabbitMQéœ€è¦å®‰è£…amqpæ‰©å±•ï¼Œä¹‹å‰åˆåœ¨windowså®‰è£…ï¼Œä»Šå¤©å°è¯•macå®‰è£…ä¸€ä¸‹ã€‚ ä¸‹è½½ å‰å»amqpï¼Œä¸‹è½½éœ€è¦çš„ç‰ˆæœ¬ã€‚ å®‰è£… phpize// --with-php-config è·¯å¾„è‡ªå·±ä¿®æ”¹./configure --with-php-config=xxx/php-configmake &amp;&amp; make install å¦‚æœæ²¡è£…rabbitmq-cï¼Œåº”è¯¥ä¼šæŠ¥é”™ã€‚ configure: error: Please reinstall the librabbitmq distribution itself or (re)install librabbitmq development package if it available in your system ä¸‹è½½rabbitmq-c cd rabbitmq-c-0.8.0./configure --prefix=/usr/local/rabbitmq-cmake &amp;&amp; make install é‡æ–°ç¼–è¯‘amqp ./configure --with-php-config=xxx/php-config --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-c/make &amp;&amp; make install makeæ—¶æç¤ºç¼ºå°‘amqp_ssl_socket.hfatal error: â€˜amqp_ssl_socket.hâ€™ file not found#include &lt;amqp_ssl_socket.h&gt; è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹ https://github.com/alanxz/rabbitmq-c/issues/463 ç„¶åå¯ä»¥æŠŠrabbitmq-cçš„librabbitmqä¸‹amqp_ssl_socket.hæ–‡ä»¶copyåˆ°amqpæ‰©å±•ç›®å½•ï¼Œé‡æ–°ç¼–è¯‘å³å¯ã€‚ å®‰è£…æˆåŠŸè®°å¾—åœ¨iniåŠ å…¥extension=â€amqp.soâ€ï¼Œæœ€åå¯ä»¥ä½¿ç”¨php -m","tags":["PHP"],"categories":["PHP"]},{"title":"Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„","path":"/2021/03/23/source/","content":"Rediså¯¹è±¡åº•å±‚æ•°æ®ç»“æ„ ç¼–ç å¸¸é‡ ç¼–ç æ‰€å¯¹åº”çš„åº•å±‚æ•°æ®ç»“æ„ REDIS_ENCODING_INT long ç±»å‹çš„æ•´æ•° REDIS_ENCODING_EMBSTR embstr ç¼–ç çš„ç®€å•åŠ¨æ€å­—ç¬¦ä¸² REDIS_ENCODING_RAW ç®€å•åŠ¨æ€å­—ç¬¦ä¸² REDIS_ENCODING_HT å­—å…¸ REDIS_ENCODING_LINKEDLIST åŒç«¯é“¾è¡¨ REDIS_ENCODING_ZIPLIST å‹ç¼©åˆ—è¡¨ REDIS_ENCODING_INTSET æ•´æ•°é›†åˆ REDIS_ENCODING_SKIPLIST è·³è·ƒè¡¨ Redis stringç±»å‹è½¬æ¢â€ƒæˆ‘ä»¬å¯èƒ½ä»¥ä¸ºRedisåœ¨å†…éƒ¨å­˜å‚¨stringéƒ½æ˜¯ç”¨sdsçš„æ•°æ®ç»“æ„å®ç°çš„ï¼Œå…¶å®åœ¨æ•´ä¸ªRedisçš„æ•°æ®å­˜å‚¨è¿‡ç¨‹ä¸­ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ã€‚æ•´ä½“é€‰æ‹©é¡ºåºåº”è¯¥æ˜¯ï¼š æ•´æ•°ï¼Œå­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦å°äº21ä¸”èƒ½å¤Ÿè½¬åŒ–ä¸ºæ•´æ•°çš„å­—ç¬¦ä¸²ã€‚ EmbeddedStringï¼Œå­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦å°äº39çš„å­—ç¬¦ä¸²ï¼ˆREDIS_ENCODING_EMBSTR_SIZE_LIMITï¼‰ã€‚ SDSï¼Œå‰©ä½™æƒ…å†µä½¿ç”¨sdsè¿›è¡Œå­˜å‚¨ã€‚ embstrå’Œsdsçš„åŒºåˆ«åœ¨äºå†…å­˜çš„ç”³è¯·å’Œå›æ”¶ embstrçš„åˆ›å»ºåªéœ€åˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œè€Œrawä¸ºä¸¤æ¬¡ï¼ˆä¸€æ¬¡ä¸ºsdsåˆ†é…å¯¹è±¡ï¼Œå¦ä¸€æ¬¡ä¸ºRedisObjectåˆ†é…å¯¹è±¡ï¼Œembstrçœå»äº†ç¬¬ä¸€æ¬¡ï¼‰ã€‚ç›¸å¯¹åœ°ï¼Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°ä¹Ÿç”±ä¸¤æ¬¡å˜ä¸ºä¸€æ¬¡ã€‚ embstrçš„RedisObjectå’Œsdsæ”¾åœ¨ä¸€èµ·ï¼Œæ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜å¸¦æ¥çš„ä¼˜åŠ¿ ç¼ºç‚¹ï¼šRediså¹¶æœªæä¾›ä»»ä½•ä¿®æ”¹embstrçš„æ–¹å¼ï¼Œå³embstræ˜¯åªè¯»çš„å½¢å¼ã€‚å¯¹embstrçš„ä¿®æ”¹å®é™…ä¸Šæ˜¯å…ˆè½¬æ¢ä¸ºrawå†è¿›è¡Œä¿®æ”¹ã€‚ Redis listæ•°æ®ç»“æ„â€ƒRedis listæ•°æ®ç»“æ„åº•å±‚é‡‡ç”¨å‹ç¼©åˆ—è¡¨ziplistæˆ–linkedlistä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆä»¥ziplistè¿›è¡Œå­˜å‚¨ï¼Œåœ¨ä¸æ»¡è¶³ziplistçš„å­˜å‚¨è¦æ±‚åè½¬æ¢ä¸ºlinkedliståˆ—è¡¨ã€‚ å½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ziplistè¿›è¡Œå­˜å‚¨ï¼Œå¦åˆ™ç”¨linkedlistå­˜å‚¨ã€‚ åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚ Redis hashåº•å±‚å­˜å‚¨ç»“æ„Redisçš„å“ˆå¸Œå¯¹è±¡çš„åº•å±‚å­˜å‚¨å¯ä»¥ä½¿ç”¨ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰å’Œhashtableã€‚å½“hashå¯¹è±¡å¯ä»¥åŒæ—¶æ»¡è¶³ä¸€ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œå“ˆå¸Œå¯¹è±¡ä½¿ç”¨ziplistç¼–ç ã€‚ å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼çš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚ å“ˆå¸Œå¯¹è±¡ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å°äº512ä¸ª Redisçš„hashæ¶æ„å°±æ˜¯æ ‡å‡†çš„hashtabçš„ç»“æ„ï¼Œé€šè¿‡æŒ‚é“¾è§£å†³å†²çªé—®é¢˜ã€‚ Redis setåº•å±‚å­˜å‚¨Redisçš„é›†åˆå¯¹è±¡setçš„åº•å±‚å­˜å‚¨ç»“æ„ç‰¹åˆ«ç¥å¥‡ï¼Œåº•å±‚ä½¿ç”¨äº†intsetå’Œhashtableä¸¤ç§æ•°æ®ç»“æ„å­˜å‚¨çš„ï¼Œintsetæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ•°ç»„ï¼Œhashtableå°±æ˜¯æ™®é€šçš„å“ˆå¸Œè¡¨ï¼ˆkeyä¸ºsetçš„å€¼ï¼Œvalueä¸ºnullï¼‰ã€‚æ˜¯ä¸æ˜¯è§‰å¾—ç”¨hashtableå­˜å‚¨setæ˜¯ä¸€ä»¶å¾ˆç¥å¥‡çš„äº‹æƒ…ã€‚ setçš„åº•å±‚å­˜å‚¨intsetå’Œhashtableæ˜¯å­˜åœ¨ç¼–ç è½¬æ¢çš„ï¼Œä½¿ç”¨intsetå­˜å‚¨å¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨hashtableï¼Œæ¡ä»¶å¦‚ä¸‹ï¼š ç»“åˆå¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼ é›†åˆå¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡ä¸è¶…è¿‡512ä¸ª zsetåº•å±‚å­˜å‚¨ç»“æ„â€ƒzsetåº•å±‚çš„å­˜å‚¨ç»“æ„åŒ…æ‹¬ziplistæˆ–skiplistï¼Œåœ¨åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™ä½¿ç”¨ziplistï¼Œå…¶ä»–æ—¶å€™ä½¿ç”¨skiplistï¼Œä¸¤ä¸ªæ¡ä»¶å¦‚ä¸‹ï¼š æœ‰åºé›†åˆä¿å­˜çš„å…ƒç´ æ•°é‡å°äº128ä¸ª æœ‰åºé›†åˆä¿å­˜çš„æ‰€æœ‰å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ å½“ziplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„æ—¶å€™ï¼Œæ¯ä¸ªé›†åˆå…ƒç´ ä½¿ç”¨ä¸¤ä¸ªç´§æŒ¨åœ¨ä¸€èµ·çš„å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹æ¥ä¿å­˜ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜å…ƒç´ çš„æˆå‘˜ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¿å­˜å…ƒç´ çš„åˆ†å€¼ã€‚ å½“skiplistä½œä¸ºzsetçš„åº•å±‚å­˜å‚¨ç»“æ„çš„æ—¶å€™ï¼Œä½¿ç”¨skiplistæŒ‰åºä¿å­˜å…ƒç´ åŠåˆ†å€¼ï¼Œä½¿ç”¨dictæ¥ä¿å­˜å…ƒç´ å’Œåˆ†å€¼çš„æ˜ å°„å…³ç³»ã€‚ Redis stringåº•å±‚æ•°æ®ç»“æ„ Redis liståº•å±‚æ•°æ®ç»“æ„ Redis hashåº•å±‚æ•°æ®ç»“æ„ Redis setåº•å±‚æ•°æ®ç»“æ„ Redis zsetåº•å±‚æ•°æ®ç»“æ„ Redisä¸ºä½•è¦å®šä¹‰å­—ç¬¦ä¸²ä¸ºSDSRedisæ˜¯åº•å±‚ä½¿ç”¨çš„æ˜¯Cè¯­è¨€ï¼Œåœ¨Cè¯­è¨€ä¸­æ²¡æœ‰å­—ç¬¦ä¸²è¿™ç§æ•°æ®ç±»å‹ï¼Œå­—ç¬¦ä¸²å¤§éƒ½æ˜¯é€šè¿‡å­—ç¬¦æ•°ç»„å®ç°çš„ï¼Œä½†æ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„æœ‰ä»¥ä¸‹ä¸è¶³ï¼š å­—ç¬¦æ•°ç»„çš„é•¿åº¦éƒ½æ˜¯å›ºå®šï¼Œå®¹æ˜“å‘ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸ è·å–å­—ç¬¦æ•°ç»„çš„é•¿åº¦çš„æ—¶å€™éœ€è¦éå†æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦é«˜ å­—ç¬¦æ•°ç»„é•¿åº¦å‘ç”Ÿæ”¹å˜ä¹‹åéœ€è¦é‡æ–°åˆ†é…å†…å­˜ ä½¿ç”¨\\0è¡¨ç¤ºç»“å°¾ï¼Œåœ¨å­˜å‚¨äºŒè¿›åˆ¶ä¼šå‡ºç°é—®é¢˜ã€‚ //åŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ•°ç»„çš„é•¿åº¦æ˜¯å¯å˜çš„ã€‚struct sdshdr &#123; unsigned int len;//è®°å½•å½“å‰ä¸²çš„é•¿åº¦ã€‚ unsigned int free;//è®°å½•å‰©ä½™çš„æœ‰æ•ˆé•¿åº¦ã€‚ char buf[];//çœŸæ­£çš„å­—ç¬¦ä¸²ä½ç½®ã€‚&#125;; Rediså°±è‡ªå·±å®ç°äº†SDSæ¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼ŒSDSç›¸å¯¹Cå­—ç¬¦ä¸²æ•°ç»„çš„ä¼˜ç‚¹ï¼š é•¿åº¦è¾¾åˆ°ä¸€å®šæ ‡å‡†ä¼šæœ‰ç›¸åº”çš„æ‰©å®¹ï¼ˆå°äº1Mï¼Œfreeå¢åŠ lenï¼Œå¤§äº1Mï¼Œæ¯æ¬¡å¢åŠ 1Mï¼‰ï¼Œä»è€Œè§£å†³å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚ åœ¨SDSçš„å†…éƒ¨å®šä¹‰äº†å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥è·å–ï¼Œå¤æ‚åº¦O(1)ï¼Œè§£å†³è·å–é•¿åº¦æ—¶é—´å¤æ‚åº¦é«˜çš„é—®é¢˜ã€‚ SDSæ˜¯ç©ºé—´é¢„åˆ†é…ï¼Œæƒ°æ€§é‡Šæ”¾å†…å­˜çš„ï¼Œä»è€Œå‡å°‘åˆ†é…å†…å­˜çš„æ¬¡æ•° SDSæ ¹æ®é•¿åº¦åˆ¤æ–­ç»“æŸçš„ä½ç½®ï¼Œä»è€Œè§£å†³äºŒè¿›åˆ¶ä¸å®‰å…¨çš„é—®é¢˜ã€‚","tags":["Redis"],"categories":["Redis"]},{"title":"goroutine","path":"/2021/03/19/323/","content":"From: å¼„æ‡‚goroutineè°ƒåº¦åŸç† çº¿ç¨‹å®ç°æ¨¡å‹ goroutineç®€ä»‹ golangè¯­è¨€ä½œè€…Rob Pikeè¯´ï¼Œâ€œGoroutineæ˜¯ä¸€ä¸ªä¸å…¶ä»–goroutines å¹¶å‘è¿è¡Œåœ¨åŒä¸€åœ°å€ç©ºé—´çš„Goå‡½æ•°æˆ–æ–¹æ³•ã€‚ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºç”±ä¸€ä¸ªæˆ–æ›´å¤šä¸ªgoroutineç»„æˆã€‚å®ƒä¸çº¿ç¨‹ã€åç¨‹ã€è¿›ç¨‹ç­‰ä¸åŒã€‚å®ƒæ˜¯ä¸€ä¸ªgoroutineâ€œã€‚ goroutineé€šè¿‡é€šé“æ¥é€šä¿¡ï¼Œè€Œåç¨‹é€šè¿‡è®©å‡ºå’Œæ¢å¤æ“ä½œæ¥é€šä¿¡ï¼› goroutine é€šè¿‡Golang çš„è°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦ï¼Œè€Œåç¨‹é€šè¿‡ç¨‹åºæœ¬èº«è°ƒåº¦ï¼› ç®€å•çš„è¯´å°±æ˜¯Golangè‡ªå·±å®ç°äº†åç¨‹å¹¶å«åšgoruntineï¼ˆæœ¬æ–‡ç§°Goåç¨‹ï¼‰ï¼Œä¸”æ¯”åç¨‹æ›´å¼ºå¤§ã€‚ goroutineè°ƒåº¦åŸç†ä¸Šé¢è¯´åˆ°Goåç¨‹æ˜¯é€šè¿‡Golangçš„è°ƒåº¦å™¨è¿›è¡Œè°ƒåº¦çš„ï¼Œå…¶ä¸­è°ƒåº¦å™¨çš„çº¿ç¨‹æ¨¡å‹ä¸ºä¸¤çº§çº¿ç¨‹æ¨¡å‹ã€‚ æœ‰å…³ä¸¤çº§çº¿ç¨‹æ¨¡å‹çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹æ–‡ç« æœ€åã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹Golangå®ç°çš„ä¸¤çº§çº¿ç¨‹æ¨¡å‹æ˜¯æ€æ ·çš„ã€‚é¦–å…ˆè¦çŸ¥é“è¿™ä¸‰ä¸ªå­—æ¯ä»£è¡¨çš„å«ä¹‰ Mï¼šä»£è¡¨å†…æ ¸çº§çš„çº¿ç¨‹ Pï¼šå…¨ç¨‹Processorï¼Œä»£è¡¨è¿è¡ŒGoåç¨‹æ‰€éœ€è¦çš„èµ„æºï¼ˆä¸Šä¸‹æ–‡ç¯å¢ƒï¼‰ Gï¼šä»£è¡¨Goåç¨‹æˆ‘ä»¬å…ˆçœ‹ä¸‹ä¸ºå®ç°è°ƒåº¦Golangå®šä¹‰äº†è¿™äº›æ•°æ®ç»“æ„å­˜Mï¼ŒPï¼ŒG åç§° ä½œç”¨èŒƒå›´ æè¿° å…¨å±€Måˆ—è¡¨ Goçš„è¿è¡Œæ—¶ å­˜æ”¾æ‰€æœ‰Mçš„å•å‘é“¾è¡¨ å…¨å±€Påˆ—è¡¨ Goçš„è¿è¡Œæ—¶ å­˜æ”¾æ‰€æœ‰Pçš„æ•°ç»„ å…¨å±€Gåˆ—è¡¨ Goçš„è¿è¡Œæ—¶ å­˜æ”¾æ‰€æœ‰Gçš„åˆ‡ç‰‡ è°ƒåº¦å™¨çš„ç©ºé—²Måˆ—è¡¨ è°ƒåº¦å™¨ å­˜æ”¾ç©ºé—²Mçš„å•å‘é“¾è¡¨ è°ƒåº¦å™¨çš„ç©ºé—²Påˆ—è¡¨ è°ƒåº¦å™¨ å­˜æ”¾ç©ºé—²Pçš„å•å‘é“¾è¡¨ è°ƒåº¦å™¨çš„è‡ªç”±Gåˆ—è¡¨ è°ƒåº¦å™¨ å­˜æ”¾è‡ªç”±Gçš„å•å‘é“¾è¡¨ï¼ˆæœ‰ä¸¤ä¸ªï¼‰ è°ƒåº¦å™¨çš„å¯è¿è¡ŒGé˜Ÿåˆ— è°ƒåº¦å™¨ å­˜æ”¾å¯è¿è¡ŒGçš„é˜Ÿåˆ— Pçš„è‡ªç”±Gåˆ—è¡¨ æœ¬åœ°P å­˜æ”¾å½“å‰Pä¸­è‡ªç”±Gçš„å•å‘é“¾è¡¨ Pçš„å¯è¿è¡ŒGé˜Ÿåˆ— æœ¬åœ°P å­˜æ”¾å½“å‰Pä¸­å¯è¿è¡ŒGçš„é˜Ÿåˆ— ç„¶åä»ä¸Šå¾€ä¸‹è§£æGoçš„ä¸¤çº§çº¿ç¨‹æ¨¡å‹å›¾ Må’Œå†…æ ¸çº¿ç¨‹ä¹‹é—´æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¸€ä¸ªMåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œåªä¼šå’Œä¸€ä¸ªå†…æ ¸çº¿ç¨‹å…³è”ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¯¹å†…æ ¸çº¿ç¨‹çš„é¢‘ç¹åˆ‡æ¢ï¼› Golangçš„è¿è¡Œæ—¶æ‰§è¡Œç³»ç»Ÿç›‘æ§å’Œåƒåœ¾å›æ”¶ç­‰ä»»åŠ¡æ—¶å€™ä¼šå¯¼è‡´åˆ›å»ºMï¼ŒMç©ºé—²æ—¶ä¸ä¼šè¢«é”€æ¯ï¼Œè€Œæ˜¯æ”¾åˆ°ä¸€ä¸ªè°ƒåº¦å™¨çš„ç©ºé—²Måˆ—è¡¨ä¸­ï¼Œç­‰å¾…ä¸På…³è”ï¼ŒMé»˜è®¤æ•°é‡ä¸º10000 På’ŒMä¹‹é—´æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼ŒPå’ŒGä¹‹é—´æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä»–ä»¬çš„å…³è”æ˜¯æ˜“å˜çš„ï¼Œç”±Golangçš„è°ƒåº¦å™¨å®Œæˆè°ƒåº¦ï¼› Golangçš„è¿è¡Œæ—¶æŒ‰è§„åˆ™è°ƒåº¦ï¼Œè®©På’Œä¸åŒçš„Må»ºç«‹æˆ–æ–­å¼€å…³è”ï¼Œä½¿å¾—Pä¸­çš„Gèƒ½å¤ŸåŠæ—¶è·å¾—è¿è¡Œæ—¶æœº Pçš„æ•°é‡é»˜è®¤ä¸ºCPUæ€»æ ¸å¿ƒæ•°ï¼Œæœ€å¤§ä¸º256ï¼Œå½“Pæ²¡æœ‰å¯è¿è¡Œçš„Gæ—¶å€™ï¼ˆPçš„å¯è¿è¡ŒGé˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼ŒPä¼šè¢«æ”¾åˆ°è°ƒåº¦å™¨çš„ç©ºé—²Påˆ—è¡¨ä¸­ï¼Œç­‰å¾…Mä¸å®ƒå…³è”ï¼› Pæœ‰å¯èƒ½ä¼šè¢«é”€æ¯ï¼Œå¦‚è¿è¡Œæ—¶ç”¨runtime.GOMAXPROCSæŠŠPçš„æ•°é‡ä»32é™åˆ°16æ—¶ï¼Œå‰©ä½™16ä¸ªä¼šè¢«é”€æ¯ï¼Œå®ƒä»¬åŸæ¥çš„Gä¼šå…ˆè½¬åˆ°è°ƒåº¦å™¨å¯è¿è¡Œçš„Gé˜Ÿåˆ—å’Œè‡ªç”±Gåˆ—è¡¨ æ¯ä¸ªPä¸­æœ‰å¯è¿è¡Œçš„Gé˜Ÿåˆ—ï¼ˆå¦‚å›¾ä¸­æœ€ä¸‹é¢çš„é‚£è¡ŒGï¼‰å’Œè‡ªç”±Gåˆ—è¡¨ï¼ˆå›¾ä¸­æœªç”»å‡ºæ¥ï¼‰ï¼Œå½“Gçš„ä»£ç æ‰§è¡Œå®Œåï¼Œè¯¥Gä¸ä¼šè¢«é”€æ¯ï¼Œè€Œæ˜¯è¢«æ”¾åˆ°Pçš„è‡ªç”±Gåˆ—è¡¨æˆ–è°ƒåº¦å™¨çš„è‡ªç”±Gåˆ—è¡¨ã€‚å¦‚æœç¨‹åºæ–°å»ºäº†Goåç¨‹ï¼Œè°ƒåº¦å™¨ä¼šåœ¨è‡ªç”±Gåˆ—è¡¨ä¸­å–ä¸€ä¸ªGï¼Œç„¶åæŠŠGoåç¨‹çš„å‡½æ•°èµ‹å€¼åˆ°Gä¸­ï¼ˆå¦‚æœè‡ªç”±Gåˆ—è¡¨ä¸ºç©ºï¼Œå°±åˆ›å»ºä¸€ä¸ªGï¼‰ï¼› å¯è§Golangè°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶å¾ˆå¤§ç¨‹åº¦å¤ç”¨äº†Mï¼ŒPï¼ŒG åœ¨Goç¨‹åºåˆå§‹åŒ–åï¼Œè°ƒåº¦å™¨é¦–å…ˆè¿›è¡Œä¸€è½®è°ƒåº¦ï¼Œæ­¤æ—¶ç”¨Må»æœç´¢å¯è¿è¡Œçš„Gã€‚å…¶ä¸­æˆ‘ä»¬çš„mainå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªGï¼Œæ‰¾åˆ°å¯è¿è¡Œçš„Gåå°±æ‰§è¡Œå®ƒï¼› è‡³äºæ€ä¹ˆæ‰¾å¯è¿è¡Œçš„Gå‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ°å¤„æ‰¾ï¼Œæƒ³å°½åŠæ³•æ‰¾ï¼ˆè¿™é‡Œåªåˆ—å‡ºä¸€éƒ¨åˆ†åœ°æ–¹ï¼‰ã€‚ ä»æœ¬åœ°Pçš„å¯è¿è¡Œçš„Gé˜Ÿåˆ—æ‰¾ ä»è°ƒåº¦å™¨çš„å¯è¿è¡Œçš„Gé˜Ÿåˆ—æ‰¾ ä»å…¶ä»–Pçš„å¯è¿è¡Œçš„Gé˜Ÿåˆ—æ‰¾ Pçš„å¯è¿è¡ŒGé˜Ÿåˆ—æœ€å¤§åªèƒ½å­˜æ”¾é•¿åº¦ä¸º256çš„Gï¼Œå½“é˜Ÿåˆ—æ»¡åï¼Œè°ƒåº¦å™¨ä¼šæŠŠä¸€åŠçš„Gè½¬åˆ°è°ƒåº¦å™¨çš„å¯è¿è¡ŒGé˜Ÿåˆ—ã€‚ ç³»ç»Ÿç›‘æ§ä¸Šé¢å¤§æ¦‚æè¿°äº†å…³äºgoroutineè°ƒåº¦çš„æµç¨‹ã€‚ç°åœ¨è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å½“Goåç¨‹å¾ˆå¤šï¼ˆå¹¶å‘é‡å¤§ï¼‰æ—¶å€™ï¼Œæ˜¾ç„¶Gæ˜¯ä¸èƒ½ä¸€ç›´æ‰§è¡Œä¸‹å»çš„ï¼Œå› ä¸ºä¹Ÿéœ€è¦æŠŠæ‰§è¡Œæœºä¼šç•™ç»™å…¶ä»–çš„Gã€‚æ­¤æ—¶Golangè¿è¡Œæ—¶çš„ç³»ç»Ÿç›‘æ§å°±èµ·ä½œç”¨äº†ã€‚ä¸€èˆ¬æƒ…å†µï¼Œå½“Gè¿è¡Œæ—¶é—´è¶…è¿‡10msåï¼Œè¯¥Gå°±ä¼šè¢«ç³»ç»Ÿå‘ŠçŸ¥éœ€è¦åœæ­¢äº†ï¼Œè®©å…¶ä»–Gè¿è¡Œã€‚ï¼ˆè¿™é‡Œæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸èƒ½ç¡®ä¿æ¯ä¸ªGéƒ½èƒ½è¢«å…¬å¹³æ‰§è¡Œï¼‰ ä»¥ä¸‹ç‰¹æ®Šæƒ…å†µè¯¥Gä¸éœ€è¦åœæ­¢ Pçš„å¯è¿è¡ŒGé˜Ÿåˆ—ä¸ºç©ºï¼ˆæ²¡æœ‰å…¶ä»–Gå¯è¿è¡Œï¼‰ æœ‰ç©ºé—²çš„Måœ¨å¯»æ‰¾å¯è¿è¡Œçš„Gï¼ˆæ²¡æœ‰å…¶ä»–Gå¯è¿è¡Œï¼‰ ç©ºé—²çš„Pï¼ˆè¿˜æœ‰Pé—²ç€ï¼‰ æ€»ç»“Golangä»¥ä¸¤çº§çº¿ç¨‹å®ç°æ¨¡å‹ï¼Œè‡ªå·±å®ç°goruntineå’Œè°ƒåº¦å™¨ï¼Œä¼˜åŠ¿åœ¨äºå¹¶è¡Œå’Œéå¸¸ä½çš„èµ„æºä½¿ç”¨ã€‚ ä¸»è¦ä½“ç° å†…å­˜æ¶ˆè€—æ–¹é¢ï¼ˆæ¯ä¸ªGoåç¨‹å çš„å†…å­˜è¿œå°äºçº¿ç¨‹å çš„å†…å­˜ï¼‰ åˆ‡æ¢(è°ƒåº¦)å¼€é”€æ–¹é¢ çº¿ç¨‹åˆ‡æ¢æ¶‰åŠæ¨¡å¼åˆ‡æ¢(ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€) æ­¤å¤–ï¼ŒGoåç¨‹æ‰§è¡Œä»»åŠ¡å®Œæˆçš„é¡ºåºå¹¶ä¸éƒ½æ˜¯æŒ‰æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·ï¼ˆç¨‹åºä¸åŠ ä»¥æ§åˆ¶çš„æƒ…å†µä¸‹ï¼‰ï¼Œç‰¹åˆ«åœ¨ä¸€äº›è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ä¸­ã€‚ä¸”æ¯ä¸ªGoåç¨‹æ‰§è¡Œçš„æ—¶é—´ä¹Ÿä¸æ˜¯ç»å¯¹å…¬å¹³çš„ã€‚ çº¿ç¨‹å®ç°æ¨¡å‹çº¿ç¨‹å®ç°æ¨¡å‹ä¸»è¦åˆ†ä¸ºï¼šç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹ï¼Œå†…æ ¸çº§çº¿ç¨‹æ¨¡å‹å’Œä¸¤çº§çº¿ç¨‹æ¨¡å‹ã€‚ä»–ä»¬çš„åŒºåˆ«åœ¨äºçº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ ä»¥ä¸‹æˆ‘ä»¬å°†åˆ†æè¿™ä¸‰ç§çº¿ç¨‹å®ç°æ¨¡å‹çš„ç‰¹ç‚¹ï¼š ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹ å¤šå¯¹ä¸€å…³ç³»ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹ä¸ºå¤šå¯¹ä¸€å…³ç³»ã€‚å³ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼› å¤„ç†é€Ÿåº¦å¿«ã€ç§»æ¤æ€§å¼ºï¼›çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦ã€åŒæ­¥ç­‰æ“ä½œç”±åº”ç”¨ç¨‹åºæ¥å¤„ç†ï¼Œä¸éœ€è¦è®©CPUä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚æ‰€ä»¥ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹åœ¨é€Ÿåº¦å¿«ï¼Œä¸”ç§»æ¤æ€§å¼ºï¼› å¹¶éçœŸæ­£çš„å¹¶å‘è¿è¡Œå¦‚æœçº¿ç¨‹IOæ“ä½œè¿‡ç¨‹ä¸­è¢«é˜»å¡ï¼Œé‚£ä¹ˆç”¨æˆ·ç©ºé—´çš„å…¶ä»–çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œå› ä¸ºè¿™äº›çº¿ç¨‹æ— æ³•è¢«å†…æ ¸è°ƒåº¦ã€‚ å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ï¼ˆ1ï¼‰ä¸€å¯¹ä¸€å…³ç³»å†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ä¸ºä¸€å¯¹ä¸€å…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼›ï¼ˆ2ï¼‰èµ„æºæ¶ˆè€—è¾ƒå¤§ï¼Œé€Ÿåº¦è¾ƒæ…¢è¿›ç¨‹å¯¹çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€åˆ‡æ¢å’ŒåŒæ­¥éƒ½å¿…é¡»é€šè¿‡å†…æ ¸æä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆï¼Œå¯¹å†…æ ¸çš„è°ƒåº¦çš„è°ƒåº¦å™¨é€ æˆå¾ˆå¤§çš„è´Ÿæ‹…ï¼›ï¼ˆ3ï¼‰æ˜¯çœŸæ­£çš„å¹¶å‘è¿è¡Œç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œçº¿ç¨‹ç”±å†…æ ¸æ¥ç®¡ç†å’Œè°ƒåº¦ã€‚å½“æŸä¸€çº¿ç¨‹é˜»å¡æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚ ä¸¤çº§çº¿ç¨‹æ¨¡å‹ å¤šå¯¹å¤šçš„å…³ç³»ä¸¤çº§çº¿ç¨‹æ¨¡å‹æ˜¯é›†å‰é¢ä¸¤ç§æ¨¡å‹çš„ä¼˜ç‚¹è€Œè®¾è®¡çš„ï¼Œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼› èµ„æºæ¶ˆè€—è¾ƒå°ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œæ˜¯çœŸæ­£çš„å¹¶å‘è¿è¡Œä¸¤çº§çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å¯¹åº”å¤šä¸ªå†…æ ¸çº¿ç¨‹ï¼Œè¿›ç¨‹ä¸­çš„çº¿ç¨‹ç”±ç¨‹åºç®¡ç†å’Œè°ƒåº¦å¹¶é€šè¿‡æ˜ å°„å…³ç³»æ˜ å°„åˆ°å†…æ ¸çº¿ç¨‹ä¸Šã€‚è¿™æ ·å³ä¾¿æœ‰çº¿ç¨‹é˜»å¡åï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ï¼› å®ç°çš„å¤æ‚åº¦å¤§ç”¨æˆ·çº¿ç¨‹ä¸å†…æ ¸çº¿ç¨‹çš„æ˜ å°„å…³ç³»éœ€è¦ç¨‹åºæ¥å®ç°ï¼Œå®ç°çš„å¤æ‚åº¦å¤§ã€‚å¹¸è¿çš„æ˜¯ï¼ŒGolangä¸ºæˆ‘ä»¬å®ç°äº†ä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼Œè¿™ä½¿å¾—å®ƒåœ¨å¤„ç†å¹¶å‘é—®é¢˜ä¸Šæ›´æœ‰ä¼˜åŠ¿ã€‚","tags":["go"],"categories":["go"]},{"title":"Redisçš„è¿‡æœŸç­–ç•¥ä»¥åŠå†…å­˜æ·˜æ±°æœºåˆ¶","path":"/2021/03/14/volatile/","content":"Redisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ç­–ç•¥ã€‚ ä¸ºä»€ä¹ˆä¸ç”¨å®šæ—¶åˆ é™¤ç­–ç•¥? å®šæ—¶åˆ é™¤,ç”¨ä¸€ä¸ªå®šæ—¶å™¨æ¥è´Ÿè´£ç›‘è§†key,è¿‡æœŸåˆ™è‡ªåŠ¨åˆ é™¤ã€‚è™½ç„¶å†…å­˜åŠæ—¶é‡Šæ”¾ï¼Œä½†æ˜¯ååˆ†æ¶ˆè€—CPUèµ„æºã€‚åœ¨å¤§å¹¶å‘è¯·æ±‚ä¸‹ï¼ŒCPUè¦å°†æ—¶é—´åº”ç”¨åœ¨å¤„ç†è¯·æ±‚ï¼Œè€Œä¸æ˜¯åˆ é™¤keyï¼Œå› æ­¤æ²¡æœ‰é‡‡ç”¨è¿™ä¸€ç­–ç•¥. å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢? å®šæœŸåˆ é™¤ï¼ŒRedisé»˜è®¤æ¯ä¸ª100msæ£€æŸ¥ï¼Œæ˜¯å¦æœ‰è¿‡æœŸçš„keyï¼Œæœ‰è¿‡æœŸkeyåˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒRedisä¸æ˜¯æ¯ä¸ª100mså°†æ‰€æœ‰çš„keyæ£€æŸ¥ä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºæŠ½å–è¿›è¡Œæ£€æŸ¥(å¦‚æœæ¯éš”100ms,å…¨éƒ¨keyè¿›è¡Œæ£€æŸ¥ï¼ŒRediså²‚ä¸æ˜¯å¡æ­»)ã€‚å› æ­¤ï¼Œå¦‚æœåªé‡‡ç”¨å®šæœŸåˆ é™¤ç­–ç•¥ï¼Œä¼šå¯¼è‡´å¾ˆå¤škeyåˆ°æ—¶é—´æ²¡æœ‰åˆ é™¤ã€‚ äºæ˜¯ï¼Œæƒ°æ€§åˆ é™¤æ´¾ä¸Šç”¨åœºã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä½ è·å–æŸä¸ªkeyçš„æ—¶å€™ï¼ŒRedisä¼šæ£€æŸ¥ä¸€ä¸‹ï¼Œè¿™ä¸ªkeyå¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´é‚£ä¹ˆæ˜¯å¦è¿‡æœŸäº†ï¼Ÿå¦‚æœè¿‡æœŸäº†æ­¤æ—¶å°±ä¼šåˆ é™¤ã€‚ é‡‡ç”¨å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤å°±æ²¡å…¶ä»–é—®é¢˜äº†ä¹ˆ? ä¸æ˜¯çš„ï¼Œå¦‚æœå®šæœŸåˆ é™¤æ²¡åˆ é™¤keyã€‚ç„¶åä½ ä¹Ÿæ²¡å³æ—¶å»è¯·æ±‚keyï¼Œä¹Ÿå°±æ˜¯è¯´æƒ°æ€§åˆ é™¤ä¹Ÿæ²¡ç”Ÿæ•ˆã€‚è¿™æ ·ï¼ŒRedisçš„å†…å­˜ä¼šè¶Šæ¥è¶Šé«˜ã€‚é‚£ä¹ˆå°±åº”è¯¥é‡‡ç”¨å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚ åœ¨Redis.confä¸­æœ‰ä¸€è¡Œé…ç½® maxmemory-policy volatile-lru è¯¥é…ç½®å°±æ˜¯é…å†…å­˜æ·˜æ±°ç­–ç•¥çš„ noevictionï¼šå½“å†…å­˜ä½¿ç”¨è¶…è¿‡é…ç½®çš„æ—¶å€™ä¼šè¿”å›é”™è¯¯ï¼Œä¸ä¼šé©±é€ä»»ä½•é”® allkeys-lruï¼šåŠ å…¥é”®çš„æ—¶å€™ï¼Œå¦‚æœè¿‡é™ï¼Œé¦–å…ˆé€šè¿‡LRUç®—æ³•é©±é€æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é”® volatile-lruï¼šåŠ å…¥é”®çš„æ—¶å€™å¦‚æœè¿‡é™ï¼Œé¦–å…ˆä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®é›†åˆä¸­é©±é€æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„é”® allkeys-randomï¼šåŠ å…¥é”®çš„æ—¶å€™å¦‚æœè¿‡é™ï¼Œä»æ‰€æœ‰keyéšæœºåˆ é™¤ volatile-randomï¼šåŠ å…¥é”®çš„æ—¶å€™å¦‚æœè¿‡é™ï¼Œä»è¿‡æœŸé”®çš„é›†åˆä¸­éšæœºé©±é€ volatile-ttlï¼šä»é…ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é©±é€é©¬ä¸Šå°±è¦è¿‡æœŸçš„é”® volatile-lfuï¼šä»æ‰€æœ‰é…ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é©±é€ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é”® allkeys-lfuï¼šä»æ‰€æœ‰é”®ä¸­é©±é€ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é”® ä¸€èˆ¬çš„ç»éªŒè§„åˆ™: ä½¿ç”¨allkeys-lruç­–ç•¥ï¼šå½“é¢„æœŸè¯·æ±‚ç¬¦åˆä¸€ä¸ªå¹‚æ¬¡åˆ†å¸ƒ(äºŒå…«æ³•åˆ™ç­‰)ï¼Œæ¯”å¦‚ä¸€éƒ¨åˆ†çš„å­é›†å…ƒç´ æ¯”å…¶å®ƒå…¶å®ƒå…ƒç´ è¢«è®¿é—®çš„æ›´å¤šæ—¶ï¼Œå¯ä»¥é€‰æ‹©è¿™ä¸ªç­–ç•¥ã€‚ ä½¿ç”¨allkeys-randomï¼šå¾ªç¯è¿ç»­çš„è®¿é—®æ‰€æœ‰çš„é”®æ—¶ï¼Œæˆ–è€…é¢„æœŸè¯·æ±‚åˆ†å¸ƒå¹³å‡ï¼ˆæ‰€æœ‰å…ƒç´ è¢«è®¿é—®çš„æ¦‚ç‡éƒ½å·®ä¸å¤šï¼‰ ä½¿ç”¨volatile-ttlï¼šè¦é‡‡å–è¿™ä¸ªç­–ç•¥ï¼Œç¼“å­˜å¯¹è±¡çš„TTLå€¼æœ€å¥½æœ‰å·®å¼‚ volatile-lru å’Œ volatile-randomç­–ç•¥ï¼Œå½“ä½ æƒ³è¦ä½¿ç”¨å•ä¸€çš„Rediså®ä¾‹æ¥åŒæ—¶å®ç°ç¼“å­˜æ·˜æ±°å’ŒæŒä¹…åŒ–ä¸€äº›ç»å¸¸ä½¿ç”¨çš„é”®é›†åˆæ—¶å¾ˆæœ‰ç”¨ã€‚æœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„é”®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜ï¼Œè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å‚ä¸ç¼“å­˜æ·˜æ±°ã€‚ä¸è¿‡ä¸€èˆ¬è¿è¡Œä¸¤ä¸ªå®ä¾‹æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ›´å¥½æ–¹æ³•ã€‚ ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯éœ€è¦æ¶ˆè€—å†…å­˜çš„ï¼Œæ‰€ä»¥ä½¿ç”¨allkeys-lruè¿™ç§ç­–ç•¥æ›´åŠ èŠ‚çœç©ºé—´ï¼Œå› ä¸ºè¿™ç§ç­–ç•¥ä¸‹å¯ä»¥ä¸ä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ LRURedisé…ç½®ä¸­å’ŒLRUæœ‰å…³çš„æœ‰ä¸‰ä¸ªï¼š maxmemory: é…ç½®Rediså­˜å‚¨æ•°æ®æ—¶æŒ‡å®šé™åˆ¶çš„å†…å­˜å¤§å°ï¼Œæ¯”å¦‚100mã€‚å½“ç¼“å­˜æ¶ˆè€—çš„å†…å­˜è¶…è¿‡è¿™ä¸ªæ•°å€¼æ—¶, å°†è§¦å‘æ•°æ®æ·˜æ±°ã€‚è¯¥æ•°æ®é…ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜çš„æ•°æ®é‡æ²¡æœ‰é™åˆ¶, å³LRUåŠŸèƒ½ä¸ç”Ÿæ•ˆã€‚64ä½çš„ç³»ç»Ÿé»˜è®¤å€¼ä¸º0ï¼Œ32ä½çš„ç³»ç»Ÿé»˜è®¤å†…å­˜é™åˆ¶ä¸º3GB maxmemory_policy: è§¦å‘æ•°æ®æ·˜æ±°åçš„æ·˜æ±°ç­–ç•¥ maxmemory_samples: éšæœºé‡‡æ ·çš„ç²¾åº¦ï¼Œä¹Ÿå°±æ˜¯éšå³å–å‡ºkeyçš„æ•°ç›®ã€‚è¯¥æ•°å€¼é…ç½®è¶Šå¤§, è¶Šæ¥è¿‘äºçœŸå®çš„LRUç®—æ³•ï¼Œä½†æ˜¯æ•°å€¼è¶Šå¤§ï¼Œç›¸åº”æ¶ˆè€—ä¹Ÿå˜é«˜ï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼Œæ ·æœ¬å€¼é»˜è®¤ä¸º5ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒLRUç®—æ³•éœ€è¦ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥è®°å½•æ•°æ®çš„æœ€è¿‘è¢«è®¿é—®é¡ºåºï¼Œä½†æ˜¯å‡ºäºèŠ‚çœå†…å­˜çš„è€ƒè™‘ï¼ŒRedisçš„LRUç®—æ³•å¹¶éå®Œæ•´çš„å®ç°ã€‚Rediså¹¶ä¸ä¼šé€‰æ‹©æœ€ä¹…æœªè¢«è®¿é—®çš„é”®è¿›è¡Œå›æ”¶ï¼Œç›¸åå®ƒä¼šå°è¯•è¿è¡Œä¸€ä¸ªè¿‘ä¼¼LRUçš„ç®—æ³•ï¼Œé€šè¿‡å¯¹å°‘é‡é”®è¿›è¡Œå–æ ·ï¼Œç„¶åå›æ”¶å…¶ä¸­çš„æœ€ä¹…æœªè¢«è®¿é—®çš„é”®ã€‚é€šè¿‡è°ƒæ•´æ¯æ¬¡å›æ”¶æ—¶çš„é‡‡æ ·æ•°é‡maxmemory-samplesï¼Œå¯ä»¥å®ç°è°ƒæ•´ç®—æ³•çš„ç²¾åº¦ã€‚ æ ¹æ®Redisä½œè€…çš„è¯´æ³•ï¼Œæ¯ä¸ªRedis Objectå¯ä»¥æŒ¤å‡º24 bitsçš„ç©ºé—´ï¼Œä½†24 bitsæ˜¯ä¸å¤Ÿå­˜å‚¨ä¸¤ä¸ªæŒ‡é’ˆçš„ï¼Œè€Œå­˜å‚¨ä¸€ä¸ªä½ä½æ—¶é—´æˆ³æ˜¯è¶³å¤Ÿçš„ï¼ŒRedis Objectä»¥ç§’ä¸ºå•ä½å­˜å‚¨äº†å¯¹è±¡æ–°å»ºæˆ–è€…æ›´æ–°æ—¶çš„unix timeï¼Œä¹Ÿå°±æ˜¯LRU clockï¼Œ24 bitsæ•°æ®è¦æº¢å‡ºçš„è¯éœ€è¦194å¤©ï¼Œè€Œç¼“å­˜çš„æ•°æ®æ›´æ–°éå¸¸é¢‘ç¹ï¼Œå·²ç»è¶³å¤Ÿäº†ã€‚ Redisçš„é”®ç©ºé—´æ˜¯æ”¾åœ¨ä¸€ä¸ªå“ˆå¸Œè¡¨ä¸­çš„ï¼Œè¦ä»æ‰€æœ‰çš„é”®ä¸­é€‰å‡ºä¸€ä¸ªæœ€ä¹…æœªè¢«è®¿é—®çš„é”®ï¼Œéœ€è¦å¦å¤–ä¸€ä¸ªæ•°æ®ç»“æ„å­˜å‚¨è¿™äº›æºä¿¡æ¯ï¼Œè¿™æ˜¾ç„¶ä¸åˆ’ç®—ã€‚æœ€åˆï¼ŒRedisåªæ˜¯éšæœºçš„é€‰3ä¸ªkeyï¼Œç„¶åä»ä¸­æ·˜æ±°ï¼Œåæ¥ç®—æ³•æ”¹è¿›åˆ°äº†Nä¸ªkeyçš„ç­–ç•¥ï¼Œé»˜è®¤æ˜¯5ä¸ªã€‚ Redis3.0ä¹‹ååˆæ”¹å–„äº†ç®—æ³•çš„æ€§èƒ½ï¼Œä¼šæä¾›ä¸€ä¸ªå¾…æ·˜æ±°å€™é€‰keyçš„poolï¼Œé‡Œé¢é»˜è®¤æœ‰16ä¸ªkeyï¼ŒæŒ‰ç…§ç©ºé—²æ—¶é—´æ’å¥½åºã€‚æ›´æ–°æ—¶ä»Redisé”®ç©ºé—´éšæœºé€‰æ‹©Nä¸ªkeyï¼Œåˆ†åˆ«è®¡ç®—å®ƒä»¬çš„ç©ºé—²æ—¶é—´idleï¼Œkeyåªä¼šåœ¨poolä¸æ»¡æˆ–è€…ç©ºé—²æ—¶é—´å¤§äºpoolé‡Œæœ€å°çš„æ—¶ï¼Œæ‰ä¼šè¿›å…¥poolï¼Œç„¶åä»poolä¸­é€‰æ‹©ç©ºé—²æ—¶é—´æœ€å¤§çš„keyæ·˜æ±°æ‰ã€‚ çœŸå®LRUç®—æ³•ä¸è¿‘ä¼¼LRUçš„ç®—æ³•å¯ä»¥é€šè¿‡ä¸‹é¢çš„å›¾åƒå¯¹æ¯”ï¼š æµ…ç°è‰²å¸¦æ˜¯å·²ç»è¢«æ·˜æ±°çš„å¯¹è±¡ï¼Œç°è‰²å¸¦æ˜¯æ²¡æœ‰è¢«æ·˜æ±°çš„å¯¹è±¡ï¼Œç»¿è‰²å¸¦æ˜¯æ–°æ·»åŠ çš„å¯¹è±¡ã€‚å¯ä»¥çœ‹å‡ºï¼Œmaxmemory-sampleså€¼ä¸º5æ—¶Redis 3.0æ•ˆæœæ¯”Redis 2.8è¦å¥½ã€‚ä½¿ç”¨10ä¸ªé‡‡æ ·å¤§å°çš„Redis 3.0çš„è¿‘ä¼¼LRUç®—æ³•å·²ç»éå¸¸æ¥è¿‘ç†è®ºçš„æ€§èƒ½äº†ã€‚ æ•°æ®è®¿é—®æ¨¡å¼éå¸¸æ¥è¿‘å¹‚æ¬¡åˆ†å¸ƒæ—¶ï¼Œä¹Ÿå°±æ˜¯å¤§éƒ¨åˆ†çš„è®¿é—®é›†ä¸­äºéƒ¨åˆ†é”®æ—¶ï¼ŒLRUè¿‘ä¼¼ç®—æ³•ä¼šå¤„ç†å¾—å¾ˆå¥½ã€‚ Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨åŸç”ŸLRUç®—æ³•ï¼Ÿ åŸç”ŸLRUç®—æ³•éœ€è¦ åŒå‘é“¾è¡¨ æ¥ç®¡ç†æ•°æ®ï¼Œéœ€è¦é¢å¤–å†…å­˜ æ•°æ®è®¿é—®æ—¶æ¶‰åŠæ•°æ®ç§»åŠ¨ï¼Œæœ‰æ€§èƒ½æŸè€— Redisç°æœ‰æ•°æ®ç»“æ„éœ€è¦æ”¹é€  LFUåœ¨LFUç®—æ³•ä¸­ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªkeyç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ã€‚æ¯æ¬¡keyè¢«è®¿é—®çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å¢å¤§ã€‚è®¡æ•°å™¨è¶Šå¤§ï¼Œå¯ä»¥çº¦ç­‰äºè®¿é—®è¶Šé¢‘ç¹ã€‚ ä¸Šè¿°ç®€å•ç®—æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š åœ¨LRUç®—æ³•ä¸­å¯ä»¥ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç„¶åç®€å•çš„æŠŠè¢«è®¿é—®çš„èŠ‚ç‚¹ç§»è‡³é“¾è¡¨å¼€å¤´ï¼Œä½†åœ¨LFUä¸­æ˜¯ä¸å¯è¡Œçš„ï¼ŒèŠ‚ç‚¹è¦ä¸¥æ ¼æŒ‰ç…§è®¡æ•°å™¨è¿›è¡Œæ’åºï¼Œæ–°å¢èŠ‚ç‚¹æˆ–è€…æ›´æ–°èŠ‚ç‚¹ä½ç½®æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦å¯èƒ½è¾¾åˆ°O(N)ã€‚ åªæ˜¯ç®€å•çš„å¢åŠ è®¡æ•°å™¨çš„æ–¹æ³•å¹¶ä¸å®Œç¾ã€‚è®¿é—®æ¨¡å¼æ˜¯ä¼šé¢‘ç¹å˜åŒ–çš„ï¼Œä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„keyä¸€æ®µæ—¶é—´ä¹‹åå¯èƒ½ä¼šå¾ˆå°‘è¢«è®¿é—®åˆ°ï¼Œåªå¢åŠ è®¡æ•°å™¨å¹¶ä¸èƒ½ä½“ç°è¿™ç§è¶‹åŠ¿ã€‚ ç¬¬ä¸€ä¸ªé—®é¢˜å¾ˆå¥½è§£å†³ï¼Œå¯ä»¥å€Ÿé‰´LRUå®ç°çš„ç»éªŒï¼Œç»´æŠ¤ä¸€ä¸ªå¾…æ·˜æ±°keyçš„poolã€‚ç¬¬äºŒä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æ˜¯ï¼Œè®°å½•keyæœ€åä¸€ä¸ªè¢«è®¿é—®çš„æ—¶é—´ï¼Œç„¶åéšç€æ—¶é—´æ¨ç§»ï¼Œé™ä½è®¡æ•°å™¨ã€‚ Rediså¯¹è±¡çš„ç»“æ„å¦‚ä¸‹ï¼š typedef struct RedisObject &#123; unsigned type:4; unsigned encoding:4; unsigned lru:LRU_BITS; /* LRU time (relative to global lru_clock) or * LFU data (least significant 8 bits frequency * and most significant 16 bits access time). */ int refcount; void *ptr;&#125; robj; åœ¨LRUç®—æ³•ä¸­ï¼Œ24 bitsçš„lruæ˜¯ç”¨æ¥è®°å½•LRU timeçš„ï¼Œåœ¨LFUä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå­—æ®µï¼Œä¸è¿‡æ˜¯åˆ†æˆ16 bitsä¸8 bitsä½¿ç”¨ï¼š 16 bits 8 bits+----------------+--------++ Last decr time | LOG_C |+----------------+--------+ é«˜16 bitsç”¨æ¥è®°å½•æœ€è¿‘ä¸€æ¬¡è®¡æ•°å™¨é™ä½çš„æ—¶é—´ldtï¼Œå•ä½æ˜¯åˆ†é’Ÿï¼Œä½8 bitsè®°å½•è®¡æ•°å™¨æ•°å€¼counterã€‚ LFUé…ç½®Redis4.0ä¹‹åä¸ºmaxmemory_policyæ·˜æ±°ç­–ç•¥æ·»åŠ äº†ä¸¤ä¸ªLFUæ¨¡å¼ï¼š volatile-lfuï¼šå¯¹æœ‰è¿‡æœŸæ—¶é—´çš„keyé‡‡ç”¨LFUæ·˜æ±°ç®—æ³• allkeys-lfuï¼šå¯¹å…¨éƒ¨keyé‡‡ç”¨LFUæ·˜æ±°ç®—æ³• è¿˜æœ‰2ä¸ªé…ç½®å¯ä»¥è°ƒæ•´LFUç®—æ³•ï¼š lfu-log-factor 10lfu-decay-time 1 lfu-log-factorå¯ä»¥è°ƒæ•´è®¡æ•°å™¨counterçš„å¢é•¿é€Ÿåº¦ï¼Œlfu-log-factorè¶Šå¤§ï¼Œcounterå¢é•¿çš„è¶Šæ…¢ã€‚ lfu-decay-timeæ˜¯ä¸€ä¸ªä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ•°å€¼ï¼Œå¯ä»¥è°ƒæ•´counterçš„å‡å°‘é€Ÿåº¦ å‚è€ƒï¼š Redisä¸­çš„LRUæ·˜æ±°ç­–ç•¥åˆ†æ Redisä¸­çš„LFUç®—æ³• ç©è½¬Redis-8ç§æ•°æ®æ·˜æ±°ç­–ç•¥åŠè¿‘ä¼¼LRUã€LFUåŸç†","tags":["Redis"],"categories":["Redis"]},{"title":"k8sçš„å®‰è£…ï¼ˆMacï¼‰","path":"/2021/03/13/320/","content":"å°è±¡ä¸­ä¹‹å‰macè£…k8sæŒºéº»çƒ¦ï¼Œä¹‹å‰è£…çš„ç‰ˆæœ¬è¾ƒä½v1.14.7ã€‚æœ€è¿‘æ€»æç¤ºæˆ‘æ›´æ–°ï¼Œåˆšå¥½æ›´æ–°ä¸€ä¸‹ï¼Œé¡ºä¾¿è®°å½•ä¸‹è¿‡ç¨‹ã€‚ ä¸‹è½½ ä¸‹è½½å®‰è£…[docker-desktop]https://www.docker.com/products/docker-desktop ä¿®æ”¹Docker Engineé…ç½®ï¼Œä¿®æ”¹é•œåƒæº&#123; &quot;registry-mirrors&quot;: [ &quot;https://docker.mirrors.ustc.edu.cn&quot;, &quot;https://hub-mirror.c.163.com&quot;, &quot;http://f1361db2.m.daocloud.io&quot; ], &quot;experimental&quot;: false, &quot;features&quot;: &#123; &quot;buildkit&quot;: true &#125;&#125; å®‰è£…k8s.gcr.ioç­‰ç»„ä»¶git clone https://github.com/AliyunContainerService/k8s-for-docker-desktop.git//åˆ‡æ¢åˆ°ä½ çš„k8sç‰ˆæœ¬ï¼Œæˆ‘çš„æ˜¯v1.19.7git checkout v1.19.7 æ‰§è¡Œ ./load_images.sh å®‰è£…k8sä¾èµ–ã€‚4. Enable Kubernetesï¼Œé‡å¯ï¼ŒKuberneteså¯åŠ¨æ¯”Dockeræ…¢å¤šäº†ï¼Œç¨å¾®ç­‰ä¸€ä¼šå°±å¥½ã€‚ å®‰è£…kubernetes/dashboardé¡¹ç›®åœ°å€ï¼šhttps://github.com/kubernetes/dashboard kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml å¦‚æœæ‰§è¡Œè¶…æ—¶ï¼Œå¯ä»¥æŠŠyamlæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°è¿è¡Œã€‚ kubectl get pod --namespace=kubernetes-dashboardoutput:NAME READY STATUS RESTARTS AGEdashboard-metrics-scraper-79c5968bdc-xvrzd 1/1 Running 0 4m13skubernetes-dashboard-9f9799597-9kmbk 1/1 Running 0 4m13s å¯ä»¥çœ‹åˆ°æˆåŠŸå®‰è£…ubernetes-dashboardã€‚ å¯åŠ¨kubectl proxy ç™»å½•æ‰“å¼€æµè§ˆå™¨ï¼šhttp://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login é€‰æ‹©Tokenç™»å½•ï¼Œç”¨ä¸‹æ–¹å‘½ä»¤è·å–tokenï¼Œç™»å½•æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°ç•Œé¢ã€‚ è·å–tokenkubectl -n kube-system describe $(kubectl -n kube-system get secret -n kube-system -o name | grep namespace) | grep token","tags":["k8s"],"categories":["devops"]},{"title":"RedisåŸºç¡€ç±»å‹ã€å¸¸ç”¨çŸ¥è¯†","path":"/2021/03/08/base/","content":"ä¸»è¦ç±»å‹ å­—ç¬¦ä¸²ï¼ˆstringsï¼Œbitmapsï¼‰ æ•£åˆ—ï¼ˆhashesï¼‰ åˆ—è¡¨ï¼ˆlistsï¼‰ é›†åˆï¼ˆsetsï¼‰ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ hyperloglogs å‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰ åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰ Streamï¼ˆ5.0ç‰ˆæœ¬æ–°å¢ï¼‰ å…³äºå‘½ä»¤æˆ‘æ¨èçœ‹è¿™ä¸¤ä¸ªï¼š http://doc.Redisfans.com/ http://www.Redis.cn/commands.html åº”ç”¨åœºæ™¯strings ç¼“å­˜ åˆ†å¸ƒå¼é”ï¼ˆsetnxï¼‰ ç­¾åˆ°ç»Ÿè®¡ï¼ˆsetbitï¼‰ è®¡æ•°ï¼ˆincrï¼‰ hashes ç¼“å­˜ ç”¨æˆ·æ ‡ç­¾ lists é˜Ÿåˆ— sets äº¤é›†å¹¶é›† æ•°æ®å»é‡ zset æ’è¡Œæ¦œ å»¶æ—¶ä»»åŠ¡ é™æµ hyperloglogs uvç»Ÿè®¡ï¼ˆipç»Ÿè®¡ï¼‰ pub/sub å‘å¸ƒè®¢é˜…ï¼ˆä¸æ˜¯ç‰¹åˆ«å¯é ï¼‰ geospatial é™„è¿‘çš„äºº Stream é˜Ÿåˆ— å‘å¸ƒè®¢é˜… å…¶ä»–åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€ä»¥phpä»£ç ä¸ºä¾‹ï¼š WATCHå‘½ä»¤å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œã€‚ç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ï¼ˆäº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯åœ¨EXECä¹‹åæ‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨MULTIå‘½ä»¤åå¯ä»¥ä¿®æ”¹WATCHç›‘æ§çš„é”®å€¼ï¼‰ // åº“å­˜ä¸º5//å®ä¾‹åŒ–Redis$Redis = new Redis();//è¿æ¥$Redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);$key = &#x27;sale&#x27;;$Redis-&gt;setnx($key, 0); // æ­¤é¡¹ä¸é¢„å®šä¹‰äº¦å¯ï¼Œä¿è¯keyå”¯ä¸€å°±è¡Œ$Redis-&gt;watch($key); //ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚$sale_num = $Redis-&gt;get($key);if ($sale_num &gt; 4) &#123;\texit();&#125;$Redis-&gt;multi(); //æ ‡è®°äº‹åŠ¡$Redis-&gt;incr($key); //é”€é‡+1sleep(1); //æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ$ret = $Redis-&gt;exec(); // äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚if ($ret) &#123; // è‡ªå®šä¹‰çš„ä¸€ä¸ªåŸºäºmedooçš„dbclass\tinclude &#x27;db.php&#x27;;\t$db = new db([ &#x27;database_type&#x27; =&gt; &#x27;mysql&#x27;, &#x27;database_name&#x27; =&gt; &#x27;test&#x27;, &#x27;server&#x27; =&gt; &#x27;puresai&#x27;, &#x27;username&#x27; =&gt; &#x27;puresai&#x27;, &#x27;password&#x27; =&gt; &#x27;*&#x27;, &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;\t]);\t$db-&gt;update(&#x27;goods&#x27;, [&quot;stock_num[-]&quot; =&gt; 1], [&#x27;id&#x27; =&gt; 1]);&#125; å¸ƒéš†è¿‡æ»¤å™¨ å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚ phpå®ç°æ¨èçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š https://github.oscome.cn/2019/05/21/188/ å½“ç„¶ï¼ŒRedisè‡ªå·±ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š https://github.com/RedisBloom/RedisBloom git clone https://github.com/RedisBloom/RedisBloom.gitcd Redisbloommake/path/to/Redis-server --loadmodule ./Redisbloom.so Bloomï¼šå‘è¿‡æ»¤å™¨æ·»åŠ æ–°é¡¹,å¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™ä¼šä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨ 127.0.0.1:6379&gt; BF.ADD newFilter foo(integer) 1 Bloomï¼šæ£€æŸ¥è¿‡æ»¤å™¨ä¸­æ˜¯å¦å­˜åœ¨é¡¹ 127.0.0.1:6379&gt; BF.EXISTS newFilter foo(integer) 1127.0.0.1:6379&gt; BF.EXISTS newFilter notpresent(integer) 0 é™æµRedis-cell// æå‰å®‰è£…rustå“Ÿgit clone https://github.com/brandur/Redis-cell.gitcd Redis-cellcargo build --releasecp target/release/libRedis_cell.dylib /path/to/modules/Redis-server --loadmodule /path/to/modules/libRedis_cell.so è¯¥æ¨¡å—åªæœ‰1æ¡æŒ‡ä»¤cl.throttleï¼Œå®ƒçš„å‚æ•°å’Œè¿”å›å€¼éƒ½ç•¥æ˜¾å¤æ‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæŒ‡ä»¤å…·ä½“è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ &gt; cl.throttle limitThrot 15 30 60 1 â–² â–² â–² â–² â–² | | | | â””â”€â”€â”€â”€â”€ need 1 quota (å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯1) | | â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€ 30 operations / 60 seconds è¿™æ˜¯æ¼æ°´é€Ÿç‡ | â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 15 capacity è¿™æ˜¯æ¼æ–—å®¹é‡&gt; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ key ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤çš„æ„æ€æ˜¯å…è®¸é¢‘ç‡ä¸ºæ¯ 60s æœ€å¤š 30 æ¬¡(æ¼æ°´é€Ÿç‡)ï¼Œæ¼æ–—çš„åˆå§‹å®¹é‡ä¸º 15ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹å¯ä»¥å– 15 ä¸ªï¼Œç„¶åæ‰å¼€å§‹å—æ¼æ°´é€Ÿç‡çš„å½±å“ã€‚æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªæŒ‡ä»¤ä¸­æ¼æ°´é€Ÿç‡å˜æˆäº† 2 ä¸ªå‚æ•°ï¼Œæ›¿ä»£äº†ä¹‹å‰çš„å•ä¸ªæµ®ç‚¹æ•°ã€‚ç”¨ä¸¤ä¸ªå‚æ•°ç›¸é™¤çš„ç»“æœæ¥è¡¨è¾¾æ¼æ°´é€Ÿç‡ç›¸å¯¹å•ä¸ªæµ®ç‚¹æ•°è¦æ›´åŠ ç›´è§‚ä¸€äº›ã€‚ &gt; cl.throttle limitThrot 15 30 60 11) (integer) 0 # 0 è¡¨ç¤ºå…è®¸ï¼Œ1è¡¨ç¤ºæ‹’ç»2) (integer) 15 # æ¼æ–—å®¹é‡capacity3) (integer) 14 # æ¼æ–—å‰©ä½™ç©ºé—´left_quota4) (integer) -1 # å¦‚æœæ‹’ç»äº†ï¼Œéœ€è¦å¤šé•¿æ—¶é—´åå†è¯•(æ¼æ–—æœ‰ç©ºé—´äº†ï¼Œå•ä½ç§’)5) (integer) 2 # å¤šé•¿æ—¶é—´åï¼Œæ¼æ–—å®Œå…¨ç©ºå‡ºæ¥(left_quota==capacityï¼Œå•ä½ç§’)","tags":["Redis"],"categories":["Redis"]},{"title":"Redisä½¿ç”¨å•çº¿ç¨‹ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«","path":"/2021/02/28/quick/","content":"Redis6.0å¼•å…¥äº†å¤šçº¿ç¨‹ã€‚å®é™…ä¸Šå¤šçº¿ç¨‹åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•ä¸€å·¥ä½œçº¿ç¨‹ã€‚ Redis é‡‡ç”¨çš„æ˜¯åŸºäºå†…å­˜çš„é‡‡ç”¨çš„æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å‹çš„ KV æ•°æ®åº“ï¼Œç”± C è¯­è¨€ç¼–å†™ã€‚å®˜æ–¹æä¾›çš„æ•°æ®æ˜¯å¯ä»¥è¾¾åˆ°100k+çš„qpsã€‚è¿™ä¸ªæ•°æ®ä¸æ¯”é‡‡ç”¨å•è¿›ç¨‹å¤šçº¿ç¨‹çš„åŒæ ·åŸºäºå†…å­˜çš„ KV æ•°æ®åº“ Memcached å·®ã€‚ Redis å¿«çš„ä¸»è¦åŸå› æœ‰ï¼š å®Œå…¨åŸºäºå†…å­˜ æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å• ä½¿ç”¨å¤šè·¯ I/O å¤ç”¨æ¨¡å‹,éé˜»å¡IO é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€—CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€— ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedisç›´æ¥è‡ªå·±æ„å»ºäº†VMæœºåˆ¶ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ å¤šè·¯ I/O å¤ç”¨æ¨¡å‹å¤šè·¯ I/O å¤ç”¨æ¨¡å‹æ˜¯åˆ©ç”¨ selectã€pollã€epoll å¯ä»¥åŒæ—¶ç›‘å¯Ÿå¤šä¸ªæµçš„ I/O äº‹ä»¶çš„èƒ½åŠ›ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰çº¿ç¨‹é˜»å¡æ‰ï¼Œå½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµæœ‰ I/O äº‹ä»¶æ—¶ï¼Œå°±ä»é˜»å¡æ€ä¸­å”¤é†’ï¼Œäºæ˜¯ç¨‹åºå°±ä¼šè½®è¯¢ä¸€éæ‰€æœ‰çš„æµï¼ˆepoll æ˜¯åªè½®è¯¢é‚£äº›çœŸæ­£å‘å‡ºäº†äº‹ä»¶çš„æµï¼‰ï¼Œå¹¶ä¸”åªä¾æ¬¡é¡ºåºçš„å¤„ç†å°±ç»ªçš„æµï¼Œè¿™ç§åšæ³•å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚è¿™é‡Œâ€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚é‡‡ç”¨å¤šè·¯ I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œ IO çš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼Œä¸” Redis åœ¨å†…å­˜ä¸­æ“ä½œæ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ï¼ˆå†…å­˜å†…çš„æ“ä½œä¸ä¼šæˆä¸ºè¿™é‡Œçš„æ€§èƒ½ç“¶é¢ˆï¼‰ï¼Œä¸»è¦ä»¥ä¸Šä¸¤ç‚¹é€ å°±äº† Redis å…·æœ‰å¾ˆé«˜çš„ååé‡ã€‚ å’Œ Memcached ä¸åŒï¼ŒRedis å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ Libeventï¼Œè€Œæ˜¯è‡ªå·±å®Œæˆäº†ä¸€ä¸ªéå¸¸è½»é‡çº§çš„å¯¹ selectã€epollã€evportã€kqueue è¿™äº›é€šç”¨çš„æ¥å£çš„å®ç°ã€‚åœ¨ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨é€‰ç”¨é€‚åˆçš„æ¥å£ï¼Œlinux ä¸‹é»˜è®¤æ˜¯ epollã€‚å› ä¸º Libevent æ¯”è¾ƒé‡ï¼Œæ›´é€šç”¨ï¼Œä»£ç é‡ä¹Ÿå°±å¾ˆåºå¤§ï¼Œæ‹¥æœ‰å¾ˆå¤š Redis ç”¨ä¸ä¸Šçš„åŠŸèƒ½ï¼ŒRedis ä¸ºäº†è¿½æ±‚â€œè½»å·§â€å¹¶ä¸”å»é™¤ä¾èµ–ï¼Œå°±é€‰æ‹©è‡ªå·±å»å°è£…äº†ä¸€å¥—ã€‚ å•è¿›ç¨‹å•çº¿ç¨‹å¥½å¤„ ä»£ç æ›´æ¸…æ™°ï¼Œå¤„ç†é€»è¾‘æ›´ç®€å• ä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€— ä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPU","tags":["Redis"],"categories":["Redis"]},{"title":"goçš„GCæœºåˆ¶","path":"/2021/02/27/319/","content":"Golangçš„æ ‡è®°æ¸…é™¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé€šè¿‡gcmarkBitsä½å›¾æ ‡è®°spançš„å—æ˜¯å¦è¢«å¼•ç”¨ã€‚å¯¹åº”å†…å­˜åˆ†é…ä¸­çš„bitmapåŒºã€‚ ä¸‰è‰²æ ‡è®° ç™½è‰²ï¼šå¯¹è±¡æœªè¢«æ ‡è®°ï¼ŒgcmarkBitså¯¹åº”çš„ä½ä¸º0ï¼ˆè¯¥å¯¹è±¡å°†ä¼šåœ¨æœ¬æ¬¡GCä¸­è¢«æ¸…ç†ï¼‰ ç°è‰²ï¼šå¯¹è±¡å·²è¢«æ ‡è®°ï¼Œä½†è¿™ä¸ªå¯¹è±¡åŒ…å«çš„å­å¯¹è±¡æœªæ ‡è®° é»‘è‰²ï¼šå¯¹è±¡å·²è¢«æ ‡è®°ï¼Œä¸”è¿™ä¸ªå¯¹è±¡åŒ…å«çš„å­å¯¹è±¡ä¹Ÿå·²æ ‡è®°ï¼ŒgcmarkBitså¯¹åº”çš„ä½ä¸º1ï¼ˆè¯¥å¯¹è±¡ä¸ä¼šåœ¨æœ¬æ¬¡GCä¸­è¢«æ¸…ç†ï¼‰ ä¾‹å¦‚ï¼Œå½“å‰å†…å­˜ä¸­æœ‰A~Fä¸€å…±6ä¸ªå¯¹è±¡ï¼Œæ ¹å¯¹è±¡a,bæœ¬èº«ä¸ºæ ˆä¸Šåˆ†é…çš„å±€éƒ¨å˜é‡ï¼Œæ ¹å¯¹è±¡aã€båˆ†åˆ«å¼•ç”¨äº†å¯¹è±¡Aã€B, è€ŒBå¯¹è±¡åˆå¼•ç”¨äº†å¯¹è±¡Dï¼Œåˆ™GCå¼€å§‹å‰å„å¯¹è±¡çš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤º: åˆå§‹çŠ¶æ€ä¸‹æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²çš„ã€‚ æ¥ç€å¼€å§‹æ‰«ææ ¹å¯¹è±¡aã€b; ç”±äºæ ¹å¯¹è±¡å¼•ç”¨äº†å¯¹è±¡Aã€B,é‚£ä¹ˆAã€Bå˜ä¸ºç°è‰²å¯¹è±¡ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹åˆ†æç°è‰²å¯¹è±¡ï¼Œåˆ†æAæ—¶ï¼ŒAæ²¡æœ‰å¼•ç”¨å…¶ä»–å¯¹è±¡å¾ˆå¿«å°±è½¬å…¥é»‘è‰²ï¼ŒBå¼•ç”¨äº†Dï¼Œåˆ™Bè½¬å…¥é»‘è‰²çš„åŒæ—¶è¿˜éœ€è¦å°†Dè½¬ä¸ºç°è‰²ï¼Œè¿›è¡Œæ¥ä¸‹æ¥çš„åˆ†æã€‚ ç°è‰²å¯¹è±¡åªæœ‰Dï¼Œç”±äºDæ²¡æœ‰å¼•ç”¨å…¶ä»–å¯¹è±¡ï¼Œæ‰€ä»¥Dè½¬å…¥é»‘è‰²ã€‚æ ‡è®°è¿‡ç¨‹ç»“æŸ æœ€ç»ˆï¼Œé»‘è‰²çš„å¯¹è±¡ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œç™½è‰²å¯¹è±¡ä¼šè¢«å›æ”¶æ‰ã€‚ GCçš„è§¦å‘ é˜ˆå€¼ï¼šé»˜è®¤å†…å­˜æ‰©å¤§ä¸€å€ï¼Œå¯åŠ¨gc å®šæœŸï¼šé»˜è®¤2minè§¦å‘ä¸€æ¬¡gcï¼Œsrc/runtime/proc.go:forcegcperiod æ‰‹åŠ¨ï¼šruntime.gc() STWstop the worldæ˜¯gcçš„æœ€å¤§æ€§èƒ½é—®é¢˜ï¼Œå¯¹äºgcè€Œè¨€ï¼Œéœ€è¦åœæ­¢æ‰€æœ‰çš„å†…å­˜å˜åŒ–ï¼Œå³åœæ­¢æ‰€æœ‰çš„goroutineï¼Œç­‰å¾…gcç»“æŸä¹‹åæ‰æ¢å¤ã€‚ æ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³•çš„STW(stop the world)æ“ä½œï¼Œå°±æ˜¯runtimeæŠŠæ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨å†»ç»“æ‰ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…¨éƒ¨å†»ç»“æ„å‘³ç€ç”¨æˆ·é€»è¾‘æ˜¯æš‚åœçš„ã€‚è¿™æ ·æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«ä¿®æ”¹äº†ï¼Œè¿™æ—¶å€™å»æ‰«ææ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ Goå¦‚ä½•å‡çŸ­è¿™ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿæ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³•åŒ…å«ä¸¤éƒ¨åˆ†é€»è¾‘ï¼šæ ‡è®°å’Œæ¸…é™¤ã€‚ æˆ‘ä»¬çŸ¥é“Golangä¸‰è‰²æ ‡è®°æ³•ä¸­æœ€ååªå‰©ä¸‹çš„é»‘ç™½ä¸¤ç§å¯¹è±¡ï¼Œé»‘è‰²å¯¹è±¡æ˜¯ç¨‹åºæ¢å¤åæ¥ç€ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¦‚æœä¸ç¢°è§¦é»‘è‰²å¯¹è±¡ï¼Œåªæ¸…é™¤ç™½è‰²çš„å¯¹è±¡ï¼Œè‚¯å®šä¸ä¼šå½±å“ç¨‹åºé€»è¾‘ã€‚æ‰€ä»¥ï¼š æ¸…é™¤æ“ä½œå’Œç”¨æˆ·é€»è¾‘å¯ä»¥å¹¶å‘ã€‚ æ ‡è®°æ“ä½œå’Œç”¨æˆ·é€»è¾‘ä¹Ÿæ˜¯å¹¶å‘çš„ï¼Œç”¨æˆ·é€»è¾‘ä¼šæ—¶å¸¸ç”Ÿæˆå¯¹è±¡æˆ–è€…æ”¹å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆæ ‡è®°å’Œç”¨æˆ·é€»è¾‘å¦‚ä½•å¹¶å‘å‘¢ï¼Ÿè¿™é‡Œå°±è®©è¯´åˆ°golangçš„å†™å±éšœäº†ã€‚ GCæµç¨‹ Sweep Termination: å¯¹æœªæ¸…æ‰«çš„spanè¿›è¡Œæ¸…æ‰«, åªæœ‰ä¸Šä¸€è½®çš„GCçš„æ¸…æ‰«å·¥ä½œå®Œæˆæ‰å¯ä»¥å¼€å§‹æ–°ä¸€è½®çš„GC Mark: æ‰«ææ‰€æœ‰æ ¹å¯¹è±¡, å’Œæ ¹å¯¹è±¡å¯ä»¥åˆ°è¾¾çš„æ‰€æœ‰å¯¹è±¡, æ ‡è®°å®ƒä»¬ä¸è¢«å›æ”¶ Mark Termination: å®Œæˆæ ‡è®°å·¥ä½œ, é‡æ–°æ‰«æéƒ¨åˆ†æ ¹å¯¹è±¡(è¦æ±‚STW) Sweep: æŒ‰æ ‡è®°ç»“æœæ¸…æ‰«span ç›®å‰æ•´ä¸ªGCæµç¨‹ä¼šè¿›è¡Œä¸¤æ¬¡STW(Stop The World), ç¬¬ä¸€æ¬¡æ˜¯Marké˜¶æ®µçš„å¼€å§‹, ç¬¬äºŒæ¬¡æ˜¯Mark Terminationé˜¶æ®µ. ç¬¬ä¸€æ¬¡STWä¼šå‡†å¤‡æ ¹å¯¹è±¡çš„æ‰«æ, å¯åŠ¨å†™å±éšœ(Write Barrier)å’Œè¾…åŠ©GC(mutator assist). ç¬¬äºŒæ¬¡STWä¼šé‡æ–°æ‰«æéƒ¨åˆ†æ ¹å¯¹è±¡, ç¦ç”¨å†™å±éšœ(Write Barrier)å’Œè¾…åŠ©GC(mutator assist). éœ€è¦æ³¨æ„çš„æ˜¯, ä¸æ˜¯æ‰€æœ‰æ ¹å¯¹è±¡çš„æ‰«æéƒ½éœ€è¦STW, ä¾‹å¦‚æ‰«ææ ˆä¸Šçš„å¯¹è±¡åªéœ€è¦åœæ­¢æ‹¥æœ‰è¯¥æ ˆçš„G.ä»go 1.9å¼€å§‹, å†™å±éšœçš„å®ç°ä½¿ç”¨äº†Hybrid Write Barrier, å¤§å¹…å‡å°‘äº†ç¬¬äºŒæ¬¡STWçš„æ—¶é—´. å†™å±éšœå› ä¸ºgoæ”¯æŒå¹¶è¡ŒGCï¼Œ GCçš„æ‰«æå’Œgoä»£ç å¯ä»¥åŒæ—¶è¿è¡Œï¼Œè¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯GCæ‰«æçš„è¿‡ç¨‹ä¸­goä»£ç æœ‰å¯èƒ½æ”¹å˜äº†å¯¹è±¡çš„ä¾èµ–æ ‘ã€‚ ä¾‹å¦‚å¼€å§‹æ‰«ææ—¶å‘ç°æ ¹å¯¹è±¡Aå’ŒBï¼ŒBæ‹¥æœ‰Cçš„æŒ‡é’ˆã€‚ GCå…ˆæ‰«æAï¼ŒAæ”¾å…¥é»‘è‰² BæŠŠCçš„æŒ‡é’ˆäº¤ç»™A GCå†æ‰«æBï¼ŒBæ”¾å…¥é»‘è‰² Cåœ¨ç™½è‰²ï¼Œä¼šå›æ”¶ï¼›ä½†æ˜¯Aå…¶å®å¼•ç”¨äº†Cã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜, goåœ¨GCçš„æ ‡è®°é˜¶æ®µä¼šå¯ç”¨å†™å±éšœ(Write Barrier). å¯ç”¨äº†å†™å±éšœ(Write Barrier)åï¼Œ GCå…ˆæ‰«æAï¼ŒAæ”¾å…¥é»‘è‰² BæŠŠCçš„æŒ‡é’ˆäº¤ç»™A ç”±äºAåœ¨é»‘è‰²ï¼Œæ‰€ä»¥Cæ”¾å…¥ç°è‰² Cæ²¡æœ‰å­å¯¹è±¡ï¼Œæ”¾å…¥é»‘è‰² æ‰«æBï¼ŒBæ²¡æœ‰å­å¯¹è±¡ï¼Œæ”¾å…¥é»‘è‰² å³ä½¿Aå¯èƒ½ä¼šåœ¨ç¨åä¸¢æ‰C, é‚£ä¹ˆCå°±åœ¨ä¸‹ä¸€è½®å›æ”¶ã€‚ å¼€å¯å†™å±éšœä¹‹åï¼Œå½“æŒ‡é’ˆå‘ç”Ÿæ”¹å˜, GCä¼šè®¤ä¸ºåœ¨è¿™ä¸€è½®çš„æ‰«æä¸­è¿™ä¸ªæŒ‡é’ˆæ˜¯å­˜æ´»çš„, æ‰€ä»¥æ”¾å…¥ç°è‰²ã€‚ å…¶ä»–å¸¸è§gcæœºåˆ¶ å¼•ç”¨è®¡æ•° å¤åˆ¶æ”¶é›† åˆ†ä»£æ”¶é›† GC çš„è§¦å‘æ—¶æœºçš„ä¸¤ç§å½¢å¼ ä¸»åŠ¨è§¦å‘ï¼Œé€šè¿‡è°ƒç”¨ runtime.GC æ¥è§¦å‘ GCï¼Œæ­¤è°ƒç”¨é˜»å¡å¼åœ°ç­‰å¾…å½“å‰ GC è¿è¡Œå®Œæ¯•ã€‚ è¢«åŠ¨è§¦å‘ï¼Œåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š ä½¿ç”¨ç³»ç»Ÿç›‘æ§ï¼Œå½“è¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰äº§ç”Ÿä»»ä½• GC æ—¶ï¼Œå¼ºåˆ¶è§¦å‘ GCã€‚ ä½¿ç”¨æ­¥è°ƒï¼ˆPacingï¼‰ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ§åˆ¶å†…å­˜å¢é•¿çš„æ¯”ä¾‹ã€‚ å‚è€ƒï¼š Golang GC(åƒåœ¾å›æ”¶æœºåˆ¶) [11. è§¦å‘ GC çš„æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿ](https://www.bookstack.cn/read/qcrao-Go-Questions/spilt.11.GC-GC.md#11. è§¦å‘ GC çš„æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿ)","tags":["go"],"categories":["go"]},{"title":"æˆä¸ºä¼šå¸¦å›¢é˜Ÿçš„æŠ€æœ¯äºº","path":"/2021/02/14/318/","content":"æœ¬æ–‡æ˜¯æ‹‰å‹¾ä¸“æ ã€Šæˆä¸ºä¼šå¸¦å›¢é˜Ÿçš„æŠ€æœ¯äººã€‹çš„ç¬”è®°ï¼Œå›¾åŸºæœ¬ä¹Ÿæ¥æºäºä¸“æ ï¼Œè‡ªå·±ä»¥å‰ä¹Ÿæœ‰å¸¦å›¢é˜Ÿç»éªŒï¼Œä½†è‡ªæˆ‘æ„Ÿè§‰åšå¾—ä¸å¤Ÿå¥½ï¼Œè¿™ä¸ªä¸“æ ç»™æˆ‘å¾ˆå¤šå¯å‘ã€‚ æŠ€æœ¯äººä¸‰è¦ç´  æŠ€æœ¯äººä¸‰è¦ç´ ï¼šç¨³å®šæ€§ã€å€ºåŠ¡ã€æ¶æ„ ç¨³å®šæ€§æ€ä¹ˆè¡¡é‡ç³»ç»Ÿç¨³å®šæ€§ï¼Ÿä¸€èˆ¬æ¥è®²ï¼Œé€šè¿‡ç»Ÿè®¡ç³»ç»Ÿä¸å¯ç”¨çš„æ—¶é•¿æˆ–æ¬¡æ•°å°±å¯ä»¥å¯¹ç¨³å®šæ€§è¿›è¡Œé‡åŒ–ï¼Œæ¯”å¦‚ä¸šå†…å¸¸è¯´ 4 ä¸ª 9 çš„å¯ç”¨æ€§ï¼ˆå³ 1 å¹´å†… 99.99% çš„æ—¶é—´ç³»ç»Ÿæ˜¯å¯ç”¨çš„ï¼Œä¸å¯ç”¨æ—¶é•¿ä»…ä¸º 52.6 åˆ†é’Ÿï¼‰ã€‚ é’ˆå¯¹ç¨³å®šæ€§çš„æé«˜ä¹Ÿå¯ä»¥çœ‹ä½œå›´ç»•äº‹æ•…çš„æ²»ç†ï¼Œå¯ä»¥ä»äº‹æ•…å‘ç”Ÿçš„å‰ã€ä¸­ã€ååˆ†é˜¶æ®µæ¥çœ‹å¯¹åº”çš„å…³é”®ç‚¹ã€‚ äº‹æ•…çš„ç±»å‹ï¼šå¯ç”¨æ€§äº‹æ•…ã€èµ„æŸç±»äº‹æ•…ã€‚ äº‹æ•…å‰é¢„é˜²ï¼šä¸»åŠ¨æ²»ç†å‡å°‘ç³»ç»Ÿçš„é£é™©éšæ‚£ï¼Œé‡ç‚¹åœ¨å˜æ›´ç®¡æ§ã€å¯ç”¨æ€§è®¾è®¡ã€åº”æ€¥é¢„æ¡ˆä¸æ¼”ç»ƒã€‚ äº‹æ•…ä¸­åº”æ€¥ï¼šâ€œæ­¢è¡€ã€æ¢å¤â€ã€‚ äº‹æ•…åå¤ç›˜ï¼šç›®çš„ä¸æ˜¯è¿½è´£ï¼Œä¸æ˜¯ç”©é”…ï¼Œè€Œæ˜¯æŸ¥æ ¹å› ã€æ”¹è¿›æ¶æ„ã€å®Œå–„åº”æ€¥ã€æ€»ç»“ç»éªŒã€‚ äº‹æ•…çš„ç±»å‹ä»äº‹æ•…ç‰¹æ€§ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºå¯ç”¨æ€§äº‹æ•…å’Œèµ„æŸç±»äº‹æ•…ã€‚ å¯ç”¨æ€§äº‹æ•…ï¼šæŠ€æœ¯åŸå› å¯¼è‡´ç³»ç»Ÿéƒ¨åˆ†æˆ–è€…å…¨éƒ¨åŠŸèƒ½ä¸å¯ç”¨ï¼Œä¸šåŠ¡æ²¡åŠæ³•æ­£å¸¸å®Œæˆå¯¹åº”æµç¨‹æˆ–è€…æä¾›å¯¹åº”æœåŠ¡ã€‚æ¯”å¦‚å› ä¸ºç½‘ç»œã€æ¥å£ Bug ç­‰åŸå› ï¼Œç”¨æˆ·æ²¡åŠæ³•ç™»å½•ã€å•†å“åˆ—è¡¨ä¸æ˜¾ç¤ºç­‰ã€‚ èµ„æŸç±»äº‹æ•…ï¼šç³»ç»Ÿçš„åŠŸèƒ½éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†å› ä¸ºé€»è¾‘ã€è®¡ç®—ç­‰åŸå› è®©ä¸šåŠ¡çš„æŸä¸€æ–¹äº§ç”Ÿäº†èµ„é‡‘æŸå¤±ã€‚æ¯”å¦‚æŸç”µå•†éƒ¨é—¨é”™å‘æ— é—¨æ§›ä¼˜æƒ åˆ¸ã€æŸå…¬å¸å•†æˆ·æ¸…ç»“ç®—å°‘æ‰“æ¬¾ç»™å•†æˆ·ç­‰ç­‰ã€‚ æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸ æ•…éšœå¤„ç†çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥åˆ†ä¸º 4 ä¸ªé˜¶æ®µï¼šå‘ç°å¼‚å¸¸ã€æ’æŸ¥é—®é¢˜ã€åˆ¤æ–­å†³ç­–ã€æ¢å¤å¤„ç†ã€‚è¿™ 4 ä¸ªé˜¶æ®µå¯¹åº”çš„è¡ŒåŠ¨å¹¶ä¸æ˜¯å®Œå…¨ä¸²è¡Œçš„ï¼Œè™½ç„¶æœ‰ä¸€å®šçš„ä¾èµ–å…³ç³»ï¼Œä½†åœ¨å®é™…çš„å¤„ç†è¿‡ç¨‹ä¸­åº”è¯¥å¹¶è¡Œå±•å¼€ã€‚ç±»ä¼¼ fork/join çš„æ¨¡å¼ï¼Œä¸æ–­å®Œæˆå°ä»»åŠ¡ã€ä¸æ–­æ±‡æ€»ä¿¡æ¯ï¼Œä¸æ–­åšå‡ºåˆ¤æ–­ä¸å†³ç­–ï¼Œå½¢æˆå¾ªç¯ç›´åˆ°æ•…éšœæ¢å¤ã€‚ æ•…éšœå‘ç° æ€»çš„æ¥è¯´ï¼Œäººå·¥çš„è¢«åŠ¨åé¦ˆåœ¨æ—¶é—´å’Œé€Ÿåº¦ä¸Šæœ‰è¾ƒå¼ºçš„ä¸ç¡®å®šæ€§ï¼Œå¾ˆå®¹æ˜“å‡ºç°â€œå°æ•…éšœ * é•¿æ—¶é—´ = å¤§äº‹æ•…â€çš„æƒ…å½¢ã€‚è€Œçº¯ç²¹çš„æŠ€æœ¯æŒ‡æ ‡ç›‘æ§åˆä¼šå¿½ç•¥æ‰æ¥å£æ­£å¸¸å“åº”ï¼Œä½†æ˜¯ä¸šåŠ¡å¼‚å¸¸çš„åœºæ™¯ï¼Œåªæœ‰ä¸¤è€…ç»“åˆï¼Œé€šè¿‡ç›‘æ§å‘Šè­¦ï¼Œæœ€å¤§ç¨‹åº¦ä¸Šç¼©çŸ­æ•…éšœæ„ŸçŸ¥çš„æ—¶é—´ï¼Œæ‰èƒ½æ—©å‘ç°æ—©è§£å†³ï¼Œå‡å°‘ä¸šåŠ¡å½±å“ã€‚ æ•…éšœæ’æŸ¥ ç›´æ¥é”å®šï¼šæœ€è¿‘çš„ä»£ç æ›´æ–°ä¸å¼‚å¸¸ç°è±¡é—´æœ‰ç›´æ¥çš„é€»è¾‘å…³è”ï¼Œè¿›è€Œå¯ä»¥ç›´æ¥é”å®šåˆ°æ•…éšœç‚¹ã€‚æ¯”å¦‚ï¼Œåˆšå¯¹ä¸‹å•æ¥å£è¿›è¡Œäº†å‘å¸ƒå˜æ›´ï¼Œå®¢æˆ·åé¦ˆå¤§é‡å¤±è´¥ï¼Œå¯ä»¥åŸºæœ¬æ–­å®šæ˜¯åˆšæ‰çš„å‘å¸ƒå¯¼è‡´ã€‚ æ’é™¤æ³•ï¼šå½“å¹²æ‰°å› ç´ è¿‡å¤šï¼ˆç”¨æˆ·ã€è®¢å•ç­‰å‡ ä¸ªç³»ç»ŸåŒæ—¶å‘ç”Ÿå˜æ›´ï¼Œå¼•èµ·è®¢å•å¼‚å¸¸ï¼‰ï¼Œå¾ˆéš¾ç›´æ¥é”å®šåˆ°æ•…éšœç‚¹ï¼Œå°±è¦ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œåœ¨æ•´æ¡ä¸‹å•é“¾è·¯ä¸ŠåŠå…³è”ä»£ç è¿›è¡Œè‡ªæŸ¥è‡ªè¯ï¼Œé€šè¿‡æ’é™¤æ³•é”å®šæ•…éšœã€‚ æ•…éšœå†³ç­– ä¸šåŠ¡å†³ç­–éå¸¸å¤æ‚ï¼Œèƒ½å¦ç¬¬ä¸€æ—¶é—´æ­¢æŸå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæŠ€æœ¯ Leader çš„ç°åœºååº”å’Œæ“ä½œï¼Œ è¦æ³¨æ„æ•…éšœå†³ç­–çš„ä¸¤ä¸ªå…³é”®ç‚¹ ï¼š ä¸€å®šè¦æœ‰æ˜ç¡®çš„å†³ç­–äººã€ä¸»å¯¼è€…å’Œæœ‰æ•ˆçš„æ²Ÿé€šæ–¹å¼ï¼ˆé’‰é’‰ç¾¤ã€å¤šäººç”µè¯ä¼šè®®ç­‰ï¼‰ï¼Œè®©ä¿¡æ¯å¯ä»¥é€šç•…åœ°äº¤æµå‡ºæ¥ï¼Œå¹¶ä¸”å†³ç­–äººå¯ä»¥æ ¹æ®æƒ…å†µåšåˆ¤æ–­ä¸å–èˆï¼Œå½¢æˆæ‰€æœ‰äººæ˜ç¡®çš„å¤„ç†ç»“è®ºï¼Œæœ€å¥½è¿˜èƒ½è½æˆæ–‡æ¡£ï¼Œå¯è¿½æº¯ã€‚ æ¯”å¦‚ï¼Œç¬¬ä¸€æ—¶é—´åœæ­¢é”™è¯¯çº¢åŒ…çš„å‘æ”¾ï¼Œç¡®ä¿æ•…éšœæ²¡æœ‰å¢é‡ï¼Œå¹¶æŠŠå†³ç­–ç¬¬ä¸€æ—¶é—´åŒæ­¥ç»™å›¢é˜Ÿæˆå‘˜ï¼Œå¹¶åŒæ­¥ç›¸å…³è´Ÿè´£äººåç»­çš„åŠ¨ä½œï¼Œå¯¹å·²å‘æ”¾çš„çº¢åŒ…ï¼Œæ˜ç¡®è¦æ±‚è´Ÿè´£äººæ±‡æ€»å„ç±»å…³é”®ä¿¡æ¯ï¼ˆçº¢åŒ…æ•°é‡ã€æ¶‰åŠé‡‘é¢ã€æ¶‰åŠç”¨æˆ·æ•°ã€æœ‰æ•ˆæ—¶é•¿ã€å¯èƒ½èµ„æŸç­‰ï¼‰ã€‚ æ‰€æœ‰çš„ä¿¡æ¯ä¸€å®šè¦æ•°æ®åŒ–ï¼Œä¸åŒçš„æ•°æ®é‡çº§ä¼šå¯¼è‡´å†³ç­–ä¸åŒï¼Œæ¯”å¦‚çº¢åŒ…é”™å‘ 5W å¯èƒ½åªæ˜¯æš‚åœå‘æ”¾ï¼Œä½†æ˜¯å­˜é‡çº¢åŒ…ä¾ç„¶å¯ä»¥æ ¸é”€ï¼ŒæŸå¤±å…¬å¸å¯ä»¥æ‰¿æ‹…ã€‚ä½†æ˜¯å¦‚æœé”™å‘ 5000Wï¼Œå¤§æ¦‚å°±è¦æ¶‰åŠä¸€ç³»åˆ—çš„è°ƒæ•´ï¼Œè¿™æ˜¯éå¸¸å½±å“å†³ç­–çš„ã€‚ æ•…éšœæ¢å¤ åº”æ€¥â€œä¸‰æ¿æ–§â€ï¼šå›æ»šã€é‡å¯å¤§æ³•ã€é™çº§é™æµã€‚ å¦‚ä½•æœ‰ä»·å€¼åœ°åšäº‹åå¤ç›˜ï¼Ÿä½ å¯ä»¥ä»æ—¶é•¿ã€ç°è±¡ã€å¤„ç†æ—¶é—´è½´ã€æ ¹å› ã€æ”¹è¿›è®¡åˆ’è¿™å‡ ä¸ªç»´åº¦è¿›è¡Œå¤ç›˜ï¼Œ åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œæ·±ç©¶ï¼š äº‹æ•…æ—¶é•¿ï¼š1-5-10(å³ 1 åˆ†é’Ÿå‘ç°ã€5 åˆ†é’Ÿå“åº”ã€10 åˆ†é’Ÿæ¢å¤) æ˜¯å¦è¾¾æˆï¼Œå¦‚æœæ²¡æœ‰æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå“ªä¸ªç¯èŠ‚ç”¨æ—¶æœ€å¤šï¼Œå¦‚ä½•æé«˜å’Œæ”¹å–„ï¼Ÿ äº‹æ•…æ ¹å› ï¼šæ ¹å› ä¸ç­‰äºç›´æ¥åŸå› ï¼Œä¸€ä¸ªäº‹æ•…çš„ç›´æ¥åŸå› å¾€å¾€å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æ ¹å› å¯èƒ½æ˜¯å¤šä¸ªç»´åº¦çš„ç¼ºå¤±ï¼Œéœ€è¦åƒå‰¥æ´‹è‘±ä¸€æ ·ä¸€å±‚å±‚æ‰¾ä¸‹å»ã€‚æ‹¿åº“å­˜æ¥å£å˜æ›´è¿™ä¸ªCaseæ¥è¯´ï¼Œç›´æ¥åŸå› å°±æ˜¯æŸæ®µä»£ç é€»è¾‘å˜æ›´å¯¼è‡´ï¼Œä½†æ˜¯åº”è¯¥åœ¨æµ‹è¯•ã€å‘å¸ƒã€ç›‘æ§ã€åº”æ€¥å½±å“ã€é¢„æ¡ˆè®¾è®¡ç­‰å¤šä¸ªç¯èŠ‚å±•å¼€å»çœ‹ï¼Œæ ¹å› çš„æŒ–æ˜å¹¶ä¸å¿Œè®³â€œå¹æ¯›æ±‚ç–µâ€ã€‚ äº‹æ•…æ”¹è¿›æªæ–½ï¼šç”±ç‚¹æ¨åˆ°é¢ã€æ˜ç¡®åˆ°äººã€æ˜ç¡®æ—¶é—´ã€‚ä¸æ ¹å› ç±»ä¼¼ï¼Œè¦ç»“åˆå¤šä¸ªç»´åº¦å½¢æˆç»„åˆæ‹³çš„æ”¹è¿›ç‚¹ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ¨ä½œï¼Œè¦å°†é‡ç‚¹æ”¾åœ¨å¯¹æœªæ¥ã€å¯¹åŒç±»é—®é¢˜çš„é¢„é˜²ä¸Šã€‚æ ¸å¿ƒå°±æ˜¯å¦‚æœå†ä¸€æ¬¡å‘ç”Ÿç±»ä¼¼çš„é—®é¢˜ï¼Œè¿™äº›æ”¹è¿›æªæ–½æ˜¯ä¸æ˜¯èƒ½èµ·åˆ°ä½œç”¨ã€‚ å…³äºäº‹åå¤ç›˜ï¼Œæˆ‘ä»¬å°±æ˜¯è¦æ·±æŒ–äº‹æ•…å¦‚ä½•å‘ç”Ÿçš„ã€å¦‚ä½•å¤„ç†çš„ã€æœªæ¥æ€ä¹ˆé¢„é˜²ã€‚ä½†è¦é¿å…æƒ…ç»ªåŒ–ï¼Œåœ¨å¤ç›˜ä¼šä¸Šçš„åæ€ã€æ„Ÿæ‚Ÿã€æ‡Šæ¼æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œå¦‚ä½•å¸¦é¢†å›¢é˜ŸæŠŠç²¾åŠ›æ”¾åœ¨æ”¹è¿›æªæ–½çš„è½å®ä»¥åŠäº‹æ•…å‰çš„æ²»ç†ä¸Šæ›´æœ‰ä»·å€¼ã€‚å¦å¤–ï¼Œä½ éœ€è¦ç•™å‡ºæ—¶é—´è®©å›¢é˜Ÿä¼™ä¼´è¿›è¡Œå†…éƒ¨ Reviewï¼Œé¿å…ä¸ºäº†å¼€ä¼šè€Œå¤ç›˜ã€‚ æ²¡æœ‰è´¨é‡çš„äº¤ä»˜ï¼Œå†å¤šå†å¿«éƒ½æ¯«æ— æ„ä¹‰ã€‚ å˜æ›´ä¼šå¼•èµ·90%ä»¥ä¸Šçš„æ•…éšœ å˜æ›´éœ€è¦ç›‘æ§ æœ‰æ•ˆçš„ç›‘æ§è¦å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š æ˜¯å¦æœ‰é—®é¢˜å‘ç”Ÿï¼Ÿ å“ªé‡Œå‘ç”Ÿäº†é—®é¢˜ï¼Ÿ å‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ æœ‰æ•ˆç°åº¦å¿…é¡»æœ‰è€å¿ƒ ç°åº¦ä»æ¥ä¸æ˜¯ä¸ºäº†æµ‹è¯•ï¼Œä¹Ÿä¸ç­‰äº A/B Testã€‚å®ƒæœ¬èº«æ˜¯ä¸ºäº†å¯¹æŠ—â€œæœªçŸ¥çš„ä¸ç¡®å®šæ€§â€ã€‚ è¦æƒ³å®ç°ç°åº¦çš„æœ‰æ•ˆæ€§ï¼Œå…³é”®ç‚¹åœ¨äºæ—¶é—´å’Œæµé‡ã€‚ æ—¶é—´ï¼šæ¯ä¸ªç°åº¦é˜¶æ®µè‡³å°‘æœ‰ 5 ~ 10 min çš„è§‚å¯Ÿï¼Œåœ¨ç›‘æ§ã€æ—¥å¿—å’Œå„æ–¹åé¦ˆæ²¡æœ‰å¼‚å¸¸åå†æ‰©å¤§ç°åº¦èŒƒå›´ï¼Œç¡®ä¿ä¸€äº›è¿è¡Œæ—¶å¼‚å¸¸æˆ–é‡å˜ç§¯ç´¯è´¨å˜çš„é—®é¢˜å¯ä»¥æš´éœ²å‡ºæ¥ã€‚ æµé‡ï¼šæœ‰æ—¶ä¸€äº›ä¸šåŠ¡åœºæ™¯éœ€è¦ç‰¹å®šçš„è§¦å‘æ¡ä»¶ï¼Œæ¯”å¦‚æ»¡è¶³æŸäº›æ¡ä»¶çš„ç”¨æˆ·æˆ–æ»¡è¶³æŸäº›æ¡ä»¶çš„è®¢å•ï¼Œé‚£ä¹ˆåœ¨ç°åº¦æ—¶å°±ä¸èƒ½ä»…é€šè¿‡å•ä½æ—¶é—´å†…æœ‰æ²¡æœ‰å¼‚å¸¸æ¥åˆ¤æ–­ï¼Œè¿˜è¦ç¡®ä¿æœ‰è¶³å¤Ÿçš„æœ‰æ•ˆæµé‡ã€‚ å›æ»šå°±æ˜¯å˜æ›´çš„â€œåæ‚”è¯â€ è¦çŸ¥é“ï¼Œç³»ç»Ÿå¹¶ä¸æ˜¯å¤©ç„¶å¯ä»¥æ— ç¼å›æ»šçš„ï¼Œæƒ³è¦ç³»ç»Ÿå…·å¤‡å›æ»šçš„èƒ½åŠ›ï¼Œåœ¨è®¾è®¡ä¸å®ç°é˜¶æ®µéœ€è¦ä»˜å‡ºé¢å¤–çš„ç²¾åŠ›ã€‚å¯å›æ»šçš„æœ¬è´¨æ˜¯ç³»ç»Ÿçš„å…¼å®¹æ€§è®¾è®¡ä¸å®ç°ï¼Œæ¯”å¦‚å¸¸è§çš„â€œåªå¢ä¸æ”¹â€ï¼Œä¸€ä¸ª API å†…è¦è°ƒæ•´å¾ˆå¤šå®ç°é€»è¾‘æ‰èƒ½æ»¡è¶³æ–°ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ­¤æ—¶ä¸å¦¨ç›´æ¥æ–°å¢ä¸€ä¸ª API ï¼Œä¸¤ä¸ª API ä¿æŒå‚æ•°ä¸€è‡´ï¼Œé‚£ä¹ˆä¸€æ—¦æ–° API æœ‰å¼‚å¸¸ç›´æ¥åˆ‡æ¢å›æ—§çš„ API å³å¯ã€‚ æ‰€ä»¥ï¼Œä¸è®ºæ˜¯ç°åº¦è®¡åˆ’è¿˜æ˜¯å›æ»šç­–ç•¥éƒ½åº”è¯¥åœ¨æ¶æ„è®¾è®¡é˜¶æ®µå°±å»è€ƒè™‘ï¼Œç»“åˆæ’æœŸã€é£é™©ç¨‹åº¦ã€æˆæœ¬æŠ•å…¥è¿™äº›æ–¹é¢ï¼Œè¦åšå¥½è¯„ä¼°ä¸å¹³è¡¡ã€‚ åšå®ˆ Design For Failure çš„æ¶æ„ç†å¿µâ€œDesign for failure and nothing will failâ€ï¼Œæœ€æ—©æ˜¯ AWS çš„ä¸€æ¡æœ€ä½³å®è·µï¼Œå³é¢å‘å¤±è´¥è¿›è¡Œç³»ç»Ÿè®¾è®¡ã€‚å¯ä»¥ç†è§£ä¸ºï¼šè€ƒè™‘ç³»ç»Ÿæ‰€æœ‰å¯èƒ½å‘ç”Ÿæ•…éšœæˆ–ä¸å¯ç”¨çš„æƒ…å½¢ï¼Œå¹¶å‡è®¾è¿™äº›å¯èƒ½éƒ½ä¼šå‘ç”Ÿï¼Œå€’é€¼è‡ªå·±è®¾è®¡è¶³å¤Ÿå¥å£®çš„ç³»ç»Ÿã€‚ å°†ç»éªŒæ•™è®­æ²‰æ·€ä¸‹æ¥ å†å²æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œæˆ‘å»ºè®®ä½ æ€»ç»“å¹¶åˆ†æè¿‡å»å‘ç”Ÿè¿‡çš„äº‹æ•…ï¼Œå¹¶ç»“åˆå¸¸è§„åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§é£é™©ï¼Œä»¥æ­¤æ¢³ç†å‡ºä¸€ä¸ªå›´ç»•äº‹æ•…éšæ‚£çš„é£é™©ç‚¹ Checklistï¼Œåœ¨éœ€æ±‚è¿­ä»£æˆ–è€…æ¶æ„è®¾è®¡æ—¶ï¼Œé€šè¿‡å®ƒé«˜æ•ˆåœ°æ‰¾åˆ°ç³»ç»Ÿå®ç°çš„è–„å¼±ç¯èŠ‚ã€‚ é™¤äº†å®Œå–„ Checklistï¼Œåœ¨å›¢é˜Ÿæ™®åŠè¿™ç§è®¾è®¡ç†å¿µä¹‹å¤–ï¼Œæ›´å…³é”®çš„æ˜¯å°†è¿™äº›è§£å†³æ–¹æ¡ˆæ²‰æ·€æˆè®¾è®¡åŸåˆ™ï¼Œè®©ç ”å‘äººå‘˜å¯ä»¥åœ¨å®é™…ä¸­è½åœ°ã€‚ é€šè¿‡æ¼”ç»ƒéªŒè¯é¢„æ¡ˆè®¾è®¡ è®¾è®¡å¹¶å®ç°äº†è‡ªå·±çš„æ•…éšœæ¼”ç»ƒç³»ç»Ÿï¼Œæ—¥å¸¸ä¸»åŠ¨åˆ¶é€ äº‹æ•…ä¸Šä¸‹æ–‡æ¥éªŒè¯æˆ‘ä»¬çš„è®¾è®¡ä¸ç³»ç»Ÿæ˜¯å¦å¯é ã€‚ æŠŠç¨³å®šæ€§å½“ä½œæœºåˆ¶ä¸æ–‡åŒ–å»å»ºè®¾ç³»ç»Ÿç¨³å®šæ€§ç»“æœå¥½åå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæŠ€æœ¯ Leader çš„é‡è§†ç¨‹åº¦ï¼Œå¦‚æœä¸€ä¸ªå›¢é˜Ÿçš„ç®¡ç†è€…éƒ½ä¸èƒ½èº«ä½“åŠ›è¡Œçš„å»é‡è§†å®ƒï¼Œè€Œä»…ä»…åªæ˜¯å–Šå–Šå£å·ï¼Œé‚£å°±ä¸è¦æŒ‡æœ›å›¢é˜Ÿæˆå‘˜èƒ½è®¤çœŸåœ°å¯¹å¾…è¿™ä»¶äº‹ã€‚ æ–°äºº Landing ä»ç¨³å®šæ€§å­¦ä¹ å¼€å§‹ æ¯äººä¸ä½äº 35% çš„ç¨³å®šæ€§ KPI å¥½çš„åçš„éƒ½è¦åœ¨é˜³å…‰ä¹‹ä¸‹æ™’ä¸€æ™’ å»ºç«‹èµ„æŸæ¦‚å¿µçš„å®è§‚è®¤çŸ¥ä»å¹¿ä¹‰ä¸Šæ¥çœ‹ï¼Œå­˜åœ¨ç†è®ºæŸå¤±ä¹Ÿåº”è¯¥ç®—èµ„æŸï¼Œ æ¯”å¦‚å› ä¸ºæœç´¢æ¨èç³»ç»Ÿå‡ºé—®é¢˜ï¼ˆä¸è®ºä»€ä¹ˆåŸå› ï¼‰å¯¼è‡´è¿™ä¸€é˜¶æ®µå¹¿å‘Šçš„æ”¶å…¥å‡å°‘ï¼Œæˆ–è€…å› ç³»ç»Ÿ Bug å¯¼è‡´ç”¨æˆ·å–æ¶ˆè®¢å•çš„ç”³è¯·è¢«é»˜è®¤åŒæ„ï¼ˆè™½ç„¶åŸæœ¬å•†æˆ·å¯èƒ½ä¹Ÿä¼šåšåŒæ„å¤„ç†ï¼Œä½†æ˜¯ç”³è¯‰çš„è¯å¹³å°ä¾ç„¶è¦èµ”ä»˜ï¼‰ï¼Œç±»ä¼¼é¢„è®¡æ”¶ç›Šå‡å°‘æˆ–è€…å› ç³»ç»Ÿé—®é¢˜äº§ç”Ÿèµ”ä»˜çš„åœºæ™¯éƒ½åº”ç®—ä¸ºèµ„æŸã€‚ èµ„æŸé˜²æ§çš„ä¸‰ä¸ªå…³é”® é˜²ï¼šèµ„é‡‘è§†è§’åšé£é™©ç‚¹è¯†åˆ« ç›‘ï¼šä¸€è‡´æ€§ä¸æ­£ç¡®æ€§åŒæ ¸å¯¹ é’ˆå¯¹èµ„æŸæ„ŸçŸ¥çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåŸºäºçº¿ä¸Šä¸šåŠ¡ç»“æœæ”¶æ‹¢è¿›è¡Œç›‘æ§ï¼ŒåŸºäºçº¿ä¸‹ä¸šåŠ¡åœºæ™¯æ‰©æ•£è¿›è¡Œæ ¸å¯¹ã€‚ ä¸å¯ç”¨æ€§ç›‘æ§å›´ç»•æ¥å£çš„æŠ€æœ¯æŒ‡æ ‡ä¸åŒï¼Œèµ„æŸæ›´å…³æ³¨çš„æ˜¯æ•°æ®æ ¸å¯¹ï¼Œç›‘æ§çš„å¹¶ä¸æ˜¯è¿è¡ŒçŠ¶æ€è€Œæ˜¯è¿è¡Œç»“æœï¼Œå¹¶ä¸”èµ„æŸç›‘æ§çš„ç²’åº¦è¦æ±‚éå¸¸é«˜ï¼Œç²¾ç»†åˆ°æ¯ä¸€ç¬”äº¤æ˜“ã€æ¯ä¸€æ¬¡é‡‘é¢è®¡ç®—ã€æ¯ä¸€ä¸ªçº¢åŒ…å‘æ”¾ã€‚æ‰€ä»¥èµ„æŸç›‘æ§çš„æœ‰æ•ˆæ€§å¾ˆä¾èµ–äºåœºæ™¯çš„è¦†ç›–ç‡ï¼Œä»…è¦†ç›–å‡ ä¸ªå…³é”®åœºæ™¯æ˜¯ä¸è¶³ä»¥è§„é¿èµ„æŸé£é™©çš„ï¼Œé™¤äº†è¦å®šæœŸæ¢³ç†å¤–ï¼Œæ¯æ¬¡ç³»ç»Ÿæœ‰å˜æ›´æˆ–è€…æ–°åŠŸèƒ½æ—¶ï¼Œéƒ½éœ€æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ ¸å¯¹ç‚¹ï¼Œä»¥åŠæ—§æœ‰æ ¸å¯¹å…¬å¼æ˜¯å¦éœ€è¦è°ƒæ•´ã€‚ æ§ï¼šèµ„é‡‘æ‹¦æˆª + èµ„äº§æ§åˆ¶ é™¤äº†é˜²å’Œç›‘ï¼Œèµ„æŸé˜²æ§çš„å…³é”®ä¸»è¦åœ¨â€œæ§â€å­—ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é—®é¢˜å‘ç”Ÿåç¬¬ä¸€æ—¶é—´æ­¢æŸï¼Œè¿™å°±éœ€è¦æŠ€æœ¯åœ¨ç³»ç»Ÿå±‚é¢å¯¹èµ„é‡‘å’Œèµ„äº§æœ‰å¾ˆå¼ºçš„æ§åˆ¶èƒ½åŠ›ã€‚è¿™ç§èƒ½åŠ›çš„è¡¨ç°å°±æ˜¯ï¼š ä¸ä»…å¯ä»¥é€šè¿‡é¢„æ¡ˆå°†æŸäº›åœºæ™¯ä¸é“¾è·¯é™çº§ï¼Œè¿˜å¯ä»¥æ‹¦æˆªèµ„é‡‘çš„æµå‡ºå’Œèµ„äº§çš„ä½¿ç”¨ï¼ŒåŒæ—¶å…·å¤‡å¿«é€Ÿè®¢æ­£é”™è¯¯æ•°æ®çš„èƒ½åŠ›ã€‚ åœ¨æˆ‘ä»¬å¼€å§‹å¤„ç†èµ„æŸäº‹æ•…æ—¶ï¼Œä¼šæœ‰ä¸‰ä¸ªå…±æ€§çš„éœ€æ±‚ã€‚ é—®é¢˜æ­¢è¡€ä¸æ–°å¢ï¼šæ ¸å¿ƒæ˜¯å…³é—­é—®é¢˜äº§ç”Ÿæºå¤´ï¼Œå¾€å¾€é€šè¿‡ä¸šåŠ¡åœºæ™¯é™çº§æ¥å®ç°ï¼Œæ¯”å¦‚å¯¹é”™è¯¯çº¢åŒ…æˆ–è€…æ»¡å‡æ´»åŠ¨è¿›è¡Œä¸‹çº¿ã€‚ æ§åˆ¶èµ„é‡‘æµå‡ºï¼šæ ¸å¿ƒæ˜¯å¯¹èµ„é‡‘å’Œèµ„äº§è¿›è¡Œæ‹¦æˆªä¸å†»ç»“ï¼Œé¿å…å¤–æµåæŸå¤±æ— æ³•ä¿®æ­£ï¼Œæ¯”å¦‚ç¦æ­¢ç”¨æˆ·ä¸‹å•æ—¶å‹¾é€‰ä½¿ç”¨æœ‰é—®é¢˜çš„çº¢åŒ…ã€‚ å­˜é‡æ•°æ®è®¢æ­£ï¼šæ ¸å¿ƒæ˜¯æå–é—®é¢˜æ•°æ®åå¯ä»¥å¿«é€Ÿåœ°æ‰¹é‡å¤„ç†ï¼Œæ¯”å¦‚æ‰¹é‡æ›´æ”¹çº¢åŒ…çš„é‡‘é¢ã€ç”šè‡³ç›´æ¥å°†çº¢åŒ…æ— æ•ˆã€‚ è™½ç„¶å…¶ä¸­ä¸€äº›æ“ä½œå¯¹ç”¨æˆ·ä½“éªŒæ˜¯æœ‰æŸçš„ï¼Œä½†æœ‰è€Œä¸ç”¨æ˜¯ä¸€å›äº‹å„¿ï¼Œæ— èƒ½ä¸ºåŠ›åˆ™æ˜¯å¦å¤–ä¸€å›äº‹å„¿ï¼Œå…¶ä¸­ï¼š èµ„é‡‘æ‹¦æˆªçš„èƒ½åŠ›ä¸»è¦ä»èµ„é‡‘çš„æµå…¥å’Œæµå‡ºè¿™ä¸¤ç«¯è¿›è¡ŒæŠŠæ§ã€‚ä»¥çº¢åŒ…è€Œè¨€å°±æ˜¯ç®¡æ§å…¶åˆ›å»ºä¸æ ¸é”€ã€‚åœ¨çº¢åŒ…åˆ›å»ºæ—¶ï¼Œæœ‰é¢„ç®—ç³»ç»Ÿè¿›è¡Œç®¡æ§ï¼Œé¿å…æ— é™åˆ¶åœ°ç”Ÿæˆçº¢åŒ…è¿›è€Œè¶…å‘ã€‚åœ¨çº¢åŒ…æ ¸é”€æ—¶ï¼Œç”±äº¤æ˜“å’Œè¥é”€ç³»ç»Ÿè¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿è®¢å•ä¸Šä¸‹æ–‡ä»¥åŠçº¢åŒ…åˆæ³•ï¼Œé¿å…é—®é¢˜çº¢åŒ…è¢«æ ¸é”€è¿›è€Œé€ æˆæ— æ³•æŒ½å›çš„èµ„æŸã€‚ èµ„äº§ç®¡æ§çš„èƒ½åŠ›åˆ™æ˜¯èµ„äº§çš„å¿«é€Ÿé”å®šå’Œæ•°æ®è®¢æ­£å±•å¼€ï¼Œä»¥çº¢åŒ…è€Œè¨€ï¼Œå¦‚æœä¸åŒæ¨¡ç‰ˆä¸åŒæ´»åŠ¨çš„çº¢åŒ…éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ‰¹æ¬¡å·ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è®°å¿«é€Ÿæå–æŸä¸€æ‰¹æœ‰é—®é¢˜çš„æ•°æ®ã€‚åŒæ—¶å¦‚æœæå‰å‡†å¤‡æ‰¹é‡è®¢æ­£çš„è„šæœ¬ï¼Œæˆ–è€…æœ‰è®¢æ­£æ•°æ®çš„å¹³å°ï¼Œå°±å¯ä»¥å¿«é€Ÿä¿®æ”¹çº¢åŒ…é‡‘é¢ã€ä½¿ç”¨æ—¶é—´ã€ä½¿ç”¨é—¨æ§›ç­‰å…³é”®ä¿¡æ¯ï¼Œç”šè‡³æ‰¹é‡æ— æ•ˆæ‰€æœ‰é—®é¢˜çº¢åŒ…ã€‚ ä½ éœ€è¦æ³¨æ„ï¼Œè¿™äº›èƒ½åŠ›çš„å®ç°æ›´å¤šä¾èµ–äºæŠ€æœ¯ Leader åœ¨æ—¥å¸¸éœ€æ±‚è¿­ä»£å’Œæ¶æ„è®¾è®¡æ—¶ï¼Œæ˜¯å¦æœ‰æ„è¯†å¼•å¯¼å›¢é˜ŸåŠ å¼ºè¿™æ–¹é¢çš„å»ºè®¾ã€‚å¤§éƒ¨åˆ†çš„é¢„æ¡ˆæ€è·¯æ¥æºäºè¿‡å»å·²ç»å‘ç”Ÿçš„é—®é¢˜ï¼Œæˆ–è€…å¯¹æœªæ¥å¯èƒ½å‘ç”Ÿé—®é¢˜çš„å‡è®¾ï¼Œå°†é¢„æ¡ˆå¸¸æ€åŒ–æ˜¯ä½ é‡ç‚¹å…³æ³¨å¹¶æ¨è¿›è½åœ°çš„ã€‚ é™¤äº†å»ºè®¾é¢„æ¡ˆï¼Œè¿˜è¦æœ‰é¢„æ¡ˆæ¼”ç»ƒï¼Œä»¥æ­¤ä¿è¯é¢„æ¡ˆçš„æœ‰æ•ˆæ€§ã€‚æŠ€æœ¯ Leader æ›´åº”è¯¥é¼“åŠ±æµ‹è¯•å’Œå¼€å‘çš„åŒå­¦ä¸»åŠ¨åšæ”»é˜²æ¼”ç»ƒï¼Œå¯»æ‰¾æ¼æ´ã€éªŒè¯æ­¢æŸæ–¹æ¡ˆã€åŠæ—¶å‘ç°å¹¶ä¿®å¤é—®é¢˜ã€‚ æŠ€æœ¯å€ºåŠ¡æŠ€æœ¯å€ºåŠ¡åœ¨ç ”å‘é¢†åŸŸç±»ä¼¼äºâ€œé‡‘èå€ºåŠ¡â€çš„æ¦‚å¿µï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯è¯´å› ä¸ºäººä¸ºå¦¥åï¼Œç³»ç»Ÿçš„è®¾è®¡å’Œå®ç°æ²¡æœ‰éµå¾ªæœ€ä½³å®è·µï¼Œæ‰€ä»¥è™½ç„¶çŸ­æœŸåšåˆ°äº†å¿«é€Ÿäº¤ä»˜ï¼Œä½†ä¹Ÿåˆ¶çº¦äº†ç³»ç»Ÿæœªæ¥çš„å¯æ‰©å±•æ€§ï¼Œå¹¶ä¸”åŸ‹ä¸‹äº†ç¨³å®šæ€§çš„é£é™©éšæ‚£ã€‚ é‡è§†æŠ€æœ¯å€ºåŠ¡çš„åŸå›  å½±å“ç³»ç»Ÿæ‰©å±•å’Œéœ€æ±‚äº¤ä»˜ æ¶æ€§å¾ªç¯å¯¼è‡´äººå‘˜æµå¤± æŠ€æœ¯å€ºåŠ¡çš„æ¶æ€§å¾ªç¯ä¼šå½±å“å¼€å‘å›¢é˜Ÿçš„ç”Ÿäº§åŠ›ï¼Œå¹¶é™ä½å›¢é˜Ÿçš„å£«æ°”å’Œæˆå‘˜çš„é©±åŠ¨åŠ›ï¼Œè€Œä½ç”Ÿäº§ç‡å¯¼è‡´å›¢é˜Ÿåªèƒ½ä¼˜å…ˆäº¤ä»˜åŠŸèƒ½ï¼Œè¿™å°±æ¨è¿Ÿäº†æŠ€æœ¯å€ºåŠ¡çš„è§£å†³ï¼Œä»è€Œè¿›ä¸€æ­¥å¢åŠ æŠ€æœ¯å€ºåŠ¡ã€‚ å¦‚ä½•ä»å¾ªç¯çš„å€ºåŠ¡å›°å¢ƒä¸­çªå›´è€Œå‡ºï¼Ÿ1.å€ºåŠ¡çš„ Owner æ˜¯æŠ€æœ¯ Leader è¦æƒ³è§£å†³æŠ€æœ¯å€ºåŠ¡ï¼Œä½ éœ€è¦æ‰¾åˆ°æŠ€æœ¯ä¸ä¸šåŠ¡çš„å¹³è¡¡ç‚¹ï¼Œæˆ‘çš„ç»éªŒæ˜¯â€œå†…å¤–åŒä¿®â€ï¼š å†…ï¼šåŠ å¼ºå›¢é˜Ÿçš„æˆ˜æ–—åŠ›ï¼Œå‡å°‘å€ºåŠ¡äº§ç”Ÿçš„æœºä¼šï¼Œå¢å¼ºå€ºåŠ¡å¤„ç†çš„èƒ½åŠ›ã€‚ å¤–ï¼šæ·±åˆ»åœ°ç†è§£ä¸šåŠ¡ï¼Œå¹¶ä¸”åšå¥½ä¸å…¶ä»–åä½œæ–¹ï¼ˆå°¤å…¶æ˜¯äº§å“ã€ä¸šåŠ¡ï¼‰çš„æ²Ÿé€šã€‚è¿™æ ·ä½ æ‰èƒ½ç†è§£åä½œæ–¹æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä»–ä»¬ä»¥ä¸ºè¦ä¹ˆAã€è¦ä¹ˆBæ‰èƒ½è§£å†³çš„é—®é¢˜ï¼Œæ—¢æ‡‚æŠ€æœ¯åˆæ‡‚ä¸šåŠ¡çš„ä½ èƒ½å¦æ‰¾åˆ°æ–¹æ¡ˆCï¼Ÿ å»ºè®®ï¼šé¢å¯¹é€‰æ‹©é¢˜æ—¶ä¸è¦åªçœ‹åˆ°å¯é€‰é¡¹ï¼Œè¦æ°¸è¿œå¯»æ‰¾ç¬¬ä¸‰æ¡è·¯ã€‚å¦‚æœå®åœ¨æ²¡æœ‰å…¶ä»–é€‰æ‹©ï¼Œåœ¨æŠ€æœ¯å¦¥åçš„åŒæ—¶ï¼Œåšå¥½æ²Ÿé€šï¼Œè®©åä½œæ–¹æ˜ç™½æ–¹æ¡ˆçš„ä¸´æ—¶æ€§ä»¥åŠå¯¹æœªæ¥çš„å½±å“ï¼Œäº‰å–åˆ°æ‰¿è¯ºåœ¨æœªæ¥ç»™ä½ è¶³å¤Ÿæ—¶é—´è§£å†³è¿™äº›é—®é¢˜ã€‚ é€šè¿‡ CheckList è¯†åˆ«å€ºåŠ¡ å»ºç«‹ä¸€ä¸ªå€ºåŠ¡ Review çš„ CheckList ï¼Œå¹¶ä¸”ä¸æ–­å®Œå–„ã€‚æŠ€æœ¯å€ºåŠ¡ä»è¡¨è±¡ä¸Šå¯ä»¥åšä¸€äº›ç»†åˆ†ï¼š é€šè¿‡ç°è±¡æˆ‘ä»¬å°±å¯ä»¥åæ¨å‡ºä¸€äº›å¯¼è‡´ç°è±¡çš„åŸå› ï¼Œå°†è¿™äº›åŸå› ç»“åˆç³»ç»Ÿçš„æ¶æ„è¿›è¡Œåˆ†ç±»ï¼Œå°±ä¼šå½¢æˆä¸€ä¸ªä¸ªå…·ä½“çš„å…³æ³¨ç‚¹ã€‚è¿™äº›å…³æ³¨ç‚¹å¾€å¾€æ˜¯ç»“åˆæˆ‘ä»¬ä¹‹å‰è¸©è¿‡çš„å‘ã€å‘ç”Ÿè¿‡çš„é—®é¢˜ï¼Œä»¥åŠç¼–ç ã€æ¶æ„ä¸Šå¹¿ä¸ºéµå®ˆçš„ä¸€äº›æœ€ä½³å®è·µæ‰€å½¢æˆçš„ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åˆ¶å®šå‡ºä¸€ä¸ªè¾ƒä¸ºè¯¦ç»†çš„ CheckList ç”¨ä»¥å…·ä½“çš„å€ºåŠ¡è¯†åˆ«ï¼ˆä¸‹å›¾ä¾›å‚è€ƒï¼‰ã€‚ æœ‰è®¡åˆ’åœ°åˆ†çº§å¿å€º å…³é”®é“¾è·¯ä¼˜å…ˆï¼š å¹¶éæ‰€æœ‰ç³Ÿç³•çš„è®¾è®¡ä¸å®ç°éƒ½èƒ½äº§ç”Ÿä¸¥é‡åæœï¼Œå³ä½¿èƒ½ï¼Œå®ƒä»¬å‘ç”Ÿçš„æ¦‚ç‡ä¹Ÿä¸ä¸€æ ·ï¼Œè€Œå…³é”®é“¾è·¯æ„å‘³ç€ä¸šåŠ¡å½±å“æœ€å¤§ï¼ŒåŒæ—¶æ—¥å¸¸çš„æ”¹åŠ¨é¢‘ç‡å’Œäº‹æ•…é£é™©ä¹Ÿè¾ƒé«˜ï¼Œä¼˜å…ˆè§£å†³å®ƒçš„æ”¶ç›Šæ˜¯æœ€å¤§çš„ã€‚ å†å²äº‹æ•…å‘½ä¸­ä¼˜å…ˆï¼š ä¸€äº›è®¾è®¡ä¸å®ç°åœ¨è¿‡å¾€å¯¼è‡´è¿‡çº¿ä¸ŠçœŸå®é—®é¢˜çš„å‘ç”Ÿï¼Œä¸ç®¡æ˜¯å¦å‘ç”Ÿåœ¨æœ¬ç³»ç»Ÿè¿˜æ˜¯å½“å‰å›¢é˜Ÿï¼Œéƒ½ç›¸å½“äºå·²ç»è¢«è¯å®è¿‡çš„è¿™ç±»å€ºåŠ¡çš„ä¸¥é‡æ€§ï¼Œæ‰€ä»¥åº”è¯¥å°½æ—©ä¿®å¤å®ƒä»¬ï¼Œé¿å…ç±»ä¼¼é—®é¢˜åå¤å‘ç”Ÿã€‚ å¯æ‰©å±•æ€§ä¼˜å…ˆï¼š åœ¨ CheckList ä»¥åŠå€ºåŠ¡ç°è±¡ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ‰äº›é—®é¢˜å½±å“äº†ç³»ç»Ÿæœªæ¥çš„æ¼”è¿›ï¼Œå¢åŠ äº†è¿­ä»£æˆæœ¬ï¼Œæœ‰äº›é—®é¢˜å½±å“ç³»ç»Ÿçš„ç»´æŠ¤ï¼Œæ¯”å¦‚ä»£ç é£æ ¼æ²¡æœ‰ç»Ÿä¸€ã€ç¼ºå°‘æ–‡æ¡£ï¼Œåœ¨å¤„ç†æ—¶åº”è¯¥ä¼˜å…ˆå¤„ç†å½±å“å¯æ‰©å±•æ€§çš„é—®é¢˜ï¼Œåç»­é€æ­¥å¤„ç†å½±å“å¯ç»´æŠ¤æ€§çš„é—®é¢˜ã€‚ æƒè´£æ¸…æ™°ä¼˜å…ˆï¼š ä¸€äº›é—®é¢˜åœ¨å¤„ç†æ—¶å—åˆ°å†å²æ¶æ„ã€ç»„ç»‡åˆ†å·¥ï¼ˆåº·å¨å®šå¾‹ï¼‰çš„å½±å“ï¼Œä¼šå¯¼è‡´ç³»ç»Ÿçš„æƒè´£ä¸æ¸…æ™°ï¼Œè¿™ç±»ç³»ç»Ÿçš„æ¨è¿›å’Œæ”¹é€ å¾€å¾€éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ç²¾åŠ›ï¼Œå¹¶ä¸”ä»é¡¶å±‚è®¾è®¡å‡ºå‘å»é‡æ–°è€ƒé‡ï¼Œæ‰€ä»¥æƒè´£æ¸…æ™°çš„éƒ¨åˆ†å¯ä»¥ä¼˜å…ˆå¤„ç†ã€‚ æ€»çš„æ¥è¯´ï¼Œé€šè¿‡å¯¹æŠ€æœ¯å€ºåŠ¡è¿›è¡Œåˆ†çº§ï¼Œå®è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜åˆ†æ²»çš„è¿‡ç¨‹ï¼Œå°†å¤§é—®é¢˜åˆ‡åˆ†æˆä¸€ä¸ªä¸ªå°é—®é¢˜ï¼Œè¿™æ ·å°±å¯ä»¥å°†å®ƒä»¬åŠ å…¥æ—¥å¸¸çš„è¿­ä»£ä¸­ï¼Œå½¢æˆä¸€ä¸ªåˆ†æœŸå¿è¿˜æŠ€æœ¯å€ºåŠ¡çš„è®¡åˆ’ï¼Œé€æ­¥å‡å°‘æŠ€æœ¯å€ºåŠ¡ï¼Œå‡è½»è´Ÿæ‹…è®©å›¢é˜Ÿä¸ç³»ç»Ÿå¯ä»¥è½»è£…ä¸Šé˜µã€‚ æ­£è§†å€ºåŠ¡åšå¥½é¢„é˜² é™¤æ­¤ä¹‹å¤–ï¼Œé¢„é˜²æ°¸è¿œèƒœäºæ²»ç–—ï¼ŒæŠ€æœ¯å€ºåŠ¡æ±‡æ€»é¢„é˜²çš„å…³é”®ç‚¹åœ¨äºé‚£äº›â€œåŸæœ¬æœªçŸ¥â€çš„æŠ€æœ¯å€ºåŠ¡è¦é€æ¸å‡å°‘ï¼Œå¤§å®¶å¯¹äºå®ç°è´¨é‡çš„è¿½æ±‚ä¸èƒ½æ­¢æ­¥äºâ€œæµ‹è¯•æ²¡æœ‰æ˜æ˜¾ Bugâ€ï¼Œå†™å‡ºèƒ½è¿è¡Œçš„ä»£ç æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜è¦æ˜“ç»´æŠ¤æ˜“æ‰©å±•ã€‚ å¯ä»¥ä»å‡ ä¸ªæ–¹é¢ç€æ‰‹ï¼š æå‡å›¢é˜Ÿè®¤è¯†ï¼Œé€šè¿‡é¡¹ç›®å¤ç›˜ã€ç³»ç»Ÿé‡æ„ã€äº‹æ•… Review ç­‰å„ç§æœºä¼šï¼Œé€šè¿‡å®é™…çš„æ¡ˆä¾‹è®©ç ”å‘åŒå­¦æ¸…æ¥šæŠ€æœ¯å€ºåŠ¡å¯¹å›¢é˜Ÿäº§ç”Ÿçš„è´Ÿæ‹…ï¼Œä»¥åŠå¯¹ä¸ªäººèƒ½åŠ›æå‡çš„å½±å“ã€‚ å»ºç«‹æœºåˆ¶æµç¨‹ï¼Œæ¯”å¦‚åœ¨æ–¹æ¡ˆè®¾è®¡é˜¶æ®µå‘ä¸‹æ·±æŒ–ä¸€ä¸‹å®ç°çš„è¦ç‚¹ï¼Œæ›´å¤šèµ„æ·±çš„å¼€å‘å‚ä¸åˆ°æ¶æ„è¯„å®¡ï¼Œæˆ–è€…ä¿ƒè¿›å›¢é˜Ÿå½¢æˆ code review çš„ä¹ æƒ¯å¹¶ä¸”è¾¾æˆä¸€ä¸ªå…±è¯†æ ‡å‡†ä»¥æå‡ç³»ç»Ÿè´¨é‡ã€‚ ç¡®ä¿èµ„æºæŠ•å…¥ï¼Œåœ¨é€šè¿‡å€ºåŠ¡è¯†åˆ«å’Œåˆ†çº§åï¼Œå°†è¿˜å€ºçš„æŠ•å…¥æå‰è®¡ç®—åˆ°æ¯æ¬¡è¿­ä»£ä¸­ï¼Œç¡®ä¿æœ‰ä¸€å®šçš„èµ„æºæŠ•å…¥å…¶ä¸­ã€‚ ä¸€äº›å¸¸è§çš„è¯¯åŒº é€šè¿‡ CheckList åšå€ºåŠ¡è¯†åˆ«ï¼Œç„¶åå®šæœŸè¯Šæ–­ã€æ°´å¹³æ‰«æã€å€ºåŠ¡å®šçº§ã€åˆ†æœŸå¿è¿˜æ¥åšæŠ€æœ¯å€ºåŠ¡çš„å¤„ç†ï¼Œæœ€ç»ˆåœ¨å›¢é˜Ÿè®¤è¯†ã€æœºåˆ¶æ°›å›´ã€èµ„æºä¿éšœä¸Šä¸‹åŠŸå¤«åšé¢„é˜²ï¼Œè¿™å°±æ˜¯æŠ€æœ¯å€ºåŠ¡ç®¡ç†çš„æ ¸å¿ƒæ€è·¯ã€‚ è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›é—®é¢˜æ˜¯æ—¥å¸¸ä½ å¾ˆå®¹æ˜“èµ°å…¥è¯¯åŒºçš„ï¼Œæˆ‘ç®€å•æ€»ç»“äº†ä¸€ä¸‹å‡ ä¸ªæ³¨æ„ç‚¹ï¼š å­˜åœ¨å³åˆç†ï¼ŒåŠ¨æ€å˜åŒ–æ‰æ˜¯ç‹é“ã€‚ ä¸è¦æ€»æƒ³ç€æ¯•å…¶åŠŸäºä¸€å½¹ï¼Œä¹Ÿå‡ ä¹ä¸å¤ªå¯èƒ½æœ‰å®Œç¾çš„å®ç°æˆ–ç³»ç»Ÿï¼Œæ¥å—æŠ€æœ¯å€ºåŠ¡ä¸€å®šä¼šå­˜åœ¨çš„äº‹å®ï¼Œé‡ç‚¹åœ¨äºæ§åˆ¶å€ºåŠ¡ç§¯å‹çš„ç¨‹åº¦ï¼Œæ¬ å€ºæœ¬èº«ä¸å¯æ€•ï¼Œæ¬ å€ºä¸çŸ¥ä¸”ä¸è¿˜æ‰å¯æ€•ã€‚ ä¸ç§¯è·¬æ­¥æ— ä»¥è‡³åƒé‡Œã€‚æˆ‘ä»¬å¾€å¾€è¿‡åº¦è½»è§†æ—¥å¸¸ç§¯ç´¯ï¼Œåˆè¿‡åº¦é‡è§†â€œå¤§äº‹ä»¶â€äº§ç”Ÿçš„å½±å“ã€‚æ—¥å¸¸è¿™é‡Œå‡‘åˆä¸€ä¸‹ï¼Œé‚£é‡Œå¦¥åä¸€ç‚¹ï¼Œæ²¡äººå…³æ³¨å°é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚è€Œä¸€æ—¦å‘ç”Ÿé‡å¤§çš„å½±å“ï¼Œåˆ™æ¨ä¸å¾—æŠŠä¹‹å‰çš„ç³»ç»Ÿå…¨ç›˜æ¨ç¿»é‡åšä¸€éã€‚ æœºåˆ¶æµç¨‹å¤–è¿˜è¦è®²ç­–ç•¥å’Œæ–¹æ³•ã€‚å¾ˆå¤šæŠ€æœ¯ Leader è§‰å¾—è¿™ä»¶äº‹å¾ˆé‡è¦ï¼Œè®²çš„åŒæ—¶è®¾è®¡äº†å¾ˆå¤šæµç¨‹å’Œæœºåˆ¶ï¼Œä¸éµå®ˆå°±è¦æ‰¿æ‹…æ€æ ·æ€æ ·çš„åæœï¼Œè¿™æ ·å¾€å¾€äº‹åŠåŠŸå€ã€‚æœºåˆ¶æµç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œä¹Ÿä¸èƒ½å…‰æœ‰æƒ©ç½šè€Œæ²¡æœ‰æ¿€åŠ±ï¼ŒåŒæ—¶æœ€é‡è¦çš„æ˜¯ä½ ä¸èƒ½åªè¿½æ€è¦ç»“æœï¼Œè¦ç»™å¸®åŠ©ã€ç»™æ–¹æ³•ã€ç»™æ”¯æŒã€‚ å¤§é¡¹ç›®ï¼šæŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨è®¤æ¸…å¼‚åŒï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•° åœ¨è¿™ä¸ªå¸¸è§„æµç¨‹ä¸­ï¼ŒæŠ€æœ¯å›¢é˜Ÿçš„é‡å¿ƒæ˜¯æŠŠæ‰§è¡Œåšåˆ°ä½ï¼Œä½ è¦æ›´å…³æ³¨è¿‡ç¨‹ç®¡æ§ï¼Œç¡®ä¿ç³»ç»Ÿäº¤ä»˜ã€‚ å¤§é¡¹ç›®ä¸å¸¸è§„é¡¹ç›®çš„æ ¸å¿ƒå·®å¼‚ç‚¹ï¼Œæˆ‘è®¤ä¸ºä¸»è¦åœ¨äºè¿™ä¸ªâ€œå¤§â€å­—ä¸Šï¼Œä½ å¯ä»¥ä»ä¸‰ä¸ªæ–¹é¢å»ç†è§£ã€‚ å‡ºå‘ç‚¹ä¸åŒï¼Œä¸šåŠ¡æœŸæœ›æ›´å¤§ è§„æ¨¡ä¸åŒï¼Œå¤æ‚åº¦æ›´é«˜ ç»“æœè¯„åˆ¤æ ‡å‡†ä¸åŒï¼Œå½±å“æ›´å¤§ æŠŠæ¡å…³é”®ç‚¹ï¼Œè°‹å®šè€ŒååŠ¨ å…³æ³¨æ•ˆæœæ›´é‡äºå…³æ³¨äº¤ä»˜ï¼Œè¿™æ˜¯å¤§é¡¹ç›®çš„æ ¸å¿ƒç‰¹å¾ã€‚ ä¸è¦ä¸ºäº†é‡æ„è€Œé‡æ„ï¼Œè¦çŸ¥é“ä½ è¦çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚ å¤§é¡¹ç›®çš„å¤±è´¥å­˜åœ¨ä¸€ä¸ªå…±æ€§çš„é—®é¢˜ï¼šå›´ç»•ä¸šåŠ¡ç»“æœçš„æ€è€ƒã€è®¡åˆ’ä¸è¶³ï¼Œç›®æ ‡çš„å®šä¹‰ä¸æ¸…æ™°æˆ–æ²¡æœ‰å……åˆ†åŒæ­¥ç»™æ‰€æœ‰ç›¸å…³äººï¼Œé¡¹ç›®åŒå­¦çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚è¿ç›®æ ‡éƒ½æ²¡æœ‰å…±è¯†ï¼Œä½•è°ˆæ‰§è¡Œåˆ°ä½ï¼Œé¡¹ç›®æˆåŠŸï¼Ÿ æ‰€ä»¥æˆ‘è®¤ä¸ºè¶Šæ˜¯é‡å¤§çš„é¡¹ç›®ï¼Œåœ¨è®¡åˆ’ã€è®¾è®¡ã€å‡†å¤‡ä¸ŠæŠ•å…¥çš„ç²¾åŠ›å°±åº”è¯¥è¶Šå¤šï¼Œè°‹å®šè€ŒååŠ¨ã€‚ WHYï¼ˆé¡¹ç›®ä¸ºä»€ä¹ˆåšï¼‰ WHATï¼ˆé¡¹ç›®åšæˆä»€ä¹ˆæ ·ï¼‰ WHOï¼ˆå“ªäº›äººæ¥ä¸€èµ·åšé¡¹ç›®ï¼‰ HOWï¼ˆå¯åŠ¨é¡¹ç›®åå¦‚ä½•åšï¼‰ åˆç†æ‹†åˆ†ä»»åŠ¡ï¼ˆæ¨¡å—ï¼‰æ˜¯é¡¹ç›®æˆåŠŸçš„ä¸€åŠ ä¿æŒé£é™©æ„è¯†ï¼Œæ•¬ç•å¢¨è²å®šå¾‹ åšå¥½å……åˆ†çš„å‡†å¤‡ä¹‹åï¼Œå¯ä»¥å¬å¼€ç«‹é¡¹ä¼šï¼Œå°† WHYã€WHATã€WHOã€HOW çš„ä¿¡æ¯ä¸æ€è€ƒåŒæ­¥ç»™é¡¹ç›®ç›¸å…³äººå‘˜ã€‚é€šè¿‡ Kick Off ä¼šè®®ç¡®å®šé¡¹ç›®çš„åŸºè°ƒã€åŒæ­¥å¿…è¦ä¿¡æ¯ï¼Œä¸ºé¡¹ç›®æ¨è¿›æ‰«æ¸…éšœç¢ã€‚ å¦‚ä½•å¤„ç†æ£˜æ‰‹é—®é¢˜é—®é¢˜ä¸€ï¼šç¼ºå…µå°‘å°†æ€ä¹ˆåŠï¼Ÿé¡¹ç›®ç»„äººæ—¶ä½ è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚ å½“é¡¹ç›®å¼€å§‹æ—¶ï¼Œä»æ›´å¤§çš„èŒƒå›´å†…å¯»æ‰¾åˆé€‚çš„åŒå­¦ï¼Œè€Œä¸æ˜¯çœ‹ä½ å›¢é˜Ÿæœ‰å“ªäº›äººã€‚ å°†å‚ä¸é¡¹ç›®çš„åŒå­¦åœ¨ä¸€å®šæ—¶é—´å†…çš„æ±‡æŠ¥å…³ç³»å’Œç»©æ•ˆè€ƒæ ¸æ±‡æ€»åˆ°é¡¹ç›®ç»„ä¸­ï¼Œç”±é¡¹ç›®è´Ÿè´£äººæ ¹æ®å®é™…æƒ…å†µé‡æ–°å®‰æ’æ¯ä¸ªäººçš„æƒè´£ï¼Œå¹¶ç¡®å®šç»©æ•ˆçš„ç»‘å®šå…³ç³»ä¸æ¯”ä¾‹ã€‚ é¡¹ç›®äº¤ä»˜å¹¶ä¸ç­‰äºç»“æŸï¼Œæ‰€æœ‰äººçš„ç»©æ•ˆç»“æœéƒ½åº”å’Œé¡¹ç›®ç›®æ ‡çš„è¾¾æˆæƒ…å†µç´§å¯†ä¸”é•¿æœŸå…³è”ã€‚ æœ€åï¼Œæœ‰æ—¶ä¸ä»…è¦è§£å†³â€œç¼ºå…µâ€çš„é—®é¢˜ï¼Œè¿˜è¦è®¤çœŸè€ƒè™‘æ˜¯å¦â€œå°‘å°†â€ï¼Ÿè¦å……åˆ†è€ƒè™‘å½“å‰çš„äººå‘˜æ˜¯å¦é€‚åˆåšé¡¹ç›®çš„ Ownerï¼Œä»¥æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œé¡¹ç›® Owner å‡ ä¹å†³å®šäº†é¡¹ç›®æˆè´¥çš„ 80%ï¼Œå¦‚æœ Owner èƒ½åŠ›ä¸è¶³ï¼Œä½ è¦ç»™äºˆå¸®åŠ©å’Œæ”¯æŒï¼Œæˆ–è€…å¦æ‰¾ä»–äººï¼Œä¹ƒè‡³ä¸Šçº§çš„å¸®åŠ©ï¼Œä¸è¦åœ¨ Owner çš„äººé€‰ä¸Šå¦¥åï¼Œæ¯•ç«Ÿé¡¹ç›®æˆè´¥æ‰æ˜¯å…³é”®ã€‚ é—®é¢˜äºŒï¼šæ¨ä¸åŠ¨çš„åˆ°åº•æ˜¯äººè¿˜æ˜¯äº‹ï¼Ÿ ææ˜ç™½å†²çªç°è±¡ä¸‹çš„åˆ©ç›Šè¯‰æ±‚ï¼š ä¸åŒå…³è”æ–¹äº§ç”Ÿè§‚ç‚¹å†²çªçš„ç°è±¡èƒŒåå…¶å®æ˜¯åˆ©ç›Šå†²çªï¼Œä½ è¦ææ¸…æ¥šå½¼æ­¤çš„é¡¾è™‘ã€‚æ¯”å¦‚æˆ‘ä¸æ„¿æƒ³è®©æŸä¸ªç³»ç»Ÿå­—æ®µè½åˆ°è®¢å•ä¸­ï¼Œä¸»è¦æ˜¯è€ƒè™‘åˆ°è®¢å•ç³»ç»Ÿçš„å¯ç»´æŠ¤ä»¥åŠç¨³å®šæ€§ï¼Œå¦‚æœä½ èƒ½è§£å†³æˆ‘çš„é¡¾è™‘ï¼Œä¼šå®¹æ˜“è¯´æœæˆ‘ã€‚ ä¸ºé¡¹ç›®ç»“æœé€‚å½“å¦¥åï¼š åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•åšå‡ºå®Œç¾çš„æ–¹æ¡ˆï¼Œå¯èƒ½å°±æ˜¯è¦åœ¨ç³»ç»Ÿå†…é€šè¿‡å¾ˆç³Ÿç³•çš„å®ç°å»å®ç°éœ€æ±‚ã€‚é¡¹ç›®æ²¡æœ‰ 100% å®Œç¾ï¼ŒæŠ“ä½æ ¸å¿ƒåŸåˆ™ä¸æ”¾å¼ƒï¼Œå¯æ§éƒ¨åˆ†é€‚å½“å¦¥åæ¢å–é¡¹ç›®å‰è¿›æ˜¯å¾ˆå¥½çš„ç­–ç•¥ã€‚ é€šè¿‡é¡¹ç›®åœ°ä½å’Œå†³ç­–æœºåˆ¶æ¨åŠ¨é¡¹ç›®ï¼š å¤§é¡¹ç›®å¾€å¾€æ˜¯å…¬å¸é‡å¤§æˆ˜ç•¥ä¸‹çš„äº§ç‰©ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šæœ‰äººå»åå¯¹å…¬å¸çš„æŸé¡¹æ—¢å®šæˆ˜ç•¥ï¼Œè€Œä½ å¯ä»¥é€šè¿‡å¤§é¡¹ç›®çš„é‡è¦æ€§åœ¨ä½“ç³»å†…äº‰å–æ›´å¤šçš„èµ„æºå’Œå¸®åŠ©ã€‚å¦‚æœä½ é¢ä¸´ä¸€äº›å†²çªï¼Œè¦å­¦ä¼šåˆ©ç”¨å†³ç­–æœºåˆ¶ï¼Œé€šè¿‡æ›´é«˜çº§åˆ«æˆå‘˜çš„æ²Ÿé€šå†³ç­–æ‹¿åˆ°è§£å†³æ–¹æ¡ˆã€‚ é—®é¢˜ä¸‰ï¼šä¸€å®šä¼šæœ‰é¡¹ç›®å˜æ›´å—ï¼Ÿå¸¸è§çš„å˜åŒ–å¾€å¾€æœ‰ä¸¤ç§ï¼š é¡¹ç›®æ¼”è¿›è¿‡ç¨‹ä¸­è¯†åˆ«å‡ºä¹‹å‰æœªèƒ½è¯†åˆ«æˆ–è€ƒè™‘ç¼ºå¤±çš„ç‚¹ï¼Œå¯¼è‡´æ–¹æ¡ˆéœ€è¦è°ƒæ•´ã€‚ å‡ºè‡ªè€æ¿çš„éœ€æ±‚å˜æ›´ï¼Œå¾ˆå¤šæƒ…å†µä¸‹éƒ½æ˜¯è¦æ–°å¢å†…å®¹ã€‚ 3ä¸ªé‡ç‚¹ é©¾é©­å¤§é¡¹ç›®æ˜¯ä½ çš„è¯•é‡‘çŸ³å’Œåˆ†æ°´å²­ï¼Œå¯¹è‡ªå·±èŒä¸šè§„åˆ’æœ‰ä¸€å®šè¦æ±‚çš„åŒå­¦ä¸€å®šä¸è¦æ”¾è¿‡æ‰“ç£¨ä¿®ç‚¼çš„æœºä¼šã€‚ åœ¨å¤§é¡¹ç›®ä¸­ï¼Œå¾€å¾€äººçš„é—®é¢˜ä¼šæ¯”æŠ€æœ¯ä¸ç³»ç»Ÿçš„é—®é¢˜éš¾è§£å†³ï¼Œå› ä¸ºä¸äººç›¸å…³çš„é—®é¢˜æœªå¿…å®Œå…¨ç†æ€§å’Œé€»è¾‘ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ ä¹Ÿä¸å¦¨çœ‹çœ‹æ„Ÿæ€§çš„æ²Ÿé€šä¸äº¤æµæ˜¯ä¸æ˜¯æœ‰æ›´å¥½çš„æ•ˆæœã€‚ æ—¶åˆ»ç‰¢è®°ä½ å°†é¡¹ç›®æŒ‰æ—¶ä¸Šçº¿æ²¡æœ‰æ•…éšœåªæ˜¯åšåˆ°äº†60åˆ†ï¼Œæ›´å…³é”®çš„æ˜¯ä¸šåŠ¡æ•ˆæœï¼Œæ‰€ä»¥é™¤äº†ç›¯ç´§å¼€å‘è¿‡ç¨‹å¤–ï¼Œè¿˜è¦åœ¨æœ€å¼€å§‹çš„ä¸šåŠ¡ä¸äº§å“è®¾è®¡é˜¶æ®µå°±æŠ•èº«å…¶ä¸­ã€‚ ä¸šåŠ¡ç†è§£ï¼šæ·±å…¥ä¸šåŠ¡æ˜¯åšå¥½æ¶æ„çš„å‰æä¸ºä»€ä¹ˆæŠ€æœ¯è¦ç†è§£ä¸šåŠ¡ï¼Ÿäº§å“éœ€æ±‚ä¸ç­‰äºä¸šåŠ¡è¯‰æ±‚åŒæ ·çš„ï¼ŒæŠ€æœ¯ Leader å¯èƒ½ä¼šèŠ±æ—¶é—´å‚åŠ å„ç§ä¼šè®®ï¼Œå°¤å…¶æ˜¯äº§å“éœ€æ±‚çš„ä¼šï¼Œåœ¨ä¼šä¸Šå¦‚æœä»…ä»…æ˜¯å¬â€œè‡ªå·±å›¢é˜Ÿåº”è¯¥åšä»€ä¹ˆâ€ï¼Œè€Œæ²¡æœ‰æ€è€ƒå’Œæ¢ç©¶ä¸šåŠ¡çš„æ ¹æœ¬è¯‰æ±‚ï¼Œé‚£ä¹ˆå°±æˆ‘çš„ç»éªŒæ¥è¯´ï¼ŒæŠ€æœ¯å›¢é˜Ÿä¸å¯é¿å…çš„ä¼šæˆä¸ºå·¥å…·äººã€‚Leader ç¼ºä¹ç‹¬ç«‹æ€è€ƒï¼Œäººäº‘äº¦äº‘ï¼Œæœ€åæ•´ä¸ªå›¢é˜Ÿéƒ½ä¼šè¢«æ‹–ç´¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°ç ”å‘å›¢é˜Ÿè¢«äº§å“ä»¥åŠä¸šåŠ¡æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦çš„åŸå› ï¼ é¢†åŸŸå»ºæ¨¡çš„å‰ææ˜¯ç†è§£ä¸šåŠ¡æ­£å› ä¸ºæ²¡æœ‰ä»”ç»†çœ‹ä¸šåŠ¡çš„ç°çŠ¶ã€æ¨æµ‹ä¸šåŠ¡çš„å‘å±•ã€å»æ€è€ƒä¸šåŠ¡ä¸Šå¯¹äº¤æ˜“çš„è¯‰æ±‚ï¼Œæˆ‘ä»¬è®¤è¯†çš„åªæ˜¯ä¸€ä¸ªä¸ªéœ€æ±‚ï¼Œè€Œéæ•´ä½“çš„ä»ä¸šåŠ¡ç»´åº¦æ€è€ƒç³»ç»Ÿçš„è®¾è®¡ï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚åº¦è¶Šæ¥è¶Šé«˜ã€‚æ‰€ä»¥è¦æƒ³è®¾è®¡å¯é ã€ç®€å•ã€çœŸæ­£å¯æŒç»­è¿­ä»£çš„ç³»ç»Ÿï¼Œæ·±åº¦ç†è§£ä¸šåŠ¡å°±æ˜¯å‰æï¼Œä½ å¯¹ä¸šåŠ¡çš„ç†è§£ç¨‹åº¦å½±å“äº†ä½ å¯¹ç³»ç»Ÿæœªæ¥å‘å±•çš„é¢„åˆ¤ç¨‹åº¦ã€‚ æå‡æŠ€æœ¯å›¢é˜Ÿçš„ä½¿å‘½æ„Ÿä½ å†™çš„æ¯ä¸€è¡Œä»£ç ï¼Œçº¿ä¸Šçš„æ¯ä¸€æ¬¡å‘å¸ƒï¼Œéƒ½ä¼šæ”¹å˜ç”¨æˆ·çš„ä½“éªŒï¼Œè§£å†³å®é™…çš„é—®é¢˜ï¼Œä½ å°±ä¼šå‘ç°è¿™ä»½å·¥ä½œçš„æ„ä¹‰ã€‚ å¦‚ä½•ç†è§£ä¸šåŠ¡ï¼Ÿ ä¸è¦ç›²ä¿¡äº§å“ï¼ˆä¸è¦ç›²ä¿¡äº§å“ä¸ PRDï¼Œåœ¨è®¨è®º PRD å’Œæ‰§è¡Œå¼€å‘ä»»åŠ¡ä¹‹å‰å­¦ä¼šç‹¬ç«‹æ€è€ƒï¼Œæ·±å…¥ç†è§£ä¸šåŠ¡æƒ³è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œéœ€è¦ä»€ä¹ˆæ•ˆæœæˆ–ä½œç”¨ï¼Œä¸¥æ ¼æŠŠæ§é‚£äº›ä¼ªéœ€æ±‚å’Œæ— ä»·å€¼éœ€æ±‚ï¼Œé˜²æ­¢å®ƒä»¬ä¾µå å›¢é˜Ÿçš„æŠ€æœ¯èµ„æºã€‚ï¼‰ å»ºç«‹èµ°è¿›ä¸šåŠ¡çš„æœºåˆ¶ ä¸šåŠ¡ä¸Šå¤šå‚ä¼šå¤šç”»å›¾ï¼ˆå‚åŠ è¯„å®¡ä¼šï¼Œæ¢³ç†æµç¨‹å›¾ç­‰ç­‰ï¼‰ æ¶æ„è®¾è®¡ï¼šæ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®æ²»ç†å¥½ç³»ç»Ÿå¤æ‚åº¦æ‰æœ€åŠ¡å®C.A.R. Hoareæ›¾è¯´è¿‡ï¼šâ€œè½¯ä»¶è®¾è®¡æœ‰ä¸¤ç§é£æ ¼ï¼Œä¸€ç§æ˜¯å°†è½¯ä»¶è®¾è®¡å¾—å¾ˆå¤æ‚ï¼Œä»¥ä½¿å…¶ç¼ºé™·æ²¡é‚£ä¹ˆæ˜æ˜¾ï¼›ä¸€ç§æ˜¯æŠŠè½¯ä»¶è®¾è®¡å¾—å¾ˆç®€å•ï¼Œä»¥ä½¿å…¶æ²¡æœ‰æ˜æ˜¾çš„ç¼ºé™·â€ã€‚ ç³»ç»Ÿçš„ç»“æ„æ¸…æ™°ã€å³ä½¿æ•´ä½“ç¹æ‚ä½†æ˜¯æ¯ä¸ªå±€éƒ¨éƒ½ç›¸å¯¹ç®€å•ã€é“¾è·¯å¹²è„†ç›´æ¥ï¼Œæ²¡æœ‰ä¸å¿…è¦çš„å†—ä½™ã€‚ è¡¡é‡å¤æ‚åº¦ ç†è§£æˆæœ¬é«˜ï¼šéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½ç†è§£ç³»ç»Ÿæ¨¡å—çš„ç»„æˆåŠè¿ä½œï¼Œæ¯”å¦‚æ–°åŒå­¦åŠ å…¥æˆ–ç³»ç»Ÿäº¤æ¥æ—¶ï¼Œè€åŒå­¦å¾ˆéš¾è®²å®Œæ•´ã€æ–°åŒå­¦ä¸å®¹æ˜“å¬æ˜ç™½ï¼Œè¦å‡ å‘¨ç”šè‡³1~2ä¸ªæœˆæ‰èƒ½å®Œå…¨äº†è§£ç³»ç»Ÿçš„å®ç°å’Œè¿ä½œæœºç†ã€‚ å˜æ›´ç‰µè¿å¤šï¼šå“ªæ€•æ˜¯å®ç°ä¸€ä¸ªå°çš„éœ€æ±‚éƒ½è¦æ”¹é€ ç³»ç»Ÿçš„å¤šä¸ªéƒ¨åˆ†ã€ç”šè‡³å¤šä¸ªç³»ç»Ÿï¼ˆä¸Šä¸‹æ¸¸ç­‰ï¼‰ï¼Œæœ‰çš„è¿˜éœ€è¦åè°ƒå…¶ä»–å›¢é˜Ÿæˆ–éƒ¨é—¨ï¼Œç»“æœå¯¼è‡´è¿­ä»£æˆæœ¬é«˜ï¼Œå¹¶å¯èƒ½å¼•å…¥æ›´é«˜çš„é£é™©ã€‚ ä¸€å¼ å›¾è£…ä¸ä¸‹ï¼šå³ä½ æ— æ³•åœ¨ä¸€å—ç™½æ¿ä¸Šæ¸…æ™°ä¸”å®Œæ•´åœ°ç”»å‡ºç³»ç»Ÿä¸»è¦åŠŸèƒ½åœºæ™¯çš„æ¶æ„å›¾ï¼Œå¯èƒ½æ˜¯ç‰µè¿çš„ç³»ç»Ÿã€æœåŠ¡ã€ç»„ä»¶è¿‡å¤šæˆ–è€…é“¾è·¯è®¾è®¡ä¸åˆç†å¯¼è‡´çš„ã€‚ åŠ äººæ— æ³•è§£å†³é—®é¢˜ï¼šå³ä¾¿ä½ å¢åŠ äººå‘˜ä¹Ÿéš¾æé«˜ç³»ç»Ÿçš„äº¤ä»˜é€Ÿåº¦å’Œäº§å‡ºè´¨é‡ï¼Œæ¯”å¦‚åŸæœ¬3ä¸ªäººè´Ÿè´£ç³»ç»Ÿï¼Œå¢åŠ åˆ° 6 ä¸ªäººçš„äº¤ä»˜äº§å‡ºå¯èƒ½å’Œ 3 ä¸ªäººæ—¶æ‰€å·®æ— å‡ ï¼ŒåŸå› åœ¨äºå¤æ‚åº¦è¿‡é«˜å¹¶ä¸”ç³»ç»Ÿç»“æ„æ¨¡ç³Šï¼Œå¾ˆéš¾é€šè¿‡æ¸…æ™°çš„åˆ†å·¥è®©ç”Ÿäº§åŠ›æœ€å¤§åŒ–ã€‚ è€Œä½ å¯ä»¥ç»“åˆè¿™ 4 ç‚¹è¡¨ç°ç‰¹å¾ä»¥åŠè‡ªå·±çš„ä¸»è§‚æ„Ÿå—è¿›ä¸€æ­¥åˆ¤æ–­ç³»ç»Ÿçš„å¤æ‚åº¦æ˜¯å¦è¿‡é«˜ï¼Œå¦‚æœç³»ç»Ÿå¤æ‚åº¦è¿‡é«˜ï¼Œå¯èƒ½å¸¦æ¥ä¸€ç³»åˆ—é—®é¢˜ï¼šè¿­ä»£å‹åŠ›å¤§ã€ç»å¸¸å»¶æœŸã€ç¨³å®šæ€§é—®é¢˜é¢‘å‘ç­‰ã€‚è¿™æ—¶ï¼Œä½ è¦ç€æ‰‹æ²»ç†å¤æ‚åº¦ï¼Œå°½åŠ›ä¸è®©é—®é¢˜æ‰©å¤§åˆ°éš¾ä»¥è§£å†³åªèƒ½é‡åšç³»ç»Ÿçš„ç¨‹åº¦ã€‚ å¤æ‚åº¦æ²»ç†çš„æ€è·¯â€œé«˜å†…èšã€ä½è€¦åˆâ€ï¼Œç³»ç»Ÿç®€åŒ–å’Œåˆ†æ²»ã€‚ ç®€åŒ–å°±æ˜¯å»æ‰ä¸å¿…è¦çš„å¤æ‚ï¼Œè®©è®¾è®¡ä¸å®ç°ä¿æŒç®€å•ã€‚ åˆ†æ²»åˆ™æ˜¯å°†åŸæœ¬éš¾è§£å†³çš„é—®é¢˜ï¼Œæ‹†åˆ†åˆ°å¯è§£å†³çš„ç²’åº¦ï¼Œç„¶åå†é€ä¸€å‡»ç ´ã€‚ å¸¸è§çš„æ‹†åˆ†æ–¹å¼æ˜¯å‚ç›´æ‹†åˆ†å’Œæ°´å¹³åˆ†å±‚ï¼š å‚ç›´æ‹†åˆ†æŠŠå·®å¼‚æ˜ç¡®å¯ä»¥ç‹¬ç«‹è¿­ä»£çš„ä¸šåŠ¡æ‹†åˆ†å¼€ï¼›æ°´å¹³åˆ†å±‚æŠŠå…±æ€§çš„èƒ½åŠ›ä¸‹æ²‰éš”ç¦»ã€‚æ¯”å¦‚ç”µå•†åœºæ™¯ä¸­ï¼Œè´­ç‰©è½¦å’Œè®¢å•å¯ä»¥åˆ†æˆä¸¤ä¸ªæœåŠ¡ï¼Œå®ƒä»¬è™½ç„¶åœ¨ä¸šåŠ¡æµç¨‹ä¸Šå‰åå…³è”ï¼Œä½†æ˜¯å„è‡ªå…·å¤‡ç‹¬ç«‹å®Œæ•´çš„ä¸šåŠ¡åœºæ™¯å’Œç”Ÿå‘½å‘¨æœŸï¼Œå•†å“åŠ å…¥è´­ç‰©è½¦æœªå¿…ä¼šäº¤æ˜“ç”Ÿæˆè®¢å•ï¼Œå¯ä»¥å„è‡ªç‹¬ç«‹å­˜åœ¨ï¼›è€Œåº“å­˜å’Œå•†å“åˆ™æ˜¯å¼ºä¾èµ–çš„å…³ç³»ï¼Œåº“å­˜æ— æ³•ç‹¬ç«‹äºå•†å“å­˜åœ¨ã€‚ æ‹†åˆ†ä¸åˆå¹¶ä¸ç»å¯¹ï¼Œè¿‡åº¦åœ°æ‹†åˆ†ä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•é«˜å†…èšï¼Œé›¶æ•£åˆ†ç¦»çš„ç³»ç»Ÿï¼Œä¼šå¢åŠ ç¨³å®šæ€§é£é™©å’Œæ²»ç†ä¸è¿­ä»£çš„ä»£ä»·ï¼Œå¹¶ä¸”é€ æˆå¤§é‡çš„åä½œæˆæœ¬ã€‚Linusä¹Ÿæ›¾è¯´è¿‡ï¼šæŠŠå¤æ‚ç³»ç»Ÿæ‹†åˆ†æˆæ¨¡å—ï¼Œä¼¼ä¹æ²¡æœ‰é™ä½æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œå®ƒé™ä½çš„åªæ˜¯å­ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚è€Œæ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œåè€Œä¼šç”±äºæ‹†åˆ†åçš„æ¨¡å—ä¹‹é—´ï¼Œä¸å¾—ä¸è¿›è¡Œäº¤äº’ï¼Œå˜å¾—æ›´åŠ å¤æ‚ã€‚ å¤æ‚åº¦æ²»ç†å®è·µ ç›¸æ¯” coding æ›´é‡è§†è®¾è®¡ æ°¸è¿œåš 2 å¥—ä»¥ä¸Šçš„æ–¹æ¡ˆ ä» MVP çš„è§†è§’è€ƒè™‘è®¾è®¡ï¼šä» MVP ï¼ˆæœ€å°å®Œæ•´ä¸šåŠ¡çš„è§’åº¦ï¼‰å»è€ƒè™‘ç³»ç»Ÿè¦å¦‚ä½•è®¾è®¡ä¸å®ç°ï¼Œå…ˆåšå‡æ³•å†åšåŠ æ³• å…³æ³¨ä¸Šä¸‹æ¸¸çš„å®ç° åšæŒâ€œæ—¥æ‹±ä¸€å’ æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°æ²¡å¿…è¦ä¸€å®šæŠŠç³»ç»Ÿåšæˆä¸­å°ï¼Œä¸åšä¸­å°å°±ä¼šè½åæ›´æ˜¯æ— ç¨½ä¹‹è°ˆï¼Œä¸è¿‡ï¼Œä½ å¯ä»¥å€Ÿé‰´ä¸­å°çš„æ€è·¯ä½œä¸ºç³»ç»Ÿè®¾è®¡ä¸æ¼”è¿›ä¸Šçš„å½¢æ€å‚è€ƒã€‚ ç®¡ç†ä¸‰æ¿æ–§ï¼šæ‹¿ç»“æœã€å»ºå›¢é˜Ÿã€æ‹›è˜ä¸è§£è˜ å®šç›®æ ‡ï¼šè®©ä½ çš„æ–¹å‘ä¸å…¬å¸çš„æ–¹å‘ä¿æŒä¸€è‡´æ€ä¹ˆè§£è¯»ç›®æ ‡ï¼Ÿè§£è¯»ç›®æ ‡å°±æ˜¯è¦ç¡®ä¿è‡ªå·±åšçš„äº‹å„¿å’Œå…¬å¸çš„æ–¹å‘ä¸€è‡´ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œæ²¡æœ‰èµ°åï¼ˆè¿™é‡Œçš„â€œåŠ¿â€å°±æ˜¯å…¬å¸çš„æˆ˜ç•¥å’Œç›®æ ‡ï¼‰ï¼Œæ­£å› ä¸ºæœ‰äº†ç›®æ ‡æ‰æœ‰æ ¹æ®ç›®æ ‡åˆ¶å®šçš„ KPIï¼Œæ‰ä¼šæœ‰å›´ç»•ç›®æ ‡çš„æ‰§è¡ŒåŠ¨ä½œå’Œæœ€ç»ˆå–å¾—çš„ç»“æœã€‚ ç›®æ ‡ä¸æ˜¯ä¸€å¥å£å·ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸ªå±‚å±‚æ‹†è§£ã€é€’è¿›çš„è¿‡ç¨‹ã€‚è¯´ç™½äº†ï¼Œè§£è¯»ç›®æ ‡æ˜¯æŠŠå…¬å¸çš„æ–¹å‘å˜æˆä½ çš„æ–¹å‘ï¼ŒæŠŠä¸Šä¸€å±‚çš„é—®é¢˜è½¬å˜æˆä½ å¯ä»¥æ”¹å˜çš„é—®é¢˜ã€‚ ç¡®ä¿ç›®æ ‡è§£è¯»æ­£ç¡®æœ‰å¾ˆå¤šæŠ€å·§å’Œæ–¹æ³•ã€‚æ ¹æ®ç›®æ ‡é€å±‚åˆ†è§£çš„ç‰¹æ€§ï¼Œå¯ä»¥è€ƒè™‘å››ä¸ªæ–¹é¢ã€‚ ä½ çš„ä¸»ç®¡ï¼Œç¡®å®šä½ è€æ¿çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼› ä½ è‡ªèº«æ‰€åœ¨çš„å›¢é˜Ÿã€å›¢é˜Ÿçš„æˆå‘˜ä»¬ï¼Œæ ¹æ®å›¢é˜Ÿæƒ…å†µç¡®å®šç°çŠ¶ï¼› ä¸ä½ ç´§å¯†åˆä½œçš„ä¸Šä¸‹æ¸¸ï¼ˆç ”å‘ï¼‰ï¼Œæ¯”å¦‚ä½ æ˜¯åšè®¢å•ç³»ç»Ÿçš„ï¼Œé‚£ä¹ˆæ”¯æŒå±æ€§å¾ˆé‡ï¼Œå•†æˆ·ã€å¯¼è´­ã€ç”¨æˆ·å¾ˆå¤šç ”å‘å›¢é˜Ÿéƒ½æ˜¯ä½ çš„ä¸Šä¸‹æ¸¸å…³è”æ–¹ï¼› ç›´æ¥å¯¹å£çš„ä¸šåŠ¡ä¸äº§å“ï¼Œè¿™æ˜¯ä¸šåŠ¡ç›®æ ‡æ‹†è§£ã€ä¸šåŠ¡ç—›ç‚¹ã€å®¢æˆ·è¯‰æ±‚çš„ç›´æ¥æ¥æºæ–¹ã€‚ æ€ä¹ˆåˆ¶å®šç›®æ ‡ï¼Ÿç»“åˆ 4 ä¸ªå…³é”®ç‚¹æ¥è€ƒè™‘ï¼š â€œçŸ­é•¿â€ç»“åˆï¼šäº‹æƒ…åˆ†è½»é‡ç¼“æ€¥ï¼Œä½ ä¸€ç›´ç›¯ç€â€œæ€¥â€å’Œâ€œé‡â€ï¼Œâ€œè½»â€å’Œâ€œç¼“â€çš„äº‹æƒ…å°±ä¼šè½¬å˜æˆâ€œé‡â€å’Œâ€œæ€¥â€ï¼Œè¿›å…¥æ­»å¾ªç¯ã€‚ è¦è¶³å¤Ÿèšç„¦ï¼šå»ºè®®å…³é”®ç›®æ ‡ä¸è¦è¶…è¿‡ 3 ä¸ªï¼Œæœ€å¤šæ§åˆ¶åœ¨ 5 ä¸ªä»¥å†…ï¼Œè¦æ‰¾æœ€æœ‰å®¢æˆ·ä»·å€¼ã€å¯¹å…¬å¸æˆ˜ç•¥æœ€æœ‰å¸®åŠ©çš„ç‚¹ï¼Œç›®æ ‡è¶Šå°‘ã€æ–¹å‘è¶Šæ¸…æ™°ï¼Œå½“é—®é¢˜å‘ç”Ÿæˆ–è€…éœ€è¦åˆ¤æ–­æ—¶è¶Šå®¹æ˜“åšå†³ç­–ï¼Œåœ¨æœ‰é™çš„æ—¶é—´å†…åšå‡ºæ›´å¥½çš„ç»“æœã€‚ è¦æœ‰è¶³å¤Ÿçš„æŒ‘æˆ˜ï¼šç³»ç»Ÿå¯ç”¨æ€§å‡å¦‚å»å¹´æ˜¯ 3 ä¸ª 9ï¼Œä»Šå¹´è€ƒè™‘ä¸šåŠ¡ä¼šå‘å±•ä¿å®ˆèµ·è§è¿˜æ˜¯åŠ›ä¿ 3 ä¸ª 9ï¼Œè¿™æ ·çš„ç›®æ ‡æŒ‘æˆ˜æ€§å°±ä¸è¶³ï¼Œä¹Ÿæ— æ³•ä½“ç°æŠ€æœ¯çš„ä»·å€¼ã€‚è¿™ä¸ªåº¦é‡æ˜¯å¾ˆè€ƒéªŒä½ çš„ã€‚ è¦è®©ç»„ç»‡æœ‰æ²‰æ·€ã€ä¸ªäººæœ‰æˆé•¿ï¼šé€šè¿‡ä¸€ä¸ªä¸ªç›®æ ‡çš„å®Œæˆï¼Œè®©å‚ä¸çš„åŒå­¦å¾—åˆ°ä¸ªäººèƒ½åŠ›çš„æå‡ï¼Œæœªæ¥å¯ä»¥æ‰¿æ‹…æ›´å¤§çš„èŒè´£ï¼Œç»„ç»‡ä¹Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹åšèƒ½åŠ›çš„ç§¯ç´¯ä¸æ²‰æ·€ã€‚ ç»“åˆä»¥ä¸Šå››ç‚¹ï¼Œå›´ç»•ç›®æ ‡å’Œå›¢é˜Ÿä¸€èµ·è®¨è®ºç­–ç•¥ä¸æ‰“æ³•ï¼Œå°†ç›®æ ‡æ‹†è§£æˆå‡ ä¸ªå…³é”®ä»»åŠ¡ï¼Œæ˜ç¡®åˆ°è´£ä»»äººï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šå®šç­–ç•¥ã€æ‹†ä»»åŠ¡ã€ç»†åˆ°äººã€‚ æ€ä¹ˆä¼ é€’ç›®æ ‡ï¼Ÿå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ ä¼šå‘ç°ä¿¡æ¯ä¸å¯¹ç­‰ã€ä¼ é€’è¿‡ç¨‹ä¸­çš„æŸå¤±ã€ä¸ªäººç†è§£çš„å·®å¼‚ï¼Œç›´æ¥å¯¼è‡´ä¸æ˜¯æ‰€æœ‰äººéƒ½æ¸…æ¥šâ€œæˆ‘ä»¬è¦å¾€å“ªå»â€ã€‚ æœ€åï¼Œç›®æ ‡çš„ä¼ é€’æ˜¯ä¸€ä¸ªè¿è´¯çš„åŠ¨ä½œï¼Œè¦è½åˆ°æ—¥å¸¸çš„ç®¡ç†åŠ¨ä½œã€é‡ç‚¹é¡¹ç›®ä¸ä»»åŠ¡ã€KPI çš„è¿‡ç¨‹ç®¡ç†è¿™äº›å¹³æ—¥çš„ç‚¹æ»´ä¸­ã€‚ç›®æ ‡è¦åå¤è®²ï¼Œè¦ç»å¸¸å¯¹ç„¦ï¼Œé‡è¦çš„äº‹å„¿ï¼Œ3 éæ˜¯ä¸å¤Ÿçš„ï¼Œè¦è¯´â€œ300 éï¼â€ã€‚ æ‰€è°“çš„æ–¹å‘ä¸ç›®æ ‡å°±æ˜¯ï¼šä½ è¦å¾€å“ªå»ï¼Œä½ è¦èµ°å¤šè¿œï¼Œä½ è¦èµ°åˆ°å“ªã€‚æ¸…æ™°çš„ç›®æ ‡å°±å¥½æ¯”æ²™æ¼ ä¸­çš„æŒ‡å—é’ˆï¼Œè®©ä½ èƒ½æ¯”å…¶ä»–äººæ›´å¿«æ‰¾åˆ°æ°´æºå¹¶ç”Ÿå­˜ä¸‹å»ï¼Œä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘æé†’ä½ æ³¨æ„è¿™æ ·å‡ ç‚¹ï¼š è§£è¯»ç›®æ ‡éå¸¸é‡è¦ï¼Œåˆ‡å‹¿é™·å…¥æç«¯ï¼Œè¦ä¹ˆä¸è§£è¯»ï¼Œè¦ä¹ˆé¢†å¯¼è¯´ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆã€‚ åˆ¶å®šç›®æ ‡ä¸€å®šè¦å¤Ÿèšç„¦ï¼Œä½†åˆ‡å‹¿åªè€ƒè™‘çœ¼å‰ï¼Œæ³¨æ„â€œé•¿çŸ­ç»“åˆâ€ã€‚ æ³¨æ„ç›®æ ‡ä¼ é€’ï¼Œè¦å……åˆ†è€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„æ„Ÿå—ï¼Œé€‰å–åˆé€‚çš„æ–¹å¼ã€‚ è¿½è¿‡ç¨‹ï¼šå¦‚ä½•ç”¨ PDCA åšè¿‡ç¨‹ç®¡ç†ï¼Ÿåªæœ‰æŒæ¡è¿‡ç¨‹ç®¡ç†çš„æ–¹æ³•ï¼Œæ‰ä¼šå°½å¯èƒ½å‡å°‘äº‹åŠ¡å¾€ä¸å¥½æ–¹å‘å‘å±•çš„æ³¢åŠ¨ï¼Œä»è€Œæ›´è½»æ¾ã€æ›´ä½é£é™©ã€æ›´ç¨³å¦¥åœ°å»æ‹¿åˆ°ç»“æœï¼Œè®©ä¸€åˆ‡å°½åœ¨æŒæ§ã€‚ ä»€ä¹ˆæ˜¯è¿‡ç¨‹ç®¡ç†ï¼Ÿç®¡ç†å°±æ˜¯è¿½æ±‚äº‹åŠ¡çš„å¯æŒç»­å‘å±•ï¼Œè€Œæƒ³è¦è¾¾æˆè¿™ä¸ªç›®æ ‡æœ‰ä¸¤ä¸ªåŸºæœ¬ç‚¹ï¼š ç®¡ç†åŠ¨ä½œè¦å½¢æˆå¯æŒç»­è¿­ä»£çš„é—­ç¯ï¼› ç®¡ç†åŠ¨ä½œè¶³å¤Ÿç®€å•åˆ°å¯ä»¥å¤åˆ¶å’Œä¸ªæ€§åŒ–å‡çº§ã€‚ è¿‡ç¨‹ç®¡ç†æ˜¯ä¸ºäº†è®©ä½ çš„æƒ³æ³•ã€çµæ„Ÿã€ä¸ç¨³å®šçš„å‘æŒ¥é€æ¸è§„å¾‹åŒ–ï¼Œå¯ä»¥æŒç»­è¿­ä»£è¢«ä½ åº”ç”¨ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯å¸Œæœ›ç»“æœè¶Šæ¥è¶Šå¥½ï¼Œè®©ä½ åŸæœ¬é è¿æ°”æˆ–è€…æ¨¡ç³Šç»éªŒå¾—æ¥çš„æˆåŠŸå¯ä»¥è¢«å¤åˆ¶ï¼Œè®©ä½ åœ¨é¡¹ç›®ä¸­çµå…‰ä¸€é—ªçš„ Idea å˜æˆä½ çš„å¸¸è§„èƒ½åŠ›ã€‚ PDCA æ¨¡å‹ Planï¼ˆå®šè®¡åˆ’ï¼‰ï¼šå›´ç»•ç€ç›®æ ‡æ˜ç¡®é‡Œç¨‹ç¢‘ï¼Œç¡®å®šå…³é”®èŠ‚ç‚¹ï¼Œä¸æ‰§è¡Œçš„å‘˜å·¥è¾¾æˆå…±è¯†ã€‚ Doï¼ˆåšæ‰§è¡Œï¼‰ï¼šå¤šç»™å‘˜å·¥ç©ºé—´ã€å¤šèµ°åŠ¨ã€å¤šè§‚å¯Ÿã€å°‘å¹²é¢„ï¼Œæ”¾æ‰‹è€Œéæ”¾ä»»ï¼Œä½ ä¹Ÿä¸èƒ½ç½®èº«äº‹å¤–ã€‚ Checkï¼ˆå‹¤æ£€æŸ¥ï¼‰ï¼šç‹ æŠ“å…³é”®èŠ‚ç‚¹åšæ£€æŸ¥ã€é—®è¿›å±•ã€é—®å›°éš¾ã€ç»™å»ºè®®ã€åšè¾…å¯¼ã€åè°ƒèµ„æºã€‚ Actionï¼ˆå¤ç›˜è°ƒä¼˜ï¼‰ï¼šå°äº‹å°½å¿«å¤ç›˜ã€å¤§äº‹åˆ†é˜¶æ®µå¤ç›˜ã€äº‹åå…¨é¢å¤ç›˜ï¼ŒæŠ“ä½æ¯ä¸€æ¬¡æå‡å’Œä¼˜åŒ–çš„æœºä¼šã€‚ å¦‚ä½•ç”¨ PDCA åšè¿‡ç¨‹ç®¡ç†ï¼Ÿå¾ˆå¤šèƒ½åŠ›å’Œç»éªŒæ˜¯å†ç»ƒå‡ºæ¥çš„ï¼Œåªè¦è¿‡ç¨‹å¯æ§ï¼Œè¿‡ç¨‹ä¸­èµ°ä¸€äº›å¼¯è·¯ä¹Ÿæœªå¿…æ˜¯åäº‹ï¼Œè¦å…è®¸çŠ¯é”™ã€‚ä½†æ˜¯ä½ è¦æ³¨æ„ï¼Œæ”¾æ‰‹ä¸ç­‰äºæ”¾ä»»ï¼Œæ›´ä¸ç­‰äºä¸é—»ä¸é—®ï¼Œä½ ä¾ç„¶è¦å¯¹æœ€ç»ˆçš„ç»“æœè´Ÿè´£ã€‚ å¤ç›˜å‰ï¼šå¤ç›˜å‰çš„æ ¸å¿ƒåœ¨äºæ€è€ƒå¤ç›˜çš„ç›®çš„å’Œäº§å‡ºæ˜¯ä»€ä¹ˆã€‚å€Ÿæ­¤ï¼Œä½ æ‰å¯ä»¥æ˜ç¡®å¤ç›˜ä¼šè®®ä¸»è¦ä¼šèŠäº›ä»€ä¹ˆï¼Œå“ªäº›äººä¼šå‚åŠ ã€‚ å¤ç›˜ä¸­ï¼šè‡ªçœæ˜¯å¤ç›˜ä¼šçš„åŸºè°ƒï¼Œå¤ç›˜å°±ä¸€ä¸ªç›®çš„â€œæ‰¾åˆ°å›¢é˜Ÿçš„ä¸è¶³åŠ ä»¥æ”¹è¿›ï¼Œä»¥ä¾¿åœ¨æœªæ¥å–å¾—æ›´å¥½çš„ç»“æœâ€ã€‚æ‰€ä»¥æ¯ä¸ªäººæ²¡å¿…è¦ç”©é”…ï¼Œä¹Ÿæ²¡å¿…è¦å…¨ç›˜å¦å®šã€‚åœ¨å¤ç›˜çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦æŠŠé—®é¢˜æ‰¾å‡†ï¼Œå†…éƒ¨å¯¹é½ï¼Œè¾¾æˆæ‰€æœ‰äººçš„å…±è¯†ã€‚ å¤ç›˜åï¼šä¼šè®®æœ‰ç»“è®ºï¼Œç»“è®ºæœ‰è®¡åˆ’ï¼Œè®¡åˆ’æœ‰è´£ä»»äººï¼Œè´£ä»»äººæœ‰è¡ŒåŠ¨ï¼Œè¦å»ºç«‹æœºåˆ¶ä¿è¯åœ¨å¤ç›˜ä¼šä¸Šè®¨è®ºå‡ºçš„ç»“è®ºèƒ½å¤Ÿè½åœ°ã€‚ æ€»çš„æ¥è¯´ï¼Œå°äº‹å„¿å°½å¿«å¤ç›˜ï¼Œå€Ÿæ­¤å‘å›¢é˜Ÿæˆå‘˜ä¼ æˆè‡ªå·±çš„ç»éªŒï¼›å¤§äº‹å„¿åˆ†é˜¶æ®µå¤ç›˜ï¼ŒæŠ“ä½é‡ç‚¹çŸ›ç›¾ï¼Œæ¨åŠ¨äº‹æƒ…çš„é¡ºåˆ©å‘å±•è€Œéè¿½æ±‚å®Œç¾ï¼›äº‹åå…¨é¢å¤ç›˜ï¼Œä¸ç®¡å¯¹ä¸ªäººè¿˜æ˜¯å›¢é˜Ÿï¼Œæ‰¾è‡ªå·±çš„é—®é¢˜éƒ½æ˜¯ ROI æœ€é«˜çš„æ–¹å¼ï¼Œæ‰¾åˆ°é—®é¢˜çš„ä¸€æ–¹æ‰æœ‰æ”¹å–„æå‡çš„å¯èƒ½ã€‚ ä¸‰ä¸ªé‡ç‚¹ï¼š ç›®æ ‡ä¸ä¼šè‡ªå·±é•¿è…¿èµ°å‘ç»ˆç‚¹ï¼Œä½ ä¸€å®šè¦åšå¥½è¿‡ç¨‹ç®¡ç†ä»¥å–å¾—å¯é çš„ç»“æœã€‚ è¿½è¿‡ç¨‹ä¸æ„å‘³ç€äº‹æ— å·¨ç»†éƒ½è¦åšï¼Œè¿½å“ªäº›ã€ä»€ä¹ˆæ—¶å€™è¿½ã€è¿½åˆ°ä»€ä¹ˆç¨‹åº¦æ‰æ˜¯ä½ æ›´åº”è¯¥å…³å¿ƒçš„ã€‚ å¤ç›˜æ˜¯ PDCA ç®¡ç†åŠ¨ä½œä¸­çš„é—­ç¯ï¼Œå¦‚æœæ¯æ¬¡éƒ½èƒ½æé«˜ä¸€ç‚¹ç‚¹ï¼Œé•¿æœŸç§¯ç´¯çš„å˜åŒ–å°±å¾ˆå¤§äº†ã€‚ å¥–ä¼˜ç½šåŠ£ï¼šæ€æ ·ä¼ é€’æˆ‘ä»¬â€è¦ä»€ä¹ˆâ€ä¸â€œä¸è¦ä»€ä¹ˆâ€ï¼Ÿâ€œå¥–ä¼˜ç½šåŠ£â€ä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½è®©å›¢é˜Ÿå½¢æˆå¯æŒç»­å‘å±•çš„æ°›å›´ï¼Œæ˜¯æ‹¿ç»“æœçš„é—­ç¯ã€‚è€Œæˆ‘ä»¬åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¦æ³¨æ„çš„å°±æ˜¯ï¼šå¼•å¯¼äººæ€§è€Œéå¯¹æŠ—äººæ€§ã€‚ ä»€ä¹ˆæ˜¯å¥–ä¼˜ã€ç½šåŠ£å¥–ä¼˜æœ€ç»ˆä¼šè½åˆ°ç‰©è´¨å’Œç²¾ç¥ä¸Šï¼š ç‰©è´¨ä¸Šçš„å¥–ä¼˜ä½œç”¨å¤§ï¼Œä½†æ˜¯é¢‘æ¬¡è¾ƒä½ï¼Œæ¯”å¦‚ä»¥åŠå¹´/å¹´ä¸ºå•ä½çš„æ™‹å‡ã€è°ƒè–ªï¼Œå®ƒèƒ½å¤Ÿæ‰“å¼€æˆå‘˜çš„å¤©èŠ±æ¿ï¼Œæ¯”å¦‚æ‹¿äº†Aç»©æ•ˆçš„åŒå­¦ï¼Œç¬¬äºŒå¹´ä»–ä¾ç„¶å¸Œæœ›æ˜¯Aè€Œä¸æ˜¯Bï¼Œä»è€Œæé«˜å¯¹è‡ªå·±çš„è¦æ±‚ä¸æœŸæœ›ï¼Œæ›´å®¹æ˜“å–å¾—å¥½çš„æˆç»©ã€‚ ç²¾ç¥ä¸Šçš„å¥–ä¼˜ä½“ç°åœ¨æ—¥å¸¸è¡Œä¸ºä¸Šï¼Œé¢‘æ¬¡è¾ƒé«˜ï¼Œæ¯”å¦‚ä½ å…³æ³¨å’Œè‚¯å®šæŸä½æˆå‘˜çš„è¡Œä¸ºï¼Œåœ¨å›¢é˜Ÿå†…é€šè¿‡é‚®ä»¶ã€é’‰é’‰ç­‰æ–¹å¼ç®€å•é¼“åŠ±æ¨å¹¿ä»–çš„è¡Œä¸ºã€‚ ç½šåŠ£ä¹Ÿä¼šè½åˆ°ç‰©è´¨å’Œç²¾ç¥ä¸Šï¼Œä½†å®ƒæ˜¯åŠ¨ä½œè€Œéç›®çš„ï¼Œä½ è¦é€šè¿‡ç½šåŠ£æ¥ä¼ é€’å›¢é˜Ÿä¸èƒ½å®¹å¿ä»€ä¹ˆæ ·çš„è¡Œä¸ºï¼Œä»¥æ­¤æé†’ã€é­ç­–å¤§å®¶ã€‚å¥–ä¼˜å’Œç½šåŠ£æ˜¯ç›¸äº’ä¾èµ–çš„ã€‚ â€œå¥–ä¼˜ç½šåŠ£â€çš„è¯¯åŒºï¼š æ²¡æœ‰æ„è¯†åˆ°å¥–ä¼˜ç½šåŠ£çš„ç¤ºèŒƒä½œç”¨ã€‚ ä½ è¦æŠŠâ€œå¥–ä¼˜ç½šåŠ£â€å½“ä½œå®£ä¼ åŠ¨ä½œï¼ŒæŠŠç»“æœè¾æ•£å‡ºå»ï¼Œå¼•å¯¼å›¢é˜Ÿé£å‘ã€‚ æ³¨é‡ç½šåŠ£ï¼Œå¿½ç•¥å¥–ä¼˜ã€‚ å¥–æƒ©åŠ¨ä½œè¿‡äºå„¿æˆï¼Œå®¹æ˜“è¢«æ»¥ç”¨ï¼šâ€œå¥–æƒ©åŠ¨ä½œâ€è¦å»ºç«‹åœ¨å°Šé‡çš„åŸºç¡€ä¸Šï¼Œè®©æˆå‘˜æœ‰æ”¶è·å’Œåæ€ã€‚ å¥–ä¼˜ç½šåŠ£çš„å…³é”®åŠ¨ä½œç»©æ•ˆè€ƒæ ¸æˆ‘ä»¬è¦ä»ä¸€å¼€å§‹è¢«ä¸»è§‚å› ç´ å½±å“ï¼Œé€æ¸è®¤è¯†åˆ°å®¢è§‚çš„ç¯å¢ƒä¸ç°å®ï¼Œæœ€ç»ˆåœ¨ç†æ€§ä¸äººæ€§ä¸­å¯»æ‰¾ä¸€ä¸ªå¹³è¡¡ï¼Œè®©å¤§å®¶çœ‹åˆ°ä»˜å‡ºå’Œèƒ½åšå‡ºå¥½æˆç»©çš„åŒå­¦ï¼Œå›æŠ¥æ˜¯è¿œè¿œé«˜äºå…¶ä»–äººçš„ï¼Œå¯¹äºæ‹–æ•´ä½“åé€€ã€æŒç»­ä¸èƒ½æ”¹å–„çš„åŒå­¦ï¼Œå›¢é˜Ÿæ˜¯ä¸æ¬¢è¿çš„ã€‚ ç»©æ•ˆé¢è°ˆç»©æ•ˆé¢è°ˆçš„æ ¸å¿ƒå‡ºå‘ç‚¹æ˜¯é€šè¿‡è¿™æ¬¡ç»©æ•ˆçš„ç»“æœæ”¹å˜æŸäº›è¡Œä¸ºä¸è®¤è¯†ï¼Œè®©å›¢é˜Ÿåœ¨æœªæ¥å–å¾—æ›´å¥½çš„æˆç»©ï¼Œå¹¶ä¸æ˜¯å•çº¯åœ°é€šçŸ¥ç»“æœã€‚ é¢è°ˆæµç¨‹ï¼š å¼€åœºå®šåŸºè°ƒ å‘˜å·¥è‡ªè¯„ ä¸»ç®¡è¯„ä»· å¯¹ç„¦å…±è¯† é¢è°ˆæ€»ç»“ åç»­è·Ÿè¿› è–ªé…¬æ¿€åŠ±ä¸‰ä¸ªåŸºæœ¬åŸåˆ™ï¼š é—®è‡ªå·±æ˜¯å¦æ•¢å°†èµ„æºåˆ†é…çš„é€»è¾‘ä¸è§„åˆ™åœ¨é˜³å…‰ä¹‹ä¸‹è®²å‡ºæ¥ã€‚ ä¸è¦æ’’èƒ¡æ¤’é¢ï¼Œä¹Ÿåˆ«åšå¤§é”…é¥­ï¼Œè®©å¥½çš„ç»“æœè¶…å‡ºé¢„æœŸã€‚ é¢å‘æœªæ¥è€Œéç°åœ¨å»åšè€ƒè™‘ ç‰¢è®°èµ„æºæ€»æ˜¯æœ‰é™çš„ï¼Œèµ„æºåˆ†é…æœ¬èº«æ˜¯åšå¼ˆï¼Œæœ‰äººå¤šå°±è¦æœ‰äººå°‘ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¹³å‡åˆ†é…çš„ç»“æœä¸æ˜¯æ™®å¤©åŒåº†ï¼Œè€Œæ˜¯æ‰€æœ‰äººéƒ½ä¸æ»¡æ„ï¼Œæ¯ä¸ªäººéƒ½è§‰å¾—å°‘ã€‚ä¸å…¶å¦‚æ­¤ï¼Œä¸å¦‚æŠŠèµ„æºå€¾æ–œåˆ°é‚£äº›ä½ å›¢é˜Ÿæœ€ä¼˜ç§€ã€ç»©æ•ˆæœ€å¥½çš„åŒå­¦èº«ä¸Šï¼Œè®©ä»–ä»¬å¾—åˆ°é¢„æœŸçš„æ”¶ç›Šç”šè‡³è¶…å‡ºé¢„æœŸã€‚ å‹¤æ²Ÿé€šï¼šåœ¨ä¿¡ä»»çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šç®€å•ä¸”çº¯ç²¹è¦çŸ¥é“ï¼Œæ²Ÿé€šæ˜¯æœ‰ç›®çš„çš„ï¼Œæ—¢ç„¶æ²Ÿé€šçš„å¯¹è±¡æ˜¯äººï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›é€šè¿‡æ²Ÿé€šå»è¾¾åˆ°ä¸€å®šçš„ç»“æœï¼ˆæ•ˆæœï¼‰ï¼Œé‚£ä¹ˆå°±è¦æ‡‚å¾—ä¸€å®šçš„é“ç†ä¸æŠ€å·§ã€‚ æ²Ÿé€šçš„æ ¸å¿ƒåŸåˆ™æ²Ÿé€šæ˜¯å†…å¿ƒæƒ³æ³•å’Œæ€è€ƒé€»è¾‘çš„å¤–å»¶ï¼Œå¦‚æœä½ æœ‰è‰¯å¥½çš„æ²Ÿé€šèƒ½åŠ›ï¼Œå¯ä»¥åœ¨æ•´ä¸ªå›¢é˜Ÿä¸­è¥é€ å…¬å¼€é€æ˜çš„ä¿¡ä»»æ°›å›´ï¼Œè®©ä¿¡æ¯é€æ˜çš„åŒæ—¶ï¼Œä¹Ÿè®©å›¢é˜Ÿæˆå‘˜æ„¿æ„å‘å‡ºè‡ªå·±çš„å£°éŸ³ã€‚ æ²Ÿé€šæ ¸å¿ƒåŸåˆ™çš„å®šä¹‰æ˜¯ï¼šåœ¨ç›¸ä¿¡å¯¹æ–¹çš„åŸºç¡€ä¸Šï¼Œè®©æ²Ÿé€šæ°›å›´å˜å¾—â€œç®€å•ä¸”çº¯ç²¹â€ã€‚ ä¸åŒç»´åº¦çš„æ²Ÿé€šå‘ä¸Šæ²Ÿé€šæœ‰èƒ†é‡ã€å¹³è¡Œæ²Ÿé€šæœ‰è‚ºè…‘ã€å‘ä¸‹æ²Ÿé€šæœ‰å¿ƒè‚ã€‚ å‘ä¸Šæ²Ÿé€šè¦æœ‰æŠ€å·§ã€æœ‰åŸåˆ™ï¼Œè®¤æ¸…æ²Ÿé€šçš„ç›®æ ‡ä¸ç›®çš„ï¼Œä¸è½»æ˜“å¦¥åå¯¼è‡´æ›´ä¸¥é‡çš„åæœã€‚ å…³äºå¹³è¡Œæ²Ÿé€šæœ‰è‚ºè…‘æ˜¯æŒ‡ä½ è¦çœŸè¯šæ²Ÿé€šï¼Œä¸è¦æ²¹æ»‘å¥—è·¯ã€‚ å‘ä¸‹æ²Ÿé€šæœ‰å¿ƒè‚æ˜¯æŒ‡æœ‰åŒç†å¿ƒï¼Œæœ‰å°Šé‡çš„åŒæ—¶è¦æ„ŸåŒèº«å—ã€‚ ä¸¤ä¸ªå…·ä½“çš„æ²Ÿé€šåœºæ™¯One One æ²Ÿé€š æ¥åœ°æ°”ï¼Œè¯´äººè¯ è§†äººä¸ºäºº æ²Ÿé€šè¦â€œå‹¤â€ å›¢é˜Ÿæ²Ÿé€šä¸One Oneæ²Ÿé€šä¸åŒçš„æ˜¯ï¼Œå›¢é˜Ÿæ²Ÿé€šå—äººæ•°çš„é™åˆ¶ï¼Œæ˜¯ä¸€å¯¹å¤šçš„æ²Ÿé€šï¼Œæ‰€ä»¥é™¤äº†å‚è€ƒOneOneæ²Ÿé€šçš„æ ¸å¿ƒç‚¹å¤–ï¼Œä½ æœ€å…³é”®çš„åº”è¯¥æ˜¯æ­åœºå­ï¼Œå‘èµ·å›¢é˜Ÿæ²Ÿé€šã€‚ å›¢é˜Ÿæ²Ÿé€šç›®çš„æ€§æ›´å¼ºï¼Œé¢‘æ¬¡ä¸é«˜ï¼Œè€ƒéªŒä½ çš„æ§åœºèƒ½åŠ›ã€‚ å»ºæœºåˆ¶ï¼šè§„åˆ™æµç¨‹è¶Šå»ºè¶Šå¤šï¼Œä¸ºä½•æ•ˆæœå´è¶Šæ¥è¶Šå·®ï¼Ÿæœºåˆ¶å‘æŒ¥ä»€ä¹ˆä½œç”¨ï¼Ÿä¸¤ç±»æœºåˆ¶ï¼š ä¸ç®¡ç†ç›¸å…³ï¼š æ¯”å¦‚ä¸ºäº†ä¿¡æ¯äº’é€šï¼Œçº¦å®šæ¯å‘¨å›ºå®šæ—¶é—´é€šè¿‡é‚®ä»¶ã€ä¼šè®®ã€IM ç­‰æ–¹å¼ï¼Œå°†æå‰å®šä¹‰å¥½çš„ä¿¡æ¯åšä¸€ä¸ªæ±‡æ€»äº¤äº’ï¼ˆè¡¨ç°ä¸ºå‘¨æŠ¥ã€å‘¨ä¼šç­‰ï¼‰ï¼Œè¿™å°±æ˜¯æœºåˆ¶çš„ä¸€ç§å…·ç°ã€‚ ä¸æŠ€æœ¯ç›¸å…³ï¼š æ¯”å¦‚ä¸ºäº†å¤šäººååŒï¼Œåˆ¶å®šå¼€å‘æµç¨‹ã€Bug å¤„ç†ã€å‘å¸ƒä¸Šçº¿æµç¨‹ï¼Œç”šè‡³åœ¨æ—¥å¸¸å®é™…å¼€å‘çš„å·¥ä½œä¸­ï¼Œå¾€å¾€ä¹Ÿå…ˆå®šä¹‰ API å¥‘çº¦ï¼Œç„¶ååœ¨è”è°ƒæµ‹è¯•æ—¶å†çœŸæ­£å®ç°éªŒè¯ï¼Œè¿™äº›çº¦å®šã€å¥‘çº¦ã€æµç¨‹éƒ½æ˜¯å¯¹åº”æœºåˆ¶åœ¨è½åœ°æ—¶çš„å…·ä½“è¡¨ç°ã€‚ ç«™åœ¨å›¢é˜Ÿçš„è§’åº¦ï¼Œå»ºæœºåˆ¶å°¤ä¸ºé‡è¦ï¼Œä½ è¦é€šè¿‡æœºåˆ¶è®©å›¢é˜Ÿæœ‰ç»Ÿä¸€çš„è¡Œä¸ºä¸è§„åˆ™ï¼Œè®©ç»„ç»‡åƒäººä¸€æ ·ï¼Œè¨€è¡Œä¸¾æ­¢æœ‰è§„å¾‹å¯å¾ªã€‚ å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„æœºåˆ¶ï¼Ÿ è§„åˆ™ç»Ÿä¸€ï¼Œä¸è‡ªç›¸çŸ›ç›¾ ç®€å•æœ‰æ•ˆï¼Œä¾¿äºå¢åˆ  ç´§ç›¯æ•´ä½“ç»“æœï¼Œæœºåˆ¶çš„ ROI è¦è¶³å¤Ÿé«˜ æœºåˆ¶è¦æ€ä¹ˆè½åœ°ï¼Ÿ å…ˆè¯´ whyï¼š å³æœºåˆ¶çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿä½ åœ¨è®¾è®¡æœºåˆ¶æ—¶æ˜¯å¦‚ä½•æ€è€ƒçš„ï¼Ÿ å…±è¯†çš„è¦ä¸ä¸è¦ï¼š å’Œå¤§å®¶è®¨è®ºæˆ‘ä»¬è¦ä¸è¦è¿™æ ·åšï¼Ÿçœ‹çœ‹å¤§å®¶æ˜¯æ€ä¹ˆæƒ³çš„ï¼Œé€šè¿‡å¯¹è¯å’Œå¼•å¯¼å½¢æˆä¸€å®šçš„ç»“è®ºï¼Œæœ‰äº›å†…å®¹éœ€è¦ä¿ç•™ï¼Œæœ‰äº›ä¸åˆç†éœ€è¦å‰”é™¤ï¼Œä¿ƒæˆç»“è®ºæœ€ä¸ºé‡è¦ã€‚ æ‰¿è¯ºè¡Œä¸ºä¸¾æ­¢ï¼š ç¡®è®¤æœºåˆ¶ä¹‹åï¼Œéœ€è¦è®©ç»“è®ºå½¢æˆå¯¹å„è‡ªè¡Œä¸ºçš„çº¦æŸã€‚æ¯”å¦‚ä¸åŒçš„æˆå‘˜è®¤é¢†ä¸åŒçš„è§’è‰²å’Œä»»åŠ¡ï¼Œæˆ–è€…åœ¨ IM ä¸­ä¸€èµ·å…¬å‘Šè§„åˆ™ï¼Œæ€»ä¹‹æ¯ä¸ªæˆå‘˜è¦ä¸æœºåˆ¶çš„å‚ä¸æ„Ÿã€‚ å…ˆè€ƒè™‘ç›®çš„ï¼Œ CodeReview ä¸»è¦æ˜¯è§£å†³ä¸¤æ–¹é¢çš„é—®é¢˜ï¼šæé«˜ä»£ç è´¨é‡ï¼›å¸®åŠ©å¼€å‘åŒå­¦è®¤è¯†åˆ°å¦‚ä½•å†™å‡ºæ›´å¥½çš„ä»£ç ã€‚ ä¸åŒçš„ä¾§é‡ç‚¹è®¾è®¡å‡ºæ¥çš„æœºåˆ¶ä¹Ÿæœ‰æ‰€ä¸åŒï¼ŒæŒ‰ç…§æˆ‘çš„ç†è§£ï¼ŒCodeReview çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯å¸®åŠ©å¤§å®¶æˆé•¿ï¼Œæ‰“é€ å›¢é˜Ÿå†…çš„æŠ€æœ¯æå‡æ°›å›´ï¼Œæ¬¡è¦æ‰æ˜¯ä¿ƒè¿›äº§å“è´¨é‡çš„æå‡ã€‚ ç¡®å®šäº†æ ¸å¿ƒæƒ³è¦è¾¾æˆçš„æ•ˆæœï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç€æ‰‹ç¡®å®šæœºåˆ¶çš„å†…å®¹ï¼Œè¿™é‡Œé¢è¦è€ƒè™‘å‡ ä¸ªæ–¹é¢çš„å†…å®¹ï¼šå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼ˆé˜»åŠ›ï¼‰ã€æœºåˆ¶å®æ–½çš„æˆæœ¬ã€æœºåˆ¶è¿è¡Œçš„æ—¶æœºå’Œå‘¨æœŸã€ç«™åœ¨ä¸€ä¸ªæœºåˆ¶å‚ä¸è€…çš„è§’åº¦è€ƒè™‘ä»–è¦åšä»€ä¹ˆã€‚ å…·ä½“ CodeReview çš„æœºåˆ¶æ–¹æ¡ˆå¯ä»¥å‚è€ƒä¸‹å›¾ï¼š çŸ¥äººå–„ç”¨ï¼šå€Ÿäº‹ä¿®äººï¼Œå€Ÿäººæˆäº‹çŸ¥äººå–„ç”¨çš„ä¸‰ä¸ªå…³é”®ç‚¹ æ‰¾å¯¹äºº åŸ¹å…»äºº å…»æˆäºº æ€ä¹ˆè½åœ°æ‰§è¡Œï¼Ÿ å›¢é˜Ÿç›˜ç‚¹ æ¿€å‘æ„æ„¿ æ”¹å–„è®¡åˆ’ tips ä¸æ€•æ²¡ç¼ºç‚¹ï¼Œå°±æ€•æ²¡ç‰¹ç‚¹ï¼š ä½ å€Ÿäººæˆäº‹ï¼Œä¸èƒ½ä¸€å‘³åœ°å…³æ³¨ä»–çš„ç¼ºç‚¹ï¼Œè€Œæ˜¯è¦å¯»æ‰¾å…¶ç‰¹ç‚¹ï¼Œå‘æŒ¥ä»–çš„æ“…é•¿ç‚¹ï¼Œæœ‰ç¼ºç‚¹ä¸å¯æ€•ï¼Œå°±æ€•æ²¡ç‰¹ç‚¹ã€‚ æ–°äººåšè€äº‹ï¼Œè€äººåšæ–°äº‹ï¼š å¦‚æœåœ¨å›¢é˜Ÿä¸­è€äººä¸€ç›´åšè€äº‹ï¼Œæ–°äººåšæ–°äº‹ï¼Œé‚£ä¹ˆä¼šå‡ºç°è€äººæ²¡æœ‰æ–°çš„æé«˜ï¼Œæ–°äººä¹Ÿè¦å…‹æœå¾ˆå¤šæœªçŸ¥çš„å›°éš¾ï¼›åä¹‹ï¼Œå¯ä»¥é‡æ–°æ¿€å‘è€äººçš„æ´»åŠ›ï¼Œä¹Ÿè®©æ–°äººæœ‰å€Ÿé‰´ä¹‹å¤„ã€‚ ä¸è¦è¶Šä¿ä»£åº–ï¼Œä»€ä¹ˆéƒ½è‡ªå·±ä¸Šï¼š ç”¨äººçš„è¿‡ç¨‹ä¸­ä¼šå‡ºç°â€œäº‹æƒ…åšé”™â€çš„æƒ…å†µï¼Œä¸€æ—¦ä½ å‘ç°è¿™æ ·çš„æƒ…å†µï¼Œåƒä¸‡ä¸è¦ç›´æ¥å»å¸®ä»–çº æ­£ï¼Œè¿™æ ·æ— æ³•å¸®åŠ©å›¢é˜Ÿæˆå‘˜æˆé•¿ï¼Œå›¢é˜Ÿæˆå‘˜åªä¼šå½“çŠ¯é”™è¯¯æ—¶ï¼Œç­‰ç€ä½ æ¥å¸®ä»–è§£å†³ã€‚å¥½çš„ Leaderä¸€å®šæ˜¯è¦åœ¨æ˜çŸ¥å‰æ–¹æœ‰å‘ï¼ˆè¿™ä¸ªå‘ä¸€å®šæ˜¯ä½ èƒ½æ§åˆ¶çš„ï¼‰çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¦è®©å›¢é˜Ÿæˆå‘˜å»è¸©ä¸€å›ï¼Œè®©å…¶æœ‰è¯•é”™çš„æœºä¼šï¼Œè®©æ¯ä¸ªé”™è¯¯éƒ½ç‰©æœ‰æ‰€å€¼ã€‚ ç»™æœºä¼šçš„åŒæ—¶ï¼Œç»™å‹åŠ›å’Œå¸®åŠ©ï¼š å¾ˆå¤šæ—¶å€™å‹åŠ›æ˜¯æˆé•¿çš„å‚¬åŒ–å‰‚ï¼Œæœ‰äº†å‹åŠ›ä¹Ÿå°±æœ‰äº† 120% çš„åŠ¨åŠ›ï¼Œæ‰€ä»¥æŠŠæŸä¸ªä»»åŠ¡æˆ–èŒè´£ç»™åˆ°ä¸€ä¸ªåŒå­¦çš„æ—¶å€™ï¼Œä¹Ÿè¦æŠŠé€‚å½“çš„å‹åŠ›ä¼ é€’è¿‡å»ï¼Œè®©ä»–æ„Ÿå—åˆ°äº‹æƒ…çš„é‡è¦æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ—¶åˆ»å…³æ³¨ï¼Œè¯¥ç»™çš„å¸®åŠ©ä¸€å®šè¦ç»™åˆ°ï¼Œä¸èƒ½ä¸é—»ä¸é—®ã€‚ æ—¢æ•¢äºæ‰¿è®¤é”™è¯¯ï¼Œä¹Ÿå…è®¸åˆ«äººçŠ¯é”™ï¼š è®©ä¸€ä¸ªäººæˆé•¿ä¸å¯èƒ½å®Œå…¨ä¸è®©ä»–çŠ¯é”™ï¼Œæœ‰æ—¶ä¸€äº›å¯æ§çš„é”™è¯¯åè€Œå¯èƒ½æ˜¯äº‹åçœ‹æœ€å¤§çš„æ”¶è·ã€‚åŒæ—¶ï¼Œä¹Ÿä¸è¦è®¤å®šè‡ªå·±ä¹‹å‰çš„åšæ³•éƒ½æ˜¯å¯¹çš„ï¼Œè¦æ„è¯†åˆ°ï¼Œå“ªæ€•ä½ ä¹‹å‰åšæˆåŠŸè¿‡ï¼Œä¹Ÿä¸æ„å‘³ç€ä½ å°±ä¸€å®šæ˜¯100%æ­£ç¡®çš„ã€‚å¥½çš„ Leader åœ¨åŸ¹å…»å›¢é˜Ÿæˆå‘˜æ—¶ï¼Œæ—¢è¦è®©å›¢é˜Ÿä¸æ€•çŠ¯é”™ï¼ˆæ•¢å¹²äº‹ï¼‰ï¼Œä¹Ÿè¦æ•¢äºæ‰¿è®¤è‡ªå·±ä¸è¶³ï¼Œå»æ”¹å–„å»æé«˜ã€‚ æ‰¾åˆ°äººï¼šæ‹›è˜æ˜¯ Leader çš„è´£ä»»ï¼Œä¸æ˜¯ HR çš„æ‹›äººä¸ç­‰äºç›²ç›®åŠ äººæ˜ç¡®ä¸šåŠ¡ç›®æ ‡ï¼›ç›˜ç‚¹å›¢é˜Ÿéœ€æ±‚ï¼›åšå‡ºå²—ä½è®¾è®¡ï¼›æç‚¼å²—ä½è¦æ±‚ã€‚ é—»å‘³é“ã€é—®äº‹å®ã€çœ‹èƒ½åŠ›é¢è¯•å‰çœ‹ç®€å†ï¼Œé¢è¯•ä¸­æ›´å¤šå€¾å¬ï¼Œé¢è¯•åé€Ÿå†™è¯„ä»·ã€‚ é—®äº‹å®ï¼ˆSTARæ³•åˆ™ï¼Œçœ‹å€™é€‰äººæ‰€è¯´çš„å†…å®¹æ˜¯å¦çœŸæ­£åšè¿‡ï¼Œä»¥åŠæ€è€ƒè¿‡ç¨‹ï¼‰ çœ‹èƒ½åŠ› é—»å‘³é“ï¼ˆæ˜¯å¦å’Œå›¢é˜ŸåŒ¹é…ï¼‰ å®ç¼ºæ¯‹æ»¥ï¼Œå®ˆä½åº•çº¿å…³æ³¨æœªæ¥ ä»–æ˜¯å¦æœ‰èƒ½åŠ›çš„åŒæ—¶è¿˜æœ‰æ½œåŠ›ï¼Ÿæ¯”å¦‚å¾ˆå¼ºçš„å‘å±•æ¬²æœ›æˆ–å­¦ä¹ èƒ½åŠ›ï¼Ÿ ä»–èº«ä¸Šæ˜¯å¦æœ‰ç‰¹è´¨è¶³å¤Ÿå¸å¼•ä½ ï¼Ÿæ¯”å¦‚è®©ä½ è§‰å¾—å½“ä»–æœªæ¥ä¼šæ¯”ä½ æ›´ä¼˜ç§€ï¼Ÿ ä½ æ˜¯å¸Œæœ›ä¸ä»–è¿™æ ·çš„äººä¸€èµ·å…±äº‹çš„ï¼Ÿ å½“ä»–åŠ å…¥å›¢é˜Ÿåï¼Œèƒ½å¦å°†å›¢é˜Ÿæ°›å›´æ¿€æ´»ï¼Œå½¢æˆé²¶é±¼æ•ˆåº”ï¼Ÿ å®ç¼ºæ¯‹æ»¥ èƒ½åŠ›æ°´å¹³è¶…è¿‡å›¢é˜Ÿ 50% çš„äººä»¥ä¸Šï¼šç¡®ä¿å›¢é˜Ÿè¶Šæ¥è¶Šå¼ºï¼Œè€Œä¸æ˜¯è¶Šæ¥è¶Šå¼±ï¼Œæœ‰çš„ Leaderä¼šè§‰å¾—å€™é€‰äººæ¯”å›¢é˜Ÿæœ€å·®çš„ä¸¤ä¸ªäººå¥½å°±å¯ä»¥äº†ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œéšç€æ—¶é—´æ‹‰é•¿ï¼Œä½ çš„å›¢é˜Ÿä¼šè¶Šæ¥è¶Šå·®ã€‚ å†…å¿ƒæ˜¯å¦éå¸¸çŠ¹è±«ï¼ŸçŠ¹è±«å¾€å¾€æ„å‘³ç€â€œä¸æƒ³è¦ &gt; æƒ³è¦â€ï¼Œå¦‚æœæ˜¯è¿«äºä¸šåŠ¡å‹åŠ›ä¸å¾—ä¸åŠ äººï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯ä¸è¦å‹‰å¼ºï¼Œå› ä¸ºæœ‰å¯èƒ½æœ¬æ¥è§£å†³ä¸šåŠ¡å‹åŠ›å°±å¯ä»¥çš„é—®é¢˜æ¼”å˜æˆè¿˜è¦é¢å¤–è§£å†³ä¸é€‚åˆçš„æ–°å‘˜å·¥çš„é—®é¢˜ã€‚ èƒ½è½åœ°ï¼š90 å¤©è¯•ç”¨æœŸï¼Œè½¬æ­£æ—¶æˆ‘ä»¬è¦è€ƒå¯Ÿä»€ä¹ˆï¼Ÿ æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥ é‡ç‚¹æŠ“è¯•ç”¨æœŸè€ƒæ ¸ä»¥åŠå·¥ä½œä¹ æƒ¯çš„å…»æˆ è½¬æ­£ç»“æŸåä¾ç„¶ä¿æŒè·Ÿè¿› æ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥â€œæ—¢è¦å¸®ï¼Œä¹Ÿè¦ä¸¥â€æ˜¯æˆ‘å®šä¹‰çš„â€œèƒ½è½åœ°â€çš„æ ¸å¿ƒåŸåˆ™ï¼Œâ€œå¸®â€ä¸â€œä¸¥â€æ˜¯åŒå‘è¦æ±‚ï¼šå¸®æ˜¯æŒ‡å¸®åŠ©æ–°åŒå­¦èå…¥å›¢é˜Ÿï¼ˆé’ˆå¯¹çš„æ˜¯å¸ˆå…„å’Œ Leaderï¼‰ï¼›ä¸¥æ˜¯è¦è®©æ–°åŒå­¦åœ¨å›¢é˜Ÿä¸­æå‡è‡ªå·±ï¼Œéµå®ˆå›¢é˜Ÿçš„åšäº‹åŸåˆ™ï¼Œå‘æŒ¥è‡ªå·±çš„èƒ½åŠ›ä¸ä»·å€¼ï¼ˆé’ˆå¯¹æ–°åŒå­¦è‡ªå·±ï¼‰ã€‚ æ‹›è˜åªæ˜¯å¼€å§‹ï¼Œè®©æ–°åŒå­¦èƒ½è½åœ°ã€å‘æŒ¥ä»·å€¼æ‰æ˜¯æœ€ç»ˆç›®æ ‡ã€‚ æ˜ç¡®æ–°åŒå­¦è½åœ°çš„æ•´ä½“èŠ‚å¥ ç”¨è¿æ–°æ‰“ç ´å¤§å®¶åœ¨æƒ…æ„Ÿä¸Šçš„å£å’ï¼› ç»™æ–°åŒå­¦å®‰æ’â€œå¸ˆå…„â€ï¼› æ˜ç¡®æ–°åŒå­¦çš„ä½œä¸šä¸ç›®æ ‡ï¼ˆåšå‡ºä¸€äº›æˆç»©è¾¾åˆ°è½¬æ­£ï¼‰ï¼› æ˜ç¡®å‘ŠçŸ¥è½¬æ­£åº”è¯¥æ€ä¹ˆåšï¼ˆæŠŠè½¬æ­£åšé‡ã€åšå®ï¼‰ã€‚ è½¬æ­£è¿°èŒè¦è€ƒæ ¸ä»€ä¹ˆè½¬æ­£è¿°èŒæ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æ‹›è˜ç»“æŸï¼ æŠŠæ§è½¬æ­£æ—¶é—´ï¼š æå‰åŠä¸ªæœˆè·Ÿ HR æˆ–è€…â€œå¸ˆå…„â€ç¡®å®šè½¬æ­£è¿°èŒæ—¶é—´ç‚¹ã€‚ å»ºç«‹è¯„å§”ä¼šï¼š ç”± Leader ä¸»å¯¼ï¼Œä¸å…¶åˆä½œçš„ä¼™ä¼´ï¼ˆæŠ€æœ¯åŒå­¦ã€äº§å“æˆ–è€…è¿è¥ï¼‰ç»„æˆå°çš„è¯„å§”ä¼šï¼ˆå¦‚æœå›¢é˜Ÿæˆå‘˜è¾ƒå°‘ï¼Œä¹Ÿå¯ä»¥åªæœ‰ Leader å’Œ HRï¼‰è¿™é‡Œè¦æ³¨æ„ï¼Œåˆä½œä¼™ä¼´çš„åé¦ˆä¹Ÿè®¸ä¼šæ¯”è¾ƒä¸»è§‚ï¼Œä½ åœ¨å‚è€ƒæ—¶è¦å°½é‡ä¿æŒå®¢è§‚ã€‚ æ˜ç¡®è€ƒæ ¸å†…å®¹ï¼š ç¡¬æ€§è¦æ±‚+è½¯æ€§è¦æ±‚ã€‚ æˆé•¿æœŸçš„è·Ÿè¿›æ…¢æ…¢å åŠ ã€ä¸»åŠ¨è·Ÿè¿›ã€æ ‘ç«‹ä¿¡å¿ƒ å‡çº§æ±°æ¢ï¼šâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€å¼€é™¤äººâ€œå¿ƒè¦æ…ˆï¼Œåˆ€è¦å¿«â€ No Surpriseï¼š ä¸è¦çªç„¶Fireä¸€ä¸ªäººï¼ˆç¦»èŒä¸€å®šä¸æ˜¯ä¸€ä¸ªçªå‘è¡Œä¸ºï¼‰ï¼Œæ²¡æœ‰ä»»ä½•å¾å…†å‘Šè¯‰å‘˜å·¥ Aâ€œä½ è¢«å¼€é™¤äº†â€ï¼Œè¿™æ˜¯å…¸å‹çš„ç®¡ç†å¤±èŒã€‚å¦‚æœAå­˜åœ¨é—®é¢˜ï¼Œä½ åº”è¯¥å…ˆå‘ŠçŸ¥ï¼Œç„¶åä¸€è¾¹å’Œä»–ä¸€èµ·åˆ¶å®šæ”¹å–„è®¡åˆ’ï¼Œä¸€è¾¹ç£ä¿ƒå…¶æ”¹æ­£ã€‚ç¦»èŒå¾€å¾€æ˜¯ä¸€ä¸ªå¯é¢„æœŸçš„ç»“æœï¼Œæ— æ³•æ»¡è¶³å·¥ä½œéœ€è¦æˆ–è€…å¯¹å›¢é˜Ÿæœ‰å…¶ä»–ä¼¤å®³è€Œ A ä¾æ—§æ— æ³•æ”¹å˜æ—¶ï¼Œä¸ºäº†é¿å…å¯¹å›¢é˜Ÿäº§ç”ŸæŒä¹…ä¸åˆ©çš„å½±å“ï¼Œå°±éœ€è¦è®©ä»–ç¦»å¼€ã€‚ å¿ƒè¦æ…ˆã€åˆ€è¦å¿«ï¼š æ°å…‹Â·éŸ¦å°”å¥‡ï¼ˆJack Welchï¼‰æ›¾ç»è¯´è¿‡è¿™æ ·ä¸€å¥è¯â€œå¦‚æœä¸€ä¸ªäººåˆ°äº†ä¸­å¹´ä¹‹åï¼Œè¿˜æ²¡æœ‰è¢«å‘ŠçŸ¥è‡ªå·±çš„å¼±ç‚¹ï¼Œåè€Œåœ¨æŸä¸€å¤©å› ä¸ºèŠ‚çº¦æˆæœ¬çš„åŸå› è¢«è£æ‰äº†ï¼Œè¿™æ˜¯æœ€ä¸å…¬å¹³ã€æœ€ä¸åº”è¯¥å‘ç”Ÿçš„äº‹æƒ…ã€‚å°±æ˜¯å› ä¸ºè¿™ä¸ªå…¬å¸å¤ªä»æ…ˆäº†ï¼Œä»–è¿å‡ºå»æ‰¾å·¥ä½œã€æå‡è‡ªæˆ‘çš„å¯èƒ½æ€§å’Œæœºä¼šéƒ½æ²¡æœ‰ã€‚â€ä½ å¯èƒ½è§‰å¾—ï¼Œåœ¨æƒ…æ„Ÿä¸Šè§£è˜ä¸€ä¸ªäººéå¸¸ç³Ÿç³•ï¼Œä½†æ˜¯æ¢ä¸€ä¸ªè§’åº¦æƒ³ï¼Œå¦‚æœä½ å¯¹ä¸€ä¸ªäººå¾ˆä¸æ»¡æ„ï¼Œå´åˆä¸æ‰¾ä»–è°ˆè¯ï¼Œä¸è¦æ±‚ä»–æ”¹è¿›ï¼Œåˆä¸å¼€é™¤ä»–ï¼Œé‚£ä¹ˆä»æœ€ç»ˆç»“æœçœ‹ä¸ä»…å¯¹ä»–å¾ˆæ®‹é…·ï¼Œè¿™ç§â€œæ‹‰é”¯æˆ˜â€å¯¹å›¢é˜Ÿä¹Ÿæ˜¯ä¸è´Ÿè´£ä»»çš„ã€‚ Happy stayã€Happy goï¼š å¾ˆå¤šæ—¶å€™ï¼Œé€èµ°ä¸€ä¸ªåŒå­¦å¯¹å½¼æ­¤æ¥è¯´å¹¶ä¸æ˜¯ä¸€ä»¶ç³Ÿç³•çš„äº‹ï¼Œæ¢ä¸ªè§’åº¦çœ‹ï¼Œå¦‚æœä»–åœ¨å½“å‰ç¯å¢ƒä¸‹ä¸€ç›´æ— æ³•é€‚é…å›¢é˜Ÿï¼Œå¯¹ä»–æ¥è¯´ä¹Ÿæ˜¯å¾ˆéš¾å—çš„ï¼Œè¿™æ—¶åˆ†å¼€å¯¹ä»–å¯¹å›¢é˜Ÿéƒ½æ˜¯è§£è„±ã€‚å°¤å…¶æ˜¯å½“å…¬å¸å‡ºç°å˜åŒ–æ—¶ï¼Œå¦‚æœä¸€äº›åŒå­¦ä¸å†åˆé€‚ï¼Œæ¢ç¯å¢ƒæ¥è®²å¯¹ä»–æ˜¯æ–°çš„æœºä¼šï¼Œæ‰€ä»¥ä½ ä¸è¦å­˜åœ¨å¤ªå¤šçš„æƒ…ç»ªï¼Œè€Œæ˜¯è¦å¾€â€œå¥½èšå¥½æ•£â€çš„æ–¹å‘ä¸Šæ¨åŠ¨ã€‚ ä¸è¦ç»™â€œç™½å…”â€ç”Ÿå­˜æœºä¼š ç™½å…”çœ‹èµ·æ¥äººç•œæ— å®³ï¼Œç¹æ®–èƒ½åŠ›æå¼ºï¼Œå¤§å…¬å¸é‡Œæœ€å®¹æ˜“å­˜åœ¨çš„å°±æ˜¯â€œç™½å…”â€ï¼ˆä¸å¹²æ´»çš„å¥½äººï¼‰ã€‚ä»–ä»¬ç›®æ ‡å’Œä»·å€¼è§‚è®¤åŒåº¦è¾ƒé«˜ï¼Œä½†æ˜¯ä¸šç»©é•¿æœŸæ‹–åè…¿ã€‚æ¯ä¸€å®¶å…¬å¸éƒ½æœ‰è¿™æ ·çš„äººï¼Œçœ‹ç€å‹¤å‹¤æ³æ³ï¼Œä½†å´æ‹¿ä¸åˆ°ä»»ä½•ç»“æœï¼Œå¦‚æœä½ çºµå®¹ç™½å…”çš„å­˜åœ¨ï¼Œé‚£ä¹ˆé•¿ä¹…ä¸‹å»ï¼Œå¾ˆå®¹æ˜“æ»‹ç”Ÿä¸€ç¾¤ç™½å…”ç£¨æ´‹å·¥ï¼Œé’ˆå¯¹è¿™ç±»å‘˜å·¥ï¼Œä½ å‰æœŸå¯ä»¥ç»™äºˆæ”¹æ­£çš„æœºä¼šï¼Œå¦‚æœä¾æ—§æ²¡æœ‰æ”¹å–„ï¼Œåº”è¯¥æ¯«ä¸çŠ¹è±«å°†å…¶é€èµ°ã€‚ ç¦»èŒé¢è°ˆâ€œTRFâ€ Train himã€Remove himã€Fire him Train him æ˜¯æŒ‡å¦‚æœä»–èƒ½åŠ›è·Ÿä¸ä¸Šï¼Œä½ å¯ä»¥ç»™äºˆå…¶å¸®åŠ©ï¼›Remove him æ˜¯æŒ‡å¦‚æœä»–çš„èƒ½åŠ›å’Œå²—ä½åŒ¹é…æœ‰é—®é¢˜ï¼Œä½ è¦æ›´å¤šåœ°é‡‡ç”¨è½¬å²—çš„æ–¹å¼ï¼Œä¸ºä»–çš„å‘å±•æ‰“å¼€ç©ºé—´ï¼›å¦‚æœåœ¨ä½ ç»™äºˆä»–æœºä¼šä¹‹åï¼Œä»–è¿˜æ˜¯æ— æ³•æ”¹å–„ï¼Œé‚£ä½ å°±åº”è¯¥ Fire himã€‚ éœ€è¦é¿å…çš„ï¼š â€œè°ˆä¸äº†â€ï¼šè¾é€€çš„äº‹å®ä¾æ®ä¸å……åˆ†ï¼Œå¯¹ç¦»èŒåŸå› è®²ä¸æ¸…æ¥šã€‚ â€œæ— é‡ç‚¹â€ï¼šå¯¹æœ‰å…³é—®é¢˜é¿é‡å°±è½»ï¼Œåªè¯´æ— å…³ç—›ç—’çš„ç¥ç¦ã€‚ â€œæ²¡æŠ€å·§â€ï¼šå¯¹å‘˜å·¥å·¥ä½œæ¨ªåŠ æŒ‡è´£ï¼Œé¢è°ˆå®Œåè€ŒåŠ æ·±äº†çŸ›ç›¾ã€‚ â€œä»ä¸è°ˆâ€ï¼šæ˜¯å¯¹å‘˜å·¥å­˜åœ¨å¾ˆå¤§åè§ï¼Œä¸é¢è°ˆç›´æ¥ä¸€æ‹ä¸¤æ•£ã€‚ æŠ€æœ¯ç®¡ç†çš„å¸¸è§ç—›ç‚¹æ™‹å‡ï¼šæ˜¯ä¸æ˜¯æŠ€æœ¯åˆ°ä½ã€é¡¹ç›®åšå¥½å°±å¤Ÿäº†ï¼Ÿç»è¿‡å¤šå°‘â€œå…³â€æ‰èƒ½æ™‹å‡ï¼Ÿæ™‹å‡æ­¥éª¤ï¼š æ™‹å‡å¯åŠ¨â€”â€”ä¸»ç®¡æåâ€”â€”éƒ¨é—¨ææŠ¥â€”â€”è¿°èŒç­”è¾©â€”â€”ç»“æœè¡¨å†³â€”â€”å…¬å¸å¤å®¡â€”â€”ç»“æœå…¬å¸ƒ æåæ²Ÿé€šå¯ä»¥åœ¨è–ªèµ„ã€å¹´ç»ˆå¥–ç­‰æ¿€åŠ±ä¸Šä½“ç°è‡ªå·±å¯¹è‹¦åŠ³åŒå­¦çš„å…³æ³¨ï¼Œè€Œå¯¹äºæƒ³è¦æ™‹å‡çš„åŒå­¦ï¼Œåº”è¯¥æ›´å¤šç»™ä»–èƒ½åŠ›åŸ¹å…»çš„æœºä¼šï¼Œå› ä¸ºå¯¹æŠ€æœ¯åŒå­¦è€Œè¨€ï¼ŒæŠ€æœ¯æ˜¯æ™‹å‡çš„åŸºç¡€ï¼Œæˆ˜åŠŸä¸ä¸šç»©ä¹Ÿç¼ºä¸€ä¸å¯ï¼Œåè€…æ˜¯ä¸ºäº†è¯æ˜è‡ªå·±çš„èƒ½åŠ›å’Œæ‹…å½“è¶³ä»¥æ‰¿è½½æ›´å¤šèŒè´£ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹è‹¦åŠ³ä¸ç­‰äºåŠŸåŠ³ï¼Œæ˜¯å¦å…·å¤‡ä¸‹ä¸€ä¸ªè§’è‰²æ‰€éœ€è¦çš„æ¡ä»¶æ‰æ˜¯æ™‹å‡è€ƒæ ¸çš„ä¾§é‡ç‚¹ã€‚ èµ„æ–™å‡†å¤‡4 ä¸ªå…³é”®è¯ï¼šèµ„æ–™ç´ ææ¥æºã€è¯æ˜å®åŠ›ã€PPTç¼–å†™ã€èµ›å‰æ¼”ç»ƒä¸å¿ƒç†è¾…å¯¼ ç´ ææ¥æºäºâ€œè¿‡å»è´¢å¹´æ€»ç»“ + æ–°è´¢å¹´çš„è§„åˆ’ + æ±‡æŠ¥ææ–™ + åˆ†äº«ææ–™ + é¡¹ç›®æ€»ç»“â€ï¼Œå› ä¸ºç»è¿‡æ²‰æ·€çš„èµ„æ–™æ‰æœ€æœ‰ä»·å€¼ã€‚æœ‰äº†ä¸€äº›ç´ æèµ„æ–™åï¼Œå°±è¦æŠŠæ§å‡†å¤‡é˜¶æ®µçš„æ ¸å¿ƒï¼šé€šè¿‡ç´ æå»è¯æ˜ä½ å…·å¤‡ä¸‹ä¸€èŒçº§æ‰€éœ€è¦çš„èƒ½åŠ›ã€‚ å›´ç»• 5 ä¸ªç»´åº¦ï¼ˆæ¶æ„èƒ½åŠ›ã€ç»†èŠ‚æŠŠæ§çš„èƒ½åŠ›ã€å·¥ç¨‹çš„èƒ½åŠ›ã€å›¢é˜Ÿçš„èƒ½åŠ›ã€æŠ€æœ¯è§†é‡ï¼‰å»æ¢³ç†å’Œæç‚¼å…³é”®ä¿¡æ¯ï¼Œå‡†å¤‡ç›¸å…³èµ„æ–™ã€‚ ç¼–å†™ PPT å°†è¯æ˜ä½ èƒ½åŠ›çš„æ¡†æ¶å¯è§†åŒ–ï¼Œçªå‡ºé‡ç‚¹ã€å†…å®¹ç¿”å®ã€æ•°æ®è¯´è¯ã€åŠŸåŠ³å¤§äºè‹¦åŠ³ã€çªå‡ºè‡ªæˆ‘ã€‚ åœ¨å›¢é˜Ÿå†…éƒ¨è®©æœ‰æåçš„åŒå­¦é¢„æ¼”ä¸€éè‡ªå·±å‡†å¤‡çš„å†…å®¹ï¼Œå…¶ä½™åŒå­¦ä»ä¸­æŒ‡å‡ºå­˜åœ¨çš„é—®é¢˜ï¼ˆæ˜¯å¦ç´§å¼ ã€æ˜¯å¦çªå‡ºäº®ç‚¹â€¦â€¦ï¼‰äº‰å–è®©ä»–è„±ç¨¿ï¼Œé€»è¾‘ä¸¥è°¨ï¼Œå‡å°‘ç´§å¼ æ„Ÿï¼›ä¸€äº›åŒå­¦ä¼šæ ¼å¤–åœ¨æ„æ™‹å‡è¿™ä»¶äº‹ï¼Œæ‚£å¾—æ‚£å¤±ï¼Œæ‰€ä»¥ Leader è¦å¸®ä»–å¹³ç¼“å¿ƒæ€ï¼Œå¸®åŠ©å…¶å»ºç«‹æ­£ç¡®çš„è®¤çŸ¥ï¼šæŠŠæ™‹å‡å½“ä½œä¸€æ¬¡åˆ†äº«å’Œæ€»ç»“ï¼Œå°±å½“æ˜¯å¯¹è¿‡å»ä¸€æ®µæ—¶é—´çš„å›é¡¾ï¼Œä¸ç®¡ç»“æœå¦‚ä½•ï¼Œæ€»æœ‰æ‰€æ”¶è·ã€‚ æ™‹å‡ç­”è¾© æ‹¿ç»“æœçš„èƒ½åŠ›ï¼š æ¸…æ™°çš„å®¢æˆ·ä»·å€¼äº§å‡ºï¼Œæœ‰æ€è€ƒæ²‰æ·€å’Œå¯å¤åˆ¶çš„æ–¹æ³•è®ºï¼› ä¸šåŠ¡ç†è§£èƒ½åŠ›ï¼š å®¢æˆ·è§†è§’ã€å‰ç»æ€§æ€è€ƒä¸åˆ¤æ–­ã€å¯ä»¥æŒç»­æå‡å®¢æˆ·ä»·å€¼ã€‚ ç»“æœå®‰æ’æ™‹å‡ç­”è¾©ä¹‹åï¼Œæ— å¤–ä¹ä¸¤ä¸ªç»“æœï¼šæ™‹å‡æˆåŠŸã€å¤±è´¥ã€‚ä½œä¸º Leaderï¼Œä½ éœ€è¦è®©å€™é€‰äººè®¤è¯†åˆ°è¿™ä¸¤ç§ç»“æœï¼Œå¹¶å‘ŠçŸ¥å°½æœ€å¤§çš„åŠªåŠ›ï¼Œè€ƒè™‘æœ€åçš„ç»“æœï¼Œé¿å…å½¢æˆè½å·®ï¼Œå€™é€‰äººç¦»èŒï¼›å¦‚æœå€™é€‰äººæ™‹å‡æˆåŠŸï¼Œç®€å•åº†ç¥è¿‡åï¼Œè¿˜éœ€è¦ä¸ºå…¶æ–°è§’è‰²æ˜ç¡®æ–°çš„è¦æ±‚å’ŒèŒè´£ï¼Œè®©ä»–æœ‰æ›´æ˜ç¡®çš„åŠªåŠ›æ–¹å‘ï¼Œåœ¨å›¢é˜Ÿå†…å‘æŒ¥æ›´å¤§çš„ä½œç”¨ï¼Œä¸è¦æŠŠæ™‹å‡å½“ä½œç»ˆç‚¹ï¼Œè€Œæ˜¯åé¢å·¥ä½œçš„èµ·ç‚¹ã€‚ æ™‹å‡ä¸æ˜¯å¥–åŠ±ï¼Œæ˜¯è´£ä»»ä¸æ‹…å½“ï¼Œæ˜¯ä¸ºæœªæ¥åšçš„äº‹ã€‚ è·¨å›¢é˜Ÿï¼šæ²¡æœ‰æ±‡æŠ¥çº¿çš„äººå’Œäº‹å°±æ˜¯æ¨ä¸åŠ¨ï¼Ÿè·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„éš¾ç‚¹ æ–¹æ¡ˆæ— æ³•è¾¾æˆä¸€è‡´ï¼š ä½ æå‡ºçš„ A æ–¹æ¡ˆä¸è¿è¥å›¢é˜Ÿæå‡ºçš„ B æ–¹æ¡ˆï¼Œåœ¨å®ç°æˆæœ¬ã€æ–¹å¼ã€èµ„æºç­‰æ–¹é¢å­˜åœ¨å¾ˆæ˜æ˜¾å·®å¼‚ï¼Œé™·å…¥åƒµå±€ã€‚ æ—¶é—´æ— æ³•è¾¾æˆä¸€è‡´ï¼š åä½œæ–¹èµåŒ A æ–¹æ¡ˆï¼Œä½†å¯¹â€œä¸€å‘¨ä¸Šçº¿é¡¹ç›®â€çš„æ—¶é—´èŠ‚ç‚¹æœ‰æ„è§ï¼Œè®¤ä¸ºè‡³å°‘éœ€è¦ 20 å¤©ï¼Œè¿™ä¼šä»â€œæ—¶é—´æ— æ³•è¾¾æˆä¸€è‡´â€å›æ»šåˆ°â€œæ–¹æ¡ˆæ— æ³•è¾¾æˆä¸€è‡´â€ï¼Œé™·å…¥æ–°ä¸€è½®åƒµå±€ã€‚ ä¼˜å…ˆçº§æ— æ³•è¾¾æˆä¸€è‡´ï¼š åä½œæ–¹èµåŒ A æ–¹æ¡ˆï¼Œå¯¹é¡¹ç›®ç”¨æ—¶ä¸€å‘¨ä¹Ÿæ— å¼‚è®®ï¼Œä½†è¯¥é¡¹ç›®ä¼˜å…ˆçº§åœ¨ä»–é‚£å„¿æ²¡æœ‰æåˆ°å¾ˆé«˜ï¼Œä¸€ç›´æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„é¡¹ç›®æ’é˜Ÿï¼Œå¯¼è‡´äº¤ä»˜æ—¶é—´ä¸€å˜å†å˜ã€ä¸€æ‹–å†æ‹–ã€‚ é˜¶æ®µæ€§äº¤ä»˜ç»“æœä¸ä¸€è‡´ï¼š å› ä¸ºæŸäº›åŸå› ï¼ˆçº¿ä¸Šçªå‘çŠ¶å†µã€åŒå­¦è¯·å‡ã€äººå‘˜èƒ½åŠ›è¾ƒå·®â€¦â€¦ï¼‰ï¼Œä¸ä½ åä½œå›¢é˜Ÿåœ¨é…åˆæ—¶äº¤ä»˜ä½ çš„ç»“æœè´¨é‡æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¿è¥ç»™çš„æ–¹æ¡ˆæœ‰å¾ˆå¤§æ¼æ´ã€æŠ€æœ¯ç»™çš„æ¥å£ Bug æ¯”åŠŸèƒ½ç‚¹è¿˜å¤šï¼Œä½ åˆæ— æ³•ç›´æ¥ç®¡ç†å¯¹æ–¹å›¢é˜Ÿçš„æˆå‘˜ï¼Œæœ€ç»ˆå³ä½¿æ›´æ­£äº†ä¹Ÿå¯èƒ½æµªè´¹äº†é¢å¤–çš„æ—¶é—´ã€‚ éš¾ç‚¹äº§ç”Ÿçš„åŸå› ï¼š åä½œæ–¹ä¸æ¸…æ¥šé¡¹ç›®åŸå› å’Œæ„ä¹‰ï¼Œä¼šä¼˜å…ˆè€ƒè™‘è‡ªèº«åˆ©ç›Šï¼Œæ ¹æ®åˆ©ç›Šé«˜ä½æ¨è¿›éš¾åº¦ç”±æ˜“åˆ°éš¾ åä½œæ–¹æœ‰è‡ªå·±å½“å‰çš„å·¥ä½œå†…å®¹å’Œä¼˜å…ˆçº§ï¼Œçªç„¶é…åˆè¿›è¡Œå…¶ä»–äº‹åŠ¡ï¼Œå¼•å…¥çš„é£é™©å¾€å¾€è¾ƒé«˜ å„éƒ¨é—¨å¯¹å½¼æ­¤ä¹‹é—´çš„å·¥ä½œæ–¹å¼ã€å›¢é˜Ÿç»éªŒä»¥åŠå½“å‰ç°çŠ¶å¾€å¾€ä¸äº†è§£ ä»»åŠ¡ç»†åŒ–ï¼Œè·¨å›¢é˜Ÿåˆä½œå—æ—¶é—´ã€ç©ºé—´ç­‰å› ç´ å½±å“æ²Ÿé€šæˆæœ¬è¾ƒé«˜ï¼Œæœ‰äº›é—®é¢˜ä¸çŸ¥é“è¯¥æ‰¾è° è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸºæœ¬æ€åº¦ ä¸è¦åšæƒ…ç»ªçš„å¥´éš¶ï¼Œå…ˆæ‰¾è‡ªå·±çš„é—®é¢˜ å¿«åˆ€æ–©ä¹±éº»ï¼Œé¿å…å› å¤æ‚çš„é—®é¢˜é™·å…¥æ²¼æ³½ æ…¢æ€è€ƒï¼Œå¿«æ‰§è¡Œ å€ŸåŠ›å‰è¡Œï¼Œæ‘†äº‹å®è®²é“ç†ï¼Œå‡­èŒçº§ï¼Œè¡Œè¿›åŠæ³•ï¼Œè¾¾æˆç›®æ ‡ã€‚ è·¨å›¢é˜Ÿäº‹åŠ¡æ¨è¿›çš„åŸåˆ™æ–¹æ³• åˆä½œå‰ï¼ˆæ˜ç¡®ç›®æ ‡ï¼Œç¡®ä¿ä¿¡æ¯å®Œæ•´ï¼‰ åˆä½œä¸­ï¼ˆå®šä½é—®é¢˜ï¼Œå€ŸåŠ¿è€Œä¸ºï¼‰ åˆä½œåï¼ˆæ‰¿æ‹…è´£ä»»ï¼Œå…¬å¼€è‚¯å®šï¼‰ æ¢ä½æ€è€ƒã€æ‘†äº‹å®ã€è®²é“ç†ã€å‡­èŒçº§ã€å€ŸåŠ¿è€Œè¡Œã€æƒ³å°½åŠæ³•è¾¾æˆç›®æ ‡ã€‚ åšè§„åˆ’ï¼šé™¤äº†äº¤ä»˜å’Œç¨³å®šæ€§ï¼Œè¿˜è¦è§„åˆ’ä»€ä¹ˆï¼Ÿå›¢é˜Ÿè§„åˆ’è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼šè®©ä½ åœ¨æœ‰é™çš„æ—¶é—´å’Œèµ„æºå†…ï¼Œæ˜ç¡®æ€ä¹ˆå»åˆ›é€ æœ€å¤§çš„æŠ€æœ¯ä»·å€¼ï¼ˆROIï¼‰ã€‚è€Œä¸”åœ¨åšå›¢é˜Ÿè§„åˆ’çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®æ˜¯ä¸€ä¸ªæ·±å…¥æ€è€ƒã€æ¢³ç†çš„è¿‡ç¨‹ï¼Œä½ å¯ä»¥å¤ç›˜è¿‡å»ã€æ¢³ç†å½“ä¸‹ã€å±•æœ›æœªæ¥ï¼Œå°‘èµ°å¼¯è·¯ã€‚ åšè§„åˆ’è¦è€ƒè™‘å›¢é˜Ÿç°çŠ¶ æ˜ç¡®å®šä½ä¸èŒè´£ äººå‘˜æƒ…å†µ ä¸šåŠ¡æƒ…å†µ ä¸€ä¸ªå¯ä»¥å‚è€ƒçš„æ€è·¯æ˜¯ï¼š ç›¯ç€ä¸šåŠ¡ç›®æ ‡å»å»¶å±•äººå‘˜å’Œä¸šåŠ¡ï¼Œä»è€Œåˆ¤æ–­å“ªäº›æ˜¯ä¾èµ–é¡¹ï¼Œå“ªäº›æ˜¯å‰ç½®é¡¹ï¼Ÿåœ¨å¤§éƒ¨åˆ†å…¬å¸ä¸­ï¼ŒæŠ€æœ¯å¾ˆéš¾ç›´æ¥åˆ›é€ å•†ä¸šä»·å€¼ï¼Œå¾€å¾€è¿˜æ˜¯è¦ä¾èµ–äºä¸šåŠ¡ï¼Œæ‰€ä»¥æŠŠä¸šåŠ¡ä½œä¸ºç¬¬ä¸€ç›®æ ‡ï¼Œä¸ºäº†è¾¾æˆæŸä¸ªä¸šåŠ¡ç»“æœï¼Œéœ€è¦è°ƒæ•´äººå‘˜ç»“æ„ï¼Œæ‹›è˜ä¸€äº›æ›´å‰å®³çš„äººæ±°æ¢ä¸€äº›ä¸è¡Œçš„äººï¼Œç ”ç©¶å¹¶å®ç°ä¸€äº›æ–°æŠ€æœ¯ï¼Œè¿™æ˜¯æ¯”è¾ƒè‡ªç„¶çš„ã€‚ ä½ çš„è§„åˆ’ä¸­åŒ…å«äº†ä»€ä¹ˆï¼Ÿä¸åŒçš„æŠ€æœ¯å›¢é˜Ÿï¼Œåœ¨è§„åˆ’æ—¶æ‰€æ‹Ÿå®šçš„å†…å®¹éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†ä½ å…¶å®éƒ½å¯ä»¥æç‚¼æˆå…±æ€§çš„3 éƒ¨åˆ†ã€‚ ä¸šåŠ¡ç»“æœï¼š ç›´ç™½è¯´å°±æ˜¯ä¸šåŠ¡å±‚é¢çš„æˆ˜ç»©ï¼Œä½ å›¢é˜Ÿæ‰“é€ äº†ä¸€ä¸ªå…¬å¸ GMV å æ¯”è¶…è¿‡ 50%çš„å•†åŸï¼Œæˆ–è€…æ”¯æ’‘äº†æŸä¸ªå¿«é€Ÿå‘å±•ä¸šåŠ¡ï¼Œè¿™äº›éƒ½æ˜¯ä¸šåŠ¡ç»“æœï¼Œç”¨ä¸šåŠ¡æ•°å­—æ¥è¯´è¯ã€‚ æŠ€æœ¯åˆ›æ–°ï¼š ç”±æŠ€æœ¯äººå‘˜å‘èµ·æˆ–å®Œæˆçš„æ‰€æœ‰é™æœ¬ææ•ˆçš„åŠ¨ä½œï¼Œä½†æ˜¯åŒæ ·è¦çœ‹ä¼˜å…ˆçº§å’ŒæŠ•å…¥äº§å‡ºæ¯”ã€‚ å›¢é˜Ÿå»ºè®¾ï¼š è®©å›¢é˜Ÿå¯ä»¥é•¿æœŸå¥åº·å‘å±•ä¸‹å»ï¼Œè¦åœ¨ Backupã€äººå‘˜ç»„æˆã€æœºåˆ¶å»ºè®¾ç­‰å¤šä¸ªæ–¹é¢ä¸‹åŠŸå¤«ã€‚ è‡ªé—®ï¼š WHYï¼šä¸ºä»€ä¹ˆåšä¸šåŠ¡ç›®æ ‡/æŠ€æœ¯åˆ›æ–°/å›¢é˜Ÿå»ºè®¾çš„è§„åˆ’ï¼Ÿ WHATï¼šæ˜¯å¦èƒ½è¯´æ˜ä¸šåŠ¡ç›®æ ‡/æŠ€æœ¯åˆ›æ–°/å›¢é˜Ÿå»ºè®¾è§„åˆ’è§£å†³çš„é—®é¢˜ã€ä»·å€¼ä¸ä½œç”¨ï¼Ÿ WHOï¼šç”±è°æ‰¿æ‹…ï¼Ÿè´Ÿè´£äººçš„ä¼˜åŠ¿ä¸è·ŒåŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ WHENï¼šæ‰€åšçš„è§„åˆ’ç€çœ¼äºç°åœ¨è¿˜æ˜¯æœªæ¥ï¼Ÿèƒ½å¦ä¿è¯é•¿æœŸæœ‰ä»·å€¼ï¼Ÿ HOWï¼šé’ˆå¯¹ä¸åŒçš„éƒ¨åˆ†ï¼Œå…·ä½“çš„è½åœ°ç»†åˆ™å¦‚ä½•ï¼Ÿ HOW MUCHï¼šè§„åˆ’è¦åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿæ˜¯å¦å¯ä»¥å½¢æˆå¯è¡¡é‡çš„KPIï¼Ÿ ä¸šåŠ¡ç»“æœä½ è¦æ˜ç¡®ç°é˜¶æ®µä¸Šçº§é¢†å¯¼å…³æ³¨çš„é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯è½¬åŒ–ã€æµé‡ã€ç•™å­˜ã€è¿˜æ˜¯äº§å“çš„ç”¨æˆ·ä½“éªŒï¼Ÿä½œä¸ºæŠ€æœ¯Leader ï¼Œä½ å’Œå›¢é˜Ÿæˆå‘˜çš„åˆ°è¾¾è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯çº¿ç´¢æ¥æºä¹‹ä¸€ã€‚ æŠ€æœ¯åˆ›æ–°ç¨³å®šæ€§ã€æ•ˆèƒ½ä¼˜åŒ–ã€é©±åŠ¨ä¸šåŠ¡ã€è§†é‡å±•æœ› å›¢é˜Ÿå»ºè®¾å›¢é˜Ÿå»ºè®¾çš„å…³é”®ä¸åªæ˜¯çŸ¥äººå–„ç”¨ï¼Œè€Œæ˜¯ï¼š å›¢é˜Ÿæœªæ¥éœ€è¦ä»€ä¹ˆæ ·çš„äººï¼Ÿ ç›®å‰å›¢é˜Ÿæˆå‘˜éœ€è¦ä»€ä¹ˆæ ·çš„çŠ¶æ€å’Œèƒ½åŠ›ï¼Ÿ å›¢é˜Ÿæˆå‘˜éœ€è¦æ‰¿æ‹…ä»€ä¹ˆæ ·çš„è´£ä»»ï¼Ÿ æ€»çš„æ¥è¯´ï¼Œä½ å¸Œæœ›æœªæ¥è‡ªå·±çš„å›¢é˜Ÿæˆä¸ºæ€æ ·çš„å›¢é˜Ÿï¼Ÿä»¥æ­¤æ¨å¯¼ç¦»ç†æƒ³çŠ¶æ€å¤šè¿œï¼Ÿæ€ä¹ˆç¼©å°å·®è·ï¼Ÿ è§„åˆ’è½åœ°æ—¶çš„é—®é¢˜ä¸æ€è·¯å®¹æ˜“å‡ºç°çš„é—®é¢˜ï¼š è§„åˆ’ä¸ç­‰äºè®¡åˆ’ è§„åˆ’å†…å®¹æƒ³å¾—å¤ªå¤šï¼Œåšæˆçš„å°‘ ä¸šåŠ¡å‹åŠ›å¤§ï¼Œç›²ç›¯ç—›ç‚¹ï¼Œå¿½è§†ç›®æ ‡ è§„åˆ’æœ€ç»ˆæˆäº†æŠ€æœ¯Leaderçš„è§„åˆ’ åšå›¢é˜Ÿè§„åˆ’æ˜¯ä¸€ä»¶æ¯”è¾ƒç»¼åˆå®è§‚çš„äº‹æƒ…ï¼Œæœ‰æ—¶å“ªæ€•åªæ˜¯å‡ ä¸ªäººçš„å›¢é˜Ÿï¼Œæƒ³åšå¥½ä¸€ä»½è§„åˆ’è€Œéæ‰§è¡Œè®¡åˆ’ä¹Ÿå¾ˆè€ƒéªŒ Leader çš„æ€è€ƒæ·±åº¦ï¼ŒæŸç§ç¨‹åº¦æ¥è¯´ï¼Œè§„åˆ’æ˜¯ä½ å®šä¹‰ä¸€ç¾¤äººåœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…åšä»€ä¹ˆã€æ€ä¹ˆåšã€æœ€ç»ˆå˜æˆä»€ä¹ˆæ ·ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è€ƒé‡çš„ç‚¹éå¸¸å¤šï¼Œè¿™äº›æ·±å…¥çš„æ€è€ƒä¹Ÿä¼šä¿ƒè¿›ä½ æ—¥å¸¸çš„ä¸€äº›è¡Œä¸ºå’Œç»“æœï¼Œå¯¹äºå›¢é˜Ÿçš„å­£åº¦ä¹ƒè‡³åŠå¹´è§„åˆ’æˆ‘æ˜¯éå¸¸æ¨èä½ è¦å®šæœŸæ¢³ç†å¹¶è½åœ°çš„ï¼Œæœ‰ç›®æ ‡å’Œæ²¡ç›®æ ‡çš„å›¢é˜Ÿï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤§çš„å·®åˆ«çš„ã€‚ æ¥æ‰‹æ–°å›¢é˜Ÿï¼šå£«æ°”ä½ã€äº¤ä»˜è¿Ÿã€äº‹æ•…å¤šå‘ï¼Œå¦‚ä½•ä¸‹æ‰‹è§£å†³ï¼Ÿè™½ç„¶æ¥æ‰‹ä¸€ä¸ªé—®é¢˜å›¢é˜Ÿå¾ˆéš¾ï¼Œè¦å¤„ç†å¾ˆå¤šé—®é¢˜å¹¶ä¸”éå¸¸è¾›è‹¦ï¼Œä½†æ˜¯å¯¹ä¸€ä¸ª Leader çš„é”»ç‚¼ä¹Ÿæ˜¯æ— ä¸ä¼¦æ¯”çš„ï¼Œæˆ‘è§è¿‡å‡ ä¹æ‰€æœ‰ä¼˜ç§€çš„æŠ€æœ¯ Leader éƒ½æ˜¯ä¸€æ¬¡æ¬¡è¿™æ ·ç£¨ç‚¼å‡ºæ¥çš„ã€‚æ¯•ç«ŸæŠ€æœ¯ç®¡ç†èƒ½åŠ›å¾ˆé‡è¦çš„ä¸€ä¸ªè½åœ°åœºæ™¯å°±æ˜¯è¿™ç§æƒ…å†µï¼Œä¹Ÿæ˜¯æœ€èƒ½å‘æŒ¥æŠ€æœ¯ Leader ç®¡ç†èƒ½åŠ›ä»·å€¼çš„åœºæ™¯ä¹‹ä¸€ã€‚","tags":["reading"],"categories":["reading"]},{"title":"gitçŸ¥è¯†æ±‡æ€»","path":"/2021/02/13/310/","content":"æ¦‚å¿µ4ä¸ªåŒºgitä¹‹æ‰€ä»¥ä»¤äººè´¹è§£ï¼Œä¸»è¦æ˜¯å®ƒç›¸æ¯”äºsvnç­‰ç­‰ä¼ ç»Ÿçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¤šå¼•å…¥äº†ä¸€ä¸ªæš‚å­˜åŒº(Stage)çš„æ¦‚å¿µï¼Œå°±å› ä¸ºå¤šäº†è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œè€Œä½¿å¾ˆå¤šäººç–‘æƒ‘ã€‚å…¶å®ï¼Œåœ¨åˆå­¦è€…æ¥è¯´ï¼Œæ¯ä¸ªåŒºå…·ä½“æ€ä¹ˆå·¥ä½œçš„ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦å…³å¿ƒï¼Œè€Œåªè¦çŸ¥é“æœ‰è¿™ä¹ˆ4ä¸ªåŒºå°±å¤Ÿäº†ï¼š å·¥ä½œåŒº(Working Area) æš‚å­˜åŒº(Stage) æœ¬åœ°ä»“åº“(Local Repository) è¿œç¨‹ä»“åº“(Remote Repository) 5ç§çŠ¶æ€ä»¥ä¸Š4ä¸ªåŒºï¼Œè¿›å…¥æ¯ä¸€ä¸ªåŒºæˆåŠŸä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªçŠ¶æ€ï¼Œå†åŠ ä¸Šæœ€åˆå§‹çš„ä¸€ä¸ªçŠ¶æ€ï¼Œä¸€å…±æ˜¯5ç§çŠ¶æ€ã€‚ä»¥ä¸‹æˆ‘ä»¬æŠŠè¿™5ç§çŠ¶æ€åˆ†åˆ«å‘½åä¸ºï¼š æœªä¿®æ”¹(Origin) å·²ä¿®æ”¹(Modified) å·²æš‚å­˜(Staged) å·²æäº¤(Committed) å·²æ¨é€(Pushed) æ£€æŸ¥ä¿®æ”¹å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜git diff å·²æš‚å­˜ï¼Œæœªæäº¤git diff --cached å·²æäº¤ï¼Œæœªæ¨é€git diff master origin/master æ’¤é”€ä¿®æ”¹äº†è§£æ¸…æ¥šå¦‚ä½•æ£€æŸ¥å„ç§ä¿®æ”¹ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å°è¯•å„ç§æ’¤é”€æ“ä½œã€‚ æ¢å¤å·²ä¿®æ”¹ï¼Œæœªæš‚å­˜å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨ç¼–è¾‘å™¨é‡Œä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œgit add .ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„æ–‡ä»¶è¿˜åœ¨å·¥ä½œåŒºï¼Œå¹¶æ²¡æœ‰è¿›å…¥æš‚å­˜åŒºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ’¤é”€æ“ä½œ git checkout . æˆ–è€… git reset --hard æ¢å¤å·²æš‚å­˜ï¼Œæœªæäº¤ä½ å·²ç»æ‰§è¡Œäº†git add .ï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œgit commit -m &quot;comment&quot;ã€‚è¿™æ—¶å€™ä½ æ„è¯†åˆ°äº†é”™è¯¯ï¼Œæƒ³è¦æ’¤é”€ï¼Œä½ å¯ä»¥æ‰§è¡Œï¼š git resetgit checkout . æˆ–è€… git reset --hard git resetåªæ˜¯æŠŠä¿®æ”¹é€€å›åˆ°äº†git add .ä¹‹å‰çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶æœ¬èº«è¿˜å¤„äºå·²ä¿®æ”¹æœªæš‚å­˜çŠ¶æ€ï¼Œä½ å¦‚æœæƒ³é€€å›æœªä¿®æ”¹çŠ¶æ€ï¼Œè¿˜éœ€è¦æ‰§è¡Œgit checkout .ã€‚ æˆ–è®¸ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå‘½ä»¤git reset --hardæ¥å®Œæˆã€‚æ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¸ªå¼ºå¤§çš„å‘½ä»¤ï¼Œå¯ä»¥ä¸€æ­¥åˆ°ä½åœ°æŠŠä½ çš„ä¿®æ”¹å®Œå…¨æ¢å¤åˆ°æœªä¿®æ”¹çš„çŠ¶æ€ã€‚ æ¢å¤å·²æäº¤ï¼Œæœªæ¨é€ä½ çš„æ‰‹å¤ªå¿«ï¼Œä½ æ—¢æ‰§è¡Œäº†git add .ï¼Œåˆæ‰§è¡Œäº†git commitï¼Œè¿™æ—¶å€™ä½ çš„ä»£ç å·²ç»è¿›å…¥äº†ä½ çš„æœ¬åœ°ä»“åº“ï¼Œç„¶è€Œä½ åæ‚”äº†ï¼Œæ€ä¹ˆåŠï¼Ÿä¸è¦ç€æ€¥ï¼Œè¿˜æœ‰åŠæ³•ã€‚ git reset --hard origin/master è¿˜æ˜¯è¿™ä¸ªgit reset --hardå‘½ä»¤ï¼Œåªä¸è¿‡è¿™æ¬¡å¤šäº†ä¸€ä¸ªå‚æ•°origin/masterï¼Œæ­£å¦‚æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„ï¼Œorigin/masterä»£è¡¨è¿œç¨‹ä»“åº“ï¼Œæ—¢ç„¶ä½ å·²ç»æ±¡æŸ“äº†ä½ çš„æœ¬åœ°ä»“åº“ï¼Œé‚£ä¹ˆå°±ä»è¿œç¨‹ä»“åº“æŠŠä»£ç å–å›æ¥å§ã€‚ å·²æ¨é€å¾ˆä¸å¹¸ï¼Œä½ çš„æ‰‹å®åœ¨æ˜¯å¤ªå¿«äº†ï¼Œä½ æ—¢git addäº†ï¼Œåˆgit commitäº†ï¼Œå¹¶ä¸”è¿˜git pushäº†ï¼Œè¿™æ—¶ä½ çš„ä»£ç å·²ç»è¿›å…¥è¿œç¨‹ä»“åº“ã€‚å¦‚æœä½ æƒ³æ¢å¤çš„è¯ï¼Œè¿˜å¥½ï¼Œç”±äºä½ çš„æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“æ˜¯ç­‰ä»·çš„ï¼Œä½ åªéœ€è¦å…ˆæ¢å¤æœ¬åœ°ä»“åº“ï¼Œå†å¼ºåˆ¶pushåˆ°è¿œç¨‹ä»“åº“å°±å¥½äº†ï¼š git reset --hard HEAD^git push -f éƒ¨åˆ†è¿œç¨‹ä»“åº“è®¾ç½®äº†ç¦æ­¢å¼ºåˆ¶pushï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ã€‚ revertgit revertç”¨äºåè½¬æäº¤ã€‚æ‰§è¡Œrevertå‘½ä»¤æ—¶è¦æ±‚å·¥ä½œæ ‘å¿…é¡»æ˜¯å¹²å‡€çš„ï¼Œgit revertç”¨ä¸€ä¸ªæ–°æäº¤æ¥æ¶ˆé™¤ä¸€ä¸ªå†å²æäº¤æ‰€åšçš„ä»»ä½•ä¿®æ”¹ã€‚revert ä¹‹åä½ çš„æœ¬åœ°ä»£ç ä¼šå›æ»šåˆ°æŒ‡å®šçš„å†å²ç‰ˆæœ¬ï¼Œè¿™æ—¶ä½ å† git push å°±å¯ä»¥æŠŠçº¿ä¸Šçš„ä»£ç æ›´æ–°ã€‚ å¸¸ç”¨å‘½ä»¤ å‘½ä»¤ è¯´æ˜ git clone å…‹éš† git branch (åˆ†æ”¯å) åˆ›å»ºåˆ†æ”¯ -Dåˆ é™¤åˆ†æ”¯ git checkout (åˆ†æ”¯å) åˆ‡æ¢åˆ†æ”¯ -båˆ›å»ºå¹¶åˆ‡æ¢ git checkout (æ–‡ä»¶å) æ’¤é”€æ­¤æ–‡ä»¶ä¿®æ”¹ git add å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜ git status æŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰ä¿®æ”¹ git commit å°†ç¼“å­˜åŒºå†…å®¹æ·»åŠ åˆ°ä»“åº“ä¸­ git diff æ¥æŸ¥çœ‹æ‰§è¡Œ git status çš„ç»“æœçš„è¯¦ç»†ä¿¡æ¯ git reset HEAD å‘½ä»¤ç”¨äºå–æ¶ˆå·²ç¼“å­˜çš„å†…å®¹ git rm æ–‡ä»¶ åˆ é™¤æ–‡ä»¶-få¼ºåˆ¶åˆ é™¤ git mv ç§»åŠ¨æ–‡ä»¶ git merge åˆå¹¶åˆ†æ”¯ git fetch ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ° git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt; å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœº git push origin â€“delete test åˆ é™¤è¿œç¨‹åˆ†æ”¯test git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt; å°†è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­ git rebase å‘½ä»¤åœ¨å¦ä¸€ä¸ªåˆ†æ”¯åŸºç¡€ä¹‹ä¸Šé‡æ–°åº”ç”¨ï¼Œç”¨äºæŠŠä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚ git log å‘½ä»¤ç”¨äºæ˜¾ç¤ºæäº¤æ—¥å¿—ä¿¡æ¯ã€‚ git reflog æ˜¾ç¤ºæ¯ä¸€æ¬¡å‘½ä»¤ git revert ç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤é”€æŸæ¬¡æäº¤ï¼Œæ­¤æ¬¡æäº¤ä¹‹å‰çš„commitéƒ½ä¼šè¢«ä¿ç•™ git reset HEAD å¦‚æœå‘ç°é”™è¯¯çš„å°†ä¸æƒ³æš‚å­˜çš„æ–‡ä»¶è¢«git addè¿›å…¥ç´¢å¼•ä¹‹åï¼Œæƒ³å›é€€å–æ¶ˆï¼Œåˆ™å¯ä»¥ä½¿ç”¨ è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š git config â€“global user.name â€œpuresaiâ€ git config â€“global user.email â€œ957042781@qq.comâ€œ å‡ ä¸ªå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆfatal: No configured push destination.è§£å†³ï¼š$ git remote add -f -t master -m master origin git://example.com/git.git/fatal: The current branch test has no upstream branch.è§£å†³ï¼šgit push --set-upstream origin testæ¨¡ä»¿ git cloneï¼Œä½†åªè·Ÿè¸ªé€‰å®šçš„åˆ†æ”¯$ mkdir project.git$ cd project.git$ git init$ git remote add -f -t master -m master origin git://example.com/git.git/$ git merge originfatalï¼šUnable to create &#x27;E:/project/scrm/.git/index.lock&#x27;: File exists.rm -f ./.git/index.lockgit log-p æŸ¥çœ‹å·®å¼‚-n(nä¸ºæ­£æ•´æ•°) æŸ¥çœ‹æœ€è¿‘næ¬¡çš„æäº¤--pretty æŒ‰æŒ‡å®šæ ¼å¼æ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯,å¯é€‰é¡¹æœ‰ï¼šoneline,short,medium,full,fuller,email,rawä»¥åŠformat:&lt;string&gt;,é»˜è®¤ä¸ºmediumï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æŒ‡å®šé»˜è®¤çš„æ–¹å¼ã€‚e.g. git log (--pretty=)oneline--stat åˆ—å‡ºæ–‡ä»¶çš„ä¿®æ”¹è¡Œæ•°--sortstat åªæ˜¾ç¤º--statä¸­æœ€åè¡Œæ•°ä¿®æ”¹æ·»åŠ ç§»é™¤çš„ç»Ÿè®¡--graph ä»¥ç®€å•çš„å›¾å½¢æ–¹å¼åˆ—å‡ºæäº¤è®°å½•--abbrev-commit ä»…æ˜¾ç¤º SHA-1 çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œè€Œéæ‰€æœ‰çš„ 40 ä¸ªå­—ç¬¦ã€‚--relative-date ä½¿ç”¨è¾ƒçŸ­çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯”å¦‚ï¼Œâ€œ2 weeks agoâ€ï¼‰ã€‚--name-only ä»…åœ¨æäº¤ä¿¡æ¯åæ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•ã€‚--name-status æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶æ¸…å•ã€‚ åˆ—å‡ºtag git tag # åœ¨æ§åˆ¶å°æ‰“å°å‡ºå½“å‰ä»“åº“çš„æ‰€æœ‰tag git tag -l â€˜v0.1.*â€™ # æœç´¢ç¬¦åˆæ¨¡å¼çš„Tag æ‰“tag git tagåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šè½»é‡tagå’Œé™„æ³¨tagã€‚è½»é‡tagæ˜¯æŒ‡å‘æäº¤å¯¹è±¡çš„å¼•ç”¨ï¼Œé™„æ³¨Tagåˆ™æ˜¯ä»“åº“ä¸­çš„ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ã€‚å»ºè®®ä½¿ç”¨é™„æ³¨Tagã€‚ åˆ›å»ºè½»é‡Tag git tag v0.1.2-light åˆ›å»ºé™„æ³¨Tag git tag -a v0.1.2 -m â€œ0.1.2ç‰ˆæœ¬â€ åˆ›å»ºè½»é‡Tagä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œç›´æ¥æŒ‡å®šTagåç§°å³å¯ã€‚ åˆ›å»ºé™„æ³¨Tagæ—¶ï¼Œå‚æ•°aå³annotatedçš„ç¼©å†™ï¼ŒæŒ‡å®šTagç±»å‹ï¼Œåé™„Tagåã€‚å‚æ•°mæŒ‡å®šTagè¯´æ˜ï¼Œè¯´æ˜ä¿¡æ¯ä¼šä¿å­˜åœ¨Tagå¯¹è±¡ä¸­ã€‚ åˆ‡æ¢åˆ°Tagä¸åˆ‡æ¢åˆ†æ”¯å‘½ä»¤ç›¸åŒï¼Œç”¨ git checkout [tagname] æŸ¥çœ‹Tagä¿¡æ¯ç”¨git showå‘½ä»¤å¯ä»¥æŸ¥çœ‹Tagçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š git show v0.1.2 åˆ é™¤Tagè¯¯æ‰“æˆ–éœ€è¦ä¿®æ”¹Tagæ—¶ï¼Œéœ€è¦å…ˆå°†Tagåˆ é™¤ï¼Œå†æ‰“æ–°Tagã€‚ git tag -d v0.1.2 # åˆ é™¤Tag å‚æ•°då³deleteçš„ç¼©å†™ï¼Œæ„ä¸ºåˆ é™¤å…¶åæŒ‡å®šçš„Tagã€‚ ç»™æŒ‡å®šçš„commitæ‰“Tag æ‰“Tagä¸å¿…è¦åœ¨headä¹‹ä¸Šï¼Œä¹Ÿå¯åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸Šæ‰“ï¼Œè¿™éœ€è¦ä½ çŸ¥é“æŸä¸ªæäº¤å¯¹è±¡çš„æ ¡éªŒå’Œï¼ˆé€šè¿‡git logè·å–ï¼‰ã€‚ è¡¥æ‰“Tag git tag -a v0.1.1 9fbc3d0 Tagæ¨é€åˆ°æœåŠ¡å™¨ é€šå¸¸çš„git pushä¸ä¼šå°†Tagå¯¹è±¡æäº¤åˆ°gitæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ˜¾å¼çš„æ“ä½œï¼š git push origin v0.1.2 # å°†v0.1.2 Tagæäº¤åˆ°gitæœåŠ¡å™¨ git push origin â€“-tags # å°†æœ¬åœ°æ‰€æœ‰Tagä¸€æ¬¡æ€§æäº¤åˆ°gitæœåŠ¡å™¨ æ³¨æ„ï¼šå¦‚æœæƒ³çœ‹ä¹‹å‰æŸä¸ªTagçŠ¶æ€ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·æ“ä½œ git tag æŸ¥çœ‹å½“å‰åˆ†æ”¯ä¸‹çš„Tag git checkout v0.21 æ­¤æ—¶ä¼šæŒ‡å‘æ‰“v0.21 Tagæ—¶çš„ä»£ç çŠ¶æ€ï¼Œï¼ˆä½†ç°åœ¨å¤„äºä¸€ä¸ªç©ºçš„åˆ†æ”¯ä¸Šï¼‰ åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtagåœ¨Git v1.7.0 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push origin â€“delete åˆ é™¤tagè¿™ä¹ˆç”¨ï¼š git push origin â€“delete tag å¦åˆ™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºåˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œå…¶å®å°±ç›¸å½“äºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push origin : è¿™æ˜¯åˆ é™¤tagçš„æ–¹æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºtagåˆ°è¿œç¨‹tagï¼š git tag -d git push origin :refs/tags/ é‡å‘½åè¿œç¨‹åˆ†æ”¯åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push â€“delete origin devel é‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼š git branch -m devel develop æ¨é€æœ¬åœ°åˆ†æ”¯ï¼š git push origin develop æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹ git push â€“tags # æ¨é€æ‰€æœ‰tag git push origin :tag # æ¨é€tag","tags":["git"],"categories":["CI"]},{"title":"atomic","path":"/2021/02/13/atomic/","content":"åœ¨ä¹‹å‰çš„æºç åˆ†æä¸­ï¼Œæˆ‘ä»¬æœ‰å¤šæ¬¡çœ‹åˆ°atomicçš„å‡ºç°ï¼Œä»Šå¤©ä¸å¦¨æˆ‘ä»¬çœ‹ä¸€ä¸‹atomicçš„æºç ã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹atomicçš„æºç æ–‡ä»¶ï¼š è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œä»¥.sä¸ºåç¼€çš„æ˜¯æ±‡ç¼–è¯­è¨€æºä»£ç æ–‡ä»¶ï¼Œä½ å¯ä»¥å¹¶ä¸æ‡‚æ±‡ç¼–ï¼Œæ²¡æœ‰å…³ç³»ã€‚ ä¸»è¦çœ‹ä¸‹asm.sï¼Œçœ‹ä¸€çœ‹åˆ°é‡Œé¢æœ‰è°ƒç”¨runtime âˆ• internal âˆ• atomicï¼Œæˆ‘ä»¬å‰å»çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­æœ‰ä¸ªæ–‡ä»¶atomic_wasm.goã€‚ atomicæä¾›çš„æ˜¯åŸå­æ“ä½œï¼ŒatomicåŒ…ä¸­æ”¯æŒå…­ç§ç±»å‹ int32 uint32 int64 uint64 uintptr unsafe.Pointer å¯¹äºæ¯ä¸€ä¸ªç±»å‹ï¼Œæ”¯æŒ5ç§æ“ä½œï¼Œæˆ‘ä»¬ä»¥int32åˆ†åˆ«è¯´æ˜ä¸‹è¿™äº›æ“ä½œï¼š SwapX// åŸå­æ€§çš„å°†æ–°å€¼ä¿å­˜åˆ°*addrå¹¶è¿”å›æ—§å€¼ã€‚func SwapInt32(addr *int32, new int32) (old int32)// æºç func Xchg(ptr *uint32, new uint32) uint32 &#123;\told := *ptr\t*ptr = new\treturn old&#125; CompareAndSwapX// åŸå­æ€§çš„æ¯”è¾ƒ*addrå’Œoldï¼Œå¦‚æœç›¸åŒåˆ™å°†newèµ‹å€¼ç»™*addrå¹¶è¿”å›çœŸã€‚func CompareAndSwapInt32(addr *int32, old, new int32) (swapped bool)// æºç func Cas(ptr *uint32, old, new uint32) bool &#123;\tif *ptr == old &#123; *ptr = new return true\t&#125;\treturn false&#125; AddX// åŸå­æ€§çš„å°†valçš„å€¼æ·»åŠ åˆ°*addrå¹¶è¿”å›æ–°å€¼func AddInt64(addr *int64, delta int64) (new int64)// æºç func Xadd(ptr *uint32, delta int32) uint32 &#123;\tnew := *ptr + uint32(delta)\t*ptr = new\treturn new&#125; LoadX// åŸå­æ€§çš„è·å–*addrçš„å€¼func LoadInt32(addr *int32) (val int32)// æºç func Load(ptr *uint32) uint32 &#123;\treturn *ptr&#125; StoreX// åŸå­æ€§çš„å°†valçš„å€¼ä¿å­˜åˆ°*addrfunc StoreInt32(addr *int32, val int32)// æºç func Store(ptr *uint32, val uint32) &#123;\t*ptr = val&#125; æºç å…¶å®æ¯”è¾ƒç®€å•äº†ï¼Œæˆ‘å°±ä¸è¿‡å¤šè¯´æ˜äº†ã€‚ atomic.Valueå¦å¤–ï¼Œatomicå¯¹æ”¯æŒçš„ç±»å‹åšäº†æ‰©å±•ï¼Œatomic.Valueè¢«è®¾è®¡ç”¨æ¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ã€‚ type Value struct &#123;\tv interface&#123;&#125;&#125; ä¸ºäº†æ–¹ä¾¿ï¼Œå®šä¹‰äº†ä¸€ä¸ªifaceWordsç±»å‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†interface&#123;&#125;ç±»å‹åˆ†è§£ï¼Œå¾—åˆ°å…¶ä¸­çš„ä¸¤ä¸ªå­—æ®µï¼Œä½œä¸ºinterfaceçš„å†…éƒ¨è¡¨ç¤ºæ ¼å¼ï¼Œtypä»£è¡¨åŸå§‹ç±»å‹ï¼Œdataä»£è¡¨çœŸæ­£çš„å€¼ã€‚ type ifaceWords struct &#123;\ttyp unsafe.Pointer\tdata unsafe.Pointer&#125; æä¾›äº†Storeå’ŒLoadä¸¤ä¸ªæ–¹æ³•ã€‚ Store func (v *Value) Store(x interface&#123;&#125;) &#123; // xä¸ºnilï¼Œç›´æ¥panic\tif x == nil &#123; panic(&quot;sync/atomic: store of nil value into Value&quot;)\t&#125;\t// å°†ç°æœ‰çš„å€¼å’Œè¦å†™å…¥çš„å€¼è½¬æ¢ä¸ºifaceWordsç±»å‹ï¼Œè¿™æ ·ä¸‹ä¸€æ­¥å°±èƒ½è·å–åˆ°å®ƒä»¬çš„åŸå§‹ç±»å‹å’ŒçœŸæ­£çš„å€¼\tvp := (*ifaceWords)(unsafe.Pointer(v))\txp := (*ifaceWords)(unsafe.Pointer(&amp;x))\tfor &#123; // è·å–ç°æœ‰çš„å€¼çš„type typ := LoadPointer(&amp;vp.typ) // å¦‚æœtypä¸ºnilè¯´æ˜è¿™æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨Store if typ == nil &#123; // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œå°±å ä½å½“å‰çš„processorï¼Œä¸å…è®¸å…¶ä»–goroutineå†æŠ¢ï¼Œruntime_procPinæ–¹æ³•ä¼šå…ˆè·å–å½“å‰goroutine runtime_procPin() // ä½¿ç”¨CASæ“ä½œï¼Œå…ˆå°è¯•å°†typè®¾ç½®ä¸º^uintptr(0)è¿™ä¸ªä¸­é—´çŠ¶æ€ // å¦‚æœå¤±è´¥ï¼Œåˆ™è¯æ˜å·²ç»æœ‰åˆ«çš„goroutineæŠ¢å…ˆå®Œæˆäº†èµ‹å€¼æ“ä½œ // é‚£å®ƒå°±è§£é™¤æŠ¢å é”ï¼Œç»§ç»­å¾ªç¯ç­‰å¾… if !CompareAndSwapPointer(&amp;vp.typ, nil, unsafe.Pointer(^uintptr(0))) &#123; runtime_procUnpin() continue &#125; // å¦‚æœè®¾ç½®æˆåŠŸï¼Œå°±åŸå­æ€§çš„æ›´æ–°å¯¹åº”çš„æŒ‡é’ˆï¼Œæœ€åè§£é™¤æŠ¢å é” StorePointer(&amp;vp.data, xp.data) StorePointer(&amp;vp.typ, xp.typ) runtime_procUnpin() return &#125; // å¦‚æœtypä¸º^uintptr(0)è¯´æ˜ç¬¬ä¸€æ¬¡å†™å…¥è¿˜æ²¡æœ‰å®Œæˆï¼Œç»§ç»­å¾ªç¯ç­‰å¾… if uintptr(typ) == ^uintptr(0) &#123; continue &#125; // å¦‚æœè¦å†™å…¥çš„ç±»å‹å’Œç°æœ‰çš„ç±»å‹ä¸ä¸€è‡´ï¼Œåˆ™panic if typ != xp.typ &#123; panic(&quot;sync/atomic: store of inconsistently typed value into Value&quot;) &#125; // æ›´æ–°dataï¼Œè·³å‡ºå¾ªç¯ StorePointer(&amp;vp.data, xp.data) return\t&#125;&#125; Load func (v *Value) Load() (x interface&#123;&#125;) &#123; // å°†*ValueæŒ‡é’ˆç±»å‹è½¬æ¢ä¸º*ifaceWordsæŒ‡é’ˆç±»å‹\tvp := (*ifaceWords)(unsafe.Pointer(v))\t// åŸå­æ€§çš„è·å–åˆ°vçš„ç±»å‹typçš„æŒ‡é’ˆ\ttyp := LoadPointer(&amp;vp.typ)\t// å¦‚æœæ²¡æœ‰å†™å…¥æˆ–è€…æ­£åœ¨å†™å…¥ï¼Œå…ˆè¿”å›ï¼Œ^uintptr(0)ä»£è¡¨è¿‡æ¸¡çŠ¶æ€ï¼Œè¿™å’ŒStoreæ˜¯å¯¹åº”çš„\tif typ == nil || uintptr(typ) == ^uintptr(0) &#123; return nil\t&#125;\t// åŸå­æ€§çš„è·å–åˆ°vçš„çœŸæ­£çš„å€¼dataçš„æŒ‡é’ˆï¼Œç„¶åè¿”å›\tdata := LoadPointer(&amp;vp.data)\txp := (*ifaceWords)(unsafe.Pointer(&amp;x))\txp.typ = typ\txp.data = data\treturn&#125; PS:è§£è¯»çš„æºç ï¼Œå¦‚æ— ç‰¹åˆ«è¯´æ˜ï¼Œç‰ˆæœ¬ä¸º1.15.6 å‚è€ƒï¼š goæ ‡å‡†åº“ Go - atomicåŒ…ä½¿ç”¨åŠatomic.Valueæºç åˆ†æ","tags":["gosourcecode"],"categories":["gosourcecode"]},{"title":"æ­å»ºhttp server","path":"/2021/02/12/goexample1/","content":"round oneï¼Œæˆ‘ä»¬æ¥ç‚¹ç®€å•çš„ï¼Œæ­å»ºä¸€ä¸ªç®€å•çš„http serverã€‚ ç›®æ ‡ï¼š è·¯ç”±helloæ¥æ”¶å‚æ•°å¹¶è·å–åˆ°è¾“å‡ºjsonæ•°æ® è‡ªå®šä¹‰404 å¤„ç†è¶…æ—¶é¡µé¢ ä½¿ç”¨åˆ°çš„åº“: net/http time encoding/json æˆ‘ä»¬å…ˆæ­å»ºèµ·æ¥serverï¼š package mainimport (\t&quot;net/http&quot;)func main() &#123;\tsrv := http.Server&#123; Addr: &quot;:8080&quot;, Handler: http.HandlerFunc(defaultHttp),\t&#125;\tsrv.ListenAndServe()&#125;// é»˜è®¤httpå¤„ç†func defaultHttp(w http.ResponseWriter, r *http.Request) &#123;\tw.Write([]byte(&quot;wow&quot;))&#125; è¿è¡Œå°±å¯ä»¥è·‘èµ·æ¥äº†ã€‚ æˆ‘ä»¬å†æ¥å®šä¹‰ä¸‹jsonè¾“å‡ºæ ¼å¼ã€‚ // è‡ªå®šä¹‰è¿”å›type JsonRes struct &#123;\tCode int `json:&quot;code&quot;`\tData interface&#123;&#125; `json:&quot;data&quot;`\tMsg string `json:&quot;msg&quot;`\tTimeStamp int64 `json:&quot;timestmap&quot;`&#125;func apiResult(w http.ResponseWriter, code int, data interface&#123;&#125;, msg string) &#123;\tbody, _ := json.Marshal(JsonRes&#123; Code: code, Data: data, Msg: msg, // è·å–æ—¶é—´æˆ³ TimeStamp: time.Now().Unix(),\t&#125;) w.Write(body)&#125; å†æ¥çœ‹ä¸€ä¸‹æ¥æ”¶å‚æ•°ä¸è¾“å‡ºï¼š // å¤„ç†helloï¼Œå¹¶æ¥æ”¶å‚æ•°è¾“å‡ºjsonfunc sayHello(w http.ResponseWriter, r *http.Request) &#123; query := r.URL.Query() // ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯æ²¡æœ‰nameå‚æ•°ä¼šæŠ¥é”™ // name := query[&quot;name&quot;][0] // ç¬¬äºŒç§æ–¹å¼ name := query.Get(&quot;name&quot;) apiResult(w, 0, name+&quot; say &quot;+r.PostFormValue(&quot;some&quot;), &quot;success&quot;)&#125; è¶…æ—¶å¤„ç†ï¼š Handler: http.TimeoutHandler(http.HandlerFunc(defaultHttp), 2*time.Second, &quot;Timeout!!!&quot;) 404: http.Error(w, &quot;you lost???&quot;, http.StatusNotFound) æœ€ååŠ å…¥è·¯ç”±å¤„ç†ï¼š func defaultHttp(w http.ResponseWriter, r *http.Request) &#123;\tpath, httpMethod := r.URL.Path, r.Method\tif path == &quot;/&quot; &#123; w.Write([]byte(&quot;index&quot;)) return &#125;\tif path == &quot;/hello&quot; &amp;&amp; httpMethod == &quot;POST&quot; &#123; sayHello(w, r) return &#125;\tif path == &quot;/sleep&quot; &#123; // æ¨¡æ‹Ÿä¸€ä¸‹ä¸šåŠ¡å¤„ç†è¶…æ—¶ time.Sleep(4*time.Second) return &#125;\tif path == &quot;/path&quot; &#123; w.Write([]byte(&quot;path:&quot;+path+&quot;, method:&quot;+httpMethod)) return &#125;\t// è‡ªå®šä¹‰404\thttp.Error(w, &quot;you lost???&quot;, http.StatusNotFound)&#125; æˆ‘ä»¬è¿è¡Œèµ·æ¥çœ‹ä¸‹æ•ˆæœï¼š 404æ•ˆæœ hello é¦–é¡µ è¶…æ—¶ è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„http serverï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ï¼Ÿ å®Œæ•´ä»£ç github","tags":["goexample"],"categories":["goexample"]},{"title":"go+MongoDBå®ç°é™„è¿‘çš„äºº","path":"/2021/02/12/goexample10/","content":"åœ¨O2Oä¸ç¤¾äº¤åœºæ™¯ä¸­ï¼Œæœç´¢é™„è¿‘çš„äººã€é™„è¿‘çš„å•†å®¶æ˜¯å¾ˆå¸¸è§çš„åœºæ™¯ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç°å‘¢ï¼Ÿ æ¥è§¦çš„æ–¹æ³•æœ‰ï¼š åæ ‡+çƒä½“è·ç¦»è®¡ç®—å…¬å¼ åŸºäºRedisçš„geo åŸºäºMongoDBçš„geohash å‰é¢çš„demoå·²ç»æœ‰æ¥è§¦Redisï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç”¨mongoDBæ¥å®ç°ä¸€ä¸‹ã€‚ æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„å®ç°å¥½äº†ï¼š go.mongodb.org/mongo-driver/mongo è¿æ¥opt := options.Client().ApplyURI(&quot;mongodb://root:211111@localhost:27017&quot;)// Connect to MongoDBclient, err := mongo.Connect(context.TODO(), opt)if err != nil &#123;\tlog.Fatal(err)&#125;// Check the connectionerr = client.Ping(context.TODO(), nil)if err != nil &#123;\tlog.Fatal(err)&#125;fmt.Println(&quot;Connected to MongoDB!&quot;) æˆ‘ä»¬å¯ä»¥è®¾ç½®æ›´å¤šï¼š opt.SetLocalThreshold(3 * time.Second) //åªä½¿ç”¨ä¸mongoæ“ä½œè€—æ—¶å°äº3ç§’çš„opt.SetMaxConnIdleTime(5 * time.Second) //æŒ‡å®šè¿æ¥å¯ä»¥ä¿æŒç©ºé—²çš„æœ€å¤§æ¯«ç§’æ•°opt.SetMaxPoolSize(200) //ä½¿ç”¨æœ€å¤§çš„è¿æ¥æ•°opt.SetReadConcern(readconcern.Majority()) //æŒ‡å®šæŸ¥è¯¢åº”è¿”å›å®ä¾‹çš„æœ€æ–°æ•°æ®ç¡®è®¤ä¸ºï¼Œå·²å†™å…¥å‰¯æœ¬é›†ä¸­çš„å¤§å¤šæ•°æˆå‘˜ model// åæ ‡type Location struct &#123;\tType string `json:&quot;type&quot; bson:&quot;type&quot;`\tCoordinates []float64 `json:&quot;coordinates&quot; bson:&quot;coordinates&quot;`&#125;// æ¯ä¸ªç‚¹type Point struct &#123;\tName string `json:&quot;name&quot;`\tAge int `json:&quot;age&quot;`\tCity string `json:&quot;city&quot;`\tLocation Location `json:&quot;location&quot;`&#125; æ•°æ®å†™å…¥æˆ‘ä»¬å¯ä»¥å…ˆæ’å…¥æ•°æ® func(mgo *mgo) Start() &#123;\tcollection := mgo.client.Database(DBName).Collection(CollectionName)\t// è®¾ç½®ç´¢å¼• 2dsphereï¼Œ å¾ˆé‡è¦\tcollection.Indexes().CreateOne(context.TODO(), mongo.IndexModel&#123; Keys: bson.M&#123;Key: &quot;2dsphere&quot;&#125;,\t&#125;)\ta := Point&#123;&quot;ç‹äºŒ&quot;, 18, &quot;æ­å·&quot;, Location&#123;&quot;Point&quot;, []float64&#123;120.185614,30.300738&#125;&#125;&#125;\tb := Point&#123;&quot;å¼ ä¸‰&quot;, 25, &quot;æ­å·&quot;, Location&#123;&quot;Point&quot;, []float64&#123;120.094778,30.310217&#125;&#125;&#125;\tc := Point&#123;&quot;å°æ™´&quot;, 35, &quot;ç»å…´&quot;, Location&#123;&quot;Point&quot;, []float64&#123;120.603847,30.054237&#125;&#125;&#125;\td := Point&#123;&quot;æå››&quot;, 34, &quot;æ­å·&quot;, Location&#123;&quot;Point&quot;, []float64&#123;120.110893,30.207849&#125;&#125;&#125;\te := Point&#123;&quot;å°æ˜&quot;, 24, &quot;åŒ—äº¬&quot;, Location&#123;&quot;Point&quot;, []float64&#123;116.435721,39.914031&#125;&#125;&#125;\tf := Point&#123;&quot;å´å…­&quot;, 25, &quot;æ­å·&quot;, Location&#123;&quot;Point&quot;, []float64&#123;120.126443,30.33084&#125;&#125;&#125;\th := Point&#123;&quot;äºä¸€&quot;, 23, &quot;æ­å·&quot;, Location&#123;&quot;Point&quot;, []float64&#123;120.28132,30.184083&#125;&#125;&#125;\tj := Point&#123;&quot;å°ä¸ƒ&quot;, 14, &quot;æ­å·&quot;, Location&#123;&quot;Point&quot;, []float64&#123;119.73926,30.247639&#125;&#125;&#125;\t// å•æ¡æ’å…¥\tinsertResult, err := collection.InsertOne(context.TODO(), a)\tif err != nil &#123; log.Fatal(err)\t&#125;\tfmt.Println(&quot;Inserted a single document: &quot;, insertResult.InsertedID)\tps := []interface&#123;&#125;&#123;b, c, d, e, f, h, j&#125;\t// æ‰¹é‡æ’å…¥\tinsertManyResult, err := collection.InsertMany(context.TODO(), ps)\tif err != nil &#123; log.Fatal(err)\t&#125;\tfmt.Println(&quot;Inserted multiple documents: &quot;, insertManyResult.InsertedIDs)&#125; æ³¨æ„ï¼Œè®¾ç½®ç´¢å¼• 2dsphereï¼Œ å¾ˆé‡è¦ï¼ï¼ï¼ å­˜å‚¨çš„æ•°æ®æ ¼å¼ æˆ‘ä»¬æŸ¥æ‰¾ï¼š func (mgo *mgo) Near() &#123;\tcollection := mgo.client.Database(DBName).Collection(CollectionName) // æŸ¥æ‰¾120.110893,30.2078490åæ ‡é™„è¿‘15000ç±³çš„äºº\tcur, err := collection.Find(context.TODO(), bson.D&#123; &#123;Key, bson.D&#123; &#123;&quot;$near&quot;, bson.D&#123; &#123; &quot;$geometry&quot;, Location&#123; &quot;Point&quot;, []float64&#123;120.110893,30.2078490&#125;, &#125;, &#125;, &#123;&quot;$maxDistance&quot;, 15000&#125;, // å•ä½ç±³ &#125;&#125;, &#125;&#125;,\t&#125;)\tif err != nil &#123; fmt.Println(err) return\t&#125;\tvar results []Point\tfor cur.Next(context.TODO()) &#123; var elem Point err := cur.Decode(&amp;elem) fmt.Println(elem) fmt.Println(cur) if err != nil &#123; fmt.Println(&quot;Could not decode Point&quot;) return &#125; results = append(results, elem)\t&#125;\tfmt.Println(&quot;æŸ¥æ‰¾åˆ°&quot;, len(results))&#125; æˆ‘ä»¬ä¸å¦¨è¿è¡Œä¸€ä¸‹ï¼š èƒ½æˆåŠŸæŸ¥æ‰¾å‡ºäº†é™„è¿‘çš„äººã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•è®¡ç®—è·ç¦»å‘¢ï¼Ÿ å¯ä»¥ç»çº¬åº¦è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥mongoDBèšåˆæŸ¥è¯¢ï¼Œå¯ä»¥è‡ªè¡Œæ€ç´¢ï¼Œå‚è€ƒä»£ç ç‚¹å‡»è§githubã€‚","tags":["goexample"],"categories":["goexample"]},{"title":"åˆ©ç”¨ginæ­å»ºä¸€ä¸ªapiæ¡†æ¶","path":"/2021/02/12/goexample2/","content":"åœ¨demo1ä¸­ï¼Œæˆ‘ä»¬ç®€å•ä½¿ç”¨äº†net/httpæ­å»ºäº†ä¸€ä¸ªserverï¼Œå…¶å®åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ¯”è¾ƒå°‘å»ä½¿ç”¨æ ‡å‡†åº“å»ç›´æ¥å†™apiï¼Œæ›´å¤šçš„æ˜¯ä½¿ç”¨å‰äººæ­å»ºå¥½çš„è½®å­ï¼ˆæˆ‘å‘¢ï¼Œæ˜¯ä¸ªä¸å¤ªå–œæ¬¢é‡å¤é€ è½®å­çš„å¼€å‘è€…ï¼Œæœ‰å¼€æºçš„é è°±çš„ï¼Œç›´æ¥ç”¨å°±å¥½ï¼Œè‡ªå·±è°ƒæ•´æˆè‡ªå·±éœ€è¦çš„å³å¯ï¼‰ï¼Œé‚£ä¹ˆè¯´çš„goçš„æ¡†æ¶ï¼Œä¸å¾—ä¸è¯´ginäº†ã€‚ å¯¹äºginçš„ä»‹ç»ï¼Œæ˜¯githubä¸Šstaræœ€å¤šçš„goæ¡†æ¶äº†ï¼Œå…¶ä»–ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ä¸Šæ‰‹å†™èµ·æ¥å§ï¼ ç›®æ ‡ï¼š è‡ªå®šä¹‰é…ç½® æ•´åˆmysqlå’ŒRedis ç‹¬ç«‹è·¯ç”±ç®¡ç† æ—¥å¿— å¹³æ»‘é‡å¯ è„šæœ¬æ‰“åŒ… ä½¿ç”¨åˆ°çš„åº“ï¼š github.com/fsnotify/fsnotify github.com/gin-gonic/gin github.com/go-Redis/Redis github.com/jinzhu/gorm http://github.com/lestrrat-go/file-rotatelogs http://go.uber.org/zap github.com/spf13/pflag github.com/spf13/viper åˆå§‹åŒ–modulesçš„å¼•å…¥ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸å¿…ä½¿ç”¨gopathå»ç®¡ç†é¡¹ç›®ç›®å½•äº†ï¼Œå¯¹äºmodulesçš„åŸºæœ¬ä½¿ç”¨ï¼Œå»ºè®®çœ‹æ–‡ç« ï¼š gomodules æˆ‘ä»¬å¼€å§‹ï¼š go mod init sai0556/demo2-gin-frame å› ä¸ºæˆ‘ä»¬æš‚æ—¶æœ¬åœ°å¼€å‘ï¼š PSï¼šå½“æ—¶ç†è§£æœ‰è¯¯ï¼Œå…¶å®æ— éœ€åšlocal.comæ›¿æ¢ï¼Œimportç›´æ¥ä½¿ç”¨sai0556/demo2-gin-frameå³å¯ï¼Œè¿™é‡Œæœ‰ç‚¹å¤šä½™ // ä½¿ç”¨æœ¬åœ°modulego mod edit -require=local.com/sai0556/demo2-gin-frame@v1.0.0go mod edit -replace=local.com/sai0556/demo2-gin-frame@v1.0.0=$PWD å¯ä»¥çœ‹åˆ°go.modå·²ç”Ÿæˆï¼š module sai0556/demo2-gin-framego 1.13require local.com/sai0556/demo2-gin-frame v1.0.0replace local.com/sai0556/demo2-gin-frame v1.0.0 =&gt; /Users/@/Work/golang/go-example/demo2-gin-frame /Users/@/Work/golang/go-example/demo2-gin-frame æ­¤ç›®å½•å°±æ˜¯é¡¹ç›®ç›®å½•ï¼Œè§†å…·ä½“æƒ…å†µä¸ä¸€ è‡ªå®šä¹‰é…ç½®ä¸è¯»å–ï¼šåœ¨æˆ‘ä»¬ä½¿ç”¨Rediså’Œmysqlä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯»å–ä¸€ä¸‹é…ç½®ï¼Œé…ç½®å‘¢æˆ‘ä»¬ä½¿ç”¨å¸¸è§çš„yamlï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ï¼Œæ¯”å¦‚envç­‰ã€‚ æ–°å»ºconfigç›®å½•ï¼Œç”¨æ¥è¯»å–ä¸ç›‘å¬é…ç½®æ–‡ä»¶(config.yaml)ï¼š package configimport ( &quot;fmt&quot; &quot;github.com/fsnotify/fsnotify&quot; &quot;github.com/spf13/viper&quot;)type Config struct &#123; Name string&#125;// å¯¹å¤–çš„åˆå§‹åŒ–é…ç½®æ–¹æ³•func Run(cfg string) error &#123; c := Config&#123; Name: cfg, &#125; if err := c.init(); err != nil &#123; return err &#125; c.watchConfig() return nil&#125;func (c *Config) init() error &#123; if c.Name != &quot;&quot; &#123; viper.SetConfigFile(c.Name) &#125; else &#123; // é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯./config.yaml viper.AddConfigPath(&quot;.&quot;) viper.SetConfigName(&quot;config&quot;) &#125; viper.SetConfigType(&quot;yaml&quot;) // viperè§£æé…ç½®æ–‡ä»¶ err := viper.ReadInConfig() if err != nil &#123; panic(fmt.Errorf(&quot;Fatal error config file: %s &quot;, err)) &#125;\t// ç®€å•æ‰“å°ä¸‹é…ç½® fmt.Println(viper.GetString(&quot;name&quot;)) return nil&#125;func (c *Config) watchConfig() &#123; viper.WatchConfig() viper.OnConfigChange(func(e fsnotify.Event) &#123; fmt.Println(&quot;Config file changed:&quot;, e.Name) &#125;)&#125; main: package mainimport ( &quot;github.com/spf13/pflag&quot; &quot;local.com/sai0556/demo2-gin-frame/config&quot;)var ( conf = pflag.StringP(&quot;config&quot;, &quot;c&quot;, &quot;&quot;, &quot;config filepath&quot;))func main() &#123; pflag.Parse() // åˆå§‹åŒ–é…ç½® if err := config.Run(*conf); err != nil &#123; panic(err) &#125;&#125; è¿™é‡Œæœ‰ç”¨åˆ°å¤§ç‰›spf13çš„ä¸¤ä¸ªåŒ…ï¼Œpflagå’Œviperï¼Œå‘½ä»¤è¡Œå‚æ•°è§£æåŒ…pflagå¯ä»¥çœ‹ä½œflagçš„è¿›é˜¶ç‰ˆæœ¬ï¼Œåœ¨æˆ‘ä»¬è¿™é‡Œå¯ä»¥ç”¨æ¥æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œviperæ˜¯è¯»å–é…ç½®æ–‡ä»¶çš„åŒ…ï¼Œé…åˆfsnotifyå¯ä»¥å®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚ï¼ˆspf13å¤§ç¥è¿˜æœ‰å…¶ä»–æœ‰ç”¨çš„åŒ…ï¼Œç›¸ä¿¡åœ¨ä½ çš„goç¼–ç ç”Ÿæ¶¯ä¼šç”¨åˆ°çš„ï¼‰ å†™å®Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸‹ï¼š go run main.go -c ./config.yaml å¯ä»¥çœ‹åˆ°æœ‰æ‰“å°å‡ºæˆ‘ä»¬é…ç½®çš„nameã€‚ æ•´åˆmysqlä¸RedismysqlåŒ…æˆ‘ä»¬å°±é€‰ç”¨gormï¼ŒRedisçš„ä½¿ç”¨æ¯”è¾ƒå¤šçš„æ˜¯redigoå’Œgo-Redisï¼Œredigoæ›¾åœ¨æˆ‘ä½¿ç”¨ä¸­å‡ºç°è¿‡é—®é¢˜ï¼Œå› è€Œæˆ‘ä»¬é€‰æ‹©åè€…ï¼Œåè€…ä¹Ÿæ”¯æŒè¿æ¥æ± ã€‚ mysqlï¼š package dbimport ( &quot;fmt&quot; &quot;sync&quot; &quot;errors&quot; orm &quot;github.com/jinzhu/gorm&quot; _ &quot;github.com/jinzhu/gorm/dialects/mysql&quot; &quot;github.com/spf13/viper&quot;)type MySqlPool struct &#123;&#125;var instance *MySqlPoolvar once sync.Oncevar db *orm.DBvar err error // å•ä¾‹æ¨¡å¼func GetInstance() *MySqlPool &#123; once.Do(func() &#123; instance = &amp;MySqlPool&#123;&#125; &#125;) return instance&#125;func (pool *MySqlPool) InitPool() (isSuc bool) &#123;\t// è¿™é‡Œæœ‰ä¸€ç§å¸¸è§çš„æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹å¼ dsn := fmt.Sprintf(&quot;%s:%s@tcp(%s)/%s?charset=%s&quot;, viper.GetString(&quot;db.username&quot;), viper.GetString(&quot;db.password&quot;), viper.GetString(&quot;db.host&quot;), viper.GetString(&quot;db.name&quot;), viper.GetString(&quot;db.charset&quot;)) db, err = orm.Open(&quot;mysql&quot;, dsn) if err != nil &#123; panic(errors.New(&quot;mysqlè¿æ¥å¤±è´¥&quot;)) return false &#125; // è¿æ¥æ•°é…ç½®ä¹Ÿå¯ä»¥å†™å…¥é…ç½®ï¼Œåœ¨æ­¤è¯»å– db.DB().SetMaxIdleConns(viper.GetInt(&quot;db.MaxIdleConns&quot;)) db.DB().SetMaxOpenConns(viper.GetInt(&quot;db.MaxOpenConns&quot;)) // db.LogMode(true) return true&#125; åé¢è·å–è¿æ¥æ± å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ db.GetInstance() Redisï¼š package dbimport ( &quot;fmt&quot; &quot;github.com/spf13/viper&quot; &quot;github.com/go-Redis/Redis&quot;)var RedisClient *Redis.Clientfunc InitRedis() &#123; RedisClient = Redis.NewClient(&amp;Redis.Options&#123; Addr: fmt.Sprintf(&quot;%s:%s&quot;, viper.GetString(&quot;Redis.host&quot;), viper.GetString(&quot;Redis.port&quot;)), Password: viper.GetString(&quot;Redis.auth&quot;), DB: 0, &#125;) _, err := RedisClient.Ping().Result() if err != nil &#123; panic(&quot;Redis ping error&quot;) &#125;&#125; RedisClientå°±æ˜¯æˆ‘ä»¬åé¢å¯ä»¥ç”¨çš„Redisè¿æ¥æ± ã€‚ åœ¨mainä¸­åŠ å…¥åˆå§‹åŒ–è¿æ¥æ± çš„ä»£ç å³å¯ï¼š // è¿æ¥mysqlæ•°æ®åº“btn := db.GetInstance().InitPool()if !btn &#123; log.Println(&quot;init database pool failure...&quot;) panic(errors.New(&quot;init database pool failure&quot;))&#125;// Redisdb.InitRedis() è·¯ç”±ä¸æ§åˆ¶å™¨ä¸ºäº†æ–¹ä¾¿è·¯ç”±ï¼Œæˆ‘ä»¬æŠŠè·¯ç”±ç®¡ç†å•ç‹¬åˆ°routerã€‚ package routerimport ( &quot;net/http&quot; &quot;github.com/gin-gonic/gin&quot; &quot;local.com/sai0556/demo2-gin-frame/controller&quot;)func Load(g *gin.Engine) *gin.Engine &#123; g.Use(gin.Recovery()) // 404 g.NoRoute(func (c *gin.Context) &#123; c.String(http.StatusNotFound, &quot;404 not found&quot;); &#125;) g.GET(&quot;/&quot;, controller.Index) return g&#125; controller: package controllerimport ( &quot;net/http&quot; &quot;github.com/gin-gonic/gin&quot;)// è¿”å›type Response struct &#123; Code int `json:&quot;code&quot;` Message string `json:&quot;message&quot;` Data interface&#123;&#125; `json:&quot;data&quot;`&#125;// apiè¿”å›ç»“æ„func ApiResponse(c *gin.Context, code int, message string, data interface&#123;&#125;) &#123; c.JSON(http.StatusOK, Response&#123; Code: code, Message: message, Data: data, &#125;)&#125;func Index(c *gin.Context) &#123; ApiResponse(c, 0, &quot;success&quot;, nil)&#125; åˆ°è¿™å‘¢ï¼ŒåŸºæœ¬ä¹Ÿå°±å·®ä¸å¤šäº†ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹å®Œæ•´çš„mainï¼š package main// import è¿™é‡Œæˆ‘ä¹ æƒ¯æŠŠå®˜æ–¹åº“ï¼Œå¼€æºåº“ï¼Œæœ¬åœ°moduleä¾æ¬¡åˆ†å¼€åˆ—å‡ºimport ( &quot;log&quot; &quot;errors&quot; &quot;github.com/spf13/pflag&quot; &quot;github.com/spf13/viper&quot; &quot;github.com/gin-gonic/gin&quot; &quot;local.com/sai0556/demo2-gin-frame/config&quot; &quot;local.com/sai0556/demo2-gin-frame/db&quot; &quot;local.com/sai0556/demo2-gin-frame/router&quot;)var ( conf = pflag.StringP(&quot;config&quot;, &quot;c&quot;, &quot;&quot;, &quot;config filepath&quot;))func main() &#123; pflag.Parse() // åˆå§‹åŒ–é…ç½® if err := config.Run(*conf); err != nil &#123; panic(err)\t&#125; // è¿æ¥mysqlæ•°æ®åº“ btn := db.GetInstance().InitPool() if !btn &#123; log.Println(&quot;init database pool failure...&quot;) panic(errors.New(&quot;init database pool failure&quot;)) &#125; // Redis db.InitRedis() gin.SetMode(viper.GetString(&quot;mode&quot;)) g := gin.New() g = router.Load(g) g.Run(viper.GetString(&quot;addr&quot;))&#125; æ•´åˆæ—¥å¿—è¿™é‡Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸‹logï¼š log: level: debug # æ—¥å¿—çº§åˆ«ï¼Œinfoï¼Œdebugï¼Œerror file_format: &quot;%Y%m%d&quot; # æ–‡ä»¶æ ¼å¼ max_save_days: 30 # ä¿å­˜å¤©æ•° file_type: one # one, level å•æ–‡ä»¶å­˜å‚¨è¿˜æ˜¯ä»¥levelçº§åˆ«å­˜å‚¨ æ•´åˆloggerï¼š package loggerimport (\t&quot;io&quot;\t&quot;log&quot;\t&quot;time&quot;\t&quot;github.com/lestrrat-go/file-rotatelogs&quot;\t&quot;go.uber.org/zap&quot;\t&quot;go.uber.org/zap/zapcore&quot; &quot;github.com/spf13/viper&quot;)var Logger *zap.Logger var LogLevel stringvar FileFormat string// åˆå§‹åŒ–æ—¥å¿— loggerfunc init() &#123;\t// è®¾ç½®ä¸€äº›åŸºæœ¬æ—¥å¿—æ ¼å¼\tconfig := zapcore.EncoderConfig&#123; MessageKey: &quot;msg&quot;, LevelKey: &quot;level&quot;, EncodeLevel: zapcore.CapitalLevelEncoder, TimeKey: &quot;ts&quot;, EncodeTime: func(t time.Time, enc zapcore.PrimitiveArrayEncoder) &#123; enc.AppendString(t.Format(&quot;2006-01-02 15:04:05&quot;)) &#125;, CallerKey: &quot;file&quot;, EncodeCaller: zapcore.ShortCallerEncoder, EncodeDuration: func(d time.Duration, enc zapcore.PrimitiveArrayEncoder) &#123; enc.AppendInt64(int64(d) / 1000000) &#125;,\t&#125;\tencoder := zapcore.NewConsoleEncoder(config)\tFileFormat, saveType, LogLevel := &quot;%Y%m%d&quot;, &quot;one&quot;, &quot;info&quot;\tif viper.IsSet(&quot;log.file_format&quot;) &#123; FileFormat = viper.GetString(&quot;log.file_format&quot;)\t&#125;\tif viper.IsSet(&quot;log.level&quot;) &#123; LogLevel = viper.GetString(&quot;log.level&quot;)\t&#125;\tif viper.IsSet(&quot;log.save_type&quot;) &#123; saveType = viper.GetString(&quot;log.save_type&quot;)\t&#125;\tlogLevel := zap.DebugLevel\tswitch LogLevel &#123; case &quot;debug&quot;: logLevel = zap.DebugLevel case &quot;info&quot;: logLevel = zap.InfoLevel case &quot;error&quot;: logLevel = zap.ErrorLevel default: logLevel = zap.InfoLevel\t&#125;\tswitch saveType &#123; case &quot;level&quot;: Logger = getLevelLogger(encoder, logLevel, FileFormat) default: Logger = getOneLogger(encoder, logLevel, FileFormat)\t&#125;\t&#125;func getLevelLogger(encoder zapcore.Encoder, logLevel zapcore.Level, fileFormat string) *zap.Logger &#123;\tinfoLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123; return lvl == zapcore.InfoLevel &amp;&amp; lvl &gt;= logLevel\t&#125;)\tdebugLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123; return lvl == zapcore.DebugLevel &amp;&amp; lvl &gt;= logLevel\t&#125;)\terrorLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123; return lvl &gt;= zapcore.ErrorLevel &amp;&amp; lvl &gt;= logLevel\t&#125;)\t// è·å– infoã€warnæ—¥å¿—æ–‡ä»¶çš„io.Writer æŠ½è±¡ getLoggerWriter() åœ¨ä¸‹æ–¹å®ç°\tinfoWriter := getLoggerWriter(&quot;./log/info&quot;, fileFormat)\terrorWriter := getLoggerWriter(&quot;./log/error&quot;, fileFormat)\tdebugWriter := getLoggerWriter(&quot;./log/debug&quot;, fileFormat)\t// æœ€ååˆ›å»ºå…·ä½“çš„Logger\tcore := zapcore.NewTee( zapcore.NewCore(encoder, zapcore.AddSync(debugWriter), debugLevel), zapcore.NewCore(encoder, zapcore.AddSync(infoWriter), infoLevel), zapcore.NewCore(encoder, zapcore.AddSync(errorWriter), errorLevel),\t)\treturn zap.New(core, zap.AddCaller(), zap.AddStacktrace(zap.WarnLevel))&#125;func getOneLogger(encoder zapcore.Encoder, logLevel zapcore.Level, fileFormat string) *zap.Logger &#123;\tinfoWriter := getLoggerWriter(&quot;./log/info&quot;, fileFormat)\tinfoLevel := zap.LevelEnablerFunc(func(lvl zapcore.Level) bool &#123; return lvl == zapcore.InfoLevel &amp;&amp; lvl &gt;= logLevel\t&#125;)\tcore := zapcore.NewTee( zapcore.NewCore(encoder, zapcore.AddSync(infoWriter), infoLevel),\t)\treturn zap.New(core, zap.AddCaller(), zap.AddStacktrace(zap.WarnLevel))&#125;func getLoggerWriter(filename, fileFormat string) io.Writer &#123;\t// ç”Ÿæˆrotatelogsçš„Logger å®é™…ç”Ÿæˆçš„æ–‡ä»¶å file_YYmmddHH.log\thook, err := rotatelogs.New( filename+fileFormat+&quot;.log&quot;, rotatelogs.WithLinkName(filename), // ä¿å­˜å¤©æ•° rotatelogs.WithMaxAge(time.Hour*24*30), // åˆ‡å‰²é¢‘ç‡24å°æ—¶ rotatelogs.WithRotationTime(time.Hour*24),\t)\tif err != nil &#123; log.Println(&quot;æ—¥å¿—å¯åŠ¨å¼‚å¸¸&quot;) panic(err)\t&#125;\treturn hook&#125;func Debug(format string, v ...interface&#123;&#125;) &#123;\tLogger.Sugar().Debugf(format, v...)&#125;func Info(format string, v ...interface&#123;&#125;) &#123;\tLogger.Sugar().Infof(format, v...)&#125;func Error(format string, v ...interface&#123;&#125;) &#123;\tLogger.Sugar().Errorf(format, v...)&#125; è¿™é‡Œæ³¨æ„initå‡½æ•°ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨loggerå…¶ä¸­å‡½æ•°å³å¯ï¼Œç¨‹åºåŠ è½½åŒ…çš„è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œinitå‡½æ•°ã€‚å…³äºinitæœ‰ä»¥ä¸‹è¯´æ˜ï¼š initå‡½æ•°æ˜¯ç”¨äºç¨‹åºæ‰§è¡Œå‰åšåŒ…çš„åˆå§‹åŒ–çš„å‡½æ•°ï¼Œæ¯”å¦‚åˆå§‹åŒ–åŒ…é‡Œçš„å˜é‡ç­‰ æ¯ä¸ªåŒ…å¯ä»¥æ‹¥æœ‰å¤šä¸ªinitå‡½æ•° åŒ…çš„æ¯ä¸ªæºæ–‡ä»¶ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªinitå‡½æ•° åŒä¸€ä¸ªåŒ…ä¸­å¤šä¸ªinitå‡½æ•°çš„æ‰§è¡Œé¡ºåºgoè¯­è¨€æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰(è¯´æ˜) ä¸åŒåŒ…çš„initå‡½æ•°æŒ‰ç…§åŒ…å¯¼å…¥çš„ä¾èµ–å…³ç³»å†³å®šè¯¥åˆå§‹åŒ–å‡½æ•°çš„æ‰§è¡Œé¡ºåº initå‡½æ•°ä¸èƒ½è¢«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œè‡ªåŠ¨è¢«è°ƒç”¨ æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ï¼š logger.Info(&quot;i&#x27;m log123-----Info&quot;)logger.Error(&quot;i&#x27;m log123-----Error&quot;) å¹³æ»‘é‡å¯å½“ç¨‹åºåœ¨çº¿ä¸Šç¨³å®šè¿è¡Œåï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå»æ›´æ–°ä¸€äº›åŠŸèƒ½ï¼Œä½†å‘å¸ƒä»£ç çš„åŒæ—¶ï¼Œå‡å¦‚æœ‰ç”¨æˆ·æ­£åœ¨ä½¿ç”¨ï¼Œç›²ç›®å‘å¸ƒä»£ç å¯èƒ½ä¼šé€ æˆç”¨æˆ·çŸ­æš‚å¤±çœŸï¼Œè¿™æ—¶å€™å¹³æ»‘é‡å¯å°±æ¥äº†ã€‚ å¯¹äºå¹³æ»‘é‡å¯ï¼Œå…¶å®æœ‰å¾ˆå¤šæ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬åªä»è‡ªèº«ä»£ç çº§åˆ«æ¥å®Œæˆï¼Œè€Œå³ä¾¿æ˜¯ä»£ç çº§åˆ«ï¼Œç›®å‰ä¹Ÿæœ‰å¤šç§å®ç°æ–¹æ¡ˆï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹åº“endlessè¿™ç§ï¼Œæˆ‘è¿™é‡Œä¸»è¦å‚è€ƒäº† https://github.com/kuangchanglang/gracefulgithub.com/kuangchanglang/graceful ç®€å•è¯´æ˜ä¸‹å¤„ç†æ­¥éª¤ï¼š ç›‘å¬ä¿¡å·ï¼ˆUSR2ï¼Œå¯è‡ªå®šä¹‰å…¶ä»–ä¿¡å·ï¼‰ æ”¶åˆ°ä¿¡å·æ—¶forkå­è¿›ç¨‹ï¼ˆä½¿ç”¨ç›¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼‰ï¼Œå°†æœåŠ¡ç›‘å¬çš„socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹ å­è¿›ç¨‹ç›‘å¬çˆ¶è¿›ç¨‹çš„socketï¼Œè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å¯ä»¥æ¥æ”¶è¯·æ±‚ å­è¿›ç¨‹å¯åŠ¨æˆåŠŸä¹‹åï¼Œçˆ¶è¿›ç¨‹åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œç­‰å¾…æ—§è¿æ¥å¤„ç†å®Œæˆï¼ˆæˆ–è¶…æ—¶ï¼‰ çˆ¶è¿›ç¨‹é€€å‡ºï¼Œé‡å¯å®Œæˆ è¯¦ç»†åˆ†æå¯çœ‹åº•éƒ¨å‚è€ƒ-GolangæœåŠ¡å™¨çƒ­é‡å¯ã€çƒ­å‡çº§ã€çƒ­æ›´æ–°ã€‚ å¯åŠ¨æ£€æŸ¥ç»“åˆä¸Šé¢çš„ä¼˜é›…é‡å¯ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨æ—¶é…ç½®ä¸Šå¯åŠ¨å¥åº·æ£€æŸ¥ï¼š package main// import è¿™é‡Œæˆ‘ä¹ æƒ¯æŠŠå®˜æ–¹åº“ï¼Œå¼€æºåº“ï¼Œæœ¬åœ°moduleä¾æ¬¡åˆ†å¼€åˆ—å‡ºimport (\t&quot;fmt&quot;\t&quot;time&quot;\t&quot;errors&quot;\t&quot;net/http&quot; &quot;github.com/spf13/pflag&quot; &quot;github.com/spf13/viper&quot; &quot;github.com/gin-gonic/gin&quot; &quot;local.com/sai0556/demo2-gin-frame/config&quot; &quot;local.com/sai0556/demo2-gin-frame/db&quot; &quot;local.com/sai0556/demo2-gin-frame/router&quot; &quot;local.com/sai0556/demo2-gin-frame/logger&quot; &quot;local.com/sai0556/demo2-gin-frame/graceful&quot;)var ( conf = pflag.StringP(&quot;config&quot;, &quot;c&quot;, &quot;&quot;, &quot;config filepath&quot;))func main() &#123; pflag.Parse() // åˆå§‹åŒ–é…ç½® if err := config.Run(*conf); err != nil &#123; panic(err)\t&#125;\t// logger.Info(&quot;i&#x27;m log123-----Info&quot;)\t// logger.Error(&quot;i&#x27;m log123-----Error&quot;) // è¿æ¥mysqlæ•°æ®åº“\tDB := db.GetDB()\tdefer db.CloseDB(DB)\t// Redis\tdb.InitRedis()\tgin.SetMode(viper.GetString(&quot;mode&quot;))\tg := gin.New()\tg = router.Load(g)\t// g.Run(viper.GetString(&quot;addr&quot;))\tgo func() &#123; if err := pingServer(); err != nil &#123; fmt.Println(&quot;fail:å¥åº·æ£€æµ‹å¤±è´¥&quot;, err) &#125; fmt.Println(&quot;success:å¥åº·æ£€æµ‹æˆåŠŸ&quot;)\t&#125;()\tlogger.Info(&quot;å¯åŠ¨httpæœåŠ¡ç«¯å£%s &quot;, viper.GetString(&quot;addr&quot;))\tif err := graceful.ListenAndServe(viper.GetString(&quot;addr&quot;), g); err != nil &amp;&amp; err != http.ErrServerClosed &#123; logger.Error(&quot;fail:httpæœåŠ¡å¯åŠ¨å¤±è´¥: %s &quot;, err)\t&#125;&#125;// å¥åº·æ£€æŸ¥func pingServer() error &#123;\tfor i := 0; i &lt; viper.GetInt(&quot;max_ping_count&quot;); i++ &#123; url := fmt.Sprintf(&quot;%s%s%s&quot;, &quot;http://127.0.0.1&quot;, viper.GetString(&quot;addr&quot;), viper.GetString(&quot;healthCheck&quot;)) fmt.Println(url) resp, err := http.Get(url) if err == nil &amp;&amp; resp.StatusCode == 200 &#123; return nil &#125; time.Sleep(time.Second)\t&#125;\treturn errors.New(&quot;å¥åº·æ£€æµ‹404&quot;)&#125; è¿™é‡Œå°±æ¯”è¾ƒç®€å•ï¼Œå¦å¤–å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå»pingå¥åº·æ£€æµ‹çš„urlå³å¯ã€‚ æ‰“åŒ…è„šæœ¬shell #!/bin/bashSERVER=&quot;demo2-gin-frame&quot;function status() &#123;\tif [ &quot;`pgrep $SERVER -u $UID`&quot; != &quot;&quot; ];then echo $SERVER is running\telse echo $SERVER is not running\tfi&#125;function build() &#123;\techo &quot;build...&quot; CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ./$SERVER main.go if [ $? -ne &quot;0&quot; ];then echo &quot;built error!!!&quot; return fi echo &quot;built success!&quot;&#125;case &quot;$1&quot; in\t&#x27;status&#x27;)\tstatus\t;; &#x27;build&#x27;)\tbuild\t;; *) echo &quot;unknown, please: $0 &#123;status or build&#125;&quot;\texit 1\t;; esac bat echo &quot;build...&quot;SET CGO_ENABLED=0SET GOOS=linuxgo build -o demo2-gin-frameif %errorlevel% == 0 ( echo &quot;built successfully&quot;) else ( echo &quot;built fail!!!&quot;) å¯¹äºç¨‹åºçš„é‡å¯å’Œä¿æ´»ï¼Œå»ºè®®é…åˆsupervisorä½¿ç”¨ã€‚ å¥½ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬çš„round 2å°±ç»“æŸäº†ã€‚ä¸‹ä¸€è½®æˆ‘ä»¬æ¥ç©ç©é’‰é’‰æ™ºèƒ½æœºå™¨äººã€‚ ç‚¹å‡»ç›´è¾¾å®Œæ•´ä»£ç  å‚è€ƒï¼š golang zap æ—¥å¿—åº“ä½¿ç”¨ï¼ˆå«æ–‡ä»¶åˆ‡å‰²ã€åˆ†çº§åˆ«å­˜å‚¨å’Œå…¨å±€ä½¿ç”¨ç­‰ï¼‰ åŸºäºGoè¯­è¨€æ„å»ºä¼ä¸šçº§çš„ RESTful API æœåŠ¡ golang initå‡½æ•° - Goè¯­è¨€ä¸­æ–‡ç½‘ - Golangä¸­æ–‡ç¤¾åŒº GolangæœåŠ¡å™¨çƒ­é‡å¯ã€çƒ­å‡çº§ã€çƒ­æ›´æ–°(safe and graceful hot-restart/reload http server)è¯¦è§£","tags":["goexample"],"categories":["goexample"]},{"title":"goé¢å‘å¯¹è±¡","path":"/2021/02/12/goexample5/","content":"é¢å‘å¯¹è±¡ (Object Oriented,OO) çš„æ€æƒ³å¯¹è½¯ä»¶å¼€å‘ç›¸å½“é‡è¦ï¼Œå®ƒçš„æ¦‚å¿µå’Œåº”ç”¨ç”šè‡³å·²è¶…è¶Šäº†ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å¼€å‘ï¼Œæ‰©å±•åˆ°å¦‚æ•°æ®åº“ç³»ç»Ÿã€äº¤äº’å¼ç•Œé¢ã€åº”ç”¨ç»“æ„ã€åº”ç”¨å¹³å°ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€ç½‘ç»œç®¡ç†ç»“æ„ã€CAD æŠ€æœ¯ã€äººå·¥æ™ºèƒ½ç­‰é¢†åŸŸã€‚é¢å‘å¯¹è±¡æ˜¯ä¸€ç§å¯¹ç°å®ä¸–ç•Œç†è§£å’ŒæŠ½è±¡çš„æ–¹æ³•ï¼Œæ˜¯è®¡ç®—æœºç¼–ç¨‹æŠ€æœ¯å‘å±•åˆ°ä¸€å®šé˜¶æ®µåçš„äº§ç‰©ã€‚ ä¸¥æ ¼æ¥è¯´ï¼Œgoä¸å±äºé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼ˆæš‚ä¸æ”¯æŒç»§æ‰¿ï¼‰ï¼Œä½†goå…è®¸é¢å‘å¯¹è±¡çš„ç¼–ç¨‹é£æ ¼ã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸ªé¢å‘å¯¹è±¡çš„demoã€‚ å®åœ¨æ²¡æƒ³åˆ°å¥½ä¸€ç‚¹çš„ä¾‹å­ï¼Œä¸çŸ¥é“å¤§ä¼™æœ‰æ²¡æœ‰å¯¹è±¡ï¼Œä¸å¦‚ä»¥girl friendä¸ºä¾‹æ¥å¼„ä¸ªdemo å§ï¼Œå¥³åŒå­¦è¯·newä¸€ä¸ªboyfrindã€‚å½“ç„¶äº†ï¼Œnewä»€ä¹ˆéƒ½è¡Œï¼Œéšä½ å–œæ¬¢â€¦â€¦. æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¥³æœ‹å‹å¯¹è±¡ï¼š type GirlFriend struct &#123;\theight int // èº«é«˜\tweight int // ä½“é‡\tage int // å¹´é¾„\tname string // å§“å\tcontent string // ç»“æŸè¯­\tgreetings string // é—®å€™è¯­&#125; æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰èº«é«˜ï¼Œä½“é‡ï¼Œå¹´é¾„ï¼Œå§“åï¼š func (gf *GirlFriend) SetHeight(v int) &#123;\tgf.height = v&#125;func (gf *GirlFriend) SetWeight(v int) &#123;\tgf.weight = v&#125;func (gf *GirlFriend) SetAge(v int) &#123;\tgf.age = v&#125;func (gf *GirlFriend) SetName(v string) &#123;\tgf.name = v&#125; å–œæ¬¢ä½¿ç”¨é“¾å¼æ“ä½œçš„å¯ä»¥è¿™ä¹ˆæ¥ï¼ŒæŠŠå¥³æœ‹å‹returnå›å»å³å¯ï¼š func (gf *GirlFriend) SetContent(v string) *GirlFriend &#123;\tgf.content = v\treturn gf&#125;func (gf *GirlFriend) SetGreeting(v string) *GirlFriend &#123;\tgf.greetings = v\treturn gf&#125; æˆ‘ä»¬å½“ç„¶è¿˜æœ‰å®ç°ä¸€ä¸‹ï¼Œæ²¡æœ‰å¥³æœ‹å‹ï¼Œnewä¸€ä¸ªï¼š func NewOne() *GirlFriend &#123;\treturn &amp;GirlFriend&#123;&#125;&#125; newå‡ºæ¥äº†ï¼Œå½“ç„¶è¦ç§€ä¸€ä¸‹ï¼š func (gf *GirlFriend) Show() &#123;\tfmt.Println(gf.greetings + &quot;æˆ‘æ˜¯&quot; + gf.name + &quot;,ä»Šå¹´&quot; + strconv.Itoa(gf.age) + &quot;å²ï¼Œèº«é«˜&quot; + strconv.Itoa(gf.height) + &quot;cm,ä½“é‡&quot; + strconv.Itoa(gf.weight) + &quot;kgã€‚&quot; + gf.content)&#125; æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸ªï¼š package mainimport (\t&quot;demo5-OOP/oop&quot;)func main() &#123;\tgf := oop.NewOne()\tgf.SetName(&quot;Lily&quot;)\tgf.SetHeight(170)\tgf.SetWeight(50)\tgf.SetGreeting(&quot;hello,&quot;).SetContent(&quot;thanks for your great creavity!&quot;).SetAge(24)\tgf.Show()&#125; è¿™ä¸€ç¯‡æ¯”è¾ƒç®€å•ï¼Œä¾‹å­å‘¢ï¼Œä»…ä»…æ˜¯ç©ç¬‘ï¼Œä¸å¯å½“çœŸï¼Œå¥³æœ‹å‹newæ˜¯ä¸å¯è¡Œçš„ï¼Œè¿˜æ˜¯è¦ä¸»åŠ¨å»è¿½çš„ã€‚è¿™é‡Œä¸»è¦æ˜¯å±•ç¤ºä¸€ä¸‹goçš„é¢å‘å¯¹è±¡å®ç°ï¼Œåœ¨ä½¿ç”¨å…¶ä»–åº“çš„è¿‡ç¨‹ä¸­åº”è¯¥æœ‰æ³¨æ„åˆ°ä¸€äº›æ¨¡å—ä½¿ç”¨äº†é¢å‘å¯¹è±¡çš„å®ç°ï¼Œå¸Œæœ›å¤§å®¶å»åšä¸€äº›æŠ½è±¡ï¼Œåœ¨è‡ªå·±çš„é¡¹ç›®åˆé€‚çš„åœ°æ–¹å»å®ç°ä¸€ä¸‹ï¼Œè®©è‡ªå·±çš„ä»£ç æ›´ä¼˜é›…ã€æ›´å¥å£®ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶éƒ½èƒ½æ‰¾åˆ°å¯¹çš„äººï¼Œä¸€èµ·newä¸€ä¸ªbabyã€‚ å®Œæ•´ä»£ç ç‚¹å‡»è¿›github","tags":["goexample"],"categories":["goexample"]},{"title":"gRPC","path":"/2021/02/12/goexample4/","content":"åœ¨è¿›è¡Œround 4ä¹‹å‰å‘¢ï¼Œè¯´ä¸€ä¸‹goçš„modulesï¼Œä¹‹å‰çš„3ä¸ªdemoä¸­ï¼Œå…¶å®æˆ‘å°±ç›´æ¥ç”¨åˆ°äº†ï¼Œæ²¡åšè¯´æ˜ï¼Œä¸ªäººè§‰å¾—modulesçš„å¼•è¿›ç®—æ˜¯ä¸€ä¸ªå¤§æ”¹è¿›äº†ï¼Œè®©æˆ‘ä»¬å¯ä»¥è„±ç¦»gopathçš„æŸç¼šï¼Œå…·ä½“è¯´æ˜ä¸é…ç½®ï¼Œå¯ä»¥çœ‹æˆ‘çš„è¿™ä¸€ç¯‡æ–‡ç« ï¼š go modules åŠ¡å¿…è®¾ç½®GOPROXYï¼Œä¼šå¤§å¤§æé«˜go getçš„é€Ÿåº¦ã€‚ gRPC æ˜¯å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œçš„ç°ä»£å¼€æºé«˜æ€§èƒ½ RPC æ¡†æ¶ã€‚å®ƒå¯ä»¥é€šè¿‡å¯æ’æ‹”çš„æ”¯æŒæ¥æœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ï¼Œä»¥å®ç°è´Ÿè½½å¹³è¡¡ï¼Œè·Ÿè¸ªï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€è‹±é‡Œï¼Œä»¥å°†è®¾å¤‡ï¼Œç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚ å®‰è£…protocol buffer ç¼–è¯‘å™¨macï¼š brew install protobuf å…¶ä»–ç³»ç»Ÿå¯ä»¥å°è¯•ç¼–è¯‘å®‰è£… protocolbuffers/protobuf å®‰è£…gprcgo get -u google.golang.org/grpc å®‰è£…protoc-gen-goæ’ä»¶go get -u github.com/golang/protobuf/protoc-gen-go ä½¿ç”¨æ–°å»ºhelloç›®å½•ï¼Œè¿›å…¥åæ‰§è¡Œï¼š protoc --proto_path hello/ --go_out=plugins=grpc:hello hello.proto ä¼šçœ‹åˆ°helloç›®å½•ä¸‹ç”Ÿæˆäº†hello.pb.goæ–‡ä»¶ã€‚ å½“ç„¶ï¼Œå…¶ä¸­çš„ hello.proto æ˜¯é¢„å…ˆè‡ªå®šä¹‰åœ¨helloæ–‡ä»¶å¤¹ä¸‹çš„ï¼Œå¦‚ï¼š syntax = &quot;proto3&quot;; //è¯­æ³•å£°æ˜package hello; //åŒ…å// å®šä¹‰æœåŠ¡service Greeter &#123; rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;// è¯·æ±‚æ•°æ®æ ¼å¼message HelloRequest &#123; string name = 1;&#125;// å“åº”æ•°æ®æ ¼å¼message HelloReply &#123; string message = 1;&#125; serveræ–°å»ºserverç›®å½•ï¼Œgolangä¾‹å­ä»£ç æ¥è‡ªï¼šhttps://github.com/grpc/grpc-go/tree/master/examples/helloworld // main.gopackage mainimport ( &quot;context&quot; &quot;log&quot; &quot;net&quot; &quot;google.golang.org/grpc&quot; pb &quot;local.com/sai/game/grpc/hello&quot;)const ( port = &quot;:50051&quot;)// server is used to implement helloworld.GreeterServer.type server struct &#123; pb.UnimplementedGreeterServer&#125;// SayHello implements helloworld.GreeterServerfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) &#123; log.Printf(&quot;Received: %v&quot;, in.GetName()) return &amp;pb.HelloReply&#123;Message: &quot;Hello &quot; + in.GetName()&#125;, nil&#125;func main() &#123; lis, err := net.Listen(&quot;tcp&quot;, port) if err != nil &#123; log.Fatalf(&quot;failed to listen: %v&quot;, err) &#125; s := grpc.NewServer() pb.RegisterGreeterServer(s, &amp;server&#123;&#125;) if err := s.Serve(lis); err != nil &#123; log.Fatalf(&quot;failed to serve: %v&quot;, err) &#125;&#125; clientgo client// client.gopackage mainimport ( &quot;context&quot; &quot;log&quot; &quot;os&quot; &quot;time&quot; &quot;google.golang.org/grpc&quot; pb &quot;local.com/sai/game/grpc/hello&quot;)const ( address = &quot;127.0.0.1:50051&quot; defaultName = &quot;puresai&quot;)func main() &#123; // Set up a connection to the server. conn, err := grpc.Dial(address, grpc.WithInsecure(), grpc.WithBlock()) if err != nil &#123; log.Fatalf(&quot;did not connect: %v&quot;, err) &#125; defer conn.Close() c := pb.NewGreeterClient(conn) // Contact the server and print out its response. name := defaultName if len(os.Args) &gt; 1 &#123; name = os.Args[1] &#125; ctx, cancel := context.WithTimeout(context.Background(), time.Second) defer cancel() r, err := c.SayHello(ctx, &amp;pb.HelloRequest&#123;Name: name&#125;) if err != nil &#123; log.Fatalf(&quot;could not greet: %v&quot;, err) &#125; log.Printf(&quot;Greeting: %s&quot;, r.GetMessage())&#125;` php clientæ‰©å±•å®‰è£… grpcæ‰©å±•ä¸‹è½½ profo ä¸‹è½½å®‰è£…åˆé€‚ç‰ˆæœ¬çš„æ‰©å±•å³å¯ï¼Œè®°å¾—åˆ«å¿˜è®°åœ¨php.iniä¸­åŠ å…¥ï¼š extension=grpc.soextension=protobuf.so è‡ªåŠ¨ç”Ÿæˆä»£ç protoc --php_out=client hello/hello.proto ä¼šçœ‹åˆ°clientç›®å½•ä¸‹ç”Ÿæˆäº†GPBMetadataå’ŒHelloä¸¤ä¸ªç›®å½•ã€‚ å¦‚æœä½ å¯¹grpcç›¸å¯¹å«ç†Ÿç»ƒï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä»£ç ç¼–å†™ï¼š &lt;?phprequire __DIR__ . &#x27;/vendor/autoload.php&#x27;;class Client extends \\Grpc\\BaseStub&#123; public function __construct($hostname, $opts, $channel = null) &#123; parent::__construct($hostname, $opts, $channel); &#125; /** * rpc SayHello(HelloRequest) returns (HelloReply) &#123;&#125; * æ–¹æ³•åå°½é‡å’Œ (gprc å®šä¹‰ Greeter æœåŠ¡)çš„æ–¹æ³•ä¸€æ · * ç”¨äºè¯·æ±‚å’Œå“åº”è¯¥æœåŠ¡ */ public function SayHello(\\Hello\\HelloRequest $argument)&#123; // (/hello.Greeter/SayHello) æ˜¯è¯·æ±‚æœåŠ¡ç«¯é‚£ä¸ªæœåŠ¡å’Œæ–¹æ³•ï¼ŒåŸºæœ¬å’Œ proto æ–‡ä»¶å®šä¹‰ä¸€æ · return $this-&gt;_simpleRequest(&#x27;/hello.Greeter/SayHello&#x27;, $argument, [&#x27;\\Hello\\HelloReply&#x27;, &#x27;decode&#x27;] ); &#125;&#125;//ç”¨äºè¿æ¥ æœåŠ¡ç«¯$client = new \\Client(&#x27;127.0.0.1:50051&#x27;, [ &#x27;credentials&#x27; =&gt; Grpc\\ChannelCredentials::createInsecure()]);//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»$request = new \\Hello\\HelloRequest();$request-&gt;setName(&quot;fairy&quot;);//è°ƒç”¨è¿œç¨‹æœåŠ¡$get = $client-&gt;SayHello($request)-&gt;wait();//è¿”å›æ•°ç»„//$reply æ˜¯ TestReply å¯¹è±¡//$status æ˜¯æ•°ç»„list($reply, $status) = $get;echo $reply-&gt;getMessage().PHP_EOL;// print_r($client-&gt;SayHello($request)); å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨grpc_php_pluginæ’ä»¶ç”Ÿæˆã€‚ grpc-php grpc_php_pluginæ’ä»¶cloneå¤ªæ…¢å¯ä»¥ä½¿ç”¨ç äº‘ git clone -b $(curl -L https://grpc.io/release) https://github.com/grpc/grpccd grpc#è¿™ä¸€æ­¥å¾ˆæ…¢ï¼Œæš‚æœªæ‰¾åˆ°ä»€ä¹ˆå¥½æ–¹æ³•git submodule update --initmake grpc_php_plugin æ–°å»ºphp-clientï¼Œå†æ¥è‡ªåŠ¨ç”Ÿæˆï¼š protoc -I=./hello hello.proto --php_out=./php-client/ --grpc_out=php-client/ --plugin=protoc-gen-grpc=/Users/wangzetao/www/grpc1/bins/opt/grpc_php_plugin ä¼šå‘ç°æ¯”ä¸Šé¢è‡ªåŠ¨ç”Ÿæˆå¤šäº†ä¸€ä¸ªGreeterClient.php &lt;?php// client.phprequire __DIR__ . &#x27;/vendor/autoload.php&#x27;;//ç”¨äºè¿æ¥ æœåŠ¡ç«¯$client = new \\Hello\\GreeterClient(&#x27;127.0.0.1:50051&#x27;, [ &#x27;credentials&#x27; =&gt; Grpc\\ChannelCredentials::createInsecure()]);//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»$request = new \\Hello\\HelloRequest();$request-&gt;setName(&quot;world&quot;);//è°ƒç”¨è¿œç¨‹æœåŠ¡$get = $client-&gt;SayHello($request)-&gt;wait();//è¿”å›æ•°ç»„//$status æ˜¯æ•°ç»„list($reply, $status) = $get;echo $reply-&gt;getMessage().PHP_EOL;// print_r($client-&gt;SayHello($request)); è¿è¡Œæµ‹è¯• go run grpc/server/main.go go run grpc/client/main.gogo run grpc/client/client.phpgo run grpc/client/php-client.php grpcåˆä½“éªŒå®Œæˆäº†ï¼Œæœ¬æ¬¡åªæ˜¯å°å°çš„ä½¿ç”¨äº†ä¸€ä¸‹å­ï¼Œåç»­æ„Ÿå…´è¶£çš„è¯å¯ä»¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹ã€‚æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºäº¤æµã€‚ è¿™ç¯‡æ˜¯ä¹‹å‰çš„æ–‡ç« ï¼Œä»£ç ç®€å•ï¼Œå°±ä¸å†å†™ä¸€éäº†ã€‚","tags":["goexample"],"categories":["goexample"]},{"title":"go-kit","path":"/2021/02/12/goexample6/","content":"ä½•ä¸ºgo-kit Go kit is a programming toolkit for building microservices (or elegant monoliths) in Go. We solve common problems in distributed systems and application architecture so you can focus on delivering business value. go kitæ˜¯ä¸€ä¸ªç”¨äºåœ¨Goä¸­æ„å»ºå¾®æœåŠ¡ï¼ˆæˆ–ä¼˜é›…çš„æ•´ä½“ï¼‰çš„ç¼–ç¨‹å·¥å…·åŒ…ï¼Œè§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ä¸­çš„å¸¸è§é—®é¢˜ï¼Œä»¥ä¾¿å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡äº¤ä»˜ã€‚ go-kitä¸»è¦åˆ†ä¸ºä¸‰å±‚ç»“æ„ï¼šTransportå±‚ï¼ŒEndpointå±‚ï¼ŒServiceå±‚ã€‚ Transport è´Ÿè´£ä¸ä¼ è¾“åè®®HTTPã€GRPCç­‰ç›¸å…³çš„é€»è¾‘ Endpoint è´Ÿè´£request/responseæ ¼å¼çš„è½¬æ¢ï¼Œä»¥åŠå…¬ç”¨æ‹¦æˆªå™¨ç›¸å…³çš„é€»è¾‘ Service ä¸šåŠ¡é€»è¾‘ã€‚ å¦å¤–ï¼Œgo-kitæä¾›logæ—¥å¿—ï¼Œmetricè®¡æ•°å™¨ï¼Œtracingè¯·æ±‚è·Ÿè¸ªï¼ŒcircuitbreakeræœåŠ¡ç†”æ–­ï¼Œrate-limiteré™æµå™¨ç­‰æ¨¡å—ã€‚ç®€å•è¯´ï¼Œgo-kitæä¾›äº†å¾®æœåŠ¡æ¶æ„å¸¸è§çš„åŸºç¡€æ¨¡å—ï¼Œå¯ä»¥è®©å¼€å‘è€…çœå»å¾ˆå¤šæ—¶é—´ã€‚ å¼€å§‹äº†è§£è¿˜ä¸å¤Ÿï¼Œshow codeã€‚ æˆ‘ä»¬å…ˆå®šä¹‰ä¸‹serviceï¼Œä¸å¦‚å°±åšä¸ªç®€å•çš„è®¡ç®—å™¨ï¼Œä»…ä»…åšæ¼”ç¤ºï¼Œæœ‰åŠ å‡åŠŸèƒ½å³å¯ï¼Œä¸æ•´å¤ªå¤æ‚äº†ã€‚ package service// æ¥å£å®šä¹‰type CalculateService interface &#123;\tAdd(a, b int) int\tReduce(a, b int) int\tMulti(a, b int) int&#125;type calculateService struct&#123;&#125;func NewService() *calculateService &#123;\treturn &amp;calculateService&#123;&#125;&#125;func (s *calculateService) Add(a, b int) int &#123;\treturn a + b&#125;func (s *calculateService) Reduce(a, b int) int &#123;\treturn a - b&#125;func (s *calculateService) Multi(a, b int) int &#123;\treturn a * b&#125; æ³¨æ„ï¼šGo æ¥å£æ˜¯ä¸€ç»„æ–¹æ³•çš„é›†åˆï¼Œå¯ä»¥ç†è§£ä¸ºæŠ½è±¡çš„ç±»å‹ã€‚å®ƒæä¾›äº†ä¸€ç§éä¾µå…¥å¼çš„æ¥å£ã€‚ä»»ä½•ç±»å‹ï¼Œåªè¦å®ç°äº†è¯¥æ¥å£ä¸­æ–¹æ³•é›†ï¼Œé‚£ä¹ˆå°±å±äºè¿™ä¸ªç±»å‹ã€‚ï¼ˆè¿™æ˜¯goä¸­éå¸¸å¸¸ç”¨çš„ç‰¹æ€§ï¼Œåˆ‡è®°) endpointæ ¼å¼åŒ–è¯·æ±‚ï¼Œè°ƒç”¨serviceæœåŠ¡ï¼Œå¹¶æ ¼å¼åŒ–è¾“å‡º package endpointimport (\t&quot;context&quot;\t&quot;demo6/service&quot;\t&quot;fmt&quot;\t&quot;github.com/go-kit/kit/endpoint&quot;)type Request struct &#123;\tA int `json:&quot;a&quot; form:&quot;a&quot;`\tB int `json:&quot;b&quot; form:&quot;b&quot;`&#125;type Res struct &#123;\tRes int `json:&quot;res&quot;`\tErr error `json:&quot;err&quot;`&#125;func MakeAddEndpoint(s service.CalculateService) endpoint.Endpoint &#123;\treturn func(_ context.Context, request interface&#123;&#125;) (interface&#123;&#125;, error) &#123; req := request.(Request) return Res&#123;Res: s.Add(req.A, req.B)&#125;, nil\t&#125;&#125;func MakeReduceEndpoint(s service.CalculateService) endpoint.Endpoint &#123;\treturn func(_ context.Context, request interface&#123;&#125;) (interface&#123;&#125;, error) &#123; req := request.(Request) return Res&#123;Res: s.Reduce(req.A, req.B)&#125;, nil\t&#125;&#125;func MakeMultiEndpoint(s service.CalculateService) endpoint.Endpoint &#123;\treturn func(_ context.Context, request interface&#123;&#125;) (interface&#123;&#125;, error) &#123; req := request.(Request) return Res&#123;Res: s.Multi(req.A, req.B)&#125;, nil\t&#125;&#125; æ¥ä¸‹æ¥ï¼Œå®šä¹‰transportå®šä¹‰è¯·æ±‚æ–¹å¼ï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨jsonï¼‰ï¼š package transportimport (\t&quot;context&quot;\t&quot;demo6/endpoint&quot;\t&quot;encoding/json&quot;\t&quot;errors&quot;\t&quot;net/http&quot;)func DecodeRequest(_ context.Context, r *http.Request) (interface&#123;&#125;, error) &#123;\tvar req endpoint.Request\tif err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil &#123; return nil, errors.New(&quot;params error&quot;)\t&#125;\treturn req, nil&#125;func EncodeResponse(_ context.Context, w http.ResponseWriter, res interface&#123;&#125;) error &#123;\treturn json.NewEncoder(w).Encode(res)&#125; æœ€åæˆ‘ä»¬å°†å®ƒä»¬endpointå’Œtransportç²˜åˆèµ·æ¥ï¼Œè·‘èµ·æ¥goï½ package mainimport (\t&quot;demo6/endpoint&quot;\t&quot;demo6/service&quot;\t&quot;demo6/transport&quot;\t&quot;net/http&quot;\thttpTransport &quot;github.com/go-kit/kit/transport/http&quot;)func main() &#123;\ts := service.NewService()\tadd := httpTransport.NewServer( endpoint.MakeAddEndpoint(s), transport.DecodeRequest, transport.EncodeResponse,\t)\treduce := httpTransport.NewServer( endpoint.MakeReduceEndpoint(s), transport.DecodeRequest, transport.EncodeResponse,\t)\tmulti := httpTransport.NewServer( endpoint.MakeMultiEndpoint(s), transport.DecodeRequest, transport.EncodeResponse,\t)\thttp.Handle(&quot;/add&quot;, add)\thttp.Handle(&quot;/reduce&quot;, reduce)\thttp.Handle(&quot;/multi&quot;, multi)\thttp.ListenAndServe(&quot;:9009&quot;, nil)&#125; è¿è¡Œèµ·æ¥ï¼š æˆåŠŸè¿è¡Œï¼ è¯¦ç»†ä»£ç è¿›githubgithub.com/puresai/go-example/tree/main/demo6-go-kit ç•™ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹äºjsonæ ¼å¼é”™è¯¯çš„è¯·æ±‚ï¼Œè¿”å›çš„ä¸æ˜¯jsonï¼Œå¦‚ä½•æ”¹é€ ï¼Œè®©æ¥å£è¿”å›jsonå‘¢ï¼Ÿ æœ€è¿‘è‡ªå·±åœ¨ç ”ç©¶goå¾®æœåŠ¡è¿™å—çš„çŸ¥è¯†ï¼Œåç»­å‡ ç¯‡æ–‡å­—åº”è¯¥éƒ½ä¼šä»¥go-kitä¸ºåŸºç¡€å±•å¼€ï¼Œæœ‰å…´è¶£å¯ç»§ç»­å…³æ³¨ã€‚","tags":["goexample"],"categories":["goexample"]},{"title":"é˜²æ­¢æ¼æ‰“å¡ï¼Œåˆ©ç”¨ginå’Œcronæ¥åšä¸€ä¸ªæ™ºèƒ½æé†’","path":"/2021/02/12/goexample3/","content":"ç›®æ ‡ï¼š æ¯å¤©10ç‚¹æé†’æˆ‘æ‰“å¡ æŸ¥è¯¢æ­å·å¤©æ°” ä½¿ç”¨çš„åº“ï¼š github.com/robfig/cron æ€è·¯round2é‡Œé¢æˆ‘ä»¬åšäº†ä¸ªæ¡†æ¶ï¼Œæˆ‘ä»¬ä¸å¦¨ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œæ¥å®Œæˆè¿™ä¸ªdemoã€‚æˆ‘ä»¬é€šè¿‡è§£æä¸åŒæ—¶æ®µçš„æé†’ä»»åŠ¡ï¼Œè§„å¾‹åœ°å­˜å‚¨åˆ°Redisçš„æœ‰åºé›†åˆï¼Œ10så»æŸ¥è¯¢ä¸€æ¬¡æœ‰æ²¡æœ‰éœ€è¦æé†’çš„ä»»åŠ¡ï¼Œå¦‚æœ‰å‘é€åˆ°é’‰é’‰ã€‚ (ä»£ç é¢å¤–è¯´æ˜ï¼šRedisæˆ‘æ›´æ–°æˆäº†v8ç‰ˆæœ¬ï¼Œå‘½ä»¤å‰éœ€è¦åŠ ä¸Šä¸‹æ–‡ï¼Œæ³¨æ„ä¸€ä¸‹) æ¥å…¥é’‰é’‰æœºå™¨äººé’‰é’‰æœºå™¨äººæ–‡æ¡£ æŒ‰ç…§æ–‡æ¡£åœ¨ç¾¤é‡Œæ–°å»ºæœºå™¨äººå³å¯ã€‚æˆ‘å¼€å¯çš„æ˜¯webhookè‡ªå®šä¹‰æœºå™¨äººï¼Œoutgoingæé€åœ°å€å°±æ˜¯é¡¹ç›®æ¥æ”¶ä¿¡æ¯åœ°å€ï¼Œæ¯”å¦‚ï¼šhttp://cron.puresai.com/dingdingPost å»ºè®®è®¾ç½®æˆåŠ ç­¾æˆ–ipé™åˆ¶ï¼Œä»¥é˜²è¢«æ¶æ„æ”»å‡» å…³é”®å­—// util/common.go// å°±åˆ—äº†ä¸€äº›å¸¸è§çš„ï¼Œå¯è‡ªè¡Œæ‰©å±•func UpdateKeywords() &#123;\tRedis := model.RedisClient.Pipeline()\tkey := KeyWords\tRedis.HSet(model.Ctx, key, &quot;åˆ†é’Ÿå&quot;, &quot;1|60&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ—¶å&quot;, &quot;1|3600&quot;)\tRedis.HSet(model.Ctx, key, &quot;å¤©å&quot;, &quot;1|86400&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å¤©&quot;, &quot;-1|1&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨ä¸€&quot;, &quot;2|0&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨äºŒ&quot;, &quot;2|1&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨ä¸‰&quot;, &quot;2|2&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨å››&quot;, &quot;2|3&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨äº”&quot;, &quot;2|4&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨å…­&quot;, &quot;2|5&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ¯å‘¨æ—¥&quot;, &quot;2|6&quot;)\tRedis.HSet(model.Ctx, key, &quot;å‘¨ä¸€&quot;, &quot;3|0&quot;)\tRedis.HSet(model.Ctx, key, &quot;å‘¨äºŒ&quot;, &quot;3|1&quot;)\tRedis.HSet(model.Ctx, key, &quot;å‘¨ä¸‰&quot;, &quot;3|2&quot;)\tRedis.HSet(model.Ctx, key, &quot;å‘¨å››&quot;, &quot;3|3&quot;)\tRedis.HSet(model.Ctx, key, &quot;å‘¨äº”&quot;, &quot;3|4&quot;)\tRedis.HSet(model.Ctx, key, &quot;å‘¨å…­&quot;, &quot;3|5&quot;)\t...\tRedis.HSet(model.Ctx, key, &quot;ä»Šå¤©&quot;, &quot;4|0&quot;)\tRedis.HSet(model.Ctx, key, &quot;æ˜å¤©&quot;, &quot;4|1&quot;)\tRedis.HSet(model.Ctx, key, &quot;åå¤©&quot;, &quot;4|2&quot;)\tRedis.HSet(model.Ctx, key, &quot;å–æ¶ˆ&quot;, &quot;0|0&quot;)\tRedis.Exec(model.Ctx)&#125; å…³é”®å­—ï¼Œå¯ä»¥è‡ªè¡Œæ‰©å±•ï¼Œå¯èƒ½ä¼šæœ‰è¦†ç›–çš„æƒ…å†µï¼Œè¿™é‡Œéœ€è¦æŠ‰æ‹©ï¼Œæ˜¯åŒ¹é…ç¬¬ä¸€ä¸ªè¿˜æ˜¯åŒ¹é…å­—æ•°æœ€å¤šçš„ï¼Œæˆ‘æ­¤å¤„é€‰æ‹©åè€…çš„ã€‚ è§£æå†…å®¹é’‰é’‰æ–‡æ¡£çš„outgoingè¯´æ˜ä¸å…¨ï¼Œæˆ–è€…æ˜¯è—åœ¨å“ªé‡Œæˆ‘æ²¡æ‰¾åˆ°ï¼Œå¯ä»¥ä½¿ç”¨@æœºå™¨äººæ¥æ”¶ä¿¡æ¯æ‰“å°çœ‹ä¸€ä¸‹ã€‚ //å…³æ³¨senderIdå‘é€äººidï¼Œtextå‘é€å†…å®¹ï¼ŒsenderNickå‘é€äººæ˜µç§°å³å¯&#123; &quot;conversationId&quot;:&quot;xxx&quot;, &quot;atUsers&quot;:[ &#123; &quot;dingtalkId&quot;:&quot;xxx&quot; &#125;], &quot;chatbotUserId&quot;:&quot;xxx&quot;, &quot;msgId&quot;:&quot;xxx&quot;, &quot;senderNick&quot;:&quot;sai0556&quot;, &quot;isAdmin&quot;:false, &quot;sessionWebhookExpiredTime&quot;:1594978626787, &quot;createAt&quot;:1594973226742, &quot;conversationType&quot;:&quot;2&quot;, &quot;senderId&quot;:&quot;xxx&quot;, &quot;conversationTitle&quot;:&quot;æ™ºèƒ½å¤‡å¿˜å½•&quot;, &quot;isInAtList&quot;:true, &quot;sessionWebhook&quot;:&quot;xxx&quot;, &quot;text&quot;:&#123; &quot;content&quot;:&quot; hello gin-frame&quot; &#125;, &quot;msgtype&quot;:&quot;text&quot;&#125; å®šä¹‰ä¸€ä¸ªstructï¼Œæ¥æ”¶æ¶ˆæ¯ type DingDingMsgContent struct &#123;\tSenderNick string `json:&quot;senderNick&quot;`\tSenderId string `json:&quot;senderId&quot;`\tText struct &#123; Content string `json:&quot;content&quot;`\t&#125; `json:&quot;text&quot;`&#125;func DingDing(c *gin.Context) &#123;\tdata, _ := ioutil.ReadAll(c.Request.Body)\tform := DingDingMsgContent&#123;&#125;\terr := json.Unmarshal([]byte(data), &amp;form)\t// err := c.ShouldBindJSON(&amp;form)\tif err != nil &#123; fmt.Println(err) return\t&#125;\t....&#125; è§£æï¼Œæ³¨æ„å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç»‘å®šæ‰‹æœºï¼Œå–æ¶ˆä»»åŠ¡ç­‰ï¼Œåšå¯¹åº”çš„ç‰¹æ®Šå¤„ç†ï¼Œç»‘å®šæ‰‹æœºæ˜¯ä¸ºäº†@ æŸäººï¼Œå¦åˆ™æ¶ˆæ¯å®¹æ˜“è¢«å¿½ç•¥ã€‚ func parseContent(form DingDingMsgContent) (err error) &#123;\tstr := form.Text.Content\tRedis := db.RedisClient\tfmt.Println(str)\t// è¦å…ˆç»‘å®šå“Ÿï¼Œä¸ç„¶æ— æ³•@åˆ°å¯¹åº”çš„äºº\tindex := strings.Index(str, &quot;ç»‘å®šæ‰‹æœº&quot;)\tif index &gt; -1 &#123; reg := regexp.MustCompile(&quot;1[0-9]&#123;10&#125;&quot;) res := reg.FindAllString(str, 1) if len(res) &lt; 1 || res[0] == &quot;&quot; &#123; err = errors.New(&quot;æ‰‹æœºæ ¼å¼ä¸æ­£ç¡®&quot;) return &#125; Redis.HSet(db.Ctx, util.KeyDingDingID, form.SenderId, res[0]) util.SendDD(&quot;ç»‘å®šæˆåŠŸ&quot;) return\t&#125;\thExist := Redis.HExists(db.Ctx, util.KeyDingDingID, form.SenderId)\tif !hExist.Val() &#123; err = errors.New(&quot;ç»‘å®šæ‰‹æœºå·æ‰èƒ½ç²¾ç¡®æé†’å“¦ï¼Œå‘é€--ç»‘å®šæ‰‹æœº 13456567878--@æˆ‘å³å¯&quot;) return &#125;\tindex = strings.Index(util.StrSub(str, 0, 10), &quot;æˆ‘çš„æé†’&quot;)\tfmt.Println(index, &quot;---&quot;, util.StrSub(str, 0, 6))\tif index &gt; -1 &#123; www := util.QueryAllQueue(form.SenderId); if len(www) &lt; 1 &#123; err = errors.New(&quot;æš‚æ— ä»»åŠ¡&quot;) return &#125; msg := &quot;&quot; for key,value := range www &#123; fmt.Println(strings.Index(value, &quot;@&quot;)) value := value[0:strings.Index(value, &quot;@&quot;)] fmt.Println(value) msg = util.StrCombine(msg, &quot;ä»»åŠ¡idï¼š&quot;, key, &quot;ï¼Œä»»åŠ¡å†…å®¹ï¼š&quot;, value, &quot;&#123;br&#125;&quot;) &#125; err = errors.New(msg) return\t&#125;\tindex = strings.Index(util.StrSub(str, 0, 10), &quot;æŸ¥çœ‹ä»»åŠ¡&quot;)\tfmt.Println(index, &quot;---&quot;, util.StrSub(str, 0, 6))\tif index &gt; -1 &#123; www := util.QueryAllQueue(form.SenderId); if len(www) &lt; 1 &#123; err = errors.New(&quot;æš‚æ— ä»»åŠ¡&quot;) return &#125; msg := &quot;&quot; for key,value := range www &#123; fmt.Println(strings.Index(value, &quot;@&quot;)) value := value[0:strings.Index(value, &quot;@&quot;)] fmt.Println(value) msg = util.StrCombine(msg, &quot;ä»»åŠ¡idï¼š&quot;, key, &quot;ï¼Œä»»åŠ¡å†…å®¹ï¼š&quot;, value, &quot;&#123;br&#125;&quot;) &#125; err = errors.New(msg) return\t&#125;\tindex = strings.Index(util.StrSub(str, 0, 10), &quot;å–æ¶ˆæ‰€æœ‰ä»»åŠ¡&quot;)\tfmt.Println(index, &quot;---&quot;, util.StrSub(str, 0, 6))\tif index &gt; -1 &#123; if er := util.CancelAllQueue(form.SenderId); er != nil &#123; err = er return &#125; err = errors.New(&quot;å–æ¶ˆæˆåŠŸ&quot;) return\t&#125;\tindex = strings.Index(util.StrSub(str, 0, 10), &quot;å–æ¶ˆ&quot;)\tif index &gt; -1 &#123; reg := regexp.MustCompile(&quot;[a-z0-9]&#123;32&#125;&quot;) res := reg.FindAllString(str, 1) if len(res) &lt; 1 &#123; err = errors.New(&quot;ä»»åŠ¡idä¸æ­£ç¡®&quot;) return &#125; if er := util.CancelQueue(res[0], form.SenderId); er != nil &#123; err = er return &#125; err = errors.New(&quot;å–æ¶ˆæˆåŠŸ&quot;) return\t&#125;\treturn&#125;// æé†’å†…å®¹func tips(form DingDingMsgContent) (err error) &#123;\trd := db.RedisClient\tstr := form.Text.Content\tmobile := rd.HGet(db.Ctx, util.KeyDingDingID, form.SenderId).Val()\tkey := util.KeyWords\tlist, _ := rd.HGetAll(db.Ctx, key).Result()\tnow := time.Now().Unix()\ttipsType := 1\tk := &quot;&quot;\tv := &quot;&quot;\tfmt.Println(&quot;str&quot;, str)\tindex := 0\tfor key, value := range list &#123; index = util.UnicodeIndex(str, key) if index &gt; -1 &amp;&amp; util.StrLen(key) &gt; util.StrLen(k) &#123; fmt.Println(&quot;index&quot;, index, str, key, value) k = key v = value &#125;\t&#125;\tmsg := &quot;&quot;\tvar score int64\tif k != &quot;&quot; &#123; kLen := util.StrLen(k) msg = util.StrSub(str, index+kLen) val := strings.Split(v, &quot;|&quot;) unit := val[1] units,_ := strconv.Atoi(unit) switch val[0] &#123; // å¤šå°‘æ—¶é—´å case &quot;1&quot;: reg := regexp.MustCompile(&quot;[0-9]&#123;1,2&#125;&quot;) res := reg.FindAllString(str, 1) minute, _ := strconv.Atoi(res[0]) score = now + int64(units*minute) // æ¯å‘¨ case &quot;2&quot;: reg := regexp.MustCompile(&quot;[0-9]&#123;1,2&#125;&quot;) res := reg.FindAllString(util.StrSub(msg, 0, 7), -1) hour := 9 minute := 0 if len(res) &gt; 0 &#123; hour, _ = strconv.Atoi(res[0]) &#125; if len(res) &gt; 1 &#123; minute, _ = strconv.Atoi(res[1]) &#125; now = util.GetWeekTS(int64(units)) score = now + int64(60*minute + 3600*hour) tipsType = 2 // ä¸‹å‘¨ case &quot;3&quot;: reg := regexp.MustCompile(&quot;[0-9]&#123;1,2&#125;&quot;) res := reg.FindAllString(util.StrSub(msg, 0, 7), -1) hour := 9 minute := 0 if len(res) &gt; 0 &#123; hour, _ = strconv.Atoi(res[0]) &#125; if len(res) &gt; 1 &#123; minute, _ = strconv.Atoi(res[1]) &#125; now = util.TodayTS() score = now + int64(60*minute + 3600*hour + units*86400) case &quot;4&quot;: reg := regexp.MustCompile(&quot;[0-9]&#123;1,2&#125;&quot;) res := reg.FindAllString(util.StrSub(msg, 0, 7), -1) hour := 9 minute := 0 if len(res) &gt; 0 &#123; hour, _ = strconv.Atoi(res[0]) &#125; if len(res) &gt; 1 &#123; minute, _ = strconv.Atoi(res[1]) &#125; now = util.TodayTS() + 86400*int64(units) score = now + int64(60*minute + 3600*hour) case &quot;-1&quot;: reg := regexp.MustCompile(&quot;[0-9]&#123;1,10&#125;&quot;) res := reg.FindAllString(util.StrSub(msg, 0, 7), -1) fmt.Println(&quot;res&quot;, res) hour := 9 minute := 0 if len(res) &gt; 0 &#123; hour, _ = strconv.Atoi(res[0]) &#125; if len(res) &gt; 1 &#123; minute, _ = strconv.Atoi(res[1]) &#125; now = util.TodayTS() + 86400 score = now + int64(60*minute + 3600*hour) fmt.Println(now, score, minute, hour) tipsType = 3 default: &#125;\t&#125; else &#123; reg := regexp.MustCompile(&quot;(([0-9]&#123;4&#125;)[-|/|å¹´])?([0-9]&#123;1,2&#125;)[-|/|æœˆ]([0-9]&#123;1,2&#125;)æ—¥?&quot;) pi := reg.FindAllStringSubmatch(str, -1) if (len(pi) &gt; 0 ) &#123; date := pi[0] if date[2] == &quot;&quot; &#123; date[2] = &quot;2020&quot; &#125; location, _ := time.LoadLocation(&quot;Asia/Shanghai&quot;) tm2, _ := time.ParseInLocation(&quot;2006/01/02&quot;, fmt.Sprintf(&quot;%s/%s/%s&quot;, date[2], date[3], date[4]), location) score = util.GetZeroTime(tm2).Unix() msg = reg.ReplaceAllString(str, &quot;&quot;) fmt.Println(msg) &#125; else &#123; msg = str score = util.TodayTS() &#125; reg = regexp.MustCompile(&quot;[0-9]&#123;1,10&#125;&quot;) res := reg.FindAllString(util.StrSub(msg, 0, 7), -1) fmt.Println(&quot;res&quot;, res) hour := 9 minute := 0 if len(res) &gt;= 1 &#123; hour, _ = strconv.Atoi(res[0]) fmt.Println(&quot;hour&quot;, hour, minute) &#125; if len(res) &gt; 1 &#123; minute, _ = strconv.Atoi(res[1]) &#125; score += int64(60*minute + 3600*hour)\t&#125;\tif msg == &quot;&quot; &#123; err = errors.New(&quot;ä½ è¯´å•¥&quot;) return\t&#125;\tindex = util.UnicodeIndex(msg, &quot;æé†’æˆ‘&quot;)\tindex2 := util.UnicodeIndex(msg, &quot;æé†’&quot;)\tif index2 &lt; 0 &#123; err = errors.New(&quot;å¤§å“¥ï¼Œè¦æˆ‘æé†’ä½ å¹²å•¥å‘¢ï¼Ÿè¯·å‘é€--ä¸‹å‘¨ä¸€13ç‚¹æé†’æˆ‘å†™ä½œä¸š&quot;) return\t&#125;\tif index &lt; 0 &amp;&amp; index2 &gt; -1 &#123; msg = util.StrSub(msg, index2+2)\t&#125; else &#123; msg = util.StrSub(msg, index+3)\t&#125; fmt.Println(msg, mobile)\tmsg = util.StrCombine(msg, &quot;@&quot;, mobile)\tfmt.Println(score, msg, tipsType, err)\tif err != nil &#123; util.SendDD(err.Error()) return\t&#125;\tmember := util.StrCombine(strconv.Itoa(tipsType), msg)\trd.ZAdd(db.Ctx, util.KeyCrontab, &amp;Redis.Z&#123; Score: float64(score), Member: member,\t&#125;)\tuniqueKey := util.Md5(member)\trd.HSet(db.Ctx, util.StrCombine(util.KeyUserCron, form.SenderId), uniqueKey, member)\tutil.SendDD(fmt.Sprintf(&quot;è®¾ç½®æˆåŠŸ(å–æ¶ˆè¯·å›å¤ï¼šå–æ¶ˆä»»åŠ¡%s)--%sæé†’æ‚¨%s&quot;, uniqueKey, time.Unix(score, 0).Format(&quot;2006/01/02 15:04:05&quot;), msg))\treturn &#125; å‘é€é’‰é’‰æ¶ˆæ¯è¿™é‡Œå°±æ˜¯å¯¹æ¥é’‰é’‰æ¥å£ï¼Œè§£æç»™éœ€è¦æé†’çš„äººå°±è¡Œï¼Œå°±ä¸åšè¿‡å¤šè¯´æ˜äº†ã€‚ func SendDD(msg string) &#123; // æ‰“å°å‡ºæ¥çœ‹çœ‹æ˜¯ä¸ªå•¥\tfmt.Println(&quot;dingding-----------&quot;)\tfmt.Println(msg)\ttips := make(map[string]interface&#123;&#125;)\tcontent := make(map[string]interface&#123;&#125;)\ttips[&quot;msgtype&quot;] = &quot;markdown&quot; // @ æ˜¯ç”¨æ¥æé†’ç¾¤é‡Œå¯¹åº”çš„äºº\tarr := strings.Split(msg, &quot;@&quot;) // [æé†’]æ˜¯æœºå™¨äººå…³é”®å­—ï¼Œä¸ªäººå»ºè®®è®¾ç½®æœºå™¨äººé™åˆ¶ipæˆ–ä½¿ç”¨tokenï¼Œæ¯”è¾ƒé è°±\tcontent[&quot;text&quot;] = fmt.Sprintf(&quot;%s&quot;, strings.Replace(arr[0], &quot;&#123;br&#125;&quot;, &quot; &quot;, -1))\tcontent[&quot;title&quot;] = &quot;é¹…é¹…é¹…&quot;\tif len(arr) &gt; 1 &#123; mobile := make([]string, 0) at := make(map[string]interface&#123;&#125;) mobile = append(mobile, arr[1]) at[&quot;atMobiles&quot;] = mobile tips[&quot;at&quot;] = at content[&quot;text&quot;] = fmt.Sprintf(&quot;%s @%s&quot;, content[&quot;text&quot;], arr[1])\t&#125; tips[&quot;markdown&quot;] = content bytesData, err := json.Marshal(tips) if err != nil &#123; fmt.Println(err.Error() ) return &#125; reader := bytes.NewReader(bytesData) url := viper.GetString(&quot;dingding_url&quot;) request, err := http.NewRequest(&quot;POST&quot;, url, reader) if err != nil &#123; return &#125; request.Header.Set(&quot;Content-Type&quot;, &quot;application/json;charset=UTF-8&quot;) client := http.Client&#123;&#125; _, err = client.Do(request) if err != nil &#123; fmt.Println(err.Error()) return\t&#125;\t// å·æ‡’ä¸é‡è¯•äº† // respBytes, err := ioutil.ReadAll(resp.Body) // if err != nil &#123; // fmt.Println(err.Error()) // return // &#125; // //byteæ•°ç»„ç›´æ¥è½¬æˆstringï¼Œä¼˜åŒ–å†…å­˜ // str := (*string)(unsafe.Pointer(&amp;respBytes)) // fmt.Println(*str)&#125; å®šæ—¶å‘é€ä¸ä»»åŠ¡å–æ¶ˆè¿™å°±æ˜¯å‘é€æé†’çš„æ ¸å¿ƒä»£ç äº†ï¼Œè¯¦ç»†ä½¿ç”¨è¯´æ˜å¯ä»¥çœ‹ä¸‹ï¼š Golang cron å®šæ—¶ä»»åŠ¡ä½¿ç”¨ func Cron() &#123; c := cron.New() spec := &quot;*/10 * * * * ?&quot; c.AddJob(spec, Queue&#123;&#125;) c.Start()&#125;type Queue struct &#123;&#125;func (q Queue) Run() &#123;\tnow := time.Now().Unix()\trd := model.RedisClient\top := &amp;Redis.ZRangeBy&#123; Min: &quot;0&quot;, Max: strconv.FormatInt(now, 10), &#125; ret, err := rd.ZRangeByScoreWithScores(model.Ctx, KeyCrontab, op).Result() if err != nil &#123; fmt.Printf(&quot;zrangebyscore failed, err:%v &quot;, err) return\t&#125; for _, z := range ret &#123; fmt.Println(z.Member.(string), z.Score) QueueDo(z.Member.(string), z.Score) &#125;&#125;func QueueDo(msg string, score float64) &#123;\tmsgType := msg[0:1]\tSendDD(msg[1:])\trd := model.RedisClient\trd.ZRem(model.Ctx, KeyCrontab, msg)\tswitch msgType &#123; case &quot;2&quot;: rd.ZAdd(model.Ctx, KeyCrontab, &amp;Redis.Z&#123; Score: score + 7*86400, Member: msg, &#125;) case &quot;3&quot;: rd.ZAdd(model.Ctx, KeyCrontab, &amp;Redis.Z&#123; Score: score + 86400, Member: msg, &#125;) default: rd.ZRem(model.Ctx, KeyCrontab, msg)\t&#125;&#125;// å–æ¶ˆæé†’func CancelQueue(uniqueKey string, SenderId string) (err error) &#123;\trd := model.RedisClient\tmember := rd.HGet(model.Ctx, StrCombine(KeyUserCron, SenderId), uniqueKey).Val()\tif member == &quot;&quot; &#123; fmt.Println(StrCombine(KeyUserCron, SenderId), uniqueKey) err = errors.New(&quot;æ²¡æœ‰æ­¤ä»»åŠ¡&quot;) return\t&#125;\tfmt.Println(member, &quot;member&quot;)\trd.ZRem(model.Ctx, KeyCrontab, member)\trd.HDel(model.Ctx, StrCombine(KeyUserCron, SenderId), uniqueKey)\terr = errors.New(&quot;å–æ¶ˆæˆåŠŸ&quot;)\treturn &#125;// å–æ¶ˆæ‰€æœ‰func CancelAllQueue(SenderId string) (err error) &#123;\trd := model.RedisClient\tlist, _ := rd.HGetAll(model.Ctx, StrCombine(KeyUserCron, SenderId)).Result()\tfor _, value := range list &#123; rd.ZRem(model.Ctx, KeyCrontab, value)\t&#125; rd.Del(model.Ctx, StrCombine(KeyUserCron, SenderId))\terr = errors.New(&quot;å·²ç»å–æ¶ˆæ‰€æœ‰æé†’ä»»åŠ¡&quot;)\treturn &#125;func QueryAllQueue(SenderId string) (map[string]string) &#123;\trd := model.RedisClient\tlist, _ := rd.HGetAll(model.Ctx, StrCombine(KeyUserCron, SenderId)).Result()\t// fmt.Println(list)\treturn list&#125; å¤©æ°”ä¸èŠå¤©ç»™ä½ æ˜¯æ¥äº†ä¸€ä¸ªå…è´¹æ™ºèƒ½æ¥å£ï¼Œæœ‰å…´è¶£å¯æŸ¥çœ‹githubé…ç½®æ–‡ä»¶ã€‚ æ¥çœ‹çœ‹æ•ˆæœ æ€»ç»“è¿™ä¸ªdemoå…¶å®ä¸»è¦ç‚¹å°±æ˜¯è§£æé’‰é’‰æ¨é€å†…å®¹åšå¯¹åº”çš„å¤„ç†ï¼Œå› å…³é”®å­—è¿‡å¤šï¼Œä»£ç å…¶å®æœ‰ç‚¹å•°å—¦ï¼Œä½ å¯ä»¥è‡ªè¡Œä¼˜åŒ–ï¼Œå¯¹æ¥æ™ºèƒ½æ¥å£å’Œé’‰é’‰æ¥å£ï¼Œè¿˜æ˜¯å®šæ—¶ä»»åŠ¡å…¶å®éƒ½æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå½“ç„¶ï¼Œè¿™åªæ˜¯å¾ˆåŸºç¡€çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚å¦å¤–ï¼Œè¿™æ¬¡ä¹‹åˆ—å‡ºäº†ä¸»è¦ä»£ç ï¼Œæ²¡æœ‰åšååˆ†è¯¦å°½çš„è¯´æ˜ï¼Œæœ‰å…´è¶£å¯ä»¥æŸ¥çœ‹æºç ã€‚ æŸ¥çœ‹githubæºç  å•°å—¦è¿™ä¸ªdemoçš„èµ·åˆä¹Ÿæ˜¯æˆ‘ä»¬å‡ ä¸ªåŒäº‹è€å¿˜è®°æ‰“å¡ï¼Œæœ‰äº†è¿™ä¸ªdemoï¼Œèµ·åˆåªèƒ½æé†’æ‰“å¡ï¼Œåé¢é™†ç»­åŠ å…¥äº†å–æ¶ˆã€æŸ¥çœ‹ã€æŸ¥è¯¢å¤©æ°”ç­‰åŠŸèƒ½ï¼Œå¤§å®¶å­¦ä¹ æŠ€æœ¯çš„æ—¶å€™ä¹Ÿå¯ä»¥è€ƒè™‘åº”ç”¨åˆ°ç”Ÿæ´»åœºæ™¯å½“ä¸­ï¼Œè¿™æ ·å­¦ä¹ èµ·æ¥ä¹Ÿæ¯”è¾ƒæœ‰æœ‰è¶£ï¼Œå®è·µä¸­ä¹Ÿä¼šå‘ç°å¾ˆå¤šæƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œæœ€åï¼Œç¥å¤§å®¶å·¥ä½œæ„‰å¿«ï¼Œä¸å¿˜æ‰“å¡ã€‚","tags":["goexample"],"categories":["goexample"]},{"title":"docker-composeæ•´åˆgo-kitå’Œmysqlã€Redis","path":"/2021/02/12/goexample7/","content":"ä¸“æ ä¹‹å‰æœ‰ä½¿ç”¨go-kitã€gormã€go-Redisï¼Œæ‰€ä»¥éƒ¨åˆ†å†…å®¹å°±å¿½ç•¥ã€‚ å®šä¹‰modelä¸»è¦å®ç°SelectByEmailï¼ˆæŸ¥æ‰¾ï¼‰å’ŒSaveï¼ˆæ–°å»ºï¼‰ä¸¤ä¸ªæ–¹æ³•ï¼š package modelimport &quot;time&quot;type UserEntity struct &#123;\tID int64\tUsername string\tPassword string\tEmail string\tCreatedAt time.Time&#125;func (UserEntity) TableName() string &#123;\treturn &quot;user&quot;&#125;type UserDao interface &#123;\tSelectByEmail(email string) (*UserEntity, error)\tSave(user *UserEntity) error&#125;type UserDaoImpl struct&#123;&#125;func (u *UserDaoImpl) SelectByEmail(email string) (*UserEntity, error) &#123;\tuser := &amp;UserEntity&#123;&#125;\terr := db.Where(&quot;email = ?&quot;, email).First(user).Error\treturn user, err&#125;func (u *UserDaoImpl) Save(user *UserEntity) error &#123;\treturn db.Create(user).Error&#125; ä¸šåŠ¡servicepackage serviceimport (\t&quot;context&quot;\t&quot;demo7-docker-compose/model&quot;\t&quot;errors&quot;\t&quot;log&quot;\t&quot;time&quot;\t&quot;github.com/jinzhu/gorm&quot;)type UserInfoDTO struct &#123;\tID int64 `json:&quot;id&quot;`\tUsername string `json:&quot;username&quot;`\tEmail string `json:&quot;email&quot;`&#125;var (\tErrUserExisted = errors.New(&quot;user is existed&quot;)\tErrPassword = errors.New(&quot;email and password are not match&quot;)\tErrRegistering = errors.New(&quot;email is registering&quot;))type RegisterUser struct &#123;\tUsername string\tPassword string\tEmail string&#125;type UserService interface &#123;\tLogin(ctx context.Context, email, pass string) (*UserInfoDTO, error)\tRegister(ctx context.Context, user *RegisterUser) (*UserInfoDTO, error)&#125;type UserServiceImpl struct &#123;\tuserDao model.UserDao&#125;func MakeUserServiceImpl(userDao model.UserDao) UserService &#123;\treturn &amp;UserServiceImpl&#123; userDao,\t&#125;&#125;func (userService *UserServiceImpl) Login(ctx context.Context, email, password string) (*UserInfoDTO, error) &#123;\tuser, err := userService.userDao.SelectByEmail(email)\tif err == nil &#123; if user.Password == password &#123; return &amp;UserInfoDTO&#123; ID: user.ID, Username: user.Username, Email: user.Email, &#125;, nil &#125; else &#123; return nil, ErrPassword &#125;\t&#125; else &#123; log.Printf(&quot;err : %s&quot;, err)\t&#125;\treturn nil, err&#125;func (userService UserServiceImpl) Register(ctx context.Context, user *RegisterUser) (*UserInfoDTO, error) &#123;\tret := model.RedisClient.SetNX(user.Email, 1, time.Duration(5)*time.Second)\tif ret.Val() == false &#123; return nil, ErrRegistering\t&#125;\tdefer model.RedisClient.Del(user.Email)\texistUser, err := userService.userDao.SelectByEmail(user.Email)\tif (err == nil &amp;&amp; existUser == nil) || err == gorm.ErrRecordNotFound &#123; newUser := &amp;model.UserEntity&#123; Username: user.Username, Password: user.Password, Email: user.Email, &#125; err = userService.userDao.Save(newUser) if err == nil &#123; return &amp;UserInfoDTO&#123; ID: newUser.ID, Username: newUser.Username, Email: newUser.Email, &#125;, nil &#125;\t&#125;\tif err == nil &#123; err = ErrUserExisted\t&#125;\treturn nil, err&#125; æ­¤å¤„æ³¨æ„åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œåˆ©ç”¨äº†Redisçš„setnxæ–¹æ³•ï¼Œå¹¶å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯¹åº”Redisä¸­çš„ SET key value [EX seconds] [PX milliseconds] [NX|XX] ret := model.RedisClient.SetNX(user.Email, 1, time.Duration(5)*time.Second)if ret.Val() == false &#123;\treturn nil, ErrRegistering&#125;defer model.RedisClient.Del(user.Email) å¯¹äºendpointå’Œtransportï¼Œå°±ä¸ä¹‹å‰çš„æ²¡æœ‰å¤ªå¤§å·®åˆ«äº†ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æš‚æ—¶ç•¥å»ï¼Œæœ‰å…´è¶£å¯ç‚¹å‡»æ–‡ç« æœ€åçš„æºç æŸ¥çœ‹ã€‚ mysqlå’ŒRediså®¹å™¨mysqlçš„Dockerfileï¼š FROM mysql:5.7 WORKDIR /docker-entrypoint-initdb.d ENV LANG=C.UTF-8COPY user.sql . è¿è¡Œmysql-for-userå®¹å™¨ docker run -itd --name mysql-for-user -p 3316:3306 -e MYSQL_ROOT_PASSWORD=111111 mysql-for-user è¿™é‡Œå®¹å™¨å¯åŠ¨çš„æ—¶å€™æ˜¯å¯ä»¥æ‰§è¡Œuser.sqlçš„ã€‚ï¼ˆå¯é€šè¿‡docker logs mysql-for-useræŸ¥çœ‹å®¹å™¨å¯åŠ¨ä¿¡æ¯ï¼‰ /usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/user.sql Rediså®¹å™¨çš„å¯åŠ¨ç®€å• docker pull Redis:5.0docker run -itd --name Redis5 -p 6389:6379 Redis:5.0 ç„¶åæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸»ç¨‹åºï¼Œæ™ºèƒ½åˆ°8089ç«¯å£ï¼š go run main.go -service.port 8089 æµ‹è¯•ä¸€ä¸‹ã€‚ å¯ä»¥å®ç°ç™»å½•ä¸æ³¨å†ŒåŠŸèƒ½ã€‚ æ‰“åŒ…ä¼šå‘˜é•œåƒå…ˆç¼–è¯‘ï¼š CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o user . userçš„dockerfile FROM alpine:3.12 WORKDIR /COPY ./user /ENTRYPOINT [&quot;./user&quot;] æ„å»ºé•œåƒ: docker build -t user-alpine . docker-composeversion: &#x27;2.1&#x27;services: user13: image: user-alpine depends_on: - Redis - mysql ports: - &quot;8088:8088&quot; links: - Redis - mysql networks: - user mysql: image: mysql-for-user ports: - &quot;3306:3306&quot; expose: - &quot;3306&quot; environment: - MYSQL_ROOT_PASSWORD=111111 networks: - user restart: always Redis: image: Redis:5.0 ports: - &quot;6379:6379&quot; expose: - &quot;6379&quot; networks: - usernetworks: user: driver: bridge è¯´æ˜ï¼š depends_on ä¾èµ–ï¼Œæ­¤å¤„è¡¨ç¤ºuser13ä¾èµ–Redisã€mysqlï¼Œè¢«ä¾èµ–è€…ä¼šä¼˜å…ˆæ„å»ºï¼Œä½†æ˜¯æ˜¯å¯èƒ½è„šæœ¬ä¸ºè¿è¡ŒæˆåŠŸçš„ï¼Œæ‰€ä»¥user13æ˜¯æœ‰å¯èƒ½åˆšå¼€å§‹è¿æ¥ä¸ä¸Šmysqlçš„ï¼Œdocker startå³å¯ links è¿æ¥ï¼Œæ­¤å¤„user13è¿æ¥åˆ°Redisã€mysqlï¼Œå¯ä»¥ç”¨å®ƒä»¬æ›¿ä»£è¿æ¥æ•°æ®åº“çš„host environment ç¯å¢ƒå˜é‡ expose å¯¹linksæš´éœ²çš„ç«¯å£ è¿è¡Œdocker-compose upå³å¯ã€‚ å¯ä»¥çœ‹è§æœåŠ¡è¿è¡ŒæˆåŠŸäº†ã€‚wowï½ è¯¦ç»†ä»£ç ç‚¹å‡»è¿›github dcoker composerè¯­æ³•å¯çœ‹èœé¸Ÿæ•™ç¨‹ï¼š Docker Compose | èœé¸Ÿæ•™ç¨‹ æ–‡ä¸­éƒ¨åˆ†çŸ¥è¯†æ¥è‡ªã€ŠGoå¾®æœåŠ¡å®æˆ˜38è®²ã€‹ï¼Œæœ‰å…´è¶£å¯å‰å¾€æŸ¥çœ‹ï¼š","tags":["goexample"],"categories":["goexample"]},{"title":"goruntineå’Œchannel","path":"/2021/02/12/goexample8/","content":"å‰é¢å‡ ä¸ªå›åˆï¼Œæˆ‘ä»¬éƒ½æ˜¯å®ä¾‹ï¼Œä½†åœ¨goä¸­æœ‰ä¸ªå¾ˆå¸¸ç”¨çš„ä¸œä¸œï¼Œæˆ‘ä»¬ä»£ç ä½¿ç”¨çš„ä¸å¤šï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å•ç‹¬æ‹¿æ¥è®²è®²ã€‚ goroutine goroutineæ˜¯goè¯­è¨€ç‰¹æœ‰çš„å¹¶å‘ä½“ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹ï¼Œç”±goå…³é”®å­—å¯åŠ¨ã€‚ goroutineé‡‡ç”¨çš„æ˜¯åŠæŠ¢å å¸‚çš„åä½œè°ƒåº¦ï¼Œåªæœ‰å½“å‰goroutineå‘ç”Ÿé˜»å¡æ—¶æ‰ä¼šå¯¼è‡´è°ƒåº¦ï¼ˆä¹Ÿå°±æ˜¯goroutineçš„åˆ‡æ¢ï¼‰ã€‚ é‚£ä¹ˆé¡¹ç›®ä¸­ä½¿ç”¨äº†å¤šä¸ªgoroutineï¼Œå¦‚ä½•åœ¨ä¸åŒçš„goroutineä¹‹é—´é€šä¿¡å‘¢ï¼Ÿ å­¦ä¹ goçš„è¿‡ç¨‹ä¸­ï¼Œæƒ³å¿…ä½ åº”è¯¥çŸ¥é“æœ‰è¿™ä¹ˆä¸€ä¸ªç»å…¸çš„å¥å­ï¼š Do not communicate by sharing memory; instead, share memory by communicating. goroutineçš„é€šä¿¡ç”¨é€šé“ é€šé“æ˜¯ä¸ªå•¥ï¼Ÿ ä¸€ä¸ªé€šé“ç›¸å½“äºä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—ï¼Œé€šé“ä¸­çš„å„ä¸ªå…ƒç´ æ˜¯ä¸¥æ ¼åœ°æŒ‰ç…§å‘é€çš„é¡ºåºæ’åˆ—çš„ï¼Œå…ˆè¢«å‘é€é€šé“çš„ä¸€å®šä¼šå…ˆè¢«æ¥æ”¶ã€‚å…ƒç´ çš„å‘é€å’Œæ¥æ”¶éƒ½éœ€è¦ç”¨åˆ°æ“ä½œç¬¦&lt;-ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªFIFOç®€å•çš„ä¾‹å­ package mainimport &quot;fmt&quot;func main() &#123;\tch := make(chan int, 5)\tch &lt;- 1\tch &lt;- 2\tch &lt;- 3\tch &lt;- 4\tch &lt;- 5\tfmt.Println(&quot;1-&quot;, &lt;-ch)\tfmt.Println(&quot;2-&quot;, &lt;-ch)\tch &lt;- 6\tfmt.Println(&quot;3-&quot;, &lt;-ch)\tfmt.Println(&quot;4-&quot;, &lt;-ch)\tfmt.Println(&quot;5-&quot;, &lt;-ch)\tfmt.Println(&quot;6-&quot;, &lt;-ch)\tclose(ch)&#125;/*æ‰“å°çš„å†…å®¹å¦‚ä¸‹ï¼š1- 12- 23- 34- 45- 56- 6*/ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹é€šé“çš„å¸¸è§„æ“ä½œï¼š åˆ›å»ºé€šé“é€šé“ï¼ˆchannelï¼‰åˆ†ä¸¤ç§ï¼ˆå®¹é‡æ˜¯å¦ä¸º0ï¼‰ï¼š ç¼“å†²é€šé“ éç¼“å†²é€šé“ // ç¼“å†²é€šé“ch1 := make(chan int, 10)ch2 := make(chan bool, 2)// éç¼“å†²é€šé“ch3 := make(chan int)ch4 := make(chan bool, 0) å‘é€é€šé“æ•°æ®// åˆ›å»ºä¸€ä¸ªç©ºæ¥å£é€šé“ï¼Œæ³¨æ„å®šä¹‰çš„é€šé“ç±»å‹æœ‰ch := make(chan interface&#123;&#125;)// å°†0æ”¾å…¥é€šé“ä¸­ch &lt;- 0// å°†helloå­—ç¬¦ä¸²æ”¾å…¥é€šé“ä¸­ch &lt;- &quot;hello&quot; æ¥æ”¶é€šé“æ•°æ®1. é˜»å¡æ¥æ”¶æ•°æ®é˜»å¡æ¨¡å¼æ¥æ”¶æ•°æ®æ—¶ï¼Œå°†æ¥æ”¶å˜é‡ä½œä¸º&lt;-æ“ä½œç¬¦çš„å·¦å€¼ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š data := &lt;-ch æ‰§è¡Œè¯¥è¯­å¥æ—¶å°†ä¼šé˜»å¡ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ•°æ®å¹¶èµ‹å€¼ç»™ data å˜é‡ã€‚ 2. éé˜»å¡æ¥æ”¶æ•°æ®ä½¿ç”¨éé˜»å¡æ–¹å¼ä»é€šé“æ¥æ”¶æ•°æ®æ—¶ï¼Œè¯­å¥ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š data, ok := &lt;-ch// dataï¼šè¡¨ç¤ºæ¥æ”¶åˆ°çš„æ•°æ®ã€‚æœªæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œdata ä¸ºé€šé“ç±»å‹çš„é›¶å€¼// okï¼šè¡¨ç¤ºæ˜¯å¦æ¥æ”¶åˆ°æ•°æ®ã€‚ éé˜»å¡çš„é€šé“æ¥æ”¶æ–¹æ³•å¯èƒ½é€ æˆé«˜çš„ CPU å ç”¨ï¼Œå› æ­¤ä½¿ç”¨éå¸¸å°‘ã€‚å¦‚æœéœ€è¦å®ç°æ¥æ”¶è¶…æ—¶æ£€æµ‹ï¼Œå¯ä»¥é…åˆ select å’Œè®¡æ—¶å™¨ channel è¿›è¡Œï¼Œå¯ä»¥å‚è§åé¢çš„å†…å®¹ã€‚ 3. æ¥æ”¶ä»»æ„æ•°æ®ï¼Œå¿½ç•¥æ¥æ”¶çš„æ•°æ®é˜»å¡æ¥æ”¶æ•°æ®åï¼Œå¿½ç•¥ä»é€šé“è¿”å›çš„æ•°æ®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š &lt;-ch 4. å¾ªç¯æ¥æ”¶é€šé“çš„æ•°æ®æ¥æ”¶å¯ä»¥å€Ÿç”¨ for range è¯­å¥è¿›è¡Œå¤šä¸ªå…ƒç´ çš„æ¥æ”¶æ“ä½œï¼Œæ ¼å¼å¦‚ä¸‹ï¼š package mainimport ( &quot;fmt&quot; &quot;time&quot;)func main() &#123; // æ„å»ºä¸€ä¸ªé€šé“ ch := make(chan int) // å¼€å¯ä¸€ä¸ªå¹¶å‘åŒ¿åå‡½æ•° go func() &#123; // ä»3å¾ªç¯åˆ°0 for i := 3; i &gt;= 0; i-- &#123; // å‘é€3åˆ°0ä¹‹é—´çš„æ•°å€¼ ch &lt;- i // æ¯æ¬¡å‘é€å®Œæ—¶ç­‰å¾… time.Sleep(time.Second) &#125; &#125;() // éå†æ¥æ”¶é€šé“æ•°æ® for data := range ch &#123; // æ‰“å°é€šé“æ•°æ® fmt.Println(data) // å½“é‡åˆ°æ•°æ®0æ—¶, é€€å‡ºæ¥æ”¶å¾ªç¯ if data == 0 &#123; break &#125; &#125;&#125; å…³é—­é€šé“ch := make(chan string)...close(ch) é€šé“ç‰¹æ€§ å¯¹äºåŒä¸€ä¸ªé€šé“ï¼Œå‘é€æ“ä½œä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œæ¥æ”¶æ“ä½œä¹‹é—´ä¹Ÿæ˜¯äº’æ–¥çš„ï¼ˆå¹¶å‘å®‰å…¨ï¼‰ å‘é€æ“ä½œå’Œæ¥æ”¶æ“ä½œä¸­å¯¹å…ƒç´ å€¼çš„å¤„ç†éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ã€‚ å‘é€æ“ä½œåœ¨å®Œå…¨å®Œæˆä¹‹å‰ä¼šè¢«é˜»å¡ï¼Œæ¥æ”¶æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ã€‚ å¯¹äºç¼“å†²é€šé“ï¼šå¦‚æœé€šé“å·²æ»¡ï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰å‘é€æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰å…ƒç´ å€¼è¢«æ¥æ”¶èµ°ï¼›å¦‚æœé€šé“å·²ç©ºï¼Œé‚£ä¹ˆå¯¹å®ƒçš„æ‰€æœ‰æ¥æ”¶æ“ä½œéƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é€šé“ä¸­æœ‰æ–°çš„å…ƒç´ å€¼å‡ºç°ã€‚ å¯¹äºéç¼“å†²é€šé“ï¼šæ— è®ºæ˜¯å‘é€æ“ä½œè¿˜æ˜¯æ¥æ”¶æ“ä½œï¼Œä¸€å¼€å§‹æ‰§è¡Œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é…å¯¹çš„æ“ä½œä¹Ÿå¼€å§‹æ‰§è¡Œï¼Œæ‰ä¼šç»§ç»­ä¼ é€’ã€‚ æ³¨æ„ç‚¹ï¼š å…³é—­é€šé“è¦åœ¨å‘é€æ–¹å…³é—­ï¼Œå…³é—­åå¦‚æœchannelå†…è¿˜æœ‰å…ƒç´ ï¼Œå¹¶ä¸ä¼šå¯¹æ¥ä¸‹æ¥çš„æ¥æ”¶äº§ç”Ÿå½±å“ å•å‘é€šé“æœ€ä¸»è¦çš„ç”¨é€”å°±æ˜¯çº¦æŸå…¶ä»–ä»£ç çš„è¡Œä¸º é€šè¿‡å‡½æ•°çš„å‚æ•°ç±»å‹æˆ–è€…è¿”å›å€¼ç±»å‹æ¥é™åˆ¶ï¼ˆGoçš„è¯­æ³•ç³–ï¼‰ã€‚ func(ch chan&lt;- int)ï¼›ä¼ å…¥åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°é‡Œé¢è°ƒç”¨chåªèƒ½å‘é€func() (ch &lt;-chan int)ï¼›è¿”å›åŒå‘é€šé“ï¼Œåœ¨å‡½æ•°å¤–é¢é‡Œé¢è°ƒç”¨chåªèƒ½æ¥æ”¶ è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æä¸€ä¸‹channelç‹¬æœ‰çš„å…³é”®å­—â€”â€”selectã€‚ A â€œselectâ€ statement chooses which of a set of possible send or receive operations will proceed. It looks similar to a â€œswitchâ€ statement but with the cases all referring to communication operations. ä¸€ä¸ªselectè¯­å¥ç”¨æ¥é€‰æ‹©å“ªä¸ªcaseä¸­çš„å‘é€æˆ–æ¥æ”¶æ“ä½œå¯ä»¥è¢«ç«‹å³æ‰§è¡Œã€‚å®ƒç±»ä¼¼äºswitchè¯­å¥ï¼Œä½†æ˜¯å®ƒçš„caseæ¶‰åŠåˆ°channelæœ‰å…³çš„I/Oæ“ä½œã€‚ è¯´å®Œè¿™äº›æ¦‚å¿µæ€§çš„ç©æ„å„¿ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥å‡ ä¸ªå®ä¾‹ï¼Œæ„Ÿå—ä¸€ä¸‹goroutineé…åˆchannelä½¿ç”¨çš„å¿«æ„Ÿã€‚ chané…åˆselectå®ç°è¶…æ—¶å¤„ç†func main() &#123;\ttimeout := make(chan bool)\tgo func() &#123; time.Sleep(3e9) timeout &lt;- true\t&#125;()\tch := make(chan int)\tselect &#123;\tcase &lt;-ch:\tcase &lt;-timeout: fmt.Println(&quot;timeout!&quot;)\t&#125;&#125; éç¼“å†²é€šé“ï¼Œç›‘å¬ä¿¡å·é‡// æ¥è‡ªginæ–‡æ¡£çš„ä¾‹å­func main() &#123;\trouter := gin.Default()\trouter.GET(&quot;/&quot;, func(c *gin.Context) &#123; time.Sleep(5 * time.Second) c.String(http.StatusOK, &quot;Welcome Gin Server&quot;)\t&#125;)\tsrv := &amp;http.Server&#123; Addr: &quot;:8080&quot;, Handler: router,\t&#125;\tgo func() &#123; // æœåŠ¡è¿æ¥ if err := srv.ListenAndServe(); err != nil &amp;&amp; err != http.ErrServerClosed &#123; log.Fatalf(&quot;listen: %s &quot;, err) &#125;\t&#125;()\t// ç­‰å¾…ä¸­æ–­ä¿¡å·ä»¥ä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ï¼ˆè®¾ç½® 5 ç§’çš„è¶…æ—¶æ—¶é—´ï¼‰\tquit := make(chan os.Signal)\tsignal.Notify(quit, os.Interrupt)\t&lt;-quit\tlog.Println(&quot;Shutdown Server ...&quot;)\tctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\tdefer cancel()\tif err := srv.Shutdown(ctx); err != nil &#123; log.Fatal(&quot;Server Shutdown:&quot;, err)\t&#125;\tlog.Println(&quot;Server exiting&quot;)&#125; å½“ç„¶è¿˜æœ‰å…¶ä»–åº”ç”¨åœºæ™¯ï¼Œå¦‚æ¶ˆæ¯ä¼ é€’ã€æ¶ˆæ¯è¿‡æ»¤ï¼Œäº‹ä»¶è®¢é˜…ä¸å¹¿æ’­ï¼Œè¯·æ±‚ã€å“åº”è½¬å‘ï¼Œå¹¶å‘æ§åˆ¶ï¼ŒåŒæ­¥ä¸å¼‚æ­¥ç­‰ï¼Œå¯å‚è€ƒä¸‹é¢çš„æ–‡ç« ï¼š æ€»ç»“äº†æ‰çŸ¥é“ï¼ŒåŸæ¥channelæœ‰è¿™ä¹ˆå¤šç”¨æ³•ï¼ å®ä¾‹ä»£ç ç‚¹å‡»è§githubgithub.com/puresai/go-example/tree/main/demo8-goroutine-channel å‚è€ƒï¼š Goè¯­è¨€é€šé“ï¼ˆchanï¼‰â€”â€”goroutineä¹‹é—´é€šä¿¡çš„ç®¡é“ Goè¯­è¨€æ ¸å¿ƒ36è®²_Golang_Goè¯­è¨€-æå®¢æ—¶é—´","tags":["goexample"],"categories":["goexample"]},{"title":"golangé™æµå™¨","path":"/2021/02/12/goexample9/","content":"é™æµåº”è¯¥æ˜¯æˆ‘ä»¬å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„äº†ï¼Œé™æµå™¨èƒ½ä¿è¯æˆ‘ä»¬ä¸è‡³äºåœ¨æµé‡è¿‡å¤§çš„æ—¶å€™æœåŠ¡è¶…è¿‡è´Ÿè½½ï¼Œèƒ½æœ‰æ•ˆåœ°ä¿è¯æœåŠ¡çš„å¯ç”¨å’Œç¨³å®šã€‚ goè‡ªå¸¦æœ‰é™æµå™¨rateï¼Œå®ƒçš„æœ¬è´¨å…¶å®å°±æ˜¯ä»¤ç‰Œæ¡¶ã€‚ç”¨èµ·æ¥ä¹Ÿååˆ†ç®€å•ã€‚æˆ‘ä»¬ä¿®æ”¹ä¸‹ä¹‹å‰çš„httpæœåŠ¡åšä¸€äº›ä¿®æ”¹ï¼š func main() &#123;\t// ServeMuxç±»å‹æ˜¯HTTPè¯·æ±‚çš„å¤šè·¯è½¬æ¥å™¨ã€‚å®ƒä¼šå°†æ¯ä¸€ä¸ªæ¥æ”¶çš„è¯·æ±‚çš„URLä¸ä¸€ä¸ªæ³¨å†Œæ¨¡å¼çš„åˆ—è¡¨è¿›è¡ŒåŒ¹é…ï¼Œå¹¶è°ƒç”¨å’ŒURLæœ€åŒ¹é…çš„æ¨¡å¼çš„å¤„ç†å™¨ã€‚\tmux := http.NewServeMux()\tmux.HandleFunc(&quot;/&quot;, defaultHttp)\thttp.ListenAndServe(&quot;:8080&quot;, middlewareLimit(mux))&#125;// é™æµæ¡¶var limiter = rate.NewLimiter(rate.Every(time.Second), 1)func middlewareLimit(next http.Handler) http.Handler &#123;\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) &#123; if limiter.Allow() == false &#123; fmt.Println(&quot;limit&quot;) return &#125; next.ServeHTTP(w, r)\t&#125;)&#125;// é»˜è®¤httpå¤„ç†func defaultHttp(w http.ResponseWriter, r *http.Request) &#123;\tpath := r.URL.Path\tif path == &quot;/&quot; &#123; w.Write([]byte(&quot;index&quot;)) fmt.Println(&quot;index&quot;) return\t&#125;\t// è‡ªå®šä¹‰404\thttp.Error(w, &quot;you lost???&quot;, http.StatusNotFound)&#125; è¿™é‡Œçš„ var limiter = rate.NewLimiter(rate.Every(2*time.Second), 1) å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªé™æµå™¨ï¼Œç”Ÿæˆé€Ÿç‡æ˜¯1 ä¸ª/sï¼Œä»¤ç‰Œæ¡¶çš„å®¹é‡æ˜¯1ã€‚ä¹Ÿå°±æ˜¯æ¯ç§’æœ€å¤šèƒ½é€šè¿‡2ä¸ªè¯·æ±‚ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨abæˆ–è€…å¿«é€Ÿåˆ·æ–°æµè§ˆå™¨æ¥çœ‹ä¸€ä¸‹æ•ˆæœ æ˜¯ä¸æ˜¯æœ‰ç‚¹ç±»ä¼¼nginxçš„é™æµæ¨¡å—ï¼š limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;server &#123; ... location / &#123; #ç¼“å­˜åŒºé˜Ÿåˆ—burst=5ä¸ª,nodelayè¡¨ç¤ºä¸å»¶æœŸ(è¶…è¿‡çš„è¯·æ±‚å¤±è´¥)ï¼Œå³æ¯ç§’æœ€å¤šå¯å¤„ç†rate+burstä¸ª,åŒæ—¶å¤„ç†rateä¸ªã€‚ limit_req zone=one burst=1 nodelay; &#125;&#125; ä¸Šé¢çš„ä»£ç æœ‰ä¸¤å¤„æ³¨æ„ç‚¹ï¼š middlewareLimit å¯çœ‹ä½œä¸€ä¸ªhttp serverçš„å‰ç½®ä¸­é—´ä»¶ï¼Œä½ å¯ä»¥ç±»æ¯”å»è‡ªå·±å¤„ç†å¤æ‚çš„httpä¸­é—´ä»¶ä¸šåŠ¡ã€‚ é™æµå™¨çš„åˆå§‹åŒ–åŠ¡å¿…åœ¨ä¸­é—´ä»¶å‰ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¿®æ”¹ä»£ç å†æµ‹è¯•: func middlewareLimit(next http.Handler) http.Handler &#123;\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) &#123; limiter := rate.NewLimiter(rate.Every(2*time.Second), 10) if limiter.Allow() == false &#123; fmt.Println(&quot;limit&quot;) return &#125; next.ServeHTTP(w, r)\t&#125;)&#125; æ­¤å¤–ï¼ŒLimiter ä¹Ÿæœ‰å…¶ä»–çš„æ–¹æ³•ï¼š SetLimit(Limit) åŠ¨æ€ä¿®æ”¹æ”¾å…¥ä»¤ç‰Œçš„é€Ÿç‡ SetBurst(int) åŠ¨æ€ä¿®æ”¹æ¡¶å¤§å° Wait/WaitN å½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶ï¼Œå°†é˜»å¡ç­‰å¾… Reserve/ReserveN å½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶ï¼Œè¿”å› Reservationï¼Œå’Œè¦ç­‰å¾…å¤šä¹…æ‰èƒ½è·å¾—è¶³å¤Ÿçš„äº‹ä»¶ ä»£ç ç‚¹å‡»è§githubgithub.com/puresai/go-example/tree/main/demo9-rate","tags":["goexample"],"categories":["goexample"]},{"title":"2020,è¿™ä¸€å¹´","path":"/2021/02/11/2020/","content":"å¤§å®¶ï¼Œè¿‡å¹´å¥½å•Šï¼ åˆåˆ°é™¤å¤•äº†ï¼Œå¤§å®¶é™¤å¤•å¿«ä¹ï½ å…¬ä¼—å·æœ‰åŠå¹´æ²¡æ›´æ–°ï¼Œä¸€æ¥è‡ªå·±æ‡’äº†ï¼ŒäºŒæ¥ä¹‹å‰æ‰¾çš„ç¼–è¾‘å™¨å®åœ¨ä¸å¥½ç”¨ï¼ŒçŸ¥ä¹å’Œè‡ªå·±åšå®¢å€’æ˜¯å‘äº†ä¸€äº›æ–‡ç« ï¼Œæƒ³ç€æœ‰è¿™å¹´ç»ˆæ€»ç»“çš„ä¹ æƒ¯ï¼Œå°±æ¥æ€»ç»“ä¸€ä¸‹å§ã€‚ ç”Ÿæ´»å®Œæˆäº†ä¸€ä»¶äººç”Ÿå¤§äº‹ï¼Œåœ¨å¯¹è±¡æ‰€åœ¨åŸå¸‚ä¹°æˆ¿äº†ï¼Œè™½ç„¶ä¸€ä¸‹å­æˆäº†ç™¾ä¸‡è´Ÿç¿ï¼Œä½†å¥½åœ¨ä¸¤ä¸ªäººå¿ƒé‡Œè¸å®äº†ä¸€ç‚¹ã€‚ å› ä¸ºç–«æƒ…çš„åŸå› ï¼Œäººç”Ÿå¤§äº‹è¿›åº¦å—äº†å½±å“ï¼Œéƒ½å‡‘åˆ°å¹´åäº†ï¼Œç‰¹æ®Šæƒ…å†µï¼Œä¸æ€¥ç€ã€‚ è‡ªå·±ä¹Ÿç»ˆäºå†³å®šå»åŒ»é™¢ï¼Œæ²»ç–—è‡ªå·±å›°æ‰°å¤šå¹´çš„é¼¾ç—‡ï¼Œè¿‡ç¨‹ç—›è‹¦ï¼Œåœ¨ICUèººäº†ä¸€å¤©ä¸€å¤œï¼Œå¥½åœ¨æœ¯åæ¢å¤è‰¯å¥½ï¼Œæœ¯åä¹Ÿæ„Ÿè§‰å‘¼å¸æ¯”ä¹‹å‰è¦èˆ’ç•…å¾—å¤šã€‚å»å¹´æ²»äº†åŠå¹´çš„æ¹¿ç–¹ï¼Œå¦‚ä»Šä¹Ÿå¥½å¤šäº†ï¼Œå¶æœ‰å¤å‘ï¼Œæ— ç”šå½±å“ã€‚ å¶æœ‰ä¸é€‚å¤´æ™•è€³é¸£ï¼Œå¥½åœ¨å…ƒæ—¦åä½“æ£€ç»“æœï¼Œé™¤äº†è¦æ§åˆ¶ä¸‹é¥®é£Ÿï¼Œå¤šè¿åŠ¨ï¼Œæ²¡æœ‰å¤ªå¤§é—®é¢˜ã€‚è¿˜æ˜¯è¦å¤šè¿åŠ¨ï¼Œå°‘æ²¹è…»ï¼Œä¸‰é¤è§„å¾‹ï¼Œæ—©ç¡æ—©èµ·ã€‚ æ¸¸æ³³ï¼Œè‡ªå­¦æˆæ‰ï¼Œè›™æ³³50mä¸€åˆ†é’Ÿï¼Œè‡ªç”±æ³³50mä¸€åˆ†åŠï¼Œåªä¼šå³ä¾§æ¢æ°”ï¼Œä¸ƒå…«æœˆä»½æ—©ä¸Š6ç‚¹èµ·æ¥æ¸¸æ—©åœºï¼Œè¿˜åšæŒä¸‹æ¥äº†ã€‚ç»™è‡ªå·±ç‚¹ä¸ªèµï¼Œè¿åŠ¨æ–¹é¢çš„å­¦ä¹ èƒ½åŠ›è¿˜æ˜¯å¯ä»¥çš„ã€‚ å·¥ä½œç›¸æ¯”å»å¹´è¦å¿™å¾—å¤šï¼Œä¸è¿‡è¿˜èƒ½æ¥å—ï¼Œæœ‰æ„è¯†åœ°å°†å­¦ä¹ çš„çŸ¥è¯†å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œåšä¸€äº›æ¶æ„æ¼”è¿›ï¼Œæé«˜å·¥ä½œæ•ˆç‡å’Œå¯ç”¨æ€§ã€‚ä»Šå¹´ä¹ŸæŠŠvue-element-adminä¹Ÿç»™ç”¨å¾—å¾ˆç†Ÿç»ƒäº†ï¼ŒåŸºæœ¬åšçš„åå°éƒ½æ˜¯è¿™ä¸ªï¼Œå¿«é€Ÿæ­å»ºï¼Œè´¼å¥½ç”¨ã€‚ æ¥å¹´å¸Œæœ›ä¸»è¦è¯­è¨€è½¬åˆ°goï¼Œå…·ä½“çš„å°±ä¸æ˜ç¡®äº†ï¼Œçœ‹å·¥ä½œéœ€è¦ã€‚ å…¶ä»–å…³äºç†è´¢ï¼Œè‡ªå·±åœ¨ä¸ƒæœˆè¡Œæƒ…ä¸­å„ç§çæ“ä½œï¼Œäºäº†ï¼Œå¿ƒç–¼å•Šï¼Œå¥½åœ¨åç»­çœ‹å¥½çš„è¡Œä¸šè¿˜ä¸é”™ï¼Œå°±å½“äº¤å­¦è´¹äº†ï¼Œæ¥å¹´è¿˜æ˜¯åŸºé‡‘å§ï¼Œæ²¡é‚£ä¹ˆå¤šæ—¶é—´çœ‹ç›˜ï¼Œçœ‹è¡Œä¸šï¼Œçœ‹é•¿æœŸï¼Œçœ‹è¶‹åŠ¿ã€‚ æ–°å¹´è®¡åˆ’ å¤šå°è¯•è‡ªåª’ä½“ï¼Œä¸å±€é™äºå…¬ä¼—å·ã€çŸ¥ä¹ æ³¨æ„é¥®é£Ÿï¼Œä½œæ¯è§„å¾‹ å¤šè¿åŠ¨ï¼Œç¯®çƒæ¸¸æ³³ï¼Œæ³¨æ„ä½“é‡ æ·±å…¥å¾®æœåŠ¡æŠ€æœ¯æ ˆ åª³å¦‡å¨¶å›å®¶ æœ€åç¥å„ä½é™¤å¤•å¿«ä¹ï¼Œé˜–å®¶å¹¸ç¦ï¼æ‹œå¹´å•¦ åºšå­é™¤å¤•äºæ‰¬å·","tags":["oneyear"],"categories":["oneyear"]},{"title":"DockeråŸºç¡€ä¸å¸¸ç”¨å‘½ä»¤","path":"/2021/02/10/312/","content":"Docker æ˜¯ä»€ä¹ˆï¼ŸDocker å±äº Linux å®¹å™¨çš„ä¸€ç§å°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨ä½¿ç”¨æ¥å£ã€‚å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Linux å®¹å™¨è§£å†³æ–¹æ¡ˆã€‚ Docker å°†åº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ã€‚ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚æœ‰äº† Dockerï¼Œå°±ä¸ç”¨æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚ æ€»ä½“æ¥è¯´ï¼ŒDocker çš„æ¥å£ç›¸å½“ç®€å•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼ŒæŠŠè‡ªå·±çš„åº”ç”¨æ”¾å…¥å®¹å™¨ã€‚å®¹å™¨è¿˜å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€å¤åˆ¶ã€åˆ†äº«ã€ä¿®æ”¹ï¼Œå°±åƒç®¡ç†æ™®é€šçš„ä»£ç ä¸€æ ·ã€‚ Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ é•œåƒï¼ˆImageï¼‰ï¼šç±»ä¼¼äºè™šæ‹Ÿæœºä¸­çš„é•œåƒï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é¢å‘Dockerå¼•æ“çš„åªè¯»æ¨¡æ¿ã€‚ä»»ä½•åº”ç”¨ç¨‹åºè¿è¡Œéƒ½éœ€è¦ç¯å¢ƒï¼Œè€Œé•œåƒå°±æ˜¯ç”¨æ¥æä¾›è¿™ç§è¿è¡Œç¯å¢ƒçš„ã€‚ä¾‹å¦‚ä¸€ä¸ªUbuntué•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Ubuntuæ“ä½œç³»ç»Ÿç¯å¢ƒçš„æ¨¡æ¿ï¼ŒåŒç†åœ¨è¯¥é•œåƒä¸Šè£…ä¸ŠApacheè½¯ä»¶ï¼Œå°±å¯ä»¥ç§°ä¸ºApacheé•œåƒã€‚ å®¹å™¨ï¼ˆContainerï¼‰ï¼šç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç›’ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæç®€çš„Linuxç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬rootæƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ï¼Œä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚Dockerå¼•æ“åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œã€éš”ç¦»å„ä¸ªåº”ç”¨ã€‚å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„åº”ç”¨å®ä¾‹ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å®¹å™¨ï¼Œå„ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ã€‚æ³¨æ„ï¼šé•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œå®¹å™¨ä»é•œåƒå¯åŠ¨æ—¶ï¼ŒDockeråœ¨é•œåƒçš„ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ï¼Œé•œåƒæœ¬èº«ä¸å˜ã€‚ ä»“åº“ï¼ˆRepositoryï¼‰ï¼šç±»ä¼¼äºä»£ç ä»“åº“ï¼Œè¿™é‡Œæ˜¯é•œåƒä»“åº“ï¼Œæ˜¯Dockerç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ã€‚æ³¨æ„ä¸æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰çš„åŒºåˆ«ï¼šæ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªä»“åº“ï¼›è€Œä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œä¸€èˆ¬æ¯ä¸ªä»“åº“å­˜æ”¾ä¸€ç±»é•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ©ç”¨tagè¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚Ubuntuä»“åº“å­˜æ”¾æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ12.04ã€14.04ç­‰ï¼‰çš„Ubuntué•œåƒã€‚ Docker çš„ç”¨é€”Docker çš„ä¸»è¦ç”¨é€”ï¼Œç›®å‰æœ‰ä¸‰å¤§ç±»ã€‚ ï¼ˆ1ï¼‰æä¾›ä¸€æ¬¡æ€§çš„ç¯å¢ƒã€‚æ¯”å¦‚ï¼Œæœ¬åœ°æµ‹è¯•ä»–äººçš„è½¯ä»¶ã€æŒç»­é›†æˆçš„æ—¶å€™æä¾›å•å…ƒæµ‹è¯•å’Œæ„å»ºçš„ç¯å¢ƒã€‚ ï¼ˆ2ï¼‰æä¾›å¼¹æ€§çš„äº‘æœåŠ¡ã€‚å› ä¸º Docker å®¹å™¨å¯ä»¥éšå¼€éšå…³ï¼Œå¾ˆé€‚åˆåŠ¨æ€æ‰©å®¹å’Œç¼©å®¹ã€‚ ï¼ˆ3ï¼‰ç»„å»ºå¾®æœåŠ¡æ¶æ„ã€‚é€šè¿‡å¤šä¸ªå®¹å™¨ï¼Œä¸€å°æœºå™¨å¯ä»¥è·‘å¤šä¸ªæœåŠ¡ï¼Œå› æ­¤åœ¨æœ¬æœºå°±å¯ä»¥æ¨¡æ‹Ÿå‡ºå¾®æœåŠ¡æ¶æ„ã€‚ Dockerçš„ä¼˜ç¼ºç‚¹ä¼˜ç‚¹1. æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº dockerå¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ï¼Œæ— è®ºæ˜¯åº”ç”¨æ‰§è¡Œé€Ÿåº¦ï¼Œå†…å­˜æŸè€—æˆ–è€…æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ï¼Œéƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ›´é«˜æ•ˆã€‚å› æ­¤ï¼Œç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¸€ä¸ªç›¸åŒé…ç½®çš„ä¸»æœºå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚ 2. æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´ ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨åº”ç”¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œdockerå®¹å™¨åº”ç”¨ï¼Œç”±äºç›´æ¥è¿è¡Œäºå®¿ä¸»å†…æ ¸ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åšåˆ°ç§’çº§ï¼Œç”šè‡³æ¯«ç§’çº§çš„å¯åŠ¨æ—¶é—´ï¼Œå¤§å¤§çš„èŠ‚çº¦äº†å¼€å‘æµ‹è¯•ï¼Œéƒ¨ç½²çš„æ—¶é—´ã€‚ 3. ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ å¼€å‘è¿‡ç¨‹ä¸­å¸¸è§çš„ä¸€ä¸ªé—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´é—®é¢˜ï¼Œç”±äºå¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº›bugå¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ã€‚è€Œdockerçš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šåœ¨å‡ºç°â€œè¿™æ®µä»£ç åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜â€è¿™ç±»é—®é¢˜ã€‚ 4. æŒç»­æ”¯ä»˜å’Œéƒ¨ç½² å¯¹å¼€å‘å’Œè¿ç»´äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›å°±æ˜¯ä¸€æ¬¡åˆ›å»ºå’Œéƒ¨ç½²ï¼Œå¯ä»¥åœ¨ä»»æ„çš„åœ°æ–¹è¿è¡Œã€‚ï¼ˆå®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°é›†æˆã€æŒç»­æ”¯ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡dockerfileæ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆæŒç»­é›†æˆç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆæŒç»­éƒ¨ç½²ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ï¼‰ã€‚è€Œä¸”ä½¿ç”¨dockerfileä½¿é•œåƒæ„å»ºé€æ˜åŒ–ï¼Œä¸ä»…ä»…å¼€å‘å›¢é˜Ÿå¯ä»¥ç†è§£åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ–¹ä¾¿è¿ç»´å›¢é˜Ÿç†è§£åº”ç”¨è¿è¡Œæ‰€éœ€æ¡ä»¶ï¼Œå¸®åŠ©æ›´å¥½çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²è¯¥é•œåƒã€‚ 5. æ›´è½»æ¾çš„è¿ç§» ç”±äºdockerç¡®ä¿äº†æ‰§è¡Œç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œä½¿å¾—åº”ç”¨çš„è¿ç§»æ›´åŠ çš„å®¹æ˜“ã€‚dockerå¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œæ— è®ºæ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ã€ç”šè‡³æ˜¯ç¬”è®°æœ¬ã€å…¶è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„å°†åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿è¡Œç¯å¢ƒçš„å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„æƒ…å†µã€‚ 6. æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‹“å±• dockerä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨ä»¥åŠé•œåƒçš„æŠ€æœ¯ï¼Œä½¿å¾—åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿä½¿å¾—åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ï¼ŒåŸºäºåŸºç¡€é•œåƒè¿›ä¸€æ­¥æ‰©å±•é•œåƒä¹Ÿå˜å¾—ååˆ†ç®€å•ã€‚æ­¤å¤–ï¼Œdockerå›¢é˜ŸåŒå„ä¸ªå¼€æºé¡¹ç›®å›¢é˜Ÿä¸€èµ·ç»´æŠ¤äº†ä¸€å¤§æ‰¹é«˜è´¨é‡çš„å®˜ç½‘é•œåƒï¼Œæ—¢å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºåŸºç¡€è¿›ä¸€æ­¥å®šåˆ¶ï¼Œå¤§å¤§çš„é™ä½äº†åº”ç”¨æœåŠ¡çš„é•œåƒåˆ¶ä½œæˆæœ¬ã€‚ ç¼ºç‚¹1.éš”ç¦»æ€§ åŸºäºhypervisorçš„è™šæ‹ŸæŠ€æœ¯ï¼Œåœ¨éš”ç¦»æ€§ä¸Šæ¯”å®¹å™¨æŠ€æœ¯è¦å¥½ï¼Œå®ƒä»¬çš„ç³»ç»Ÿç¡¬ä»¶èµ„æºå®Œå…¨ä¸Šè™šæ‹ŸåŒ–çš„ï¼Œå½“ä¸€å°è™šæ‹Ÿæœºå‡ºç°ç³»ç»Ÿçº§åˆ«çš„é—®é¢˜ï¼Œå¾€å¾€ä¸ä¼šè”“å»¶åˆ°åŒä¸€å®¿ä¸»æœºä¸Šçš„å…¶å®ƒè™šæ‹Ÿæœºä¸Šï¼Œä½†æ˜¯å®¹å™¨å°±ä¸ä¸€æ ·äº†ï¼Œå®¹å™¨ä¹‹é—´å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸åŠå…¶å®ƒç»„ä»¶ï¼Œæ‰€ä»¥åœ¨å—åˆ°è¯¸å¦‚é»‘å®¢æ”»å‡»è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€šè¿‡åº•å±‚æ“ä½œç³»ç»Ÿå½±å“çš„å…¶å®ƒå®¹å™¨ï¼Œç”šè‡³é€ä¸ªå‡»ç ´ï¼Œäº§ç”Ÿè¿é”ååº”ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡éƒ¨ç½²å®¹å™¨æ¥è§£å†³ï¼Œä½†éšä¹‹åˆä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆæœ¬å¢åŠ ä»¥åŠæ€§èƒ½é—®é¢˜ã€‚ 2.æ€§èƒ½ ä¸ç®¡æ˜¯è™šæ‹Ÿæœºè¿˜æ˜¯å®¹å™¨ï¼Œéƒ½æ˜¯è¿ç”¨ä¸åŒçš„æŠ€æœ¯å¯¹åº”ç”¨æœ¬èº«è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„å°è£…ä¸éš”ç¦»ï¼Œåœ¨é™ä½åº”ç”¨å’Œåº”ç”¨ä¹‹é—´ä»¥åŠåº”ç”¨å’Œç¯å¢ƒä¹‹é—´çš„è€¦åˆæ€§ä¸Šåšäº†å¾ˆå¤šåŠªåŠ›ï¼Œä½†æ˜¯éšä¹‹è€Œæ¥çš„ï¼Œå°±ä¼šäº§ç”Ÿæ›´è¿‡çš„ç½‘ç»œè¿æ¥è½¬å‘å’Œæ•°æ®äº¤äº’ï¼Œè¿™åœ¨ä½å¹¶å‘ç³»ç»Ÿä¸Šè™½ç„¶ä¸ä¼šå¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯å½“åŒä¸€è™šæ‹Ÿæœºæˆ–è€…æœåŠ¡å™¨ä¸‹é¢çš„å®¹å™¨éœ€è¦æ›´é«˜å¹¶å‘é‡æ”¯æ’‘çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯å¹¶å‘é—®é¢˜æˆä¸ºç³»ç»Ÿç“¶é¢ˆçš„æ—¶å€™ï¼Œå®¹å™¨ä¼šå°†è¿™ä¸ªé—®é¢˜æ”¾å¤§ï¼Œæ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯éƒ½é€‚åˆå®¹å™¨æŠ€æœ¯ã€‚ 3.å­˜å‚¨æ–¹æ¡ˆ å®¹å™¨çš„è¯ç”Ÿå¹¶ä¸æ˜¯ä¸ºOSæŠ½è±¡æœåŠ¡çš„ï¼Œè¿™æ˜¯å®ƒå’Œè™šæ‹Ÿæœºæœ€å¤§çš„åŒºåˆ«ï¼Œè¿™æ ·çš„åŸºå› æ„å‘³ç€å®¹å™¨å¤©ç”Ÿæ˜¯ä¸ºåº”ç”¨ç¯å¢ƒåšæ›´å¤šçš„åŠªåŠ›ï¼Œå®¹å™¨çš„ä¼¸ç¼©ä¹Ÿæ˜¯åŸºäºå®¹å™¨çš„è¿™ä¸€ç‰¹æ€§ï¼Œè€Œä¸ä¹‹ç›¸å¯¹çš„ï¼Œéœ€è¦æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆæ°æ°ç›¸åï¼Œåœ¨æ•°æ®å­˜å‚¨è¿™ä¸€ç‚¹ä¸ŠDockerå®¹å™¨æä¾›çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨volumeæ¥å£(å­˜å‚¨å·)å½¢æˆæ•°æ®çš„æ˜ å°„å’Œè½¬ç§»ï¼Œä»¥å®ç°æ•°æ®æŒä¹…åŒ–çš„ç›®çš„ã€‚ä½†æ˜¯è¿™æ ·åŒæ ·ä¹Ÿä¼šé€ æˆä¸€éƒ¨åˆ†èµ„æºçš„æµªè´¹å’Œæ›´å¤šçš„äº¤äº’ï¼Œä¸ç®¡æ˜¯æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šè¿˜æ˜¯ç½‘ç»œç£ç›˜ï¼Œéƒ½æ˜¯é€€è€Œæ±‚å…¶æ¬¡çš„è§£å†³æ–¹æ¡ˆã€‚ åŸºç¡€å‘½ä»¤ å¯åŠ¨ docker start å®¹å™¨å åˆ é™¤ docker rm å®¹å™¨å åœæ­¢æ‰€æœ‰å®¹å™¨ docker stop $(docker ps -a -q) åˆ é™¤æ‰€æœ‰å®¹å™¨ docker rm $(docker ps -a -q) å®¹å™¨æ„å»ºé•œåƒ Usage:docker build [OPTIONS] PATH | URL | -OPTIONS:-t ï¼Œ--tag list #æ„å»ºåçš„é•œåƒåç§°-fï¼Œ --file string #æŒ‡å®šDockerfiileæ–‡ä»¶ä½ç½®ç¤ºä¾‹:- 1ï¼Œdocker build .- 2ï¼Œdocker build -t Redis:v1 .- 3ï¼Œdocker build -t Redis:v2 -f /path/Dockerfile /pathä¸€èˆ¬å¸¸ç”¨ç¬¬2ç§æ–¹å¼æ„å»ºï¼Œæˆ‘ä»¬åœ¨æ„å»ºæ—¶éƒ½ä¼šåˆ‡æ¢åˆ°Dockerfileæ–‡ä»¶çš„ç›®å½•ä¸‹è¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®š-få‚æ•° è¿›å…¥å®¹å™¨ï¼ˆæœªå¿…ä¸€å®šæ˜¯bashå‘½ä»¤ï¼‰ docker exec -it å®¹å™¨å bash æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ docker inspect å®¹å™¨å æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿— docker logs å®¹å™¨å æŸ¥çœ‹æœ¬åœ°é•œåƒ docker images docker ç½‘ç»œ å‘½ä»¤ è¯´æ˜ docker network connect å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œã€‚ docker network create åˆ›å»ºæ–°çš„ Docker ç½‘ç»œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ Windows ä¸Šä¼šé‡‡ç”¨ NAT é©±åŠ¨ï¼Œåœ¨ Linux ä¸Šä¼šé‡‡ç”¨ Bridge é©±åŠ¨ã€‚å¯ä»¥ä½¿ç”¨ -d å‚æ•°æŒ‡å®šé©±åŠ¨ï¼ˆç½‘ç»œç±»å‹ï¼‰ã€‚ docker network disconnect æ–­å¼€å®¹å™¨çš„ç½‘ç»œã€‚ docker network inspect æä¾› Docker ç½‘ç»œçš„è¯¦ç»†é…ç½®ä¿¡æ¯ã€‚ docker network ls ç”¨äºåˆ—å‡ºè¿è¡Œåœ¨æœ¬åœ° Docker ä¸»æœºä¸Šçš„å…¨éƒ¨ç½‘ç»œã€‚ docker network prune åˆ é™¤ Docker ä¸»æœºä¸Šå…¨éƒ¨æœªä½¿ç”¨çš„ç½‘ç»œã€‚ docker network rm åˆ é™¤ Docker ä¸»æœºä¸ŠæŒ‡å®šç½‘ç»œã€‚ é•œåƒçš„ä¿å­˜ docker save ae513a47849c &gt; nginx-save.tarordocker save -o nginx-save.tar ae513a47849c é•œåƒçš„å¯¼å…¥ docker load &lt; nginx-save.tarordocker load -i nginx-save.tar å®¹å™¨çš„å¯¼å‡º docker export -o mysql-`date +%Y%m%d`.tar 220aee82cfea å®¹å™¨çš„å¯¼å…¥ docker import my_ubuntu_v3.tar runoob/ubuntu:v4 é•œåƒå’Œå®¹å™¨å¯¼å‡ºå’Œå¯¼å…¥çš„åŒºåˆ«: 1.é•œåƒå¯¼å…¥æ˜¯å¤åˆ¶çš„è¿‡ç¨‹2.å®¹å™¨å¯¼å…¥æ˜¯å°†å½“å‰å®¹å™¨å˜æˆä¸€ä¸ªæ–°çš„é•œåƒ save å’Œ exportåŒºåˆ«ï¼š save ä¿å­˜é•œåƒæ‰€æœ‰çš„ä¿¡æ¯-åŒ…å«å†å² export åªå¯¼å‡ºå½“å‰çš„ä¿¡æ¯","tags":["Docker"],"categories":["Docker"]},{"title":"sync.Map","path":"/2021/02/06/syncMap/","content":"sync.Map æ˜¯1.9ç‰ˆæœ¬æ‰åŠ å…¥çš„ï¼Œæ˜¯çº¿ç¨‹å¹¶å‘å®‰å…¨çš„mapï¼Œç±»å‹å¯ä»¥çœ‹åšmap[interface{}]interface{}ã€‚ ç»“æ„Maptype Map struct &#123; mu Mutex //äº’æ–¥é”ï¼Œç”¨äºé”å®šdirty map read atomic.Value //ä¼˜å…ˆè¯»map,æ”¯æŒåŸå­æ“ä½œï¼Œæºç æ³¨é‡Šå†™äº†readOnlyä¸æ˜¯è¯´readæ˜¯åªè¯»ï¼Œè€Œæ˜¯å®ƒçš„ç»“æ„ä½“æ˜¯readOnly dirty map[interface&#123;&#125;]*entry // dirtyæ˜¯ä¸€ä¸ªå½“å‰æœ€æ–°çš„mapï¼Œå…è®¸è¯»å†™ misses int // ä¸»è¦è®°å½•readè¯»å–ä¸åˆ°æ•°æ®åŠ é”è¯»å–read mapä»¥åŠdirty mapçš„æ¬¡æ•°ï¼Œå½“missesç­‰äºdirtyçš„é•¿åº¦æ—¶ï¼Œä¼šå°†dirtyå¤åˆ¶åˆ°read&#125; readOnly type readOnly struct &#123; m map[interface&#123;&#125;]*entry amended bool // å¦‚æœæ•°æ®åœ¨dirtyä¸­ä½†æ²¡æœ‰åœ¨readä¸­ï¼Œè¯¥å€¼ä¸ºtrue,ä½œä¸ºä¿®æ”¹æ ‡è¯†&#125; entrytype entry struct &#123; // nil: è¡¨ç¤ºä¸ºè¢«åˆ é™¤ï¼Œè°ƒç”¨Delete()å¯ä»¥å°†read mapä¸­çš„å…ƒç´ ç½®ä¸ºnil // expunged: ä¹Ÿæ˜¯è¡¨ç¤ºè¢«åˆ é™¤ï¼Œä½†æ˜¯è¯¥é”®åªåœ¨readè€Œæ²¡æœ‰åœ¨dirtyä¸­ï¼Œè¿™ç§æƒ…å†µå‡ºç°åœ¨å°†readå¤åˆ¶åˆ°dirtyä¸­ï¼Œå³å¤åˆ¶çš„è¿‡ç¨‹ä¼šå…ˆå°†nilæ ‡è®°ä¸ºexpungedï¼Œç„¶åä¸å°†å…¶å¤åˆ¶åˆ°dirty // å…¶ä»–: è¡¨ç¤ºå­˜ç€çœŸæ­£çš„æ•°æ® p unsafe.Pointer // *interface&#123;&#125;&#125; Load æŸ¥æ‰¾æ ¹æ®keyæ¥æŸ¥æ‰¾ valueï¼Œ å‡½æ•°ä¸º Load()ï¼Œæºç å¦‚ä¸‹ï¼š func (m *Map) Load(key interface&#123;&#125;) (value interface&#123;&#125;, ok bool) &#123; // é¦–å…ˆä»åªè¯»readyçš„mapä¸­æŸ¥æ‰¾ï¼Œè¿™æ—¶ä¸éœ€è¦åŠ é” read, _ := m.read.Load().(readOnly) e, ok := read.m[key] // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå¹¶ä¸”read.amendedä¸ºtrueï¼Œè¯´æ˜dirtyä¸­æœ‰æ–°æ•°æ®ï¼Œä»dirtyä¸­æŸ¥æ‰¾ï¼Œå¼€å§‹åŠ é”äº† if !ok &amp;&amp; read.amended &#123; m.mu.Lock() // åŠ é” // åˆåœ¨ readonly ä¸­æ£€æŸ¥ä¸€éï¼Œå› ä¸ºåœ¨åŠ é”çš„æ—¶å€™ dirty çš„æ•°æ®å¯èƒ½å·²ç»è¿ç§»åˆ°äº†readä¸­ read, _ = m.read.Load().(readOnly) e, ok = read.m[key] // read è¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå¹¶ä¸”dirtyä¸­æœ‰æ•°æ® if !ok &amp;&amp; read.amended &#123; e, ok = m.dirty[key] //ä» dirty ä¸­æŸ¥æ‰¾æ•°æ® // ä¸ç®¡m.dirtyä¸­å­˜ä¸å­˜åœ¨ï¼Œéƒ½å°†misses + 1 // missLocked() ä¸­æ»¡è¶³æ¡ä»¶åå°±ä¼šæŠŠm.dirtyä¸­æ•°æ®è¿ç§»åˆ°m.readä¸­ m.missLocked() &#125; m.mu.Unlock() &#125; if !ok &#123; return nil, false &#125; return e.load()&#125; ä»å‡½æ•°å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæŸ¥è¯¢çš„é”®å€¼æ­£å¥½åœ¨m.readä¸­ï¼Œä¸éœ€è¦åŠ é”ï¼Œç›´æ¥è¿”å›ç»“æœï¼Œä¼˜åŒ–äº†æ€§èƒ½ã€‚ å³ä½¿ä¸åœ¨readä¸­ï¼Œç»è¿‡å‡ æ¬¡missåï¼Œ m.dirtyä¸­çš„æ•°æ®ä¹Ÿä¼šè¿ç§»åˆ°m.readä¸­ï¼Œè¿™æ—¶åˆå¯ä»¥ä»readä¸­æŸ¥æ‰¾ã€‚æ‰€ä»¥å¯¹äºæ›´æ–°ï¼å¢åŠ è¾ƒå°‘ï¼ŒåŠ è½½å­˜åœ¨çš„keyå¾ˆå¤šçš„caseï¼Œæ€§èƒ½åŸºæœ¬å’Œæ— é”çš„mapç±»ä¼¼ã€‚ missLockerd è¿ç§»æ•°æ®func (m *Map) missLocked() &#123; m.misses++ if m.misses &lt; len(m.dirty) &#123;//missesæ¬¡æ•°å°äº dirtyçš„é•¿åº¦ï¼Œå°±ä¸è¿ç§»æ•°æ®ï¼Œç›´æ¥è¿”å› return &#125; m.read.Store(readOnly&#123;m: m.dirty&#125;) //å¼€å§‹è¿ç§»æ•°æ® m.dirty = nil //è¿ç§»å®Œdirtyå°±èµ‹å€¼ä¸ºnil m.misses = 0 //è¿ç§»å®Œ misseså½’0&#125; Store å­˜å‚¨func (m *Map) Store(key, value interface&#123;&#125;) &#123; // ç›´æ¥åœ¨readä¸­æŸ¥æ‰¾å€¼ï¼Œæ‰¾åˆ°äº†ï¼Œå°±å°è¯• tryStore() æ›´æ–°å€¼ read, _ := m.read.Load().(readOnly) if e, ok := read.m[key]; ok &amp;&amp; e.tryStore(&amp;value) &#123; return &#125; // m.read ä¸­ä¸å­˜åœ¨ m.mu.Lock() read, _ = m.read.Load().(readOnly) if e, ok := read.m[key]; ok &#123; if e.unexpungeLocked() &#123; // æœªè¢«æ ‡è®°æˆåˆ é™¤ï¼Œå‰é¢è®²åˆ°entryæ•°æ®ç»“æ„æ—¶ï¼Œé‡Œé¢çš„på€¼æœ‰3ç§ã€‚1.nil 2.expungedï¼Œè¿™ä¸ªå€¼å«ä¹‰æœ‰ç‚¹å¤æ‚ï¼Œå¯ä»¥çœ‹çœ‹å‰é¢entryæ•°æ®ç»“æ„ 3.æ­£å¸¸å€¼ m.dirty[key] = e // åŠ å…¥åˆ°dirtyé‡Œ &#125; e.storeLocked(&amp;value) // æ›´æ–°å€¼ &#125; else if e, ok := m.dirty[key]; ok &#123; // å­˜åœ¨äº dirty ä¸­ï¼Œç›´æ¥æ›´æ–° e.storeLocked(&amp;value) &#125; else &#123; // æ–°çš„å€¼ if !read.amended &#123; // m.dirty ä¸­æ²¡æœ‰æ–°æ•°æ®ï¼Œå¢åŠ åˆ° m.dirty ä¸­ m.dirtyLocked() // ä» m.readä¸­å¤åˆ¶æœªåˆ é™¤çš„æ•°æ® m.read.Store(readOnly&#123;m: read.m, amended: true&#125;) &#125; m.dirty[key] = newEntry(value) //å°†è¿™ä¸ªentryåŠ å…¥åˆ°m.dirtyä¸­ &#125; m.mu.Unlock()&#125; æ“ä½œéƒ½æ˜¯å…ˆä»m.readå¼€å§‹ï¼Œä¸æ»¡è¶³æ¡ä»¶å†åŠ é”ï¼Œç„¶åæ“ä½œm.dirtyã€‚ Delete åˆ é™¤func (m *Map) Delete(key interface&#123;&#125;) &#123; // ä» m.read ä¸­å¼€å§‹æŸ¥æ‰¾ read, _ := m.read.Load().(readOnly) e, ok := read.m[key] if !ok &amp;&amp; read.amended &#123; // m.readä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œå¹¶ä¸”å¯èƒ½å­˜åœ¨äºm.dirtyä¸­ï¼ŒåŠ é”æŸ¥æ‰¾ m.mu.Lock() // åŠ é” read, _ = m.read.Load().(readOnly) // å†åœ¨m.readä¸­æŸ¥æ‰¾ä¸€æ¬¡ e, ok = read.m[key] if !ok &amp;&amp; read.amended &#123; //m.readä¸­åˆæ²¡æ‰¾åˆ°ï¼Œamendedæ ‡å¿—ä½trueï¼Œè¯´æ˜åœ¨m.dirtyä¸­ delete(m.dirty, key) // åˆ é™¤ &#125; m.mu.Unlock() &#125; if ok &#123; // åœ¨ m.ready ä¸­å°±ç›´æ¥åˆ é™¤ e.delete() &#125;&#125; ä½¿ç”¨package mainimport (\t&quot;fmt&quot;\t&quot;sync&quot;)func main() &#123;\tvar sm sync.Map\tsm.Store(&quot;www&quot;, &quot;2343125&quot;)\tsm.Store(&quot;test&quot;, 111)\tvar v interface&#123;&#125;\tv, _ = sm.Load(&quot;www&quot;)\tfmt.Printf(&quot;%T&quot;, v)\tsm.Delete(&quot;test&quot;)\tv, _ = sm.Load(&quot;test&quot;)\tfmt.Printf(&quot;%T&quot;, v)&#125;// string&lt;nil&gt; å‚è€ƒ sync.Mapæºç  sync.Mapæºç åˆ†æ æ·±å…¥ç†è§£Goè¯­è¨€(05)ï¼šsync.mapåŸç†åˆ†æ","tags":["gosourcecode"],"categories":["gosourcecode"]},{"title":"sync.Once","path":"/2021/02/06/syncOnce/","content":"sync.Onceçš„æºç ååˆ†ç®€å•ï¼Œè€Œä¸”æ³¨é‡Šååˆ†æ¸…æ¥šï¼Œç›´æ¥æ¥çœ‹ä¸€ä¸‹ã€‚ æºç å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“Once type Once struct &#123;\tdone uint32 // æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œåˆå§‹å€¼ä¸º0\tm Mutex // é”&#125; å¯¹å¤–æä¾›äº†ä¸€ä¸ªæ–¹æ³•Doï¼ŒOnce.Doå¯ä»¥ç†è§£æˆèµ„æºåˆå§‹åŒ–ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ func (o *Once) Do(f func()) &#123; // è¿™é‡Œä¿è¯åŸå­æ€§çš„è¯»å–o.doneï¼Œå¦‚æœæœªæ‰§è¡Œ0ï¼Œè°ƒç”¨doSlow\tif atomic.LoadUint32(&amp;o.done) == 0 &#123; // Outlined slow-path to allow inlining of the fast-path. o.doSlow(f)\t&#125;&#125;func (o *Once) doSlow(f func()) &#123;\to.m.Lock() // é”ä½\tdefer o.m.Unlock() // æœ€åé‡Šæ”¾é” // å¦‚æœæœªæ‰§è¡Œè¿‡fï¼Œå°±æ‰§è¡Œfï¼Œå¹¶ä¿®æ”¹o.doneä¸º1 // è¿™é‡Œå·²ç»åŠ é”äº†ï¼Œä¿è¯äº†åŸå­æ€§ï¼Œä¸éœ€è¦ä½¿ç”¨atomic.LoadUint32\tif o.done == 0 &#123; defer atomic.StoreUint32(&amp;o.done, 1) f()\t&#125;&#125; å¦‚æœä½ ç†Ÿæ‚‰atomicï¼Œè¿™é‡Œä½ å¯èƒ½ä¼šæœ‰ä¸ªç–‘é—®ï¼ŒDoæ–¹æ³•é‡Œé¢ä¸ºä½•ä¸ç›´æ¥ä½¿ç”¨casåŸå­æ“ä½œå‘¢ï¼Œé‚£å¤šç®€æ´ï¼Ÿ if atomic.CompareAndSwapUint32(&amp;o.done, 0, 1) &#123;\tf()&#125; å…¶å®æºç æ³¨é‡Šé‡Œå·²ç»æœ‰äº†è¯´æ˜ï¼Œè¿™æ ·çš„å®ç°å¹¶ä¸åˆç†ã€‚ å½“ä½ æœ‰2ä¸ªå¹¶å‘è¯·æ±‚è°ƒç”¨Doï¼Œè¿™æ ·çš„å®ç°ç¡®å®èƒ½ä¿è¯åªä¼šè°ƒç”¨ä¸€æ¬¡fã€‚ä½†æ˜¯ï¼Œå‡å¦‚fçš„æ‰§è¡Œéœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ¯”å¦‚åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ï¼Œå½“fæ‰§è¡Œå°šæœªå®Œæˆï¼Œå¹¶å‘ä¸­å¦ä¸€ä¸ªè¯·æ±‚å› ä¸ºæ²¡æœ‰æ‰§è¡ŒåŸå­æ“ä½œç›´æ¥è¿”å›äº†ï¼Œä½¿ç”¨fä¸­åˆå§‹åŒ–çš„è¿æ¥æ± å°±å¿…ç„¶ä¼šå¤±è´¥ï¼Œé‚£ä¹ˆè¿™æ ·çš„å®ç°æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ã€‚ æ‰€ä»¥å¿…é¡»ç¡®ä¿fæ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰èƒ½å°†doneç½®ä¸º1ã€‚ ä½¿ç”¨var one sync.Oncefun1 := func() &#123;\tfmt.Println(&quot;do one&quot;)&#125;fun2 := func() &#123;\tfmt.Println(&quot;do two&quot;)&#125;one.Do(fun1)one.Do(fun2)output:do one å¯ä»¥çœ‹åˆ°åªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯fun1ã€‚ å…¶å®onceå¾ˆé€‚åˆåº”ç”¨åˆ°å•ä¾‹æ¨¡å¼ï¼Œæ¯”å¦‚è¿æ¥æ•°æ®åº“ï¼Œ package dbimport (\t&quot;github.com/jinzhu/gorm&quot;\t_ &quot;github.com/jinzhu/gorm/dialects/mysql&quot;\t&quot;github.com/spf13/viper&quot;)var once sync.Oncevar db *gorm.DB// å•ä¾‹æ¨¡å¼è·å–*gorm.DBfunc GetDB() *gorm.DB &#123;\tonce.Do(func() &#123; db = openPool()\t&#125;)\treturn db&#125;func openPool() *gorm.DB &#123;\t...&#125; å¥½äº†ï¼ŒOnceæ˜¯å¾ˆå¸¸ç”¨çš„ï¼Œä¹Ÿå¾ˆé€‚åˆå•ä¾‹æ¨¡å¼ä½¿ç”¨ï¼Œæºç ç®€å•æ˜äº†ï¼Œä»¥ååœ¨é¡¹ç›®ä¸­å¤šå¤šä½¿ç”¨å§ï¼","tags":["gosourcecode"],"categories":["gosourcecode"]},{"title":"vueå­ç»„ä»¶","path":"/2021/01/26/305/","content":"å…ˆæ¥çœ‹demo: çˆ¶ç»„ä»¶ï¼š &lt;template&gt; &lt;div class=&quot;app-container calendar-list-container&quot;&gt; &lt;el-tabs v-model=&quot;activeName&quot; type=&quot;card&quot;&gt; &lt;el-tab-pane label=&quot;å¾…å®¡æ ¸&quot; name=&quot;first&quot;&gt; &lt;test-page status=&quot;1&quot; @toP=&quot;funct&quot;&gt;&lt;/test-page&gt; &lt;/el-tab-pane&gt; &lt;el-tab-pane label=&quot;å…¨éƒ¨&quot; name=&quot;second&quot;&gt; &lt;test-page status=&quot;0&quot;&gt;&lt;/test-page&gt; &lt;/el-tab-pane&gt; &lt;/el-tabs&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import TestPage from &#x27;@/views/components/TestPage&#x27;export default &#123; components: &#123; TestPage &#125;, name: &quot;test&quot;, data() &#123; return &#123; activeName: &#x27;first&#x27;, &#125;; &#125;, methods: &#123; funct(v) &#123; console.warn(v) &#125; &#125;&#125;;&lt;/script&gt; å­ç»„ä»¶ &lt;template&gt; &lt;div&gt; &lt;el-table key=&quot;tableList&quot; v-loading=&quot;listLoading&quot; :data=&quot;list&quot; element-loading-text=&quot;ç»™æˆ‘ä¸€ç‚¹æ—¶é—´&quot; border fit highlight-current-row style=&quot;width: 100%&quot; &gt; &lt;el-table-column align=&quot;center&quot; label=&quot;id&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;span&gt;&#123;&#123; scope.row.id &#125;&#125;&lt;/span&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;åœ°ç‚¹&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;span&gt;&#123;&#123; scope.row.address &#125;&#125;&lt;/span&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;çŠ¶æ€&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;el-tag type=&quot;info&quot; v-if=&quot;scope.row.status == 0&quot;&gt;å·²æ‹’ç»&lt;/el-tag&gt; &lt;el-tag v-if=&quot;scope.row.status == 1&quot;&gt;å®¡æ ¸ä¸­&lt;/el-tag&gt; &lt;el-tag type=&quot;success&quot; v-if=&quot;scope.row.status == 2&quot;&gt;å·²é€šè¿‡&lt;/el-tag&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;æ´»åŠ¨æ—¶é—´&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;span&gt;&#123;&#123; scope.row.start_date &#125;&#125;&lt;/span&gt;&lt;br&gt;è‡³ &lt;span&gt;&#123;&#123; scope.row.end_date &#125;&#125;&lt;/span&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;/el-table&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;...export default &#123; name: &quot;TestPage&quot;, props: [&#x27;status&#x27;], data() &#123; return &#123; list: [], pagination: &quot;&quot;, listQuery: &#123; page: 1, limit: 20, status: 1, type:&#x27;&#x27;, &#125;, typeList: [], dialogFormVisible: false, temp: &#123; image : &#x27;&#x27;, user: &#123; nickname: &#x27;&#x27;, &#125;, college: &#123; name: &quot;&quot;, &#125;, materials: [], &#125;, &#125;; &#125;, created() &#123; this.listQuery.status = this.$props.status; this.getList(); this.$emit(&#x27;toP&#x27;, this.listQuery) &#125;, methods: &#123; ... &#125;&#125;;&lt;/script&gt;&lt;style&gt;.row-container .el-row &#123; margin-bottom: 20px; &amp;:last-child &#123; margin-bottom: 0; &#125; &#125;&lt;/style&gt; è¿™ä¸ªdemoç®€å•ä½¿ç”¨äº†ç»„ä»¶å¼•å…¥ï¼ŒåŠå­ç»„ä»¶äºçˆ¶ç»„ä»¶é€šä¿¡ã€‚ å¼•å…¥å­ç»„ä»¶import TestPage from &#x27;@/views/components/TestPage&#x27;export default &#123; components: &#123; TestPage &#125;, ä½¿ç”¨: &lt;test-page&gt;&lt;/test-page&gt; çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®åˆ°å­ç»„ä»¶çˆ¶ç»„ä»¶çš„statuså°±æ˜¯ä¼ é€’çš„æ•°æ® &lt;test-page status=&quot;0&quot;&gt;&lt;/test-page&gt; å­ç»„ä»¶æ¥æ”¶ï¼š this.$props.status å­ç»„ä»¶ä¼ é€’æ•°æ®åˆ°çˆ¶ç»„ä»¶å­ç»„ä»¶ï¼Œå…¶å®æ˜¯ä¼ é€’äº†ä¸€ä¸ªtoPäº‹ä»¶ this.$emit(&#x27;toP&#x27;, this.listQuery) çˆ¶ç»„ä»¶ &lt;test-page @toP=&quot;funct&quot;&gt;&lt;/test-page&gt;...methods: &#123; funct(v) &#123; console.warn(v) &#125;&#125; è¿™é‡Œéœ€è¦ç¨å¾®æ³¨æ„çš„å°±æ˜¯é©¼å³°å‘½åè½¬**-**ï¼Œä½¿ç”¨ç›¸å¯¹ç®€å•ã€‚","tags":["vue"],"categories":["js"]},{"title":"ç½‘ç«™ä¸èƒ½è®¿é—®çš„é—®é¢˜é›†åˆ","path":"/2021/01/13/302/","content":"httpsè®¿é—®ä¸äº†ç°è±¡httpsè®¿é—®ä¸äº†ï¼Œç»‘å®šhostå¯è®¿é—®ï¼Œç½‘ç«™æ— æŠ¥é”™ æ’æŸ¥pingåŸŸåå¯¹äºipä¹Ÿæ­£å¸¸ï¼Œtelnet 443ç«¯å£å¤±è´¥ å¤„ç†å¼€å¯443ç«¯å£ åŠ äº†CDNçš„éƒ¨åˆ†é¡µé¢çªç„¶æ‰“ä¸å¼€ç°è±¡åŠ äº†cdnçš„éƒ¨åˆ†é¡µé¢æ‰“ä¸å¼€ï¼Œhttpé¡µé¢è®¿é—®æ­£å¸¸ï¼Œç»‘å®šhostè®¿é—®ä¹Ÿæ­£å¸¸ æ‰“ä¸å¼€çš„æƒ…å†µnginxæœ‰æŠ¥é”™å¦‚ï¼š pwritev() â€œ/usr/local/webserver/nginx_new/fastcgi_temp/1/96/0001214961â€ failed (28: No space left on device) while reading upstream, client: 61.241.120.188, server:www.puresai.com, request: â€œGET / HTTP/1.1â€, upstream: â€œfastcgi://127.0.0.1:9000â€, host: â€œwww.puresai.com&quot;ï¼Œååˆåé¦ˆåå°æ–‡ä»¶ä¸Šä¼ å¤±è´¥ æ’æŸ¥å»æ‰cdnèƒ½æ­£å¸¸è®¿é—®ï¼ŒæŒ‚è½½ç£ç›˜æœªæ»¡ï¼Œç³»ç»Ÿç›˜æ»¡ï¼Œä¹ä¸€çœ‹æ˜¯cdnå’Œwafé—®é¢˜ å¤„ç†ç³»ç»Ÿç›˜100%ï¼Œæ³¨æ„No space left on deviceï¼ŒæŒªåŠ¨å¤§æ–‡ä»¶åˆ°æŒ‚è½½çš„ç£ç›˜ï¼Œcdné¡µé¢ä¹Ÿæ¢å¤æ­£å¸¸ å»ºè®®ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œä¸‹è½½å¤§æ–‡ä»¶å°½é‡åˆ«æ”¾åœ¨ç³»ç»Ÿç›˜","tags":["web"],"categories":["web"]},{"title":"goæºç ä¹‹context","path":"/2021/01/06/context/","content":"å®šä¹‰è¯´æ˜ Package context defines the Context type, which carries deadlines, cancelation signals, and other request-scoped values across API boundaries and between processes.Incoming requests to a server should create a Context, and outgoing calls to servers should accept a Context. The chain of function calls between them must propagate the Context, optionally replacing it with a derived Context created using WithCancel, WithDeadline, WithTimeout, or WithValue. When a Context is canceled, all Contexts derived from it are also canceled. ç²—ç•¥ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼š contextå®šä¹‰äº†ä¸Šä¸‹æ–‡ç±»å‹ï¼Œå®ƒæºå¸¦è·¨è¶ŠAPIè¾¹ç•Œå’Œè¿›ç¨‹ä¹‹é—´çš„deadlinesã€å–æ¶ˆä¿¡å·å’Œå…¶ä»–è¯·æ±‚èŒƒå›´çš„å€¼ã€‚å¯¹æœåŠ¡å™¨çš„ä¼ å…¥è¯·æ±‚åº”è¯¥åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œå¯¹æœåŠ¡å™¨çš„ä¼ å‡ºè°ƒç”¨åº”è¯¥æ¥å—ä¸Šä¸‹æ–‡ã€‚å®ƒä»¬ä¹‹é—´çš„å‡½æ•°è°ƒç”¨é“¾å¿…é¡»ä¼ æ’­ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€‰æ‹©ç”¨ä½¿ç”¨WithCancelã€WithDeadlineã€WithTimeoutæˆ–WithValueåˆ›å»ºçš„æ´¾ç”Ÿä¸Šä¸‹æ–‡æ›¿æ¢å®ƒã€‚å½“ä¸€ä¸ªä¸Šä¸‹æ–‡è¢«å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰ä»å®ƒæ´¾ç”Ÿçš„ä¸Šä¸‹æ–‡ä¹Ÿè¢«å–æ¶ˆã€‚ æºç ç»“æ„ åç§° ç±»å‹ è¯´æ˜ Context interface å®šä¹‰äº† Context æ¥å£çš„å››ä¸ªæ–¹æ³•Deadlineã€Doneã€Errã€Value emptyCtx int æ³¨æ„ï¼šemptyCtxæ°¸è¿œä¸ä¼šå–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ç±»å‹ç­‰ä»·å®šä¹‰ï¼ŒemptyCtxç­‰ä»·äºintç±»å‹ã€‚å¹¶ä¸”å®šä¹‰ä¸Šé¢çš„å››ä¸ªæ–¹æ³•å’ŒStringæ–¹æ³•ã€‚ Background func è¿”å›new(emptyCtx) TODO func è¿”å›new(emptyCtx) CancelFunc func CancelFuncå‘Šè¯‰æ“ä½œæ”¾å¼ƒå…¶å·¥ä½œï¼Œä¸ç­‰å¾…å·¥ä½œåœæ­¢ã€‚å¤šä¸ªgoroutineå¯ä»¥åŒæ—¶è°ƒç”¨CancelFuncã€‚åœ¨ç¬¬ä¸€ä¸ªè°ƒç”¨ä¹‹åï¼Œå¯¹CancelFuncçš„åç»­è°ƒç”¨å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ WithCancel func WithCancelè¿”å›ä¸€ä¸ªå¸¦æœ‰æ–°çš„Doneé€šé“çš„parentå‰¯æœ¬ã€‚å½“è¿”å›çš„cancelå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¸Šä¸‹æ–‡çš„Doneé€šé“è¢«å…³é—­æˆ–è€…å½“çˆ¶ä¸Šä¸‹æ–‡çš„Doneé€šé“å…³é—­æ—¶ï¼Œæ— è®ºå“ªä¸ªå…ˆå‘ç”Ÿã€‚å–æ¶ˆæ­¤ä¸Šä¸‹æ–‡å°†é‡Šæ”¾ä¸ä¹‹ç›¸å…³çš„èµ„æºï¼Œä»£ç ä¹Ÿåº”è¯¥å¦‚æ­¤åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„æ“ä½œä¸€å®Œæˆï¼Œå°±è°ƒç”¨cancelã€‚ newCancelCtx func è¿”å›ä¸€ä¸ªåˆå§‹åŒ–çš„cancelCtx propagateCancel func propagateCancelåœ¨çˆ¶å…ƒç´ è¢«å–æ¶ˆæ—¶å–æ¶ˆå­å…ƒç´ ï¼Œè¿™é‡Œæœ‰ç”¨åˆ°åŸå­é” parentCancelCtx func æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯å–æ¶ˆçš„çˆ¶èŠ‚ç‚¹ removeChild func ç§»é™¤çˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ canceler interface å–æ¶ˆè€…ï¼Œå®šä¹‰äº†cancelå’ŒDoneä¸¤ä¸ªæ–¹æ³• init func åˆå§‹åŒ–æ–¹æ³• cancelCtx struct ä¸€ä¸ªå¯ä»¥å–æ¶ˆçš„ Context contextName func è¿”å›ä¸Šä¸‹æ–‡åç§° WithDeadline func åˆ›å»ºä¸€ä¸ªæœ‰ deadline çš„ context timerCtx struct timerCtxå¸¦æœ‰timeout å’Œdeadline ã€‚å®ƒå°†cancelCtxåµŒå…¥åˆ°å®ç°Doneå’ŒErrã€‚å®ƒé€šè¿‡åœæ­¢è®¡æ—¶å™¨æ¥å®ç°å–æ¶ˆï¼Œç„¶åå§”æ‰˜ç»™cancelCtx.cancelã€‚ WithTimeout func åˆ›å»ºä¸€ä¸ªæœ‰ timeout çš„ context WithValue func åˆ›å»ºä¸€ä¸ªå­˜å‚¨ k-v å¯¹çš„ context valueCtx struct å­˜å‚¨k-vï¼Œé…åˆWithValueä½¿ç”¨ stringify func æ¥å£ç±»å‹è¿”å›å­—ç¬¦ä¸² Contexttype Context interface &#123;\t// è·å–è®¾ç½®çš„æˆªæ­¢æ—¶é—´çš„æ„æ€ï¼Œç¬¬ä¸€ä¸ªè¿”å›å¼æ˜¯æˆªæ­¢æ—¶é—´ï¼Œåˆ°äº†è¿™ä¸ªæ—¶é—´ç‚¹ï¼ŒContextä¼šè‡ªåŠ¨å‘èµ·å–æ¶ˆè¯·æ±‚ï¼›ç¬¬äºŒä¸ªè¿”å›å€¼ok==falseæ—¶è¡¨ç¤ºæ²¡æœ‰è®¾ç½®æˆªæ­¢æ—¶é—´ï¼Œå¦‚æœéœ€è¦å–æ¶ˆçš„è¯ï¼Œéœ€è¦è°ƒç”¨å–æ¶ˆå‡½æ•°è¿›è¡Œå–æ¶ˆ\tDeadline() (deadline time.Time, ok bool)\t// è¿”å›ä¸€ä¸ªåªè¯»çš„chanï¼Œç±»å‹ä¸ºstruct&#123;&#125;ï¼Œæˆ‘ä»¬åœ¨goroutineä¸­ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›çš„chanå¯ä»¥è¯»å–ï¼Œåˆ™æ„å‘³ç€parent contextå·²ç»å‘èµ·äº†å–æ¶ˆè¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡Doneæ–¹æ³•æ”¶åˆ°è¿™ä¸ªä¿¡å·åï¼Œå°±åº”è¯¥åšæ¸…ç†æ“ä½œï¼Œç„¶åé€€å‡ºgoroutineï¼Œé‡Šæ”¾èµ„æºã€‚\tDone() &lt;-chan struct&#123;&#125;\t// åœ¨ channel Done å…³é—­åï¼Œè¿”å› context å–æ¶ˆåŸå› \tErr() error\t// è·å–è¯¥Contextä¸Šç»‘å®šçš„å€¼ï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥è¦é€šè¿‡ä¸€ä¸ªKeyæ‰å¯ä»¥è·å–å¯¹åº”çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬æ˜¯å¹¶å‘å®‰å…¨çš„\tValue(key interface&#123;&#125;) interface&#123;&#125;&#125; cancelertype canceler interface &#123;\tcancel(removeFromParent bool, err error)\tDone() &lt;-chan struct&#123;&#125;&#125; å®ç°äº†ä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªæ–¹æ³•çš„ Contextï¼Œå°±è¡¨æ˜è¯¥ Context æ˜¯å¯å–æ¶ˆçš„ã€‚æºç ä¸­æœ‰ä¸¤ä¸ªç±»å‹å®ç°äº† canceler æ¥å£ï¼š*cancelCtx å’Œ *timerCtxã€‚æ³¨æ„æ˜¯åŠ äº† * å·çš„ï¼Œæ˜¯è¿™ä¸¤ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆå®ç°äº† canceler æ¥å£ã€‚ æ¥å£è®¾è®¡æˆè¿™ä¸ªæ ·å­çš„åŸå› ï¼š â€œå–æ¶ˆâ€æ“ä½œåº”è¯¥æ˜¯å»ºè®®æ€§ï¼Œè€Œéå¼ºåˆ¶æ€§ â€œå–æ¶ˆâ€æ“ä½œåº”è¯¥å¯ä¼ é€’ emptyCtxtype emptyCtx intfunc (*emptyCtx) Deadline() (deadline time.Time, ok bool) &#123;\treturn&#125;func (*emptyCtx) Done() &lt;-chan struct&#123;&#125; &#123;\treturn nil&#125;func (*emptyCtx) Err() error &#123;\treturn nil&#125;func (*emptyCtx) Value(key interface&#123;&#125;) interface&#123;&#125; &#123;\treturn nil&#125;func (e *emptyCtx) String() string &#123;\tswitch e &#123;\tcase background: return &quot;context.Background&quot;\tcase todo: return &quot;context.TODO&quot;\t&#125;\treturn &quot;unknown empty Context&quot;&#125;// cancelCtxtype cancelCtx struct &#123;\tContext\tmu sync.Mutex // äº’æ–¥é”\tdone chan struct&#123;&#125; children map[canceler]struct&#123;&#125; err error &#125; æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹ cancel è¿™ä¸ªæ–¹æ³• func (c *cancelCtx) cancel(removeFromParent bool, err error) &#123;\tif err == nil &#123; panic(&quot;context: internal error: missing cancel error&quot;)\t&#125;\tc.mu.Lock()\tif c.err != nil &#123; c.mu.Unlock() return // å·²ç»è¢«å…¶ä»–åç¨‹å–æ¶ˆ\t&#125;\t// ç»™ err å­—æ®µèµ‹å€¼\tc.err = err\t// å…³é—­ channelï¼Œé€šçŸ¥å…¶ä»–åç¨‹\tif c.done == nil &#123; c.done = closedchan\t&#125; else &#123; close(c.done)\t&#125; // éå†å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹\tfor child := range c.children &#123; // é€’å½’åœ°å–æ¶ˆæ‰€æœ‰å­èŠ‚ç‚¹ child.cancel(false, err)\t&#125;\t// å°†å­èŠ‚ç‚¹ç½®ç©º\tc.children = nil\tc.mu.Unlock()\tif removeFromParent &#123; // ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤è‡ªå·± removeChild(c.Context, c)\t&#125;&#125; cancel()æ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯å…³é—­ channelï¼šc.doneï¼›é€’å½’åœ°å–æ¶ˆå®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼›ä»çˆ¶èŠ‚ç‚¹ä»åˆ é™¤è‡ªå·±ã€‚è¾¾åˆ°çš„æ•ˆæœæ˜¯é€šè¿‡å…³é—­ channelï¼Œå°†å–æ¶ˆä¿¡å·ä¼ é€’ç»™äº†å®ƒçš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚ func WithCancel(parent Context) (ctx Context, cancel CancelFunc)func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc)func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)func WithValue(parent Context, key, val interface&#123;&#125;) Context ä¸Šé¢å››ä¸ªå¯ä»¥ç†è§£ä¸ºContextçš„ç»§æ‰¿è¡ç”Ÿã€‚å¯¹äºæˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨æ¥è¯´ï¼Œå­¦ä¼šContextçš„ç»§æ‰¿çš„4ä¸ªæ–¹æ³•å’ŒBackgroundã€TODOåŸºæœ¬å°±å¤Ÿäº†ã€‚ Contextä½¿ç”¨åœºæ™¯ è¶…æ—¶è¯·æ±‚ package mainimport ( &quot;context&quot; &quot;fmt&quot; &quot;time&quot;)func main() &#123; ctx, cancel := context.WithTimeout(context.Background(), 50*time.Millisecond) defer cancel() select &#123; case &lt;-time.After(1 * time.Second): fmt.Println(&quot;overslept&quot;) case &lt;-ctx.Done(): fmt.Println(ctx.Err()) // prints &quot;context deadline exceeded&quot; &#125;&#125; å…±äº«æ•°æ® package mainimport (\t&quot;context&quot;\t&quot;fmt&quot;)func main() &#123;\tctx := context.Background()\tprocess(ctx)\tctx = context.WithValue(ctx, &quot;traceId&quot;, &quot;qcrao-2019&quot;)\tprocess(ctx)&#125;func process(ctx context.Context) &#123;\ttraceId, ok := ctx.Value(&quot;traceId&quot;).(string)\tif ok &#123; fmt.Printf(&quot;process over. trace_id=%s &quot;, traceId)\t&#125; else &#123; fmt.Printf(&quot;process over. no trace_id &quot;)\t&#125;&#125; è¿™ä¸ªåœ¨webå¼€å‘ä¸­å¾ˆå®ç”¨ï¼Œä¼ é€’sessionã€tokenç­‰ä¿¡æ¯ã€‚ é˜²æ­¢ goroutine æ³„æ¼package mainimport (\t&quot;time&quot;\t&quot;fmt&quot;)func gen() &lt;-chan int &#123;\tch := make(chan int)\tgo func() &#123; var n int for &#123; ch &lt;- n n++ time.Sleep(time.Second) &#125;\t&#125;()\treturn ch&#125;func main() &#123;\tfor n := range gen() &#123; fmt.Println(n) if n == 5 &#123; break &#125;\t&#125;&#125; å½“ n = 5 çš„æ—¶å€™ï¼Œç›´æ¥ break ã€‚ä½†æ˜¯ gen çš„åç¨‹å°±ä¼šæ‰§è¡Œæ— é™å¾ªç¯ï¼Œæ°¸è¿œä¸ä¼šåœä¸‹æ¥ã€‚å‘ç”Ÿäº† goroutine æ³„æ¼ã€‚ package mainimport (\t&quot;time&quot;\t&quot;fmt&quot;\t&quot;context&quot;)func gen(ctx context.Context) &lt;-chan int &#123;\tch := make(chan int)\tgo func() &#123; var n int for &#123; select &#123; case &lt;-ctx.Done(): return case ch &lt;- n: n++ time.Sleep(time.Second) &#125; &#125;\t&#125;()\treturn ch&#125;func main() &#123;\tctx, cancel := context.WithCancel(context.Background())\tdefer cancel() // é¿å…å…¶ä»–åœ°æ–¹å¿˜è®° cancelï¼Œä¸”é‡å¤è°ƒç”¨ä¸å½±å“\tfor n := range gen(ctx) &#123; fmt.Println(n) if n == 5 &#123; cancel() break &#125;\t&#125;&#125; Context ä½¿ç”¨åŸåˆ™æœ€åè®°ä½å‡ ä¸ªä¸»è¦çš„ä½¿ç”¨åŸåˆ™ï¼š ä¸è¦å°† Context å¡åˆ°ç»“æ„ä½“é‡Œã€‚ç›´æ¥å°† Context ç±»å‹ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€å‚æ•°ï¼Œè€Œä¸”ä¸€èˆ¬éƒ½å‘½åä¸º ctxã€‚ ä¸è¦å‘å‡½æ•°ä¼ å…¥ä¸€ä¸ª nil çš„ contextï¼Œå¦‚æœä½ å®åœ¨ä¸çŸ¥é“ä¼ ä»€ä¹ˆï¼Œæ ‡å‡†åº“ç»™ä½ å‡†å¤‡å¥½äº†ä¸€ä¸ª contextï¼štodoã€‚ ä¸è¦æŠŠæœ¬åº”è¯¥ä½œä¸ºå‡½æ•°å‚æ•°çš„ç±»å‹å¡åˆ° context ä¸­ï¼Œcontext å­˜å‚¨çš„åº”è¯¥æ˜¯ä¸€äº›å…±åŒçš„æ•°æ®ã€‚ä¾‹å¦‚ï¼šç™»é™†çš„ sessionã€cookie ç­‰ã€‚ åŒä¸€ä¸ª context å¯èƒ½ä¼šè¢«ä¼ é€’åˆ°å¤šä¸ª goroutineï¼Œåˆ«æ‹…å¿ƒï¼Œcontext æ˜¯å¹¶å‘å®‰å…¨çš„ã€‚ å‚è€ƒæ–‡ç« ï¼š æ·±åº¦è§£å¯†Goè¯­è¨€ä¹‹context Goè¯­è¨€å®æˆ˜ç¬”è®°ï¼ˆäºŒåï¼‰| Go Context","tags":["gosourcecode"],"categories":["gosourcecode"]},{"title":"x/rate/limit","path":"/2021/01/06/rate/","content":"é™æµæ˜¯ä¿è¯æœåŠ¡å¯ç”¨æ€§å’Œç¨³å®šçš„åˆ©å™¨ä¹‹ä¸€ã€‚goè‡ªå¸¦æœ‰é™æµå™¨rateï¼Œæˆ‘ä»¬æ¥ç ”è¯»ä¸€ä¸‹æºç ï¼Œæºç è¾ƒå°‘ï¼Œæˆ‘ä»¬åˆ—å‡ºä¸»è¦ä»£ç éƒ¨åˆ†ï¼Œæ³¨é‡Šè¯´æ˜ï¼š // é™å®šé€Ÿç‡type Limit float64// å¸¸é‡Infï¼šæ— é€Ÿç‡é™åˆ¶const Inf = Limit(math.MaxFloat64)// é™æµå™¨çš„ç»“æ„ä½“ï¼Œæœ¬è´¨å°±æ˜¯ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œtype Limiter struct &#123; mu sync.Mutex limit Limit burst int tokens float64 // è®°å½•ä¸Šæ¬¡ Limiter è¢«æ›´æ–°çš„æ—¶é—´ last time.Time // lastEvent è®°å½•é€Ÿç‡å—é™åˆ¶çš„æ—¶é—´ lastEvent time.Time&#125;// newä¸€ä¸ªæ–°çš„é™æµå™¨ *Limiterï¼Œræ˜¯é€Ÿç‡ï¼Œbæ˜¯å…è®¸çªå‘çš„ä»¤ç‰Œæ•°é‡func NewLimiter(r Limit, b int) *Limiter &#123; return &amp;Limiter&#123; limit: r, burst: b, &#125;&#125;// Reservation ä¿å­˜äº†é™æµå™¨å»¶è¿Ÿåå‘ç”Ÿçš„äº‹ä»¶ä¿¡æ¯type Reservation struct &#123; // æ˜¯å¦æ»¡è¶³æ¡ä»¶åˆ†é…äº†ä»¤ç‰Œå•Š ok bool // é™æµå™¨ lim *Limiter // ä»¤ç‰Œæ•°é‡ tokens int // æ»¡è¶³ä»¤ç‰Œå‘æ”¾çš„æ—¶é—´ timeToAct time.Time // ä»¤ç‰Œå‘æ”¾é€Ÿç‡ limit Limit&#125;// è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å†…éƒ¨å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªReservationfunc (lim *Limiter) reserveN(now time.Time, n int, maxFutureReserve time.Duration) Reservation &#123; // äº’æ–¥é”ï¼Œä¿è¯åŸå­æ€§ lim.mu.Lock() // åˆ¤æ–­é€Ÿç‡æ˜¯ä¸æ˜¯æœ€å¤§ï¼Œæ˜¯çš„è¯æ— éœ€é™æµ if lim.limit == Inf &#123; lim.mu.Unlock() return Reservation&#123; ok: true, lim: lim, tokens: n, timeToAct: now, &#125; &#125; // è°ƒç”¨ advance æ–¹æ³•ï¼Œè·å–æœ€æ–°çš„æ—¶é—´ã€ä¸Šä¸€æ¬¡å–å¾—ä»¤ç‰Œçš„æ—¶é—´ã€æœ€æ–°çš„tokenæ•°é‡ now, last, tokens := lim.advance(now) // æ›´æ–°tokenæ•°é‡ tokens -= float64(n) // è®¡ç®—ç­‰å¾…æ—¶é—´ï¼Œæ•°é‡å°äº0è¡¨ç¤ºä»¤ç‰Œæ¡¶ä¸­æœ¨æœ‰å¯ç”¨çš„ä»¤ç‰Œäº† var waitDuration time.Duration if tokens &lt; 0 &#123; waitDuration = lim.limit.durationFromTokens(-tokens) &#125; // è®¡ç®—ç»“æœ ok := n &lt;= lim.burst &amp;&amp; waitDuration &lt;= maxFutureReserve // åˆå§‹åŒ– Reservation r := Reservation&#123; ok: ok, lim: lim, limit: lim.limit, &#125; // æ›´æ–°ä»¤ç‰Œæ¡¶æ•°é‡å’Œæ—¶é—´ if ok &#123; r.tokens = n r.timeToAct = now.Add(waitDuration) &#125; // æ›´æ–°é™æµå™¨æœ€æ–°å–å¾—ä»¤ç‰Œçš„æ—¶é—´ã€æ•°é‡ã€äº‹ä»¶ if ok &#123; lim.last = now lim.tokens = tokens lim.lastEvent = r.timeToAct &#125; else &#123; lim.last = last &#125; lim.mu.Unlock() return r&#125;// è®¡ç®—æ—¶é—´å˜åŒ–çš„ Limiter çš„çŠ¶æ€å˜åŒ–ï¼Œå¾—åˆ°æœ€æ–°çš„æ—¶é—´ï¼Œæœ€åä¸€æ¬¡å–å¾—ä»¤ç‰Œçš„æ—¶é—´å’Œ token ä»¤ç‰Œæ•°é‡func (lim *Limiter) advance(now time.Time) (newNow time.Time, newLast time.Time, newTokens float64) &#123; last := lim.last if now.Before(last) &#123; last = now &#125; maxElapsed := lim.limit.durationFromTokens(float64(lim.burst) - lim.tokens) elapsed := now.Sub(last) if elapsed &gt; maxElapsed &#123; elapsed = maxElapsed &#125; delta := lim.limit.tokensFromDuration(elapsed) tokens := lim.tokens + delta if burst := float64(lim.burst); tokens &gt; burst &#123; tokens = burst &#125; return now, last, tokens&#125;// è¿™é‡Œå•ç‹¬æ”¾å‡ºæ¥ï¼Œæ˜¯æé†’ä¸€ä¸‹ï¼Œgoä¹Ÿæœ‰ç²¾åº¦ç¼ºå¤±é—®é¢˜ï¼Œæ‰€ä»¥å¤æ‚è®¡ç®—è¦æ³¨æ„func (limit Limit) tokensFromDuration(d time.Duration) float64 &#123; sec := float64(d/time.Second) * float64(limit) nsec := float64(d%time.Second) * float64(limit) return sec + nsec/1e9&#125; ä½¿ç”¨å®ä¾‹å’Œdemoå¯çœ‹ï¼š golang é™æµå™¨","tags":["gosourcecode"],"categories":["gosourcecode"]},{"title":"MongoDBçš„ç®€å•ä½¿ç”¨è¯´æ˜","path":"/2020/12/24/301/","content":"å®‰è£…// ä¸‹è½½ï¼Œæ³¨æ„ä¸‹è½½å¯¹åº”çš„ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¦åˆ™å®‰è£…ä¼šæŠ¥é”™wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.1.tgz// è§£å‹å³å¯ï¼Œæ— éœ€ç¼–è¯‘å®‰è£…tar -zxvf mongodb-linux-x86_64-rhel70-4.4.1.tgzmv mongodb-linux-x86_64-rhel70-4.4.1 /usr/local/mongodb å¯åŠ¨æœåŠ¡æ–°å»ºmongodb.confï¼ˆç‰ˆæœ¬å¯èƒ½ä¸ä¸€æ ·ï¼Œç•¥æœ‰ä¸åŒï¼‰ dbpath = /data/mongodb/data #æ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½• logpath = /data/mongodb/log/mongodb.log #æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½• port = 27000 #ç«¯å£ fork = true #ä»¥å®ˆæŠ¤ç¨‹åºçš„æ–¹å¼å¯ç”¨ï¼Œå³åœ¨åå°è¿è¡Œ bind_ip=127.0.0.1 cd /usr/local/mongodb/// å¯åŠ¨æœåŠ¡bin/mongod -f ./mongodb.conf æ–°å¢ç”¨æˆ·è®¾ç½®å¯†ç  use admin;db.createUser(&#123;user:&quot;root&quot;,pwd:&quot;666888&quot;,roles:[&quot;userAdminAnyDatabase&quot;]&#125;);use test;db.createUser(&#123; user: &quot;test&quot;, pwd: &quot;123456&quot;, roles: [&#123;role: &quot;readWrite&quot;,db: &quot;hotel&quot;&#125;]&#125;)db.createUser( &#123; user: &quot;admin&quot;, pwd: &quot;5176567&quot;, roles: [&#123;role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot;&#125;] &#125;) roleçš„è¯´æ˜ Readï¼šå…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“readWriteï¼šå…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“dbAdminï¼šå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®system.profileuserAdminï¼šå…è®¸ç”¨æˆ·å‘system.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥æ‰¾æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ·clusterAdminï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™ã€‚readAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™readWriteAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™userAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™dbAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™ã€‚rootï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™ å»ºè®®å‡ºrootå’Œadminï¼Œå„ä¸ªæ•°æ®åº“ä½¿ç”¨è‡ªå·±ç‹¬ç«‹çš„è´¦å·å¯†ç ã€‚ authå°è¯•ä¸€ä¸‹ï¼Œå¦‚æœè¿”å›1ï¼Œè¡¨ç¤ºauthéªŒè¯æˆåŠŸ db.auth(&#x27;root&#x27;, &#x27;666888&#x27;) å¸¸ç”¨å‘½ä»¤å…³é—­mongoæœåŠ¡ use admindb.shutdownServer() æ¸…ç©ºå½“å‰æ•°æ®åº“ use xxxdb.dropDatabase() é›†æˆåˆ°Laravelå®‰è£… composer require jenssegers/mongodb 3.6.x ä½ç‰ˆæœ¬éœ€è¦åœ¨config/app.phpåŠ å…¥ Jenssegers\\Mongodb\\MongodbServiceProvider::class, é…ç½®database.php &#x27;mongodb&#x27; =&gt; [ &#x27;driver&#x27; =&gt; &#x27;mongodb&#x27;, &#x27;host&#x27; =&gt; env(&#x27;MONGODB_HOST&#x27;, &#x27;127.0.0.1&#x27;), &#x27;port&#x27; =&gt; env(&#x27;MONGODB_PORT&#x27;, 27017), &#x27;database&#x27; =&gt; env(&#x27;MONGODB_DATABASE&#x27;, &#x27;test&#x27;), &#x27;username&#x27; =&gt; env(&#x27;MONGODB_USERNAME&#x27;, &#x27;test&#x27;), &#x27;password&#x27; =&gt; env(&#x27;MONGODB_PWD&#x27;, &#x27;&#x27;), &#x27;options&#x27; =&gt; [ // here you can pass more settings to the Mongo Driver Manager // see https://www.php.net/manual/en/mongodb-driver-manager.construct.php under &quot;Uri Options&quot; for a list of complete parameters that you can use &#x27;database&#x27; =&gt; env(&#x27;MONGODB_AUTHENTICATION_DATABASE&#x27;, &#x27;hotel&#x27;), // required with Mongo 3+ ], ], Modelå®šä¹‰: &lt;?php/** * Author: puresai * Date: 2020/12/22 * Time: 15:08 */namespace App\\Models;use Jenssegers\\Mongodb\\Eloquent\\Model;class Product extends Model&#123; protected $collection = &#x27;products&#x27;; protected $connection = &#x27;mongodb&#x27;; protected $guarded = [&#x27;id&#x27;];&#125; ä½¿ç”¨: $users = User::distinct(&#x27;name&#x27;)-&gt;get();$users = User::whereIn(&#x27;age&#x27;, [16, 18, 20])-&gt;get();$total = Product::count();$price = Product::avg(&#x27;price&#x27;); Eloquent ORMå¸¸ç”¨çš„å‘½ä»¤å‡æ”¯æŒï¼Œç”¨èµ·æ¥æ¯«æ— è¿å’Œæ„Ÿï¼Œselectç•¥æœ‰ä¸åŒï¼Œä¼šæŠŠ_idæŸ¥è¯¢å‡ºæ¥ã€‚ æ›´å¤šå‘½ä»¤ç‚¹å‡»æŸ¥çœ‹ä»£ç ä»“åº“ å¤§è‡´ä¹Ÿå°±è¿™äº›äº†ï¼Œèµ¶ç´§ä½¿ç”¨èµ·æ¥å§ï¼ï¼ï¼","tags":["MongoDB"],"categories":["db"]},{"title":"goçš„å¹¶å‘æ¨¡å‹","path":"/2020/11/21/283/","content":"ä»‹ç»å¹¶å‘æ¨¡å‹ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹å¹¶å‘å’Œå¹¶è¡Œã€‚ å¹¶å‘å’Œå¹¶è¡Œå¹¶å‘å’Œå¹¶è¡Œå¦æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨CPUå¤šæ ¸è®¡ç®—èµ„æºæå‡ºæ¥çš„æ¦‚å¿µã€‚ å¹¶å‘æŒ‡çš„æ˜¯åœ¨åŒä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œå¤šæ¡æŒ‡ä»¤åœ¨CPUä¸ŠåŒæ—¶æ‰§è¡Œ å¹¶è¡Œå€¼å¾—æ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œå¤šæ¡æŒ‡ä»¤åœ¨CPUä¸ŠåŒæ—¶æ‰§è¡Œ å¹¶å‘ç¨‹åºå…¶å®å¹¶ä¸è¦æ±‚CPUå…·å¤‡å¤šæ ¸è®¡ç®—çš„èƒ½åŠ›ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šè¢«åˆ†é…ä¸€å®šçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œåœ¨CPUä¸Šè¢«å¿«é€Ÿè½®æ¢æ‰§è¡Œã€‚ CSPå¹¶å‘æ¨¡å‹Goè¯­è¨€ä¸­å®ç°äº†ä¸¤ç§å¹¶å‘æ¨¡å‹ï¼Œä¸€ç§æ˜¯ä¾èµ–äºå…±äº«å†…å­˜å®ç°çš„çº¿ç¨‹-é”å¹¶å‘æ¨¡å‹ï¼Œå¦ä¸€ç§åˆ™æ˜¯CSPã€‚ CSPå€¡å¯¼ä½¿ç”¨é€šä¿¡æ¥å…±äº«å†…å­˜ï¼Œå®ƒæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š å¹¶å‘å®ä½“ï¼Œé€šå¸¸å¯ä»¥ç†è§£ä¸ºæ‰§è¡Œçº¿ç¨‹ï¼Œå®ƒä»¬ç›¸äº’ç‹¬ç«‹ä¸”å¯ä»¥å¹¶å‘æ‰§è¡Œ é€šé“ï¼Œå¹¶å‘å®ä½“ä¹‹é—´é€šè¿‡é€šé“å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œé€šä¿¡ CSP ç±»ä¼¼äºæˆ‘ä»¬å¸¸ç”¨çš„åŒæ­¥é˜Ÿåˆ—ï¼Œå®ƒå…³æ³¨çš„æ¶ˆæ¯ä¼ è¾“çš„æ–¹å¼ï¼ˆé€šé“ï¼‰ï¼Œå¹¶ä¸å…³æ³¨æ¶ˆæ¯å®ä½“ã€‚å‘é€è€…å’Œæ¥æ”¶è€…å¯èƒ½å¹¶ä¸çŸ¥é“å¯¹æ–¹æ˜¯è°ï¼Œè€¦åˆåº¦æ˜¯å¾ˆä½çš„ã€‚ è™½ç„¶CSPçš„é€šé“æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œä½†ä½œä¸ºç‹¬ç«‹çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«ä»»æ„å¹¶å‘å®ä½“åˆ›å»ºã€è¯»å–ã€å†™å…¥ã€ä½¿ç”¨ï¼Œä½†ä½¿ç”¨æ—¶åŠ¡å¿…æ³¨æ„ï¼Œå½“ä¸€ä¸ªå¹¶å‘å®ä½“åœ¨è¯»å–ä¸€ä¸ªæ°¸è¿œæ²¡æœ‰æ•°æ®æ”¾å…¥çš„é€šé“æˆ–è€…æŠŠæ•°æ®æ”¾å…¥ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«è¯»å–çš„é€šé“ï¼Œæ˜¯ä¼šè¢«é˜»å¡ï¼Œå‘ç”Ÿæ­»é”çš„ã€‚ MPGçº¿ç¨‹æ¨¡å‹Goè¯­è¨€ä¸ä½†æœ‰ç€ç‹¬ç‰¹çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œè¿˜æ‹¥æœ‰å¼ºå¤§çš„ç”¨äºè°ƒåº¦goroutineã€å¯¹æ¥ç³»ç»Ÿçº§çº¿ç¨‹çš„è°ƒåº¦å™¨ã€‚ è¿™ä¸ªè°ƒåº¦å™¨æ˜¯Goè¯­è¨€è¿è¡Œæ—¶ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä¸»è¦è´Ÿè´£ç»Ÿç­¹è°ƒé…Goå¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­çš„ä¸‰ä¸ªä¸»è¦å…ƒç´ ï¼Œå³ï¼šMPGã€‚ æ¨¡å— è¯´æ˜ Machine ä¸€ä¸ªMachineå¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œç›¸å½“äºå†…æ ¸çº¿ç¨‹åœ¨Goè¿›ç¨‹ä¸­çš„æ˜ å°„ Processor ä¸€ä¸ªProcessorè¡¨ç¤ºæ‰§è¡ŒGoç¨‹åºæ‰€å¿…é¡»çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¯ä»¥ç†è§£ä¸ºç”¨æˆ·ä»£ç é€»è¾‘çš„å¤„ç†å™¨ Goroutine æ˜¯å¯¹Goè¯­è¨€ä¸­ä»£ç ç‰‡æ®µçš„å°è£…ï¼Œå…¶å®æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç”¨æˆ·çº¿ç¨‹ Må’ŒPæ˜¯ä¸€å¯¹ä¸€ç»‘å®šçš„ï¼Œä½†ç”±äºPçš„å­˜åœ¨ï¼ŒGå’ŒMå¯ä»¥å‘ˆç°å‡ºå¤šå¯¹å¤šçš„å…³ç³»ã€‚å½“ä¸€ä¸ªæ­£åœ¨ä¸æŸä¸ªMå¯¹æ¥å¹¶è¿è¡Œç€çš„Gï¼Œéœ€è¦å› æŸä¸ªäº‹ä»¶ï¼ˆæ¯”å¦‚ç­‰å¾…I/Oæˆ–é”çš„è§£é™¤ï¼‰è€Œæš‚åœè¿è¡Œçš„æ—¶å€™ï¼Œè°ƒåº¦å™¨æ€»ä¼šåŠæ—¶åœ°å‘ç°ï¼Œå¹¶æŠŠè¿™ä¸ªGä¸é‚£ä¸ªMåˆ†ç¦»å¼€ï¼Œä»¥é‡Šæ”¾è®¡ç®—èµ„æºä¾›é‚£äº›ç­‰å¾…è¿è¡Œçš„Gä½¿ç”¨ã€‚ å¯ä»¥çœ‹å›¾ï¼Œæ›´ç›´è§‚ï¼š æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜ Pçš„æ•°é‡ï¼š ç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡$GOMAXPROCSæˆ–è€…æ˜¯ç”±runtimeçš„æ–¹æ³•GOMAXPROCS()å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»æ„æ—¶åˆ»éƒ½åªæœ‰$GOMAXPROCSä¸ªgoroutineåœ¨åŒæ—¶è¿è¡Œã€‚ Mçš„æ•°é‡: goè¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgoç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½®Mçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤10000ã€‚ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚ runtime/debugä¸­çš„SetMaxThreadså‡½æ•°ï¼Œè®¾ç½®Mçš„æœ€å¤§æ•°é‡ã€‚ Mä¸Pçš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ªMé˜»å¡ï¼ŒPå°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ªMï¼Œæ‰€ä»¥ï¼Œå³ä½¿Pçš„é»˜è®¤æ•°é‡æ˜¯1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ªMå‡ºæ¥ã€‚ På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»ºï¼š Pä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº†Pçš„æœ€å¤§æ•°é‡nåï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»ºnä¸ªPã€‚ Mä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„Mæ¥å…³è”På¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„Gã€‚æ¯”å¦‚æ‰€æœ‰çš„Mæ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€ŒPä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„Mã€‚ å‚è€ƒï¼š ã€ŠGoè¯­è¨€é«˜å¹¶å‘ä¸å¾®æœåŠ¡å®æˆ˜ã€‹ ã€ŠGoè¯­è¨€æ ¸å¿ƒ36è®²ã€‹ Golangè°ƒåº¦å™¨GMPåŸç†ä¸è°ƒåº¦å…¨åˆ†æ","tags":["go"],"categories":["go"]},{"title":"MySQLé—´éš™é”","path":"/2020/10/27/MySQL-gaplock/","content":"gap lock æ˜¯ä»€ä¹ˆï¼Ÿgap lockï¼Œä¹Ÿå°±æ˜¯é—´éš™é”ï¼Œæ˜¯innodbè¡Œçº§é”çš„ä¸€ç§ï¼Œå…¶ä»–çš„è¿˜æœ‰record lock, Next-KeyLocksã€‚ è¡Œé”ï¼ˆRecord Lockï¼‰ï¼šé”ç›´æ¥åŠ åœ¨ç´¢å¼•è®°å½•ä¸Šé¢ã€‚ é—´éš™é”ï¼ˆGap Lockï¼‰ï¼šé”åŠ åœ¨ä¸å­˜åœ¨çš„ç©ºé—²ç©ºé—´ï¼Œå¯ä»¥æ˜¯ä¸¤ä¸ªç´¢å¼•è®°å½•ä¹‹é—´ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªç´¢å¼•è®°å½•ä¹‹å‰æˆ–æœ€åä¸€ä¸ªç´¢å¼•ä¹‹åçš„ç©ºé—´ã€‚ Next-Key Lockï¼šè¡Œé”ä¸é—´éš™é”ç»„åˆèµ·æ¥ç”¨å°±å«åšNext-Key Lockã€‚ ä»€ä¹ˆæ—¶å€™ä¼šå–å¾—gap lockè¿™å’Œéš”ç¦»çº§åˆ«æœ‰å…³,åªåœ¨REPEATABLE READæˆ–ä»¥ä¸Šçš„éš”ç¦»çº§åˆ«ä¸‹çš„ç‰¹å®šæ“ä½œæ‰ä¼šå–å¾—gap lockæˆ–nextkey lockã€‚locking readsï¼ŒUPDATEå’ŒDELETEæ—¶ï¼Œé™¤äº†å¯¹å”¯ä¸€ç´¢å¼•çš„å”¯ä¸€æœç´¢å¤–éƒ½ä¼šè·å–gapé”æˆ–next-keyé”ã€‚å³é”ä½å…¶æ‰«æçš„èŒƒå›´ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å®ä¾‹ï¼š CREATE TABLE `sai13` ( `id` int(11) NOT NULL AUTO_INCREMENT, `user_id` int(11) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; æ’å…¥3æ¡è®°å½•ï¼Œ insert into sai13 values(10,1);insert into sai13 values(20,2);insert into sai13 values(30,3); åœ¨REPEATABLE READä¸‹ï¼Œæ›´æ–°ä¸€æ¡è®°å½•ä¸æäº¤ï¼Œç„¶åçœ‹çœ‹èƒ½é˜»å¡å¦å¤–çš„ä¼šè¯å“ªäº›æ“ä½œã€‚ SESSION 1: SESSION 1ä¸­æ›´æ–°id=20çš„è®°å½• mysql&gt; begin;Query OK, 0 rows affected (0.00 sec)mysql&gt; update sai13 set user_id=2 where id=20;Query OK, 1 row affected (0.04 sec)Rows matched: 1 Changed: 1 Warnings: 0 SESSION 2: mysql&gt; begin;Query OK, 0 rows affected (0.00 sec)mysql&gt; insert into sai13 values(9,4);Query OK, 1 row affected (0.00 sec)mysql&gt; insert into sai13 values(10,4);ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(19,4);ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; update sai13 set user_id=22 where id=20;ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(20,4);ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(21,4);ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(29,4);ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; insert into sai13 values(30,4);Query OK, 1 row affected (0.01 sec) SESSION 2ä¸­ï¼Œæ‰§è¡Œæ’å…¥æ“ä½œï¼Œå‘ç°[10,30)èŒƒå›´ä¸èƒ½æ’å…¥æ•°æ®ã€‚ SESSION 1: mysql&gt; begin;mysql&gt; update sai13 set user_id=4 where id=21;Query OK, 0 rows affected (0.00 sec) SESSION 2: mysql&gt; begin;mysql&gt; update sai13 set user_id=22 where id=20;Query OK, 1 row affected (0.01 sec)mysql&gt; insert into sai13 values(20,4);ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transactionmysql&gt; update sai13 set user_id=4 where id=30;Query OK, 0 rows affected (0.00 sec) è¿™é‡Œå‘¢ï¼Œæ˜¯å»é”ä½äº†ä¸€æ¡ä¸å­˜åœ¨çš„è®°å½•ï¼Œä»–ä¼šé”ä½æœ€è¿‘çš„[20,30)åŒºé—´ï¼Œç„¶è€Œä¸å‰ä¸€ä¸ªä¾‹å­ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œupdateï¼ˆid = 20ï¼‰æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œinsertï¼ˆid = 20ï¼‰æ˜¯ä¸å¯ä»¥çš„ã€‚ å¦‚æœSESSION 1çš„è¡¨æ‰«ææ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œé‚£ä¹ˆgapæˆ–next-keyé”ä½çš„èŒƒå›´æ˜¯æ•´ä¸ªè¡¨ï¼Œå³ä»»ä½•å€¼éƒ½ä¸èƒ½æ’å…¥ã€‚ ä½œç”¨é—´éš™é”åœ¨InnoDBçš„å”¯ä¸€ä½œç”¨å°±æ˜¯é˜²æ­¢å…¶å®ƒäº‹åŠ¡çš„æ’å…¥æ“ä½œï¼Œä»¥æ­¤æ¥è¾¾åˆ°é˜²æ­¢å¹»è¯»çš„å‘ç”Ÿï¼Œæ‰€ä»¥é—´éš™é”ä¸åˆ†ä»€ä¹ˆå…±äº«é”ä¸æ’å®ƒé”ã€‚ æ—¢ç„¶çŸ¥é“æœ‰gap lockå’Œnext key lockï¼Œæˆ‘ä»¬å¼€å‘ä¸­å°±è¦é¿å…æ”¶åˆ°å…¶å½±å“ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨é”å°½é‡èµ°ç´¢å¼•ï¼Œç”šè‡³æ˜¯å”¯ä¸€ç´¢å¼•ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å…³é—­é—´éš™é”ï¼Œå¯ä»¥æŠŠéš”ç¦»çº§åˆ«é™ä¸ºè¯»å·²æäº¤Read Committedï¼Œæˆ–è€…å¼€å¯å‚æ•°innodb_locks_unsafe_for_binlogã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"layerå…³é—­çš„é—®é¢˜","path":"/2020/10/21/277/","content":"layerå¼¹å‡ºå±‚åº”è¯¥æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ä¸ªç»„ä»¶äº†ã€‚ é‡åˆ°ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¼¹å‡ºå±‚åŠ ä¸Šä¸‹ä¸€ä¸ªä¸Šä¸€ä¸ªï¼Œå…¶å®æŒ‰ç†æ˜¯æ¯”è¾ƒå¥½å®ç°ï¼Œç‚¹å‡»ä¸Šä¸€ä¸ªä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œè°ƒç”¨ä¸€ä¸‹layer.closeå³å¯ï¼Œç„¶è€Œæ— å¥ˆçš„æ˜¯å¼¹å‡ºçš„æ˜¯ä¸€ä¸ªiframeï¼Œéƒ½ä¸åœ¨ä¸€ä¸ªé¡µé¢ï¼Œå¦‚ä½•è°ƒç”¨layer.closeã€‚ é‚£å¯æ€ä¹ˆåŠå‘¢ï¼Ÿ var index=parent.layer.getFrameIndex(window.name);parent.layer.close(index);parent.layer.open(&#123; type: 2, title: &#x27;è¯¦æƒ…&#x27;, shadeClose: true, area: [&#x27;1000px&#x27;, &#x27;96%&#x27;], content: &quot;...&quot;&#125;); å¦‚ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨parent.layer.closeï¼Œå¹¶é€šè¿‡parent.layer.getFrameIndexè·å–å‰¯é¡µé¢çš„layerå…ƒç´ ï¼Œè¿™æ ·å°±å®ç°æ­¤éœ€æ±‚äº†ã€‚","tags":["js"],"categories":["web"]},{"title":"golangçš„timeä½¿ç”¨","path":"/2020/09/10/275/","content":"timeåº”è¯¥æ˜¯å¼€å‘ä¸­æ¯”è¾ƒå¸¸ç”¨çš„åº“äº†ï¼Œå¸¸è§æ–¹æ³•è¯´æ˜ï¼š package mainimport (\t&quot;time&quot;\t&quot;fmt&quot;)func main() &#123;\ta := time.Now().Unix()\tfmt.Println(&quot;æ—¶é—´æˆ³---&quot;, a)\t// 2006-01-02 15:04:05 è®°ä½è¿™ä¸€åˆ»\tb := time.Now().Format(&quot;2006-01-02 15:04:05&quot;)\tfmt.Println(&quot;æ ¼å¼åŒ–æ—¶é—´&quot;, b)\t/**\tfunc (t Time) Add(d Duration) Time\tDurationå¦‚ä¸‹\tconst ( Nanosecond Duration = 1 Microsecond = 1000 * Nanosecond Millisecond = 1000 * Microsecond Second = 1000 * Millisecond Minute = 60 * Second Hour = 60 * Minute\t) */\tc := time.Now().Add(time.Minute * 3)\tfmt.Println(&quot;3åˆ†é’Ÿåæ—¶é—´&quot;, c.Format(&quot;2006-01-02 15:04:05&quot;))\t/** func (t Time) AddDate(years int, months int, days int) Time\t*/\td := time.Now().AddDate(-1, 1,10)\tfmt.Println(&quot;æ—¶é—´&quot;, d.Format(&quot;2006-01-02 15:04:05&quot;))\t// è¿”å›å¹´æœˆæ—¥ä¸‰ä¸ªå€¼\tfmt.Println(time.Now().Date())\t// è¿”å›æ—¶åˆ†ç§’ä¸‰ä¸ªå€¼\tfmt.Println(time.Now().Clock())\tfmt.Println(time.Now().Year(), time.Now().Month(), time.Now().Day())\tfmt.Println(time.Now().Weekday(), time.Now().Hour())\tfmt.Println(time.Now().YearDay())\tfmt.Println(time.Since(d))\t// tringè¿”å›é‡‡ç”¨å¦‚ä¸‹æ ¼å¼å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–æ—¶é—´ã€‚\t// &quot;2006-01-02 15:04:05.999999999 -0700 MST&quot;\tfmt.Println(time.Now().String())\ttime.AfterFunc(2*time.Second, func() &#123; fmt.Println(&quot;hello 2s&quot;)\t&#125;)\tloc, _ := time.LoadLocation(&quot;Asia/Shanghai&quot;)\tconst longForm = &quot;Jan 2, 2006 at 3:04pm (MST)&quot;\tconst shortForm = &quot;2006-Jan-02&quot;\tt, _ := time.ParseInLocation(longForm, &quot;Jul 9, 2012 at 5:02am (CEST)&quot;, loc)\tfmt.Println(t) /**\tfunc ParseInLocation(layout, value string, loc *Location) (Time, error) */\tt, _ = time.ParseInLocation(shortForm, &quot;2022-Jul-09&quot;, loc)\tfmt.Println(t)\t/**\tfunc Parse(layout, value string) (Time, error)\tè§£æä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²å¹¶è¿”å›å®ƒä»£è¡¨çš„æ—¶é—´\tParseInLocationç±»ä¼¼Parseä½†æœ‰ä¸¤ä¸ªé‡è¦çš„ä¸åŒä¹‹å¤„ã€‚\tç¬¬ä¸€ï¼Œå½“ç¼ºå°‘æ—¶åŒºä¿¡æ¯æ—¶ï¼ŒParseå°†æ—¶é—´è§£é‡Šä¸ºUTCæ—¶é—´ï¼Œè€ŒParseInLocationå°†è¿”å›å€¼çš„Locationè®¾ç½®ä¸ºlocï¼›\tç¬¬äºŒï¼Œå½“æ—¶é—´å­—ç¬¦ä¸²æä¾›äº†æ—¶åŒºåç§»é‡ä¿¡æ¯æ—¶ï¼ŒParseä¼šå°è¯•å»åŒ¹é…æœ¬åœ°æ—¶åŒºï¼Œè€ŒParseInLocationä¼šå»åŒ¹é…loc\t*/\tt, _ = time.Parse(longForm, &quot;Feb 3, 2023 at 7:54pm (PST)&quot;)\tfmt.Println(t) t, _ = time.Parse(shortForm, &quot;2020-Feb-03&quot;)\tfmt.Println(t)\tch := make(chan int)\ttimeout := time.After(time.Second * 2)\ttimer := time.NewTimer(time.Second * 4) var i int\tgo func() &#123; for &#123; // i++ select &#123; case &lt;- ch: fmt.Println(&quot;channel close&quot;) return case &lt;- timer.C: fmt.Println(&quot;4sçš„NewTimerå®šæ—¶ä»»åŠ¡&quot;) case &lt;- timeout: fmt.Println(&quot;4så®šæ—¶è¾“å‡º&quot;) case &lt;- time.After(time.Second * 6): fmt.Println(&quot;6såˆ°äº†&quot;) // default: // //Sleep 1ç§’ï¼Œå‚æ•°å°±æ˜¯ä¸Šé¢çš„Duration // time.Sleep(time.Second * 1) // fmt.Println(&quot;go 1s&quot;) &#125; &#125;\t&#125;()\ttime.Sleep(time.Second * 15)\tfmt.Println(&quot;close----&quot;)\tclose(ch)\ttime.Sleep(time.Second * 2)&#125;","tags":["go"],"categories":["go"]},{"title":"Laravelé…åˆMaatwebsiteExcelå®ç°Excelå¯¼å‡º","path":"/2020/08/31/272/","content":"ç›¸æ¯”å¯¼å…¥ï¼Œé¡¹ç›®ä¸­å¯¼å‡ºåœºæ™¯æ›´å¤šï¼Œä¼°æ‘¸ç€ç°åœ¨æœ‰åå¤šä¸ªå¯¼å‡ºäº†ï¼Œä¹‹å‰å†™äº†å¯¼å…¥ï¼Œè¿™ä¼šæ‰æŠŠå¯¼å‡ºè¡¥ä¸Šã€‚ å®‰è£…ä¹‹å‰è¯´è¿‡ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹é…ç½®ï¼Œè™½ç„¶å·²æœ‰é»˜è®¤é…ç½®ï¼Œä½†è¿˜æ˜¯æœ‰ä¿®æ”¹é…ç½®çš„åœºæ™¯ï¼Œæ‰€ä»¥å»ºè®®ç”Ÿæˆé…ç½®æ–‡ä»¶ã€‚ é…ç½®//ç”Ÿæˆconfig/excel.phpphp artisan vendor:publish --provider=&quot;Maatwebsite\\Excel\\ExcelServiceProvider&quot; é…ç½®åªæä¸€ä¸ªï¼Œå…¶ä»–æ³¨é‡Šè›®ç»†çš„ï¼Œ &#x27;csv&#x27; =&gt; [\t&#x27;delimiter&#x27; =&gt; &#x27;,&#x27;,\t&#x27;enclosure&#x27; =&gt; &#x27;&quot;&#x27;,\t&#x27;line_ending&#x27; =&gt; PHP_EOL,\t// å¯¼å‡ºcsvä¸­æ–‡ä¹±ç ï¼ŒæŠŠuse_bomè®¾ä¸ºtrueå³å¯\t&#x27;use_bom&#x27; =&gt; true,\t&#x27;include_separator_line&#x27; =&gt; false,\t&#x27;excel_compatibility&#x27; =&gt; false,], æ¥ä¸‹æ¥ï¼Œæ¥å®Œæˆä¸€ä¸ªå¯¼å‡ºçš„demoè¯´æ˜ä¸‹å¸¸ç”¨çš„ä¸€äº›ç‚¹ã€‚ DEMOphp artisan make:export MultiExport ç”Ÿæˆæ–‡ä»¶å¦‚ä¸‹ï¼š &lt;?phpnamespace App\\Exports;use Maatwebsite\\Excel\\Concerns\\FromCollection;class MultiExport implements FromCollection&#123; /** * @return \\Illuminate\\Support\\Collection */ public function collection() &#123; // &#125;&#125; è‡ªå®šä¹‰sheetï¼Œå¢åŠ  WithTitle è‡ªå®šä¹‰åˆ—åï¼Œå¢åŠ WithHeadings ä¸æƒ³ä½¿ç”¨Collectionï¼Œæ›¿æ¢FromCollectionä½¿ç”¨FromArray å¤šä¸ªsheetï¼Œæ›¿æ¢FromCollectionä½¿ç”¨WithMultipleSheets ç»è¿‡æ”¹é€ ï¼š &lt;?php/** * å¤šé‡å¯¼å‡º */namespace App\\Exports;use App\\Exports\\MultiExportA;use App\\Exports\\MultiExportB;use Maatwebsite\\Excel\\Concerns\\WithMultipleSheets;class MultiExport implements WithMultipleSheets&#123; private $date; public function __construct($date) &#123; $this-&gt;date = $date; &#125; public function sheets(): array &#123; $sheets = []; $sheets[] = new MultiExportA($this-&gt;date); $sheets[] = new MultiExportB($this-&gt;date); return $sheets; &#125;&#125;---// MultiExportAï¼ŒMultiExportBç±»æ¯”å³å¯&lt;?phpnamespace App\\Exports;use Maatwebsite\\Excel\\Concerns\\FromArray;use Maatwebsite\\Excel\\Concerns\\WithHeadings;use Maatwebsite\\Excel\\Concerns\\WithTitle;use App\\Models\\ExportA;class MultiExportA implements FromArray, WithTitle, WithHeadings&#123; private $date; public function __construct($date, $cityId) &#123; $this-&gt;date = $date; &#125; public function headings(): array &#123; return [ &#x27;ID&#x27;, &#x27;åç§°&#x27;, &#x27;ä»·æ ¼&#x27;, &#x27;æ‰‹æœº&#x27; ]; &#125; /** * @return array */ public function array() : array &#123; $data = ExportA::where(&#x27;date&#x27;, $this-&gt;date) -&gt;get() -&gt;toArray(); $ret = []; foreach ($data as $val) &#123; // ä¸€æ®µç¥å¥‡çš„ä»£ç è®¡ç®—å‡ºäº†ä»·æ ¼ $price = ...; $ret[] = [ &#x27;id&#x27; =&gt; $val[&#x27;id&#x27;].&quot;\\t&quot;, &#x27;name&#x27; =&gt; $val[&#x27;name&#x27;], &#x27;price&#x27; =&gt; $price, // è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œç¼–ç excelä½¿ç”¨äº†ç§‘å­¦è®¡æ•°æ³• &#x27;mobile&#x27; =&gt; $val[&#x27;mobile&#x27;].&quot;\\t&quot;, ]; &#125; return $ret; &#125; /** * @return string */ public function title(): string &#123; return &#x27;è¡¨æ ¼A&#x27;; &#125;&#125; ä½¿ç”¨ // ä¿å­˜$obj = new MultiExport($date);Excel::store($obj, &#x27;MultiExport&#x27;.$date.&#x27;.xlsx&#x27;);// ä¸‹è½½csvExcel::download($obj, &#x27;MultiExport&#x27;.$date.&#x27;.csv&#x27;, \\Maatwebsite\\Excel\\Excel::CSV, [&#x27;Content-Type&#x27; =&gt; &#x27;text/csv&#x27;]); é—®é¢˜æ€è€ƒå½“æ•°æ®é‡è¿‡å¤§çš„æ—¶å€™ï¼Œå¯¼å‡ºæ—¶å¾ˆå¯èƒ½ä¼šå†…å­˜æº¢å‡ºäº†ã€‚å»ºè®®ï¼š ä½¿ç”¨å…¶ä»–é«˜æ€§èƒ½çš„ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨åŸç”Ÿä»£ç æµå¼è¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚goï¼‰ç¼–å†™ æ–‡ä»¶è¿‡å¤§ï¼ŒExcelæ‰“å¼€å¤§æ•°æ®é‡æ–‡ä»¶ä¹Ÿå¾ˆé¸¡è‚‹ï¼Œå®¹æ˜“å¡æ­»ç”šè‡³å´©æºƒï¼Œå°è¯•åˆ†æ–‡ä»¶å¯¼å‡ºï¼Œæ¯”å¦‚1wä¸€ä¸ªæ–‡ä»¶ éƒ¨åˆ†å¯¼å‡ºè¿‡ç¨‹å¯èƒ½æœ‰è®¡ç®—ï¼Œå¯ä»¥æå‰è®¡ç®—å¥½ï¼Œå¯¼å‡ºæ—¶ç›´æ¥è¯»è¡¨ï¼Œä½¿ç”¨LazyCollectionï¼Œ ä½¿ç”¨ Lazy Collections æ¥æé«˜ Laravel Excel è¯»å–çš„æ€§èƒ½ï¼ˆè½»æ¾æ”¯æŒç™¾ä¸‡æ•°æ®ï¼‰","tags":["Laravel"],"categories":["PHP"]},{"title":"Laravelå¸¸ç”¨ä»£ç åˆé›†","path":"/2020/08/30/270/","content":"ç”¨Laravelä¹Ÿæœ‰ä¸çŸ­çš„æ—¶é—´äº†ï¼Œä¹Ÿç”¨è¿‡ä¸å°‘ç‰ˆæœ¬äº†ï¼Œä»¥ä¸‹ä»£ç æ˜¯åœ¨æ—¥å¸¸é¡¹ç›®ä¸­æ”¶é›†ï¼Œä½œä¸ºç¬”è®°ï¼Œä¹Ÿåˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›å¯¹ä½ æœ‰ç‚¹ç”¨å¤„ã€‚æ³¨ï¼šç‰ˆæœ¬æ²¡æ ‡æ³¨ï¼Œè‹¥æœ‰ä¸å…¼å®¹çš„é—®é¢˜ï¼Œå¾®è°ƒå³å¯ã€‚ éªŒè¯ä¸å¤ªä¹ æƒ¯å•ç‹¬å¼„ä¸ªRequestéªŒè¯ç±»ï¼Œæ¯”è¾ƒä¹ æƒ¯ä¸‹é¢çš„å†™æ³•ï¼š use Illuminate\\Http\\Request;use Illuminate\\Support\\Facades\\Validator;\t$inputData = $request-&gt;only([&#x27;name&#x27;, &#x27;address&#x27;, &#x27;mobile&#x27;, &#x27;draw_id&#x27;]); $messages = [ &#x27;required&#x27;=&gt;&#x27;:attributeä¸ºå¿…å¡«é¡¹&#x27;, &#x27;int&#x27;=&gt;&#x27;:attributeå‚æ•°ç±»å‹é”™è¯¯&#x27;, &#x27;max&#x27;=&gt;&#x27;:attributeé•¿åº¦ä¸å¾—è¶…è¿‡ :size&#x27;, ]; $validator = Validator::make($inputData, [ &#x27;draw_id&#x27; =&gt; &#x27;required|int&#x27;, &#x27;name&#x27; =&gt; &#x27;required&#x27;, &#x27;mobile&#x27; =&gt; &#x27;required&#x27;, &#x27;address&#x27; =&gt; &#x27;required&#x27;,\t], $messages,[ &#x27;name&#x27;=&gt;&#x27;æ”¶è´§äººå§“å&#x27;, &#x27;mobile&#x27;=&gt;&#x27;æ‰‹æœºå·ç &#x27;, &#x27;address&#x27;=&gt;&#x27;æ”¶è´§åœ°å€&#x27;,\t]);\tif ($validator-&gt;fails()) &#123; return self::response([], current($validator-&gt;errors()-&gt;all()), 2);\t&#125; ORMå…³è”æŸ¥è¯¢ ä¸€å¯¹ä¸€ // Modelå®šä¹‰ï¼Œå…³è”å¤–é”®class User extends Model&#123; ... public function userIntegral() &#123; return $this-&gt;hasOne(&#x27;App\\Models\\UserIntegral&#x27;, &#x27;user_id&#x27;, &#x27;id&#x27;); &#125;&#125;// ä½¿ç”¨withæŸ¥è¯¢(new User())-&gt;with(&#x27;userIntegral&#x27;)-&gt;orderBy(&#x27;id&#x27;, &#x27;desc&#x27;)-&gt;paginate($limit); ä¸€å¯¹å¤š //Modelnamespace App\\Models;use Illuminate\\Database\\Eloquent\\Model;class Hotel extends Model&#123; public function orders() &#123; return $this-&gt;hasMany(&#x27;App\\Models\\Order&#x27;); &#125;&#125;//ä½¿ç”¨ï¼Œæ¯”å¦‚æŸ¥è¯¢æŸä¸ªHotelä¸‹status=30çš„Order$hotel = Hotel::with([&#x27;orders&#x27; =&gt; function ($query) &#123; $query-&gt;where(&#x27;status&#x27;, 30); &#125;])-&gt;find(4); ç»Ÿä¸€å¼‚å¸¸å¤„ç†è¿™ä¸ªå¯ä»¥å‚è§ä¹‹å‰çš„æ–‡ç« Laravel ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸º JSON é˜Ÿåˆ—å¤±è´¥é˜Ÿåˆ—å…¥åº“ ç”Ÿæˆè¡¨ç”Ÿæˆfailed_jobsè¡¨ php artisan queue:failed-tablephp artisan migrate å•ç‹¬å¤„ç† å¯ä»¥åœ¨Jobä¸­å•ç‹¬å¤„ç†å¤±è´¥ï¼ŒJobå¤±è´¥ä¹Ÿä¼šå†™å…¥ä¸Šé¢ç”Ÿæˆçš„failed_jobsè¡¨ /*** ä»»åŠ¡å¤±è´¥çš„å¤„ç†è¿‡ç¨‹** @param Exception $exception* [@return](https://learnku.com/users/31554) void*/public function failed(Exception $exception)&#123;\t// å¤„ç†&#125; é‡è¯•é˜Ÿåˆ—æœ‰æ—¶å€™ä»£ç æœ‰æ¼æ´å¯èƒ½ä¼šæœ‰é˜Ÿåˆ—æ‰§è¡Œå¤±è´¥çš„çŠ¶å†µï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦é‡è¯•ã€‚ æŸ¥çœ‹æ‰€æœ‰å¤±è´¥php artisan queue:failed é‡è¯•æ‰€æœ‰å¤±è´¥php artisan queue:retry all é‡è¯•å•ä¸ªå¤±è´¥php artisan queue:retry 13 æ¸…ç©ºå¤±è´¥ï¼ˆé‡è¦çš„é˜Ÿåˆ—æ•°æ®ä¸‡ä¸å¯è¿™ä¹ˆæ“ä½œï¼‰php artisan queue:flush å¦å¤–ï¼Œæ‰‹åŠ¨å»æ“ä½œç¡®å®ä¸å¤ªæ–¹ä¾¿ï¼Œä½ å¯ä»¥è®¾ç½®ä¸ªcronï¼Œå®šæ—¶é‡è¯•æ‰€æœ‰å¤±è´¥ï¼Œä½†åŠ¡å¿…è¦æ³¨æ„æ¶ˆæ¯æé†’ï¼Œä»¥å…é˜Ÿåˆ—ä¸€ç›´é‡è¯•ä¸€ç›´å¤±è´¥ï¼Œå¾€å¤è¿è¡Œï¼Œå½±å“äº†æ­£å¸¸çš„é˜Ÿåˆ—æ€§èƒ½ã€‚ å…¶ä»–å¸¸ç”¨ä»£ç æ–‡ä»¶ä¸Šä¼ OSS&lt;?phpnamespace App\\Http\\Controllers;use Illuminate\\Http\\Request;use Controller;use Illuminate\\Support\\Facades\\Storage;use Illuminate\\Support\\Facades\\Validator;use OSS\\OssClient;use OSS\\Core\\OssException;class UploadController extends Controller&#123; public function index(Request $request) &#123; $file = $request-&gt;file(&#x27;file&#x27;); if ($file-&gt;isValid()) &#123; $ext = $file-&gt;getClientOriginalExtension(); $realPath = $file-&gt;getRealPath(); $filepath = config(&#x27;app.env&#x27;).&#x27;/&#x27; . md5(uniqid(&#x27;&#x27;, true)); $result = $this-&gt;uploadOss($realPath, $filepath.&quot;.&quot;.$ext); if ($result[&#x27;code&#x27;]) &#123; return response([&#x27;code&#x27; =&gt; 2, &#x27;msg&#x27; =&gt; $result[&#x27;msg&#x27;]]); &#125; else &#123; return response([&#x27;code&#x27; =&gt; 0, &#x27;msg&#x27; =&gt; &#x27;ä¸Šä¼ æˆåŠŸ&#x27;, &#x27;data&#x27; =&gt; [ &#x27;filepath&#x27; =&gt; $result[&#x27;data&#x27;][&#x27;url&#x27;], &#x27;data&#x27; =&gt; $request-&gt;all() ]]); &#125; &#125; &#125; /** * ä¸Šä¼ oss * @param $filePath å½“å‰è·¯å¾„ * @param $object é¢„å®šä¹‰æ–‡ä»¶åï¼Œå¯å«æ–‡ä»¶å¤¹ * [@return](https://learnku.com/users/31554) array */ public function uploadOss($filePath, $object) &#123; $accessKeyId = config(&#x27;filesystems.disks&#x27;)[config(&#x27;filesystems.default&#x27;)][&#x27;access_key&#x27;]; $accessKeySecret = config(&#x27;filesystems.disks&#x27;)[config(&#x27;filesystems.default&#x27;)][&#x27;secret_key&#x27;]; $endpoint = config(&#x27;filesystems.disks&#x27;)[config(&#x27;filesystems.default&#x27;)][&#x27;endpoint&#x27;]; $bucket= config(&#x27;filesystems.disks&#x27;)[config(&#x27;filesystems.default&#x27;)][&#x27;bucket&#x27;]; $url = config(&#x27;filesystems.disks&#x27;)[config(&#x27;filesystems.default&#x27;)][&#x27;host&#x27;]; try&#123; $ossClient = new OssClient($accessKeyId, $accessKeySecret, $endpoint); $ossClient-&gt;uploadFile($bucket, $object, $filePath); return [ &#x27;code&#x27; =&gt; 0, &#x27;data&#x27; =&gt; [ &#x27;url&#x27; =&gt; $url.&#x27;/&#x27;.$object ] ]; &#125; catch(OssException $e) &#123; return [ &#x27;code&#x27; =&gt; 1, &#x27;msg&#x27; =&gt; $e-&gt;getMessage() ]; &#125; &#125;&#125;// -------// é…ç½®&#x27;oss&#x27; =&gt; [ &#x27;driver&#x27; =&gt; &#x27;oss&#x27;, &#x27;root&#x27; =&gt; &#x27;&#x27;, &#x27;access_key&#x27; =&gt; env(&#x27;OSS_ACCESS_KEY&#x27;), &#x27;secret_key&#x27; =&gt; env(&#x27;OSS_SECRET_KEY&#x27;), &#x27;endpoint&#x27; =&gt; env(&#x27;OSS_ENDPOINT&#x27;), // ä½¿ç”¨ ssl è¿™é‡Œè®¾ç½®å¦‚: https://oss-cn-beijing.aliyuncs.com &#x27;bucket&#x27; =&gt; env(&#x27;OSS_BUCKET&#x27;), &#x27;isCName&#x27; =&gt; env(&#x27;OSS_IS_CNAME&#x27;, false), // å¦‚æœ isCname ä¸º falseï¼Œendpoint åº”é…ç½® oss æä¾›çš„åŸŸåå¦‚ï¼š`oss-cn-beijing.aliyuncs.com`ï¼Œå¦åˆ™ä¸ºè‡ªå®šä¹‰åŸŸåï¼Œï¼Œcname æˆ– cdn è¯·è‡ªè¡Œåˆ°é˜¿é‡Œ oss åå°é…ç½®å¹¶ç»‘å®š bucket &#x27;host&#x27; =&gt; env(&#x27;OSS_HOST&#x27;, &#x27;&#x27;)], jsonè¾“å‡ºprotected static $code = 0;protected static $msg = &#x27;ok&#x27;;public function response($data = [], $msg = &#x27;&#x27;, $code = 0)&#123; if (is_null($data)) &#123; $data = new \\stdClass(); &#125; return response()-&gt;json([ &#x27;code&#x27; =&gt; $code? $code : self::$code, &#x27;msg&#x27; =&gt; $msg? $msg : self::$msg, &#x27;data&#x27; =&gt; $data, ], 200);&#125; è¿›ç¨‹é” æ™®é€šç‰ˆæœ¬ // $autoDelå­—æ®µåˆ é™¤ï¼Œ$ttl è¿‡æœŸæ—¶é—´ï¼Œç§’public function processLock($key, $autoDel = true, $ttl = 60)&#123; $key = &#x27;processLock:&#x27;.$key;\t// ä¸åŒç‰ˆæœ¬æˆ–Redisæ‰©å±•ï¼Œä¼šæœ‰ç•¥å¾®ä¸åŒï¼Œè‡ªè¡Œè°ƒæ•´ä¸‹ä»£ç å³å¯ if (Redis::Command(&#x27;set&#x27;, [$key, 1, &#x27;EX&#x27;, $ttl, &#x27;NX&#x27;])) &#123; if ($autoDel) &#123; register_shutdown_function(function () use ($key) &#123; Redis::del($key); &#125;); &#125; return true; &#125; return false;&#125; luaç‰ˆæœ¬ public function getScript() &#123; return &lt;&lt;&lt;LUA local ret = Redis.call(&quot;setnx&quot;, KEYS[1], ARGV[1]) if ret == 1 then return Redis.call(&quot;expire&quot;, KEYS[1], ARGV[2]) else return 0 endLUA; &#125; public function processLock($key, $autoDel = true, $ttl = 60) &#123; if (Redis::eval($this-&gt;getScript(), 1, $key, 1, $ttl)) &#123; if ($autoDel) &#123; register_shutdown_function(function () use ($key) &#123; Redis::del($key); &#125;); &#125; &#125; return false;\t&#125; è¯´æ˜ï¼šRedis::evalè¡Œç¬¬ä¸€ä¸ª1è¡¨ç¤ºkeyçš„æ•°é‡ï¼Œæ˜¯ä¸ºäº†åŒºåˆ†KEYSå’ŒARGVã€‚ JWTLaravel é…åˆ jwt ä½¿ç”¨ ç³»ç»Ÿé€šçŸ¥åˆ°é’‰é’‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—ï¼ŒæŠŠä¸€äº›é‡è¦çš„é€šçŸ¥æŠ•åˆ°é’‰é’‰ï¼Œä¸»è¦ä»£ç å¦‚ä¸‹ï¼š &lt;?phpnamespace App\\Jobs;use Illuminate\\Bus\\Queueable;use Illuminate\\Contracts\\Queue\\ShouldQueue;use Illuminate\\Foundation\\Bus\\Dispatchable;use Illuminate\\Queue\\InteractsWithQueue;use Illuminate\\Queue\\SerializesModels;use Illuminate\\Support\\Facades\\Log;use GuzzleHttp\\Client;class SystemNotify implements ShouldQueue&#123; use Dispatchable, InteractsWithQueue, Queueable, SerializesModels; private $title; private $content; private $type; private $robot; const DD_URL = &#x27;https://oapi.dingtalk.com&#x27;; /** * Create a new job instance. * * @param $title * @param string $content * @param string $type text, markdown * @param int $robot */ public function __construct($title, $content = &#x27;&#x27;, $type = &#x27;markdown&#x27;, $robot = 1) &#123; // å•ç‹¬ä½¿ç”¨SystemNotifyé˜Ÿåˆ— $this-&gt;queue = &#x27;SystemNotify&#x27;; $this-&gt;title = $title; $this-&gt;content = $content; $this-&gt;type = $type; $this-&gt;robot = $robot; &#125; /** * Execute the job. * * @return void */ public function handle() &#123; // å¯ä»¥ä¸ä½¿ç”¨å…³é”®å­—ï¼Œå»ºè®®é’‰é’‰æœºå™¨äººä½¿ç”¨IPæ®µè®¾ç½®ï¼Œæ›´ä¸ºå®‰å…¨ switch ($this-&gt;type)&#123; case &#x27;markdown&#x27;: $params = [ &#x27;msgtype&#x27; =&gt; $this-&gt;type, $this-&gt;type =&gt; [ &#x27;title&#x27; =&gt; $this-&gt;title.&#x27;[å…³é”®å­—]&#x27;, &#x27;text&#x27; =&gt; $this-&gt;content ] ]; break; default: $params = [ &#x27;msgtype&#x27; =&gt; $this-&gt;type, $this-&gt;type =&gt; [ &#x27;content&#x27; =&gt; $this-&gt;content.&#x27;[å…³é”®å­—]&#x27;, ] ]; break; &#125; $params = json_encode($params, JSON_UNESCAPED_UNICODE); $uri = self::URL_MAPPING[$this-&gt;robot]; $this-&gt;getClient()-&gt;request(&#x27;POST&#x27;, $uri, [ &#x27;headers&#x27; =&gt; [ &#x27;Content-Type&#x27; =&gt; &#x27;application/json;charset=utf-8&#x27; ], &#x27;body&#x27; =&gt; $params ]); &#125; // å¯¹åº”ä¸åŒçš„é’‰é’‰ç¾¤é€šçŸ¥ï¼Œä¿®æ”¹access_tokenå‚æ•°å³å¯ const URL_MAPPING = [ 1 =&gt; &#x27;/robot/send?access_token=@1&#x27;, 2 =&gt; &#x27;/robot/send?access_token=@2&#x27; ]; public function getClient() &#123; return new Client([ &#x27;base_uri&#x27; =&gt; &#x27;https://oapi.dingtalk.com&#x27;, &#x27;timeout&#x27; =&gt; 30, &#x27;verify&#x27; =&gt; false ]); &#125;&#125; è¯´æ˜ï¼šé€šçŸ¥å†…å®¹å¯ä»¥è‡ªå®šä¹‰ï¼Œæ·»åŠ æ™ºèƒ½æœºå™¨äººæ“ä½œæ¯”è¾ƒç®€å•å°±ä¸èµ˜è¿°äº† é’‰é’‰æ–‡æ¡£ åå°æ“ä½œæ—¥å¿—åˆ©ç”¨ Laravel ä¸­é—´ä»¶ç»™åå°åŠ ä¸ªæ“ä½œæ—¥å¿— ExcelLaravel6 é…åˆ Maatwebsite\\Excel å®ç° Excel å¯¼å…¥ Laravel6 é…åˆ Maatwebsite\\Excel å®ç° Excel å¯¼å‡º é™†ç»­è¡¥å……ä¸­â€¦","tags":["Laravel"],"categories":["PHP"]},{"title":"æœ€è¿‘ä½¿ç”¨ginçš„æ€»ç»“","path":"/2020/07/20/261/","content":"æœ€è¿‘æœ‰æ–°é¡¹ç›®æ˜¯åˆ©ç”¨ginå¼€å‘çš„ï¼Œè¿‡ç¨‹ä¸­é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œä½œä¸ºç¬”è®°ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚ è·¨åŸŸé—®é¢˜ä¸­é—´ä»¶ï¼š func Cors() gin.HandlerFunc &#123;\treturn func(c *gin.Context) &#123; // è¿™é‡Œå¯ä»¥ç”¨*ï¼Œä¹Ÿå¯ä»¥ç”¨ä½ æŒ‡å®šçš„åŸŸå c.Header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;) // å…è®¸å¤´éƒ¨å‚æ•° c.Header(&quot;Access-Control-Allow-Headers&quot;, &quot;Content-Type,AccessToken,X-CSRF-Token, Authorization, Token&quot;) // å…è®¸çš„æ–¹æ³• c.Header(&quot;Access-Control-Allow-Methods&quot;, &quot;POST, GET, OPTIONS&quot;) c.Header(&quot;Access-Control-Expose-Headers&quot;, &quot;Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Content-Type&quot;) c.Header(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;) method := c.Request.Method //æ”¾è¡ŒOPTIONSæ–¹æ³• if method == &quot;OPTIONS&quot; &#123; c.AbortWithStatus(http.StatusOK) &#125; // å¤„ç†è¯·æ±‚ c.Next()\t&#125;&#125; ç„¶ååœ¨è·¯ç”±ä¸­åŠ å…¥ï¼š // g : *gin.Engineg.Use(Cors()) å½“ç„¶ä¹Ÿå¯ä»¥åœ¨Nginxå±‚é…ç½®ï¼Œå¯è‡ªè¡ŒæŸ¥é˜…ï¼Œæˆ‘å°±ä¸å±•å¼€äº†ã€‚ ä½¿ç”¨å¤šä¸ªä¸­é—´ä»¶// g : *gin.Engineg.Use(Cors())g.Use(Session()) ä¸­é—´ä»¶ç»ˆæ­¢è¯·æ±‚func Auth() gin.HandlerFunc &#123; return func(c *gin.Context) &#123; uid := c.MustGet(&quot;uid&quot;).(int) if uid == 0 &#123; c.Abort() controller.SendResponse(c, 401, &quot;æœªç™»å½•&quot;, nil) // returnå¯å¿½ç•¥ return &#125; else &#123; c.Next() &#125; &#125;&#125; sessionä½¿ç”¨package utilimport (\t&quot;github.com/gin-gonic/gin&quot;\t&quot;github.com/gin-contrib/sessions&quot;\t&quot;github.com/gin-contrib/sessions/Redis&quot;\tRedisGo &quot;github.com/gomodule/redigo/Redis&quot;\t&quot;github.com/spf13/viper&quot;)// å¯åŠ¨sessionfunc SessionStart(g *gin.Engine, RedisClient *RedisGo.Pool, key ...[]byte) &#123;\tstore, _ := Redis.NewStoreWithPool(RedisClient, []byte(viper.GetString(&quot;name&quot;)))\tRedis.SetKeyPrefix(store, &quot;session_&quot;)\tg.Use(sessions.Sessions(viper.GetString(&quot;name&quot;), store))&#125;// ä½¿ç”¨sessionsession := sessions.Default(c)session.Set(&quot;uid&quot;, uid)uid := session.Get(&quot;uid&quot;) ä¸Šä¼ ossimport (\t&quot;os&quot; &quot;github.com/aliyun/aliyun-oss-go-sdk/oss&quot;\t&quot;github.com/spf13/viper&quot;)func upload(localPath string, iType int, Name string) (path string) &#123;\tclient, err := oss.New(viper.GetString(&quot;oss.end_point&quot;), viper.GetString(&quot;oss.access_key_id&quot;), viper.GetString(&quot;oss.access_key_secret&quot;)) if err != nil &#123; return &#125; // è·å–å­˜å‚¨ç©ºé—´ã€‚ bucket, err := client.Bucket(viper.GetString(&quot;oss.bucket&quot;)) if err != nil &#123; return &#125; // ä¸Šä¼ æœ¬åœ°æ–‡ä»¶ã€‚\tossPath := fmt.Sprintf(&quot;%s/%s&quot;, &quot;qiling&quot;, Name) err = bucket.PutObjectFromFile(ossPath, localPath) if err != nil &#123; return &#125; path = fmt.Sprintf(&quot;%s/%s&quot;, viper.GetString(&quot;oss.hosts&quot;), ossPath)\tos.Remove(localPath)\treturn&#125; å‡ ä¸ªå®ç”¨çš„æ–¹æ³•import (\t&quot;fmt&quot;\t&quot;crypto/md5&quot;\t&quot;bytes&quot;\t&quot;regexp&quot;)// md5func Md5(str string) string &#123;\treturn fmt.Sprintf(&quot;%x&quot;, md5.Sum([]byte(str)));&#125;// åˆ¤æ–­æ˜¯ä¸æ˜¯çœŸå®æ‰‹æœºå·ç func IsMobile(mobile string) bool &#123; result, _ := regexp.MatchString(`^(1\\d&#123;10&#125;)$`, mobile) if result &#123; return true &#125; else &#123; return false &#125;&#125;// åˆå¹¶å­—ç¬¦ä¸²func StrCombine(str ...string) string &#123;\tvar bt bytes.Buffer\tfor _, arg := range str &#123; bt.WriteString(arg) &#125;\t//è·å¾—æ‹¼æ¥åçš„å­—ç¬¦ä¸²\treturn bt.String()&#125; å¤§æ¦‚å°±è¿™äº›äº†ï¼Œåé¢æœ‰å¯ä»¥åˆ†æçš„å†è¡¥å……ã€‚","tags":["gin"],"categories":["go"]},{"title":"ä½¿ç”¨vue-element-adminçš„ä¸€äº›æ€»ç»“","path":"/2020/07/14/262/","content":"æœ€è¿‘å¼€å‘çš„é¡¹ç›®åå°åŸºäºvue-element-adminå¼€å‘ï¼Œåœ¨é€æ­¥å®Œå–„çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç‰¹æ­¤æ€»ç»“ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ å…ˆä¸Šé“¾æ¥ï¼ŒçœŸçš„å¾ˆå¥½ç”¨ï¼Œå®‰åˆ©ä¸€ä¸‹ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š A magical vue admin åŸºæœ¬ä¸Šå¸¸ç”¨çš„ä¸å¸¸ç”¨çš„åŠŸèƒ½éƒ½æœ‰ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œæœ‰å…´è¶£é“¾æ¥ç›´è¾¾ï¼Œæ­£å¼å¼€å§‹æ­£æ–‡ã€‚ ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡å®˜æ–¹çš„svgå›¾æ ‡ç¡®å®æ¯”è¾ƒå°‘ï¼Œæ·»åŠ æˆ‘ä¹Ÿè§‰å¾—ç¹çï¼Œå¦å¤–ï¼Œæ—¢ç„¶é›†æˆäº†elementUIï¼Œç›´æ¥ç”¨elementUIå›¾æ ‡å°±å¥½äº†ã€‚ æ”¹ï¼š ä¿®æ”¹èœå•iconä¸ºelementUIå›¾æ ‡ï¼š// æ–‡ä»¶åœ°å€ï¼šsrc\\layout\\components\\Sidebar\\Item.vue// if (icon) &#123;// vnodes.push(&lt;svg-icon icon-class=&#123;icon&#125;/&gt;)// &#125;if (icon) &#123; vnodes.push(&lt;i class=&#123;icon&#125;&gt;&lt;/i&gt;)&#125; å…³é—­eslintå®˜ç½‘å·²æœ‰ç­”æ¡ˆ // vue.config.jslintOnSave: false butï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯gitç®¡ç†ä»£ç ï¼Œä¼šå‘ç°commitçš„æ—¶å€™ä¾æ—§ä¼šè§¦å‘eslintã€‚ // package.json &quot;lint-staged&quot;: &#123; &quot;src/**/*.&#123;js,vue&#125;&quot;: [ &quot;eslint --fix&quot;, // åˆ é™¤è¿™ä¸€è¡Œ &quot;git add&quot; ] &#125;, å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡// package.json &quot;scripts&quot;: &#123; &quot;local&quot;: &quot;vue-cli-service serve --mode local&quot;, ... &#125;, å¤åˆ¶.env.productionä¸º.env.localï¼Œè‡ªå®šä¹‰é…ç½®åï¼Œè¿è¡Œï¼š yarn run local ç¼“å­˜é¡µé¢æƒ³ç¼“å­˜çš„é¡µé¢ï¼š &lt;script&gt;export default &#123; name: &quot;cacheIndex&quot;, åŠ å…¥cachedViews // src\\store\\modules\\tagsView.jsconstÂ stateÂ =Â &#123; visitedViews:Â [], cachedViews:Â [ &#x27;cacheIndex&#x27; ]&#125; æœ€è¿‘å¼€å‘çš„é¡¹ç›®åå°åŸºäºvue-element-adminå¼€å‘ï¼Œåœ¨é€æ­¥å®Œå–„çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œç‰¹æ­¤æ€»ç»“ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ å…ˆä¸Šé“¾æ¥ï¼ŒçœŸçš„å¾ˆå¥½ç”¨ï¼Œå®‰åˆ©ä¸€ä¸‹ï¼Œé“¾æ¥å¦‚ä¸‹ï¼š A magical vue admin åŸºæœ¬ä¸Šå¸¸ç”¨çš„ä¸å¸¸ç”¨çš„åŠŸèƒ½éƒ½æœ‰ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œæœ‰å…´è¶£é“¾æ¥ç›´è¾¾ï¼Œæ­£å¼å¼€å§‹æ­£æ–‡ã€‚ ä¿®æ”¹èœå•å›¾æ ‡ä¸ºelementUIå›¾æ ‡å®˜æ–¹çš„svgå›¾æ ‡ç¡®å®æ¯”è¾ƒå°‘ï¼Œæ·»åŠ æˆ‘ä¹Ÿè§‰å¾—ç¹çï¼Œå¦å¤–ï¼Œæ—¢ç„¶é›†æˆäº†elementUIï¼Œç›´æ¥ç”¨elementUIå›¾æ ‡å°±å¥½äº†ã€‚ æ”¹ï¼š ä¿®æ”¹èœå•iconä¸ºelementUIå›¾æ ‡ï¼š// æ–‡ä»¶åœ°å€ï¼šsrc\\layout\\components\\Sidebar\\Item.vue// if (icon) &#123;// vnodes.push(&lt;svg-icon icon-class=&#123;icon&#125;/&gt;)// &#125;if (icon) &#123; vnodes.push(&lt;i class=&#123;icon&#125;&gt;&lt;/i&gt;)&#125; å…³é—­eslintå®˜ç½‘å·²æœ‰ç­”æ¡ˆ // vue.config.jslintOnSave: false butï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯gitç®¡ç†ä»£ç ï¼Œä¼šå‘ç°commitçš„æ—¶å€™ä¾æ—§ä¼šè§¦å‘eslintã€‚ // package.json &quot;lint-staged&quot;: &#123; &quot;src/**/*.&#123;js,vue&#125;&quot;: [ &quot;eslint --fix&quot;, // åˆ é™¤è¿™ä¸€è¡Œ &quot;git add&quot; ] &#125;, å¢åŠ æœ¬åœ°ç¯å¢ƒå˜é‡// package.json &quot;scripts&quot;: &#123; &quot;local&quot;: &quot;vue-cli-service serve --mode local&quot;, ... &#125;, å¤åˆ¶.env.productionä¸º.env.localï¼Œè‡ªå®šä¹‰é…ç½®åï¼Œè¿è¡Œï¼š yarn run local ç¼“å­˜é¡µé¢æƒ³ç¼“å­˜çš„é¡µé¢ï¼š &lt;script&gt;export default &#123; name: &quot;cacheIndex&quot;, åŠ å…¥cachedViews // src\\store\\modules\\tagsView.jsconstÂ stateÂ =Â &#123; visitedViews:Â [], cachedViews:Â [ &#x27;cacheIndex&#x27; ]&#125;","tags":["ElementUI"],"categories":["vue"]},{"title":"åˆ©ç”¨ElementUIçš„tableå’Œcalendaråˆ¶ä½œä¸€ä¸ªä»·æ ¼æ—¥å†","path":"/2020/05/04/250/","content":"é¡¹ç›®ä¸­éœ€è¦åšä¸€ä¸ªä»·æ ¼æ—¥å†ï¼Œä¾¿äºå±•ç¤ºå’Œä¿®æ”¹æ—¥æœŸä»·æ ¼ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹æœ€ç»ˆæ•ˆæœï¼Œç„¶ååˆ©ç”¨ElementUIçš„table å’Œ calendar å®ç°ä¸€ä¸‹ã€‚ æ¥çœ‹çœ‹ä¸»è¦ä»£ç ï¼ˆä»£ç ä»…ä¿ç•™äº†ä¸»è¦ä»£ç å’Œå±æ€§ï¼Œå¹¶ä¸å®Œæ•´ï¼Œå¯ä»¥è‡ªè¡Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ï¼š &lt;template&gt; &lt;div class=&quot;calendar-list-container&quot;&gt; &lt;!--expand-row-keysè®¾ç½®äº†row-keyä¹Ÿè¦è®¾ç½®ï¼Œ\texpand-change\tå½“ç”¨æˆ·å¯¹æŸä¸€è¡Œå±•å¼€æˆ–è€…å…³é—­çš„æ—¶å€™ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼ˆå±•å¼€è¡Œæ—¶ï¼Œå›è°ƒçš„ç¬¬äºŒä¸ªå‚æ•°ä¸º expandedRowsï¼›æ ‘å½¢è¡¨æ ¼æ—¶ç¬¬äºŒå‚æ•°ä¸º expandedï¼‰\trow, (expandedRows | expanded)--&gt; &lt;el-table ref=&quot;table&quot; key=&quot;id&quot; v-loading=&quot;listLoading&quot; :data=&quot;list&quot; element-loading-text=&quot;loading&quot; row-key=&quot;id&quot; :expand-row-keys=&quot;expands&quot; @expand-change=&quot;expandChange&quot; &gt; &lt;el-table-column align=&quot;center&quot; type=&quot;expand&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;!--ä»·æ ¼æ—¥å†æ¸²æŸ“ --&gt; &lt;el-calendar v-loading=&quot;calendarLoad&quot; element-loading-text=&quot;loading&quot; &gt; &lt;template slot=&quot;dateCell&quot; slot-scope=&quot;&#123;date, data&#125;&quot; &gt; &lt;!--ä»Šæ—¥åŠä¹‹åçš„ä»·æ ¼å¯è®¾ç½®setPrice --&gt; &lt;div :class=&quot;nowDay &lt;= data.day.replace(/-/g, &#x27;&#x27;)? &#x27;calendar-div&#x27; : &#x27;calendar-div calendar-prev&#x27;&quot; @click=&quot;nowDay &lt;= data.day.replace(/-/g, &#x27;&#x27;) &amp;&amp; setPrice(data, date)&quot; &gt; &lt;div&gt;&#123;&#123; data.day.slice(-2) &#125;&#125;&lt;/div&gt; &lt;div v-if=&quot;data.type == &#x27;current-month&#x27; &amp;&amp; refreshPrice(data)&quot; class=&quot;price &quot; &gt; é¢„è®¢ä»·ï¼š&#123;&#123; priceList[data.day.slice(-2) -1] &#125;&#125;å…ƒ &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;/el-calendar&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;åç§°&quot; class-name=&quot;overflow-on&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &#123;&#123; scope.row.name &#125;&#125; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;å›¾ç‰‡&quot; width=&quot;210&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;img :src=&quot;scope.row.imageList[0]&quot; style=&quot;width:150px&quot; &gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;ä»Šæ—¥ä»·æ ¼&quot; max-width=&quot;200&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;span&gt;&#123;&#123; scope.row.price &#125;&#125;&lt;/span&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;åŸä»·&quot; max-width=&quot;200&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;span&gt;&#123;&#123; scope.row.original_price &#125;&#125;&lt;/span&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;el-table-column align=&quot;center&quot; label=&quot;æ“ä½œ&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &lt;el-button type=&quot;primary&quot; @click=&quot;handleCheck(scope.row)&quot; &gt; ä»·æ ¼è®¾ç½® &lt;/el-button&gt; &lt;/template&gt; &lt;/el-table-column&gt; &lt;/el-table&gt; &lt;el-dialog title=&quot;è®¾ç½®ä»·æ ¼&quot; :visible.sync=&quot;dialogPriceVisible&quot; &gt; &lt;el-form class=&quot;small-space&quot; :model=&quot;temp&quot; label-position=&quot;left&quot; label-width=&quot;100px&quot; style=&quot;width: 500px; margin-left:50px;&quot; &gt; &lt;el-form-item label=&quot;åç§°&quot;&gt; &lt;el-input v-model=&quot;temp.name&quot; disabled /&gt; &lt;/el-form-item&gt; &lt;el-form-item label=&quot;æ—¶é—´æ®µ&quot;&gt; &lt;el-date-picker v-model=&quot;temp.date&quot; type=&quot;daterange&quot; range-separator=&quot;è‡³&quot; start-placeholder=&quot;å¼€å§‹æ—¥æœŸ&quot; end-placeholder=&quot;ç»“æŸæ—¥æœŸ&quot; :picker-options=&quot;pickerBeginDateBefore&quot; /&gt; &lt;/el-form-item&gt; &lt;el-form-item label=&quot;åˆ†æ—¶è®¡ä»·&quot; prop=&quot;is_part&quot; required &gt; &lt;el-radio v-model=&quot;temp.is_part&quot; :label=&quot;0&quot; &gt; ä¸åˆ†å¹³æ—¶å‘¨æœ« &lt;/el-radio&gt; &lt;el-radio v-model=&quot;temp.is_part&quot; :label=&quot;1&quot; &gt; åŒºåˆ†å‘¨æœ« &lt;/el-radio&gt; &lt;/el-form-item&gt; &lt;el-form-item label=&quot;å¹³æ—¶ä»·&quot;&gt; &lt;el-input v-model=&quot;temp.normal_price&quot; /&gt; &lt;/el-form-item&gt; &lt;el-form-item v-if=&quot;temp.is_part == 1&quot; label=&quot;å‘¨æœ«ä»·&quot; &gt; &lt;el-input v-model=&quot;temp.week_price&quot; /&gt; &lt;/el-form-item&gt; &lt;/el-form&gt; &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot; &gt; &lt;el-button @click=&quot;dialogPriceVisible = false&quot;&gt; å– æ¶ˆ &lt;/el-button&gt; &lt;el-button type=&quot;primary&quot; @click=&quot;putPrice&quot; &gt; ç¡® å®š &lt;/el-button&gt; &lt;/div&gt; &lt;/el-dialog&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import &#123; fetchList, setRoomPrice, getRoomPrice &#125; from &quot;@/api&quot;;import moment from &#x27;moment&#x27;;export default &#123; name: &quot;room&quot;, data() &#123; return &#123; pickerBeginDateBefore:&#123; disabledDate(time) &#123; return time.getTime() &lt; Date.now() - 86400*1000; &#125; &#125;, schedule: [], list: [], dialogPriceVisible: false, dialogFormVisible: false, priceDate: &#x27;2020-01-01&#x27;, nowDate: 1, nowMonth: 1, nowDay: 0, nowYear: 2020, calendarMonth: 1, priceList: [], expands: [],//åªå±•å¼€ä¸€è¡Œæ”¾å…¥å½“å‰è¡Œid room: &#123;&#125;, listLoading:false, calendarLoad: false, &#125;; &#125;, created() &#123; this.priceDate = new Date(); this.nowDate = this.priceDate.getDate(); this.nowMonth = this.priceDate.getMonth(); this.calendarMonth = this.nowMonth; this.nowYear = this.priceDate.getFullYear(); this.nowDay = this.priceDate.getFullYear()*10000+ (1+this.priceDate.getMonth())*100+ this.priceDate.getDate(); &#125;, methods: &#123; refreshPrice (data) &#123; // console.log(data); if (!data.isSelected) &#123; return true; &#125; if (data.day.slice(5, 7) == this.calendarMonth + 1) &#123; return true; &#125; this.calendarMonth = data.day.slice(5, 7) - 1; var that = this; getRoomPrice(that.room.id, &#123;&#x27;date&#x27;: data.day&#125;).then(response =&gt; &#123; var arr = []; response.data.priceList.forEach((item,index,array)=&gt;&#123; arr[index] = item? item : that.room.price; &#125;) that.priceList = arr &#125;); that.$forceUpdate() &#125;, getRowKeys(row) &#123; // console.log(row.id) return row.id //è¿™é‡Œçœ‹è¿™ä¸€è¡Œä¸­éœ€è¦æ ¹æ®å“ªä¸ªå±æ€§å€¼æ˜¯id &#125;, selectDate(type) &#123; // consoloe.log(type) &#125;, expandChange(row, expandedRows) &#123; // console.log(this.expands) var that = this; that.room = row; // æ¯æ¬¡åªå±•å¼€ä¸€è¡Œ if (expandedRows.length) &#123; that.calendarLoad = true; getRoomPrice(row.id, &#123;&#x27;date&#x27;: this.priceDate&#125;).then(response =&gt; &#123; that.calendarLoad = false; var arr = []; response.data.priceList.forEach((item,index,array)=&gt;&#123; arr[index] = item? item : row.price; &#125;) that.priceList = arr that.expands = [row.id] &#125;); &#125; else &#123; // æ”¶èµ·ä»·æ ¼æ—¥å† that.expands = [] &#125; &#125;, setPrice(data, date) &#123; if (this.nowDay &gt; data.day.replace(/-/g, &#x27;&#x27;)) &#123; return false; &#125; var that = this; this.temp = &#123; name: that.room.name, date: [date, date], is_part: 0, &#125;; this.dialogPriceVisible = true; &#125;, putPrice() &#123; this.dialogPriceVisible = true; setRoomPrice(this.room.id, this.temp).then(res =&gt; &#123; if (res.code == 0) &#123; this.$message.success(&quot;ç¼–è¾‘æˆåŠŸ&quot;); this.dialogPriceVisible = !this.dialogPriceVisible; var that = this; getRoomPrice(that.room.id, &#123;&#x27;date&#x27;: this.temp.date[0]&#125;).then(response =&gt; &#123; var arr = []; response.data.priceList.forEach((item,index,array)=&gt;&#123; arr[index] = item? item : that.room.price; &#125;) that.priceList = arr &#125;); fetchList(that.params).then(response =&gt; &#123; that.list = response.data; &#125;); that.resetTemp(); that.$forceUpdate() &#125; else &#123; this.$message.error(res.msg); &#125; &#125;); &#125;,\t// ç”¨äºå¯å±•å¼€è¡¨æ ¼ä¸æ ‘å½¢è¡¨æ ¼ï¼Œåˆ‡æ¢æŸä¸€è¡Œçš„å±•å¼€çŠ¶æ€ï¼Œå¦‚æœä½¿ç”¨äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™æ˜¯è®¾ç½®è¿™ä¸€è¡Œå±•å¼€ä¸å¦ï¼ˆexpanded ä¸º true åˆ™å±•å¼€ï¼‰ handleCheck(row) &#123; const $table = this.$refs.table $table.toggleRowExpansion(row) &#125; &#125;&#125;;&lt;/script&gt; ä»·æ ¼æ—¥å†è¿”å›æ•°æ®æ ¼å¼ï¼š &#123;\t&quot;status&quot;: &quot;success&quot;,\t&quot;code&quot;: 0,\t&quot;msg&quot;: &quot;æ“ä½œæˆåŠŸ&quot;,\t&quot;data&quot;: &#123; &quot;room&quot;: &#123; &quot;name&quot;: &quot;å¤§åºŠæˆ¿&quot;, &quot;price&quot;: 299, &quot;original_price&quot;: 289 &#125;, &quot;priceList&quot;: [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, 209, 219, false, false, false, false, false],\t&#125;&#125; priceListæ˜¯æœ¬æœˆä»·æ ¼ï¼Œfalseè¡¨ç¤ºæœªè®¾ç½®ã€‚ tableçš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œéƒ¨åˆ†å±æ€§å‡½æ•°å¹¶ä¸å¸¸ç”¨ï¼Œå¯ä»¥è‡ªè¡Œæ‰“å°å‡ºæ¥çœ‹çœ‹ï¼Œç ”ç©¶ä¸€ä¸‹å³å¯ã€‚calendaræ˜¯2.8ç‰ˆæœ¬æ–°å¢çš„ç»„ä»¶ï¼Œå¦‚æœç‰ˆæœ¬è¿‡ä½ï¼Œå¯ä»¥å°è¯•å‡çº§åˆ°æ–°ç‰ˆæœ¬ã€‚","tags":["ElementUI"],"categories":["vue"]},{"title":"åˆ©ç”¨Laravelä¸­é—´ä»¶ç»™åå°åŠ ä¸ªæ“ä½œæ—¥å¿—","path":"/2020/04/29/248/","content":"é¡¹ç›®åå°è§’è‰²åŠäººå‘˜å˜å¤šï¼Œéœ€è¦åŠ ä¸‹æ—¥å¿—ï¼Œæ–¹ä¾¿æŸ¥è¯¢ï¼Œä¸å¦¨åˆ©ç”¨ä¸­é—´ä»¶å®ç°ä¸‹ã€‚ æ–¹æ¡ˆï¼š ä¸­é—´ä»¶åˆ¤æ–­æ˜¯å¦éœ€è¦è®°å½•ï¼Œå†™å…¥é˜Ÿåˆ— é˜Ÿåˆ—å†™å…¥æ•°æ®åº“ è¡¨è®¾è®¡ CREATE TABLE `admin_log` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `user_id` int(11) NOT NULL, `path` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `method` varchar(10) COLLATE utf8mb4_unicode_ci NOT NULL, `ip` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL, `input` text COLLATE utf8mb4_unicode_ci NOT NULL, `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC; æ–°å»ºä¸­é—´ä»¶AdminLogMiddlewareï¼Œåœ¨åå°è·¯ç”±ä¸­åŠ å…¥æ­¤ä¸­é—´ä»¶å³å¯ï¼Œ &lt;?php/** * Author: sai * Date: 2020/4/1 * Time: 16:19 */namespace App\\Http\\Middleware;use App\\Jobs\\OperationLogJob;use Closure;use Auth;class AdminLogMiddleware&#123; /** * å¤„ç†ä¼ å…¥çš„å‚æ•° * * @param \\Illuminate\\Http\\Request $request * @param \\Closure $next * @param string $role * @return mixed */ public function handle($request, Closure $next, $role) &#123; // å‰”é™¤GETï¼ŒOPTIONSè¯·æ±‚ if (!in_array($method = $request-&gt;getMethod(), [&#x27;GET&#x27;, &#x27;OPTIONS&#x27;])) &#123; $data = [ &#x27;user_id&#x27; =&gt; Auth::guard(&#x27;admin&#x27;)-&gt;id(), &#x27;path&#x27; =&gt; $request-&gt;getPathInfo(), &#x27;method&#x27; =&gt; $method, &#x27;ip&#x27; =&gt; $request-&gt;getClientIp(), &#x27;input&#x27; =&gt; \\json_encode($request-&gt;all(), JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_QUOT | JSON_HEX_AMP | JSON_UNESCAPED_UNICODE), ]; // å¼‚æ­¥å†™å…¥ï¼Œæé«˜æ“ä½œæµç•…æ€§ $job = (new OperationLogJob($data)); dispatch($job); &#125; return $next($request); &#125;&#125; &lt;?phpnamespace App\\Jobs;use App\\Models\\AdminLog;use Illuminate\\Bus\\Queueable;use Illuminate\\Contracts\\Queue\\ShouldQueue;use Illuminate\\Foundation\\Bus\\Dispatchable;use Illuminate\\Queue\\InteractsWithQueue;use Illuminate\\Queue\\SerializesModels;class OperationLogJob implements ShouldQueue&#123; use Dispatchable, InteractsWithQueue, Queueable, SerializesModels; /** * Create a new job instance. * * @return void */ public function __construct($data) &#123; // $this-&gt;queue = &#x27;adminLog&#x27;; $this-&gt;data = $data; &#125; private $data; /** * Execute the job. * * @return void */ public function handle() &#123; // AdminLog::create($this-&gt;data); &#125;&#125; æ‰§è¡Œé˜Ÿåˆ—ï¼š php artisan queue:work --queue=adminLog å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸å†™å…¥æ•°æ®åº“ï¼Œå†™åœ¨logæ–‡ä»¶é‡Œï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚ å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œä¹Ÿå¯ä»¥ç»™åå°ç»Ÿä¸€åŠ å…¥AdminLogMiddlewareä¸­é—´ä»¶ï¼ŒæŠŠä¸éœ€è¦åšè®°å½•çš„è·¯ç”±åŠ å…¥é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸­é—´ä»¶åŠ å…¥åˆ¤æ–­ï¼Œçœå»åœ¨è·¯ç”±é…ç½®å»åŒºåˆ†æ˜¯å¦éœ€è¦è®°å½•ã€‚","tags":["Laravel"],"categories":["PHP"]},{"title":"ElementUIä¸­tableè¡¨æ ¼è‡ªå®šä¹‰è¡¨å¤´Tooltipæ–‡å­—æç¤º","path":"/2020/04/29/247/","content":"tableè¡¨æ ¼éœ€è¦å¢åŠ æç¤ºæ–‡æ¡ˆè¯´æ˜ï¼Œæ²¡æœ‰ç°æˆçš„å±æ€§æ·»åŠ ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡render-headeræ¥æ¸²æŸ“è¡¨å¤´ã€‚ ä»£ç å¦‚ä¸‹ï¼š &lt;el-table-column align=&quot;center&quot; label=&quot;ä»·æ ¼&quot; :render-header=&quot;renderTipsHeader&quot; &gt; &lt;template slot-scope=&quot;scope&quot;&gt; &#123;&#123; scope.row.amount &#125;&#125; &lt;/template&gt;&lt;/el-table-column&gt; renderTipsHeaderï¼š renderTipsHeader (h,&#123;column&#125;) &#123; return h( &#x27;div&#x27;,[ h(&#x27;span&#x27;, column.label), h(&#x27;el-tooltip&#x27;,&#123; props:&#123; effect:&#x27;dark&#x27;, content:&#x27;æç¤ºæ–‡æ¡ˆ&#x27;, placement:&#x27;top&#x27; &#125;, &#125;,[ h(&#x27;i&#x27;, &#123; class:&#x27;el-icon-question&#x27;, style:&#x27;color:#409EFF;margin-left:5px;&#x27; &#125;) ]) ] ); &#125; æ•ˆæœå¦‚å›¾ï¼š render-header åˆ—æ ‡é¢˜ Label åŒºåŸŸæ¸²æŸ“ä½¿ç”¨çš„ Function Function(h, &#123; column, $index &#125;) æ„Ÿå…´è¶£å¯ä»¥æ‰“å°å‡ºæ¥çœ‹çœ‹ï¼Œè¿™é‡Œè¿˜æœ‰æ›´å¤æ‚çš„åº”ç”¨â€“https://github.com/Darkerxi/ElementUI-Table-column_render-header å‚è€ƒæ–‡ç« ï¼šelement-uiè‡ªå®šä¹‰tableè¡¨å¤´ï¼Œä¿®æ”¹æ ‡é¢˜æ ·å¼ã€æ·»åŠ tooltipåŠ :render-headerä½¿ç”¨ç®€ä»‹","tags":["ElementUI"],"categories":["vue"]},{"title":"åˆ†äº«æŒ‰æ—¥æ‰§è¡Œçš„è„šæœ¬","path":"/2020/04/25/246/","content":"é¡¹ç›®ä¸­è¦åšä¸€äº›æŒ‰æ—¥è¿›è¡Œçš„ç»Ÿè®¡ï¼Œä¹‹å‰çš„ä»»åŠ¡éƒ½æ²¡è·‘ï¼Œå†™ä¸ªè„šæœ¬æ‰§è¡Œä¸‹ã€‚ plus.sh #!/bin/bashSTART_DATE=$1END_DATE=$2EXEC_COMMAND=$3echo &#x27;start_date: &#x27;$START_DATEecho &#x27;end_date: &#x27;$END_DATEi=$START_DATEwhile [[ $i &lt; `date -d &quot;+1 day $END_DATE&quot; +%Y%m%d` ]] do echo $i $EXEC_COMMAND $i i=`date -d &quot;+1 day $i&quot; +%Y%m%d`done æ‰§è¡Œ ./plus.sh 2020-03-01 2020-04-24 â€˜php artisan command:testâ€™","tags":["shell"],"categories":["shell"]},{"title":"Laravelé…åˆMaatwebsiteExcelå®ç°Excelå¯¼å…¥","path":"/2020/04/05/245/","content":"å‰ä¸€æ®µéœ€è¦é¡¹ç›®ä¸­éœ€è¦é€šè¿‡Excelå¯¼å…¥ç”¨æˆ·ï¼Œä¹‹å‰ç”¨è¿‡phpexcelï¼Œæ€»æ„Ÿè§‰å¤ªè¿‡ç¹çï¼Œå°è±¡ä¸­phpexcelä¹Ÿå¾ˆä¹…æ²¡æ›´æ–°ï¼Œçœ‹åˆ°é¡¹ç›®ä¸­æœ‰ä½¿ç”¨Maatwebsite\\Excelï¼Œä¾¿å°è¯•ä½¿ç”¨ä¸€ä¸‹ã€‚ å®‰è£…composer require maatwebsite/excel å¯¼å…¥ç”Ÿæˆå¯¼å…¥ç±»php artisan make:import AdminsImport --model=Admin ä¼šçœ‹åˆ°appä¸‹é¢ç”Ÿæˆäº†Importsæ–‡ä»¶å¤¹ã€‚ å®Œå–„ä¸šåŠ¡é€»è¾‘&lt;?phpnamespace App\\Imports;use App\\Models\\Admin;use function EasyWeChat\\Kernel\\Support\\str_random;use Maatwebsite\\Excel\\Concerns\\ToModel;class AdminsImport implements ToModel&#123; /** * @param array $row * * @return \\Illuminate\\Database\\Eloquent\\Model|null */ public function model(array $row) &#123; //è¿‡æ»¤è¡¨å¤´å’Œç©ºè¡Œï¼Œæˆ‘è¿™è¾¹è¡¨å¤´çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼æ˜¯idï¼Œå…·ä½“è‡ªè¡Œè°ƒæ•´ if (empty($row[0]) || $row[0] == &#x27;id&#x27;) &#123; return null; &#125; return new Admin([ &#x27;username&#x27; =&gt; $row[2], &#x27;password&#x27; =&gt; bcrypt($row[3]), &#x27;api_token&#x27; =&gt; str_random(60), ]); &#125;&#125; å¯¼å…¥ä»»åŠ¡&lt;?phpnamespace App\\Console\\Commands;use App\\Imports\\AdminsImport;use Illuminate\\Console\\Command;use Maatwebsite\\Excel\\Facades\\Excel;class ImportAdmin extends Command&#123; /** * The name and signature of the console command. * * @var string */ protected $signature = &#x27;importAdmin&#x27;; /** * The console command description. * * @var string */ protected $description = &#x27;å¯¼å…¥admin&#x27;; /** * Create a new command instance. * * @return void */ public function __construct() &#123; parent::__construct(); &#125; /** * Execute the console command. * * @return mixed */ public function handle() &#123; Excel::import(new AdminsImport(), storage_path(&#x27;files/export.xlsx&#x27;)); $this-&gt;info($this-&gt;description.&#x27;å®Œæˆ&#x27;);\t&#125;&#125; å…¶ä»–é€»è¾‘å½“ç„¶ï¼Œå¯èƒ½ä¸šåŠ¡å¿…ä¸ä»…ä»…æ˜¯å†™å…¥æ•°æ®ï¼Œå¯èƒ½æœ‰ä¸€äº›è®¾è®¡å…·ä½“ä¸šåŠ¡çš„æ“ä½œï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·æ“ä½œã€‚ &lt;?phpnamespace App\\Imports;use App\\Models\\Admin;use function EasyWeChat\\Kernel\\Support\\str_random;use Maatwebsite\\Excel\\Concerns\\ToCollection;use Illuminate\\Support\\Collection;class AdminsImport implements ToCollection&#123; public function collection(Collection $rows) &#123; //å¦‚æœéœ€è¦å»é™¤è¡¨å¤´ unset($rows[0]); //$rows æ˜¯æ•°ç»„æ ¼å¼ return $this-&gt;createData($rows); &#125; public function createData($rows) &#123; $success = 0; foreach ($rows as $row) &#123; $row[0] = (int) $row[0]; if (empty($row[0])) &#123; continue; &#125; (new Admin())-&gt;create( [ &#x27;username&#x27; =&gt; $row[2], &#x27;name&#x27; =&gt; $row[2], &#x27;password&#x27; =&gt; bcrypt($row[3]), &#x27;api_token&#x27; =&gt; str_random(60), ] ); // å…¶ä»–ä¸šåŠ¡ä»£ç  $success++; &#125; return $success.&#x27;-&#x27;.count($rows); &#125;&#125; æ‰§è¡Œphp7.2 artisan importAdmin æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨èµ·æ¥è¿˜æ˜¯ç®€å•æ˜äº†çš„ã€‚ moreå…·ä½“å¯¼å…¥å®ç°å¯ä»¥æœç´¢Maatwebsite\\Excel\\ExcelæŸ¥çœ‹ï¼Œé‡Œé¢è¿˜æœ‰å¯¼å‡ºã€ä»¥é˜Ÿåˆ—æ–¹å¼å¯¼å…¥ç­‰ï¼Œæ”¯æŒçš„æ ¼å¼ä¹Ÿæ˜¯å¤šç§å¤šæ ·ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼ŒåŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œè¶³å¤Ÿåº”ä»˜æ—¥å¸¸éœ€æ±‚äº†ã€‚ &lt;?phpnamespace Maatwebsite\\Excel;use Illuminate\\Support\\Collection;use Maatwebsite\\Excel\\Files\\Filesystem;use Maatwebsite\\Excel\\Files\\TemporaryFile;use Illuminate\\Contracts\\Queue\\ShouldQueue;use Illuminate\\Foundation\\Bus\\PendingDispatch;use Maatwebsite\\Excel\\Helpers\\FileTypeDetector;class Excel implements Exporter, Importer&#123; use RegistersCustomConcerns; const XLSX = &#x27;Xlsx&#x27;; const CSV = &#x27;Csv&#x27;; const TSV = &#x27;Csv&#x27;; const ODS = &#x27;Ods&#x27;; const XLS = &#x27;Xls&#x27;; const SLK = &#x27;Slk&#x27;; const XML = &#x27;Xml&#x27;; const GNUMERIC = &#x27;Gnumeric&#x27;; const HTML = &#x27;Html&#x27;; const MPDF = &#x27;Mpdf&#x27;; const DOMPDF = &#x27;Dompdf&#x27;; const TCPDF = &#x27;Tcpdf&#x27;; /** * @var Writer */ protected $writer; /** * @var QueuedWriter */ protected $queuedWriter; /** * @var Filesystem */ protected $filesystem; /** * @var Reader */ private $reader; /** * @param Writer $writer * @param QueuedWriter $queuedWriter * @param Reader $reader * @param Filesystem $filesystem */ public function __construct( Writer $writer, QueuedWriter $queuedWriter, Reader $reader, Filesystem $filesystem ) &#123; $this-&gt;writer = $writer; $this-&gt;reader = $reader; $this-&gt;filesystem = $filesystem; $this-&gt;queuedWriter = $queuedWriter; &#125; /** * &#123;@inheritdoc&#125; */ public function download($export, string $fileName, string $writerType = null, array $headers = []) &#123; return response()-&gt;download( $this-&gt;export($export, $fileName, $writerType)-&gt;getLocalPath(), $fileName, $headers )-&gt;deleteFileAfterSend(true); &#125; /** * &#123;@inheritdoc&#125; */ public function store($export, string $filePath, string $diskName = null, string $writerType = null, $diskOptions = []) &#123; if ($export instanceof ShouldQueue) &#123; return $this-&gt;queue($export, $filePath, $diskName, $writerType, $diskOptions); &#125; $temporaryFile = $this-&gt;export($export, $filePath, $writerType); $exported = $this-&gt;filesystem-&gt;disk($diskName, $diskOptions)-&gt;copy( $temporaryFile, $filePath ); $temporaryFile-&gt;delete(); return $exported; &#125; /** * &#123;@inheritdoc&#125; */ public function queue($export, string $filePath, string $disk = null, string $writerType = null, $diskOptions = []) &#123; $writerType = FileTypeDetector::detectStrict($filePath, $writerType); return $this-&gt;queuedWriter-&gt;store( $export, $filePath, $disk, $writerType, $diskOptions ); &#125; /** * &#123;@inheritdoc&#125; */ public function raw($export, string $writerType) &#123; $temporaryFile = $this-&gt;writer-&gt;export($export, $writerType); $contents = $temporaryFile-&gt;contents(); $temporaryFile-&gt;delete(); return $contents; &#125; /** * &#123;@inheritdoc&#125; */ public function import($import, $filePath, string $disk = null, string $readerType = null) &#123; $readerType = FileTypeDetector::detect($filePath, $readerType); $response = $this-&gt;reader-&gt;read($import, $filePath, $readerType, $disk); if ($response instanceof PendingDispatch) &#123; return $response; &#125; return $this; &#125; /** * &#123;@inheritdoc&#125; */ public function toArray($import, $filePath, string $disk = null, string $readerType = null): array &#123; $readerType = FileTypeDetector::detect($filePath, $readerType); return $this-&gt;reader-&gt;toArray($import, $filePath, $readerType, $disk); &#125; /** * &#123;@inheritdoc&#125; */ public function toCollection($import, $filePath, string $disk = null, string $readerType = null): Collection &#123; $readerType = FileTypeDetector::detect($filePath, $readerType); return $this-&gt;reader-&gt;toCollection($import, $filePath, $readerType, $disk); &#125; /** * &#123;@inheritdoc&#125; */ public function queueImport(ShouldQueue $import, $filePath, string $disk = null, string $readerType = null) &#123; return $this-&gt;import($import, $filePath, $disk, $readerType); &#125; /** * @param object $export * @param string|null $fileName * @param string $writerType * * @throws \\PhpOffice\\PhpSpreadsheet\\Exception * @return TemporaryFile */ protected function export($export, string $fileName, string $writerType = null): TemporaryFile &#123; $writerType = FileTypeDetector::detectStrict($fileName, $writerType); return $this-&gt;writer-&gt;export($export, $writerType); &#125;&#125; æœ€åï¼Œæ„Ÿè°¢ä¸‹é¢è¿™ä¸€ç¯‡ç«™å†…æ–‡ç« è®©æˆ‘å¿«é€Ÿä¸Šæ‰‹ã€‚ maatwebsite/Excel 3.1 ä½¿ç”¨æ•™ç¨‹ ï¼ˆå¯¼å…¥ç¯‡ï¼‰ æœ€åï¼Œé™„ä¸ŠLaravel Excel æ–‡æ¡£ï¼š Laravel Excel","tags":["Laravel"],"categories":["PHP"]},{"title":"goçš„ç±»å‹è½¬æ¢","path":"/2020/03/29/243/","content":"ç±»å‹è½¬æ¢æ˜¯ç»å¸¸ä½¿ç”¨åˆ°çš„ï¼Œæ±‡æ€»äº†ä¸€äº›æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•ï¼Œåˆ†äº«ç»™ä½ ï½ package main/**\tå˜é‡ç±»å‹è½¬æ¢*/import (\t&quot;fmt&quot;\t&quot;reflect&quot;\t&quot;strconv&quot;)func main() &#123; v := &quot;hello world&quot; fmt.Println(typeofFmt(v))\tfmt.Println(typeofReflect(v))\tstr := &quot;1245&quot;\tfmt.Println(stringToInt(str))\tfmt.Println(stringToInt64(str))\ta := 3545;\tvar b int64;\tb = 98;\tfmt.Println(int64ToString(b))\tfmt.Println(intToString(a))\tvar f float64\tf = 3.45\tfmt.Println(floatToString(f))\tstr = &quot;1.24&quot;\tfmt.Println(stringToFloat(str))\t//intåˆ°int64\tfmt.Println(int64(1234))\t//int è½¬åŒ–ä¸º float\tscore := 100\tfmt.Println(float64(score))&#125;// åˆ©ç”¨fmtfunc typeofFmt(v interface&#123;&#125;) string &#123; return fmt.Sprintf(&quot;%T&quot;, v)&#125;// åˆ©ç”¨reflectfunc typeofReflect(v interface&#123;&#125;) string &#123; return reflect.TypeOf(v).String()&#125;// stringè½¬intfunc stringToInt(a string) int &#123;\td,_ := strconv.Atoi(a)\treturn d&#125;//Atoiæ˜¯ParseInt(s, 10, 0)çš„ç®€å†™ã€‚// stringè½¬int64func stringToInt64(a string) int64 &#123;\td, _ := strconv.ParseInt(a, 10, 64) return d&#125;/**func ParseInt(s string, base int, bitSize int) (i int64, err error)è¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•´æ•°å€¼ï¼Œæ¥å—æ­£è´Ÿå·ã€‚baseæŒ‡å®šè¿›åˆ¶ï¼ˆ2åˆ°36ï¼‰ï¼Œå¦‚æœbaseä¸º0ï¼Œåˆ™ä¼šä»å­—ç¬¦ä¸²å‰ç½®åˆ¤æ–­ï¼Œ&quot;0x&quot;æ˜¯16è¿›åˆ¶ï¼Œ&quot;0&quot;æ˜¯8è¿›åˆ¶ï¼Œå¦åˆ™æ˜¯10è¿›åˆ¶ï¼›bitSizeæŒ‡å®šç»“æœå¿…é¡»èƒ½æ— æº¢å‡ºèµ‹å€¼çš„æ•´æ•°ç±»å‹ï¼Œ0ã€8ã€16ã€32ã€64 åˆ†åˆ«ä»£è¡¨ intã€int8ã€int16ã€int32ã€int64ï¼›è¿”å›çš„erræ˜¯*NumErrç±»å‹çš„ï¼Œå¦‚æœè¯­æ³•æœ‰è¯¯ï¼Œerr.Error = ErrSyntaxï¼›å¦‚æœç»“æœè¶…å‡ºç±»å‹èŒƒå›´err.Error = ErrRangeã€‚*/// intè½¬stringfunc intToString(a int) string &#123;\tstr := strconv.Itoa(a) return str&#125;// int64è½¬stringfunc int64ToString(a int64) string &#123;\tstr := strconv.FormatInt(a,10)\treturn str&#125;/**func FormatInt(i int64, base int) stringè¿”å›içš„baseè¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚base å¿…é¡»åœ¨2åˆ°36ä¹‹é—´ï¼Œç»“æœä¸­ä¼šä½¿ç”¨å°å†™å­—æ¯&#x27;a&#x27;åˆ°&#x27;z&#x27;è¡¨ç¤ºå¤§äº10çš„æ•°å­—ã€‚*/// floatè½¬stringfunc floatToString (f float64) string &#123;\treturn strconv.FormatFloat(f,&#x27;f&#x27;,-1,32)&#125;/**func FormatFloat(f float64, fmt byte, prec, bitSize int) stringbitSizeè¡¨ç¤ºfçš„æ¥æºç±»å‹ï¼ˆ32ï¼šfloat32ã€64ï¼šfloat64ï¼‰ï¼Œä¼šæ®æ­¤è¿›è¡Œèˆå…¥ã€‚fmtè¡¨ç¤ºæ ¼å¼ï¼š&#x27;f&#x27;ï¼ˆ-ddd.ddddï¼‰ã€&#x27;b&#x27;ï¼ˆ-ddddpÂ±dddï¼ŒæŒ‡æ•°ä¸ºäºŒè¿›åˆ¶ï¼‰ã€&#x27;e&#x27;ï¼ˆ-d.ddddeÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€&#x27;E&#x27;ï¼ˆ-d.ddddEÂ±ddï¼Œåè¿›åˆ¶æŒ‡æ•°ï¼‰ã€&#x27;g&#x27;ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨&#x27;e&#x27;æ ¼å¼ï¼Œå¦åˆ™&#x27;f&#x27;æ ¼å¼ï¼‰ã€&#x27;G&#x27;ï¼ˆæŒ‡æ•°å¾ˆå¤§æ—¶ç”¨&#x27;E&#x27;æ ¼å¼ï¼Œå¦åˆ™&#x27;f&#x27;æ ¼å¼ï¼‰ã€‚precæ§åˆ¶ç²¾åº¦ï¼ˆæ’é™¤æŒ‡æ•°éƒ¨åˆ†ï¼‰ï¼šå¯¹&#x27;f&#x27;ã€&#x27;e&#x27;ã€&#x27;E&#x27;ï¼Œå®ƒè¡¨ç¤ºå°æ•°ç‚¹åçš„æ•°å­—ä¸ªæ•°ï¼›å¯¹&#x27;g&#x27;ã€&#x27;G&#x27;ï¼Œå®ƒæ§åˆ¶æ€»çš„æ•°å­—ä¸ªæ•°ã€‚å¦‚æœprec ä¸º-1ï¼Œåˆ™ä»£è¡¨ä½¿ç”¨æœ€å°‘æ•°é‡çš„ã€ä½†åˆå¿…éœ€çš„æ•°å­—æ¥è¡¨ç¤ºfã€‚*/// stringè½¬floatfunc stringToFloat(s string) float64 &#123;\tf,_ := strconv.ParseFloat(s,64)\treturn f&#125;/**func ParseFloat(s string, bitSize int) (f float64, err error)è§£æä¸€ä¸ªè¡¨ç¤ºæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²å¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœsåˆä¹è¯­æ³•è§„åˆ™ï¼Œå‡½æ•°ä¼šè¿”å›æœ€ä¸ºæ¥è¿‘sè¡¨ç¤ºå€¼çš„ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆä½¿ç”¨IEEE754è§„èŒƒèˆå…¥ï¼‰ã€‚bitSizeæŒ‡å®šäº†æœŸæœ›çš„æ¥æ”¶ç±»å‹ï¼Œ32æ˜¯float32ï¼ˆè¿”å›å€¼å¯ä»¥ä¸æ”¹å˜ç²¾ç¡®å€¼çš„èµ‹å€¼ç»™float32ï¼‰ï¼Œ64æ˜¯float64ï¼›è¿”å›å€¼erræ˜¯*NumErrç±»å‹çš„ï¼Œè¯­æ³•æœ‰è¯¯çš„ï¼Œerr.Error=ErrSyntaxï¼›ç»“æœè¶…å‡ºè¡¨ç¤ºèŒƒå›´çš„ï¼Œè¿”å›å€¼fä¸ºÂ±Infï¼Œerr.Error= ErrRangeã€‚*/ æ›´å¤šç±»å‹è½¬æ¢ç›¸å…³å¯æŸ¥çœ‹æ ‡å‡†åº“ï¼š-Â strconv æŠ€æœ¯æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€çˆ±å¥½å†å²çš„ç¨‹åºå‘˜ã€‘ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨ï¼Œè°¢è°¢ï¼","tags":["go"],"categories":["go"]},{"title":"Rediså¸¸ç”¨ç±»å‹åŠåº”ç”¨åœºæ™¯","path":"/2020/03/22/230/","content":"ä¸»è¦ç±»å‹ å­—ç¬¦ä¸²ï¼ˆstringsï¼Œbitmapsï¼‰ æ•£åˆ—ï¼ˆhashesï¼‰ åˆ—è¡¨ï¼ˆlistsï¼‰ é›†åˆï¼ˆsetsï¼‰ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ hyperloglogs å‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰ åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰ Streamï¼ˆ5.0ç‰ˆæœ¬æ–°å¢ï¼‰ å…³äºå‘½ä»¤æˆ‘æ¨èçœ‹è¿™ä¸¤ä¸ªï¼š http://doc.Redisfans.com/ http://www.Redis.cn/commands.html åº”ç”¨åœºæ™¯strings ç¼“å­˜ åˆ†å¸ƒå¼é”ï¼ˆsetnxï¼‰ ç­¾åˆ°ç»Ÿè®¡ï¼ˆsetbitï¼‰ è®¡æ•°ï¼ˆincrï¼‰ hashes ç¼“å­˜ ç”¨æˆ·æ ‡ç­¾ lists é˜Ÿåˆ— sets äº¤é›†å¹¶é›† æ•°æ®å»é‡ zset æ’è¡Œæ¦œ å»¶æ—¶ä»»åŠ¡ é™æµ hyperloglogs uvç»Ÿè®¡ï¼ˆipç»Ÿè®¡ï¼‰ pub/sub å‘å¸ƒè®¢é˜…ï¼ˆä¸æ˜¯ç‰¹åˆ«å¯é ï¼‰ geospatial é™„è¿‘çš„äºº Stream é˜Ÿåˆ— å‘å¸ƒè®¢é˜… å…¶ä»–åˆ©ç”¨äº‹åŠ¡å®ç°ç§’æ€ä»¥phpä»£ç ä¸ºä¾‹ï¼š WATCHå‘½ä»¤å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œã€‚ç›‘æ§ä¸€ç›´æŒç»­åˆ°EXECå‘½ä»¤ï¼ˆäº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯åœ¨EXECä¹‹åæ‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨MULTIå‘½ä»¤åå¯ä»¥ä¿®æ”¹WATCHç›‘æ§çš„é”®å€¼ï¼‰ // åº“å­˜ä¸º5//å®ä¾‹åŒ–Redis$Redis = new Redis();//è¿æ¥$Redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);$key = &#x27;sale&#x27;;$Redis-&gt;setnx($key, 0); // æ­¤é¡¹ä¸é¢„å®šä¹‰äº¦å¯ï¼Œä¿è¯keyå”¯ä¸€å°±è¡Œ$Redis-&gt;watch($key); //ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚$sale_num = $Redis-&gt;get($key);if ($sale_num &gt; 4) &#123;\texit();&#125;$Redis-&gt;multi(); //æ ‡è®°äº‹åŠ¡$Redis-&gt;incr($key); //é”€é‡+1sleep(1); //æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ$ret = $Redis-&gt;exec(); // äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚if ($ret) &#123; // è‡ªå®šä¹‰çš„ä¸€ä¸ªåŸºäºmedooçš„dbclass\tinclude &#x27;db.php&#x27;;\t$db = new db([ &#x27;database_type&#x27; =&gt; &#x27;mysql&#x27;, &#x27;database_name&#x27; =&gt; &#x27;test&#x27;, &#x27;server&#x27; =&gt; &#x27;puresai&#x27;, &#x27;username&#x27; =&gt; &#x27;puresai&#x27;, &#x27;password&#x27; =&gt; &#x27;*&#x27;, &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;\t]);\t$db-&gt;update(&#x27;goods&#x27;, [&quot;stock_num[-]&quot; =&gt; 1], [&#x27;id&#x27; =&gt; 1]);&#125; å¸ƒéš†è¿‡æ»¤å™¨ å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚ phpå®ç°æ¨èçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š https://github.oscome.cn/2019/05/21/188/ å½“ç„¶ï¼ŒRedisè‡ªå·±ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æ¨¡å—ï¼š https://github.com/RedisBloom/RedisBloom git clone https://github.com/RedisBloom/RedisBloom.gitcd Redisbloommake/path/to/Redis-server --loadmodule ./Redisbloom.so Bloomï¼šå‘è¿‡æ»¤å™¨æ·»åŠ æ–°é¡¹,å¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™ä¼šä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨ 127.0.0.1:6379&gt; BF.ADD newFilter foo(integer) 1 Bloomï¼šæ£€æŸ¥è¿‡æ»¤å™¨ä¸­æ˜¯å¦å­˜åœ¨é¡¹ 127.0.0.1:6379&gt; BF.EXISTS newFilter foo(integer) 1127.0.0.1:6379&gt; BF.EXISTS newFilter notpresent(integer) 0 é™æµRedis-cell// æå‰å®‰è£…rustå“Ÿgit clone https://github.com/brandur/Redis-cell.gitcd Redis-cellcargo build --releasecp target/release/libRedis_cell.dylib /path/to/modules/Redis-server --loadmodule /path/to/modules/libRedis_cell.so è¯¥æ¨¡å—åªæœ‰1æ¡æŒ‡ä»¤cl.throttleï¼Œå®ƒçš„å‚æ•°å’Œè¿”å›å€¼éƒ½ç•¥æ˜¾å¤æ‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæŒ‡ä»¤å…·ä½“è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ &gt; cl.throttle limitThrot 15 30 60 1 â–² â–² â–² â–² â–² | | | | â””â”€â”€â”€â”€â”€ need 1 quota (å¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯1) | | â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€ 30 operations / 60 seconds è¿™æ˜¯æ¼æ°´é€Ÿç‡ | â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 15 capacity è¿™æ˜¯æ¼æ–—å®¹é‡&gt; â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ key ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤çš„æ„æ€æ˜¯å…è®¸é¢‘ç‡ä¸ºæ¯ 60s æœ€å¤š 30 æ¬¡(æ¼æ°´é€Ÿç‡)ï¼Œæ¼æ–—çš„åˆå§‹å®¹é‡ä¸º 15ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹å¯ä»¥å– 15 ä¸ªï¼Œç„¶åæ‰å¼€å§‹å—æ¼æ°´é€Ÿç‡çš„å½±å“ã€‚æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªæŒ‡ä»¤ä¸­æ¼æ°´é€Ÿç‡å˜æˆäº† 2 ä¸ªå‚æ•°ï¼Œæ›¿ä»£äº†ä¹‹å‰çš„å•ä¸ªæµ®ç‚¹æ•°ã€‚ç”¨ä¸¤ä¸ªå‚æ•°ç›¸é™¤çš„ç»“æœæ¥è¡¨è¾¾æ¼æ°´é€Ÿç‡ç›¸å¯¹å•ä¸ªæµ®ç‚¹æ•°è¦æ›´åŠ ç›´è§‚ä¸€äº›ã€‚ &gt; cl.throttle limitThrot 15 30 60 11) (integer) 0 # 0 è¡¨ç¤ºå…è®¸ï¼Œ1è¡¨ç¤ºæ‹’ç»2) (integer) 15 # æ¼æ–—å®¹é‡capacity3) (integer) 14 # æ¼æ–—å‰©ä½™ç©ºé—´left_quota4) (integer) -1 # å¦‚æœæ‹’ç»äº†ï¼Œéœ€è¦å¤šé•¿æ—¶é—´åå†è¯•(æ¼æ–—æœ‰ç©ºé—´äº†ï¼Œå•ä½ç§’)5) (integer) 2 # å¤šé•¿æ—¶é—´åï¼Œæ¼æ–—å®Œå…¨ç©ºå‡ºæ¥(left_quota==capacityï¼Œå•ä½ç§’) åŸºæœ¬ä¸Šå¸¸è§çš„åœºæ™¯å°±æ˜¯è¿™äº›äº†ï¼Œå„ä½å‘¨æœ«æ„‰å¿«ï¼","tags":["Redis"],"categories":["Redis"]},{"title":"MySQLæ˜¯å¦‚ä½•åšåˆ°ä¸ä¸¢æ•°æ®","path":"/2020/03/18/MySQL-data/","content":"æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚é™„ä¸Šä¸“æ é“¾æ¥ï¼Œæœ‰å…´è¶£å¯ç‚¹å‡»è®¢é˜…ï¼šhttps://time.geekbang.org/column/intro/139 MySQLæ˜¯å¦‚ä½•åšåˆ°æ•°æ®ä¸ä¸¢å¤±å‘¢ï¼Ÿ æˆ‘ä»¬å…ˆæ¥ä»‹ç»ä¸‹WALã€‚ WAL(Write-Ahead Loggin)æœºåˆ¶WAL æ˜¯é¢„å†™å¼æ—¥å¿—, å…³é”®ç‚¹åœ¨äºå…ˆå†™æ—¥å¿—å†å†™ç£ç›˜. MySQLåœ¨å¯¹æ•°æ®é¡µè¿›è¡Œä¿®æ”¹æ—¶, é€šè¿‡å°†â€ä¿®æ”¹äº†ä»€ä¹ˆâ€è¿™ä¸ªæ“ä½œè®°å½•åœ¨æ—¥å¿—ä¸­, è€Œä¸å¿…é©¬ä¸Šå°†æ›´æ”¹å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ä¸Š, ä»è€Œå°†éšæœºå†™è½¬æ¢ä¸ºé¡ºåºå†™, æé«˜äº†æ€§èƒ½ã€‚ è¿™ç§æœºåˆ¶ä¸€æ–¹é¢æé«˜äº†MySQLçš„ååé‡ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå®ç°äº†æ•°æ®çš„é«˜å¯é æ€§ã€‚ binlogçš„å†™å…¥æœºåˆ¶äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚ ä¸€ä¸ªäº‹åŠ¡çš„binlogæ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œå› æ­¤ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº†binlog cacheçš„ä¿å­˜é—®é¢˜ã€‚ ç³»ç»Ÿç»™binlog cacheåˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œå‚æ•° binlog_cache_sizeç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†…binlog cacheæ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚ äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨æŠŠbinlog cacheé‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ°binlogä¸­ï¼Œå¹¶æ¸…ç©ºbinlog cacheã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±binlog cacheï¼Œä½†æ˜¯å…±ç”¨åŒä¸€ä»½binlogæ–‡ä»¶ã€‚ å›¾ä¸­çš„writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚ å›¾ä¸­çš„fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œã€‚ write å’Œfsyncçš„æ—¶æœºï¼Œæ˜¯ç”±å‚æ•°sync_binlogæ§åˆ¶çš„ï¼š sync_binlog=0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªwriteï¼Œä¸fsyncï¼› sync_binlog=1çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsyncï¼› sync_binlog=N(N&gt;1)çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚ å› æ­¤ï¼Œåœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè€ƒè™‘åˆ°ä¸¢å¤±æ—¥å¿—é‡çš„å¯æ§æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®å°†è¿™ä¸ªå‚æ•°è®¾æˆ0ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯å°†å…¶è®¾ç½®ä¸º100~1000ä¸­çš„æŸä¸ªæ•°å€¼ã€‚ ä½†æ˜¯ï¼Œå°†sync_binlogè®¾ç½®ä¸ºNï¼Œå¯¹åº”çš„é£é™©æ˜¯ï¼šå¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚ redo logå…ˆè¯´è¯´è¯´redo logçš„ä¸‰ç§çŠ¶æ€ï¼š çº¢è‰²ï¼šå­˜åœ¨redo log bufferä¸­ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨MySQLè¿›ç¨‹å†…å­˜ä¸­ é»„è‰²ï¼šå†™åˆ°ç£ç›˜(write)ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–ï¼ˆfsync)ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„page cacheé‡Œé¢ ç»¿è‰²ï¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¯¹åº”çš„æ˜¯hard disk ä¸ºäº†æ§åˆ¶ redo log çš„å†™å…¥ç­–ç•¥ï¼ŒInnoDB æä¾›äº† innodb_flush_log_at_trx_commit å‚ æ•°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼: 0ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ ; 1ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°† redo log ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜; 2 ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚ InnoDB æœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš” 1 ç§’ï¼Œå°±ä¼šæŠŠ redo log buffer ä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨ write å†™ åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ å®é™…ä¸Šï¼Œé™¤äº†åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢æ“ä½œå¤–ï¼Œè¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šè®©ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚ 1. redo log buffer å ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_size ä¸€åŠçš„æ—¶ å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚æ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯ writeï¼Œè€Œæ²¡æœ‰è°ƒç”¨ fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„ page cacheã€‚2. å¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ ç›˜ã€‚å‡è®¾ä¸€ä¸ªäº‹åŠ¡ A æ‰§è¡Œåˆ°ä¸€åŠï¼Œå·²ç»å†™äº†ä¸€äº› redo log åˆ° buffer ä¸­ï¼Œè¿™æ—¶å€™æœ‰å¦ å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤ï¼Œå¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1ï¼Œé‚£ä¹ˆ æŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œäº‹åŠ¡ B è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶ å€™ï¼Œå°±ä¼šå¸¦ä¸Šäº‹åŠ¡ A åœ¨ redo log buffer é‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ æ—¢ç„¶MySQLèƒ½ä¿è¯redo logå’Œbinlogèƒ½å¯é æ€§å†™å…¥ç£ç›˜ï¼Œé‚£ä¹ˆåœ¨ä»–ä»¬ä¸¤è€…ç›´æ¥å¦‚ä½•ä¿è¯å¯é è½¬æ¢çš„å‘¢ï¼Ÿ ä¸¤é˜¶æ®µæäº¤redo log å…ˆ prepareï¼Œå†å†™ binlogï¼Œæœ€åå†æŠŠ redo log commitã€‚åˆ©ç”¨è¿™ä¸ªä¸¤é˜¶æ®µæäº¤æœºåˆ¶ï¼ŒMySQLä¿è¯äº†redo logå’Œbinlogçš„å¯é ä¼ è¾“ã€‚ æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹æ•´ä½“ç®€å›¾ï¼š é…ç½®å»ºè®® innodb_flush_log_at_trx_commit=1ã€‚è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„redologéƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¿è¯mysqlé‡å¯åæ•°æ®ä¸ä¸¢å¤±ã€‚ sync_binlog=1ã€‚è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„binlogéƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä¿è¯mysqlé‡å¯åbinlogè®°å½•æ˜¯å®Œæ•´çš„ã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLä¸»ä»","path":"/2020/03/17/MySQL-master-slave/","content":"æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚é™„ä¸Šä¸“æ é“¾æ¥ï¼Œæœ‰å…´è¶£å¯ç‚¹å‡»è®¢é˜…ï¼šhttps://time.geekbang.org/column/intro/139 æ˜¨å¤©çš„æ–‡ç« æˆ‘ä»¬æ“ä½œäº†ä¸»ä»å¤åˆ¶ï¼Œé‚£ä¹ˆä½ æœ‰ä»”ç»†æƒ³ä¸€æƒ³å·¥ä½œåŸç†å—ï¼Ÿ ä¸»ä»åŒæ­¥å¤åˆ¶åŸç†å¤åˆ¶ç®€å•åˆ†æˆä¸‰æ­¥ï¼š masterå°†æ”¹å˜è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(binary log)ä¸­ï¼ˆè¿™äº›è®°å½•å«åšäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼Œbinary log eventsï¼‰ï¼› slaveå°†masterçš„binary log eventsæ‹·è´åˆ°å®ƒçš„ä¸­ç»§æ—¥å¿—(relay log)ï¼› slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚ å½“ç„¶ï¼Œå…¶ä¸­çš„ç»†èŠ‚æ˜¯å¾ˆå¤æ‚çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹æå®¢æ—¶é—´ã€ŠMySQLå®æˆ˜45è®²ã€‹ä¸“æ çš„å›¾ï¼š ä¸»åº“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„æ›´æ–°è¯·æ±‚åï¼Œæ‰§è¡Œå†…éƒ¨äº‹åŠ¡çš„æ›´æ–°é€»è¾‘ï¼ŒåŒæ—¶å†™binlogã€‚ è€Œå¤‡åº“Bè·Ÿä¸»åº“Aä¹‹é—´ç»´æŒäº†ä¸€ä¸ªé•¿è¿æ¥ã€‚ä¸»åº“Aå†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å¤‡åº“Bçš„è¿™ä¸ªé•¿è¿æ¥ã€‚ä¸€ä¸ªäº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š åœ¨å¤‡åº“Bä¸Šé€šè¿‡change masterå‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“Açš„IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ã€‚ åœ¨å¤‡åº“Bä¸Šæ‰§è¡Œstart slaveå‘½ä»¤ï¼Œè¿™æ—¶å€™å¤‡åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„io_threadå’Œsql_threadã€‚å…¶ä¸­io_threadè´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥ã€‚ ä¸»åº“Aæ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§å¤‡åº“Bä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å–binlogï¼Œå‘ç»™Bã€‚ å¤‡åº“Bæ‹¿åˆ°binlogåï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œç§°ä¸ºä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚ sql_threadè¯»å–ä¸­è½¬æ—¥å¿—ï¼Œè§£æå‡ºæ—¥å¿—é‡Œçš„å‘½ä»¤ï¼Œå¹¶æ‰§è¡Œã€‚ binlogé‡Œè®°å½•çš„æ˜¯ä»€ä¹ˆï¼Ÿé‚£ä¹ˆä»‹ç»äº†å·¥ä½œåŸç†ï¼Œä¹‹å‰ä¹Ÿæœ‰æ–‡ç« ä»‹ç»è¿‡binlogï¼Œé‚£ä¹ˆbinlogé‡Œåˆ°åº•è®°å½•çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ binlogæ ¹æ®é…ç½®è®°å½•çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬çœ‹è¡¨æ ¼ï¼š format å®šä¹‰ ä¼˜ç‚¹ ç¼ºç‚¹ statement è®°å½•çš„æ˜¯ä¿®æ”¹SQLè¯­å¥ æ—¥å¿—æ–‡ä»¶å°ï¼ŒèŠ‚çº¦IOï¼Œæé«˜æ€§èƒ½ å‡†ç¡®æ€§å·®ï¼Œå¯¹ä¸€äº›ç³»ç»Ÿå‡½æ•°ä¸èƒ½å‡†ç¡®å¤åˆ¶æˆ–ä¸èƒ½å¤åˆ¶ï¼Œå¦‚now()ã€uuid()ç­‰ row è®°å½•çš„æ˜¯æ¯è¡Œå®é™…æ•°æ®çš„å˜æ›´ å‡†ç¡®æ€§å¼ºï¼Œèƒ½å‡†ç¡®å¤åˆ¶æ•°æ®çš„å˜æ›´ æ—¥å¿—æ–‡ä»¶å¤§ï¼Œè¾ƒå¤§çš„ç½‘ç»œIOå’Œç£ç›˜IO mixed statementå’Œrowæ¨¡å¼çš„æ··åˆ å‡†ç¡®æ€§å¼ºï¼Œæ–‡ä»¶å¤§å°é€‚ä¸­ æœ‰å¯èƒ½å‘ç”Ÿä¸»ä»ä¸ä¸€è‡´é—®é¢˜ æ¨èä½¿ç”¨çš„æ˜¯rowæ¨¡å¼ï¼Œå‡†ç¡®æ€§é«˜ï¼Œè™½ç„¶è¯´æ–‡ä»¶å¤§ï¼Œä½†æ˜¯ç°åœ¨æœ‰SSDå’Œä¸‡å…†å…‰çº¤ç½‘ç»œï¼Œè¿™äº›ç£ç›˜IOå’Œç½‘ç»œIOéƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚ mixedæ ¼å¼çš„æ„æ€æ˜¯ï¼ŒMySQLè‡ªå·±ä¼šåˆ¤æ–­è¿™æ¡SQLè¯­å¥æ˜¯å¦å¯èƒ½å¼•èµ·ä¸»å¤‡ä¸ä¸€è‡´ï¼Œå¦‚æœæœ‰å¯èƒ½ï¼Œå°±ç”¨rowæ ¼å¼ï¼Œå¦åˆ™å°±ç”¨statementæ ¼å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œmixedæ ¼å¼å¯ä»¥åˆ©ç”¨statmentæ ¼å¼çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶åˆé¿å…äº†æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨mixedæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¾ä¾‹è¯´æ˜ï¼ˆæ•°æ®æ¢å¤ï¼‰ï¼š æˆ‘ä»¬å°±åˆ†åˆ«ä»deleteã€insertå’Œupdateè¿™ä¸‰ç§SQLè¯­å¥çš„è§’åº¦ï¼Œæ¥çœ‹çœ‹æ•°æ®æ¢å¤çš„é—®é¢˜ã€‚ å³ä½¿æ‰§è¡Œçš„æ˜¯deleteè¯­å¥ï¼Œrowæ ¼å¼çš„binlogä¹Ÿä¼šæŠŠè¢«åˆ æ‰çš„è¡Œçš„æ•´è¡Œä¿¡æ¯ä¿å­˜èµ·æ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨æ‰§è¡Œå®Œä¸€æ¡deleteè¯­å¥ä»¥åï¼Œå‘ç°åˆ é”™æ•°æ®äº†ï¼Œå¯ä»¥ç›´æ¥æŠŠbinlogä¸­è®°å½•çš„deleteè¯­å¥è½¬æˆinsertï¼ŒæŠŠè¢«é”™åˆ çš„æ•°æ®æ’å…¥å›å»å°±å¯ä»¥æ¢å¤äº†ã€‚ å¦‚æœä½ æ˜¯æ‰§è¡Œé”™äº†insertè¯­å¥å‘¢ï¼Ÿé‚£å°±æ›´ç›´æ¥äº†ã€‚rowæ ¼å¼ä¸‹ï¼Œinsertè¯­å¥çš„binlogé‡Œä¼šè®°å½•æ‰€æœ‰çš„å­—æ®µä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥ç²¾ç¡®å®šä½åˆšåˆšè¢«æ’å…¥çš„é‚£ä¸€è¡Œã€‚è¿™æ—¶ï¼Œä½ ç›´æ¥æŠŠinsertè¯­å¥è½¬æˆdeleteè¯­å¥ï¼Œåˆ é™¤æ‰è¿™è¢«è¯¯æ’å…¥çš„ä¸€è¡Œæ•°æ®å°±å¯ä»¥äº†ã€‚ å¦‚æœæ‰§è¡Œçš„æ˜¯updateè¯­å¥çš„è¯ï¼Œbinlogé‡Œé¢ä¼šè®°å½•ä¿®æ”¹å‰æ•´è¡Œçš„æ•°æ®å’Œä¿®æ”¹åçš„æ•´è¡Œæ•°æ®ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è¯¯æ‰§è¡Œäº†updateè¯­å¥çš„è¯ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªeventå‰åçš„ä¸¤è¡Œä¿¡æ¯å¯¹è°ƒä¸€ä¸‹ï¼Œå†å»æ•°æ®åº“é‡Œé¢æ‰§è¡Œï¼Œå°±èƒ½æ¢å¤è¿™ä¸ªæ›´æ–°æ“ä½œäº†ã€‚ å…¶å®ï¼Œç”±deleteã€insertæˆ–è€…updateè¯­å¥å¯¼è‡´çš„æ•°æ®æ“ä½œé”™è¯¯ï¼Œéœ€è¦æ¢å¤åˆ°æ“ä½œä¹‹å‰çŠ¶æ€çš„æƒ…å†µï¼Œä¹Ÿæ—¶æœ‰å‘ç”Ÿã€‚ æŸ¥çœ‹binlogbinlogæœ¬èº«æ˜¯ä¸€ç±»äºŒè¿›åˆ¶æ–‡ä»¶ã€‚äºŒè¿›åˆ¶æ–‡ä»¶æ›´çœç©ºé—´ï¼Œå†™å…¥é€Ÿåº¦æ›´å¿«ï¼Œæ˜¯æ— æ³•ç›´æ¥æ‰“å¼€æ¥æŸ¥çœ‹çš„ã€‚å› æ­¤mysqlæä¾›äº†å‘½ä»¤mysqlbinlogè¿›è¡ŒæŸ¥çœ‹ã€‚ä¸€èˆ¬çš„statementæ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨ä¸‹é¢å‘½ä»¤å°±å¯ä»¥ mysqlbinlog mysql-bin.000001 å¦‚æœæ˜¯rowæ ¼å¼ï¼ŒåŠ ä¸Š-væˆ–è€…-vvå‚æ•°å°±è¡Œï¼Œå¦‚ mysqlbinlog -vv mysql-bin.000001 é…ç½®å‚æ•° å‚æ•°å å«ä¹‰ log_bin = {on | off | base_name} æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æˆ–è€…æŒ‡å®šä¸€ä¸ªæ—¥å¿—è·¯å¾„ sql_log_bin ={ on | off } æŒ‡å®šæ˜¯å¦å¯ç”¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿— expire_logs_days æŒ‡å®šè‡ªåŠ¨åˆ é™¤äºŒè¿›åˆ¶æ—¥å¿—çš„æ—¶é—´ï¼Œå³æ—¥å¿—è¿‡æœŸæ—¶é—´ log_bin_index æŒ‡å®šmysql-bin.indexæ–‡ä»¶çš„è·¯å¾„ binlog_format = { mixed | row | statement } æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—åŸºäºä»€ä¹ˆæ¨¡å¼è®°å½• max_binlog_size æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æœ€å¤§å€¼ binlog_cache_size æŒ‡å®šäº‹åŠ¡æ—¥å¿—ç¼“å­˜åŒºå¤§å° max_binlog_cache_size æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—ç¼“å­˜æœ€å¤§å¤§å° sync_binlog = { 0 | n } æŒ‡å®šå†™ç¼“å†²å¤šå°‘æ¬¡ï¼Œåˆ·ä¸€æ¬¡ç›˜ ä¹‹å‰æ˜¯ä»‹ç»ä¸€äº›æ¦‚å¿µçš„ä¸œè¥¿ï¼Œä»Šå¤©æˆ‘ä»¬æ¥æ¢æ¢å£å‘³ï¼Œå®é™…æ“ä½œä¸€ä¸‹å•Šï¼Œæ“ä½œå†…å®¹æ˜¯æ­å»ºæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„MySQLä¸»ä»ã€‚ å‰æå·²ç»å®‰è£…å¥½äº†ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“ï¼Œå¹¶æ–°å»ºdatabaseä¸ºtestï¼Œå‡å¦‚ä¸€äº›æ•°æ®ã€‚ï¼ˆå› ä¸ºæ˜¯æµ‹è¯•ï¼Œå•æœºå™¨ä¸Šå¼€ä¸¤ä¸ªMySQLç¤ºä¾‹ä¹Ÿå¯ä»¥ï¼‰ masterGRANT REPLICATION SLAVE, REPLICATION CLIENT ON . TO repl@&#x27;127.0.0.1&#x27; IDENTIFIED BY &#x27;111111&#x27;; //åˆ†é…è´¦å· grant all on . to repl@&#x27;127.0.0.1&#x27;; //æˆæƒ æŸ¥çœ‹çŠ¶æ€ SHOW MASTER STATUS;//è®°ä½è¿™é‡Œçš„fileå’Œpositionã€‚ ä¿®æ”¹é…ç½® [mysqld] log-bin=mysql-bin server-id=1 é‡å¯ slaveä¿®æ”¹é…ç½®ï¼Œæ³¨æ„server_idè¦ä¸ä¸»åº“ï¼Œå…¶ä»–ä»åº“ä¸ä¸€æ ·ï¼Œå¯ä»¥è®¾ç½®æˆip [mysqld] log_bin = mysql-bin server_id = 2 relay_log = mysql-relay-bin log_slave_updates = 1 read_only = 1 é‡å¯åï¼Œå»ºè®®å…ˆè¿›è¡Œé‡ç½®æ“ä½œã€‚ reset slave è¿æ¥master CHANGE MASTER TO MASTER_HOST=&#x27;127.0.0.1&#x27;,MASTER_USER=&#x27;repl&#x27;, MASTER_PASSWORD=&#x27;111111&#x27;, MASTER_LOG_FILE=&#x27;mysql-bin.000051&#x27;,master_log_pos=8694; master_log_fileå’Œmaster_log_poså°±æ˜¯ä¸Šé¢è®°ä½çš„fileå’Œpositionï¼Œå…·ä½“è‡ªè¡Œä¿®æ”¹ã€‚ å¼€å¯å¹¶æŸ¥çœ‹çŠ¶æ€ start slave show slave status å¦‚æœSlave_IO_Runningå’ŒSlave_SQL_Runningéƒ½æ˜¾ç¤ºYesï¼Œä¸€èˆ¬å°±æˆåŠŸäº†ã€‚ å¤±è´¥ä¸€èˆ¬å°±æ˜¯master_log_posï¼Œmaster_log_fileé…ç½®æœ‰é—®é¢˜ï¼Œé‡æ–°é…ç½®ä¸‹å°±è¡Œäº†ã€‚ å¯ä»¥åœ¨masteræ’å…¥ä¿®æ”¹æ•°æ®ï¼Œæµ‹è¯•slaveæ˜¯å¦ç›¸åº”å˜åŒ–ã€‚ æ³¨æ„å¦‚æœmasterå·²æœ‰æ•°æ®ï¼Œå¯ä»¥é”å®šmasterï¼ˆflush tables with read lockï¼‰ï¼Œç„¶åå¯¼å‡ºåŒæ­¥åˆ°slaveï¼Œé…ç½®å®Œæˆåé‡Šæ”¾masterï¼ˆunlock tablesï¼‰ã€‚ å‚è€ƒæ–‡ç«  ã€åŸåˆ›ã€‘ç ”å‘åº”è¯¥æ‡‚çš„binlogçŸ¥è¯†(ä¸Š) https://www.cnblogs.com/rjzheng/p/9721765.html","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLçš„count","path":"/2020/03/15/MySQL-count/","content":"æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚ count(*)è¯­å¥åº”è¯¥æ˜¯æˆ‘ä»¬å¼€å‘ä¸­å¾ˆç»å¸¸ç”¨åˆ°çš„,né‚£ä¹ˆä½ æœ‰ä»”ç»†ç ”ç©¶è¿‡å—ï¼Ÿ å®ç°æ–¹å¼ MyISAMå¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œcount()çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼›å¦‚æœåŠ äº†where æ¡ä»¶çš„è¯ï¼ŒMyISAMè¡¨ä¹Ÿæ˜¯ä¸èƒ½è¿”å›å¾—è¿™ä¹ˆå¿«çš„ã€‚è€ŒInnoDBå¼•æ“å°±éº»çƒ¦äº†ï¼Œå®ƒæ‰§è¡Œcount()çš„æ—¶å€™ï¼Œéœ€è¦æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»å¼•æ“é‡Œé¢è¯»å‡ºæ¥ï¼Œç„¶ååˆ¤æ–­not nullç´¯ç§¯è®¡æ•°ã€‚ é‚£ä½ å°±é—®äº†ï¼Œä¸ºä»€ä¹ˆInnoDBä¸è·ŸMyISAMä¸€æ ·ï¼Œä¹ŸæŠŠæ•°å­—å­˜èµ·æ¥å‘¢ï¼Ÿ è¿™æ˜¯å› ä¸ºå³ä½¿æ˜¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»çš„å¤šä¸ªæŸ¥è¯¢ï¼Œç”±äºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰çš„åŸå› ï¼ŒInnoDBè¡¨â€œåº”è¯¥è¿”å›å¤šå°‘è¡Œâ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ã€‚ å‡è®¾è¡¨tä¸­ç°åœ¨æœ‰10000æ¡è®°å½•ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªç”¨æˆ·å¹¶è¡Œçš„ä¼šè¯ã€‚ ä¼šè¯Aå…ˆå¯åŠ¨äº‹åŠ¡å¹¶æŸ¥è¯¢ä¸€æ¬¡è¡¨çš„æ€»è¡Œæ•°ï¼› ä¼šè¯Bå¯åŠ¨äº‹åŠ¡ï¼Œæ’å…¥ä¸€è¡Œåè®°å½•åï¼ŒæŸ¥è¯¢è¡¨çš„æ€»è¡Œæ•°ï¼› ä¼šè¯Cå…ˆå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„è¯­å¥ï¼Œæ’å…¥ä¸€è¡Œè®°å½•åï¼ŒæŸ¥è¯¢è¡¨çš„æ€»è¡Œæ•°ã€‚ æˆ‘ä»¬å‡è®¾ä»ä¸Šåˆ°ä¸‹æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œçš„ï¼ŒåŒä¸€è¡Œè¯­å¥æ˜¯åœ¨åŒä¸€æ—¶åˆ»æ‰§è¡Œçš„ã€‚ ä½ ä¼šçœ‹åˆ°ï¼Œåœ¨æœ€åä¸€ä¸ªæ—¶åˆ»ï¼Œä¸‰ä¸ªä¼šè¯Aã€Bã€Cä¼šåŒæ—¶æŸ¥è¯¢è¡¨tçš„æ€»è¡Œæ•°ï¼Œä½†æ‹¿åˆ°çš„ç»“æœå´ä¸åŒã€‚ è¿™å’ŒInnoDBçš„äº‹åŠ¡è®¾è®¡æœ‰å…³ç³»ï¼Œå¯é‡å¤è¯»æ˜¯å®ƒé»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼Œåœ¨ä»£ç ä¸Šå°±æ˜¯é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶æ¥å®ç°çš„ã€‚æ¯ä¸€è¡Œè®°å½•éƒ½è¦åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯¹è¿™ä¸ªä¼šè¯å¯è§ï¼Œå› æ­¤å¯¹äºcount(*)è¯·æ±‚æ¥è¯´ï¼ŒInnoDBåªå¥½æŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°è¯»å‡ºä¾æ¬¡åˆ¤æ–­ï¼Œå¯è§çš„è¡Œæ‰èƒ½å¤Ÿç”¨äºè®¡ç®—â€œåŸºäºè¿™ä¸ªæŸ¥è¯¢â€çš„è¡¨çš„æ€»è¡Œæ•°ã€‚ å½“ç„¶ï¼Œç°åœ¨è¿™ä¸ªçœ‹ä¸Šå»ç¬¨ç¬¨çš„MySQLï¼Œåœ¨æ‰§è¡Œcount(*)æ“ä½œçš„æ—¶å€™è¿˜æ˜¯åšäº†ä¼˜åŒ–çš„ã€‚ InnoDBæ”¯æŒçš„æ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼Œä¸»é”®ç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯æ•°æ®ï¼Œè€Œæ™®é€šç´¢å¼•æ ‘çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸»é”®å€¼ã€‚æ‰€ä»¥ï¼Œæ™®é€šç´¢å¼•æ ‘æ¯”ä¸»é”®ç´¢å¼•æ ‘å°å¾ˆå¤šã€‚å¯¹äºcount(*)è¿™æ ·çš„æ“ä½œï¼Œéå†å“ªä¸ªç´¢å¼•æ ‘å¾—åˆ°çš„ç»“æœé€»è¾‘ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤ï¼ŒMySQLä¼˜åŒ–å™¨ä¼šæ‰¾åˆ°æœ€å°çš„é‚£æ£µæ ‘æ¥éå†ã€‚ åœ¨ä¿è¯é€»è¾‘æ­£ç¡®çš„å‰æä¸‹ï¼Œå°½é‡å‡å°‘æ‰«æçš„æ•°æ®é‡ï¼Œæ˜¯æ•°æ®åº“ç³»ç»Ÿè®¾è®¡çš„é€šç”¨æ³•åˆ™ä¹‹ä¸€ã€‚ å¦‚æœä½ ç”¨è¿‡show table status å‘½ä»¤çš„è¯ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªå‘½ä»¤çš„è¾“å‡ºç»“æœé‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªTABLE_ROWSç”¨äºæ˜¾ç¤ºè¿™ä¸ªè¡¨å½“å‰æœ‰å¤šå°‘è¡Œï¼Œè¿™ä¸ªå‘½ä»¤æ‰§è¡ŒæŒºå¿«çš„ï¼Œé‚£è¿™ä¸ªTABLE_ROWSèƒ½ä»£æ›¿count(*)å—ï¼Ÿ è€Œç´¢å¼•ç»Ÿè®¡çš„å€¼æ˜¯é€šè¿‡é‡‡æ ·æ¥ä¼°ç®—çš„ï¼Œå®é™…ä¸Šï¼ŒTABLE_ROWSå°±æ˜¯ä»è¿™ä¸ªé‡‡æ ·ä¼°ç®—å¾—æ¥çš„ï¼Œå› æ­¤å®ƒä¹Ÿä¸æ˜¯å¾ˆå‡†ã€‚æœ‰å¤šä¸å‡†å‘¢ï¼Œå®˜æ–¹æ–‡æ¡£è¯´è¯¯å·®å¯èƒ½è¾¾åˆ°40%åˆ°50%ã€‚æ‰€ä»¥ï¼Œshow table statuså‘½ä»¤æ˜¾ç¤ºçš„è¡Œæ•°ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚ MyISAMè¡¨è™½ç„¶count(*)å¾ˆå¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼›show table statuså‘½ä»¤è™½ç„¶è¿”å›å¾ˆå¿«ï¼Œä½†æ˜¯ä¸å‡†ç¡®ï¼›InnoDBè¡¨ç›´æ¥count(*)ä¼šéå†å…¨è¡¨ï¼Œè™½ç„¶ç»“æœå‡†ç¡®ï¼Œä½†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ é‚£ä¹ˆï¼Œå¦‚æœä½ ç°åœ¨æœ‰ä¸€ä¸ªé¡µé¢ç»å¸¸è¦æ˜¾ç¤ºè®°å½•æ€»æ•°ï¼Œåˆ°åº•åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœªå¿…å°±åªèƒ½çº ç»“äºcountï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±é¢å¤–è®¡æ•°ã€‚ è®¡æ•°æ–¹æ³•ç¼“å­˜è®¡æ•°å¯¹äºæ›´æ–°å¾ˆé¢‘ç¹çš„åº“æ¥è¯´ï¼Œä½ å¯èƒ½ä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°ï¼Œç”¨ç¼“å­˜ç³»ç»Ÿæ¥æ”¯æŒï¼Œæ¯”å¦‚Redisã€‚ æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªRedisæœåŠ¡æ¥ä¿å­˜è¿™ä¸ªè¡¨çš„æ€»è¡Œæ•°ï¼Œè¯»å’Œæ›´æ–°æ“ä½œéƒ½å¾ˆå¿«ã€‚ å½“ç„¶ï¼Œä½¿ç”¨Rediså­˜å‚¨è®¡æ•°æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ã€‚ é¦–å…ˆï¼Œæ— æ³•ä¿è¯Rediså®Œå…¨å¯ç”¨ï¼Œå‡å¦‚å¼‚å¸¸æŒ‚æ‰ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯MySQLå’ŒRedisæ•°æ®çš„ä¸€è‡´æ€§ã€‚ å…¶æ¬¡ï¼Œå³ä½¿Redisæ­£å¸¸å¯ç”¨ï¼Œè®¡æ•°ä¹Ÿå¹¶ä¸ç²¾ç¡®ï¼Œå› ä¸ºMySQLå’ŒRediså­˜å‚¨å¿…ç„¶æœ‰å…ˆåä¹‹åˆ†ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤šä¸ªä¼šè¯ä»Rediså’ŒMySQLè¯»åˆ°çš„æ•°æ®å¾ˆå¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å›¾ç‰‡ï¼Œå°±ä¸å±•å¼€è¯´æ˜äº†ã€‚ å½“ç„¶äº†ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼Œå› ä¸ºä¸šåŠ¡å¹¶ä¸è¦ä¿è¯æ•°æ®æ¯æ—¶æ¯åˆ»éƒ½æ˜¯ç²¾ç¡®çš„ï¼Œé‚£å°±æ— éœ€è€ƒè™‘è¿™äº›é—®é¢˜ï¼ŒRediså¼‚å¸¸åæˆ‘ä»¬å¯ä»¥ä»è®¡ç®—è¡¨è¡Œæ•°å»æ›´æ–°ã€‚ æ•°æ®åº“è®¡æ•°æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨MySQlæ–°å»ºä¸€å¼ è¡¨å»è®¡æ•°ã€‚é‚£ä¹ˆé’ˆå¯¹ç¼“å­˜è®¡æ•°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹ï¼š é¦–å…ˆï¼Œè¿™è§£å†³äº†å´©æºƒä¸¢å¤±çš„é—®é¢˜ï¼ŒInnoDBæ˜¯æ”¯æŒå´©æºƒæ¢å¤ä¸ä¸¢æ•°æ®çš„ã€‚ ç„¶åï¼Œæˆ‘ä»¬å†çœ‹çœ‹èƒ½ä¸èƒ½è§£å†³è®¡æ•°ä¸ç²¾ç¡®çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æœ‰â€œäº‹åŠ¡â€è¿™ä¸ªå¤§æ€å™¨ï¼Œå¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ ä¸åŒçš„countç”¨æ³•å¯¹æ¯” count(ä¸»é”®id)ï¼šInnoDBå¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„idå€¼éƒ½å–å‡ºæ¥ï¼Œè¿”å›ç»™serverå±‚ã€‚serverå±‚æ‹¿åˆ°idåï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºnullï¼Œå°±æŒ‰è¡Œç´¯åŠ ã€‚ count(1)ï¼šInnoDBå¼•æ“éå†æ•´å¼ è¡¨ï¼Œä½†ä¸å–å€¼ã€‚serverå±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­—â€œ1â€è¿›å»ï¼Œåˆ¤æ–­æ˜¯ä¸å¯èƒ½ä¸ºnullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼Œæ˜¾ç„¶è¿™æ¯”ä¸Šé¢çš„æ•ˆç‡è¦é«˜ä¸€äº›ã€‚ count(å­—æ®µ)ï¼šå¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€æ˜¯å®šä¹‰ä¸ºnot nullçš„è¯ï¼Œä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸ºnullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼›å¦‚æœè¿™ä¸ªâ€œå­—æ®µâ€å®šä¹‰å…è®¸ä¸ºnullï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯nullï¼Œè¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹ï¼Œä¸æ˜¯nullæ‰ç´¯åŠ ã€‚ count()ï¼šæ˜¯ä¾‹å¤–ï¼Œå¹¶ä¸ä¼šæŠŠå…¨éƒ¨å­—æ®µå–å‡ºæ¥ï¼Œè€Œæ˜¯ä¸“é—¨åšäº†ä¼˜åŒ–ï¼Œä¸å–å€¼ã€‚count()è‚¯å®šä¸æ˜¯nullï¼ŒæŒ‰è¡Œç´¯åŠ ã€‚ æŒ‰ç…§æ•ˆç‡æ’åºçš„è¯ï¼Œcount(å­—æ®µ)&lt;count(ä¸»é”®id)&lt;count(1)â‰ˆcount(*)ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ ï¼Œå°½é‡ä½¿ç”¨count(*)ã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLçš„é”","path":"/2020/03/14/MySQL-lock/","content":"æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚ é”æ˜¯MySQLä¸­ç»å¸¸ç”¨åˆ°çš„ï¼Œæ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQLé‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆå…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”ä¸‰ç±»ã€‚ å…¨å±€é”é¡¾åæ€ä¹‰ï¼Œå…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚ MySQLæä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL)ã€‚ å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚ å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚ å®˜æ–¹è‡ªå¸¦çš„é€»è¾‘å¤‡ä»½å·¥å…·æ˜¯mysqldumpã€‚å½“mysqldumpä½¿ç”¨å‚æ•°â€“single-transactionçš„æ—¶å€™ï¼Œå¯¼æ•°æ®ä¹‹å‰å°±ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ¥ç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ã€‚è€Œç”±äºMVCCçš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®æ˜¯å¯ä»¥æ­£å¸¸æ›´æ–°çš„ã€‚ è¡¨é”MySQLé‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL)ã€‚ è¡¨é”çš„è¯­æ³•æ˜¯ lock tables â€¦ read/writeã€‚ ä¸FTWRLç±»ä¼¼ï¼Œå¯ä»¥ç”¨unlock tablesä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚éœ€è¦æ³¨æ„ï¼Œlock tablesè¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚ ä¸¾ä¸ªä¾‹å­, å¦‚æœåœ¨æŸä¸ªçº¿ç¨‹Aä¸­æ‰§è¡Œ lock tables t1 read, t2 write è¿™ä¸ªè¯­å¥ï¼Œåˆ™å…¶ä»–çº¿ç¨‹å†™t1ã€è¯»å†™t2çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚åŒæ—¶ï¼Œçº¿ç¨‹Aåœ¨æ‰§è¡Œunlock tablesä¹‹å‰ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œè¯»t1ã€è¯»å†™t2çš„æ“ä½œã€‚è¿å†™t1éƒ½ä¸å…è®¸ï¼Œè‡ªç„¶ä¹Ÿä¸èƒ½è®¿é—®å…¶ä»–è¡¨ã€‚ åœ¨è¿˜æ²¡æœ‰å‡ºç°æ›´ç»†ç²’åº¦çš„é”çš„æ—¶å€™ï¼Œè¡¨é”æ˜¯æœ€å¸¸ç”¨çš„å¤„ç†å¹¶å‘çš„æ–¹å¼ã€‚è€Œå¯¹äºInnoDBè¿™ç§æ”¯æŒè¡Œé”çš„å¼•æ“ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨lock tableså‘½ä»¤æ¥æ§åˆ¶å¹¶å‘ï¼Œæ¯•ç«Ÿé”ä½æ•´ä¸ªè¡¨çš„å½±å“é¢è¿˜æ˜¯å¤ªå¤§ã€‚ å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯MDLï¼ˆmetadata lock)ã€‚ MDLä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚ MDLçš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªè¡¨ç»“æ„åšå˜æ›´ï¼Œåˆ äº†ä¸€åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚ å› æ­¤ï¼Œåœ¨MySQL 5.5ç‰ˆæœ¬ä¸­å¼•å…¥äº†MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚ è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æ”¹æŸ¥ã€‚ è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¦åŒæ—¶ç»™ä¸€ä¸ªè¡¨åŠ å­—æ®µï¼Œå…¶ä¸­ä¸€ä¸ªè¦ç­‰å¦ä¸€ä¸ªæ‰§è¡Œå®Œæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚ è™½ç„¶MDLé”æ˜¯ç³»ç»Ÿé»˜è®¤ä¼šåŠ çš„ï¼Œä½†å´æ˜¯ä½ ä¸èƒ½å¿½ç•¥çš„ä¸€ä¸ªæœºåˆ¶ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°æœ‰äººæ‰åˆ°è¿™ä¸ªå‘é‡Œï¼šç»™ä¸€ä¸ªå°è¡¨åŠ ä¸ªå­—æ®µï¼Œå¯¼è‡´æ•´ä¸ªåº“æŒ‚äº†ã€‚ è¡Œé”MySQLçš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚MyISAMå¼•æ“å°±ä¸æ”¯æŒè¡Œé”ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚InnoDBæ˜¯æ”¯æŒè¡Œé”çš„ï¼Œè¿™ä¹Ÿæ˜¯MyISAMè¢«InnoDBæ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚ åœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚ æ­»é” æ‰€è°“æ­»é”: æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­,å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡,è‹¥æ— å¤–åŠ›ä½œç”¨,å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å».æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”,è¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰ç«ºçš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹.è¡¨çº§é”ä¸ä¼šäº§ç”Ÿæ­»é”.æ‰€ä»¥è§£å†³æ­»é”ä¸»è¦è¿˜æ˜¯é’ˆå¯¹äºæœ€å¸¸ç”¨çš„InnoDB. å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼š ä¸€ç§ç­–ç•¥æ˜¯ï¼Œç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®ã€‚å¦ä¸€ç§ç­–ç•¥æ˜¯ï¼Œå‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚ åŠ é”è§„åˆ™åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚ åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockï¼Œlockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚ åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºè¡Œé”ã€‚ ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚ ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLäº‹åŠ¡éš”ç¦»","path":"/2020/03/13/MySQL-Isolation/","content":"æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚ æåˆ°äº‹åŠ¡ï¼Œä½ è‚¯å®šä¼šæƒ³åˆ°ACIDï¼ˆAtomicityã€Consistencyã€Isolationã€Durabilityï¼Œå³åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥è¯´è¯´å…¶ä¸­Iï¼Œä¹Ÿå°±æ˜¯â€œéš”ç¦»æ€§â€ã€‚ SQLæ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«åŒ…æ‹¬ï¼šè¯»æœªæäº¤ï¼ˆread uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆserializable ï¼‰ã€‚ è¯»æœªæäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚ è¯»æäº¤æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚ å¯é‡å¤è¯»æ˜¯æŒ‡ï¼Œä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å½“ç„¶åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæœªæäº¤å˜æ›´å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿæ˜¯ä¸å¯è§çš„ã€‚ ä¸²è¡ŒåŒ–ï¼Œé¡¾åæ€ä¹‰æ˜¯å¯¹äºåŒä¸€è¡Œè®°å½•ï¼Œâ€œå†™â€ä¼šåŠ â€œå†™é”â€ï¼Œâ€œè¯»â€ä¼šåŠ â€œè¯»é”â€ã€‚å½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåè®¿é—®çš„äº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aä¼šæœ‰å“ªäº›ä¸åŒçš„è¿”å›ç»“æœï¼Œä¹Ÿå°±æ˜¯å›¾é‡Œé¢V1ã€V2ã€V3çš„è¿”å›å€¼åˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æœªæäº¤â€ï¼Œ åˆ™V1çš„å€¼å°±æ˜¯2ã€‚è¿™æ—¶å€™äº‹åŠ¡Bè™½ç„¶è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ç»“æœå·²ç»è¢«Açœ‹åˆ°äº†ã€‚å› æ­¤ï¼ŒV2ã€V3ä¹Ÿéƒ½æ˜¯2ã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æäº¤â€ï¼Œåˆ™V1æ˜¯1ï¼ŒV2çš„å€¼æ˜¯2ã€‚äº‹åŠ¡Bçš„æ›´æ–°åœ¨æäº¤åæ‰èƒ½è¢«Açœ‹åˆ°ã€‚æ‰€ä»¥ï¼Œ V3çš„å€¼ä¹Ÿæ˜¯2ã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œå¯é‡å¤è¯»â€ï¼Œåˆ™V1ã€V2æ˜¯1ï¼ŒV3æ˜¯2ã€‚ä¹‹æ‰€ä»¥V2è¿˜æ˜¯1ï¼Œéµå¾ªçš„å°±æ˜¯è¿™ä¸ªè¦æ±‚ï¼šäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®å‰åå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œä¸²è¡ŒåŒ–â€ï¼Œåˆ™åœ¨äº‹åŠ¡Bæ‰§è¡Œâ€œå°†1æ”¹æˆ2â€çš„æ—¶å€™ï¼Œä¼šè¢«é”ä½ã€‚ç›´åˆ°äº‹åŠ¡Aæäº¤åï¼Œäº‹åŠ¡Bæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥ä»Açš„è§’åº¦çœ‹ï¼Œ V1ã€V2å€¼æ˜¯1ï¼ŒV3çš„å€¼æ˜¯2ã€‚ æŸ¥çœ‹éš”ç¦»çº§åˆ«ï¼š show variables like â€˜transaction_isolationâ€™; äº‹åŠ¡å¯åŠ¨ æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ begin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯commitï¼Œå›æ»šè¯­å¥æ˜¯rollbackã€‚ å»ºè®®ä½ æ€»æ˜¯ä½¿ç”¨set autocommit=1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡ã€‚ äº‹åŠ¡éš”ç¦»çš„å®ç°ç†è§£äº†äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹äº‹åŠ¡éš”ç¦»å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ã€‚è¿™é‡Œæˆ‘ä»¬å±•å¼€è¯´æ˜â€œå¯é‡å¤è¯»â€ã€‚ åœ¨MySQLä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚ å‡è®¾ä¸€ä¸ªå€¼ä»1è¢«æŒ‰é¡ºåºæ”¹æˆäº†2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚ å½“å‰å€¼æ˜¯4ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢è¿™æ¡è®°å½•çš„æ—¶å€™ï¼Œä¸åŒæ—¶åˆ»å¯åŠ¨çš„äº‹åŠ¡ä¼šæœ‰ä¸åŒçš„read-viewã€‚å¦‚å›¾ä¸­çœ‹åˆ°çš„ï¼Œåœ¨è§†å›¾Aã€Bã€Cé‡Œé¢ï¼Œè¿™ä¸€ä¸ªè®°å½•çš„å€¼åˆ†åˆ«æ˜¯1ã€2ã€4ï¼ŒåŒä¸€æ¡è®°å½•åœ¨ç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯æ•°æ®åº“çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ã€‚å¯¹äºread-view Aï¼Œè¦å¾—åˆ°1ï¼Œå°±å¿…é¡»å°†å½“å‰å€¼ä¾æ¬¡æ‰§è¡Œå›¾ä¸­æ‰€æœ‰çš„å›æ»šæ“ä½œå¾—åˆ°ã€‚ åŒæ—¶ä½ ä¼šå‘ç°ï¼Œå³ä½¿ç°åœ¨æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨å°†4æ”¹æˆ5ï¼Œè¿™ä¸ªäº‹åŠ¡è·Ÿread-view Aã€Bã€Cå¯¹åº”çš„äº‹åŠ¡æ˜¯ä¸ä¼šå†²çªçš„ã€‚ ä½ ä¸€å®šä¼šé—®ï¼Œå›æ»šæ—¥å¿—æ€»ä¸èƒ½ä¸€ç›´ä¿ç•™å§ï¼Œä»€ä¹ˆæ—¶å€™åˆ é™¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚ ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢ï¼Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„read-viewçš„æ—¶å€™ã€‚ åŸºäºä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ä¸ºä»€ä¹ˆå»ºè®®ä½ å°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ã€‚ é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚ åœ¨MySQL 5.5åŠä»¥å‰çš„ç‰ˆæœ¬ï¼Œå›æ»šæ—¥å¿—æ˜¯è·Ÿæ•°æ®å­—å…¸ä¸€èµ·æ”¾åœ¨ibdataæ–‡ä»¶é‡Œçš„ï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œå›æ»šæ®µè¢«æ¸…ç†ï¼Œæ–‡ä»¶ä¹Ÿä¸ä¼šå˜å°ã€‚æˆ‘è§è¿‡æ•°æ®åªæœ‰20GBï¼Œè€Œå›æ»šæ®µæœ‰200GBçš„åº“ã€‚æœ€ç»ˆåªå¥½ä¸ºäº†æ¸…ç†å›æ»šæ®µï¼Œé‡å»ºæ•´ä¸ªåº“ã€‚ é™¤äº†å¯¹å›æ»šæ®µçš„å½±å“ï¼Œé•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ï¼Œè¿™äº‹éœ€è¦æ³¨æ„çš„ã€‚ ç›¸å…³è¯­æ³•START TRANSACTION [transaction_characteristic [, transaction_characteristic] ...]transaction_characteristic: &#123; WITH CONSISTENT SNAPSHOT | READ WRITE | READ ONLY&#125;BEGIN [WORK]COMMIT [WORK] [AND [NO] CHAIN] [[NO] RELEASE]ROLLBACK [WORK] [AND [NO] CHAIN] [[NO] RELEASE]SET autocommit = &#123;0 | 1&#125; è¿™äº›è¯­å¥æä¾›å¯¹äº‹åŠ¡ä½¿ç”¨çš„æ§åˆ¶ ï¼š START TRANSACTIONæˆ– BEGINå¼€å§‹æ–°äº¤æ˜“ã€‚ COMMIT æäº¤å½“å‰äº‹åŠ¡ï¼Œä½¿å…¶æ›´æ”¹æ°¸ä¹…ç”Ÿæ•ˆã€‚ ROLLBACK å›æ»šå½“å‰äº‹åŠ¡ï¼Œå–æ¶ˆå…¶æ›´æ”¹ã€‚ SET autocommit ç¦ç”¨æˆ–å¯ç”¨å½“å‰ä¼šè¯çš„é»˜è®¤è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLä¸­å‡ ä¸ªé‡è¦çš„æ—¥å¿—","path":"/2020/03/12/MySQL-log/","content":"æœ¬æ–‡ä¸ºæå®¢æ—¶é—´ä¸“æ ã€ŠMySQLå®æˆ˜45è®²ã€‹ç¬”è®°ï¼Œæ–‡ä¸­éƒ¨åˆ†å›¾æ–‡æ¥è‡ªè¯¥ä¸“æ ã€‚ å‡ ä¸ªæ—¥å¿—çš„ä½œç”¨ é‡åšæ—¥å¿—ï¼ˆredo logï¼‰ï¼šç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§ã€‚é˜²æ­¢åœ¨å‘ç”Ÿæ•…éšœçš„æ—¶é—´ç‚¹ï¼Œå°šæœ‰è„é¡µæœªå†™å…¥ç£ç›˜ï¼Œåœ¨é‡å¯mysqlæœåŠ¡çš„æ—¶å€™ï¼Œæ ¹æ®redo logè¿›è¡Œé‡åšï¼Œä»è€Œè¾¾åˆ°äº‹åŠ¡çš„æŒä¹…æ€§è¿™ä¸€ç‰¹æ€§ã€‚ å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰ï¼šä¿å­˜äº†äº‹åŠ¡å‘ç”Ÿä¹‹å‰çš„æ•°æ®çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨äºå›æ»šï¼ŒåŒæ—¶å¯ä»¥æä¾›å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ä¸‹çš„è¯»ï¼ˆMVCCï¼‰ï¼Œå³éé”å®šè¯» äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰ï¼šç”¨äºå¤åˆ¶å’Œå¤‡ä»½ï¼Œåœ¨ä¸»ä»å¤åˆ¶ä¸­ï¼Œä»åº“åˆ©ç”¨ä¸»åº“ä¸Šçš„binlogè¿›è¡Œé‡æ’­ï¼Œå®ç°ä¸»ä»åŒæ­¥ã€‚ ä¹Ÿå¯åŸºäºæ—¶é—´ç‚¹åšæ•°æ®åº“çš„çš„è¿˜åŸã€‚ redo logåœ¨MySQLé‡Œï¼Œå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹IOæˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQLçš„è®¾è®¡è€…å°±ç”¨äº†WALæŠ€æœ¯ï¼ŒWALçš„å…¨ç§°æ˜¯Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€‚ å…·ä½“æ¥è¯´ï¼Œå½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDBå¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ°redo logé‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚åŒæ—¶ï¼ŒInnoDBå¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢ï¼Œè€Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åšã€‚ å¦å¤–ï¼ŒInnoDBçš„redo logæ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„4ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯1GBï¼Œé‚£ä¹ˆè¿™å—â€œç²‰æ¿â€æ€»å…±å°±å¯ä»¥è®°å½•4GBçš„æ“ä½œã€‚ä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾å°±åˆå›åˆ°å¼€å¤´å¾ªç¯å†™ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªå›¾æ‰€ç¤ºã€‚ write posæ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»ï¼Œå†™åˆ°ç¬¬3å·æ–‡ä»¶æœ«å°¾åå°±å›åˆ°0å·æ–‡ä»¶å¼€å¤´ã€‚checkpointæ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œä¹Ÿæ˜¯å¾€åæ¨ç§»å¹¶ä¸”å¾ªç¯çš„ï¼Œæ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶ã€‚ write poså’Œcheckpointä¹‹é—´çš„æ˜¯ç©ºç€çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æ–°çš„æ“ä½œã€‚å¦‚æœwrite posè¿½ä¸Šcheckpointï¼Œè¡¨ç¤ºæ»¡äº†ï¼Œè¿™æ—¶å€™ä¸èƒ½å†æ‰§è¡Œæ–°çš„æ›´æ–°ï¼Œå¾—åœä¸‹æ¥å…ˆæ“¦æ‰ä¸€äº›è®°å½•ï¼ŒæŠŠcheckpointæ¨è¿›ä¸€ä¸‹ã€‚ æœ‰äº†redo logï¼ŒInnoDBå°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸ºcrash-safeã€‚ undo logåœ¨æ•°æ®ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸ä»…è®°å½•äº†redo logï¼Œè¿˜è®°å½•äº†ç›¸å¯¹åº”çš„undo logï¼Œå¦‚æœå› ä¸ºæŸäº›åŸå› å¯¼è‡´äº‹åŠ¡å¤±è´¥æˆ–å›æ»šäº†ï¼Œå¯ä»¥å€ŸåŠ©undo logè¿›è¡Œå›æ»šã€‚ undo logå’Œredo logè®°å½•ç‰©ç†æ—¥å¿—ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯é€»è¾‘æ—¥å¿—ã€‚å¯ä»¥è®¤ä¸ºå½“deleteä¸€æ¡è®°å½•æ—¶ï¼Œundo logä¸­ä¼šè®°å½•ä¸€æ¡å¯¹åº”çš„insertè®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œå½“updateä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒè®°å½•ä¸€æ¡å¯¹åº”ç›¸åçš„updateè®°å½•ã€‚ å½“æ‰§è¡Œrollbackæ—¶ï¼Œå°±å¯ä»¥ä»undo logä¸­çš„é€»è¾‘è®°å½•è¯»å–åˆ°ç›¸åº”çš„å†…å®¹å¹¶è¿›è¡Œå›æ»šã€‚æœ‰æ—¶å€™åº”ç”¨åˆ°è¡Œç‰ˆæœ¬æ§åˆ¶çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯é€šè¿‡undo logæ¥å®ç°çš„ï¼šå½“è¯»å–çš„æŸä¸€è¡Œè¢«å…¶ä»–äº‹åŠ¡é”å®šæ—¶ï¼Œå®ƒå¯ä»¥ä»undo logä¸­åˆ†æå‡ºè¯¥è¡Œè®°å½•ä»¥å‰çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œä»è€Œæä¾›è¯¥è¡Œç‰ˆæœ¬ä¿¡æ¯ï¼Œè®©ç”¨æˆ·å®ç°éé”å®šä¸€è‡´æ€§è¯»å–ã€‚ undo logæ˜¯é‡‡ç”¨æ®µ(segment)çš„æ–¹å¼æ¥è®°å½•çš„ï¼Œæ¯ä¸ªundoæ“ä½œåœ¨è®°å½•çš„æ—¶å€™å ç”¨ä¸€ä¸ªundo log segmentã€‚ å¦å¤–ï¼Œundo logä¹Ÿä¼šäº§ç”Ÿredo logï¼Œå› ä¸ºundo logä¹Ÿè¦å®ç°æŒä¹…æ€§ä¿æŠ¤ã€‚ binlogMySQLæ•´ä½“æ¥çœ‹ï¼Œå…¶å®å°±æœ‰ä¸¤å—ï¼šä¸€å—æ˜¯Serverå±‚ï¼Œå®ƒä¸»è¦åšçš„æ˜¯MySQLåŠŸèƒ½å±‚é¢çš„äº‹æƒ…ï¼›è¿˜æœ‰ä¸€å—æ˜¯å¼•æ“å±‚ï¼Œè´Ÿè´£å­˜å‚¨ç›¸å…³çš„å…·ä½“äº‹å®œã€‚ä¸Šé¢æˆ‘ä»¬èŠåˆ°çš„redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„æ—¥å¿—ï¼Œè€ŒServerå±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸ºbinlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚ æˆ‘æƒ³ä½ è‚¯å®šä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä»½æ—¥å¿—å‘¢ï¼Ÿ å› ä¸ºæœ€å¼€å§‹MySQLé‡Œå¹¶æ²¡æœ‰InnoDBå¼•æ“ã€‚MySQLè‡ªå¸¦çš„å¼•æ“æ˜¯MyISAMï¼Œä½†æ˜¯MyISAMæ²¡æœ‰crash-safeçš„èƒ½åŠ›ï¼Œbinlogæ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€ŒInnoDBæ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥MySQLçš„ï¼Œæ—¢ç„¶åªä¾é binlogæ˜¯æ²¡æœ‰crash-safeèƒ½åŠ›çš„ï¼Œæ‰€ä»¥InnoDBä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿâ€”â€”ä¹Ÿå°±æ˜¯redo logæ¥å®ç°crash-safeèƒ½åŠ›ã€‚ è¿™ä¸¤ç§æ—¥å¿—æœ‰ä»¥ä¸‹ä¸‰ç‚¹ä¸åŒã€‚ redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„ï¼›binlogæ˜¯MySQLçš„Serverå±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚ redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ID=2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1 â€ã€‚ redo logæ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlogæ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡binlogæ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚ æœ‰äº†å¯¹è¿™ä¸¤ä¸ªæ—¥å¿—çš„æ¦‚å¿µæ€§ç†è§£ï¼Œæˆ‘ä»¬å†æ¥çœ‹æ‰§è¡Œå™¨å’ŒInnoDBå¼•æ“åœ¨æ‰§è¡Œè¿™ä¸ªç®€å•çš„updateè¯­å¥æ—¶çš„å†…éƒ¨æµç¨‹ã€‚ æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–ID=2è¿™ä¸€è¡Œã€‚IDæ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœID=2è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚ æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯Nï¼Œç°åœ¨å°±æ˜¯N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚ å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ°redo logé‡Œé¢ï¼Œæ­¤æ—¶redo logå¤„äºprepareçŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚ æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„binlogï¼Œå¹¶æŠŠbinlogå†™å…¥ç£ç›˜ã€‚ æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„redo logæ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚ è¿™é‡Œæˆ‘ç»™å‡ºè¿™ä¸ªupdateè¯­å¥çš„æ‰§è¡Œæµç¨‹å›¾ï¼Œå›¾ä¸­æµ…è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨InnoDBå†…éƒ¨æ‰§è¡Œçš„ï¼Œæ·±è‰²æ¡†è¡¨ç¤ºæ˜¯åœ¨æ‰§è¡Œå™¨ä¸­æ‰§è¡Œçš„ã€‚ å‚è€ƒæ–‡ç« ï¼šè¯¦ç»†åˆ†æMySQLäº‹åŠ¡æ—¥å¿—(redo logå’Œundo log)-https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html#auto_id_14","tags":["mysql"],"categories":["MySQL"]},{"title":"MySQLæ‰§è¡Œæµç¨‹è¯´æ˜","path":"/2020/03/11/MySQL-workon/","content":"MySQLçš„æ‰§è¡Œæµç¨‹ç¤ºæ„å›¾ï¼š å¤§ä½“æ¥è¯´ï¼ŒMySQLå¯ä»¥åˆ†ä¸ºServerå±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¸¤éƒ¨åˆ†ã€‚ Serverå±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›–MySQLçš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚ è€Œå­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå¸¸è§çš„æœ‰InnoDBã€MyISAMã€Memoryç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDBï¼Œä»MySQL 5.5.5ç‰ˆæœ¬å¼€å§‹å®ƒæˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚ ä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œä¸åŒçš„å­˜å‚¨å¼•æ“å…±ç”¨ä¸€ä¸ªServerå±‚ï¼Œä¹Ÿå°±æ˜¯ä»è¿æ¥å™¨åˆ°æ‰§è¡Œå™¨çš„éƒ¨åˆ†ã€‚ æˆ‘ä»¬ä¾æ¬¡çœ‹ä¸‹æ¯ä¸ªç»„ä»¶çš„ä½œç”¨ã€‚ è¿æ¥å™¨è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚è¿æ¥å‘½ä»¤ä¸€èˆ¬æ˜¯è¿™ä¹ˆå†™çš„ï¼š mysql -h $ip -P $port -u $user -p è¾“å®Œå‘½ä»¤ä¹‹åï¼Œä½ å°±éœ€è¦åœ¨äº¤äº’å¯¹è¯é‡Œé¢è¾“å…¥å¯†ç ã€‚ è¿æ¥å®Œæˆåï¼Œå¦‚æœä½ æ²¡æœ‰åç»­çš„åŠ¨ä½œï¼Œè¿™ä¸ªè¿æ¥å°±å¤„äºç©ºé—²çŠ¶æ€ï¼Œä½ å¯ä»¥åœ¨show processlistå‘½ä»¤ä¸­çœ‹åˆ°å®ƒã€‚ å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ªâ€Access denied for userâ€çš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚ è¿™å°±æ„å‘³ç€ï¼Œä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚ å®¢æˆ·ç«¯å¦‚æœå¤ªé•¿æ—¶é—´æ²¡åŠ¨é™ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚è¿™ä¸ªæ—¶é—´æ˜¯ç”±å‚æ•°wait_timeoutæ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯8å°æ—¶ã€‚ å¦‚æœåœ¨è¿æ¥è¢«æ–­å¼€ä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘é€è¯·æ±‚çš„è¯ï¼Œå°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯æé†’ï¼š Lost connection to MySQL server during queryã€‚è¿™æ—¶å€™å¦‚æœä½ è¦ç»§ç»­ï¼Œå°±éœ€è¦è¿›è¡Œé‡è¿æ“ä½œï¼Œç„¶åå†æ‰§è¡Œè¯·æ±‚ã€‚ è¿æ¥æ³¨æ„ç‚¹ï¼š é•¿è¿æ¥æ˜¯æŒ‡è¿æ¥æˆåŠŸåï¼Œå¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚ çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚ å»ºç«‹è¿æ¥çš„è¿‡ç¨‹é€šå¸¸æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ åœ¨ä½¿ç”¨ä¸­è¦å°½é‡å‡å°‘å»ºç«‹è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯å°½é‡ä½¿ç”¨é•¿è¿æ¥ã€‚ ä½†æ˜¯å…¨éƒ¨ä½¿ç”¨é•¿è¿æ¥åï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œæœ‰äº›æ—¶å€™MySQLå ç”¨å†…å­˜æ¶¨å¾—ç‰¹åˆ«å¿«ï¼Œè¿™æ˜¯å› ä¸ºMySQLåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ã€‚è¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ã€‚æ‰€ä»¥å¦‚æœé•¿è¿æ¥ç´¯ç§¯ä¸‹æ¥ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œæ€æ‰ï¼ˆOOMï¼‰ï¼Œä»ç°è±¡çœ‹å°±æ˜¯MySQLå¼‚å¸¸é‡å¯äº†ã€‚ æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆã€‚ å®šæœŸä¸»åŠ¨æ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢å†é‡è¿ã€‚ å¦‚æœä½ ç”¨çš„æ˜¯MySQL 5.7æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connectionæ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚ æŸ¥è¯¢ç¼“å­˜è¿æ¥å»ºç«‹å®Œæˆåï¼Œä½ å°±å¯ä»¥æ‰§è¡Œselectè¯­å¥äº†ã€‚æ‰§è¡Œé€»è¾‘å°±ä¼šæ¥åˆ°ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢ç¼“å­˜ã€‚ MySQLæ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå…ˆåˆ°æŸ¥è¯¢ç¼“å­˜çœ‹çœ‹ï¼Œä¹‹å‰æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥ã€‚ä¹‹å‰æ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥key-valueå¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚keyæ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalueæ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿç›´æ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ°keyï¼Œé‚£ä¹ˆè¿™ä¸ªvalueå°±ä¼šè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å¦‚æœè¯­å¥ä¸åœ¨æŸ¥è¯¢ç¼“å­˜ä¸­ï¼Œå°±ä¼šç»§ç»­åé¢çš„æ‰§è¡Œé˜¶æ®µã€‚æ‰§è¡Œå®Œæˆåï¼Œæ‰§è¡Œç»“æœä¼šè¢«å­˜å…¥æŸ¥è¯¢ç¼“å­˜ä¸­ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæŸ¥è¯¢å‘½ä¸­ç¼“å­˜ï¼ŒMySQLä¸éœ€è¦æ‰§è¡Œåé¢çš„å¤æ‚æ“ä½œï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœï¼Œè¿™ä¸ªæ•ˆç‡ä¼šå¾ˆé«˜ã€‚ ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä¼šå»ºè®®ä½ ä¸è¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©ã€‚ æŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å› æ­¤å¾ˆå¯èƒ½ä½ è´¹åŠ²åœ°æŠŠç»“æœå­˜èµ·æ¥ï¼Œè¿˜æ²¡ä½¿ç”¨å‘¢ï¼Œå°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†ã€‚å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚é™¤éä½ çš„ä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨ï¼Œå¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ï¼Œé‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚ å¥½åœ¨MySQLä¹Ÿæä¾›äº†è¿™ç§â€œæŒ‰éœ€ä½¿ç”¨â€çš„æ–¹å¼ã€‚ä½ å¯ä»¥å°†å‚æ•°query_cache_typeè®¾ç½®æˆDEMANDï¼Œè¿™æ ·å¯¹äºé»˜è®¤çš„SQLè¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚è€Œå¯¹äºä½ ç¡®å®šè¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥ï¼Œå¯ä»¥ç”¨SQL_CACHEæ˜¾å¼æŒ‡å®šï¼Œåƒä¸‹é¢è¿™ä¸ªè¯­å¥ä¸€æ ·ï¼š mysql&gt; select SQL_CACHE * from T where ID=10ï¼› éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 8.0ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´8.0å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚ åˆ†æå™¨å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±è¦å¼€å§‹çœŸæ­£æ‰§è¡Œè¯­å¥äº†ã€‚é¦–å…ˆï¼ŒMySQLéœ€è¦çŸ¥é“ä½ è¦åšä»€ä¹ˆï¼Œå› æ­¤éœ€è¦å¯¹SQLè¯­å¥åšè§£æã€‚ åˆ†æå™¨å…ˆä¼šåšâ€œè¯æ³•åˆ†æâ€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡SQLè¯­å¥ï¼ŒMySQLéœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚ MySQLä»ä½ è¾“å…¥çš„â€selectâ€è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®ƒä¹Ÿè¦æŠŠå­—ç¬¦ä¸²â€œTâ€è¯†åˆ«æˆâ€œè¡¨åTâ€ï¼ŒæŠŠå­—ç¬¦ä¸²â€œIDâ€è¯†åˆ«æˆâ€œåˆ—IDâ€ã€‚ åšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšâ€œè¯­æ³•åˆ†æâ€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ªSQLè¯­å¥æ˜¯å¦æ»¡è¶³MySQLè¯­æ³•ã€‚ å¦‚æœä½ çš„è¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ°â€œYou have an error in your SQL syntaxâ€çš„é”™è¯¯æé†’ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥selectå°‘æ‰“äº†å¼€å¤´çš„å­—æ¯â€œsâ€ã€‚ mysql&gt; elect * from t where id=1;ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;elect * from t where ID=1&#x27; at line 1 ä¸€èˆ¬è¯­æ³•é”™è¯¯ä¼šæç¤ºç¬¬ä¸€ä¸ªå‡ºç°é”™è¯¯çš„ä½ç½®ï¼Œæ‰€ä»¥ä½ è¦å…³æ³¨çš„æ˜¯ç´§æ¥â€œuse nearâ€çš„å†…å®¹ã€‚ ä¼˜åŒ–å™¨ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚ ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºã€‚ ä¼˜åŒ–å™¨é˜¶æ®µå®Œæˆåï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ–¹æ¡ˆå°±ç¡®å®šä¸‹æ¥äº†ï¼Œç„¶åè¿›å…¥æ‰§è¡Œå™¨é˜¶æ®µã€‚å¦‚æœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®ï¼Œæ¯”å¦‚ä¼˜åŒ–å™¨æ˜¯æ€ä¹ˆé€‰æ‹©ç´¢å¼•çš„ï¼Œæœ‰æ²¡æœ‰å¯èƒ½é€‰æ‹©é”™ç­‰ç­‰ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­å•ç‹¬å±•å¼€è¯´æ˜ä¼˜åŒ–å™¨çš„å†…å®¹ã€‚ æ‰§è¡Œå™¨MySQLé€šè¿‡åˆ†æå™¨çŸ¥é“äº†ä½ è¦åšä»€ä¹ˆï¼Œé€šè¿‡ä¼˜åŒ–å™¨çŸ¥é“äº†è¯¥æ€ä¹ˆåšï¼Œäºæ˜¯å°±è¿›å…¥äº†æ‰§è¡Œå™¨é˜¶æ®µï¼Œå¼€å§‹æ‰§è¡Œè¯­å¥ã€‚ å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨Tæœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤º(åœ¨å·¥ç¨‹å®ç°ä¸Šï¼Œå¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œä¼šåœ¨æŸ¥è¯¢ç¼“å­˜è¿”å›ç»“æœçš„æ—¶å€™ï¼Œåšæƒé™éªŒè¯ã€‚æŸ¥è¯¢ä¹Ÿä¼šåœ¨ä¼˜åŒ–å™¨ä¹‹å‰è°ƒç”¨precheckéªŒè¯æƒé™)ã€‚ mysql&gt; select * from T where ID=10;ERROR 1142 (42000): SELECT command denied to user &#x27;b&#x27;@&#x27;localhost&#x27; for table &#x27;T&#x27; å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚ æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­çš„è¡¨Tä¸­ï¼ŒIDå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š è°ƒç”¨InnoDBå¼•æ“æ¥å£å–è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼Œåˆ¤æ–­IDå€¼æ˜¯ä¸æ˜¯10ï¼Œå¦‚æœä¸æ˜¯åˆ™è·³è¿‡ï¼Œå¦‚æœæ˜¯åˆ™å°†è¿™è¡Œå­˜åœ¨ç»“æœé›†ä¸­ï¼› è°ƒç”¨å¼•æ“æ¥å£å–â€œä¸‹ä¸€è¡Œâ€ï¼Œé‡å¤ç›¸åŒçš„åˆ¤æ–­é€»è¾‘ï¼Œç›´åˆ°å–åˆ°è¿™ä¸ªè¡¨çš„æœ€åä¸€è¡Œã€‚ æ‰§è¡Œå™¨å°†ä¸Šè¿°éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è¡Œç»„æˆçš„è®°å½•é›†ä½œä¸ºç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ è‡³æ­¤ï¼Œè¿™ä¸ªè¯­å¥å°±æ‰§è¡Œå®Œæˆäº†ã€‚ å¯¹äºæœ‰ç´¢å¼•çš„è¡¨ï¼Œæ‰§è¡Œçš„é€»è¾‘ä¹Ÿå·®ä¸å¤šã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ˜¯â€œå–æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€è¡Œâ€è¿™ä¸ªæ¥å£ï¼Œä¹‹åå¾ªç¯å–â€œæ»¡è¶³æ¡ä»¶çš„ä¸‹ä¸€è¡Œâ€è¿™ä¸ªæ¥å£ï¼Œè¿™äº›æ¥å£éƒ½æ˜¯å¼•æ“ä¸­å·²ç»å®šä¹‰å¥½çš„ã€‚","tags":["mysql"],"categories":["MySQL"]},{"title":"ElementUIå¤šå›¾æ‹–æ‹½","path":"/2020/02/27/228/","content":"å‡†å¤‡ yarn add vuedraggableornpm i -S vuedraggable ä»£ç ç¤ºä¾‹&lt;template&gt; &lt;div&gt; &lt;el-row style=&quot;margin-top: 20px;&quot;&gt; &lt;el-col :span=&quot;20&quot; :offset=&quot;2&quot;&gt; &lt;el-form-item label=&quot;é¢„è§ˆ&quot; prop=&quot;desc&quot;&gt; &lt;div class=&quot;image-list&quot;&gt; &lt;draggable v-model=&quot;showImgList&quot; @change=&quot;dragChange&quot;&gt; &lt;div v-for=&quot;(image, index) in showImgList&quot; :key=&quot;index&quot; class=&quot;image-wrap&quot;&gt; &lt;img :src=&quot;image&quot; :style=&quot;imgStyle&quot; /&gt; &lt;div class=&quot;icon-wrap&quot; @click.stop=&quot;removeFile(index)&quot;&gt; &lt;i class=&quot;el-icon-delete&quot;&gt;&lt;/i&gt; &lt;/div&gt; &lt;/div&gt; &lt;el-upload ref=&quot;imageListUpload&quot; :action=&quot;$uploadPicUrl&quot; :headers=&quot;header&quot; :before-upload=&quot;beforeUpload&quot; :on-success=&quot;uploadSuccess&quot; class=&quot;image-uploader&quot; :on-error=&quot;onError&quot; multiple :show-file-list=&quot;false&quot; accept=&quot;image/*&quot;&gt; &lt;i :class=&quot;loading ? &#x27;el-icon-loading&#x27; : &#x27;el-icon-plus&#x27;&quot; :style=&quot;imgStyle&quot;&gt;&lt;/i&gt; &lt;/el-upload&gt; &lt;/draggable&gt; &lt;/div&gt; &lt;/el-form-item&gt; &lt;/el-col&gt; &lt;/el-row&gt; &lt;/div&gt;&lt;/template&gt;&lt;style&gt;.ql-container .ql-editor&#123; height:400px;&#125;.avatar-uploader .el-upload &#123; height: 180px; width: 180px; overflow: hidden;&#125;.avatar-uploader img &#123; height: 180px; width: 180px;&#125;.avatar-uploader .avatar-uploader-icon &#123; border: 1px dashed #d9d9d9; border-radius: 6px; cursor: pointer; font-size: 28px; color: #8c939d; width: 178px; height: 178px; line-height: 178px; text-align: center;&#125;#video .video &#123; max-width: 300px; max-height: 200px;&#125;.avatar &#123; width: 178px; height: 178px; display: block;&#125;.avatar-uploader img &#123; height: 180px; width: 180px;&#125;.ql-editor&#123; height:400px;&#125;.ql-snow .ql-picker &#123; height: auto;&#125;.image-list,.image-item &#123; display: flex;&#125;.image-list .image-wrap,.image-item .image-wrap &#123; position: relative; display: inline-block; box-sizing: content-box; margin: 0 8px 8px 0; vertical-align: top;&#125;.image-list .image-wrap:hover .icon-wrap,.image-item .image-wrap:hover .icon-wrap &#123; opacity: 1;&#125;.image-list .image-wrap .icon-wrap,.image-item .image-wrap .icon-wrap &#123; position: absolute; left: 0; bottom: 0; width: 100%; height: 30px; cursor: default; text-align: center; color: #fff; opacity: 0; font-size: 20px; background-color: rgba(0, 0, 0, 0.7); transition: opacity .3s;&#125;.image-list .image-wrap .icon-wrap .el-icon-zoom-in,.image-item .image-wrap .icon-wrap .el-icon-zoom-in &#123; cursor: pointer; margin-right: 8px;&#125;.image-list .image-wrap .icon-wrap .el-icon-delete,.image-item .image-wrap .icon-wrap .el-icon-delete &#123; cursor: pointer;&#125;.image-item &#123; display: inline-flex;&#125;.image-uploader &#123; display: inline-block;&#125;.image-uploader .el-upload &#123; border: 1px dashed #d9d9d9; border-radius: 6px; cursor: pointer; position: relative; overflow: hidden;&#125;.image-uploader .el-upload [class^=&quot;el-icon&quot;] &#123; font-size: 28px; color: #8c939d; text-align: center;&#125;.image-uploader .el-upload:hover &#123; border-color: #409EFF;&#125;&lt;/style&gt;&lt;script&gt;import draggable from &#x27;vuedraggable&#x27;export default &#123; components: &#123; draggable, &#125;, data() &#123; return &#123; showImgList: [], loading: false, &#125; &#125;, created() &#123; if (this.$route.params.id &gt; 0) &#123; this.getInfo(this.$route.params.id) this.goodsForm.id = this.$route.params.id; &#125; else &#123; this.responseVisible = false; &#125; &#125;, computed: &#123; imgStyle() &#123; return &#123; width: &#x27;180px&#x27;, height: &#x27;180px&#x27;, lineHeight: &#x27;180px&#x27;, &#125; &#125; &#125;, mounted() &#123; // ä¸ºå›¾ç‰‡ICONç»‘å®šäº‹ä»¶ getModule ä¸ºç¼–è¾‘å™¨çš„å†…éƒ¨å±æ€§ // this.$refs.myQuillEditor.quill.getModule(&#x27;toolbar&#x27;).addHandler(&#x27;image&#x27;, this.imgHandler) // this.$refs.myQuillEditor.quill.getModule(&#x27;toolbar&#x27;).addHandler(&#x27;video&#x27;, this.insertVideo) // ä¸ºè§†é¢‘ICONç»‘å®šäº‹ä»¶ &#125;, methods: &#123; beforeUpload(file) &#123; if (file.type.split(&#x27;/&#x27;)[0] === &#x27;image&#x27;) &#123; let tempSize = file.size / 1024 / 1024 / 2; if (tempSize &gt; 1) &#123; this.$message.error(&#x27;å›¾ç‰‡å°ºå¯¸ä¸å¾—å¤§äº2Mï¼&#x27;); return false; &#125; &#125; else &#123; this.$message.error(&#x27;è¯·ä¸Šä¼ å›¾ç‰‡æ ¼å¼ï¼ˆjpgã€pngã€gifï¼‰&#x27;); return false; &#125; &#125;, getInfo(id) &#123; var _self = this; projectInfo(id).then(function(res)&#123; _self.goodsForm = res.data.data; _self.goodsForm.start_time = timestampToDate(_self.goodsForm.start_time); _self.goodsForm.over_time = timestampToDate(_self.goodsForm.over_time); _self.showImgList = _self.goodsForm.desc.split(&quot;|&quot;); _self.responseVisible = false; &#125;).catch(function(error)&#123; console.log(error); &#125;) &#125;, handleRemove(file, fileList) &#123; console.log(file, fileList); &#125;, uploadSuccess(response, file, fileList) &#123; try &#123; for (let fileInfo of fileList) &#123; if (this.type === &#x27;image&#x27;) &#123; this.imgUrl = response.key this.$emit(&#x27;update:data&#x27;, response.key) &#125; else &#123; if (this.showImgList.length &gt;= this.limit) &#123; // é™åˆ¶å›¾ç‰‡å¼ æ•° this.showImgList.length = this.limit throw(new Error(`æœ€å¤šä¸Šä¼  $&#123;this.limit&#125; å¼ å›¾ç‰‡`)) &#125; this.showImgList.push(response.data.filepath) this.$emit(&#x27;update:data&#x27;, this.showImgList) &#125; &#125; &#125; catch (error) &#123; this.$message.error(error.message) &#125; finally &#123; this.loading = false this.$refs.imageListUpload &amp;&amp; this.$refs.imageListUpload.clearFiles() this.$refs.imageUpload &amp;&amp; this.$refs.imageUpload.clearFiles() &#125; &#125;, removeFile(index) &#123; this.$confirm(&#x27;ç¡®å®šåˆ é™¤è¯¥å›¾ç‰‡å—?&#x27;, &#x27;æç¤º&#x27;, &#123; confirmButtonText: &#x27;ç¡®å®š&#x27;, cancelButtonText: &#x27;å–æ¶ˆ&#x27;, type: &#x27;warning&#x27; &#125;).then(() =&gt; &#123; if (this.type === &#x27;image&#x27;) &#123; this.$emit(&#x27;update:data&#x27;, typeof this.data === &#x27;object&#x27; ? &#123;&#125; : &#x27;&#x27;) &#125; else &#123; this.showImgList.splice(index, 1) this.$emit(&#x27;update:data&#x27;, this.showImgList) &#125; &#125;) &#125;, onError() &#123; this.$message.error(&#x27;ä¸Šä¼ æ–‡ä»¶å¤±è´¥&#x27;) &#125;, dragChange(ele) &#123; console(ele.moved) &#125;, handleRemove(file, fileList) &#123; let imgList = fileList.map(item =&gt; &#123; return item.response.key &#125;) this.$emit(&#x27;update:data&#x27;, imgList) &#125;, &#125;&#125;&lt;/script&gt; æ³¨æ„åŠ¡å¿…æ³¨å†Œå¼•å…¥ç»„ä»¶ import draggable from &#x27;vuedraggable&#x27;export default &#123; ... components: &#123; draggable, &#125;, ...","tags":["ElementUI"],"categories":["vue"]},{"title":"åº”ç”¨ç¯‡ï¼š2.å»¶æ—¶ä»»åŠ¡","path":"/2020/02/22/phpframe14/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ å»¶æ—¶ä»»åŠ¡æœ‰åˆ«äºå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡å¾€å¾€æ˜¯å›ºå®šå‘¨æœŸçš„ï¼Œæœ‰æ˜ç¡®çš„è§¦å‘æ—¶é—´ã€‚è€Œå»¶æ—¶ä»»åŠ¡ä¸€èˆ¬æ²¡æœ‰å›ºå®šçš„å¼€å§‹æ—¶é—´ï¼Œå®ƒå¸¸å¸¸æ˜¯ç”±ä¸€ä¸ªäº‹ä»¶è§¦å‘çš„ï¼Œè€Œåœ¨è¿™ä¸ªäº‹ä»¶è§¦å‘ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…è§¦å‘å¦ä¸€ä¸ªäº‹ä»¶ã€‚ æˆ‘ä»¬ä¸å¦¨æ¥è®¾å®šä¸€ä¸ªå®é™…çš„åœºæ™¯ï¼Œç”µå•†ç³»ç»Ÿä¸‹å•æˆåŠŸä¹‹åå¦‚æœ15åˆ†é’Ÿæœªæ”¯ä»˜æˆåŠŸï¼Œå°±ç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆè®¢å•ã€‚ æˆ‘ä»¬å…ˆæ¥å®ç°ä»£ç ï¼Œç„¶åå†æ¥è¯¦ç»†è¯´æ˜ï¼š // æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªabstractï¼Œå®šä¹‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒstartAfterå’ŒstartAt&lt;?phpabstract class DelayTask&#123; const DELAY_TASK = &#x27;delayTask&#x27;; /** * å»¶æ—¶æ—¶é—´ï¼Œåœ¨è§¦å‘æ—¶é—´åå¤šä¹…æ‰§è¡Œ * @param $pushDelayTime */ public function startAfter(int $pushDelayTime) &#123; RedisManager::getRedis()-&gt;zAdd(self::DELAY_TASK, time() + $pushDelayTime, serialize($this)); &#125; /** * å®šæ—¶æ—¶é—´ï¼Œåœ¨æœªæ¥æŸæ—¶åˆ»æ‰§è¡Œ * @param $pushDelayAt */ public function startAt(int $pushDelayAt) &#123; RedisManager::getRedis()-&gt;zAdd(self::DELAY_TASK, $pushDelayAt, serialize($this)); &#125; abstract function run();&#125;class TestDelayTask extends DelayTask&#123; public function __construct($id) &#123; $this-&gt;id = $id; &#125; public function run() &#123; $file = &#x27;text.txt&#x27;;//è¦å†™å…¥æ–‡ä»¶çš„æ–‡ä»¶åï¼ˆå¯ä»¥æ˜¯ä»»æ„æ–‡ä»¶åï¼‰ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä¼šåˆ›å»ºä¸€ä¸ª $content = &quot;å†™å…¥çš„å†…å®¹&quot;.time().&quot; &quot;; if($f = file_put_contents($file, $content,FILE_APPEND))&#123;// è¿™ä¸ªå‡½æ•°æ”¯æŒç‰ˆæœ¬(PHP 5) echo &quot;å†™å…¥æˆåŠŸã€‚&lt;br /&gt;&quot;; &#125; &#125;&#125; RedisManageræ˜¯å°è£…çš„ä¸€ä¸ªå•ä¾‹æ¨¡å¼å®ç°çš„Redisç±»ï¼Œæˆ‘ä»¬ä¹Ÿè´´å‡ºä»£ç ï¼Œç„¶åå†å¯¹ä¸Šé¢çš„ä»£ç åšä¸€äº›è¯´æ˜ã€‚ &lt;?phpclass RedisManager&#123; private static $instance = null; private function __construct() &#123; self::$instance = new \\Redis(); $config = require &#x27;Redis.config.php&#x27;; self::$instance-&gt;connect($config[&#x27;host&#x27;], $config[&#x27;port&#x27;], $config[&#x27;timeout&#x27;]); if (isset($config[&#x27;password&#x27;])) &#123; self::$instance-&gt;auth($config[&#x27;password&#x27;]); &#125; &#125; /** * è·å–é™æ€å®ä¾‹ */ public static function getRedis() &#123; if (!self::$instance) &#123; new self; &#125; return self::$instance; &#125; /** * ç¦æ­¢clone */ private function __clone() &#123; &#125;&#125; æœ‰åºé›†åˆRedis 127.0.0.1:6379&gt; ZADD saif 1 Redis(integer) 1Redis 127.0.0.1:6379&gt; ZADD saif 2 mongodb(integer) 1Redis 127.0.0.1:6379&gt; ZADD saif 4 mysql(integer) 0Redis 127.0.0.1:6379&gt; ZRANGE saif 0 10 WITHSCORES1) &quot;Redis&quot;2) &quot;1&quot;3) &quot;mongodb&quot;4) &quot;2&quot;5) &quot;mysql&quot;6) &quot;4&quot; å¦‚æœä½ æœ‰Rediså¯è§†åŒ–å·¥å…·ï¼Œä½ ä¼šå‘ç°æœ‰åºé›†åˆå­˜å‚¨çš„ç»“æ„æ˜¯è¿™æ ·ï¼š row value score 1 Redis 1 2 mongodb 2 3 mysql 4 æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºåˆ†å€¼ï¼Œä½¿ç”¨å¯¹è±¡ä½œä¸ºå€¼ï¼Œå­˜å‚¨åˆ°Redisæœ‰åºé›†åˆã€‚ file_put_contents ( string $filename , mixed $data [, int $flags = 0 [, resource $context ]] ) : int â€” å°†ä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ æ‰§è¡Œæˆ‘ä»¬å…ˆå°è¯•å†™å…¥ä»»åŠ¡ï¼š(new TestDelayTask(4))-&gt;startAfter(900);(new TestDelayTask(4))-&gt;startAfter(120);(new TestDelayTask(4))-&gt;startAfter(600);(new TestDelayTask(3))-&gt;startAt(158120384);(new TestDelayTask(3))-&gt;startAt(158420380);(new TestDelayTask(3))-&gt;startAt(158120900); æ‰§è¡Œä»£ç ï¼š class DelayTaskTask&#123; const QueneName = &#x27;delayTask&#x27;; private $currentTime; private $once = 5; public function run() &#123; $this-&gt;currentTime = time(); error_reporting(error_reporting() &amp; ~E_WARNING); while (true) &#123; // æ¯æ¬¡å–å‡º5æ¡ $list = RedisManager::getRedis()-&gt;zRange(self::QueneName, 0, $this-&gt;once, true); if (!empty($list)) &#123; foreach ($list as $val=&gt;$score) &#123; if ($score &lt; $this-&gt;currentTime) &#123; unserialize($val)-&gt;run(); RedisManager::getRedis()-&gt;zDelete(self::QueneName, $val); &#125; else &#123; break 2; &#125; &#125; &#125; else &#123; break; &#125; &#125; &#125;&#125;(new DelayTaskTask())-&gt;run(); æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ä¸Šè¿°ä»£ç ã€‚ æˆ‘ä»¬æ‰§è¡Œä¹‹åï¼Œä¼šå‘ç°ä¸€æ—¦è¿‡äº†æˆ‘ä»¬è®¾å®šçš„æ—¶é—´ï¼Œtext.txtå°±ä¸æ–­æœ‰æ–‡å­—å†™å…¥äº†ã€‚ ä»£ç æ¯”è¾ƒæ‚ï¼Œæˆ‘æœ‰ä¸€ä¸ªdemoä»£ç ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹ã€‚ DelayTask-åŸºäºRedisçš„å»¶æ—¶ä»»åŠ¡ è¿™æ ·ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨Redisæœ‰åºé›†åˆï¼Œå®Œæˆäº†ä¸€ä¸ªå¾ˆåŸºç¡€çš„å»¶æ—¶ä»»åŠ¡ã€‚ é—®é¢˜ åŠ å…¥runæ–¹æ³•ä»£ç æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œé—´éš”æœ‰ç‚¹é•¿ï¼Œèƒ½ä¸èƒ½ä¼˜åŒ–å‘¢ï¼Ÿ","tags":["phpframe"],"categories":["phpframe"]},{"title":"åº”ç”¨ç¯‡ï¼š1.åˆ†å¸ƒå¼é”","path":"/2020/02/22/phpframe13/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ å«ä¹‰ ä¸ºäº†é˜²æ­¢åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ä¹‹é—´ç›¸äº’å¹²æ‰°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§åˆ†å¸ƒå¼åè°ƒæŠ€æœ¯æ¥å¯¹è¿™äº›è¿›ç¨‹è¿›è¡Œè°ƒåº¦ã€‚è€Œè¿™ä¸ªåˆ†å¸ƒå¼åè°ƒæŠ€æœ¯çš„æ ¸å¿ƒå°±æ˜¯æ¥å®ç°è¿™ä¸ªåˆ†å¸ƒå¼é”ã€‚ åˆ†æ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ é«˜å¯ç”¨çš„è·å–é”ä¸é‡Šæ”¾é” é«˜æ€§èƒ½çš„è·å–é”ä¸é‡Šæ”¾é” å…·å¤‡å¯é‡å…¥ç‰¹æ€§ï¼ˆå¯ç†è§£ä¸ºé‡æ–°è¿›å…¥ï¼Œç”±å¤šäºä¸€ä¸ªä»»åŠ¡å¹¶å‘ä½¿ç”¨ï¼Œè€Œä¸å¿…æ‹…å¿ƒæ•°æ®é”™è¯¯ï¼‰ å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ­»é” å…·å¤‡éé˜»å¡é”ç‰¹æ€§ï¼Œå³æ²¡æœ‰è·å–åˆ°é”å°†ç›´æ¥è¿”å›è·å–é”å¤±è´¥ å®ç°æ–¹å¼å¸¸è§çš„æœ‰ï¼š åŸºäºRedis åŸºäºmysql åŸºäºZookeeper å…·ä½“å®ç°è€ƒè™‘åˆ°æˆ‘ä»¬ä½¿ç”¨çš„PHPè¯­è¨€ï¼Œç®€å•ç»“åˆRedisæ¥å®ç°ä¸€ä¸‹åˆ†å¸ƒå¼é”ã€‚ æˆ‘ä»¬æ¥ç”»ä¸ªç®€å•çš„åŸç†å›¾ï¼š åŸç†ååˆ†ç®€å•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç°å‘¢ï¼Ÿ è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š Redisçš„setnxæ–¹æ³• phpçš„register function processLock($Redis, $key, $ttl = 5)&#123; $ret = $Redis-&gt;setnx($key, 1); if ($ret) &#123; $Redis-&gt;expire($key, $ttl); register_shutdown_function(function () use ($Redis, $key)&#123; $Redis-&gt;del($key); &#125;); &#125; return $ret;&#125; demoé‡Œçš„$Redisæ˜¯ä¸€ä¸ªRediså®ä¾‹ï¼Œæˆ‘ä»¬åœ¨å‰é¢å·²ç»å®ç°è¿‡ï¼Œä¸å¤šè¯´æ˜ã€‚ åŠ é”æˆ‘ä»¬ä½¿ç”¨çš„setnxå‘½ä»¤ï¼Œsenxè¡¨ç¤ºâ€œSET if Not eXistsâ€ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™setï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¸set Redis&gt; SETNX mykey &quot;Hello&quot;(integer) 1Redis&gt; SETNX mykey &quot;World&quot;(integer) 0Redis&gt; GET mykey&quot;Hello&quot; è§£é”ä½¿ç”¨çš„æ˜¯delï¼Œå³åˆ é™¤è¿™ä¸ªkeyã€‚è¿™é‡Œç»“åˆäº† register_shutdown_function â€” æ³¨å†Œä¸€ä¸ªä¼šåœ¨phpä¸­æ­¢æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼Œè®¾ç½®äº†ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä¸å¿…æ‰‹åŠ¨å»è§£é” é”è¶…æ—¶è¿™é‡Œç»™é”åŠ äº†ä¸€ä¸ªexpireè¿‡æœŸæ—¶é—´5ç§’ï¼Œç›®çš„æ˜¯é˜²æ­¢ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¹‹åçš„æ‰§è¡Œäº†â€œç¥å¥‡â€ä»£ç æŠ›å‡ºäº†è¯­æ³•é”™è¯¯ï¼Œå¯¼è‡´register_shutdown_functioné‡Œçš„ä»£ç æ²¡æœ‰æ‰§è¡Œï¼Œè™½ç„¶è¯·æ±‚ç»“æŸï¼Œä½†æ˜¯åŠ é”åï¼Œæ²¡æœ‰è§£é”ï¼Œå½±å“äº†åç»­è¯·æ±‚ã€‚ é—®é¢˜ åŠ å…¥setnxä¹‹åexpireä¹‹å‰ç¨‹åºå¼‚å¸¸äº†æ€ä¹ˆåŠï¼Ÿ","tags":["phpframe"],"categories":["phpframe"]},{"title":"RedisæŒä¹…åŒ–aofå’Œrdb","path":"/2020/02/16/aof/","content":"RedisæŒä¹…æŒä¹…åŒ–çš„åŠŸèƒ½:Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†é¿å…è¿›ç¨‹é€€å‡ºå¯¼è‡´æ•°æ®çš„æ°¸ä¹…ä¸¢å¤±ï¼Œéœ€è¦å®šæœŸå°†Redisä¸­çš„æ•°æ®ä»¥æŸç§å½¢å¼(æ•°æ®æˆ–å‘½ä»¤) ä»å†…å­˜ä¿å­˜åˆ°ç¡¬ç›˜ã€‚ å½“ä¸‹æ¬¡Redisé‡å¯æ—¶ï¼Œåˆ©ç”¨æŒä¹…åŒ–æ–‡ä»¶å®ç°æ•°æ®æ¢å¤ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†è¿›è¡Œç¾éš¾å¤‡ä»½ï¼Œå¯ä»¥å°†æŒä¹…åŒ–æ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚ RedisæŒä¹…åŒ–åˆ†ä¸ºRDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–ï¼Œå‰è€…å°†å½“å‰æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ï¼Œåè€…åˆ™æ˜¯å°†æ¯æ¬¡æ‰§è¡Œçš„å†™å‘½ä»¤ä¿å­˜åˆ°ç¡¬ç›˜ã€‚ RDB RDBæ˜¯ä¸€ç§å¿«ç…§å­˜å‚¨æŒä¹…åŒ–æ–¹å¼ï¼Œå…·ä½“å°±æ˜¯å°†RedisæŸä¸€æ—¶åˆ»çš„å†…å­˜æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜çš„æ–‡ä»¶å½“ä¸­ï¼Œé»˜è®¤ä¿å­˜çš„æ–‡ä»¶åä¸ºdump.rdbï¼Œè€Œåœ¨RedisæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œä¼šé‡æ–°åŠ è½½dump.rdbæ–‡ä»¶çš„æ•°æ®åˆ°å†…å­˜å½“ä¸­æ¢å¤æ•°æ®ã€‚ ï¼Œè§¦å‘ RDB æŒä¹…åŒ–è¿‡ç¨‹åˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ã€‚ è§¦å‘æœºåˆ¶save å‘½ä»¤:é˜»å¡å½“å‰ Redis æœåŠ¡å™¨ï¼Œç›´åˆ° RDB è¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜æ¯”è¾ƒå¤§çš„å®ä¾‹ä¼šé€ æˆé•¿æ—¶é—´é˜»å¡ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚ bgsave å‘½ä»¤:Redis è¿›ç¨‹æ‰§è¡Œ fork æ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼ŒRDB æŒä¹…åŒ–è¿‡ç¨‹ç”±å­è¿›ç¨‹è´Ÿè´£ï¼Œå®Œæˆåè‡ªåŠ¨ç»“æŸã€‚é˜»å¡åªå‘ç”Ÿåœ¨ fork é˜¶æ®µï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­ã€‚ æ˜¾ç„¶ bgsave å‘½ä»¤æ˜¯é’ˆå¯¹ saveé˜»å¡é—®é¢˜åšçš„ä¼˜åŒ–ã€‚å› æ­¤ Redis å†…éƒ¨æ‰€æœ‰çš„æ¶‰åŠ RDB çš„æ“ä½œéƒ½é‡‡ç”¨ bgsave çš„æ–¹å¼ã€‚ é™¤äº†æ‰§è¡Œå‘½ä»¤æ‰‹åŠ¨è§¦å‘ä¹‹å¤–ï¼ŒRedis å†…éƒ¨è¿˜å­˜åœ¨è‡ªåŠ¨è§¦å‘ RDB çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œä¾‹å¦‚ä»¥ä¸‹åœºæ™¯: ä½¿ç”¨ save ç›¸å…³é…ç½®ï¼Œå¦‚â€œsave m nâ€ã€‚è¡¨ç¤º m ç§’å†…æ•°æ®é›†å­˜åœ¨ n æ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ bgsaveã€‚ å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œ bgsave ç”Ÿæˆ RDB æ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚ æ‰§è¡Œ debug reload å‘½ä»¤é‡æ–°åŠ è½½ Redis æ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨è§¦å‘ save æ“ä½œã€‚ é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œ shutdown å‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½åˆ™è‡ªåŠ¨æ‰§è¡Œ bgsaveã€‚ bgsaveæµç¨‹ æ‰§è¡Œ bgsave å‘½ä»¤ï¼ŒRedis çˆ¶è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚ RDB/AOF å­è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ bgsave å‘½ä»¤ç›´æ¥è¿”å›ã€‚ çˆ¶è¿›ç¨‹æ‰§è¡Œ fork æ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œforkæ“ä½œè¿‡ç¨‹ä¸­çˆ¶è¿›ç¨‹ä¼šé˜»å¡ã€‚ çˆ¶è¿›ç¨‹ fork å®Œæˆåï¼Œbgsave å‘½ä»¤è¿”å›â€œBackground saving startedâ€ä¿¡æ¯å¹¶ä¸å†é˜»å¡çˆ¶è¿›ç¨‹ï¼Œå¯ä»¥ç»§ç»­å“åº”å…¶ä»–å‘½ä»¤ã€‚ å­è¿›ç¨‹ä¼šå…±äº«ä¸€éƒ¨åˆ†ä¸»è¿›ç¨‹çš„æ•°æ®ç©ºé—´ï¼Œå¹¶ä¸”æŠŠå…±äº«çš„æ•°æ®ç½®ä¸ºread-onlyçš„çŠ¶æ€ï¼Œå­è¿›ç¨‹åˆ›å»º RDB æ–‡ä»¶ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶ï¼Œå®Œæˆåå¯¹åŸæœ‰æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢ã€‚åœ¨æŒä¹…åŒ–çš„è¿‡ç¨‹ä¸­æ˜¯é¿å…ä¸äº†æœ‰æ–°çš„æ•°æ®å†™å…¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€éƒ¨åˆ†çš„æ•°æ®æ˜¯å…±äº«çš„ï¼Œä¸¤ä¸ªè¿›ç¨‹åŒæ—¶æ‹¥æœ‰ä¸€å—æ•°æ®ï¼Œè‚¯å®šä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œ ä½†æ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„forkæœºåˆ¶ï¼Œåœ¨ä¿®æ”¹çš„æ—¶å€™ä¸€å®šæ˜¯ä¿®æ”¹éƒ¨åˆ†å†…å­˜é¡µçš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè§¦å‘å¯¹åº”å†…å­˜é¡µçš„copyonwriteçš„æ“ä½œ è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚ é…ç½®æ–‡ä»¶ï¼ˆæµç¨‹ç±»ä¼¼bgsaveï¼‰# 900så†…è‡³å°‘è¾¾åˆ°ä¸€æ¡å†™å‘½ä»¤ save 900 1# 300så†…è‡³å°‘è¾¾è‡³10æ¡å†™å‘½ä»¤ save 300 10# 60så†…è‡³å°‘è¾¾åˆ°10000æ¡å†™å‘½ä»¤ save 60 10000 RDB æ–‡ä»¶çš„å¤„ç†1. ä¿å­˜:RDB æ–‡ä»¶ä¿å­˜åœ¨ dir é…ç½®æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åé€šè¿‡ dbfilename é…ç½®æŒ‡å®šã€‚å¯ä»¥é€šè¿‡æ‰§è¡Œ config set dir{newDir}å’Œ config setdbfilename{newFileName}è¿è¡ŒæœŸåŠ¨æ€æ‰§è¡Œï¼Œå½“ä¸‹æ¬¡è¿è¡Œæ—¶ RDB æ–‡ä»¶ä¼šä¿å­˜åˆ°æ–°ç›®å½•ã€‚å½“é‡åˆ°åç›˜æˆ–ç£ç›˜å†™æ»¡ç­‰æƒ…å†µæ—¶ï¼Œå¯ä»¥é€šè¿‡ config set dir{newDir}åœ¨çº¿ä¿®æ”¹æ–‡ä»¶è·¯å¾„åˆ°å¯ç”¨çš„ç£ç›˜è·¯å¾„ï¼Œä¹‹åæ‰§è¡Œ bgsave è¿›è¡Œç£ç›˜åˆ‡æ¢ï¼ŒåŒæ ·é€‚ç”¨äº AOF æŒä¹…åŒ–æ–‡ä»¶ã€‚ 2. å‹ç¼©:Redis é»˜è®¤é‡‡ç”¨ LZF ç®—æ³•å¯¹ç”Ÿæˆçš„ RDB æ–‡ä»¶åšå‹ç¼©å¤„ç†ï¼Œå‹ç¼©åçš„æ–‡ä»¶è¿œè¿œå°äºå†…å­˜å¤§å°ï¼Œé»˜è®¤å¼€å¯ï¼Œå¯ä»¥é€šè¿‡å‚æ•° config set rdbcompression{yes|no}åŠ¨æ€ä¿®æ”¹ã€‚è™½ç„¶å‹ç¼© RDB ä¼šæ¶ˆè€— CPUï¼Œä½†å¯å¤§å¹…é™ä½æ–‡ä»¶çš„ä½“ç§¯ï¼Œæ–¹ä¾¿ä¿å­˜åˆ°ç¡¬ç›˜æˆ–é€šè¿‡ç½‘ç»œå‘é€ç»™ä»èŠ‚ç‚¹ï¼Œå› æ­¤çº¿ä¸Šå»ºè®®å¼€å¯ã€‚ RDBæ–¹å¼çš„ä¼˜ç‚¹ RDB æ˜¯ä¸€ä¸ªéå¸¸ç´§å‡‘çš„æ–‡ä»¶ï¼Œå®ƒä¿å­˜äº† Redis åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®é›†ã€‚è¿™ç§æ–‡ä»¶éå¸¸é€‚åˆç”¨äºè¿›è¡Œå¤‡ä»½: æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥åœ¨æœ€è¿‘çš„ 24å°æ—¶å†…ï¼Œæ¯å°æ—¶å¤‡ä»½ä¸€æ¬¡ RDBæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæœˆçš„æ¯ä¸€å¤©ï¼Œä¹Ÿå¤‡ä»½ä¸€ä¸ª RDB æ–‡ä»¶ã€‚ è¿™æ ·çš„è¯ï¼Œå³ä½¿é‡ä¸Šé—®é¢˜ï¼Œä¹Ÿå¯ä»¥éšæ—¶å°†æ•°æ®é›†è¿˜åŸåˆ°ä¸åŒçš„ç‰ˆæœ¬ã€‚ RDB å¯ä»¥æœ€å¤§åŒ– Redis çš„æ€§èƒ½:çˆ¶è¿›ç¨‹åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶å”¯ä¸€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åè¿™ä¸ªå­è¿›ç¨‹å°±ä¼šå¤„ç†æ¥ä¸‹æ¥çš„æ‰€æœ‰ä¿å­˜ å·¥ä½œï¼Œçˆ¶è¿›ç¨‹æ— é¡»æ‰§è¡Œä»»ä½•ç£ç›˜ I/O æ“ä½œã€‚ RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚ RDBæ–¹å¼çš„ç¼ºç‚¹ RDB æ–¹å¼æ•°æ®æ²¡åŠæ³•åšåˆ°å®æ—¶æŒä¹…åŒ–/ç§’çº§æŒä¹…åŒ–ã€‚ å¦‚æœæœåŠ¡å™¨å®•æœºçš„è¯ï¼Œé‡‡ç”¨RDBçš„æ–¹å¼ä¼šé€ æˆæŸä¸ªæ—¶æ®µå†…æ•°æ®çš„ä¸¢å¤±ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾ç½®10åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æˆ–5åˆ†é’Ÿè¾¾åˆ°1000æ¬¡å†™å…¥å°±åŒæ­¥ä¸€æ¬¡ï¼Œé‚£ä¹ˆå¦‚æœè¿˜æ²¡è¾¾åˆ°è§¦å‘æ¡ä»¶æœåŠ¡å™¨å°±æ­»æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´æ®µçš„æ•°æ®ä¼šä¸¢å¤±ã€‚ ä½¿ç”¨bgsaveå‘½ä»¤åœ¨forkså­è¿›ç¨‹æ—¶ï¼Œå¦‚æœæ•°æ®é‡å¤ªå¤§ï¼Œforksçš„è¿‡ç¨‹ä¹Ÿä¼šå‘ç”Ÿé˜»å¡ï¼Œå¦å¤–ï¼Œforkså­è¿›ç¨‹ä¼šè€—è´¹å†…å­˜ã€‚ AOF AOF(append only file)æŒä¹…åŒ–:ä¸RDBå­˜å‚¨æŸä¸ªæ—¶åˆ»çš„å¿«ç…§ä¸åŒï¼ŒAOFæŒä¹…åŒ–æ–¹å¼ä¼šè®°å½•å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„æ¯ä¸€æ¬¡å†™æ“ä½œå‘½ä»¤åˆ°æ—¥å¿—å½“ä¸­ï¼Œå¹¶å°†è¿™äº›å†™æ“ä½œä»¥Redisåè®®è¿½åŠ ä¿å­˜åˆ°ä»¥åç¼€ä¸ºaofæ–‡ä»¶æœ«å°¾ é…ç½®Redis.conf appendonly yes #å¯ç”¨aofæŒä¹…åŒ–æ–¹å¼ appendfsync always/no/everysecè®¾ç½®ä¸ºalwaysæ—¶ï¼Œä¼šæå¤§æ¶ˆå¼±Redisçš„æ€§èƒ½ï¼Œå› ä¸ºè¿™ç§æ¨¡å¼ä¸‹æ¯æ¬¡writeåéƒ½ä¼šè°ƒç”¨fsyncï¼ˆLinuxä¸ºè°ƒç”¨fdatasyncï¼‰ã€‚å¦‚æœè®¾ç½®ä¸ºnoï¼Œåˆ™writeåä¸ä¼šæœ‰fsyncè°ƒç”¨ï¼Œç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨è°ƒåº¦åˆ·ç£ç›˜ï¼Œæ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚everysecä¸ºæœ€å¤šæ¯ç§’è°ƒç”¨ä¸€æ¬¡fsyncï¼Œè¿™ç§æ¨¡å¼æ€§èƒ½å¹¶ä¸æ˜¯å¾ˆç³Ÿç³•ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šäº§ç”Ÿæ¯›åˆºï¼Œè¿™å½’åŠŸäºRediså¼•å…¥äº†BIOçº¿ç¨‹ï¼Œæ‰€æœ‰fsyncæ“ä½œéƒ½å¼‚æ­¥äº¤ç»™äº†BIOçº¿ç¨‹ã€‚ æµç¨‹ æ‰€æœ‰çš„å†™å…¥å‘½ä»¤ä¼šè¿½åŠ åˆ° aof_buf(ç¼“å†²åŒº)ä¸­ã€‚ï¼ˆRedisä½¿ç”¨å•çº¿ç¨‹å“åº”å‘½ä»¤ï¼Œå¦‚æœæ¯æ¬¡AOFæ–‡ä»¶å‘½ä»¤éƒ½è¿½åŠ åˆ°ç£ç›˜ï¼Œä¼šæå¤§çš„å½±å“å¤„ç†æ€§èƒ½ï¼‰ AOF ç¼“å†²åŒºæ ¹æ®å¯¹åº”çš„ç­–ç•¥å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œã€‚ éšç€ AOF æ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦å®šæœŸå¯¹ AOF æ–‡ä»¶è¿›è¡Œé‡å†™ï¼Œè¾¾åˆ°å‹ç¼©çš„ç›®çš„ã€‚ å½“ Redis æœåŠ¡å™¨é‡å¯æ—¶ï¼Œå¯ä»¥åŠ è½½ AOF æ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚ é‡å†™æœºåˆ¶ AOFå°†å®¢æˆ·ç«¯çš„æ¯ä¸€ä¸ªå†™æ“ä½œéƒ½è¿½åŠ åˆ°aofæ–‡ä»¶æœ«å°¾ï¼Œéšç€å‘½ä»¤ä¸æ–­å†™å…¥ AOFï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¼•å…¥äº†AOF é‡å†™æœºåˆ¶å‹ç¼©æ–‡ä»¶ä½“ç§¯ã€‚AOF æ–‡ä»¶é‡å†™æ˜¯æŠŠ Redis è¿›ç¨‹å†…çš„æ•°æ®è½¬åŒ–ä¸ºå†™å‘½ä»¤åŒæ­¥åˆ°æ–° AOF æ–‡ä»¶çš„è¿‡ç¨‹ã€‚ æ¯”å¦‚:å¤šæ¡å†™å‘½ä»¤å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå¦‚:lpush list aã€lpush list bã€lpush list c å¯ä»¥è½¬åŒ–ä¸º:lpush list a b cã€‚ AOF é‡å†™é™ä½äº†æ–‡ä»¶å ç”¨ç©ºé—´ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªç›®çš„æ˜¯:æ›´å°çš„ AOF æ–‡ä»¶å¯ä»¥æ›´å¿«åœ°è¢« Redis åŠ è½½ã€‚ é‡å†™æµç¨‹ æ‰§è¡Œ AOF é‡å†™è¯·æ±‚ã€‚ å¦‚æœå½“å‰è¿›ç¨‹æ­£åœ¨æ‰§è¡Œ AOF é‡å†™ï¼Œè¯·æ±‚ä¸æ‰§è¡Œå¹¶è¿”å›å¦‚ä¸‹å“åº”: ERR Background append only file rewriting already in progress çˆ¶è¿›ç¨‹æ‰§è¡Œ fork åˆ›å»ºå­è¿›ç¨‹ï¼Œå¹¶æ‹¿åˆ°forkæ—¶çš„AOFæ–‡ä»¶æ•°æ®å†™åˆ°ä¸€ä¸ªä¸´æ—¶AOFæ–‡ä»¶ä¸­ã€‚ ä¸»è¿›ç¨‹ fork æ“ä½œå®Œæˆåï¼Œç»§ç»­å“åº”å…¶ä»–å‘½ä»¤ã€‚æ‰€æœ‰ä¿®æ”¹å‘½ä»¤ä¾ç„¶å†™å…¥ AOF ç¼“å†²åŒºå¹¶æ ¹æ® appendfsync ç­–ç•¥åŒæ­¥åˆ°ç¡¬ç›˜ï¼Œä¿è¯åŸæœ‰ AOF æœºåˆ¶æ­£ç¡® æ€§ã€‚ ç”±äº fork æ“ä½œè¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œå­è¿›ç¨‹åªèƒ½å…±äº« fork æ“ä½œæ—¶çš„å†…å­˜æ•°æ®ã€‚ç”±äºçˆ¶è¿›ç¨‹ä¾ç„¶å“åº”å‘½ä»¤ï¼ŒRedis ä½¿ç”¨â€œAOF é‡å†™ç¼“å†²åŒºâ€ä¿å­˜è¿™éƒ¨åˆ†æ–°æ•°æ®ï¼Œé˜²æ­¢æ–° AOF æ–‡ä»¶ç”ŸæˆæœŸé—´ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®ã€‚ å­è¿›ç¨‹æ ¹æ®å†…å­˜å¿«ç…§ï¼ŒæŒ‰ç…§å‘½ä»¤åˆå¹¶è§„åˆ™å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ã€‚æ¯æ¬¡æ‰¹é‡å†™å…¥ç¡¬ç›˜æ•°æ®é‡ç”±é…ç½® aof-rewrite-incremental-fsync æ§åˆ¶ï¼Œé»˜è®¤ä¸º 32MBï¼Œé˜²æ­¢å• æ¬¡åˆ·ç›˜æ•°æ®è¿‡å¤šé€ æˆç¡¬ç›˜é˜»å¡ã€‚ 5.1) æ–° AOF æ–‡ä»¶å†™å…¥å®Œæˆåï¼Œå­è¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚5.2) çˆ¶è¿›ç¨‹æŠŠ AOF é‡å†™ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–°çš„ AOF æ–‡ä»¶ã€‚5.3) ä½¿ç”¨æ–° AOF æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ï¼Œå®Œæˆ AOF é‡å†™ã€‚ è§¦å‘é‡å†™ æ‰‹åŠ¨è§¦å‘:ç›´æ¥è°ƒç”¨ bgrewriteaof å‘½ä»¤ã€‚ è‡ªåŠ¨è§¦å‘:æ ¹æ® auto-aof-rewrite-min-sizeå’Œauto-aof-rewrite-percentage å‚æ•°ç¡®å®šè‡ªåŠ¨è§¦å‘æ—¶æœºã€‚ auto-aof-rewrite-min-size:è¡¨ç¤ºè¿è¡Œ AOF é‡å†™æ—¶æ–‡ä»¶æœ€å°ä½“ç§¯ï¼Œé»˜è®¤ä¸º 64MBã€‚auto-aof-rewrite-percentage:ä»£è¡¨å½“å‰ AOF æ–‡ä»¶ç©ºé—´(aof_current_size)å’Œä¸Šä¸€æ¬¡é‡å†™å AOF æ–‡ä»¶ç©ºé—´(aof_base_size)çš„æ¯”å€¼ã€‚ç¤ºä¾‹:auto-aof-rewrite-percentage:100 auto-aof-rewrite-min-size:64mbé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘ å¼‚å¸¸å¤„ç†AOFæ–‡ä»¶æŸååœ¨å†™å…¥aofæ—¥å¿—æ–‡ä»¶æ—¶ï¼Œå¦‚æœRedisæœåŠ¡å™¨å®•æœºï¼Œåˆ™aofæ—¥å¿—æ–‡ä»¶æ–‡ä»¶ä¼šå‡ºæ ¼å¼é”™è¯¯ï¼Œåœ¨é‡å¯RedisæœåŠ¡å™¨æ—¶ï¼ŒRedisæœåŠ¡å™¨ä¼šæ‹’ç»è½½å…¥è¿™ä¸ªaofæ–‡ä»¶ï¼Œ å¯ä»¥é€šè¿‡å‘½ä»¤ä¿®å¤aofå¹¶æ¢å¤æ•°æ® Redis-check-aof -fix file.aof AOFçš„ä¼˜ç‚¹ AOFå¯ä»¥è®¾ç½® å®Œå…¨ä¸åŒæ­¥ã€æ¯ç§’åŒæ­¥ã€æ¯æ¬¡æ“ä½œåŒï¼Œé»˜è®¤æ˜¯æ¯ç§’åŒæ­¥ã€‚å› ä¸ºAOFæ˜¯æ“ä½œæŒ‡ä»¤çš„è¿½åŠ ï¼Œæ‰€ä»¥å¯ä»¥é¢‘ç¹çš„å¤§é‡çš„åŒæ­¥ã€‚ AOFæ–‡ä»¶æ˜¯ä¸€ä¸ªå€¼è¿½åŠ æ—¥å¿—çš„æ–‡ä»¶ï¼Œå³ä½¿æœåŠ¡å®•æœºä¸ºå†™å…¥å®Œæ•´çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Redis-check-aofå·¥å…·ä¿®å¤è¿™äº›é—®é¢˜ã€‚ å¦‚æœAOFæ–‡ä»¶è¿‡å¤§ï¼ŒRedisä¼šåœ¨åå°è‡ªåŠ¨åœ°é‡å†™AOFæ–‡ä»¶ã€‚é‡å†™åä¼šä½¿AOFæ–‡ä»¶å‹ç¼©åˆ°æœ€å°æ‰€éœ€çš„æŒ‡ä»¤é›†ã€‚ AOFæ–‡ä»¶æ˜¯æœ‰åºä¿å­˜æ•°æ®åº“çš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œæ˜“è¯»ï¼Œæ˜“åˆ†æã€‚å³ä½¿å¦‚æœä¸å°å¿ƒè¯¯æ“ä½œæ•°æ®åº“ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ‰¾å‡ºé”™è¯¯æŒ‡ä»¤ï¼Œæ¢å¤åˆ°æŸä¸ªæ•°æ®èŠ‚ç‚¹ã€‚ä¾‹å¦‚ä¸å°å¿ƒFLUSHALLï¼Œå¯ä»¥éå¸¸å®¹æ˜“æ¢å¤åˆ°æ‰§è¡Œå‘½ä»¤ä¹‹å‰ã€‚ AOFçš„ç¼ºç‚¹ ç›¸åŒæ•°æ®é‡ä¸‹ï¼ŒAOFçš„æ–‡ä»¶é€šå¸¸ä½“ç§¯ä¼šæ¯”RDBå¤§ã€‚å› ä¸ºAOFæ˜¯å­˜æŒ‡ä»¤çš„ï¼Œè€ŒRDBæ˜¯æ‰€æœ‰æŒ‡ä»¤çš„ç»“æœå¿«ç…§ã€‚ä½†AOFåœ¨æ—¥å¿—é‡å†™åä¼šå‹ç¼©ä¸€äº›ç©ºé—´ã€‚ åœ¨å¤§é‡å†™å…¥å’Œè½½å…¥çš„æ—¶å€™ï¼ŒAOFçš„æ•ˆç‡ä¼šæ¯”RDBä½ã€‚å› ä¸ºå¤§é‡å†™å…¥ï¼ŒAOFä¼šæ‰§è¡Œæ›´å¤šçš„ä¿å­˜å‘½ä»¤ï¼Œè½½å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦å¤§é‡çš„é‡æ‰§è¡Œå‘½ä»¤æ¥å¾—åˆ°æœ€åçš„ç»“æœã€‚RDBå¯¹æ­¤æ›´æœ‰ä¼˜åŠ¿ã€‚ é…ç½®æ±‡æ€»save 60 1000:60så†…è‡³å°‘è¾¾åˆ°1000æ¡å†™å‘½ä»¤appendonly no:æ˜¯å¦å¼€å¯AOFappendfilename &quot;appendonly.aof&quot;:AOFæ–‡ä»¶ådir ./:RDBæ–‡ä»¶å’ŒAOFæ–‡ä»¶æ‰€åœ¨ç›®å½•appendfsync everysec:fsyncæŒä¹…åŒ–ç­–ç•¥no-appendfsync-on-rewrite no:AOFé‡å†™æœŸé—´æ˜¯å¦ç¦æ­¢fsync;å¦‚æœå¼€å¯è¯¥é€‰é¡¹ï¼Œå¯ä»¥å‡è½»æ–‡ä»¶é‡å†™æ—¶CPUå’Œç¡¬ç›˜çš„è´Ÿè½½(å°¤å…¶æ˜¯ç¡¬ç›˜)ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸¢ å¤±AOFé‡å†™æœŸé—´çš„æ•°æ®;éœ€è¦åœ¨è´Ÿè½½å’Œå®‰å…¨æ€§ä¹‹é—´è¿›è¡Œå¹³è¡¡auto-aof-rewrite-percentage 100:æ–‡ä»¶é‡å†™è§¦å‘æ¡ä»¶ä¹‹ä¸€auto-aof-rewrite-min-size 64mb:æ–‡ä»¶é‡å†™è§¦å‘æäº¤ä¹‹ä¸€aof-load-truncated yes:å¦‚æœAOFæ–‡ä»¶ç»“å°¾æŸåï¼ŒRediså¯åŠ¨æ—¶æ˜¯å¦ä»è½½å…¥AOFæ–‡ä»¶","tags":["Redis"],"categories":["Redis"]},{"title":"æ¡†æ¶ç¯‡ï¼š9.è®¾è®¡æ¨¡å¼","path":"/2020/02/16/phpframe12/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ æ¡†æ¶çš„å¼€å‘åŸºæœ¬ç»“æŸäº†ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹è®¾è®¡æ¨¡å¼ã€‚ è°ˆè®¾è®¡æ¨¡å¼ï¼Œé¦–å…ˆè¦æ¥ç®€å•èŠèŠé¢å‘å¯¹è±¡ã€‚ é¢å‘å¯¹è±¡ é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ï¼ˆObject-Oriented Programming, OOPï¼‰æ˜¯ä¸€ç§ç¨‹åºè®¾è®¡èŒƒå‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ç§ç¨‹åºå¼€å‘æ–¹æ³•ã€‚å®ƒå°†å¯¹è±¡ä½œä¸ºç¨‹åºçš„åŸºæœ¬å•å…ƒï¼Œå°†ç¨‹åºå’Œæ•°æ®å°è£…å…¶ä¸­ï¼Œä»¥æé«˜è½¯ä»¶çš„é‡ç”¨æ€§ã€çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚å®ƒå’Œé¢å‘è¿‡ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹è¢«ç§°ä¸ºç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸‰å¤§èŒƒå¼ã€‚ æ¦‚å¿µçŸ¥è¯† é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯å¯¹è±¡ã€å°è£…ã€å¯é‡ç”¨æ€§ã€å¯æ‰©å±•æ€§ã€‚ é¢å‘å¯¹è±¡ä¸‰è¦ç´ ï¼šå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ã€‚ é¢å‘å¯¹è±¡è®¾è®¡çš„äº”å¤§åŸåˆ™ï¼šå•ä¸€èŒè´£åŸåˆ™ã€æ¥å£éš”ç¦»åŸåˆ™ã€å¼€æ”¾å°é—­åŸåˆ™ã€æ›¿æ¢åŸåˆ™ã€ä¾èµ–å€’ç½®åŸåˆ™ã€‚ å…³äºè¿™äº›æ¦‚å¿µçš„æ›´è¯¦ç»†è§£é‡Šï¼Œæˆ‘æ¨èå¤§å®¶é˜…è¯»ã€ŠPHPæ ¸å¿ƒæŠ€æœ¯ä¸æœ€ä½³å®è·µã€‹è¿™æœ¬ä¹¦å…³äºå…³äºé¢å‘å¯¹è±¡çš„éƒ¨åˆ†ã€‚ è®¾è®¡æ¨¡å¼ä¸Šè¿°æ‰€è¿°çš„é¢å‘å¯¹è±¡çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„äº”å¤§åŸåˆ™ï¼Œæ˜¯è¯¸å¤šè®¾è®¡æ¨¡å¼çš„åŸºç¡€ã€‚ è®¾è®¡æ¨¡å¼æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åˆ—å‡ºæ¥ï¼š æœ‰å¼ºè°ƒå®ä¾‹åŒ–è¿‡ç¨‹çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ æŠ½è±¡å·¥å‚ ç”Ÿæˆå™¨ å·¥å‚æ–¹æ³• åŸå‹ å•ä¾‹ åˆæœ‰ç»„åˆå¯¹è±¡å’Œç±»æ„æˆæ›´å¤§ç»“æ„çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ é€‚é…å™¨æ¨¡å¼ æ¡¥æ¥æ¨¡å¼ ç»„åˆæ¨¡å¼ è£…é¥°å™¨æ¨¡å¼ å¤–è§‚æ¨¡å¼ äº«å…ƒæ¨¡å¼ ä»£ç†æ¨¡å¼ è¿˜æœ‰è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ èŒè´£é“¾æ¨¡å¼ å‘½ä»¤æ¨¡å¼ è§£é‡Šå™¨æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼ ä¸­ä»‹è€…æ¨¡å¼ å¤‡å¿˜å½•æ¨¡å¼ è§‚å¯Ÿè€…æ¨¡å¼ çŠ¶æ€æ¨¡å¼ ç­–ç•¥æ¨¡å¼ æ¨¡æ¿æˆæƒæ¨¡å¼ è®¿é—®è€…æ¨¡å¼ è¯´åˆ°è¿™é‡Œä½ æœ‰æ²¡æœ‰è’™åœˆï¼Ÿ å…¶å®æˆ‘ä»¬æ— éœ€ä¸€ä¸‹å­å»äº†è§£é‚£ä¹ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¹Ÿæ˜¯æ··åˆä½¿ç”¨è®¾è®¡æ¨¡å¼çš„ã€‚æˆ‘ä»¬ä¸å¦¨å¯ä»¥å°±æ¡†æ¶é‡Œç”¨åˆ°çš„å‡ ä¸ªå…¸å‹çš„è®¾è®¡æ¨¡å¼åšä¸€äº›åˆ†æã€‚ å•ä¾‹æ¨¡å¼æ˜¯å¦è¿˜è®°å¾—æˆ‘ä»¬ä½¿ç”¨Redisä»£æ›¿Sessioné‚£ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°±ç”¨åˆ°äº†å•ä¾‹æ¨¡å¼ã€‚ æˆ‘ä»¬æ¥ç®€åŒ–ä¸€ä¸‹ä»£ç ï¼š class RedisSession&#123; private $Redis; private function getRedisInstance() &#123; if (empty($this-&gt;Redis)) &#123; $Redis = new \\Redis(); $Redis-&gt;connect($this-&gt;_config[&#x27;host&#x27;], $this-&gt;_config[&#x27;port&#x27;], $this-&gt;_config[&#x27;timeout&#x27;]); if (!$this-&gt;_config[&#x27;auth&#x27;]) &#123; $Redis-&gt;auth($this-&gt;_config[&#x27;auth&#x27;]); &#125; $this-&gt;Redis = $Redis; &#125; return $this-&gt;Redis; &#125;&#125; ä¸€èˆ¬æˆ‘ä»¬è¿˜ä¼šåœ¨ç±»é‡Œé¢åŠ å…¥ä¸€ä¸ªé­”æœ¯æ–¹æ³•__cloneï¼Œé˜²æ­¢å®ä¾‹åˆ›å»ºåè¢«clone å•ä¾‹æ¨¡å¼æœ‰æ˜¾è€Œæ˜“è§çš„ä¼˜ç‚¹ï¼šæé«˜å¯é‡ç”¨æ€§ï¼Œå‡å°‘å¼€é”€ã€‚æ¡†æ¶é‡Œä½¿ç”¨Redisæ—¶éƒ½å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¥è·å–Redisï¼Œä¹Ÿå‡å°‘Redisçš„è¿æ¥æ•°å’Œå¤šæ¬¡è¿æ¥æ—¶é—´ã€‚ ç­–ç•¥æ¨¡å¼è¿˜è®°å¾—ä¾èµ–æ³¨å…¥é‚£ä¸€èŠ‚ä¹ˆï¼Œæˆ‘ä»¬ä¸¾ä¾‹çš„é‚£ä¸ªTravelå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥æ¨¡å¼Demoï¼š interface Travel&#123; public function travelAlgorithm();&#125;/** *å…·ä½“ç­–ç•¥ç±»(ConcreteStrategy) *1ï¼šä¹˜åé£æœº */class AirPlanelStrategy implements Travel&#123; public function travelAlgorithm() &#123; echo&quot;travelbyAirPlain\\r &quot;; &#125;&#125;/** *å…·ä½“ç­–ç•¥ç±»(ConcreteStrategy) *2ï¼šä¹˜åç«è½¦ */class TrainStrategy implements Travel&#123; public function travelAlgorithm() &#123; echo&quot;travelbyTrain\\r &quot;; &#125;&#125;/** * *ç¯å¢ƒç±»(Context): *ç”¨ä¸€ä¸ªConcreteStrategyå¯¹è±¡æ¥é…ç½®ã€‚ *ç»´æŠ¤ä¸€ä¸ªå¯¹Travelå¯¹è±¡çš„å¼•ç”¨ã€‚å¯å®šä¹‰ä¸€ä¸ªæ¥å£æ¥è®©Strategyè®¿é—®å®ƒçš„æ•°æ®ã€‚ *ç®—æ³•è§£å†³ç±»ï¼Œä»¥æä¾›å®¢æˆ·é€‰æ‹©ä½¿ç”¨ä½•ç§è§£å†³æ–¹æ¡ˆï¼š */class PersonContext&#123; private $strategy = null; public function __construct(Travel $travel) &#123; $this-&gt;strategy=$travel; &#125; /** *æ—…è¡Œ */ public function travel() &#123; return$this-&gt;strategy-&gt;travelAlgorithm(); &#125;&#125;// ä¹˜åç«è½¦æ—…è¡Œ$person = new PersonContext(new TrainStrategy());$person-&gt;travel();// æ”¹ä¹˜é£æœº$person =PersonContext(new AirPlanelStrategy());$person-&gt;travel(); ç­–ç•¥æ¨¡å¼é™ä½äº†ä»£ç è€¦åˆåº¦ï¼Œå¯ä»¥ä½¿å¾—æˆ‘ä»¬ä¸‹å±‚ä»£ç ä¾èµ–ä¸Šå±‚ï¼Œæ›¿æ¢ä¸‹å±‚ä»£ç å³å¯ç®€å•å®ç°åŠŸèƒ½çš„æ›¿æ¢ã€‚ å·¥å‚æ–¹æ³•æˆ‘ä»¬åœ¨è·¯ç”±è§£æåˆ›å»ºæ§åˆ¶å™¨é‚£é‡Œä½¿ç”¨äº†å·¥å‚æ–¹æ³•ï¼Œåªä¸è¿‡ä¸è·¯ç”±è§£æä»£ç ç³…åˆåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ï¼š class Factory&#123; public function createController($controllerName) &#123; $controllerName = rtrim($controllerName,&#x27;\\\\&#x27;).&#x27;Controller&#x27;; if (!class_exists($controllerName)) &#123; throw new NotFoundException(&quot;æœªæ‰¾åˆ°æ§åˆ¶å™¨&quot;); &#125; return new $controllerName; &#125; Â·Â·Â·&#125; å·¥å‚æ–¹æ³•æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒåƒModelç»å¸¸èƒ½ç”¨åˆ°ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š8.ä¾èµ–æ³¨å…¥ä¸æ§åˆ¶åè½¬","path":"/2020/02/15/phpframe11/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰DIPæ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¹‹ä¸€ã€‚ä¼ ç»Ÿè½¯ä»¶è®¾è®¡ä¸­ï¼Œä¸Šå±‚ä»£ç ä¾èµ–äºä¸‹å±‚ä»£ç ï¼Œå½“ä¸‹å±‚å‡ºç°å˜åŠ¨æ—¶ï¼Œ ä¸Šå±‚ä»£ç ä¹Ÿè¦ç›¸åº”å˜åŒ–ï¼Œç»´æŠ¤æˆæœ¬è¾ƒé«˜ã€‚è€ŒDIPçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¸Šå±‚å®šä¹‰æ¥å£ï¼Œä¸‹å±‚å®ç°è¿™ä¸ªæ¥å£ï¼Œ ä»è€Œä½¿å¾—ä¸‹å±‚ä¾èµ–äºä¸Šå±‚ï¼Œé™ä½è€¦åˆåº¦ï¼Œæé«˜æ•´ä¸ªç³»ç»Ÿçš„å¼¹æ€§ã€‚è¿™æ˜¯ä¸€ç§ç»å®è·µè¯æ˜çš„æœ‰æ•ˆç­–ç•¥ã€‚ æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼‰IoCåˆ™æ˜¯DIPçš„ä¸€ç§å…·ä½“æ€è·¯ï¼ŒDIPåªæ˜¯ä¸€ç§ç†å¿µã€æ€æƒ³ï¼Œè€ŒIoCæ˜¯ä¸€ç§å®ç°DIPçš„æ–¹æ³•ã€‚ IoCçš„æ ¸å¿ƒæ˜¯å°†ç±»ï¼ˆä¸Šå±‚ï¼‰æ‰€ä¾èµ–çš„å•å…ƒï¼ˆä¸‹å±‚ï¼‰çš„å®ä¾‹åŒ–è¿‡ç¨‹äº¤ç”±ç¬¬ä¸‰æ–¹æ¥å®ç°ã€‚ å½“è°ƒç”¨è€…éœ€è¦è¢«è°ƒç”¨è€…çš„ååŠ©æ—¶ï¼Œåœ¨ä¼ ç»Ÿçš„ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ç”±è°ƒç”¨è€…æ¥åˆ›å»ºè¢«è°ƒç”¨è€…çš„å®ä¾‹ï¼Œä½†åœ¨è¿™é‡Œï¼Œåˆ›å»ºè¢«è°ƒç”¨è€…çš„å·¥ä½œä¸å†ç”±è°ƒç”¨è€…æ¥å®Œæˆï¼Œè€Œæ˜¯å°†è¢«è°ƒç”¨è€…çš„åˆ›å»ºç§»åˆ°è°ƒç”¨è€…çš„å¤–éƒ¨ï¼Œä»è€Œåè½¬è¢«è°ƒç”¨è€…çš„åˆ›å»ºï¼Œæ¶ˆé™¤äº†è°ƒç”¨è€…å¯¹è¢«è°ƒç”¨è€…åˆ›å»ºçš„æ§åˆ¶ï¼Œå› æ­¤ç§°ä¸ºæ§åˆ¶åè½¬ã€‚ ä¾èµ–æ³¨å…¥ï¼ˆDependence Injectionï¼‰DIæ˜¯IoCçš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒæŒ‰ç…§DIçš„æ¨¡å¼ï¼Œå°±å¯ä»¥å®ç°IoCã€‚ DIçš„å®è´¨å°±æ˜¯æŠŠä¸€ä¸ªç±»ä¸å¯èƒ½æ›´æ¢çš„éƒ¨åˆ†å’Œå¯æ›´æ¢çš„éƒ¨åˆ†åˆ†ç¦»å¼€æ¥ï¼Œé€šè¿‡æ³¨å…¥çš„æ–¹å¼æ¥ä½¿ç”¨ï¼Œä»è€Œè¾¾åˆ°è§£è€¦çš„ç›®çš„ã€‚ è¿™é‡Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼ˆæ—…è¡Œçš„æ¥å£ï¼‰è¯´æ˜ä¸€ä¸‹ï¼š interface Travel&#123; public function travelAlgorithm();&#125;/** *ä¹˜åé£æœº */class AirPlanelStrategy implements Travel&#123; public function travelAlgorithm() &#123; echo&quot;travelbyAirPlain\\r &quot;; &#125;&#125;/** *ä¹˜åç«è½¦ */class TrainStrategy implements Travel&#123; public function travelAlgorithm() &#123; echo&quot;travelbyTrain\\r &quot;; &#125;&#125;/** * *ç®—æ³•è§£å†³ç±»ï¼Œä»¥æä¾›å®¢æˆ·é€‰æ‹©ä½¿ç”¨ä½•ç§è§£å†³æ–¹æ¡ˆï¼š */class PersonContext&#123; private $strategy = null; public function __construct(Travel $travel) &#123; $this-&gt;strategy=$travel; &#125; /** *æ—…è¡Œ */ public function travel() &#123; return$this-&gt;strategy-&gt;travelAlgorithm(); &#125;&#125;// ä¹˜åç«è½¦æ—…è¡Œ$person = new PersonContext(new TrainStrategy());$person-&gt;travel();// æ”¹ä¹˜é£æœº$person =PersonContext(new AirPlanelStrategy());$person-&gt;travel(); å½“æˆ‘ä»¬æ›´æ¢äº¤é€šå·¥å…·æ—¶ï¼Œåªéœ€è¦å»å¢åŠ Travelæ¥å£çš„å®ç°ï¼Œä¿®æ”¹ä¸‹å®ç°çš„ä»£ç æ¥å£ï¼Œæ— éœ€å»æ”¹åŠ¨æ ¸å¿ƒä»£ç ã€‚ æ§åˆ¶åè½¬å®¹å™¨ï¼ˆIoC Containerï¼‰å½“é¡¹ç›®æ¯”è¾ƒå¤§æ—¶ï¼Œä¾èµ–å…³ç³»å¯èƒ½ä¼šååˆ†å¤æ‚ã€‚ è€ŒIoC Containeræä¾›äº†åŠ¨æ€åœ°åˆ›å»ºã€æ³¨å…¥ä¾èµ–å•å…ƒï¼Œæ˜ å°„ä¾èµ–å…³ç³»ç­‰åŠŸèƒ½ï¼Œæ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ï¼Œå¹¶å¤§å¤§ç¼©å‡äº†è®¸å¤šä»£ç é‡ã€‚ å› ä¸ºæˆ‘ä»¬çš„æ¡†æ¶æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸å¦¨å®ç°ä¸‹Iocå®¹å™¨(ä¸»è¦å‚è€ƒäº†Yiiçš„diå®¹å™¨)ã€‚ ä»£ç å®ç°ç”¨åˆ°äº†PHPçš„åå°„Apiï¼Œæœ‰ç–‘é—®çš„ä¸å¦¨å…ˆçœ‹çœ‹æ‰‹å†Œï¼š PHPåå°„ è¿˜è®°å¾—PSRå—ï¼ŸPSR11æ˜¯å…³äºä¾èµ–æ³¨å…¥å®¹å™¨æ¥å£è§„èŒƒï¼š ç„¶åæˆ‘ä»¬åˆ©ç”¨composeræ‰§è¡Œ composer require psr/container æˆ‘ä»¬åœ¨library/Componentsæ–°å»ºContainerå®ç°ContainerInterfaceï¼Œåœ¨library/Exceptionsä¸‹æ–°å»ºContainerExceptionå®ç°Psr\\Container\\ContainerExceptionInterfaceï¼Œæ–°å»ºContainerNotFoundExceptionå®ç°Psr\\Container\\NotFoundExceptionInterfaceã€‚ æˆ‘ä»¬ä¸»è¦æ¥å®ç°ä¸€ä¸‹Containerä»£ç ï¼Œæˆ‘ä»¬é¢„å…ˆå®šä¹‰ä¸‰ä¸ªå±æ€§ï¼Œç”¨ä»¥ä¿å­˜å¯¹è±¡ã€ä¾èµ–åŠä¾èµ–çš„å®šä¹‰ä¿¡æ¯ã€‚ &lt;?phpnamespace Library\\Components;use Library\\Exceptions\\ContainerException;use Library\\Exceptions\\ContainerNotFoundException;use Psr\\Container\\ContainerInterface;use ReflectionClass;class Container implements ContainerInterface&#123; // ç”¨äºä¿å­˜ä¾èµ–çš„å®šä¹‰ï¼Œä»¥å¯¹è±¡åç§°ä¸ºé”® private $definitions = []; // ç”¨äºç¼“å­˜ReflectionClasså¯¹è±¡ï¼Œä»¥å¯¹è±¡åç§°ä¸ºé”® private $reflections = []; // ç”¨äºç¼“å­˜ä¾èµ–ä¿¡æ¯ï¼Œä»¥å¯¹è±¡åç§°ä¸ºé”® private $dependencies = []; public function has($class) &#123; return isset($this-&gt;definitions[$class]); &#125; public function get($class) &#123; ... &#125;&#125; æˆ‘ä»¬å…ˆæ·»åŠ ä¸€ä¸ªsetæ–¹æ³•ï¼Œç”¨ä»¥å®šä¹‰ï¼Œ public function set($class, $definition = [])&#123; $this-&gt;definitions[$class] = $this-&gt;normalizeDefinition($class, $definition); return $this;&#125;protected function normalizeDefinition($class, $definition)&#123; // $definition æ˜¯ç©ºçš„è½¬æ¢æˆ [&#x27;class&#x27; =&gt; $class] å½¢å¼ if (empty($definition)) &#123; return [&#x27;class&#x27; =&gt; $class]; // $definition æ˜¯å­—ç¬¦ä¸²ï¼Œè½¬æ¢æˆ [&#x27;class&#x27; =&gt; $definition] å½¢å¼ &#125; elseif (is_string($definition)) &#123; return [&#x27;class&#x27; =&gt; $definition]; // $definition æ˜¯å¯¹è±¡ï¼Œåˆ™ç›´æ¥å°†å…¶ä½œä¸ºä¾èµ–çš„å®šä¹‰ &#125; elseif (is_object($definition)) &#123; return $definition; // $definition æ˜¯æ•°ç»„åˆ™ç¡®ä¿è¯¥æ•°ç»„å®šä¹‰äº† class å…ƒç´  &#125; elseif (is_array($definition)) &#123; if (!isset($definition[&#x27;class&#x27;])) &#123; $definition[&#x27;class&#x27;] = $class; &#125; return $definition; // è¿™ä¹Ÿä¸æ˜¯ï¼Œé‚£ä¹Ÿä¸æ˜¯ï¼Œé‚£å°±æŠ›å‡ºå¼‚å¸¸ç®—äº† &#125; else &#123; throw new ContainerException( &quot;ä¸æ”¯æŒçš„ç±»å‹ï¼š \\&quot;$class\\&quot;: &quot; . gettype($definition)); &#125;&#125; çŸ¥è¯†ç‚¹ï¼š gettype â€” è·å–å˜é‡çš„ç±»å‹ ç„¶åæˆ‘ä»¬é‡ç‚¹å®ç°getæ–¹æ³•ï¼š public function get($class)&#123; // åŠ å…¥æœªä½œsetæ“ä½œï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥æ„å»º if (!isset($this-&gt;definitions[$class])) &#123; return $this-&gt;build($class); &#125; $definition = $this-&gt;definitions[$class]; if (is_array($definition)) &#123; $concrete = $definition[&#x27;class&#x27;]; unset($definition[&#x27;class&#x27;]); if ($concrete === $class) &#123; $object = $this-&gt;build($class, $definition); &#125; else &#123; $object = $this-&gt;get($concrete); &#125; &#125; elseif (is_object($definition)) &#123; return $this-&gt;_singletons[$class] = $definition; &#125; else &#123; throw new ContainerNotFoundException(&#x27;ä¸èƒ½è¯†åˆ«çš„å¯¹è±¡ç±»å‹: &#x27; . gettype($definition)); &#125; return $object;&#125; buildæ–¹æ³•å¦‚ä¸‹ï¼Œä¸»è¦æ˜¯æ„å»ºå‡ºå¯¹è±¡å¹¶å®ç°æ³¨å…¥ï¼Œ public function build($class, $params = [])&#123; try &#123; // é€šè¿‡åå°„apiè·å–å¯¹è±¡ $reflector = $this-&gt;getReflectionClass($class); // è·å–ä¾èµ–å…³ç³»æ•°ç»„ $dependencies = $this-&gt;getDependencies($class, $reflector); // åˆ›å»ºä¸€ä¸ªç±»çš„æ–°å®ä¾‹,ç»™å‡ºçš„å‚æ•°å°†ä¼ é€’åˆ°ç±»çš„æ„é€ å‡½æ•°. $reflector = $reflector-&gt;newInstanceArgs($dependencies); return $reflector; &#125; catch (\\Throwable $t) &#123; throw new ContainerException(&#x27;åå°„å‡ºé”™&#x27;); &#125;&#125; è·å–å¯¹è±¡ï¼š public function getReflectionClass($class)&#123; if (isset($this-&gt;reflections[$class])) &#123; return $this-&gt;reflections[$class]; &#125; $reflector = new ReflectionClass($class); if (!$reflector-&gt;isInstantiable()) &#123; throw new ContainerException(&quot;ä¸èƒ½å®ä¾‹åŒ–&quot;.$class); &#125; return $this-&gt;reflections[$class] = $reflector;&#125; è·å–ä¾èµ–å…³ç³»ï¼š public function getDependencies($class, $reflector)&#123; // åˆ¤æ–­æ˜¯å¦æœ‰ç¼“å­˜ä¾èµ–å…³ç³» if (isset($this-&gt;dependencies[$class])) &#123; return $this-&gt;dependencies[$class]; &#125; $constructor = $reflector-&gt;getConstructor(); #å¦‚æœæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œ ç›´æ¥å®ä¾‹åŒ–å¹¶è¿”å› if (is_null($constructor)) &#123; return $this-&gt;dependencies[$class] = []; &#125; $parameters = $constructor-&gt;getParameters(); $dependencies = []; foreach ($parameters as $className) &#123; $dependency = $className-&gt;getClass(); if (is_null($dependency)) &#123; $dependencies[] = $this-&gt;resolveNoneClass($className); &#125; else &#123; // å…ˆå–å‡ºå®¹å™¨ä¸­ç»‘å®šçš„ç±» å¦åˆ™è‡ªåŠ¨ç»‘å®š $dependencies[] = $this-&gt;get($dependency-&gt;getName()); &#125; &#125; $this-&gt;dependencies[$class] = $dependencies; return $dependencies;&#125;public function resolveNoneClass($class)&#123; // æœ‰é»˜è®¤å€¼åˆ™è¿”å›é»˜è®¤å€¼ if ($class-&gt;isDefaultValueAvailable()) &#123; return $class-&gt;getDefaultValue(); &#125; throw new ContainerException(&#x27;ä¸èƒ½è§£æå‚æ•°&#x27;);&#125; åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬å°±å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„IOC Containerçš„ä»£ç ã€‚ æˆ‘ä»¬æ¥å†™ä¸€ä¸ªdemoï¼š &lt;?phpnamespace App\\Https\\Controllers;class C&#123;&#125; &lt;?phpnamespace App\\Https\\Controllers;class B&#123; public function __construct(C $c) &#123; $this-&gt;ccc = $c; &#125;&#125; &lt;?phpnamespace App\\Https\\Controllers;class A&#123; public function __construct(B $b, C $c) &#123; $this-&gt;bbb = $b; $this-&gt;ccc = $c; &#125;&#125; &lt;?phpnamespace App\\Https\\Controllers;use Library\\Components\\Container;use Library\\Https\\Controller;class IndexController extends Controller&#123; public function index() &#123; $contain = new Container(); $contain-&gt;set(&#x27;App\\\\Https\\\\Controllers\\\\A&#x27;); p($contain-&gt;get(&#x27;App\\\\Https\\\\Controllers\\\\A&#x27;)); &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„ç»“æœï¼š æ˜¯ä¸æ˜¯ä»£ç ç®€æ´å¾ˆå¤šäº†ï¼Œä¸æ„¿å› ä¸ºéœ€è¦åˆ›å»ºä¸€ä¸ªAå¯¹è±¡ï¼Œè€Œå…ˆå»å®ä¾‹åŒ–Bå’ŒCï¼Œè¿™äº›éƒ½æ˜¯ç”±æˆ‘ä»¬å®Œæˆçš„IOC Containerå»å®ç°äº†ã€‚ æ€»ç»“è¿™ä¸€èŠ‚æˆ‘ä»¬å®ç°äº†IOCå®¹å™¨ï¼Œç„¶è€Œä½ å¦‚æœä»”ç»†å»æƒ³ï¼Œæˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬å¯ä»¥è®©å®¹å™¨æ›´åŠ å¼ºå¤§ï¼Œæ¯”å¦‚å•ä¾‹å¯¹è±¡çš„å®ç°ï¼Œæ¯”å¦‚ä¾èµ–çš„æ‰©å±•ï¼ˆå…¼å®¹å¯¹è±¡å‚æ•°æ³¨å…¥ï¼Œæ•°ç»„å‚æ•°æ³¨å…¥ç­‰ï¼‰ã€‚è¿™äº›ä½ å¯ä»¥è‡ªè¡Œå®ç°ï¼Œæˆ‘ä¹Ÿåœ¨æºä»£ç åšäº†ç®€å•çš„æ‰©å±•ï¼Œå¤§å®¶å¯ä»¥æ€è€ƒè¯•ç€å®ç°ä¸€ä¸‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥çœ‹çœ‹å¼€æºæ¡†æ¶Laravelã€Yiiçš„æœåŠ¡å®¹å™¨çš„å®ç°ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š7.ä½¿ç”¨RedisåŠ é€Ÿsessionè¯»å†™","path":"/2020/02/15/phpframe10/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ å¤§å®¶éƒ½çŸ¥é“ï¼Œé»˜è®¤çš„sessionæ˜¯å­˜å‚¨åœ¨æ–‡ä»¶é‡Œçš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œç„¶è€Œä¸€æ—¦è®¿é—®å¾ˆå¤šï¼Œsessionçš„ä½¿ç”¨å°±ä¼šé¢‘ç¹è¯»å†™æ–‡ä»¶ï¼Œå¿…ç„¶ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚å¦å¤–ï¼Œå‡å¦‚æ˜¯å¤šæœºéƒ¨ç½²ï¼Œsessionçš„å…±äº«ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚ æ—¢ç„¶æˆ‘ä»¬çŸ¥é“æœ‰Redisè¿™ä¸ªåˆ©å™¨ï¼Œè€ŒPHPä¹Ÿæ˜¯æ”¯æŒsessionè‡ªå®šä¹‰çš„ï¼Œé‚£ä¹ˆä¸ºä½•ä¸è¦æ€§èƒ½æ›´å¥½åˆèƒ½å®ç°å…±äº«sessionçš„Rediså‘¢ï¼Ÿ Redisæ˜¯ä»€ä¹ˆï¼ŸRedis æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œéµå®ˆ BSD åè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ key - value æ•°æ®åº“ Redisæ•°æ®ç»“æ„ string hash set sorted set pub/sub list å¦å¤–è¿˜æœ‰HyperLogLogï¼Œgeoâ€¦. Redisçš„ä¼˜åŠ¿ æ€§èƒ½æä½³ï¼Œå®˜ç½‘æ˜¾ç¤ºQPSèƒ½è¾¾åˆ°100k/s æ•°æ®ç»“æ„ä¸°å¯Œï¼Œä¸æ­¢äºå­—ç¬¦ä¸²ï¼Œhash ç¨³å®šæ€§ä¸é”™ï¼ŒæŒä¹…åŒ– æ”¯æŒé›†ç¾¤ ç¤¾åŒºä¸é”™ï¼Œä½¿ç”¨ç‡é«˜ï¼Œå¯¹äºPHPç¨‹åºå‘˜ï¼Œé™¤äº†LNMP/LAMPï¼Œç„¶ååº”è¯¥å°±æ˜¯Redisäº† Redisåº”ç”¨ ç¼“å­˜ åˆ†å¸ƒå¼é” è®¡æ•°å™¨ é˜Ÿåˆ— geo â€¦â€¦ Rediså‘½ä»¤ ç‚¹å‡»æŸ¥çœ‹Rediså‘½ä»¤ ä½¿ç”¨Rediså­˜å‚¨sessionæˆ‘ä»‹ç»ä¸¤ç§æ–¹æ³•ç»™å¤§å®¶ï¼š session_startå¸¦å‚ session_set_save_handleræ‰˜ç®¡session ä¸‹é¢æˆ‘ä»¬é‡Œä¸€ä¸€è¯´æ˜ï¼š session_startsession_start ([ array $options = array() ] ) : bool â€”â€” å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼ˆç‚¹å‡»æŸ¥çœ‹æ›´å¤šå‚æ•°ï¼‰ æ¥çœ‹demoï¼š session_start([ &#x27;save_path&#x27; =&gt; &#x27;tcp://127.0.0.1:6379&#x27;, &#x27;save_handler&#x27; =&gt; &#x27;Redis&#x27;,]);$_SESSION[&#x27;user_id&#x27;] = 10001;$_SESSION[&#x27;userInfo&#x27;] = [&#x27;name&#x27; =&gt; &#x27;sai&#x27;];p($_SESSION[&#x27;user_id&#x27;]);p($_SESSION[&#x27;userInfo&#x27;]); è¾“å‡ºå¦‚ä¸‹ï¼š 10001 Array ( [name] => sai ) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Redis-cliè¿æ¥æŸ¥çœ‹ï¼š Redis-cli -h 127.0.0.1 -p 6379// å¦‚è®¾ç½®å¯†ç å†è¾“å…¥ï¼ˆauth ä½ è®¾ç½®çš„å¯†ç ï¼‰å³å¯ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Redisé‡Œæœ‰äº†PHPREDIS_SESSION:nmo65igogqnq8ur2gia94jt15uï¼Œé‡Œé¢å­˜å‚¨äº†æˆ‘ä»¬çš„sessionä¿¡æ¯ã€‚ session_set_save_handlerå»ºè®®session.serialize_handler = php_serializeï¼Œé»˜è®¤phpå†™å…¥å’Œè¯»å–ç•¥å¾®ç¹çã€‚ è¿™é‡Œè¯´æ˜æˆ‘ä»¬æˆåŠŸäº†å°†sessionä¿¡æ¯é€šè¿‡Redisè¿›è¡Œäº†è¯»å†™ã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨session_set_save_handleræ¥å®ç°ï¼š &lt;?phpnamespace Library\\Sessions;use SessionHandler;class RedisSession extends SessionHandler&#123; private $Redis; private $lifeTime = 7200; private $config; private $prefix = &#x27;PHPREDIS_SESSION:&#x27;; public function __construct($config) &#123; $this-&gt;config = $config; &#125; private function getRedisInstance() &#123; if (empty($this-&gt;Redis)) &#123; $Redis = new \\Redis(); $Redis-&gt;connect($this-&gt;config[&#x27;host&#x27;], $this-&gt;config[&#x27;port&#x27;], $this-&gt;config[&#x27;timeout&#x27;]); if (!$this-&gt;config[&#x27;auth&#x27;]) &#123; $Redis-&gt;auth($this-&gt;config[&#x27;auth&#x27;]); &#125; $this-&gt;Redis = $Redis; &#125; return $this-&gt;Redis; &#125; public function read($id) &#123; return $this-&gt;getRedisInstance()-&gt;get($this-&gt;prefix.$id); &#125; public function write($id, $data) &#123; if ($this-&gt;getRedisInstance()-&gt;setex($this-&gt;prefix.$id, $this-&gt;lifeTime, $data)) &#123; return true; &#125; return false; &#125; public function destroy($id) &#123; if($this-&gt;getRedisInstance()-&gt;delete($id))&#123;//åˆ é™¤Redisä¸­çš„æŒ‡å®šè®°å½• return true; &#125; return false; &#125; public function gc($maxlifetime) &#123; return true; &#125; public function __destruct() &#123; session_write_close(); &#125;&#125;$handler = new RedisSession([ &#x27;host&#x27; =&gt; &#x27;127.0.0.1&#x27;, &#x27;port&#x27; =&gt; 6379, &#x27;auth&#x27; =&gt; null, &#x27;timeout&#x27; =&gt; 5, ]);session_set_save_handler($handler, true);session_start();$_SESSION[&#x27;user_id&#x27;] = 10001;$_SESSION[&#x27;userInfo&#x27;] = [&#x27;name&#x27; =&gt; &#x27;sai&#x27;];p($_SESSION[&#x27;user_id&#x27;]);p($_SESSION[&#x27;userInfo&#x27;]); çŸ¥è¯†ç‚¹ï¼š è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹readæ–¹æ³•ï¼Œé‡Œé¢éœ€è¦åŠ ä¸€ä¸‹serializeï¼Œä»¥ä¾¿äºæˆ‘ä»¬å­˜å‚¨å¤æ‚çš„sessionç»“æ„ã€‚å¦‚æœä¸åŠ ä¼šæŠ¥é”™ï¼ˆWarning: session_start(): Failed to read session data: user (path: )ï¼‰è¿™æ˜¯å› ä¸ºRedisæ— æ³•ç›´æ¥å­˜å‚¨arrayç»“æ„ï¼Œéœ€è¦è½¬åŒ–ä¸ºstringç±»å‹å­˜å‚¨ã€‚ æˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹Rediså®¢æˆ·ç«¯å­˜å‚¨æƒ…å†µï¼š é€šç”¨æˆ‘ä»¬ä¹Ÿçœ‹åˆ°Rediså­˜å‚¨äº†sessionï¼Œä¸å‰é¢ç•¥æœ‰ä¸åŒçš„åªæ˜¯å­˜å‚¨çš„keyä¸ä¸€æ ·ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼š private $prefix = â€˜PHPREDIS_SESSION:â€™; ç„¶ååšä¸€ä¸‹è°ƒæ•´å³å¯ï¼š public function read($id)&#123; return serialize($this-&gt;getRedisInstance()-&gt;get($this-&gt;prefix.$id));&#125;public function write($id,$data)&#123; if ($this-&gt;getRedisInstance()-&gt;setex($this-&gt;prefix.$id, $this-&gt;lifeTime, $data)) &#123; return true; &#125; return false;&#125; è¿è¡Œåä¼šå‘ç°æŠŠä¹‹å‰ç¬¬ä¸€ç§è®¾ç½®çš„sessionè¦†ç›–æ‰ã€‚ å½“ç„¶æˆ‘æ¯”è¾ƒå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œä¾¿äºæˆ‘ä»¬å®šåˆ¶åŒ–ç¼–ç ã€‚ æ€»ç»“æ€»çš„æ¥è¯´ï¼Œä¸¤ç§æ–¹æ³•é…ç½®éƒ½æ¯”è¾ƒç®€å•ï¼Œä¸ªäººå»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼å®ç°ï¼Œè¿™æ ·ä¹Ÿæ¯”è¾ƒé€‚åˆé›†æˆåˆ°æ¡†æ¶ï¼ŒåæœŸæˆ‘ä»¬å¯ä»¥åœ¨è¿›è¡Œæ‰©å±•ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š6.ç®€å•æµ‹è¯•","path":"/2020/02/13/phpframe09/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ è™½ç„¶æ¡†æ¶åŸºæœ¬å®Œæˆï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰æµ‹è¯•è¿‡ã€‚ æˆ‘ä»¬ä½¿ç”¨postmanä½œä¸ºæ¥å£æµ‹è¯•å·¥å…·ï¼ˆhttp://saif.com/testï¼‰ã€‚ // è‡ªå®šä¹‰è·¯ç”±return [ &#x27;debug&#x27; =&gt; false, &#x27;route&#x27; =&gt; [ &#x27;&#x27; =&gt; &#x27;demo/welcome&#x27;, &#x27;test&#x27; =&gt; &#x27;demo/test&#x27;, ],];class DemoController extends Controller&#123; public function welcome($params) &#123; return $this-&gt;response-&gt;json([&#x27;hello&#x27; =&gt; &#x27;welcome&#x27;]); &#125; public function test($params) &#123; return $this-&gt;response-&gt;json($params); &#125;&#125; æˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š æˆ‘ä»¬å‘ç°èƒ½æ­£å¸¸è·å–è·å–GETå‚æ•°ï¼Œä½†æ²¡æœ‰è·å–åˆ°POSTå‚æ•°ã€‚ debugï¼š æˆ‘ä»¬å‘ç°Content-Typeè¾“å‡ºæ˜¯ï¼š multipart/form-data; boundary=--------------------------498010462598077868347660 æˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹ä»£ç ï¼š public function getBodyParams()&#123; $contentType = strtolower($this-&gt;getHeader(&#x27;Content-Type&#x27;)); // p($contentType); if (strpos($contentType, &#x27;multipart/form-data&#x27;) === false) &#123; $this-&gt;_bodyParams = \\json_decode(file_get_contents(&quot;php://input&quot;), true); &#125; else &#123; $this-&gt;_bodyParams = $_POST; &#125; return $this-&gt;_bodyParams?? [];&#125; å¦å¤–æˆ‘ä»¬å‘ç°getHeaderæ–¹æ³•æœ‰ç‚¹é—®é¢˜ï¼š public function getHeader($name, $defaultValue = null)&#123; $name = ucfirst($name); if (function_exists(&#x27;apache_request_headers&#x27;)) &#123; $headers = apache_request_headers(); p($headers); return $headers[$name]?? $defaultValue; &#125; // $_SERVERä½¿ç”¨ä¸‹åˆ’çº¿ $name = strtoupper(str_replace(&#x27;-&#x27;, &#x27;_&#x27;, $name)); // éƒ¨åˆ†è‡ªå®šä¹‰å‚æ•°éœ€è¦åŠ ä¸ŠHTTP_ return $_SERVER[$name]?? ($_SERVER[&#x27;HTTP_&#x27;.$name] ?? $defaultValue);&#125; æµ‹è¯•æ­£å¸¸ã€‚ å¦å¤–ï¼Œåšä¸€ä¸‹è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨public function test($params)ï¼Œæ˜¯æºäºæˆ‘ä»¬Requestï¼Œå°†å‚æ•°æ³¨å…¥åˆ°æ–¹æ³•é‡Œã€‚ public function runAction($route)&#123; ... çœç•¥ä»£ç  return $controller-&gt;$action(array_merge($this-&gt;getQueryParams(), $this-&gt;getBodyParams()));&#125; æ€§èƒ½æµ‹è¯• æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯wrkå‹æµ‹ wrk &gt; git clone https://github.com/wg/wrk&gt; cd wrk &gt; make&gt; ln -s ./wrk /usr/bin/wrk wrkå‚æ•°ï¼š-c, --connectionsï¼ˆè¿æ¥æ•°ï¼‰: total number of HTTP connections to keep open with each thread handling N = connections/threads-d, --durationï¼ˆæµ‹è¯•æŒç»­æ—¶é—´ï¼‰: duration of the test, e.g. 2s, 2m, 2h-t, --threadsï¼ˆçº¿ç¨‹ï¼‰: total number of threads to use-s, --scriptï¼ˆè„šæœ¬ï¼‰: LuaJIT script, see SCRIPTING-H, --headerï¼ˆå¤´ä¿¡æ¯ï¼‰: HTTP header to add to request, e.g. &quot;User-Agent: wrk&quot; --latencyï¼ˆå“åº”ä¿¡æ¯ï¼‰: print detailed latency statistics --timeoutï¼ˆè¶…æ—¶æ—¶é—´ï¼‰: record a timeout if a response is not received within this amount of time.-v, --versionï¼ˆç‰ˆæœ¬ä¿¡æ¯ï¼‰ Print version details æˆ‘ä»¬ä»…ä»…åœ¨æ§åˆ¶è¿”å›ç©ºä¿¡æ¯ï¼Œç„¶åå¯¹æ¯”yii2ï¼ˆè¿”å›å­—ç¬¦ä¸²â€œyii2â€ï¼‰ï¼Œlaravel5.5ï¼ˆè¿”å›å­—ç¬¦ä¸²â€œlaravel5.5â€ï¼‰ã€‚ å› ä¸ºæˆ‘ä»¬çš„æ¡†æ¶æ²¡æœ‰ä¸­é—´ä»¶ã€ç»„ä»¶ä¹‹ç±»çš„ï¼Œæ‰€ä»¥æ€§èƒ½å¯¹æ¯”yii2ã€laravelï¼ŒQPSè¦é«˜å¾ˆå¤šã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š5.è‡ªå®šä¹‰é…ç½®ä¸è·¯ç”±","path":"/2020/02/09/phpframe08/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ æˆ‘ä»¬å·²ç»å¼€å‘å®Œæˆï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦æ›´å¤šã€‚æ¯”å¦‚è‡ªå®šä¹‰é…ç½®å’Œè·¯ç”±ã€‚ appæ–‡ä»¶å¤¹ä¸‹æ–°å»ºConfig.php &lt;?php/** *è‡ªå®šä¹‰é…ç½® */return [ &#x27;debug&#x27; =&gt; false, &#x27;route&#x27; =&gt; [ &#x27;&#x27; =&gt; &#x27;demo/welcome&#x27;, &#x27;test&#x27; =&gt; &#x27;demo/test&#x27;, ],]; æ–°å»ºDemoControllerï¼ˆapp/Https/Controllersç›®å½•ä¸‹ï¼‰ &lt;?php/** * Demoæ§åˆ¶å™¨ */namespace App\\Https\\Controllers;use Library\\Https\\Controller;class DemoController extends Controller&#123; public function welcome($params) &#123; return $this-&gt;response-&gt;json([&#x27;hello&#x27; =&gt; &#x27;welcome&#x27;]); &#125; public function test($params) &#123; return $this-&gt;response-&gt;json($params); &#125;&#125; ä¿®æ”¹å…¥å£æ–‡ä»¶index.php,åŠ å…¥åŠ è½½é…ç½®ä»£ç ï¼š ... çœç•¥ä»£ç // åŠ è½½é…ç½®$config = require SF_LIBRARY_PATH.&#x27;Config.php&#x27;;$appConfig = file_exists($appConfigPath = SF_APP_PATH.&#x27;Config.php&#x27;) ? require $appConfigPath : [];$config = array_merge($config, $appConfig);$config[&#x27;debug&#x27;] = ($config[&#x27;debug&#x27;]?? SF_DEBUG);...çœç•¥ä»£ç  è§£æè·¯ç”±éƒ¨åˆ†ä¹ŸåŠ å…¥è‡ªå®šä¹‰è·¯ç”±å¤„ç†ï¼š // Application...çœç•¥ä»£ç public function handleRequest(Request $request)&#123; $route = $request-&gt;resolve($this-&gt;_config[&#x27;route&#x27;]??[]); $response = $request-&gt;runAction($route); /** * æ‰§è¡Œç»“æœèµ‹å€¼ç»™$response-&gt;dataï¼Œå¹¶è¿”å›ç»™responseå¯¹è±¡ */ if ($response instanceof Response) &#123; return $response; &#125; throw new SaiException(&#x27;Content format error&#x27;);&#125;...çœç•¥ä»£ç // Request...çœç•¥ä»£ç public function runAction($route)&#123; if (array_key_exists($route, $this-&gt;_route)) &#123; $route = $this-&gt;_route[$route]; &#125; $match = explode(&#x27;/&#x27;, $route); $match = array_filter($match); ...çœç•¥ä»£ç  ä¿å­˜åæ‰“å¼€æµè§ˆå™¨çœ‹çœ‹æ•ˆæœï¼š è¿™é‡Œè™½ç„¶æœ‰è‡ªå®šä¹‰è·¯ç”±ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦ç¦æ­¢é»˜è®¤è·¯ç”±ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨å¢åŠ é…ç½®å‚æ•°defaultRouteï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¼€å¯é»˜è®¤è·¯ç”±ã€‚ æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è·¯ç”±è§£æçš„ä»£ç ï¼š //Application...çœç•¥ä»£ç public function handleRequest(Request $request)&#123; $route = $request-&gt;resolve($this-&gt;_config[&#x27;route&#x27;]??[]); $response = $request-&gt;runAction($route, $this-&gt;_config[&#x27;defaultRoute&#x27;]??true); /** * æ‰§è¡Œç»“æœèµ‹å€¼ç»™$response-&gt;dataï¼Œå¹¶è¿”å›ç»™responseå¯¹è±¡ */ if ($response instanceof Response) &#123; return $response; &#125; throw new SaiException(&#x27;Content format error&#x27;);&#125;...çœç•¥ä»£ç  ...çœç•¥ä»£ç public function runAction($route, $defaultRoute)&#123; if (array_key_exists($route, $this-&gt;_route)) &#123; $route = $this-&gt;_route[$route]; &#125; elseif (!$defaultRoute) &#123; throw new NotFoundException(&quot;route not found:&quot;.$route); &#125; ...çœç•¥ä»£ç  æˆ‘ä»¬åœ¨appä¸‹é¢çš„Configï¼ŒåŠ å…¥ï¼š return [ &#x27;debug&#x27; =&gt; false, &#x27;route&#x27; =&gt; [ &#x27;&#x27; =&gt; &#x27;demo/welcome&#x27;, &#x27;test&#x27; =&gt; &#x27;demo/test&#x27;, ], &#x27;defaultRoute&#x27; =&gt; false,]; æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è¾“å…¥http://saif.com/login æŠ¥é”™å¦‚ä¸‹ï¼š Array ( [line] =&gt; 137 [msg] =&gt; route not found:login [code] =&gt; 404 [file] =&gt; library/Https/Request.php )","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š4.å…¥å£æ–‡ä»¶","path":"/2020/02/08/phpframe07/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ å›é¡¾ä¸Šä¸€èŠ‚æˆ‘ä»¬å®Œæˆäº†ä»è·¯ç”±è§£æåˆ°æ•°æ®è¾“å‡ºçš„è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¹‹å‰å·²ç»å®Œæˆäº†Requestçš„ç¼–å†™ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å†™å®Œå…¥å£æ–‡ä»¶ï¼ŒçœŸæ­£çš„å°†æˆ‘ä»¬çš„webåº”ç”¨è·‘èµ·æ¥äº†ã€‚ å…¥å£æ–‡ä»¶é‡Œéœ€è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ è¿˜è®°å¾—é‚£ä¸ªæµç¨‹å›¾å—ï¼Ÿ æˆ‘ä»¬éœ€è¦åŠ è½½é…ç½®ï¼Œå®ä¾‹åŒ–Applicationå¹¶è¿è¡Œï¼Œå¹¶ä¸”å¼•å…¥åé¢å¯èƒ½é‡åˆ°çš„ä¸€äº›å¸¸é‡ã€‚ &lt;?phprequire __DIR__.DIRECTORY_SEPARATOR.&#x27;..&#x27;.DIRECTORY_SEPARATOR.&#x27;library&#x27;.DIRECTORY_SEPARATOR.&#x27;System.php&#x27;;// åŠ è½½é…ç½®$config = require SF_LIBRARY_PATH.&#x27;Config.php&#x27;;$config[&#x27;debug&#x27;] = ($config[&#x27;debug&#x27;]?? SF_DEBUG);if ($config[&#x27;debug&#x27;]) &#123; ini_set(&quot;display_errors&quot;, &quot;On&quot;); error_reporting(E_ALL);&#125;// composerè‡ªåŠ¨åŠ è½½require __DIR__ . &#x27;/../vendor/autoload.php&#x27;;// å®ä¾‹åŒ–åº”ç”¨å¹¶è¿è¡Œ$app = new Library\\Application(new Library\\Https\\Request() ,$config);$app-&gt;run(); çŸ¥è¯†ç‚¹ï¼š __DIR__æ˜¯PHPçš„ä¸€ä¸ªé­”æœ¯å¸¸é‡ï¼Œå¯ä»¥ç†è§£æˆå½“å‰æ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚DIRECTORY_SEPARATORæ˜¯ä¸€ä¸ªæ˜¾ç¤ºç³»ç»Ÿåˆ†éš”ç¬¦çš„å‘½ä»¤ï¼ŒDIRECTORY_SEPARATORæ˜¯PHPçš„å†…éƒ¨å¸¸é‡ï¼Œä¸éœ€è¦ä»»ä½•å®šä¹‰ä¸åŒ…å«å³å¯ç›´æ¥ä½¿ç”¨ã€‚ ini_set â€” ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼ error_reporting â€” è®¾ç½®åº”è¯¥æŠ¥å‘Šä½•ç§ PHP é”™è¯¯ &lt;?php// Turn off all error reportingerror_reporting(0);// Report simple running errorserror_reporting(E_ERROR | E_WARNING | E_PARSE);// Reporting E_NOTICE can be good too (to report uninitialized// variables or catch variable name misspellings ...)error_reporting(E_ERROR | E_WARNING | E_PARSE | E_NOTICE);// Report all errors except E_NOTICEerror_reporting(E_ALL &amp; ~E_NOTICE);// Report all PHP errors (see changelog)error_reporting(E_ALL);// Report all PHP errorserror_reporting(-1);// Same as error_reporting(E_ALL);ini_set(&#x27;error_reporting&#x27;, E_ALL);?&gt; System.php&lt;?php// debugé»˜è®¤å¼€å¯defined(&#x27;SF_DEBUG&#x27;) or define(&#x27;SF_DEBUG&#x27;, true);// æ¡†æ¶å¼€å§‹è¿è¡Œæ—¶é—´defined(&#x27;SF_START_TIME&#x27;) or define(&#x27;SF_START_TIME&#x27;, microtime(true));// æ ¸å¿ƒæ–‡ä»¶ç›®å½•defined(&#x27;SF_LIBRARY_PATH&#x27;) or define(&#x27;SF_LIBRARY_PATH&#x27;, __DIR__.DIRECTORY_SEPARATOR);// åº”ç”¨ç›®å½•defined(&#x27;SF_APP_PATH&#x27;) or define(&#x27;SF_APP_PATH&#x27;, __DIR__.DIRECTORY_SEPARATOR.&#x27;..&#x27;.DIRECTORY_SEPARATOR.&#x27;app&#x27;.DIRECTORY_SEPARATOR);// å…¥å£ç›®å½•defined(&#x27;SF_PUBLIC_PATH&#x27;) or define(&#x27;SF_PUBLIC_PATH&#x27;, __DIR__.DIRECTORY_SEPARATOR.&#x27;..&#x27;.DIRECTORY_SEPARATOR.&#x27;public&#x27;.DIRECTORY_SEPARATOR); Config.php&lt;?php/** * ç³»ç»Ÿé…ç½® */return [ &#x27;debug&#x27; =&gt; true, // å»ºè®®å¼€å‘è¿‡ç¨‹ä¸­å¼€å¯]; åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„æ¡†æ¶å·²ç»å¯ä»¥è¿è¡Œèµ·æ¥äº†ã€‚ è¿è¡Œåº”ç”¨é…ç½®Nginx server &#123; listen 80; server_name saif.com; # æ¡†æ¶æ ¹ç›®å½• root /Users/sai/Work/www/saif/public; location / &#123; index index.html index.htm index.php; try_files $uri $uri/ /index.php?$query_string; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; &#125; location ~ \\.php$ &#123; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; &#125;&#125; æµè§ˆå™¨è¾“å…¥http://saif.comã€‚ ä½ ä¼šçœ‹åˆ°è¿”å›çš„jsonæ•°ç»„ï¼š å¤‡æ³¨ï¼šå‰é¢3è¡Œè¯·å¿½ç•¥ï¼Œæ˜¯æˆ‘æµè§ˆå™¨çš„æ’ä»¶è‡ªåŠ¨åŠ å…¥çš„ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºç¡€APIæ¡†æ¶çš„å¼€å‘ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š3.è·¯ç”±è§£æ","path":"/2020/02/08/phpframe06/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ å›é¡¾ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†ç¼–å†™äº†å¦‚ä½•å¤„ç†è¯·æ±‚ä¸è¾“å‡ºæ•°æ®ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬å¼€å§‹ç¼–å†™è·¯ç”±æ¨¡å—ã€‚ æ­£æ–‡è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„Applicationåœ¨å“ªé‡Œå—ï¼Ÿ æˆ‘ä»¬å…ˆæ€è€ƒä¸€ä¸‹Applicationåº”è¯¥å…·å¤‡å“ªäº›åŠŸèƒ½ï¼Ÿ é¦–å…ˆå¾ˆé‡è¦çš„ï¼Œæˆ‘ä»¬è¦è®©åº”ç”¨è¿è¡Œèµ·æ¥ï¼Œå§‘ä¸”å°±å…ˆå®šä¹‰runæ–¹æ³•ã€‚å¦å¤–æˆ‘ä»¬éœ€è¦å¤„ç†è¯·æ±‚å¹¶ä¸”è¾“å‡ºæ•°æ®ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªhandleRequestæ–¹æ³•ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨æ˜¯æœ‰ä¸€äº›é…ç½®ä¿¡æ¯ï¼ˆconfigï¼‰çš„ã€‚ å› ä¸ºï¼Œæˆ‘ä»¬ä¸éš¾ç¼–å†™å‡ºä»¥ä¸‹ä»£ç ï¼š &lt;?phpnamespace Library;use Library\\Exceptions\\SaiException;use Library\\Https\\Request;use Library\\Https\\Response;class Application&#123; private $config; private $request; public function __construct(Request $request, $config = []) &#123; $this-&gt;config = $config; $this-&gt;request = $request; &#125; /** * è¿è¡Œåº”ç”¨å¹¶è¾“å‡ºæ•°æ® * @return bool */ public function run() &#123; try &#123; $response = $this-&gt;handleRequest($this-&gt;request); $response-&gt;send(); return $response-&gt;exitStatus; &#125; catch (SaiException $e) &#123; $e-&gt;response($e-&gt;getCode(), [ &#x27;line&#x27; =&gt; $e-&gt;getLine(), &#x27;msg&#x27; =&gt; $e-&gt;getMessage(), &#x27;code&#x27; =&gt; $e-&gt;getCode(), &#x27;file&#x27; =&gt; $e-&gt;getFile(), ]); return false; &#125; &#125; /** * å¤„ç†è¯·æ±‚ * @param Request $request * @return mixed * @throws SaiException */ public function handleRequest(Request $request) &#123; // todo // è¿”å›Responseå¯¹è±¡ return $response; &#125;&#125; è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°handleRequestæ–¹æ³•è¿˜æœ‰ä¸€éƒ¨åˆ†ä»£ç ä¸ºå®Œæˆï¼Œå›æƒ³ä»¥ä¸‹æµç¨‹å›¾ï¼Œè¿™é‡Œå°±æ˜¯æˆ‘ä»¬æ¯”è¾ƒæ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œè·¯ç”±å¤„ç†æ¨¡å—ã€‚ è·¯ç”±è§£æè·¯ç”±è§£ææˆ‘ä»¬ä½¿ç”¨éå¸¸ç®€å•è€Œå¸¸è§çš„å¤„ç†æ–¹å¼ï¼Œä¸å¦¨çœ‹å‡ ä¸ªurlä¾‹å­æ¥ç†è§£ä¸€ä¸‹ï¼š route controller method http://blog.puresai.com/ IndexController index http://blog.puresai.com/admin AdminController index http://blog.puresai.com/admin/test AdminController test http://blog.puresai.com/admin/index/test Admin\\IndexController test æœ‰æ²¡æœ‰çœ‹å‡ºè§„å¾‹ï¼Œæˆ‘ä»¬ä¼šä»¥æ–œæ /åˆ†å‰²è·¯ç”±ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæœ€åä¸¤éƒ¨åˆ†åˆ†åˆ«æ˜¯å¯¹åº”çš„æ§åˆ¶å™¨åç§°å’Œæ–¹æ³•åç§°ï¼Œå°‘äºä¸¤éƒ¨åˆ†é»˜è®¤ç”¨indexï¼Œå¤šä½™ä¸¤éƒ¨åˆ†çš„ä½œä¸ºæ§åˆ¶å™¨çš„å‘½åç©ºé—´ã€‚ç„¶åæˆ‘ä»¬è¦æ ¹æ®è·¯ç”±æ‰¾åˆ°æ§åˆ¶å™¨æ„å»ºå‡ºæ§åˆ¶å™¨ã€‚ /** * æ§åˆ¶å™¨å¤„ç† * @param $route * @return mixed * @throws NotFoundException */public function runAction($route)&#123; $match = explode(&#x27;/&#x27;, $route); $match = array_filter($match); // å¤„ç†$route=/ if (empty($match)) &#123; $match = [&#x27;index&#x27;]; $controller = $this-&gt;createController($match); $action = &#x27;index&#x27;; // å¤„ç†$route=index &#125; elseif (count($match) &lt; 2) &#123; $controller = $this-&gt;createController($match); $action = &#x27;index&#x27;; &#125; else &#123; $action = array_pop($match); $controller = $this-&gt;createController($match); if (!method_exists($controller, $action)) &#123; throw new NotFoundException(&quot;method not found:&quot;.$action); &#125; &#125; // å°†getå’Œpostæ³¨å…¥æ§åˆ¶å™¨æ–¹æ³•ä¸­ return $controller-&gt;$action(array_merge($this-&gt;getQueryParams(), $this-&gt;getBodyParams()));&#125;// appåº”ç”¨æ§åˆ¶å™¨å‘½åç©ºé—´private $controllerNameSpace = &#x27;App\\\\Https\\\\Controllers\\\\&#x27;;// ä¹‹å‰å®šä¹‰çš„åŸºç±»æ§åˆ¶å™¨private $baseController = &#x27;Library\\\\Https\\\\Controller&#x27;;public function createController($match)&#123; $controllerName = $this-&gt;controllerNameSpace; foreach ($match as $namespace) &#123; $controllerName .= ucfirst($namespace).&#x27;\\\\&#x27;; &#125; $controllerName = rtrim($controllerName,&#x27;\\\\&#x27;).&#x27;Controller&#x27;; if (!class_exists($controllerName)) &#123; if ($controllerName == $this-&gt;controllerNameSpace.&#x27;IndexController&#x27;) &#123; return new $this-&gt;baseController; &#125; throw new NotFoundException(&quot;controller not found:&quot;.$controllerName); &#125; return new $controllerName;&#125; ä¸Šé¢æ˜¯å¯»æ‰¾æ§åˆ¶å™¨å’Œæ–¹æ³•çš„è¿‡ç¨‹ï¼Œä½†æˆ‘ä»¬éœ€è¦æå‰è·å¾—é¡µé¢åœ°å€ä»¥è§£æè·¯ç”±ã€‚ çŸ¥è¯†ç‚¹ï¼š åæ–œæ ï¼šåæ–œçº¿æœ‰å¤šç§ç”¨æ³•ã€‚é¦–å…ˆï¼Œå¦‚æœç´§æ¥ç€æ˜¯ä¸€ä¸ªéå­—æ¯æ•°å­—å­—ç¬¦ï¼Œè¡¨æ˜å–æ¶ˆ è¯¥å­—ç¬¦æ‰€ä»£è¡¨çš„ç‰¹æ®Šæ¶µä¹‰ã€‚è¿™ç§å°†åæ–œçº¿ä½œä¸ºè½¬ä¹‰å­—ç¬¦çš„ç”¨æ³•åœ¨å­—ç¬¦ç±» å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ç”¨ã€‚ array_filter ( array $array [, callable $callback [, int $flag = 0 ]] ) : arrayâ€”â€”ä¾æ¬¡å°† array æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ° callback å‡½æ•°ã€‚å¦‚æœ callback å‡½æ•°è¿”å› trueï¼Œåˆ™ array æ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›çš„ç»“æœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ã€‚ä»£ç ä¸­æ˜¯è¿‡æ»¤valueä¸ºç©ºçš„å•å…ƒã€‚ è·å–é¡µé¢åœ°å€/** * è¿”å›ä¸å«å‚æ•°çš„REQUEST_URIåœ°å€ */public function resolve()&#123; return $this-&gt;getPathUrl();&#125;private $pathUrl;/** * è·å–è¯·æ±‚åœ°å€ * @return bool|mixed|string */public function getPathUrl()&#123; if (is_null($this-&gt;pathUrl)) &#123; $url = trim($_SERVER[&#x27;REQUEST_URI&#x27;], &#x27;/&#x27;); $index = strpos($url, &#x27;?&#x27;); $this-&gt;pathUrl = ($index &gt; -1) ? substr($url, 0, $index) : $url; &#125; return $this-&gt;pathUrl;&#125; æˆ‘ä»¬å°½é‡è®©Applicationå˜å¾—ç®€æ´ï¼Œè€Œè·¯ç”±è§£æåˆå’ŒRequestå…³è”åº¦è¾ƒé«˜ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¦¨æŠŠè¿™äº›æ–¹æ³•æŠ›å‡ºåˆ°Requestå¯¹è±¡ã€‚ çŸ¥è¯†ç‚¹ï¼š strpos ( string $haystack , mixed $needle [, int $offset = 0 ] ) : intâ€”â€”è¿”å› needle åœ¨ haystack ä¸­é¦–æ¬¡å‡ºç°çš„æ•°å­—ä½ç½®ï¼Œå¦‚æœæ²¡æ‰¾åˆ° needleï¼Œå°†è¿”å› FALSEã€‚ ä¸Šé¢å·²ç»è§£æå¥½è·¯ç”±å¹¶ä¸”æ‰¾åˆ°äº†æ§åˆ¶å™¨å’Œæ–¹æ³•ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®Œå–„Applicationçš„ä»£ç äº†ã€‚ å¤„ç†è¯·æ±‚public function handleRequest(Request $request)&#123; $route = $request-&gt;resolve(); $response = $request-&gt;runAction($route); /** * æ‰§è¡Œç»“æœèµ‹å€¼ç»™$response-&gt;dataï¼Œå¹¶è¿”å›ç»™responseå¯¹è±¡ */ if ($response instanceof Response) &#123; return $response; &#125; throw new SaiException(&#x27;è¾“å‡ºçš„å†…å®¹æ ¼å¼é”™è¯¯&#x27;);&#125; å†æ¬¡éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä»…åšäº†jsonæ ¼å¼è¾“å‡ºï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œä½ å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ‹“å±•ä¸€ä¸‹ã€‚ å¦ï¼šNotFoundExceptionç»§æ‰¿è‡ªSaiExceptionï¼Œä»£ç ï¼š &lt;?phpnamespace Library\\Exceptions;class NotFoundException extends SaiException&#123; protected $code = 404;&#125;","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š2.è¯·æ±‚ä¸è¾“å‡º","path":"/2020/02/04/phpframe05/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ æˆ‘ä»¬åœ¨library\\Httpsç›®å½•ä¸‹æ–°å»ºRequestã€Responseï¼Œå¼€å§‹ç¼–å†™è¯·æ±‚å’Œè¾“å‡ºçš„ä»£ç ã€‚ Requestæˆ‘ä»¬å®ç°å‡ ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œgetã€postã€methodç­‰ï¼Œè¿™é‡Œä¸»è¦ç”¨$_SERVERå®ç°ï¼Œä¸ºäº†å¤ç”¨æˆ‘ä»¬å®šä¹‰äº†ä¸‰ä¸ªç§æœ‰å±æ€§å­˜å‚¨getå‚æ•°ã€postå‚æ•°å’Œmethodã€‚ &lt;?php/** * å¤„ç†è¯·æ±‚ */namespace Library\\Https;use Library\\Components\\Base;class Request extends Base&#123; /** * è·å–è¯·æ±‚æ–¹æ³• * @return string */ public function getMethod() &#123; if (isset($_SERVER[&#x27;REQUEST_METHOD&#x27;])) &#123; return strtoupper($_SERVER[&#x27;REQUEST_METHOD&#x27;]); &#125; return &#x27;GET&#x27;; &#125; /** * è¯·æ±‚å¤´ * @param $name * @param null $defaultValue * @return mixed|null */ public function getHeader($name, $defaultValue = null) &#123; $name = ucfirst($name); if (function_exists(&#x27;apache_request_headers&#x27;)) &#123; $headers = apache_request_headers(); return $headers[$name]?? $defaultValue; &#125; $name = strtoupper($name); return $_SERVER[$name]?? $defaultValue; &#125; /** * è·å–getå‚æ•° * @param null $name * @param null $defaultValue * @return |null */ public function get($name = null, $defaultValue = null) &#123; if ($name === null) &#123; return $this-&gt;getQueryParams(); &#125; return $this-&gt;getQueryParam($name, $defaultValue); &#125; public function getQueryParam($name, $defaultValue = null) &#123; $params = $this-&gt;getQueryParams(); return isset($params[$name]) ? $params[$name] : $defaultValue; &#125; public function getQueryParams() &#123; if (empty($this-&gt;queryParams)) &#123; return $this-&gt;queryParams = $_GET; &#125; return $this-&gt;queryParams; &#125; /** * è·å–postå‚æ•° * @param null $name * @param null $defaultValue * @return array|mixed|null */ public function post($name = null, $defaultValue = null) &#123; if ($name === null) &#123; return $this-&gt;getBodyParams(); &#125; return $this-&gt;getBodyParam($name, $defaultValue); &#125; public function getBodyParam($name, $defaultValue = null) &#123; $params = $this-&gt;getBodyParams(); if (is_object($params)) &#123; try &#123; return $params-&gt;&#123;$name&#125;; &#125; catch (\\Exception $e) &#123; return $defaultValue; &#125; &#125; return isset($params[$name]) ? $params[$name] : $defaultValue; &#125; public function getBodyParams() &#123; $contentType = strtolower($this-&gt;getHeader(&#x27;Content-Type&#x27;)); if ($contentType == &#x27;multipart/form-data&#x27;) &#123; $this-&gt;bodyParams = $_POST; &#125; else &#123; $this-&gt;bodyParams = \\json_decode(file_get_contents(&quot;php://input&quot;), true); &#125; return $this-&gt;bodyParams?? []; &#125; /** * getå‚æ•°æ•°ç»„ */ private $queryParams = []; /** * postå‚æ•°æ•°ç»„ */ private $bodyParams = []; private $method;&#125; çŸ¥è¯†ç‚¹ï¼š è·å–è¯·æ±‚å¤´éƒ¨ä¿¡æ¯çš„æ–¹å¼nginxå’Œapacheä¸åŒ apacheå¯ä»¥ä½¿ç”¨apache_request_headers nginxä½¿ç”¨$_SERVERï¼Œå¹¶ä¸”éœ€è¦æ³¨æ„çš„æ˜¯çš„æ˜¯è‡ªå®šä¹‰ä¿¡æ¯ç­‰å‚æ•°ä¼šåœ¨å‰é¢è‡ªåŠ¨åŠ ä¸Šhttp_ï¼Œå¹¶ä¸”ä¼šè½¬æ¢ä¸ºå¤§å†™ postå‚æ•°è·å–çš„æ–¹å¼ å½“Content-Typeæ˜¯application/x-www-data-urlencodedæˆ–multipart/form-dataæ—¶ï¼Œæ•°æ®ä¼šæ”¾è¿›$_POSTä¸­ï¼› é™¤äº†Coentent-Typeä¸ºmultipart/form-dataçš„æƒ…å†µï¼Œæ•°æ®éƒ½å¯ä»¥é€šè¿‡file_get_contents(â€œphp://inputâ€)å–åˆ°ï¼› ä¸å»ºè®®ä½¿ç”¨$GLOBALS[â€˜HTTP_RAW_POST_DATAâ€™] ResponseResponseé»˜è®¤ä»¥ä½¿ç”¨å¹¿æ³›çš„jsonè¾“å‡ºï¼Œæš‚æ—¶ä¹Ÿåªè€ƒè™‘jsonæ ¼å¼è¾“å‡ºçš„æƒ…å†µã€‚ &lt;?php/** * æ•°æ®è¾“å‡º */namespace Library\\Https;use Library\\Components\\Base;class Response extends Base&#123; public $code = 0; public $result = []; public $msg = &quot;success&quot;; public function send() &#123; header(&#x27;Content-Type:application/json; charset=utf-8&#x27;); echo \\json_encode([ &#x27;data&#x27; =&gt; $this-&gt;result, &#x27;msg&#x27; =&gt; $this-&gt;msg, &#x27;code&#x27; =&gt; $this-&gt;code, &#x27;timestamp&#x27; =&gt; time() ]); &#125; public function json($data = []) &#123; $this-&gt;result = array_merge($this-&gt;result, $data); return $this; &#125;&#125; çŸ¥è¯†ç‚¹ï¼š header() ç”¨äºå‘é€åŸç”Ÿçš„ HTTP å¤´ã€‚ json_encode ( mixed $value [, int $options = 0 [, int $depth = 512 ]] ) : string â€” å¯¹å˜é‡è¿›è¡Œ JSON ç¼–ç ï¼Œoptionså¯ä»¥é¢„å®šä¹‰å¸¸é‡ï¼Œå¦‚ JSON_UNESCAPED_UNICODEï¼ŒJSON_UNESCAPED_SLASHESã€‚ Controllerç»“åˆè¾“å‡ºå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªåŸºç±»æ§åˆ¶å™¨ï¼Œä¹Ÿæ”¾åœ¨ç›¸åŒçš„Httpsç›®å½•ï¼Œæˆ‘ä»¬æ§åˆ¶åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªResponseï¼Œå¹¶å®ç°ä¸€ä¸ªé€šç”¨çš„jsonï¼š &lt;?php/** * åŸºç±»æ§åˆ¶å™¨ * é¢„å®šä¹‰jsonæ–¹æ³•ï¼Œä¾¿äºå…¶ä»–æ§åˆ¶å™¨ä½¿ç”¨ * è¿”å›æ ¼å¼ &#123; &quot;data&quot;: [], &quot;msg&quot;: &quot;success&quot;, &quot;code&quot;: 0, &quot;timestamp&quot;: 1572231957&#125; */namespace Library\\Https;class Controller&#123; protected $response; protected $code = 200; public function __construct() &#123; $this-&gt;response = new Response(); &#125; public function json($data = []) &#123; return $this-&gt;response-&gt;json($data); &#125; public function index($params) &#123; return $this-&gt;response-&gt;json([&#x27;hello&#x27; =&gt; &#x27;saif&#x27;]); &#125;&#125; appåº”ç”¨é‡Œçš„æ§åˆ¶å™¨éƒ½å¿…é¡»ç»§æ‰¿è¿™ä¸ªåŸºç±»æ§åˆ¶å™¨ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"æ¡†æ¶ç¯‡ï¼š1.æ¡†æ¶ç›®å½•ä¸è¾…åŠ©","path":"/2020/02/02/phpframe04/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ é‚£ä¹ˆå°±åˆ©ç”¨composeræ¥å¼€å§‹æˆ‘ä»¬çš„é¡¹ç›®å§ã€‚ æ–°å»ºç›®å½•å¹¶è¿›å…¥ç›®å½•ï¼Œè¾“å…¥å‘½ä»¤ï¼š composer init å‘½ä»¤è¡Œä¼šè·Ÿä½ ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼ˆä»¥ä¸‹ä¿¡æ¯å¯ä»¥è‡ªè¡ŒDIYï¼‰ # 1. è¾“å…¥é¡¹ç›®å‘½åç©ºé—´# æ³¨æ„&lt;vendor&gt;/&lt;name&gt; å¿…é¡»è¦ç¬¦åˆ [a-z0-9_.-]+/[a-z0-9_.-]+Package name (&lt;vendor&gt;/&lt;name&gt;) yourname/projectname# 2. é¡¹ç›®æè¿°Description []:è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•composer init é¡¹ç›®# 3. è¾“å…¥ä½œè€…ä¿¡æ¯Author [puresai &lt;sai0556@qq.com&gt;, n to skip]:# 4. è¾“å…¥æœ€ä½ç¨³å®šç‰ˆæœ¬ï¼Œstable, RC, beta, alpha, devMinimum Stability []:dev# 5. è¾“å…¥é¡¹ç›®ç±»å‹Package Type (e.g. library, project, metapackage, composer-plugin) []:project# 6. è¾“å…¥æˆæƒç±»å‹License []:MITDefine your dependencies.# 7. è¾“å…¥ä¾èµ–ä¿¡æ¯Would you like to define your dependencies (require) interactively [yes]?# 7.1. å¦‚æœéœ€è¦ä¾èµ–ï¼Œåˆ™è¾“å…¥è¦å®‰è£…çš„ä¾èµ–Search for a package:php# 7.2. è¾“å…¥ç‰ˆæœ¬å·Enter the version constraint to require (or leave blank to use the latest version): &gt;=5.4.0# å¦‚éœ€å¤šä¸ªä¾èµ–ï¼Œåˆ™é‡å¤ä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤(7.1/7.2)Search for a package:# 8. æ˜¯å¦éœ€è¦require-devï¼ŒWould you like to define your dev dependencies (require-dev) interactively [yes]?&#123; &quot;name&quot;: &quot;sai/saif&quot;, &quot;description&quot;: &quot;php framework&quot;, &quot;type&quot;: &quot;project&quot;, &quot;require&quot;: &#123; &#125;, &quot;license&quot;: &quot;MIT&quot;, &quot;authors&quot;: [ &#123; &quot;name&quot;: &quot;puresai&quot;, &quot;email&quot;: &quot;sai0556@qq.com&quot; &#125; ], &quot;minimum-stability&quot;: &quot;dev&quot;&#125;# 9. æ˜¯å¦ç”Ÿæˆcomposer.jsonDo you confirm generation [yes]?# ç°åœ¨å®‰è£…ä¾èµ–é¡¹å—Would you like to install dependencies now [yes]? æˆ‘ä»¬çš„ç›®å½•ä¸‹ä¼šç”Ÿæˆcomposer.jsonã€‚ ç„¶åæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š ä½ è§‰å¾—ä¸€ä¸ªåŸºç¡€çš„APIæ¡†æ¶éœ€è¦ä»€ä¹ˆæ¨¡å—å‘¢ï¼Ÿ ä¸‹é¢æ˜¯æˆ‘çš„æ€è€ƒç»“æœï¼š è·¯ç”± è¯·æ±‚ æ•°æ®å“åº” å¼‚å¸¸å¤„ç† æ—¥å¿—ç³»ç»Ÿâ€¦ å½“ç„¶ï¼Œä½ å¯èƒ½è§‰å¾—è¿˜åº”è¯¥æœ‰ï¼š é…ç½® session ç¼“å­˜ éªŒè¯ æ¨¡å‹ æœåŠ¡å±‚ æ–‡ä»¶ä¸Šä¼ â€¦ ä¹Ÿè®¸ä½ æƒ³åˆ°æ›´å¤šï¼š ä»»åŠ¡è°ƒåº¦ é˜Ÿåˆ— ç”¨æˆ·éªŒè¯ é” â€¦ é‚£ä¹ˆè¿™ä¹ˆäº›æˆ‘ä»¬å¦‚ä½•å–èˆå‘¢ï¼Ÿæ‰‹å¿ƒæ‰‹èƒŒéƒ½æ˜¯è‚‰å•Šã€‚ è¿™é‡Œéœ€è¦åšä¸€ä¸‹è¯´æ˜ï¼Œæˆ‘ä»¬æ‰€åšçš„æ¡†æ¶æ— éœ€è€ƒè™‘å¤ªå¤šçš„åŠŸèƒ½ï¼Œæ˜¯åšä¸€ä¸ªç®€å•å¯ç”¨çš„APIæ¥å£æ¡†æ¶ï¼Œæˆ‘ä»¬æ¥å—get/postè¯·æ±‚ï¼Œè¿”å›jsonæ•°æ®ï¼Œå¹¶ä¸”è·¯ç”±å¥½ç”¨ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åˆè¡·ï¼Œå…¶ä»–çš„æš‚ä¸”å°±â€œæ–­èˆç¦»â€å§ã€‚ æˆ‘ä»¬å…ˆç”»ä¸€ä¸ªæç®€çš„æµç¨‹å›¾ã€‚ æˆ‘ä»¬ä¸€åˆ‡ä»ç®€ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š è·¯ç”± æ§åˆ¶å™¨ è¯·æ±‚ æ•°æ®å“åº” é…ç½® å¼‚å¸¸å¤„ç† â€¦ åŸºäºè¿™äº›ï¼Œæˆ‘ä»¬æ–°å»ºç›®å½•ï¼Œappå’Œlibraryï¼Œpublic app webåº”ç”¨ library æ ¸å¿ƒä»£ç  public å…¥å£ç›®å½• å‡ºäºç®€å•å®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬çš„å…¥å£å•ç‹¬æ”¾åœ¨publicç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸‹æ–°å»ºindex.phpä½œä¸ºæˆ‘ä»¬çš„å…¥å£æ–‡ä»¶ã€‚ libraryä¸‹é¢æ–°å»ºå‡ ä¸ªç›®å½•å’Œæ–‡ä»¶ Components å¸¸ç”¨ç»„ä»¶ Exceptions å¼‚å¸¸æ¨¡å— Https httpåº”ç”¨æ¨¡å— Sessions sessionæ¨¡å— Application.php åº”ç”¨æ–‡ä»¶ Config.php é…ç½®æ–‡ä»¶ Functions.php å¸¸ç”¨å‡½æ•° System.php æ¡†æ¶è‡ªå®šä¹‰å¸¸é‡ å¯¹åº”çš„æˆ‘ä»¬åœ¨composer.jsonä¸­åŠ å…¥ä¸€äº›autoloadé…ç½®ï¼Œç”¨ä»¥è‡ªåŠ¨åŠ è½½ï¼Œçœå»æˆ‘ä»¬å®ç°è‡ªåŠ¨åŠ è½½ã€‚ &quot;autoload&quot;: &#123; &quot;psr-4&quot;: &#123; &quot;Library\\\\&quot;: &quot;library/&quot;, &quot;App\\\\&quot;: &quot;app/&quot; &#125;, &quot;files&quot;: [ &quot;library/Functions.php&quot; ]&#125; æ‰§è¡Œä¸€ä¸‹ï¼Œcomposer installæˆ–è€…composer dump-autoloadå³å¯ã€‚ è¿™é‡Œç®€å•è¯´æ˜ä¸€ä¸‹autoloadçš„å››ç§æ–¹å¼ï¼š autoloadçš„å››ç§æ–¹å¼ PSR-4 åœ¨psr-4é”®ä¸‹ï¼Œå®šä¹‰äº†ç›¸å¯¹äºåŒ…æ ¹ç›®å½•ä»åç§°ç©ºé—´åˆ°è·¯å¾„çš„æ˜ å°„ã€‚å½“è‡ªåŠ¨åŠ è½½ä¸€ä¸ªç±»ï¼ˆå¦‚foo\\bar\\bazï¼‰æ—¶ï¼ŒæŒ‡å‘src/ç›®å½•çš„åç§°ç©ºé—´å‰ç¼€foo\\ï¼Œæ„å‘³ç€è‡ªåŠ¨åŠ è½½ç¨‹åºå°†æŸ¥æ‰¾ä¸€ä¸ªåä¸ºsrc/bar/baz.phpçš„æ–‡ä»¶ï¼Œå¹¶åŒ…æ‹¬å®ƒï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚æ³¨æ„ï¼Œä¸æ—§çš„psr-0æ ·å¼ç›¸åï¼Œå‰ç¼€ï¼ˆfoo\\ï¼‰ä¸åœ¨æ–‡ä»¶è·¯å¾„ä¸­ã€‚ å‘½åç©ºé—´å‰ç¼€å¿…é¡»ä»¥â€œ\\â€ç»“å°¾ï¼Œä»¥é¿å…ç±»ä¼¼å‰ç¼€ä¹‹é—´çš„å†²çªã€‚ä¾‹å¦‚ï¼Œfooå°†åŒ¹é…foobaråç§°ç©ºé—´ä¸­çš„ç±»ï¼Œå› æ­¤åé¢çš„åæ–œæ å¯ä»¥è§£å†³é—®é¢˜ï¼šfoo\\ï¼Œfoobar\\ã€‚ è¯¥æ•°ç»„å¯ä»¥åœ¨ç”Ÿæˆçš„æ–‡ä»¶vendor/composer/autoload_psr4.phpä¸­æ‰¾åˆ°ã€‚ PSR-0 åœ¨ psr-0 key ä¸‹ä½ å®šä¹‰äº†ä¸€ä¸ªå‘½åç©ºé—´åˆ°å®é™…è·¯å¾„çš„æ˜ å°„ï¼ˆç›¸å¯¹äºåŒ…çš„æ ¹ç›®å½•ï¼‰ã€‚æ³¨æ„ï¼Œè¿™é‡ŒåŒæ ·æ”¯æŒ PEAR-style æ–¹å¼çš„çº¦å®šï¼ˆä¸å‘½åç©ºé—´ä¸åŒï¼ŒPEAR ç±»åº“åœ¨ç±»åä¸Šé‡‡ç”¨äº†ä¸‹åˆ’çº¿åˆ†éš”ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œå‘½åç©ºé—´çš„ç”³æ˜åº”è¯¥ä»¥ \\ ç»“æŸï¼Œä»¥ç¡®ä¿ autoloader èƒ½å¤Ÿå‡†ç¡®å“åº”ã€‚ä¾‹ï¼š Foo å°†ä¼šä¸ FooBar åŒ¹é…ï¼Œç„¶è€Œä»¥åæ–œæ ç»“æŸå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œ Foo\\ å’Œ FooBar\\ å°†ä¼šè¢«åŒºåˆ†å¼€æ¥ã€‚ PSR-0 å¼•ç”¨éƒ½å°†è¢«ç»“åˆä¸ºä¸€ä¸ªå•ä¸€çš„é”®å€¼å¯¹æ•°ç»„ï¼Œå­˜å‚¨è‡³ vendor/composer/autoload_namespaces.php æ–‡ä»¶ä¸­ã€‚ classmap ä½ å¯ä»¥ç”¨ classmap ç”Ÿæˆæ”¯æŒæ”¯æŒè‡ªå®šä¹‰åŠ è½½çš„ä¸éµå¾ª PSR-0/4 è§„èŒƒçš„ç±»åº“ã€‚è¦é…ç½®å®ƒæŒ‡å‘éœ€è¦çš„ç›®å½•ï¼Œä»¥ä¾¿èƒ½å¤Ÿå‡†ç¡®æœç´¢åˆ°ç±»æ–‡ä»¶ã€‚ classmap å¼•ç”¨çš„æ‰€æœ‰ç»„åˆä¼šå­˜å‚¨åˆ° vendor/composer/autoload_classmap.php æ–‡ä»¶ä¸­ã€‚è¿™ä¸ª map æ˜¯ç»è¿‡æ‰«ææŒ‡å®šç›®å½•ï¼ˆåŒæ ·æ”¯æŒç›´æ¥ç²¾ç¡®åˆ°æ–‡ä»¶ï¼‰ä¸­æ‰€æœ‰çš„ .php å’Œ .inc æ–‡ä»¶é‡Œå†…ç½®çš„ç±»è€Œå¾—åˆ°çš„ã€‚ files å¦‚æœä½ æƒ³è¦æ˜ç¡®çš„æŒ‡å®šï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½è¦è½½å…¥æŸäº›æ–‡ä»¶ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ â€˜filesâ€™ autoloadingã€‚é€šå¸¸ä½œä¸ºå‡½æ•°åº“çš„è½½å…¥æ–¹å¼ï¼ˆè€Œéç±»åº“ï¼‰ã€‚files å¼•ç”¨çš„æ–‡ä»¶ä¼šå­˜å‚¨åˆ° vendor/composer/autoload_files.php æ–‡ä»¶ä¸­ ç‚¹å‡»æŸ¥çœ‹autoloadè¯´æ˜ä¸å®ä¾‹ æˆ‘ä»¬å…ˆä¸ç€æ€¥è¿›è¡Œæ ¸å¿ƒä»£ç ç¼–å†™ï¼Œä¸å¦¨å…ˆåšä¸€ä¸‹è¾…åŠ©å·¥ä½œï¼Œå¸¸ç”¨æ–¹æ³•ï¼Œå¼‚å¸¸å¤„ç†ç­‰ã€‚ å¸¸ç”¨å‡½æ•°Functionsç¼–å†™å¸¸ç”¨å‡½æ•° &lt;?php/** * å¸¸ç”¨å‡½æ•° */ if (!function_exists(&quot;p&quot;)) &#123; function p($var) &#123; if (is_bool($var)) &#123; var_dump($var); &#125; elseif (is_null($var)) &#123; var_dump(null); &#125; else &#123; die(&quot;&lt;meta charset=&#x27;utf-8&#x27;/&gt;&lt;pre style=&#x27;position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;&#x27;&gt;&quot;.print_r($var, true).&quot;&lt;/pre&gt;&quot;); &#125; &#125;&#125;Â·Â·Â·Â·Â·Â· å¼‚å¸¸å¤„ç†åœ¨Exceptionsç›®å½•ä¸‹ï¼Œå®šä¹‰ä¸€ä¸ªæœ€åŸºç¡€çš„å¼‚å¸¸SaiExceptionï¼š &lt;?phpnamespace Library\\Exceptions;class SaiException extends \\Exception&#123; const CODE_MAPPING = [ 100 =&gt; &#x27;Continue&#x27;, 101 =&gt; &#x27;Switching Protocols&#x27;, 102 =&gt; &#x27;Processing&#x27;, 200 =&gt; &#x27;OK&#x27;, 201 =&gt; &#x27;Created&#x27;, 202 =&gt; &#x27;Accepted&#x27;, 203 =&gt; &#x27;Non-Authoritative Information&#x27;, 204 =&gt; &#x27;No Content&#x27;, 205 =&gt; &#x27;Reset Content&#x27;, 206 =&gt; &#x27;Partial Content&#x27;, 207 =&gt; &#x27;Multi-Status&#x27;, 226 =&gt; &#x27;IM Used&#x27;, 300 =&gt; &#x27;Multiple Choices&#x27;, 301 =&gt; &#x27;Moved Permanently&#x27;, 302 =&gt; &#x27;Found&#x27;, 303 =&gt; &#x27;See Other&#x27;, 304 =&gt; &#x27;Not Modified&#x27;, 305 =&gt; &#x27;Use Proxy&#x27;, 306 =&gt; &#x27;Reserved&#x27;, 307 =&gt; &#x27;Temporary Redirect&#x27;, 400 =&gt; &#x27;Bad Request&#x27;, 401 =&gt; &#x27;Unauthorized&#x27;, 402 =&gt; &#x27;Payment Required&#x27;, 403 =&gt; &#x27;Forbidden&#x27;, 404 =&gt; &#x27;Not Found&#x27;, 405 =&gt; &#x27;Method Not Allowed&#x27;, 406 =&gt; &#x27;Not Acceptable&#x27;, 407 =&gt; &#x27;Proxy Authentication Required&#x27;, 408 =&gt; &#x27;Request Timeout&#x27;, 409 =&gt; &#x27;Conflict&#x27;, 410 =&gt; &#x27;Gone&#x27;, 411 =&gt; &#x27;Length Required&#x27;, 412 =&gt; &#x27;Precondition Failed&#x27;, 413 =&gt; &#x27;Request Entity Too Large&#x27;, 414 =&gt; &#x27;Request-URI Too Long&#x27;, 415 =&gt; &#x27;Unsupported Media Type&#x27;, 416 =&gt; &#x27;Requested Range Not Satisfiable&#x27;, 417 =&gt; &#x27;Expectation Failed&#x27;, 422 =&gt; &#x27;Unprocessable Entity&#x27;, 423 =&gt; &#x27;Locked&#x27;, 424 =&gt; &#x27;Failed Dependency&#x27;, 426 =&gt; &#x27;Upgrade Required&#x27;, 429 =&gt; &#x27;Too Many Request&#x27;, 500 =&gt; &#x27;Internal Server Error&#x27;, 501 =&gt; &#x27;Not Implemented&#x27;, 502 =&gt; &#x27;Bad Gateway&#x27;, 503 =&gt; &#x27;Service Unavailable&#x27;, 504 =&gt; &#x27;Gateway Timeout&#x27;, 505 =&gt; &#x27;HTTP Version Not Supported&#x27;, 506 =&gt; &#x27;Variant Also Negotiates&#x27;, 507 =&gt; &#x27;Insufficient Storage&#x27;, 510 =&gt; &#x27;Not Extended&#x27;, 1001 =&gt; &#x27;LACK PARAMS&#x27;, 1002 =&gt; &#x27;RETRY TOO MANY&#x27;, ]; /** * è¾“å‡ºæŒ‡å®šHTTPçŠ¶æ€ç çš„å“åº”å¤´ä¿¡æ¯ * @param int $code * @param $data * @return void */ public function response($code, $data)&#123; $code = array_key_exists($code, self::CODE_MAPPING)? $code : 500; $desc = self::CODE_MAPPING[$code]; $protocol = $_SERVER[&#x27;SERVER_PROTOCOL&#x27;]; if ( &#x27;HTTP/1.1&#x27; != $protocol &amp;&amp; &#x27;HTTP/1.0&#x27; != $protocol ) $protocol = &#x27;HTTP/1.0&#x27;; $header = &quot;$protocol $code $desc&quot;; header($header); p($data); &#125;&#125; å‡ ä¹åé¢æ‰€æœ‰Exceptionçš„ç±»éƒ½ä¼šç»§æ‰¿è¿™ä¸ªå¼‚å¸¸ç±»ã€‚ åœ¨Componentsç›®å½•ä¸‹æ–°å»ºåŸºç¡€çš„ç±»Baseï¼š &lt;?phpnamespace Library\\Components;class Base implements \\ArrayAccess&#123; private $_container; public function __get($name) &#123; if (method_exists($this, $method = &#x27;get&#x27;.ucfirst($name))) &#123; return $this-&gt;$method($name); &#125; return null; &#125; public function __set($name, $value) &#123; if (method_exists($this, $method = &#x27;set&#x27;.ucfirst($name))) &#123; return $this-&gt;$method($name, $value); &#125; &#125; public function offsetSet($offset, $value) &#123; if (is_null($offset)) &#123; $this-&gt;_container[] = $value; &#125; else &#123; $this-&gt;_container[$offset] = $value; &#125; &#125; public function offsetExists($offset) &#123; return isset($this-&gt;_container[$offset]); &#125; public function offsetUnset($offset) &#123; unset($this-&gt;_container[$offset]); &#125; public function offsetGet($offset) &#123; return isset($this-&gt;_container[$offset]) ? $this-&gt;_container[$offset] : null; &#125;&#125; è¿™é‡Œæœ‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š ArrayAccessæ•°ç»„å¼è®¿é—®æ¥å£ï¼ˆæä¾›åƒè®¿é—®æ•°ç»„ä¸€æ ·è®¿é—®å¯¹è±¡çš„èƒ½åŠ›çš„æ¥å£ã€‚ï¼‰ é­”æœ¯æ–¹æ³•__setå’Œ__getï¼ˆåœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶__set() ä¼šè¢«è°ƒç”¨;è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶__get() ä¼šè¢«è°ƒç”¨ã€‚ï¼‰ å¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œå¯çœ‹å®˜æ–¹æ–‡æ¡£ï¼š ArrayAccessæ¥å£ é­”æœ¯æ–¹æ³•","tags":["phpframe"],"categories":["phpframe"]},{"title":"åŸºç¡€ç¯‡ï¼š3.åå°„","path":"/2020/02/01/phpframe03/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ åå°„ï¼Œç›´è§‚ç†è§£å°±æ˜¯æ ¹æ®åˆ°è¾¾åœ°æ‰¾åˆ°å‡ºå‘åœ°å’Œæ¥æºã€‚ åå°„æŒ‡åœ¨PHPè¿è¡ŒçŠ¶æ€ä¸­ï¼Œæ‰©å±•åˆ†æPHPç¨‹åºï¼Œå¯¼å‡ºæˆ–æå‡ºå…³äºç±»ã€æ–¹æ³•ã€å±æ€§ã€å‚æ•°ç­‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨é‡Šã€‚è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºåå°„APIã€‚ ä¸å¦¨å…ˆæ¥çœ‹ä¸€ä¸ªdemoï¼š &lt;?php/** * Author: sai * Date: 2019/10/21 * Time: 10:59 */function p($msg, $var)&#123; echo(&quot;&lt;pre style=&#x27;position:relative;z-index:999;padding:10px;border-radius:5px;background:#f5f5f5;border:1px solid #aaa;font-size:14px;line-height:18px;opacity:0.8;&#x27;&gt;&quot;.$msg.&quot;:&quot;.print_r($var, true).&quot;&lt;/pre&gt;&quot;);&#125;class Demo&#123; private $id; protected $name; public $skills = []; public function __construct($id, $name, $skills = []) &#123; $this-&gt;id = $id; $this-&gt;name = $name; $this-&gt;skills = $skills; &#125; public function getName() &#123; return $this-&gt;name; &#125; public function getSkill() &#123; p(&#x27;skill&#x27;, $this-&gt;skills); &#125;&#125;$ref = new ReflectionClass(&#x27;Demo&#x27;);if ($ref-&gt;isInstantiable()) &#123; p(&#x27;æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ–isInstantiable&#x27;, null );&#125;$constructor = $ref-&gt;getConstructor();p(&#x27;è·å–æ„é€ å‡½æ•°getConstructor&#x27;, $constructor);$parameters = $constructor-&gt;getParameters();foreach ($parameters as $param) &#123; p(&#x27;è·å–å‚æ•°getParameters&#x27;, $param);&#125;if ($ref-&gt;hasProperty(&#x27;name&#x27;)) &#123; $attr = $ref-&gt;getProperty(&#x27;name&#x27;); p(&#x27;è·å–å±æ€§getProperty&#x27;, $attr);&#125;$attributes = $ref-&gt;getProperties();foreach ($attributes as $row) &#123; p(&#x27;è·å–å±æ€§åˆ—è¡¨getProperties&#x27;, $row-&gt;getName() );&#125;if ($ref-&gt;hasMethod(&#x27;getSkill&#x27;)) &#123; $method = $ref-&gt;getMethod(&#x27;getSkill&#x27;); p(&#x27;è·å–æ–¹æ³•getMethod&#x27;, $method);&#125;$methods = $ref-&gt;getMethods();foreach ($methods as $row) &#123; p(&#x27;è·å–æ–¹æ³•åˆ—è¡¨getMethods&#x27;, $row-&gt;getName());&#125;$instance = $ref-&gt;newInstanceArgs([1, &#x27;sai&#x27;, [&#x27;php&#x27;, &#x27;js&#x27;]]);p(&#x27;newInstanceArgs&#x27;, $instance); è¾“å‡ºï¼š æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ–isInstantiable: è·å–æ„é€ å‡½æ•°getConstructor:ReflectionMethod Object ( [name] => __construct [class] => Demo ) è·å–å‚æ•°getParameters:ReflectionParameter Object( [name] => id)è·å–å‚æ•°getParameters:ReflectionParameter Object( [name] => name)è·å–å‚æ•°getParameters:ReflectionParameter Object( [name] => skills)è·å–å±æ€§getProperty:ReflectionProperty Object( [name] => name [class] => Demo)è·å–å±æ€§åˆ—è¡¨getProperties:idè·å–å±æ€§åˆ—è¡¨getProperties:nameè·å–å±æ€§åˆ—è¡¨getProperties:skillsè·å–æ–¹æ³•getMethod:ReflectionMethod Object( [name] => getSkill [class] => Demo)è·å–æ–¹æ³•åˆ—è¡¨getMethods:__constructè·å–æ–¹æ³•åˆ—è¡¨getMethods:getNameè·å–æ–¹æ³•åˆ—è¡¨getMethods:getSkillnewInstanceArgs:Demo Object( [id:Demo:private] => 1 [name:protected] => sai [skills] => Array ( [0] => php [1] => js ) ) demoé‡Œé¢å°±æœ‰ä½¿ç”¨äº†ReflectionClassç±»ï¼Œå½“ç„¶ReflectionClassç±»ä¸æ­¢äºè¿™äº›æ–¹æ³•ã€‚ æ›´å¤šæ–¹æ³•ReflectionClassç±»è¿˜æœ‰æ›´å¤šæ–¹æ³•ï¼š æ–¹æ³• è¯´æ˜ ReflectionClass::__construct åˆå§‹åŒ– ReflectionClass ç±» ReflectionClass::export å¯¼å‡ºä¸€ä¸ªç±» ReflectionClass::getConstant è·å–å®šä¹‰è¿‡çš„ä¸€ä¸ªå¸¸é‡ ReflectionClass::getConstants è·å–ä¸€ç»„å¸¸é‡ ReflectionClass::getConstructor è·å–ç±»çš„æ„é€ å‡½æ•° ReflectionClass::getDefaultProperties è·å–é»˜è®¤å±æ€§ ReflectionClass::getDocComment è·å–æ–‡æ¡£æ³¨é‡Š ReflectionClass::getEndLine è·å–æœ€åä¸€è¡Œçš„è¡Œæ•° ReflectionClass::getExtension æ ¹æ®å·²å®šä¹‰çš„ç±»è·å–æ‰€åœ¨æ‰©å±•çš„ ReflectionExtension å¯¹è±¡ ReflectionClass::getExtensionName è·å–å®šä¹‰çš„ç±»æ‰€åœ¨çš„æ‰©å±•çš„åç§° ReflectionClass::getFileName è·å–å®šä¹‰ç±»çš„æ–‡ä»¶å ReflectionClass::getInterfaceNames è·å–æ¥å£ï¼ˆinterfaceï¼‰åç§° ReflectionClass::getInterfaces è·å–æ¥å£ ReflectionClass::getMethod è·å–ä¸€ä¸ªç±»æ–¹æ³•çš„ ReflectionMethodã€‚ ReflectionClass::getMethods è·å–æ–¹æ³•çš„æ•°ç»„ ReflectionClass::getModifiers è·å–ç±»çš„ä¿®é¥°ç¬¦ ReflectionClass::getName è·å–ç±»å ReflectionClass::getNamespaceName è·å–å‘½åç©ºé—´çš„åç§° ReflectionClass::getParentClass è·å–çˆ¶ç±» ReflectionClass::getProperties è·å–ä¸€ç»„å±æ€§ ReflectionClass::getProperty è·å–ç±»çš„ä¸€ä¸ªå±æ€§çš„ ReflectionProperty ReflectionClass::getReflectionConstant Gets a ReflectionClassConstant for a classâ€™s constant ReflectionClass::getReflectionConstants Gets class constants ReflectionClass::getShortName è·å–çŸ­å ReflectionClass::getStartLine è·å–èµ·å§‹è¡Œå· ReflectionClass::getStaticProperties è·å–é™æ€ï¼ˆstaticï¼‰å±æ€§ ReflectionClass::getStaticPropertyValue è·å–é™æ€ï¼ˆstaticï¼‰å±æ€§çš„å€¼ ReflectionClass::getTraitAliases è¿”å› trait åˆ«åçš„ä¸€ä¸ªæ•°ç»„ ReflectionClass::getTraitNames è¿”å›è¿™ä¸ªç±»æ‰€ä½¿ç”¨ traits çš„åç§°çš„æ•°ç»„ ReflectionClass::getTraits è¿”å›è¿™ä¸ªç±»æ‰€ä½¿ç”¨çš„ traits æ•°ç»„ ReflectionClass::hasConstant æ£€æŸ¥å¸¸é‡æ˜¯å¦å·²ç»å®šä¹‰ ReflectionClass::hasMethod æ£€æŸ¥æ–¹æ³•æ˜¯å¦å·²å®šä¹‰ ReflectionClass::hasProperty æ£€æŸ¥å±æ€§æ˜¯å¦å·²å®šä¹‰ ReflectionClass::implementsInterface æ¥å£çš„å®ç° ReflectionClass::inNamespace æ£€æŸ¥æ˜¯å¦ä½äºå‘½åç©ºé—´ä¸­ ReflectionClass::isAbstract æ£€æŸ¥ç±»æ˜¯å¦æ˜¯æŠ½è±¡ç±»ï¼ˆabstractï¼‰ ReflectionClass::isAnonymous æ£€æŸ¥ç±»æ˜¯å¦æ˜¯åŒ¿åç±» ReflectionClass::isCloneable è¿”å›äº†ä¸€ä¸ªç±»æ˜¯å¦å¯å¤åˆ¶ ReflectionClass::isFinal æ£€æŸ¥ç±»æ˜¯å¦å£°æ˜ä¸º final ReflectionClass::isInstance æ£€æŸ¥ç±»çš„å®ä¾‹ ReflectionClass::isInstantiable æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ– ReflectionClass::isInterface æ£€æŸ¥ç±»æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆinterfaceï¼‰ ReflectionClass::isInternal æ£€æŸ¥ç±»æ˜¯å¦ç”±æ‰©å±•æˆ–æ ¸å¿ƒåœ¨å†…éƒ¨å®šä¹‰ ReflectionClass::isIterable Check whether this class is iterable ReflectionClass::isIterateable æ£€æŸ¥æ˜¯å¦å¯è¿­ä»£ï¼ˆiterateableï¼‰ ReflectionClass::isSubclassOf æ£€æŸ¥æ˜¯å¦ä¸ºä¸€ä¸ªå­ç±» ReflectionClass::isTrait è¿”å›äº†æ˜¯å¦ä¸ºä¸€ä¸ª trait ReflectionClass::isUserDefined æ£€æŸ¥æ˜¯å¦ç”±ç”¨æˆ·å®šä¹‰çš„ ReflectionClass::newInstance ä»æŒ‡å®šçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹ ReflectionClass::newInstanceArgs ä»ç»™å‡ºçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹ã€‚ ReflectionClass::newInstanceWithoutConstructor åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹è€Œä¸è°ƒç”¨å®ƒçš„æ„é€ å‡½æ•° ReflectionClass::setStaticPropertyValue è®¾ç½®é™æ€å±æ€§çš„å€¼ ReflectionClass::__toString è¿”å› ReflectionClass å¯¹è±¡å­—ç¬¦ä¸²çš„è¡¨ç¤ºå½¢å¼ã€‚ é™¤å»å¼ºå¤§çš„ReflectionClassï¼Œè¿˜æœ‰Reflectionã€ReflectionClassConstant ã€ReflectionMethod ã€ReflectionFunctionAbstractç­‰ç­‰ã€‚å»ºè®®æŸ¥çœ‹æ‰‹å†Œï¼š PHPåå°„ åå°„çš„å®é™…åº”ç”¨ åå°„å¯ä»¥ç”¨äºæ–‡æ¡£ã€æ–‡ä»¶ç”Ÿæˆã€‚å¯ä»¥ç”¨å®ƒå¯¹æ–‡ä»¶é‡Œçš„ç±»è¿›è¡Œæ‰«æï¼Œé€ä¸ªç”Ÿæˆæè¿°æ–‡æ¡£; æ—¢ç„¶åå°„å¯ä»¥æ¢çŸ¥ç±»çš„å†…éƒ¨ç»“æ„ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å®ƒåšhookå®ç°æ’ä»¶åŠŸèƒ½ï¼› å¯ä»¥ç”¨äºåšåŠ¨æ€ä»£ç†ï¼Œåœ¨æœªçŸ¥æˆ–è€…ä¸ç¡®å®šç±»åçš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€ç”Ÿæˆå’Œå®ä¾‹åŒ–ä¸€äº›ç±»å’Œæ‰§è¡Œæ–¹æ³•ï¼› ä¾èµ–æ³¨å…¥ã€‚å¯¹äºå¤šæ¬¡ç»§æ‰¿çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šæ¬¡åå°„æ¢ç´¢åˆ°åŸºç±»çš„ç»“æ„ï¼Œæˆ–è€…é‡‡ç”¨é€’å½’çš„å½¢å¼åå°„ï¼Œå®ç°å®ä¾‹åŒ–æ‰€æœ‰ç»§æ‰¿ç±»ï¼Œè¿™ä¹Ÿæ˜¯PHPä¾èµ–æ³¨å…¥çš„åŸç†ã€‚ åå°„çš„ä¼˜ç‚¹ æ”¯æŒåå°„çš„è¯­è¨€æä¾›äº†ä¸€äº›åœ¨ä½çº§è¯­è¨€ä¸­éš¾ä»¥å®ç°çš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚ å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…ç¡¬ç¼–ç ï¼Œæä¾›çµæ´»æ€§å’Œé€šç”¨æ€§ã€‚ å¯ä»¥ä½œä¸ºä¸€ä¸ªç¬¬ä¸€ç±»å¯¹è±¡å‘ç°å¹¶ä¿®æ”¹æºä»£ç çš„ç»“æ„ï¼ˆå¦‚ä»£ç å—ã€ç±»ã€æ–¹æ³•ã€åè®®ç­‰ï¼‰ã€‚ å¯ä»¥åœ¨è¿è¡Œæ—¶åƒå¯¹å¾…æºä»£ç è¯­å¥ä¸€æ ·è®¡ç®—ç¬¦å·è¯­æ³•çš„å­—ç¬¦ä¸²ï¼ˆç±»ä¼¼JavaScriptçš„eval()å‡½æ•°ï¼‰ï¼Œè¿›è€Œå¯å°†è·Ÿclassæˆ–functionåŒ¹é…çš„å­—ç¬¦ä¸²è½¬æ¢æˆclassæˆ–functionçš„è°ƒç”¨æˆ–å¼•ç”¨ã€‚ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¯­è¨€å­—èŠ‚ç è§£é‡Šå™¨æ¥ç»™ç¼–ç¨‹ç»“æ„ä¸€ä¸ªæ–°çš„æ„ä¹‰æˆ–ç”¨é€”ã€‚ åå°„çš„ç¼ºç‚¹ å­¦ä¹ æˆæœ¬é«˜ã€‚é¢å‘åå°„çš„ç¼–ç¨‹éœ€è¦è¾ƒå¤šçš„é«˜çº§çŸ¥è¯†ï¼ŒåŒ…æ‹¬æ¡†æ¶ã€å…³ç³»æ˜ å°„å’Œå¯¹è±¡äº¤äº’ï¼Œä»¥åˆ©ç”¨æ›´é€šç”¨çš„ä»£ç æ‰§è¡Œ åŒæ ·å› ä¸ºåå°„çš„æ¦‚å¿µå’Œè¯­æ³•éƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œè¿‡å¤šåœ°æ»¥ç”¨åå°„æŠ€æœ¯ä¼šä½¿å¾—ä»£ç éš¾ä»¥è¢«å…¶ä»–äººè¯»æ‡‚ï¼Œä¸åˆ©äºåˆä½œä¸äº¤æµ åå°„åœ¨æé«˜äº†ä»£ç çµæ´»æ€§çš„åŒæ—¶ï¼Œç‰ºç‰²äº†ä¸€ç‚¹ç‚¹è¿è¡Œæ•ˆç‡ï¼Œæœ‰ä¸€å®šçš„æ¶ˆè€— åå°„ä¹Ÿä¼šç ´åç±»çš„å°è£…æ€§ï¼ŒæŠŠæœ¬ä¸è¯¥æš´éœ²çš„æ–¹æ³•æˆ–å±æ€§æš´éœ²äº†å‡ºæ¥ åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°åå°„å…¶å®ä¸å¤šï¼Œä¸ºä»€ä¹ˆæŠŠå®ƒæ‹¿åˆ°è¿™é‡Œæ¥è¯´å‘¢ï¼Ÿä¸€æ¥æ˜¯æˆ‘ä»¬åé¢ä¼šä½¿ç”¨åˆ°åå°„å»å®ç°Iocå®¹å™¨ï¼ŒäºŒæ¥åå°„ä¹Ÿæ˜¯PHPæ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œåœ¨æˆ‘ä»¬æµè¡Œçš„æ¡†æ¶ä¸­ååˆ†å¸¸è§ï¼Œç†è§£å®ƒæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"åŸºç¡€ç¯‡ï¼š2.composer","path":"/2020/02/01/phpframe02/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ ä¸Šä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†æˆ‘ä»¬éœ€è¦éµå¾ªçš„è§„èŒƒï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°çš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·â€”â€”Composerã€‚ Composer æ˜¯ PHP çš„ä¸€ä¸ªä¾èµ–ç®¡ç†å·¥å…·ã€‚å®ƒå…è®¸ä½ ç”³æ˜é¡¹ç›®æ‰€ä¾èµ–çš„ä»£ç åº“ï¼Œå®ƒä¼šåœ¨ä½ çš„é¡¹ç›®ä¸­ä¸ºä½ å®‰è£…ä»–ä»¬ã€‚ å¦‚æœä½ æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä½ åº”è¯¥ç”¨è¿‡npmï¼›å¦‚æœä½ æ˜¯pyhtonå¼€å‘è€…ï¼Œä½ åº”è¯¥ç”¨è¿‡pipï¼Œç®€å•è¯´ä½ å¯ä»¥è¿™æ ·ç†è§£composerã€‚ composeråœ¨å°å†Œä¸­å¯èƒ½ç»å¸¸ä¼šè¢«æåŠï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹å®‰è£…å’Œå¸¸ç”¨å‘½ä»¤ã€‚ å®‰è£… Linux composerçš„å®‰è£…æ¯”è¾ƒç®€å•ï¼Œä¸å»ºè®®ä½¿ç”¨yumç­‰ç®¡ç†åŒ…ç›´æ¥installï¼Œå› ä¸ºæœ‰å¯èƒ½ä¼šä¿®æ”¹ä½ çš„é»˜è®¤phpç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥è·³è¿‡ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼š curl -sS https://getcomposer.org/installer | php mv composer.phar /usr/local/bin/composer Windows ä¸‹è½½å¹¶ä¸”è¿è¡Œ Composer-Setup.exeï¼Œå®ƒå°†å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Composer ï¼Œå»ºè®®åŠ å…¥ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹ç›´æ¥ä½¿ç”¨ composer å‘½ä»¤ã€‚ ä¿®æ”¹é•œåƒæºé»˜è®¤é•œåƒæºå›½å†…ä¸‹è½½æ¯”è¾ƒæ…¢ï¼Œå»ºè®®æ›´æ¢é•œåƒæº composer config -g repo.packagist composer https://packagist.phpcomposer.com ä¹Ÿå¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„é•œåƒæº(æ¨è) composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/ config -g/â€“global è¡¨ç¤ºå…¨å±€é…ç½® composerå¸¸ç”¨å‘½ä»¤initåˆå§‹åŒ–å‚æ•°ï¼š--name: åŒ…çš„åç§°ã€‚--description: åŒ…çš„æè¿°ã€‚--author: åŒ…çš„ä½œè€…ã€‚--homepage: åŒ…çš„ä¸»é¡µã€‚--require: éœ€è¦ä¾èµ–çš„å…¶å®ƒåŒ…ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªç‰ˆæœ¬çº¦æŸã€‚å¹¶ä¸”åº”è¯¥éµå¾ª foo/bar:1.0.0 è¿™æ ·çš„æ ¼å¼ã€‚--require-dev: å¼€å‘ç‰ˆçš„ä¾èµ–åŒ…ï¼Œå†…å®¹æ ¼å¼ä¸ --require ç›¸åŒã€‚--stability (-s): minimum-stability å­—æ®µçš„å€¼ã€‚ requireå¢åŠ require å‘½ä»¤å¢åŠ æ–°çš„ä¾èµ–åŒ…åˆ°å½“å‰ç›®å½•çš„ composer.json æ–‡ä»¶ä¸­ï¼Œå¹¶å¯ä»¥æŒ‡å®šç‰ˆæœ¬ã€‚ composer require vendor/package:2.* vendor/package2:dev-master installå®‰è£…install å‘½ä»¤ä»å½“å‰ç›®å½•è¯»å– composer.json æ–‡ä»¶ï¼Œå¤„ç†äº†ä¾èµ–å…³ç³»ï¼Œå¹¶æŠŠå…¶å®‰è£…åˆ° vendor ç›®å½•ä¸‹ã€‚ å¦‚æœå½“å‰ç›®å½•ä¸‹å­˜åœ¨ composer.lock æ–‡ä»¶ï¼Œå®ƒä¼šä»æ­¤æ–‡ä»¶è¯»å–ä¾èµ–ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æ ¹æ® composer.json æ–‡ä»¶å»è·å–ä¾èµ–ã€‚è¿™ç¡®ä¿äº†è¯¥åº“çš„æ¯ä¸ªä½¿ç”¨è€…éƒ½èƒ½å¾—åˆ°ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ã€‚ å¦‚æœæ²¡æœ‰ composer.lock æ–‡ä»¶ï¼Œcomposer å°†åœ¨å¤„ç†å®Œä¾èµ–å…³ç³»ååˆ›å»ºå®ƒã€‚ ä½ å¯ä»¥ç®€å•æŠŠcomposer.lockç†è§£ä¸ºæ‰©å±•åº“çš„ç¼“å­˜ã€‚ updateæ›´æ–°ä¸ºäº†è·å–ä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ›´æ–° composer.lock æ–‡ä»¶ï¼Œä½ åº”è¯¥ä½¿ç”¨ update å‘½ä»¤ã€‚ composer update è¿™å°†è§£å†³é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–ï¼Œå¹¶å°†ç¡®åˆ‡çš„ç‰ˆæœ¬å·å†™å…¥ composer.lockã€‚ å¦‚æœä½ åªæ˜¯æƒ³æ›´æ–°å‡ ä¸ªåŒ…ï¼Œä½ å¯ä»¥åƒè¿™æ ·åˆ†åˆ«åˆ—å‡ºå®ƒä»¬ï¼š composer update vendor/package vendor/package2 ==æ³¨æ„==ï¼šupdateå‘½ä»¤ä¼šæ›´æ–°composer.jsoné‡Œé™å®šç‰ˆæœ¬çš„æœ€æ–°ä¾èµ–ã€‚æ¯”å¦‚ä½ å†™çš„æ˜¯â€monolog/monologâ€: â€œ1.*â€,updateå‘½ä»¤å¯èƒ½ä¼šæŠŠ1.0æ›´æ–°ä¸º1.2ç‰ˆæœ¬ï¼Œä½†ä¸ä¼šå°†1.0æ›´æ–°ä¸º2.0ã€‚æ‰€ä»¥ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ã€‚ searchsearch å‘½ä»¤å…è®¸ä½ ä¸ºå½“å‰é¡¹ç›®æœç´¢ä¾èµ–åŒ…ï¼Œé€šå¸¸å®ƒåªæœç´¢ packagist.org ä¸Šçš„åŒ…ï¼Œä½ å¯ä»¥ç®€å•çš„è¾“å…¥ä½ çš„æœç´¢æ¡ä»¶ã€‚ showåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„è½¯ä»¶åŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨ show å‘½ä»¤ã€‚ ä¹Ÿå¯ä»¥ç‚¹å‡»æŸ¥çœ‹æ›´å¤šcomposeråŒ… dump-autoloadæ‰“å°è‡ªåŠ¨åŠ è½½ç´¢å¼•ï¼ŒæŸäº›æƒ…å†µä¸‹ä½ éœ€è¦æ›´æ–° autoloaderï¼Œä¾‹å¦‚åœ¨ä½ çš„åŒ…ä¸­åŠ å…¥äº†ä¸€ä¸ªæ–°çš„ç±»ã€‚ä½ å¯ä»¥ä½¿ç”¨ dump-autoload æ¥å®Œæˆï¼Œè€Œä¸å¿…æ‰§è¡Œ install æˆ– update å‘½ä»¤ã€‚ æ­¤å¤–ï¼Œå®ƒå¯ä»¥æ‰“å°ä¸€ä¸ªä¼˜åŒ–è¿‡çš„ï¼Œç¬¦åˆ PSR-0/4 è§„èŒƒçš„ç±»çš„ç´¢å¼•ï¼Œè¿™ä¹Ÿæ˜¯å‡ºäºå¯¹æ€§èƒ½çš„å¯è€ƒè™‘ã€‚åœ¨å¤§å‹çš„åº”ç”¨ä¸­ä¼šæœ‰è®¸å¤šç±»æ–‡ä»¶ï¼Œè€Œ autoloader ä¼šå ç”¨æ¯ä¸ªè¯·æ±‚çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´ï¼Œä½¿ç”¨ classmaps æˆ–è®¸åœ¨å¼€å‘æ—¶ä¸å¤ªæ–¹ä¾¿ï¼Œä½†å®ƒåœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹ï¼Œä»ç„¶å¯ä»¥è·å¾— PSR-0/4 è§„èŒƒå¸¦æ¥çš„ä¾¿åˆ©ã€‚ æ›´composerå¤šå‘½ä»¤è¯·ç‚¹å‡»æŸ¥çœ‹ å¥½äº†ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬ä»‹ç»äº†composerçš„å®‰è£…å’Œå¸¸ç”¨å‘½ä»¤ã€‚æˆ‘ä»¬åé¢å¯ä»¥å°†æ¡†æ¶é›†æˆåˆ°ä¸€ä¸ªcomposeråŒ…ï¼Œåˆ†äº«ç»™å…¶ä»–å¼€å‘åŒå­¦ä½¿ç”¨ã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"åŸºç¡€ç¯‡ï¼š1.PSR","path":"/2020/02/01/phpframe01/","content":"PHP DIYç³»åˆ—â€“ä¸€èµ·æ‰‹å†™ä¸€ä¸ªapiæ¡†æ¶ åˆ›ä½œåˆè¡· æœ‰æ²¡æœ‰ç”¨çƒ¦äº†CURDï¼Ÿ å„ç§æ¡†æ¶æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤´å¤§ï¼Ÿ æœ‰æ²¡æœ‰å°è¯•è‡ªå·±è®¾è®¡ä¸€ä¸ªæ¡†æ¶ï¼Ÿ å­¦äº†PHPè¯­æ³•ï¼Œæ²¡æœ‰é¡¹ç›®å»å®æˆ˜ï¼Œå¤¯å®åŸºç¡€ å¸Œæœ›èƒ½å¸®åŠ©èƒ½è®©ä½ å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªè‡ªå·±çš„æ¡†æ¶ï¼Œèƒ½ç»™ä½ çš„å·¥ä½œæˆ–è€…å­¦ä¹ ä¸­å¸¦æ¥ä¸€å®šçš„å¸®åŠ©ä¸å¯å‘ã€‚ ä½ èƒ½å­¦åˆ°ä»€ä¹ˆ PSRè§„èŒƒ composerçš„ä½¿ç”¨ å¿«é€Ÿæ­å»ºä¸€ä¸ªAPIæ¥å£æ¡†æ¶ Rediså„ç§æ•°æ®ç±»å‹çš„åº”ç”¨ ç¼“å­˜åº”ç”¨åˆ†æ åœ¨å¼€å‘æ¡†æ¶ä¹‹å‰ï¼Œæˆ‘æ¥ä»‹ç»æ¡†æ¶å¼€å‘éµå¾ªçš„è§„èŒƒã€‚ å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—ç¼–ç è§„èŒƒï¼Œä½œä¸ºâ€œä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€â€ï¼ŒPHPå½“ç„¶ä¹Ÿæœ‰è‡ªå·±çš„ç¼–ç è§„èŒƒã€‚è¿™ä¸ªè§„èŒƒå°±æ˜¯PHP Standard Recommendationï¼ˆç®€ç§°PSRï¼‰ã€‚ å½“ç„¶ï¼Œä»æˆ‘è‡ªå·±çš„å·¥ä½œä¸­ï¼Œæˆ‘å‘ç°å¾ˆå¤šPHPç¨‹åºå‘˜å°¤å…¶æ˜¯åˆçº§ç¨‹åºå‘˜ï¼Œæ˜¯ä¸çŸ¥é“PHPæ˜¯æœ‰è¿™ä¹ˆä¸€ä¸ªè§„èŒƒçš„ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ç§‘å­¦çš„ã€‚ ä»€ä¹ˆæ˜¯PSRï¼Ÿä»‹ç»PSRä¹‹å‰éœ€è¦ä»‹ç»ä¸€ä¸‹åˆ¶å®šæ­¤è§„èŒƒçš„ç»„ç»‡â€”â€“PHP-FIGï¼Œå…¨ç§°æ˜¯PHP Framework Interoperabilityã€‚ ç»„ç»‡æˆå‘˜åˆ¶å®šè§„èŒƒï¼Œå¹¶ä¸”è½å®åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œè™½ç„¶ä¸æ˜¯å®˜æ–¹ç»„ç»‡ï¼Œä½†ä¹Ÿä»£è¡¨äº†å¤§éƒ¨åˆ†PHPç¤¾åŒºé¡¹ç›®ï¼Œå¦‚CakePHPï¼ŒComposerï¼ŒDrupalï¼ŒPEARï¼ŒSlimï¼ŒYii frameworkï¼ŒZend Frameworkç­‰ã€‚å¹¶ä¸”æœ‰è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®åŠ å…¥å¹¶éµå¾ªæ­¤æ ‡å‡†ã€‚ PSRé¡¹ç›®çš„ç›®çš„åœ¨äºï¼šé€šè¿‡æ¡†æ¶ä½œè€…æˆ–è€…æ¡†æ¶çš„ä»£è¡¨ä¹‹é—´è®¨è®ºï¼Œä»¥æœ€ä½ç¨‹åº¦çš„é™åˆ¶ï¼Œåˆ¶å®šä¸€ä¸ªåä½œæ ‡å‡†ï¼Œå„ä¸ªæ¡†æ¶éµå¾ªç»Ÿä¸€çš„ç¼–ç è§„èŒƒï¼Œè®©å·¥ç¨‹å¸ˆä¸€èµ·æ›´å¥½ååŒå·¥ä½œã€‚ æˆªæ­¢ç›®å‰ï¼Œå·²ç»å®˜ç½‘å·²æœ‰20æ¡åˆ—å‡ºï¼Œé™¤å»èµ·è‰ä¸­å’Œèˆå¼ƒçš„ï¼Œæœ‰ä»¥ä¸‹13æ¡ã€‚ æˆ‘ä»¬ä¸å¦¨æ¥çœ‹çœ‹è¿™äº›è§„èŒƒï¼š PSR-1 åŸºç¡€ç¼–ç è§„èŒƒ PHP ä»£ç æ–‡ä»¶å¿…é¡»ä»¥ &lt;?php æˆ– &lt;?= æ ‡ç­¾å¼€å§‹ PHP ä»£ç æ–‡ä»¶å¿…é¡»ä»¥ä¸å¸¦BOMçš„UTF-8ç¼–ç  PHP ä»£ç ä¸­ åº”è¯¥ åªå®šä¹‰ç±»ã€å‡½æ•°ã€å¸¸é‡ç­‰å£°æ˜ï¼Œæˆ–å…¶ä»–ä¼šäº§ç”Ÿ å‰¯ä½œç”¨ çš„æ“ä½œï¼ˆå¦‚ï¼šç”Ÿæˆæ–‡ä»¶è¾“å‡ºä»¥åŠä¿®æ”¹ .ini é…ç½®æ–‡ä»¶ç­‰ï¼‰ï¼ŒäºŒè€…åªèƒ½é€‰å…¶ä¸€ å‘½åç©ºé—´ä»¥åŠç±»å¿…é¡»ç¬¦åˆ PSR çš„è‡ªåŠ¨åŠ è½½è§„èŒƒPSR-4 ç±»çš„å‘½åå¿…é¡»éµå¾ª StudlyCaps å¼å¤§å†™å¼€å¤´çš„é©¼å³°å‘½åè§„èŒƒ ç±»ä¸­çš„å¸¸é‡æ‰€æœ‰å­—æ¯éƒ½å¿…é¡» å¤§å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš” æ–¹æ³•åç§°å¿…é¡»ç¬¦åˆ camelCase å¼çš„å°å†™å¼€å¤´é©¼å³°å‘½åè§„èŒƒ PSR-12 ä»£ç é£æ ¼è§„èŒƒPSR-12çš„è§„èŒƒå¾ˆç»†è‡´ï¼ŒåŒ…å«äº†å£°æ˜ã€å‘½åç©ºé—´ã€ç±»åŠç»§æ‰¿ä»¥åŠæ§åˆ¶ç»“æ„ç­‰è¯´æ˜ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªdemoï¼š &lt;?phpdeclare(strict_types=1);namespace Vendor\\Package;use Vendor\\Package\\&#123;ClassA as A, ClassB, ClassC as C&#125;;use Vendor\\Package\\SomeNamespace\\ClassD as D;use function Vendor\\Package\\&#123;functionA, functionB, functionC&#125;;use const Vendor\\Package\\&#123;ConstantA, ConstantB, ConstantC&#125;;class Foo extends Bar implements FooInterface&#123; public function sampleFunction(int $a, int $b = null): array &#123; if ($a === $b) &#123; bar(); &#125; elseif ($a &gt; $b) &#123; $foo-&gt;bar($arg1); &#125; else &#123; BazClass::bar($arg2, $arg3); &#125; &#125; final public static function bar() &#123; // method body &#125;&#125; ä»£ç  å¿…é¡» éµå¾ª [PSR-1] ä¸­çš„ç¼–ç è§„èŒƒ æ‰€æœ‰PHPæ–‡ä»¶å¿…é¡»ä½¿ç”¨Unix LF (linefeed)ä½œä¸ºè¡Œçš„ç»“æŸç¬¦ï¼› æ‰€æœ‰PHPæ–‡ä»¶å¿…é¡»ä»¥ä¸€ä¸ªç©ºç™½è¡Œä½œä¸ºç»“æŸï¼› çº¯PHPä»£ç æ–‡ä»¶å¿…é¡»çœç•¥æœ€åçš„ ?&gt; ç»“æŸæ ‡ç­¾ æ¯è¡Œçš„å­—ç¬¦æ•° åº”è¯¥è½¯æ€§ä¿æŒåœ¨ 80 ä¸ªä¹‹å†…ï¼Œç†è®ºä¸Š ä¸€å®šä¸å¯ å¤šäº 120 ä¸ªï¼Œä½†ä¸€å®šä¸å¯æœ‰ç¡¬æ€§é™åˆ¶ï¼›éç©ºè¡Œåä¸€å®šä¸èƒ½æœ‰å¤šä½™çš„ç©ºæ ¼ç¬¦ï¼› ç©ºè¡Œå¯ä»¥ä½¿å¾—é˜…è¯»ä»£ç æ›´åŠ æ–¹ä¾¿ä»¥åŠæœ‰åŠ©äºä»£ç çš„åˆ†å—ã€‚ æ¯è¡Œä¸€å®šä¸èƒ½å­˜åœ¨å¤šäºä¸€æ¡è¯­å¥ ä»£ç å¿…é¡»ä½¿ç”¨4ä¸ªç©ºæ ¼ç¬¦çš„ç¼©è¿›ï¼Œä¸€å®šä¸èƒ½ç”¨ tabé”® PHPæ‰€æœ‰å…³é”®å­—å¿…é¡»å…¨éƒ¨å°å†™ æ§åˆ¶ç»“æ„çš„åŸºæœ¬è§„èŒƒå¦‚ä¸‹ï¼šæ§åˆ¶ç»“æ„å…³é”®è¯åå¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚å·¦æ‹¬å· ( åä¸€å®šä¸èƒ½æœ‰ç©ºæ ¼ã€‚å³æ‹¬å· ) å‰ä¹Ÿä¸€å®šä¸èƒ½æœ‰ç©ºæ ¼ã€‚å³æ‹¬å· ) ä¸å¼€å§‹èŠ±æ‹¬å· &#123; é—´ä¸€å®šæœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ç»“æ„ä½“ä¸»ä½“ä¸€å®šè¦æœ‰ä¸€æ¬¡ç¼©è¿›ã€‚ç»“æŸèŠ±æ‹¬å· &#125; ä¸€å®šåœ¨ç»“æ„ä½“ä¸»ä½“åå•ç‹¬æˆè¡Œã€‚ ä»£ç é£æ ¼è§„èŒƒå†…å®¹å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€è¯´æ˜äº†ï¼Œå¤§å®¶å¯è‡ªè¡Œé˜…è¯» PSR-4 è‡ªåŠ¨åŠ è½½å…³äºç”±æ–‡ä»¶è·¯å¾„ è‡ªåŠ¨è½½å…¥ å¯¹åº”ç±»çš„ç›¸å…³è§„èŒƒï¼Œ æœ¬è§„èŒƒæ˜¯å¯äº’æ“ä½œçš„ï¼Œå¯ä»¥ä½œä¸ºä»»ä¸€è‡ªåŠ¨è½½å…¥è§„èŒƒçš„è¡¥å……ï¼Œå…¶ä¸­åŒ…æ‹¬ PSR-0ï¼Œæ­¤å¤–ï¼Œ æœ¬ PSR è¿˜åŒ…æ‹¬è‡ªåŠ¨è½½å…¥çš„ç±»å¯¹åº”çš„æ–‡ä»¶å­˜æ”¾è·¯å¾„è§„èŒƒã€‚ æ­¤å¤„çš„â€œç±»â€æ³›æŒ‡æ‰€æœ‰çš„classç±»ã€æ¥å£ã€traitså¯å¤ç”¨ä»£ç å—ä»¥åŠå…¶å®ƒç±»ä¼¼ç»“æ„ã€‚ ä¸€ä¸ªå®Œæ•´çš„ç±»åéœ€å…·æœ‰ä»¥ä¸‹ç»“æ„: \\&lt;å‘½åç©ºé—´&gt;(\\&lt;å­å‘½åç©ºé—´&gt;)*\\&lt;ç±»å&gt; å®Œæ•´çš„ç±»åå¿…é¡»è¦æœ‰ä¸€ä¸ªé¡¶çº§å‘½åç©ºé—´ï¼Œè¢«ç§°ä¸º â€œvendor namespaceâ€ï¼› å®Œæ•´çš„ç±»åå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­å‘½åç©ºé—´ï¼› å®Œæ•´çš„ç±»åå¿…é¡»æœ‰ä¸€ä¸ªæœ€ç»ˆçš„ç±»åï¼› å®Œæ•´çš„ç±»åä¸­ä»»æ„ä¸€éƒ¨åˆ†ä¸­çš„ä¸‹åˆ’çº¿éƒ½æ˜¯æ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„ï¼› å®Œæ•´çš„ç±»åå¯ä»¥ç”±ä»»æ„å¤§å°å†™å­—æ¯ç»„æˆï¼› æ‰€æœ‰ç±»åéƒ½å¿…é¡»æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ å½“æ ¹æ®å®Œæ•´çš„ç±»åè½½å…¥ç›¸åº”çš„æ–‡ä»¶â€¦â€¦ å®Œæ•´çš„ç±»åä¸­ï¼Œå»æ‰æœ€å‰é¢çš„å‘½åç©ºé—´åˆ†éš”ç¬¦ï¼Œå‰é¢è¿ç»­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‘½åç©ºé—´å’Œå­å‘½åç©ºé—´ï¼Œä½œä¸ºâ€œå‘½åç©ºé—´å‰ç¼€â€ï¼Œå…¶å¿…é¡»ä¸è‡³å°‘ä¸€ä¸ªâ€œæ–‡ä»¶åŸºç›®å½•â€ç›¸å¯¹åº”ï¼› ç´§æ¥å‘½åç©ºé—´å‰ç¼€åçš„å­å‘½åç©ºé—´å¿…é¡»ä¸ç›¸åº”çš„â€æ–‡ä»¶åŸºç›®å½•â€œç›¸åŒ¹é…ï¼Œå…¶ä¸­çš„å‘½åç©ºé—´åˆ†éš”ç¬¦å°†ä½œä¸ºç›®å½•åˆ†éš”ç¬¦ã€‚ æœ«å°¾çš„ç±»åå¿…é¡»ä¸å¯¹åº”çš„ä»¥ .php ä¸ºåç¼€çš„æ–‡ä»¶åŒåã€‚ è‡ªåŠ¨åŠ è½½å™¨ï¼ˆautoloaderï¼‰çš„å®ç°ä¸€å®šä¸èƒ½æŠ›å‡ºå¼‚å¸¸ã€ä¸€å®šä¸èƒ½è§¦å‘ä»»ä¸€çº§åˆ«çš„é”™è¯¯ä¿¡æ¯ä»¥åŠä¸åº”è¯¥æœ‰è¿”å›å€¼ã€‚ ä¾‹å­ä¸‹è¡¨å±•ç¤ºäº†ç¬¦åˆè§„èŒƒå®Œæ•´ç±»åã€å‘½åç©ºé—´å‰ç¼€å’Œæ–‡ä»¶åŸºç›®å½•æ‰€å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ã€‚ å®Œæ•´ç±»å å‘½åç©ºé—´å‰ç¼€ æ–‡ä»¶åŸºç›®å½• æ–‡ä»¶è·¯å¾„ \\Acme\\Log\\Writer\\File_Writer Acme\\Log\\Writer ./acme-log-writer/lib/ ./acme-log-writer/lib/File_Writer.php \\Aura\\Web\\Response\\Status Aura\\Web /path/to/aura-web/src/ /path/to/aura-web/src/Response/Status.php \\Symfony\\Core\\Request Symfony\\Core ./vendor/Symfony/Core/ ./vendor/Symfony/Core/Request.php \\Zend\\Acl Zend /usr/includes/Zend/ /usr/includes/Zend/Acl.php æš‚ä¸”åªä»‹ç»è¿™æ¯”è¾ƒå¸¸ç”¨çš„ä¸‰ä¸ªè§„èŒƒã€‚ æ›´å¤šæœ€æ–°è§„èŒƒå»ºè®®ç‚¹å‡»æŸ¥çœ‹ æœ¬èŠ‚ä¸»è¦ä»‹ç»äº†PHPçš„ç¼–ç è§„èŒƒPSRï¼Œå»ºè®®å¤§å®¶åœ¨å¼€å‘ä¸­å°½é‡éµå¾ªæ­¤è§„èŒƒï¼Œç‰¹åˆ«æ˜¯å›¢é˜Ÿå¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å„è‡ªæœ‰ç€å„è‡ªçš„ç¼–ç é£æ ¼ï¼Œåº”è¯¥å°½å¯èƒ½ç»Ÿä¸€é£æ ¼ã€‚æ­£å¦‚PHP-FIGç»„ç»‡çš„åˆè¡·æ‰€è¯´ï¼Œä»–ä»¬å»ºç«‹çš„è§„èŒƒä¸æ˜¯é™åˆ¶å¤§å®¶çš„ç¼–ç è‡ªç”±ï¼Œåªæ˜¯å¯»æ‰¾å…±æ€§ï¼Œä¸ºäº†æˆ‘ä»¬ä¸€èµ·æ›´å¥½çš„ååŒå·¥ä½œã€‚","tags":["phpframe"],"categories":["phpframe"]},{"title":"Redisä½¿ç”¨scanæ›¿æ¢keys","path":"/2020/01/26/225/","content":"æˆ‘ä»¬éƒ½çŸ¥é“æŸ¥æ‰¾Redisçš„é”®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨keys patternï¼Œä½†å½“keyå¤ªå¤šæ—¶ï¼Œkeyså‘½ä»¤çš„æ•ˆç‡å°±å¾ˆä½ï¼Œå¦‚æœåœ¨çº¿ä¸Šç›´æ¥ä½¿ç”¨ï¼Œç”šè‡³å¯èƒ½å‘ç”Ÿç”Ÿäº§äº‹æ•…ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¦¨ä½¿ç”¨scanå‘½ä»¤ã€‚ SCAN å‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼ˆcursor based iteratorï¼‰ï¼š SCAN å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨ä¹‹åï¼Œ éƒ½ä¼šå‘ç”¨æˆ·è¿”å›ä¸€ä¸ªæ–°çš„æ¸¸æ ‡ï¼Œ ç”¨æˆ·åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°æ¸¸æ ‡ä½œä¸º SCAN å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°ï¼Œ ä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚å½“ SCAN å‘½ä»¤çš„æ¸¸æ ‡å‚æ•°è¢«è®¾ç½®ä¸º 0 æ—¶ï¼Œ æœåŠ¡å™¨å°†å¼€å§‹ä¸€æ¬¡æ–°çš„è¿­ä»£ï¼Œ è€Œå½“æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›å€¼ä¸º 0 çš„æ¸¸æ ‡æ—¶ï¼Œ è¡¨ç¤ºè¿­ä»£å·²ç»“æŸã€‚ ç”Ÿæˆkey&lt;?php// ç”Ÿæˆ1000ä¸ª$Redis = new \\Redis();$Redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379, 10);$Redis-&gt;select(2);$arr = [ &#x27;rwer&#x27;, &#x27;24erw&#x27;, &#x27;rterq4&#x27;, &#x27;sdgfd5&#x27;, &#x27;dgsdg&#x27;, &#x27;sfst&#x27;,];for ($i=0; $i&lt;1000; $i++) &#123; $Redis-&gt;set(md5($i.$arr[$i%6]), md5($arr[$i%6].&#x27;sdfsd&#x27;));&#125;echo &quot;OK&quot;.PHP_EOL; keysæŸ¥çœ‹ä¸ªæ•°keys c* scanéå†&lt;?php$Redis = new \\Redis();$Redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379, 10);$Redis-&gt;select(2);$iterator = null;// éå†å‰ç¼€$pattern = &#x27;c*&#x27;;$count = 100;// åŠ¡å¿…è®¾ç½®ï¼Œå¦‚æœæ²¡æ‰«æåˆ°ï¼Œç»§ç»­æ‰«æï¼Œè€Œä¸æ˜¯è¿”å›ç©ºï¼Œå¦åˆ™whileç›´æ¥é€€å‡ºï¼Œéå†å°±ä¼šä¸å‡†ç¡®$Redis-&gt;setOption(\\Redis::OPT_SCAN, \\Redis::SCAN_RETRY);$total = [];$i = 0;// $countå¯ä»¥ä¸è®¾ç½®ï¼Œéå¿…éœ€å‚æ•°while($arr = $Redis-&gt;scan($iterator, $pattern, $count)) &#123; $arrVal = $Redis-&gt;mget($arr); $ret = array_combine($arr, $arrVal); $total = array_merge($total, $ret); $i++;&#125;// var_dump($total);var_dump($i);echo count($total).PHP_EOL; å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨\\Redis::OPT_SCAN, \\Redis::SCAN_RETRYè¿™ä¸¤ä¸ªå‚æ•°ï¼Œè‡ªè¡Œå¾ªç¯ï¼Œåˆ¤æ–­è¿”å›å€¼æ˜¯ä¸æ˜¯falseï¼Œä¹Ÿèƒ½éå†æˆåŠŸã€‚","tags":["Redis"],"categories":["Redis"]},{"title":"2019,è¿™ä¸€å¹´","path":"/2020/01/24/2019/","content":"å¤§å®¶ï¼Œè¿‡å¹´å¥½å•Šï¼ ä¸€ç›´æƒ³å†™æ¥ç€ï¼Œè¢«ç•™åˆ°äº†æœ€åï¼Œè¾å¹´å›æ¥ï¼Œæ—¶é—´å°šæ—©ï¼Œæ¥è¯´è¯´è¿™ä¸€å¹´å§ï¼ å·¥ä½œä¸å­¦ä¹ å·¥ä½œä¸Šèƒ½è¯´çš„ä¼¼ä¹ä¸æ˜¯å¤ªå¤šã€‚ä¸‰æœˆä»½è·³æ§½ï¼Œæ¥åˆ°ä¸€å®¶æ¸¸æˆå…¬å¸ï¼Œç›¸æ¯”ä¹‹å‰å¾…è¿‡çš„åˆ›ä¸šå‹å…¬å¸ï¼Œæ„Ÿè§‰æœ‰ç‚¹ä¸ä¸€æ ·ã€‚ å·¥ä½œæ²¡æœ‰é‚£ä¹ˆé‡ï¼Œæœ‰æ›´å¤šçš„æ—¶é—´å»å­¦ä¹ å»æ€è€ƒï¼Œå¹¶èƒ½åº”ç”¨åˆ°å·¥ä½œä¸­ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘éå¸¸æ»¡æ„çš„ã€‚ç›¸å¯¹çš„ï¼Œä¹Ÿæ„Ÿè§‰åˆ°è‡ªå·±çš„ä¸è¶³ï¼Œå¢åŠ çªç ´æ€§æ˜¯æ¥å¹´å·¥ä½œçš„é‡ç‚¹ä¹‹ä¸€ã€‚ å·¥ä½œä¹‹ä½™çš„å­¦ä¹ ï¼Œèµ°äº†ä¸€äº›å¼¯è·¯ï¼Œä»javaåˆ°goï¼Œå†åˆ°swooleï¼Œå†åˆåˆ°goï¼Œæœ€ååˆ°åŸºç¡€çŸ¥è¯†ï¼Œæ²¡æœ‰å®Œæ•´åœ°å»æ·±å…¥æ¢ç´¢ï¼Œè€Œæ˜¯å› ä¸ºè·³æ¥è·³å»ï¼Œæµªè´¹äº†ä¸€äº›æ—¶é—´ã€‚ æ¯”è¾ƒæ»¡æ„è‡ªå·±å†™äº†ä¸¤ä¸ªæŠ€æœ¯å°ä¸“æ ï¼Œå…³äºNginxå’ŒPHPçš„ï¼Œè¿™ä¹Ÿç®—æ˜¯ä¸šä½™è¾“å‡ºå§ï¼ï¼ˆæœ‰å…´è¶£çš„å¯ä»¥ç‚¹å‡»èœå•æŸ¥çœ‹ï¼‰ å¹³æ—¶åšä¸šåŠ¡çš„æ¯”è¾ƒå¤šï¼Œå®¹æ˜“é™·äºé‡å¤åŠ³åŠ¨çš„è¯¯åŒºï¼Œè¯•ç€é˜¶æ®µæ€§æ€»ç»“ï¼Œå‡å°‘é‡å¤åŠ³åŠ¨ï¼Œå¹¶è¯•å›¾å¼•å…¥æ–°çš„æŠ€æœ¯ï¼Œå€’æ˜¯ä¹Ÿç®—å¿™å¾—ä¸äº¦ä¹ä¹ï¼Œè‡ªæˆ‘æˆé•¿è¿˜æ˜¯æ»¡æ„çš„ï¼Œå³ä¾¿å­¦ä¹ ä¼¼ä¹ä¸å¹´åˆè®¡åˆ’ä¸å¤ªç›¸ç¬¦ã€‚å»ºè®®ç¨‹åºå‘˜æœ‹å‹ï¼Œç»å¸¸èƒ½è¾“å‡ºç¬”è®°åšå®¢ï¼Œå½’æ¡£èµ·æ¥ï¼Œæ–¹ä¾¿è‡ªå·±ï¼Œä¹Ÿæ–¹ä¾¿åˆ†äº«ä»–äººã€‚ 2020ï¼Œä¸æƒ³å»è§„åˆ’å¤ªå¤šï¼Œæ›´å¤šçš„æ˜¯æ·±å…¥ä¸åŸºç¡€çš„å·©å›ºå§ï¼Œä¹Ÿåœ¨å·¥ä½œä¸­å¯»æ‰¾ä¸€äº›çªç ´ï¼Œæœ‰ä½™åŠ›å†å»æ‹“å±•è‡ªå·±çš„æŠ€æœ¯æ ˆã€‚ ä¸‡äº‹çš†å˜ï¼Œå·¥ä½œä¸å­¦ä¹ çš„ç›¸è¾…ç›¸æˆä¸å˜ã€‚ ç”Ÿæ´»ä½“é‡å˜åŒ–çš„ä¸å¤šï¼Œç”Ÿæ´»å…¶å®å˜åŒ–çš„å¾ˆå¤šã€‚ç›¸æ¯”ä¹‹å‰ï¼Œå¯èƒ½è¿‡å¾—æ›´ç²—ç³™äº†ç‚¹ï¼ŒæŠ›å¼ƒäº†ä¸€äº›ä¸œè¥¿ï¼Œä½†ä¹Ÿæ›´åŠ æ‡‚å¾—äº†è´£ä»»çš„æ„ä¹‰ã€‚æœ‰æ—¶å€™å¯¹ç”Ÿæ´»ä¸Šä¼šæœ‰ä¸€ä¸æ— åŠ›æ„Ÿï¼Œæ²¡æœ‰ä»¥å‰é‚£ä¹ˆç†æƒ³åŒ–äº†ï¼Œä¼šå»æƒ³å¾ˆå¤šäº‹ï¼Œä¼¼ä¹ä¹Ÿä¼šåˆ»æ„å»é€ƒé¿ä¸€äº›ä¸œè¥¿ï¼Œä½†ä¸€ç›´ä¿æœ‰å¯¹ç¾å¥½æœªæ¥çš„æ†§æ†¬ä¸å¸Œæœ›ã€‚ ä¸çŸ¥é“æ€ä¹ˆåœ°ï¼Œä¸‹åŠå¹´çªå‘è¿‡æ•ï¼Œä¸çŸ¥é“æ˜¯æ²»ç–—ä¸å½“è¿˜æ˜¯è‡ªå·±æ²¡æœ‰æ­£è§†ï¼Œæœ€ç»ˆå¼•å‘å…¨èº«æ¹¿ç–¹ï¼ŒæŠ˜ç£¨äº†è‡ªå·±ä¸‰ä¸ªæœˆã€‚æ—¶é—´ä¹…äº†ï¼Œåå€’å¿ƒæ€è¶Šæ¥è¶Šå¹³å’Œäº†ï¼Œå³ä¾¿ç°åœ¨è¿˜æ²¡å¥½ï¼Œä½†æˆ‘ä¸ä¸ºè¿™ä¸ªå‘æ„äº†ã€‚ä¹Ÿè®¸ï¼Œèº«ä½“åªæ˜¯æé†’æˆ‘æ—©ç¡æ—©èµ·ï¼Œæ³¨æ„é¥®é£Ÿä¸ä¸ªäººå«ç”Ÿã€‚ å¾ˆå¼€å¿ƒçš„äº‹æ˜¯é‡è§äº†ä¸€ä¸ªå§‘å¨˜ï¼Œä¸»è§‚å®¢è§‚åœ°å˜åŒ–äº†å¾ˆå¤šï¼Œæ½œç§»é»˜åŒ–çš„ï¼Œå¾ˆå¹¸è¿ï¼Œæ„Ÿè°¢ï¼ˆæ­¤å¤„ç•¥è¿‡2020å­—ï¼‰ï½ æ–°å¹´è®¡åˆ’ ç¡®å®šäººç”Ÿå¤§äº‹ å¢åŠ è‡ªå·±çš„è½¯å®åŠ›ï¼ˆä¸æ­¢äºæŠ€æœ¯ï¼‰ å‡è½»3kgä½“é‡ï¼Œç˜¦ç˜¦è‚šå­ æ³¨æ„é¥®é£Ÿï¼Œæ—©ç¡æ—©èµ· æœ€åç¥å„ä½æ–°å¹´å¿«ä¹ï¼Œèº«ä½“å¥åº·ï¼Œè¿œç¦»ç–¾ç—…ï¼Œ2020å¼€å¿ƒå¿«ä¹ï¼ 2020/01/24å·±äº¥é™¤å¤•è®°at å®‰åº†å²³è¥¿","tags":["oneyear"],"categories":["oneyear"]},{"title":"Laravelé…åˆJWT","path":"/2020/01/20/224/","content":"æµ‹è¯•ä½¿ç”¨çš„æ˜¯Laravel5.5ç‰ˆæœ¬ã€‚ å®‰è£…composer require tymon/jwt-auth=1.0.0-rc.5 é…ç½®ç”Ÿæˆé…ç½®php artisan vendor:publish --provider=&quot;Tymon\\JWTAuth\\Providers\\LaravelServiceProvider&quot;php artisan jwt:secret authé…ç½®&lt;?phpreturn [\t... &#x27;defaults&#x27; =&gt; [ &#x27;guard&#x27; =&gt; &#x27;web&#x27;, &#x27;passwords&#x27; =&gt; &#x27;users&#x27;, ], &#x27;guards&#x27; =&gt; [ &#x27;web&#x27; =&gt; [ &#x27;driver&#x27; =&gt; &#x27;session&#x27;, &#x27;provider&#x27; =&gt; &#x27;users&#x27;, ], // ä½¿ç”¨jwt &#x27;api&#x27; =&gt; [ &#x27;driver&#x27; =&gt; &#x27;jwt&#x27;, &#x27;provider&#x27; =&gt; &#x27;apiUser&#x27;, ], ], &#x27;providers&#x27; =&gt; [ ... // æŒ‡å®šmodel &#x27;apiUser&#x27; =&gt; [ &#x27;driver&#x27; =&gt; &#x27;eloquent&#x27;, &#x27;model&#x27; =&gt; App\\ApiUser::class, ], ],]; ç¼–ç æ§åˆ¶å™¨ï¼š &lt;?phpnamespace App\\Http\\Controllers\\Api;use App\\ApiUser;use App\\Http\\Controllers\\Controller;use Illuminate\\Http\\Request;use Tymon\\JWTAuth\\Facades\\JWTAuth;class AuthController extends Controller&#123; /** * ä¸­é—´ä»¶å»é™¤loginå’Œrefresh * * @return void */ public function __construct() &#123; $this-&gt;middleware(&#x27;auth:api&#x27;, [&#x27;except&#x27; =&gt; [&#x27;login&#x27;,&#x27;refresh&#x27;]]); &#125; /** * Get a JWT via given credentials. * * @return \\Illuminate\\Http\\JsonResponse */ public function login(Request $request) &#123; $credentials = $request-&gt;only(&#x27;phone&#x27;, &#x27;password&#x27;); if (count($credentials) &lt; 2) &#123; return response()-&gt;json([&#x27;error&#x27; =&gt; &#x27;Unauthorized&#x27;], 401); &#125; $user = ApiUser::where(&#x27;phone&#x27;, $credentials[&#x27;phone&#x27;]) -&gt;where(&#x27;password&#x27;, md5($credentials[&#x27;password&#x27;])) -&gt;first(); if (empty($user) || !$token = JWTAuth::fromUser($user)) &#123; return response()-&gt;json([&#x27;error&#x27; =&gt; &#x27;Unauthorized&#x27;], 401); &#125; // dd($token); return $this-&gt;respondWithToken($token); &#125; /** * Get the authenticated User. * * @return \\Illuminate\\Http\\JsonResponse */ public function me() &#123; return response()-&gt;json(auth(&#x27;api&#x27;)-&gt;user()); &#125; /** * Log the user out (Invalidate the token). * * @return \\Illuminate\\Http\\JsonResponse */ public function logout() &#123; auth()-&gt;logout(); return response()-&gt;json([&#x27;message&#x27; =&gt; &#x27;Successfully logged out&#x27;]); &#125; /** * Refresh a token. * * @return \\Illuminate\\Http\\JsonResponse */ public function refresh() &#123; return $this-&gt;respondWithToken(auth(&#x27;api&#x27;)-&gt;refresh()); &#125; /** * Get the token array structure. * * @param string $token * * @return \\Illuminate\\Http\\JsonResponse */ protected function respondWithToken($token) &#123; return response()-&gt;json([ &#x27;access_token&#x27; =&gt; $token, &#x27;token_type&#x27; =&gt; &#x27;bearer&#x27;, &#x27;expires_in&#x27; =&gt; auth(&#x27;api&#x27;)-&gt;factory()-&gt;getTTL() * 60 ]); &#125;&#125; è·¯ç”±ï¼š æ­¤å¤„æ³¨æ„ï¼Œæˆ‘ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œä½¿ç”¨äº†getæ–¹æ³•ï¼Œç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨getã€‚ // routes/api.phpRoute::middleware(&#x27;api&#x27;)-&gt;prefix(&#x27;auth&#x27;)-&gt;namespace(&#x27;Api&#x27;)-&gt;group(function () &#123;\tRoute::get(&#x27;login&#x27;, &#x27;AuthController@login&#x27;);\tRoute::post(&#x27;logout&#x27;, &#x27;AuthController@logout&#x27;);\tRoute::get(&#x27;refresh&#x27;, &#x27;AuthController@refresh&#x27;);\tRoute::get(&#x27;me&#x27;, &#x27;AuthController@me&#x27;);&#125;); æµ‹è¯•ä¸€ä¸‹: unauthenticatedå¤„ç†è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼Œunauthenticatedå¤„ç†ä¸€ä¸‹æ¯”è¾ƒå¥½ï¼Œå¦åˆ™ä¼šé»˜è®¤è·³è½¬loginç™»å½•é¡µé¢ã€‚ &lt;?phpnamespace App\\Exceptions;use Exception;use Illuminate\\Foundation\\Exceptions\\Handler as ExceptionHandler;use Illuminate\\Auth\\AuthenticationException;class Handler extends ExceptionHandler&#123; ... protected function unauthenticated($request, AuthenticationException $exception) &#123; return response()-&gt;json([&#x27;message&#x27; =&gt; &#x27;Unauthenticated.&#x27;], 401); /*éapiå¯ä»¥è¿™ä¹ˆå¤„ç† return $request-&gt;expectsJson() ? response()-&gt;json([&#x27;message&#x27; =&gt; &#x27;Unauthenticated.&#x27;], 401) : redirect()-&gt;guest(route(&#x27;login&#x27;)); */ &#125;&#125; åŠ å…¥token refreshåŠ å…¥ä¸­é—´ä»¶ä»£ç ï¼š &lt;?phpnamespace App\\Http\\Middleware; use Closure;use Tymon\\JWTAuth\\Facades\\JWTAuth;use Tymon\\JWTAuth\\Exceptions\\JWTException;use Illuminate\\Auth\\AuthenticationException;use Tymon\\JWTAuth\\Exceptions\\TokenExpiredException;use Illuminate\\Http\\Exceptions\\HttpResponseException;use Tymon\\JWTAuth\\Http\\Middleware\\BaseMiddleware;class RefreshToken extends BaseMiddleware&#123; /** * Handle an incoming request. * * @param \\Illuminate\\Http\\Request $request * @param \\Closure $next * @return mixed */ public function handle($request, Closure $next) &#123; try&#123; //æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦å¸¦æœ‰token å¦‚æœæ²¡æœ‰tokenå€¼åˆ™æŠ›å‡ºå¼‚å¸¸ $this-&gt;checkForToken($request); if ($request-&gt;user = JWTAuth::parseToken()-&gt;authenticate()) &#123; return $next($request); &#125; throw new AuthenticationException(&#x27;Unauthorized&#x27;, []); &#125;catch (TokenExpiredException $exception)&#123; //è¿”å›ç‰¹æ®Šçš„code throw new HttpResponseException(response()-&gt;json([ &#x27;message&#x27; =&gt; &#x27;token expired&#x27; ])); &#125; catch (\\Exception $exception) &#123; throw new AuthenticationException(&#x27;Unauthorized&#x27;, []); &#125; &#125;&#125; æ³¨å†Œï¼š &lt;?phpnamespace App\\Http;use Illuminate\\Foundation\\Http\\Kernel as HttpKernel;class Kernel extends HttpKernel&#123; ... protected $routeMiddleware = [ &#x27;token.refresh&#x27; =&gt; \\App\\Http\\Middleware\\RefreshToken::class, &#x27;auth.basic&#x27; =&gt; \\Illuminate\\Auth\\Middleware\\AuthenticateWithBasicAuth::class, &#x27;bindings&#x27; =&gt; \\Illuminate\\Routing\\Middleware\\SubstituteBindings::class, &#x27;can&#x27; =&gt; \\Illuminate\\Auth\\Middleware\\Authorize::class, &#x27;guest&#x27; =&gt; \\App\\Http\\Middleware\\RedirectIfAuthenticated::class, &#x27;throttle&#x27; =&gt; \\Illuminate\\Routing\\Middleware\\ThrottleRequests::class, ];&#125; ç›¸åº”çš„æ§åˆ¶å™¨æ„é€ å‡½æ•°ä¿®æ”¹ï¼š public function __construct()&#123; $this-&gt;middleware(&#x27;token.refresh&#x27;, [&#x27;except&#x27; =&gt; [&#x27;login&#x27;,&#x27;refresh&#x27;]]);&#125; æŠŠtokenæ—¶é—´è®¾ç½®æˆ1åˆ†é’Ÿï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚ å¯ä»¥æ ¹æ®apiè¿”å›ï¼Œå»è°ƒç”¨åˆ·æ–°æ¥å£ã€‚ ç®€å•ä½¿ç”¨å°±æ˜¯è¿™æ ·å•¦ã€‚æ›´å¤šä½¿ç”¨å¯ä»¥çœ‹ä¸‹ç«™å†…å…¶ä»–æ–‡ç« ï¼šJWT å®Œæ•´ä½¿ç”¨è¯¦è§£jwt-authæ–‡æ¡£","tags":["Laravel","jwt"],"categories":["PHP"]},{"title":"Laravelç»Ÿä¸€é”™è¯¯å¤„ç†","path":"/2020/01/20/223/","content":"Laravelä¸­çš„App\\Exceptions\\Handler ç±»è´Ÿè´£è®°å½•åº”ç”¨ç¨‹åºè§¦å‘çš„æ‰€æœ‰å¼‚å¸¸ï¼Œè¿™åœ¨æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ååˆ†æ–¹ä¾¿ï¼Œæ€»æ˜¯tryâ€¦catchä½¿ä»£ç å¤ªè¿‡ç¹çä¸”å¯è¯»æ€§å¤§å¤§é™ä½ï¼Œé‚£ä¹ˆæ€ä¹ˆä½¿ç”¨å®ƒå¤„ç†å¼‚å¸¸ä¸ºjsonå‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªclassï¼Œç”¨æ¥å¤„ç†å¼‚å¸¸è¿”å›ã€‚ &lt;?php/** * Author: sai * Date: 2020/1/15 * Time: 14:31 */namespace App\\Exceptions;class ApiException extends \\Exception&#123; const ERROR_CODE = 1001; const ERROR_MSG = &#x27;ApiException&#x27;; private $data = []; /** * BusinessException constructor. * * @param string $message * @param string $code * @param array $data */ public function __construct(string $message, string $code, $data = []) &#123; $this-&gt;code = $code ? : self::ERROR_CODE; $this-&gt;message = $message ? : self::ERROR_MSG; $this-&gt;data = $data; &#125; /** * @return array */ public function getData() &#123; return $this-&gt;data; &#125;\t/** * å¼‚å¸¸è¾“å‡º */ public function render($request) &#123; return response()-&gt;json([ &#x27;data&#x27; =&gt; $this-&gt;getData(), &#x27;code&#x27; =&gt; $this-&gt;getCode(), &#x27;messgae&#x27; =&gt; $this-&gt;getMessage(), ], 200); &#125;&#125; ç„¶åæˆ‘ä»¬åœ¨HandleråŠ å…¥ï¼ŒåŠ å…¥$dontReportï¼Œä¾¿ä¸ä¼šä½¿ç”¨è‡ªå¸¦çš„é”™è¯¯å¤„ç†ï¼Œè€Œä½¿ç”¨è‡ªå®šä¹‰çš„å¤„ç†ã€‚ &lt;?phpnamespace App\\Exceptions;use Exception;use Illuminate\\Foundation\\Exceptions\\Handler as ExceptionHandler;class Handler extends ExceptionHandler&#123; /** * ä¸€äº›ä¸éœ€ç®¡æˆ–ä¸éœ€è¦æŠ›å‡ºçš„å¼‚å¸¸ */ protected $dontReport = [ ApiException::class, ]; ...&#125; æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š &lt;?phpnamespace App\\Http\\Controllers;use App\\Exceptions\\ApiException;use Illuminate\\Http\\Request;class HomeController extends Controller&#123; public function index(Request $request) &#123; throw new ApiException(&#x27;error&#x27;, 10001, [&#x27;oh&#x27; =&gt; &#x27;no&#x27;]); return 1; &#125;&#125; æŸ¥çœ‹è¾“å‡ºï¼š æµ‹è¯•okï¼Œæˆ‘ä»¬å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨å•¦ã€‚å½“ç„¶ï¼Œå…¶ä»–å½¢å¼çš„é”™è¯¯è¾“å‡ºå¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚","tags":["Laravel"],"categories":["PHP"]},{"title":"ElementUIæ•´åˆç¼–è¾‘å™¨vue-quill-editor","path":"/2020/01/08/222/","content":"ç›´æ¥ä¸Šä»£ç ï¼š main.js import VueQuillEditor from &#x27;vue-quill-editor&#x27;import &#x27;quill/dist/quill.core.css&#x27;import &#x27;quill/dist/quill.snow.css&#x27;import &#x27;quill/dist/quill.bubble.css&#x27;Vue.use(VueQuillEditor) template: ...&lt;el-form-item label=&quot;è¯¦æƒ…&quot; prop=&quot;content&quot;&gt; &lt;quill-editor v-model=&quot;form.remark&quot; ref=&quot;myQuillEditor&quot; :options=&quot;editorOption&quot; @blur=&quot;onEditorBlur($event)&quot; @focus=&quot;onEditorFocus($event)&quot; @change=&quot;onEditorChange($event)&quot;&gt; &lt;/quill-editor&gt;&lt;/el-form-item&gt;&lt;div style=&quot;display:none;&quot;&gt; &lt;el-upload class=&quot;edit-uploader&quot; :action=&quot;uploadPicUrl&quot; :show-file-list=&quot;false&quot; :headers=&quot;header&quot; :on-success=&quot;editorUploadSuccess&quot; :on-error=&quot;editorUploadError&quot; :before-upload=&quot;beforeEditorUpload&quot; &gt; &lt;i class=&quot;el-icon-plus avatar-uploader-icon&quot; ref=&quot;aUpload&quot;&gt;&lt;/i&gt; &lt;/el-upload&gt;&lt;/div&gt;... &lt;script&gt;export default &#123; data() &#123; return &#123; editorOption: &#123; modules: &#123; toolbar: &#123;container:[ [&#x27;bold&#x27;, &#x27;italic&#x27;, &#x27;underline&#x27;, &#x27;strike&#x27;], [&#x27;blockquote&#x27;, &#x27;code-block&#x27;], [&#123; &#x27;header&#x27;: 1 &#125;, &#123; &#x27;header&#x27;: 2 &#125;], [&#123; &#x27;list&#x27;: &#x27;ordered&#x27; &#125;, &#123; &#x27;list&#x27;: &#x27;bullet&#x27; &#125;], [&#123; &#x27;script&#x27;: &#x27;sub&#x27; &#125;, &#123; &#x27;script&#x27;: &#x27;super&#x27; &#125;], [&#123; &#x27;indent&#x27;: &#x27;-1&#x27; &#125;, &#123; &#x27;indent&#x27;: &#x27;+1&#x27; &#125;], [&#123; &#x27;direction&#x27;: &#x27;rtl&#x27; &#125;], [&#123; &#x27;size&#x27;: [&#x27;small&#x27;, false, &#x27;large&#x27;, &#x27;huge&#x27;] &#125;], [&#123; &#x27;header&#x27;: [1, 2, 3, 4, 5, 6, false] &#125;], [&#123; &#x27;font&#x27;: [] &#125;], [&#123; &#x27;color&#x27;: [] &#125;, &#123; &#x27;background&#x27;: [] &#125;], [&#123; &#x27;align&#x27;: [] &#125;], [&#x27;clean&#x27;], [&#x27;link&#x27;, &#x27;image&#x27;] ], handlers: &#123; &#x27;image&#x27;: function(value) &#123; if (value) &#123; document.querySelector(&#x27;.edit-uploader input&#x27;).click() &#125; else &#123; this.quill.format(&#x27;image&#x27;, false); &#125; // this.$refs.aUpload.click() //è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ å›è°ƒ &#125; &#125; &#125;, syntax: &#123; highlight: text =&gt; hljs.highlightAuto(text).value &#125; &#125;, &#125; &#125; &#125;, methods: &#123; onEditorReady(editor) &#123; // å‡†å¤‡ç¼–è¾‘å™¨ &#125;, onEditorBlur()&#123;&#125;, // å¤±å»ç„¦ç‚¹äº‹ä»¶ onEditorFocus()&#123;&#125;, // è·å¾—ç„¦ç‚¹äº‹ä»¶ onEditorChange()&#123;&#125;, // å†…å®¹æ”¹å˜äº‹ä»¶ beforeEditorUpload() &#123; // æ˜¾ç¤ºloadingåŠ¨ç”» this.quillUpdateImg = true &#125;, editorUploadSuccess(res, file) &#123; // è·å–å¯Œæ–‡æœ¬ç»„ä»¶å®ä¾‹ let quill = this.$refs.myQuillEditor.quill // å¦‚æœä¸Šä¼ æˆåŠŸ if (res.code === 0) &#123; // è·å–å…‰æ ‡æ‰€åœ¨ä½ç½® let length = quill.getSelection().index; // æ’å…¥å›¾ç‰‡ res.infoä¸ºæœåŠ¡å™¨è¿”å›çš„å›¾ç‰‡åœ°å€ quill.insertEmbed(length, &#x27;image&#x27;, res.data.filepath) // è°ƒæ•´å…‰æ ‡åˆ°æœ€å quill.setSelection(length + 1) &#125; else &#123; this.$message.error(&#x27;å›¾ç‰‡æ’å…¥å¤±è´¥&#x27;) &#125; // loadingåŠ¨ç”»æ¶ˆå¤± this.quillUpdateImg = false &#125;, // å¯Œæ–‡æœ¬å›¾ç‰‡ä¸Šä¼ å¤±è´¥ editorUploadError() &#123; // loadingåŠ¨ç”»æ¶ˆå¤± this.quillUpdateImg = false this.$message.error(&#x27;å›¾ç‰‡æ’å…¥å¤±è´¥&#x27;) &#125; &#125;&#125;&lt;/script&gt; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¼–è¾‘å™¨é»˜è®¤ä½¿ç”¨base64ä¸Šä¼ ï¼Œæˆ‘ä»¬ä½¿ç”¨elementuiçš„ä¸Šä¼ ç»„ä»¶æ›¿æ¢æ‰åŸæ¥çš„å›¾ç‰‡ä¸Šä¼ ã€‚","tags":["ElementUI"],"categories":["vue"]},{"title":"javascriptç­¾åç›´ä¼ OSS","path":"/2020/01/08/221/","content":"æœ€è¿‘åœ¨å†™åå°ä»£ç ï¼Œä½¿ç”¨çš„æ˜¯VUE+ElementUIï¼Œè¸©äº†ä¸€äº›å‘åˆ†äº«ä¸€ä¸‹ã€‚ åŸç†ï¼šä»æœåŠ¡ç«¯è·å–ç­¾åï¼Œjsç›´æ¥ä¸Šä¼ é˜¿é‡Œäº‘OSSæœåŠ¡å™¨ã€‚ elementuiä¸»è¦ä»£ç  template:&lt;el-form-item label=&quot;ä¸Šä¼ å›¾ç‰‡&quot; prop=&quot;video&quot;&gt; &lt;el-upload id=&quot;video&quot; action :data=&quot;aliyunOssToken&quot; :http-request=&quot;uploadVideo&quot; :headers=&quot;header&quot;&gt; &lt;img v-if=&quot;form.cover&quot; :src=&quot;form.cover&quot;&gt; &lt;el-button class=&quot;avatar-uploader-icon&quot; type=&quot;primary&quot;&gt;ä¸Šä¼ &lt;/el-button&gt; &lt;/el-upload&gt;&lt;/el-form-item&gt;scriptï¼šupload(file)&#123; var _self = this; let imgType = file.file.type.split(&quot;/&quot;)[1].toLowerCase(); if (imgType != &#x27;jpg&#x27; &amp;&amp; imgType != &#x27;png&#x27;) &#123; this.$message.error(&#x27;è¯·ä¸Šä¼ å›¾ç‰‡ç±»å‹&#x27;); return; &#125; getOSSToken().then(function(res)&#123; _self.aliyunOssToken = res.data; var ossData = &#123;&#125;; //keyå°±ä»£è¡¨æ–‡ä»¶å±‚çº§å’Œé˜¿é‡Œäº‘ä¸Šçš„æ–‡ä»¶å let imgType = file.file.type.split(&quot;/&quot;)[1]; let filename = file.file.name + file.file.size; //md5å¯¹å›¾ç‰‡åç§°è¿›è¡ŒåŠ å¯† let keyValue = &quot;images/&quot; + md5(new Date() + filename) + &quot;.&quot; + imgType; // ç»„è£…formdata let formdata = new FormData(); formdata.append(&#x27;name&#x27;, file.file.name) formdata.append(&#x27;key&#x27;, keyValue) formdata.append(&#x27;policy&#x27;, _self.aliyunOssToken.policy) formdata.append(&#x27;OSSAccessKeyId&#x27;, _self.aliyunOssToken.accessid) formdata.append(&#x27;success_action_status&#x27;, 200) formdata.append(&#x27;signature&#x27;, _self.aliyunOssToken.signature) formdata.append(&#x27;file&#x27;, file.file) _self.uploadOSS(formdata, _self.aliyunOssToken.host).then(function(res)&#123; _self.form.cover = _self.aliyunOssToken.host + &#x27;/&#x27; + keyValue; _self.$message.success(&#x27;ä¸Šä¼ æˆåŠŸ&#x27;); &#125;).catch(function(error)&#123; _self.$message.error(&#x27;ä¸Šä¼ å¤±è´¥&#x27;); console.log(error); &#125;) &#125;).catch(function(error)&#123; console.log(error); &#125;)&#125;,uploadOSS(formData, url) &#123; const config = &#123; headers: &#123; &quot;Content-Type&quot;: &quot;multipart/form-data;boundary=&quot;+new Date().getTime() &#125; &#125;; return axios.post(url,formData,config);&#125; å…¶ä¸­ï¼šåŠ¡å¿…ä½¿ç”¨è¡¨å•æäº¤æ–¹å¼ï¼ŒaliyunOssTokenæ ¼å¼å¦‚ä¸‹ &#123;\t&quot;accessid&quot;: &quot;LToofXWKudxfoAlI&quot;,\t&quot;host&quot;: &quot;https:\\/\\/xxx.oss-cn-hangzhou.aliyuncs.com&quot;,\t&quot;policy&quot;: &quot;eyJleHBpcmF0eretaW9uIjoiQxODowNzowMFoiLCJjb25kaXRpb25zIjpbWyJjb250ZW50LWxlbmd0aC17ewreMDQ4NTc2MDAwXSxbInN0YXJ0cy13aXRoIiwiJGtleSIsInZpZGVvXC8iXV19&quot;,\t&quot;signature&quot;: &quot;HRFJ4345VIvRhrsMa44546=&quot;,\t&quot;expire&quot;: 1578478020,\t&quot;dir&quot;: &quot;images\\/&quot;&#125; è®°å¾—è®¾ç½®é˜¿é‡Œäº‘OSSè·¨åŸŸè§„åˆ™ï¼š æ–‡æ¡£ï¼š javascriptç­¾åç›´ä¼ ","tags":["js"],"categories":["web"]},{"title":"wrkå‹æµ‹ä½¿ç”¨","path":"/2019/12/30/220/","content":"æœ€è¿‘æœ‰éœ€è¦åšä¸€äº›å‹åŠ›æµ‹è¯•ï¼Œä¹‹å‰ä¸€ç›´ç”¨abï¼Œç”¨èµ·æ¥ä¸æ˜¯å¾ˆèˆ’æœï¼Œæœ€è¿‘æœ‰ä½¿ç”¨wrkï¼Œè½»é‡å¥½ç”¨ã€‚ å®‰è£…git clone https://github.com/wg/wrk.git wrkcd wrkmake# move the executable to somewhere in your PATHsudo cp wrk /somewhere/in/your/PATH é»˜è®¤æƒ…å†µä¸‹wrkä¼šä½¿ç”¨è‡ªå¸¦çš„LuaJITå’ŒOpenSSLï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ç³»ç»Ÿå·²å®‰è£…çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨WITH_LUAJITå’ŒWITH_OPENSSLè¿™ä¸¤ä¸ªé€‰é¡¹æ¥æŒ‡å®šå®ƒä»¬çš„è·¯å¾„ã€‚æ¯”å¦‚ï¼š make WITH_LUAJIT=/usr WITH_OPENSSL=/usr ä½¿ç”¨è¯´æ˜wrk &lt;é€‰é¡¹&gt; &lt;è¢«æµ‹HTTPæœåŠ¡çš„URL&gt; Options: -c, --connections &lt;N&gt; è·ŸæœåŠ¡å™¨å»ºç«‹å¹¶ä¿æŒçš„TCPè¿æ¥æ•°é‡ -d, --duration &lt;T&gt; å‹æµ‹æ—¶é—´ -t, --threads &lt;N&gt; ä½¿ç”¨å¤šå°‘ä¸ªçº¿ç¨‹è¿›è¡Œå‹æµ‹ -s, --script &lt;S&gt; æŒ‡å®šLuaè„šæœ¬è·¯å¾„ -H, --header &lt;H&gt; ä¸ºæ¯ä¸€ä¸ªHTTPè¯·æ±‚æ·»åŠ HTTPå¤´ --latency åœ¨å‹æµ‹ç»“æŸåï¼Œæ‰“å°å»¶è¿Ÿç»Ÿè®¡ä¿¡æ¯ --timeout &lt;T&gt; è¶…æ—¶æ—¶é—´ -v, --version æ‰“å°æ­£åœ¨ä½¿ç”¨çš„wrkçš„è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯ &lt;N&gt;ä»£è¡¨æ•°å­—å‚æ•°ï¼Œæ”¯æŒå›½é™…å•ä½ (1k, 1M, 1G) &lt;T&gt;ä»£è¡¨æ—¶é—´å‚æ•°ï¼Œæ”¯æŒæ—¶é—´å•ä½ (2s, 2m, 2h) æµ‹è¯•wrk -t8 -c200 -d30s --latency &quot;http://www.bing.com&quot;è¾“å‡ºï¼šRunning 30s test @ http://www.bing.com 8 threads and 200 connections Thread Stats Avg Stdev Max +/- Stdev Latency 46.67ms 215.38ms 1.67s 95.59% Req/Sec 7.91k 1.15k 10.26k 70.77% Latency Distribution 50% 2.93ms 75% 3.78ms 90% 4.73ms 99% 1.35s 1790465 requests in 30.01s, 684.08MB readRequests/sec: 59658.29Running 30s test @ http://www.bing.com ï¼ˆå‹æµ‹æ—¶é—´30sï¼‰ 8 threads and 200 connections ï¼ˆå…±8ä¸ªæµ‹è¯•çº¿ç¨‹ï¼Œ200ä¸ªè¿æ¥ï¼‰ Thread Stats Avg Stdev Max +/- Stdev ï¼ˆå¹³å‡å€¼ï¼‰ ï¼ˆæ ‡å‡†å·®ï¼‰ï¼ˆæœ€å¤§å€¼ï¼‰ï¼ˆæ­£è´Ÿä¸€ä¸ªæ ‡å‡†å·®æ‰€å æ¯”ä¾‹ï¼‰ Latency 46.67ms 215.38ms 1.67s 95.59% ï¼ˆå»¶è¿Ÿï¼‰ Req/Sec 7.91k 1.15k 10.26k 70.77% ï¼ˆå¤„ç†ä¸­çš„è¯·æ±‚æ•°ï¼‰ Latency Distribution ï¼ˆå»¶è¿Ÿåˆ†å¸ƒï¼‰ 50% 2.93ms 75% 3.78ms 90% 4.73ms 99% 1.35s ï¼ˆ99åˆ†ä½çš„å»¶è¿Ÿï¼‰ 1790465 requests in 30.01s, 684.08MB read ï¼ˆ30.01ç§’å†…å…±å¤„ç†å®Œæˆäº†1790465ä¸ªè¯·æ±‚ï¼Œè¯»å–äº†684.08MBæ•°æ®ï¼‰Requests/sec: 59658.29 ï¼ˆå¹³å‡æ¯ç§’å¤„ç†å®Œæˆ59658.29ä¸ªè¯·æ±‚ï¼‰Transfer/sec: 22.79MB ï¼ˆå¹³å‡æ¯ç§’è¯»å–æ•°æ®22.79MBï¼‰ luaè„šæœ¬ä½¿ç”¨--data.lualocal data= &quot;&#123;.count.:1&#125;&quot;wrk.headers[&quot;Content-Type&quot;] = &quot;application/jason&quot;wrk.method = &quot;POST&quot;function request()\treturn wrk.format(&#x27;POST&#x27;, nil, nil, data)end æµ‹è¯•ï¼š wrk -t500 -c1000 -d1s --script=data.lua --latency https://github.oscome.cn/ ä¸ªäººç”¨äº†å‡ æ¬¡ï¼Œæ„Ÿè§‰æ¯”abå¥½ç”¨ï¼Œæ¨èä¸€ä¸‹ã€‚ å‚è€ƒï¼šHttpå‹æµ‹å·¥å…·wrkä½¿ç”¨æŒ‡å—wrk","tags":["wrk"],"categories":["test"]},{"title":"gomodules","path":"/2019/12/27/219/","content":"Modules æ˜¯ Go ç®¡ç†ä¾èµ–å…³ç³»çš„å·¥å…·ï¼Œåœ¨ 1.11 ç‰ˆæœ¬ä¸­åŠ å…¥ï¼Œå¹¶åœ¨ 1.13ä¸­å¯¹æ¨¡å—è¿›è¡Œäº†é‡å¤§æ”¹è¿›å’Œæ›´æ”¹ã€‚ç›¸æ¯”å‰é¢çš„ depï¼Œvendorï¼Œglide ç­‰åŒ…ç®¡ç†æ–¹æ¡ˆï¼Œæ›´æ˜“äºä¸Šæ‰‹ã€‚å¦‚æœä½ ç°åœ¨å¼€å§‹ä¸€ä¸ª go é¡¹ç›®ï¼Œæœ€å¥½äº†è§£ä¸€ä¸‹ã€‚ Modules çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼š å¼€å¯ï¼ˆ1.13ç‰ˆæœ¬åŠä»¥åæ— éœ€è¿™ä¸€æ­¥)1.13ç‰ˆæœ¬å‰è¯·éœ€æ‰‹åŠ¨å¼€å¯æ¨¡å—ï¼ˆ1.13 ç‰ˆæœ¬å¼€å§‹å·²ç»æ˜¯é»˜è®¤æ¨¡å¼ï¼‰ export GO111MODULE=auto åˆå§‹åŒ–è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š go mod init github.com/puresai/gomodules output: go: creating new go.mod: module github.com/puresai/gomodules å¯ä»¥çœ‹åˆ°ä¼šç”Ÿæˆgo.modï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ã€go 1.19è¡¨ç¤ºå½“å‰ç‰ˆæœ¬ã€‘ module github.com/puresai/gomodulesgo 1.19 ä½¿ç”¨ go getæ¯æ¬¡ go get åï¼Œmodulesä¹Ÿä¼šå°†ä½ çš„å®‰è£…çš„packageåŠ å…¥go.mod go get github.com/puresai/gohelper module github.com/puresai/gomodulesgo 1.19require github.com/puresai/gohelper v0.0.1 // indirect å½“ç„¶ï¼Œå¦‚æœä½ æ²¡æœ‰ç¿»å¢™ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨å›½å†…é•œåƒï¼Œå¾ˆå¤šåŒ…å¯èƒ½éƒ½ä¸‹è½½å¤±è´¥ã€‚å¯ä»¥å‚è€ƒhttps://goproxy.cn/è®¾ç½®ã€‚ æœ¬åœ°æ–‡ä»¶å¤¹ç›¸äº’è°ƒç”¨æ–°å»º pkg ç›®å½•ï¼Œæ–°å»º str.go package pkgimport &quot;github.com/puresai/gohelper/str&quot;func MD(s string) string &#123;\treturn str.Md5(s)&#125; ç®€å•å†™ä¸€ä¸‹ main.go package mainimport &quot;github.com/puresai/gomodules/pkg&quot; // å¼•å…¥åˆšåˆšæ–°å»ºçš„ pkgfunc main() &#123;\tprint(pkg.MD(&quot;puresai&quot;))&#125; ç„¶åæ‰§è¡Œï¼š go run main.gopkg/str.go:3:8: no required module provides package github.com/puresai/gohelper/str; to add it: go get github.com/puresai/gohelper/str è¿™é‡Œå¯ä»¥æ‰§è¡Œæ ¹æ®æç¤ºæ‰§è¡Œ go get github.com/puresai/gohelper/str æˆ–è€…å¯ä»¥ä½¿ç”¨ go mod tidy è¿™ä¸ªå‘½ä»¤å¯ä»¥æ‹‰å–ç¼ºå°‘çš„ packageï¼Œç§»é™¤ä¸ç”¨çš„ packageã€‚ è¿™ä¸ªå‘½ä»¤å¾ˆæœ‰ç”¨ï¼Œæˆ‘ä¹ æƒ¯æ¯æ¬¡å®Œæˆä¸€ä¸ªé˜¶æ®µä»£ç éƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥å»é™¤å¾ˆå¤šå†—ä½™çš„ packageã€‚ å…¶ä»–å‘½ä»¤go mod download//ä¸‹è½½ä¾èµ–åŒ…åˆ°æœ¬åœ°ç¼“å­˜go mod graph //æ‰“å°ç°æœ‰ä¾èµ–ç»“æ„go mod verify //æ ¡éªŒä¾èµ–go mod why //è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦æ­¤æ¨¡å—go mod vendor //ä¸‹è½½ä¾èµ–çš„packageåˆ°æœ¬åœ°vendorç›®å½•ï¼Œå­¦ä¹ ä¸­å¯ä½¿ç”¨ ç›¸å…³ä»£ç å¯å‚è€ƒ:https://github.com/puresai/blog-code/tree/master/gomodules å‚è€ƒ Modulesçš„wiki","tags":["go"],"categories":["go"]},{"title":"Nginxè´Ÿè½½å‡è¡¡","path":"/2019/12/21/Nginx2/","content":"è´Ÿè½½å‡è¡¡ç­–ç•¥1.è½®è¯¢(é»˜è®¤)ï¼šæ¯ä¸€ä¸ªæ¥è‡ªç½‘ç»œä¸­çš„è¯·æ±‚ï¼Œè½®æµåˆ†é…ç»™å†…éƒ¨çš„æœåŠ¡å™¨ï¼Œä»1åˆ°Nç„¶åé‡æ–°å¼€å§‹ã€‚æ­¤ç§è´Ÿè½½å‡è¡¡ç®—æ³•é€‚åˆæœåŠ¡å™¨ç»„å†…éƒ¨çš„æœåŠ¡å™¨éƒ½å…·æœ‰ç›¸åŒçš„é…ç½®å¹¶ä¸”å¹³å‡æœåŠ¡è¯·æ±‚ ç›¸å¯¹å‡è¡¡çš„æƒ…å†µã€‚2.åŠ æƒè½®è¯¢ï¼ˆweightï¼‰ï¼šæ ¹æ®æœåŠ¡å™¨çš„ä¸åŒå¤„ç†èƒ½åŠ›ï¼Œç»™æ¯ä¸ªæœåŠ¡å™¨åˆ†é…ä¸åŒçš„æƒå€¼ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥å—ç›¸åº”æƒå€¼æ•°çš„æœåŠ¡è¯·æ±‚ã€‚ä¾‹å¦‚:æœåŠ¡å™¨Açš„æƒå€¼è¢«è®¾è®¡æˆ1ï¼ŒBçš„æƒå€¼æ˜¯3ï¼ŒCçš„æƒå€¼æ˜¯6ï¼Œåˆ™æœåŠ¡å™¨Aã€Bã€Cå°†åˆ†åˆ«æ¥å—åˆ°10%ã€30%ã€60%çš„æœåŠ¡è¯·æ±‚ã€‚æ­¤ç§å‡è¡¡ç®—æ³•èƒ½ç¡®ä¿é«˜æ€§èƒ½çš„æœåŠ¡å™¨å¾—åˆ°æ›´å¤šçš„ä½¿ç”¨ç‡ï¼Œé¿å…ä½æ€§èƒ½çš„æœåŠ¡å™¨è´Ÿè½½è¿‡é‡ã€‚3.ip-hashï¼ˆip_hashï¼‰ï¼šnginxå°†ä¼šæ ¹æ®ç›¸åº”çš„hashå‡½æ•°ï¼Œå¯¹æ¯ä¸ªè¯·æ±‚çš„ipä½œä¸ºå…³é”®å­—ï¼Œå¾—åˆ°çš„hashå€¼å°†ä¼šå†³å®šå°†è¯·æ±‚åˆ†å‘ç»™ç›¸åº”Serverè¿›è¡Œå¤„ç†ã€‚4.æœ€å°‘è¿æ¥æ•°ï¼ˆleast_connï¼‰ï¼šnginxä¼šåˆ¤æ–­åç«¯é›†ç¾¤æœåŠ¡å™¨ä¸­å“ªä¸ªServerå½“å‰çš„ Active Connection æ•°æ˜¯æœ€å°‘çš„ï¼Œå¯¹äºæ¯ä¸ªæ–°è¿›æ¥çš„è¯·æ±‚ï¼Œnginxå°†è¯¥å…¶åˆ†å‘ç»™å¯¹åº”çš„Serverã€‚ è¯­æ³•è¯­æ³•: upstream name &#123; ... &#125; é»˜è®¤å€¼: â€”ä¸Šä¸‹æ–‡: httpupstream æŒ‡ä»¤å½“ä¸­åŒ…å«serveræŒ‡ä»¤è¯­æ³•: server address [parameters]; ä¸Šä¸‹æ–‡: upstream demo: upstream backend &#123; server backend1.example.com:8081 weight=4 max_fails=2 fail_timeout=30s; server backend2.example.com:8080 weight=1;&#125;server &#123; location / &#123; proxy_pass http://backend; &#125;&#125; å‚æ•°è¯´æ˜: weight=number è®¾å®šæœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤æ˜¯1ï¼Œæƒé‡è¶Šå¤§è¢«è®¿é—®æœºä¼šè¶Šå¤§ï¼Œå¯ä»¥æ ¹æ®æœºå™¨çš„é…ç½®æƒ…å†µæ¥é…ç½®ã€‚ max_fails=number è®¾å®šNginxä¸æœåŠ¡å™¨é€šä¿¡çš„å°è¯•å¤±è´¥çš„æ¬¡æ•°ã€‚åœ¨fail_timeoutå‚æ•°å®šä¹‰çš„æ—¶é—´æ®µå†…ï¼Œå¦‚æœå¤±è´¥çš„æ¬¡æ•°è¾¾åˆ°æ­¤å€¼ï¼ŒNginxå°±è®¤ä¸ºæœåŠ¡å™¨ä¸ å¯ç”¨ã€‚åœ¨ä¸‹ä¸€ä¸ªfail_timeoutæ—¶é—´æ®µï¼ŒæœåŠ¡å™¨ä¸ä¼šå†è¢«å°è¯•ã€‚ å¤±è´¥çš„å°è¯•æ¬¡æ•°é»˜è®¤æ˜¯1ã€‚é»˜è®¤é…ç½®æ—¶ï¼Œhttp_404çŠ¶æ€ä¸è¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„å°è¯•ã€‚ å¯ä»¥é€šè¿‡æŒ‡ä»¤proxy_next_upstream å’Œ memcached_next_upstream æ¥é…ç½®ä»€ä¹ˆæ˜¯å¤±è´¥çš„å°è¯•ã€‚ fail_timeout=time,ç»Ÿè®¡å¤±è´¥å°è¯•æ¬¡æ•°çš„æ—¶é—´æ®µã€‚åœ¨è¿™æ®µæ—¶é—´ä¸­ï¼ŒæœåŠ¡å™¨å¤±è´¥æ¬¡æ•°è¾¾åˆ°æŒ‡å®šçš„å°è¯•æ¬¡æ•°ï¼ŒæœåŠ¡å™¨å°±è¢«è®¤ä¸ºä¸å¯ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥è¶…æ—¶æ—¶é—´æ˜¯10ç§’ã€‚ backup,æ ‡è®°ä¸ºå¤‡ç”¨æœåŠ¡å™¨ã€‚å½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ä»¥åï¼Œè¯·æ±‚ä¼šè¢«ä¼ ç»™è¿™äº›æœåŠ¡å™¨ï¼Œé…ç½®è¿™ä¸ªæŒ‡ä»¤å¯ä»¥å®ç°æ•…éšœè½¬ç§»ã€‚ down,æ ‡è®°æœåŠ¡å™¨æ°¸ä¹…ä¸å¯ç”¨ï¼Œå¯ä»¥è·Ÿip_hashæŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ã€‚ proxy_next_upstream æŒ‡ä»¤åœ¨nginxçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œ proxy_next_upstream é¡¹å®šä¹‰äº†ä»€ä¹ˆæƒ…å†µä¸‹è¿›è¡Œé‡è¯• è¯­æ³•: proxy_next_upstream error | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | non_idempotent | off ...; é»˜è®¤å€¼: proxy_next_upstream error timeout;ä¸Šä¸‹æ–‡: http, server, location å‚æ•°è¯´æ˜: error è¡¨ç¤ºå’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œæˆ–è€…å‘åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæˆ–è€…ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´æ—¶ï¼Œå‡ºç°é”™è¯¯ã€‚ timeout è¡¨ç¤ºå’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œæˆ–è€…å‘åç«¯æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæˆ–è€…ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´æ—¶ï¼Œå‡ºç°è¶…æ—¶ã€‚ invalid_header è¡¨ç¤ºåç«¯æœåŠ¡å™¨è¿”å›ç©ºå“åº”æˆ–è€…éæ³•å“åº”å¤´ http_500 è¡¨ç¤ºåç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”çŠ¶æ€ç ä¸º500 non_idempotent é€šå¸¸ï¼Œå¦‚æœè¯·æ±‚å·²å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œåˆ™å…·æœ‰éç­‰å¹‚æ–¹æ³•ï¼ˆPOSTã€LOCKã€PATCHï¼‰çš„è¯·æ±‚ä¸ä¼šä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæœåŠ¡å™¨ï¼›å¯ç”¨æ­¤é€‰é¡¹å¯æ˜¾å¼å…è®¸é‡è¯•æ­¤ç±»è¯·æ±‚ï¼› off è¡¨ç¤ºåœæ­¢å°†è¯·æ±‚å‘é€ç»™ä¸‹ä¸€å°åç«¯æœåŠ¡å™¨ PS: non_idempotentå‚æ•°ï¼Œproxy_next_upstreamé…ç½®é»˜è®¤è½¬å‘getè¯·æ±‚ï¼Œä½†å¯¹äºpostç­‰è¯·æ±‚å¹¶æ— æ•ˆæœï¼Œå»ºè®®é…ç½®è¿™ä¸€é¡¹ã€‚ ç›¸å…³ proxy_next_upstream_tries:è®¾ç½®é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶ï¼Œæ³¨æ„æ­¤é‡è¯•æ¬¡æ•°æŒ‡çš„æ˜¯æ‰€æœ‰è¯·æ±‚æ¬¡æ•°(åŒ…æ‹¬ç¬¬ä¸€æ¬¡å’Œä¹‹åçš„é‡è¯•æ¬¡æ•°ä¹‹å’Œ)ã€‚ proxy_next_upstream_timeout: è®¾ç½®é‡è¯•æœ€å¤§è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶ã€‚å³åœ¨ proxy_next_upstream_timeout æ—¶é—´å†…å…è®¸ proxy_next_upstream_tries æ¬¡é‡è¯•ã€‚å¦‚æœè¶…è¿‡äº†å…¶ä¸­ä¸€ä¸ªè®¾ç½®ï¼Œåˆ™ Nginx ä¹Ÿä¼šç»“æŸé‡è¯•å¹¶è¿”å›å®¢æˆ·ç«¯å“åº”(å¯èƒ½æ˜¯é”™è¯¯ç )ã€‚ proxy_send_timeout:åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶æ—¶é—´) proxy_read_timeout:è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶æ—¶é—´) proxy_connect_timeout:nginxè¿æ¥åç«¯çš„è¶…æ—¶æ—¶é—´ï¼Œä¸€èˆ¬ä¸è¶…è¿‡75s demo: location / &#123; proxy_pass http://app-proxy; proxy_next_upstream error timeout http_500 http_502 http_503 http_504; proxy_next_upstream_tries 3; proxy_connect_timeout 60s; proxy_read_timeout 60s; proxy_send_timeout 60s; proxy_pass_request_headers on; proxy_set_header Host $host:$server_port; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#125; å»ºè®®è‡ªå·±åŠ¨æ‰‹ä½¿ç”¨è¿™äº›å‚æ•°ï¼Œè¯•éªŒä¸€ä¸‹ï¼ŒåŠ æ·±å°è±¡å’Œç†è§£ã€‚","tags":["Nginx"],"categories":["Nginx"]},{"title":"Nginxå·¥ä½œæ¨¡å¼å’Œè¿›ç¨‹æ¨¡å‹","path":"/2019/12/20/Nginx3/","content":"å·¥ä½œæ¨¡å¼ Nginxå¯åŠ¨åï¼Œä¼šäº§ç”Ÿä¸€ä¸ªmasterä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ‰§è¡Œä¸€ç³»åˆ—çš„å·¥ä½œåä¼šäº§ç”Ÿä¸€ä¸ªæˆ–è€…å¤šä¸ªå·¥ä½œè¿›ç¨‹worker åœ¨å®¢æˆ·ç«¯è¯·æ±‚åŠ¨æ€ç«™ç‚¹çš„è¿‡ç¨‹ä¸­ï¼ŒNginxæœåŠ¡å™¨è¿˜æ¶‰åŠå’Œåç«¯æœåŠ¡å™¨çš„é€šä¿¡ã€‚Nginxå°†æ¥æ”¶åˆ°çš„Webè¯·æ±‚é€šè¿‡ä»£ç†è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼Œç”±åç«¯æœåŠ¡å™¨è¿›è¡Œæ•°æ®å¤„ç†å’Œç»„ç»‡; Nginxä¸ºäº†æé«˜å¯¹è¯·æ±‚çš„å“åº”æ•ˆç‡ï¼Œé™ä½ç½‘ç»œå‹åŠ›ï¼Œé‡‡ç”¨äº†ç¼“å­˜æœºåˆ¶ï¼Œå°†å†å²åº”ç­”æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°ã€‚ä¿éšœå¯¹ç¼“å­˜æ–‡ä»¶çš„å¿«é€Ÿè®¿é—® è¿›ç¨‹æ¨¡å‹nginxçš„è¿›ç¨‹æ¨¡å‹ï¼Œå¯ä»¥ç”±ä¸‹å›¾æ¥è¡¨ç¤ºï¼š masterè¿›ç¨‹ä¸»è¦ç”¨æ¥ç®¡ç† worker è¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¼šæ¥æ”¶æ¥è‡ªå¤–ç•Œå‘æ¥çš„ä¿¡å·ï¼Œå†æ ¹æ®ä¿¡å·åšä¸åŒçš„äº‹æƒ…ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ§åˆ¶nginxï¼Œåªéœ€è¦é€šè¿‡killå‘masterè¿›ç¨‹å‘é€ä¿¡å·å°±è¡Œäº†ã€‚ å…·ä½“åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦åŠŸèƒ½: æ¥æ”¶æ¥è‡ªå¤–ç•Œçš„ä¿¡å· å‘å„workerè¿›ç¨‹å‘é€ä¿¡å· ç›‘æ§workerè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“workerè¿›ç¨‹é€€å‡ºå(å¼‚å¸¸æƒ…å†µä¸‹)ï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„workerè¿›ç¨‹ é‡å¯è¯´æ˜ï¼ˆç¤ºä¾‹ï¼‰æ¯”å¦‚kill -HUP pidï¼Œåˆ™æ˜¯å‘Šè¯‰nginxï¼Œé‡å¯nginxï¼Œæ—©æœŸç‰ˆæœ¬å¯ä»¥ç”¨è¿™ä¸ªä¿¡å·æ¥é‡å¯nginxï¼Œå› ä¸ºæ˜¯ä»å®¹åœ°é‡å¯ï¼Œå› æ­¤æœåŠ¡æ˜¯ä¸ä¸­æ–­çš„ã€‚ï¼ˆç°åœ¨ä¸€èˆ¬ä½¿ç”¨nginx -s reloadï¼‰ masterè¿›ç¨‹åœ¨æ¥æ”¶åˆ°HUPä¿¡å·åï¼Œä¼šå…ˆé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç„¶åå†å¯åŠ¨æ–°çš„workerè¿›ç¨‹ï¼Œå¹¶å‘æ‰€æœ‰è€çš„workerè¿›ç¨‹å‘é€ä¿¡å·ï¼Œå‘Šè¯‰ä»–ä»¬å¯ä»¥å…‰è£é€€ä¼‘äº†ã€‚æ–°çš„workeråœ¨å¯åŠ¨åï¼Œå°±å¼€å§‹æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œè€Œè€çš„workeråœ¨æ”¶åˆ°æ¥è‡ªmasterçš„ä¿¡å·åï¼Œå°±ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œå¹¶ä¸”åœ¨å½“å‰è¿›ç¨‹ä¸­çš„æ‰€æœ‰æœªå¤„ç†å®Œçš„è¯·æ±‚å¤„ç†å®Œæˆåï¼Œå†é€€å‡ºã€‚ ï¼ˆmasterä¸éœ€è¦å¤„ç†ç½‘ç»œäº‹ä»¶ï¼Œä¸è´Ÿè´£ä¸šåŠ¡çš„æ‰§è¡Œï¼‰ workerè¿›ç¨‹ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆå…·ä½“çš„ä»»åŠ¡é€»è¾‘ã€‚å…¶ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä¸å®¢æˆ·ç«¯æˆ–åç«¯çœŸå®æœåŠ¡å™¨(æ­¤æ—¶ worker ä½œä¸ºä¸­é—´ä»£ç†)ä¹‹é—´çš„æ•°æ®å¯è¯»/å¯å†™ç­‰I/Oäº¤äº’äº‹ä»¶ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦åŠŸèƒ½: æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚; å°†è¯·æ±‚ä¸€æ¬¡é€å…¥å„ä¸ªåŠŸèƒ½æ¨¡å—è¿›è¡Œè¿‡æ»¤å¤„ç†; ä¸åç«¯æœåŠ¡å™¨é€šä¿¡ï¼Œæ¥æ”¶åç«¯æœåŠ¡å™¨å¤„ç†ç»“æœ; æ•°æ®ç¼“å­˜proxy_cacheæ¨¡å— å“åº”å®¢æˆ·ç«¯è¯·æ±‚ ï¼ˆä¸€ä¸ªè¯·æ±‚ï¼Œå®Œå…¨ç”±workerè¿›ç¨‹æ¥å¤„ç†ï¼Œè€Œä¸”åªåœ¨ä¸€ä¸ªworkerè¿›ç¨‹ä¸­å¤„ç†ã€‚ï¼‰ workerè¿›ç¨‹æ˜¯å¦‚ä½•å¤„ç†è¯·æ±‚çš„ï¼Ÿé¦–å…ˆï¼Œworkerè¿›ç¨‹ä¹‹é—´æ˜¯å¹³ç­‰çš„ï¼Œæ¯ä¸ªworkerè¿›ç¨‹éƒ½æ˜¯ä»masterè¿›ç¨‹forkè¿‡æ¥ï¼Œåœ¨masterè¿›ç¨‹é‡Œé¢ï¼Œå…ˆå»ºç«‹å¥½éœ€è¦listençš„socketï¼ˆlistenfdï¼‰ä¹‹åï¼Œç„¶åå†forkå‡ºå¤šä¸ªworkerè¿›ç¨‹ã€‚æ¯ä¸ªworkerè¿›ç¨‹ï¼Œå¤„ç†è¯·æ±‚çš„æœºä¼šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å½“ä¸€ä¸ªè¿æ¥è¯·æ±‚è¿‡æ¥ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å¯èƒ½å¤„ç†è¿™ä¸ªè¿æ¥ï¼Œæ€ä¹ˆåšçš„å‘¢ï¼Ÿ æ‰€æœ‰workerè¿›ç¨‹çš„listenfdä¼šåœ¨æ–°è¿æ¥åˆ°æ¥æ—¶å˜å¾—å¯è¯»ï¼Œä¸ºä¿è¯åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„ç†è¯¥è¿æ¥ï¼Œæ‰€æœ‰workerè¿›ç¨‹åœ¨æ³¨å†Œlistenfdè¯»äº‹ä»¶å‰æŠ¢accept_mutexï¼ŒæŠ¢åˆ°äº’æ–¥é”çš„é‚£ä¸ªworkerè¿›ç¨‹æ³¨å†Œlistenfdè¯»äº‹ä»¶ï¼Œåœ¨è¯»äº‹ä»¶é‡Œè°ƒç”¨acceptæ¥å—è¯¥è¿æ¥ã€‚ å½“ä¸€ä¸ªworkerè¿›ç¨‹åœ¨acceptè¿™ä¸ªè¿æ¥ä¹‹åï¼Œå°±å¼€å§‹è¯»å–è¯·æ±‚ï¼Œè§£æè¯·æ±‚ï¼Œå¤„ç†è¯·æ±‚ï¼Œäº§ç”Ÿæ•°æ®åï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ€åæ–­å¼€è¿æ¥ï¼Œè¿™æ ·å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚å°±æ˜¯è¿™æ ·çš„äº†ã€‚ æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå®Œå…¨ç”±workerè¿›ç¨‹æ¥å¤„ç†ï¼Œä¸”åªåœ¨ä¸€ä¸ªworkerè¿›ç¨‹ä¸­å¤„ç†ã€‚ Nginxé‡‡ç”¨çš„IOå¤šè·¯å¤ç”¨æ¨¡å‹ IOå¤šè·¯å¤ç”¨æ˜¯æŒ‡å†…æ ¸ä¸€æ—¦å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªIOæ¡ä»¶å‡†å¤‡è¯»å–ï¼Œå®ƒå°±é€šçŸ¥è¯¥è¿›ç¨‹ï¼Œç›®å‰æ”¯æŒI/Oå¤šè·¯å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨æœ‰ select ï¼Œ poll ï¼Œ epoll ï¼ŒI/Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦(socket)ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ª(ä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ª)ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯» å†™æ“ä½œã€‚ selectåŸºæœ¬åŸç†select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚ ä¼˜ç‚¹ ç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒ ç¼ºç‚¹ selectæœ¬è´¨ä¸Šæ˜¯é€šè¿‡è®¾ç½®æˆ–è€…æ£€æŸ¥å­˜æ”¾fdæ ‡å¿—ä½çš„æ•°æ®ç»“æ„æ¥è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚è¿™æ ·æ‰€å¸¦æ¥çš„ç¼ºç‚¹æ˜¯ï¼š selectæœ€å¤§çš„ç¼ºé™·å°±æ˜¯å•ä¸ªè¿›ç¨‹æ‰€æ‰“å¼€çš„FDæ˜¯æœ‰ä¸€å®šé™åˆ¶çš„ï¼Œå®ƒç”±FD_SETSIZEè®¾ç½®ï¼Œé»˜è®¤å€¼æ˜¯1024ã€‚ï¼ˆä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ•°ç›®å’Œç³»ç»Ÿå†…å­˜å…³ç³»å¾ˆå¤§ï¼Œå…·ä½“æ•°ç›®å¯ä»¥cat /proc/sys/fs/file-maxæŸ¥çœ‹ã€‚32ä½æœºé»˜è®¤æ˜¯1024ä¸ªã€‚64ä½æœºé»˜è®¤æ˜¯2048ï¼‰ å¯¹socketè¿›è¡Œæ‰«ææ—¶æ˜¯çº¿æ€§æ‰«æï¼Œå³é‡‡ç”¨è½®è¯¢çš„æ–¹æ³•ï¼Œæ•ˆç‡è¾ƒä½ã€‚ï¼ˆå½“å¥—æ¥å­—æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ¯æ¬¡select()éƒ½è¦é€šè¿‡éå†FD_SETSIZEä¸ªSocketæ¥å®Œæˆè°ƒåº¦ï¼Œä¸ç®¡å“ªä¸ªSocketæ˜¯æ´»è·ƒçš„ï¼Œéƒ½éå†ä¸€éã€‚è¿™ä¼šæµªè´¹å¾ˆå¤šCPUæ—¶é—´ã€‚å¦‚æœèƒ½ç»™å¥—æ¥å­—æ³¨å†ŒæŸä¸ªå›è°ƒå‡½æ•°ï¼Œå½“ä»–ä»¬æ´»è·ƒæ—¶ï¼Œè‡ªåŠ¨å®Œæˆç›¸å…³æ“ä½œï¼Œé‚£å°±é¿å…äº†è½®è¯¢ï¼Œè¿™æ­£æ˜¯epollä¸kqueueåšçš„ï¼‰ éœ€è¦ç»´æŠ¤ä¸€ä¸ªç”¨æ¥å­˜æ”¾å¤§é‡fdçš„æ•°æ®ç»“æ„ï¼Œè¿™æ ·ä¼šä½¿å¾—ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´åœ¨ä¼ é€’è¯¥ç»“æ„æ—¶å¤åˆ¶å¼€é”€å¤§ã€‚ pollåŸºæœ¬åŸç†pollæœ¬è´¨ä¸Šå’Œselectæ²¡æœ‰åŒºåˆ«ï¼Œå®ƒå°†ç”¨æˆ·ä¼ å…¥çš„æ•°ç»„æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶åæŸ¥è¯¢æ¯ä¸ªfdå¯¹åº”çš„è®¾å¤‡çŠ¶æ€ï¼Œå¦‚æœè®¾å¤‡å°±ç»ªåˆ™åœ¨è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€é¡¹å¹¶ç»§ç»­éå†ï¼Œå¦‚æœéå†å®Œæ‰€æœ‰fdåæ²¡æœ‰å‘ç°å°±ç»ªè®¾å¤‡ï¼Œåˆ™æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªæˆ–è€…ä¸»åŠ¨è¶…æ—¶ï¼Œè¢«å”¤é†’åå®ƒåˆè¦å†æ¬¡éå†fdã€‚è¿™ä¸ªè¿‡ç¨‹ç»å†äº†å¤šæ¬¡æ— è°“çš„éå†ã€‚ ä¼˜ç‚¹ å®ƒæ²¡æœ‰æœ€å¤§è¿æ¥æ•°çš„é™åˆ¶ï¼ŒåŸå› æ˜¯å®ƒæ˜¯åŸºäºé“¾è¡¨æ¥å­˜å‚¨çš„ã€‚ ç¼ºç‚¹ å¤§é‡çš„fdçš„æ•°ç»„è¢«æ•´ä½“å¤åˆ¶äºç”¨æˆ·æ€å’Œå†…æ ¸åœ°å€ç©ºé—´ä¹‹é—´ï¼Œè€Œä¸ç®¡è¿™æ ·çš„å¤åˆ¶æ˜¯ä¸æ˜¯æœ‰æ„ä¹‰ã€‚ pollè¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯â€œæ°´å¹³è§¦å‘â€ï¼Œå¦‚æœæŠ¥å‘Šäº†fdåï¼Œæ²¡æœ‰è¢«å¤„ç†ï¼Œé‚£ä¹ˆä¸‹æ¬¡pollæ—¶ä¼šå†æ¬¡æŠ¥å‘Šè¯¥fdã€‚ æ³¨æ„ï¼šä»ä¸Šé¢çœ‹ï¼Œselectå’Œpolléƒ½éœ€è¦åœ¨è¿”å›åï¼Œé€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²ç»å°±ç»ªçš„socketã€‚äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™ã€‚ epollepollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpollçš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äºselectå’Œpollæ¥è¯´ï¼Œepollæ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€ä¸€æ¬¡ã€‚ åŸºæœ¬åŸç†epollæ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºè¾¹ç¼˜è§¦å‘ï¼Œå®ƒåªå‘Šè¯‰è¿›ç¨‹å“ªäº›fdåˆšåˆšå˜ä¸ºå°±ç»ªæ€ï¼Œå¹¶ä¸”åªä¼šé€šçŸ¥ä¸€æ¬¡ã€‚è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œepollä½¿ç”¨â€œäº‹ä»¶â€çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡epoll_ctlæ³¨å†Œfdï¼Œä¸€æ—¦è¯¥fdå°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥fdï¼Œepoll_waitä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥ã€‚ epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼LTï¼ˆlevel triggerï¼‰å’ŒETï¼ˆedge triggerï¼‰ã€‚LTæ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼Œä¸¤è€…åŒºåˆ«å¦‚ä¸‹ï¼š LTæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚ ETæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚ ä¼˜ç‚¹ æ²¡æœ‰æœ€å¤§å¹¶å‘è¿æ¥çš„é™åˆ¶ï¼Œèƒ½æ‰“å¼€çš„FDçš„ä¸Šé™è¿œå¤§äº1024ï¼ˆ1Gçš„å†…å­˜ä¸Šèƒ½ç›‘å¬çº¦10ä¸‡ä¸ªç«¯å£ï¼‰ã€‚ æ•ˆç‡æå‡ï¼Œä¸æ˜¯è½®è¯¢çš„æ–¹å¼ï¼Œä¸ä¼šéšç€FDæ•°ç›®çš„å¢åŠ æ•ˆç‡ä¸‹é™ã€‚ åªæœ‰æ´»è·ƒå¯ç”¨çš„FDæ‰ä¼šè°ƒç”¨callbackå‡½æ•°ï¼›å³Epollæœ€å¤§çš„ä¼˜ç‚¹å°±åœ¨äºå®ƒåªç®¡ä½ â€œæ´»è·ƒâ€çš„è¿æ¥ï¼Œè€Œè·Ÿè¿æ¥æ€»æ•°æ— å…³ï¼Œå› æ­¤åœ¨å®é™…çš„ç½‘ç»œç¯å¢ƒä¸­ï¼ŒEpollçš„æ•ˆç‡å°±ä¼šè¿œè¿œé«˜äºselectå’Œpollã€‚ å†…å­˜æ‹·è´ï¼Œåˆ©ç”¨mmap()æ–‡ä»¶æ˜ å°„å†…å­˜åŠ é€Ÿä¸å†…æ ¸ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ï¼›å³epollä½¿ç”¨mmapå‡å°‘å¤åˆ¶å¼€é”€ã€‚ kqueuekqueueä¸epolléå¸¸ç›¸ä¼¼ï¼Œæœ€åˆæ˜¯2000å¹´Jonathan Lemonåœ¨FreeBSDç³»ç»Ÿä¸Šå¼€å‘çš„ä¸€ä¸ªé«˜æ€§èƒ½çš„äº‹ä»¶é€šçŸ¥æ¥å£ã€‚æ³¨å†Œä¸€æ‰¹socketæè¿°ç¬¦åˆ° kqueue ä»¥åï¼Œå½“å…¶ä¸­çš„æè¿°ç¬¦çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œkqueue å°†ä¸€æ¬¡æ€§é€šçŸ¥åº”ç”¨ç¨‹åºå“ªäº›æè¿°ç¬¦å¯è¯»ã€å¯å†™æˆ–å‡ºé”™äº†ã€‚åªæ˜¯é€‚åº”å¹³å°ä¸å¤šã€‚ å‚è€ƒï¼š ç½‘ç»œé€šä¿¡ â€“&gt; IOå¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£ nginxå¹³å°åˆæ¢ è¿™åº”è¯¥æ˜¯Nginxç³»åˆ—æœ€åä¸€ç¯‡æ–‡ç« äº†ï¼Œå¦‚æœä½ æœ‰ç–‘é—®ï¼Œæ¬¢è¿äº¤æµï¼Œæ°´å¹³æœ‰é™ï¼Œé”™è¯¯æ¬¢è¿æŒ‡æ­£ã€‚ æŠ€æœ¯æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€çˆ±å¥½å†å²çš„ç¨‹åºå‘˜ã€‘ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨ï¼Œè°¢è°¢ï¼","tags":["Nginx"],"categories":["Nginx"]},{"title":"gRPCåˆä½“éªŒ","path":"/2019/12/20/215/","content":"gRPCæ˜¯å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­è¿è¡Œçš„ç°ä»£å¼€æºé«˜æ€§èƒ½RPCæ¡†æ¶ã€‚å®ƒå¯ä»¥é€šè¿‡å¯æ’æ‹”çš„æ”¯æŒæ¥æœ‰æ•ˆåœ°è¿æ¥æ•°æ®ä¸­å¿ƒå†…å’Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ï¼Œä»¥å®ç°è´Ÿè½½å¹³è¡¡ï¼Œè·Ÿè¸ªï¼Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œèº«ä»½éªŒè¯ã€‚å®ƒä¹Ÿé€‚ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„æœ€åä¸€è‹±é‡Œï¼Œä»¥å°†è®¾å¤‡ï¼Œç§»åŠ¨åº”ç”¨ç¨‹åºå’Œæµè§ˆå™¨è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚ å®‰è£…protocol buffer ç¼–è¯‘å™¨macï¼š brew install protobuf å…¶ä»–ç³»ç»Ÿå¯ä»¥å°è¯•ç¼–è¯‘å®‰è£… protocolbuffers/protobuf å®‰è£…gprcgo get -u google.golang.org/grpc å®‰è£…protoc-gen-goæ’ä»¶go get -u github.com/golang/protobuf/protoc-gen-go ä½¿ç”¨æ–°å»ºhelloç›®å½•ï¼Œè¿›å…¥åæ‰§è¡Œï¼š protoc --proto_path hello/ --go_out=plugins=grpc:hello hello.proto ä¼šçœ‹åˆ°helloç›®å½•ä¸‹ç”Ÿæˆäº†hello.pb.goæ–‡ä»¶ã€‚ å½“ç„¶ï¼Œå…¶ä¸­çš„ hello.proto æ˜¯é¢„å…ˆè‡ªå®šä¹‰åœ¨helloæ–‡ä»¶å¤¹ä¸‹çš„ï¼Œå¦‚ï¼š syntax = &quot;proto3&quot;; //è¯­æ³•å£°æ˜package hello; //åŒ…å// å®šä¹‰æœåŠ¡service Greeter &#123; rpc SayHello (HelloRequest) returns (HelloReply) &#123;&#125;&#125;// è¯·æ±‚æ•°æ®æ ¼å¼message HelloRequest &#123; string name = 1;&#125;// å“åº”æ•°æ®æ ¼å¼message HelloReply &#123; string message = 1;&#125; serveræ–°å»ºserverç›®å½•ï¼Œgolangä¾‹å­ä»£ç æ¥è‡ªï¼šhttps://github.com/grpc/grpc-go/tree/master/examples/helloworld // main.gopackage mainimport (\t&quot;context&quot;\t&quot;log&quot;\t&quot;net&quot;\t&quot;google.golang.org/grpc&quot;\tpb &quot;local.com/sai/game/grpc/hello&quot;)const (\tport = &quot;:50051&quot;)// server is used to implement helloworld.GreeterServer.type server struct &#123;\tpb.UnimplementedGreeterServer&#125;// SayHello implements helloworld.GreeterServerfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) &#123;\tlog.Printf(&quot;Received: %v&quot;, in.GetName())\treturn &amp;pb.HelloReply&#123;Message: &quot;Hello &quot; + in.GetName()&#125;, nil&#125;func main() &#123;\tlis, err := net.Listen(&quot;tcp&quot;, port)\tif err != nil &#123; log.Fatalf(&quot;failed to listen: %v&quot;, err)\t&#125;\ts := grpc.NewServer()\tpb.RegisterGreeterServer(s, &amp;server&#123;&#125;)\tif err := s.Serve(lis); err != nil &#123; log.Fatalf(&quot;failed to serve: %v&quot;, err)\t&#125;&#125; clientgo client// client.gopackage mainimport (\t&quot;context&quot;\t&quot;log&quot;\t&quot;os&quot;\t&quot;time&quot;\t&quot;google.golang.org/grpc&quot;\tpb &quot;local.com/sai/game/grpc/hello&quot;)const (\taddress = &quot;127.0.0.1:50051&quot;\tdefaultName = &quot;puresai&quot;)func main() &#123;\t// Set up a connection to the server.\tconn, err := grpc.Dial(address, grpc.WithInsecure(), grpc.WithBlock())\tif err != nil &#123; log.Fatalf(&quot;did not connect: %v&quot;, err)\t&#125;\tdefer conn.Close()\tc := pb.NewGreeterClient(conn)\t// Contact the server and print out its response.\tname := defaultName\tif len(os.Args) &gt; 1 &#123; name = os.Args[1]\t&#125;\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\tdefer cancel()\tr, err := c.SayHello(ctx, &amp;pb.HelloRequest&#123;Name: name&#125;)\tif err != nil &#123; log.Fatalf(&quot;could not greet: %v&quot;, err)\t&#125;\tlog.Printf(&quot;Greeting: %s&quot;, r.GetMessage())&#125;` php clientæ‰©å±•å®‰è£… grpcæ‰©å±•ä¸‹è½½ profo ä¸‹è½½å®‰è£…åˆé€‚ç‰ˆæœ¬çš„æ‰©å±•å³å¯ï¼Œè®°å¾—åˆ«å¿˜è®°åœ¨php.iniä¸­åŠ å…¥ï¼š extension=grpc.soextension=protobuf.so è‡ªåŠ¨ç”Ÿæˆä»£ç protoc --php_out=client hello/hello.proto ä¼šçœ‹åˆ°clientç›®å½•ä¸‹ç”Ÿæˆäº†GPBMetadataå’ŒHelloä¸¤ä¸ªç›®å½•ã€‚ å¦‚æœä½ å¯¹grpcç›¸å¯¹è¾ƒç†Ÿç»ƒï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä»£ç ç¼–å†™ï¼š &lt;?phprequire __DIR__ . &#x27;/vendor/autoload.php&#x27;;class Client extends \\Grpc\\BaseStub&#123; public function __construct($hostname, $opts, $channel = null) &#123; parent::__construct($hostname, $opts, $channel); &#125; /** * rpc SayHello(HelloRequest) returns (HelloReply) &#123;&#125; * æ–¹æ³•åå°½é‡å’Œ (gprc å®šä¹‰ Greeter æœåŠ¡)çš„æ–¹æ³•ä¸€æ · * ç”¨äºè¯·æ±‚å’Œå“åº”è¯¥æœåŠ¡ */ public function SayHello(\\Hello\\HelloRequest $argument)&#123; // (/hello.Greeter/SayHello) æ˜¯è¯·æ±‚æœåŠ¡ç«¯é‚£ä¸ªæœåŠ¡å’Œæ–¹æ³•ï¼ŒåŸºæœ¬å’Œ proto æ–‡ä»¶å®šä¹‰ä¸€æ · return $this-&gt;_simpleRequest(&#x27;/hello.Greeter/SayHello&#x27;, $argument, [&#x27;\\Hello\\HelloReply&#x27;, &#x27;decode&#x27;] ); &#125;&#125;//ç”¨äºè¿æ¥ æœåŠ¡ç«¯$client = new \\Client(&#x27;127.0.0.1:50051&#x27;, [ &#x27;credentials&#x27; =&gt; Grpc\\ChannelCredentials::createInsecure()]);//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»$request = new \\Hello\\HelloRequest();$request-&gt;setName(&quot;fairy&quot;);//è°ƒç”¨è¿œç¨‹æœåŠ¡$get = $client-&gt;SayHello($request)-&gt;wait();//è¿”å›æ•°ç»„//$reply æ˜¯ TestReply å¯¹è±¡//$status æ˜¯æ•°ç»„list($reply, $status) = $get;echo $reply-&gt;getMessage().PHP_EOL;// print_r($client-&gt;SayHello($request)); å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨grpc_php_pluginæ’ä»¶ç”Ÿæˆã€‚ grpc-php grpc_php_pluginæ’ä»¶cloneå¤ªæ…¢å¯ä»¥ä½¿ç”¨ç äº‘ git clone -b $(curl -L https://grpc.io/release) https://github.com/grpc/grpccd grpc#è¿™ä¸€æ­¥å¾ˆæ…¢ï¼Œæš‚æœªæ‰¾åˆ°ä»€ä¹ˆå¥½æ–¹æ³•git submodule update --initmake grpc_php_plugin æ–°å»ºphp-clientï¼Œå†æ¥è‡ªåŠ¨ç”Ÿæˆï¼š protoc -I=./hello hello.proto --php_out=./php-client/ --grpc_out=php-client/ --plugin=protoc-gen-grpc=/Users/wangzetao/www/grpc1/bins/opt/grpc_php_plugin ä¼šå‘ç°æ¯”ä¸Šé¢è‡ªåŠ¨ç”Ÿæˆå¤šäº†ä¸€ä¸ªGreeterClient.php &lt;?php// client.phprequire __DIR__ . &#x27;/vendor/autoload.php&#x27;;//ç”¨äºè¿æ¥ æœåŠ¡ç«¯$client = new \\Hello\\GreeterClient(&#x27;127.0.0.1:50051&#x27;, [ &#x27;credentials&#x27; =&gt; Grpc\\ChannelCredentials::createInsecure()]);//å®ä¾‹åŒ– TestRequest è¯·æ±‚ç±»$request = new \\Hello\\HelloRequest();$request-&gt;setName(&quot;world&quot;);//è°ƒç”¨è¿œç¨‹æœåŠ¡$get = $client-&gt;SayHello($request)-&gt;wait();//è¿”å›æ•°ç»„//$status æ˜¯æ•°ç»„list($reply, $status) = $get;echo $reply-&gt;getMessage().PHP_EOL;// print_r($client-&gt;SayHello($request)); è¿è¡Œæµ‹è¯• go run grpc/server/main.go go run grpc/client/main.go go run grpc/client/client.php go run grpc/client/php-client.php grpcåˆä½“éªŒå®Œæˆäº†ï¼Œæœ¬æ¬¡åªæ˜¯å°å°çš„ä½¿ç”¨äº†ä¸€ä¸‹å­ï¼Œåç»­æ„Ÿå…´è¶£çš„è¯å¯ä»¥æ·±å…¥å­¦ä¹ ä¸€ä¸‹ã€‚æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºäº¤æµã€‚ æŠ€æœ¯æ–‡ç« ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€çˆ±å¥½å†å²çš„ç¨‹åºå‘˜ã€‘ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨ï¼Œè°¢è°¢ï¼","tags":["gRPC"],"categories":["go"]},{"title":"dockerå®‰è£…gogs","path":"/2019/12/08/214/","content":"docker pull gogs/gogs docker run -itd â€“name=gogs1 -p 10022:22 -p 10023:3000 gogs/gogs æµè§ˆå™¨è¾“å…¥http://127.0.0.1:10023/ ä¸»è¦ä¿®æ”¹çš„å‚æ•°æ˜¯ åº”ç”¨ URL æ•°æ®åº“ç”¨æˆ·å¯†ç  ç®¡ç†å‘˜ä¿¡æ¯ å¦‚æœä½ æœ‰å…¶ä»–ä¿®æ”¹ï¼Œè‡ªè¡Œä¿®æ”¹å³å¯ã€‚ ç‚¹å‡»ç«‹å³å®‰è£…æŒ‰é’®ï¼ŒæŒ‰ç†è¯´ä¼šè·³åˆ°3000ç«¯å£åœ°å€ï¼Œä½ æ¢æˆ10023å°±å¥½äº†ã€‚ ç„¶åä½ å°±å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼Œå¼€å§‹gogsä¹‹æ—…äº†ã€‚ å¦å¤–ï¼Œé…ç½®æ–‡ä»¶åœ¨å®¹å™¨çš„/data/gogs/conf/app.iniã€‚ è¯¦ç»†é…ç½®æ–‡ä»¶æ‰‹å†Œï¼ˆæ¥è‡ªgithubï¼‰æ¦‚è§ˆ åç§° æè¿° APP_NAME åº”ç”¨åç§°ï¼Œå¯ä»¥æ”¹æˆæ‚¨çš„ç»„ç»‡æˆ–å…¬å¸åç§° RUN_USER è¿è¡Œåº”ç”¨çš„ç”¨æˆ·åç§°ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ gitï¼Œä½†å¦‚æœæ‚¨åœ¨ä¸ªäººè®¡ç®—æœºä¸Šè¿è¡Œ Gogsï¼Œè¯·ä¿®æ”¹ä¸ºæ‚¨çš„ç³»ç»Ÿç”¨æˆ·åç§°ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®è®¾ç½®è¿™ä¸ªå€¼ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æ‚¨çš„åº”ç”¨å´©æºƒ RUN_MODE é‰´äºæ€§èƒ½å’Œå…¶å®ƒè€ƒè™‘ï¼Œå»ºè®®åœ¨éƒ¨ç½²ç¯å¢ƒä¸‹ä¿®æ”¹ä¸º prod æ¨¡å¼ã€‚åœ¨æ‚¨å®Œæˆå®‰è£…æ“ä½œæ—¶ï¼Œè¯¥å€¼ä¹Ÿä¼šè¢«è®¾ç½®ä¸º prod æœåŠ¡å™¨ (server) åç§° æè¿° PROTOCOL http æˆ– https DOMAIN æœåŠ¡å™¨åŸŸå ROOT_URL å…¬å¼€çš„å®Œæ•´ URL è·¯å¾„ HTTP_ADDR åº”ç”¨ HTTP ç›‘å¬åœ°å€ HTTP_PORT åº”ç”¨ HTTP ç›‘å¬ç«¯å£å· UNIX_SOCKET_PERMISSION Unix å¥—æ¥å­—æ–‡ä»¶çš„æƒé™ LOCAL_ROOT_URL ç”¨äº Gogs å·¥ä½œè¿›ç¨‹ï¼ˆå¦‚ï¼šSSHï¼‰å›è®¿åº”ç”¨çš„æœ¬åœ°ï¼ˆDMZï¼‰URLï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯·ä¿æŒé»˜è®¤å€¼ï¼Œé™¤éæ‚¨çš„ SSH æœåŠ¡å™¨èŠ‚ç‚¹ä¸ HTTP å¹¶ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹å…¥å£ DISABLE_SSH å½“ SSH åŠŸèƒ½ä¸å¯ç”¨æ—¶å¯ä»¥ç¦ç”¨ START_SSH_SERVER å¯ç”¨è¯¥é€‰é¡¹æ¥å¯åŠ¨å†…ç½® SSH æœåŠ¡å™¨ SSH_DOMAIN å…è®¸å…¬ç”¨ç½‘ç»œè®¿é—® SSH çš„åŸŸå SSH_PORT SSH ç«¯å£å·ï¼Œå¦‚æœä¸ä¸º 22 çš„è¯å¯ä»¥åœ¨æ­¤ä¿®æ”¹ SSH_LISTEN_HOST å†…ç½® SSH æœåŠ¡å™¨ç›‘å¬çš„åœ°å€ SSH_LISTEN_PORT å†…ç½® SSH æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£ SSH_ROOT_PATH SSH æ ¹ç›®å½•ï¼Œä¸€èˆ¬ä¸º ~/.sshï¼Œä½†å¿…é¡»å¡«å†™ä¸º /home/git/.ssh REWRITE_AUTHORIZED_KEYS_AT_START æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨é‡å†™ authorized_keys æ–‡ä»¶ï¼Œè¯¥é€‰é¡¹åœ¨ä½¿ç”¨å†…ç½® SSH æœåŠ¡å™¨æ—¶å°†ä¼šè¢«è‡ªåŠ¨ç¦ç”¨ SSH_KEY_TEST_PATH ç”¨äºæµ‹è¯• SSH å…¬é’¥çš„ä¸´æ—¶ç›®å½• SSH_KEYGEN_PATH ssh-keygen ç¨‹åºçš„è·¯å¾„ï¼Œé»˜è®¤ä¸º ssh-keygen å³é€šè¿‡ç³»ç»Ÿè·¯å¾„æŸ¥æ‰¾ MINIMUM_KEY_SIZE_CHECK æŒ‡å®šä¸åŒç±»å‹çš„å…¬é’¥çš„æœ€å°å¯†é’¥å¤§å° OFFLINE_MODE æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢ä» CDN è·å–é™æ€èµ„æºï¼ŒåŒæ—¶ Gravatar æœåŠ¡ä¹Ÿå°†è¢«è‡ªåŠ¨ç¦ç”¨ DISABLE_ROUTER_LOG æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢æ‰“å°è·¯ç”±æ—¥å¿— CERT_FILE HTTPS æˆæƒæ–‡ä»¶è·¯å¾„ KEY_FILE HTTPS çš„å¯†é’¥æ–‡ä»¶è·¯å¾„ STATIC_ROOT_PATH æ¨¡æ¿æ–‡ä»¶å’Œé™æ€æ–‡ä»¶çš„ä¸Šçº§ç›®å½•ï¼Œé»˜è®¤ä¸ºåº”ç”¨äºŒè¿›åˆ¶æ‰€åœ¨çš„ä½ç½® APP_DATA_PATH åº”ç”¨å†…éƒ¨æ•°æ®çš„å­˜æ”¾ç›®å½• ENABLE_GZIP æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨åº”ç”¨çº§åˆ« GZIP æ”¯æŒ LANDING_PAGE æœªç™»å½•ç”¨æˆ·çš„é»˜è®¤é¦–é¡µï¼Œå¯ä»¥æ˜¯ home æˆ– exploreï¼ˆæ¢ç´¢é¡µï¼‰ ä»“åº“ (repository) åç§° æè¿° ROOT ç”¨æˆ·ä»“åº“å­˜å‚¨æ ¹ç›®å½•ï¼Œå¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ä¸º ~/&lt;user name&gt;/gogs-repositories SCRIPT_TYPE ç³»ç»Ÿè„šæœ¬ç±»å‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å‡ä¸º bashï¼Œä½†æœ‰äº›ç”¨æˆ·ååº”åªèƒ½ä½¿ç”¨ sh ANSI_CHARSET å½“é‡åˆ°æ— æ³•è¯†åˆ«çš„å­—ç¬¦é›†æ—¶ä½¿ç”¨çš„é»˜è®¤å­—ç¬¦é›† FORCE_PRIVATE å¼ºåˆ¶è¦æ±‚æ‰€æœ‰æ–°å»ºçš„ä»“åº“éƒ½æ˜¯ç§æœ‰çš„ MAX_CREATION_LIMIT å…¨å±€é»˜è®¤çš„æ¯ä¸ªç”¨æˆ·å¯åˆ›å»ºåˆ›å»ºä»“åº“ä¸Šé™ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶ PREFERRED_LICENSES å»ºè®®ç”¨æˆ·é¦–é€‰çš„æˆæƒç±»å‹ DISABLE_HTTP_GIT æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢ç”¨æˆ·é€šè¿‡ HTTP å¯¹ Git ä»“åº“è¿›è¡Œäº¤äº’æ“ä½œï¼Œå³ç”¨æˆ·åªèƒ½é€šè¿‡ SSH æ“ä½œ ENABLE_LOCAL_PATH_MIGRATION æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨æœ¬åœ°è·¯å¾„è¿ç§»ä»“åº“åŠŸèƒ½ã€‚å¯åŠ¨åé»˜è®¤åªæœ‰ç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨ï¼Œæ™®é€šç”¨æˆ·å¿…é¡»ç»ç”±ç®¡ç†å‘˜æˆæƒ ENABLE_RAW_FILE_RENDER_MODE æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨åœ¨æŸ¥çœ‹åŸå§‹æ•°æ®æ—¶å¯¹é¡µé¢è¿›è¡ŒçœŸå®æ¸²æŸ“ï¼Œä¾‹å¦‚æ¸²æŸ“å®é™…çš„ HTML é¡µé¢ï¼Œæœ‰æ½œåœ¨å®‰å…¨éšæ‚£ ä»“åº“ - ç¼–è¾‘å™¨ (repository.editor) åç§° æè¿° LINE_WRAP_EXTENSIONS éœ€è¦æ˜¾ç¤ºä¸ºè¡ŒåŒ…è£…çš„æ–‡ä»¶ååç¼€ï¼Œé€šè¿‡é€—å·åˆ†éš”ã€‚å¦‚æœæ˜¯æ— åç¼€åçš„æ–‡ä»¶ï¼Œåˆ™å•ç‹¬æ”¾ç½®ä¸€ä¸ªé€—å·ï¼Œä¾‹å¦‚ï¼š.txt, ä»“åº“ - æ–‡ä»¶ä¸Šä¼  (repository.upload) åç§° æè¿° ENABLED æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨ä»“åº“æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ TEMP_PATH æ–‡ä»¶ä¸Šä¼ çš„ä¸´æ—¶å­˜æ”¾ç›®å½• ALLOWED_TYPES å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ï¼ˆä¾‹å¦‚ï¼šâ€image/jpeg|image/pngâ€ï¼‰ï¼Œç•™ç©ºè¡¨ç¤ºå…è®¸ä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶ FILE_MAX_SIZE å•ä¸ªä¸Šä¼ çš„æ–‡ä»¶çš„æœ€å¤§ä½“ç§¯ï¼Œä»¥ MB ä¸ºå•ä½ MAX_FILES å•æ¬¡åŒæ—¶ä¸Šä¼ çš„æœ€å¤šæ–‡ä»¶ä¸ªæ•° ç‰ˆæœ¬å‘å¸ƒ - é™„ä»¶ (release.attachment) åç§° æè¿° ENABLED æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨ç‰ˆæœ¬å‘å¸ƒé™„ä»¶åŠŸèƒ½ PATH å­˜æ”¾é™„ä»¶çš„è·¯å¾„ ALLOWED_TYPES å…è®¸ä¸Šä¼ çš„ MIME ç±»å‹ï¼Œä¾‹å¦‚ â€œimage/jpeg|image/pngâ€ï¼Œä½¿ç”¨ */* å…è®¸æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶ MAX_SIZE æœ€å¤§å…è®¸ä¸Šä¼ çš„é™„ä»¶ä½“ç§¯ï¼Œå•ä½ä¸º MBï¼Œä¾‹å¦‚ 32 MAX_FILES æœ€å¤§å…è®¸ä¸€æ¬¡æ€§ä¸Šä¼ çš„é™„ä»¶ä¸ªæ•°ï¼Œä¾‹å¦‚ 10 Markdown (markdown) åç§° æè¿° ENABLE_HARD_LINE_BREAK æŒ‡ç¤ºæ˜¯å¦å¯ç”¨ç¡¬æ€§æ¢è¡Œæ‰©å±• CUSTOM_URL_SCHEMES å…è®¸è¢«è§£æä¸ºé“¾æ¥çš„è‡ªå®šä¹‰ URL æ–¹æ¡ˆï¼Œä¾‹å¦‚ gitï¼ˆç”¨äº git://ï¼‰å’Œmagnetï¼ˆç”¨äº magnet://ï¼‰ FILE_EXTENSIONS éœ€è¦è¢«æ¸²æŸ“ä¸º Markdown æ ¼å¼çš„æ–‡ä»¶ååç¼€ï¼Œé€šè¿‡é€—å·åˆ†éš”ã€‚å¦‚æœæ˜¯æ— åç¼€åçš„æ–‡ä»¶ï¼Œåˆ™å•ç‹¬æ”¾ç½®ä¸€ä¸ªé€—å·ï¼Œä¾‹å¦‚ï¼š.markdown, Smartypants (smartypants) åç§° æè¿° ENABLED æŒ‡ç¤ºæ˜¯å¦å¯ç”¨ Smartypants æ‰©å±• HTTP (http) åç§° æè¿° ACCESS_CONTROL_ALLOW_ORIGIN å¤´ä¿¡æ¯ Access-Control-Allow-Origin çš„è‡ªå®šä¹‰å€¼ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå³ä¸å“åº”æ­¤å¤´ä¿¡æ¯ æ•°æ®åº“ (database) åç§° æè¿° DB_TYPE æ•°æ®åº“ç±»å‹ï¼Œå¯ä»¥æ˜¯ mysqlã€postgresã€mssql æˆ– sqlite3 HOST æ•°æ®åº“ä¸»æœºåœ°å€ä¸ç«¯å£ NAME æ•°æ®åº“åç§° USER æ•°æ®åº“ç”¨æˆ·å PASSWD æ•°æ®åº“ç”¨æˆ·å¯†ç  SSL_MODE ä»…é™ PostgreSQL ä½¿ç”¨ PATH ä»…é™ SQLite3 ä½¿ç”¨ï¼Œæ•°æ®åº“æ–‡ä»¶è·¯å¾„ åº”ç”¨ç®¡ç† (admin) åç§° æè¿° DISABLE_REGULAR_ORG_CREATION æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢æ™®é€šç”¨æˆ·ï¼ˆéç®¡ç†å‘˜ï¼‰åˆ›å»ºç»„ç»‡ å®‰å…¨ (security) åç§° æè¿° INSTALL_LOCK ç”¨äºæŒ‡ç¤ºæ˜¯å¦å…è®¸è®¿é—®å®‰è£…é¡µé¢ï¼ˆè¯¥é¡µé¢å¯ä»¥è®¾ç½®ç®¡ç†å‘˜å¸å·ï¼Œå› æ­¤è¯¥é€‰é¡¹éå¸¸é‡è¦ï¼‰ SECRET_KEY å…¨å±€çš„åŠ å¯†å¯†é’¥ï¼ŒåŠ¡å¿…ä¿®æ”¹è¯¥å€¼ä»¥ç¡®ä¿æ‚¨çš„æœåŠ¡å™¨å®‰å…¨ï¼ˆä¼šåœ¨æ¯æ¬¡å®‰è£…æ—¶è‡ªåŠ¨ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼‰ LOGIN_REMEMBER_DAYS è®°ä½ç™»å½•çš„å¤©æ•° COOKIE_USERNAME è®°å½•ç”¨æˆ·åçš„ Cookie åç§° COOKIE_REMEMBER_NAME è®°å½•ç”¨æˆ·è‡ªåŠ¨ç™»å½•ä¿¡æ¯çš„ Cookie åç§° REVERSE_PROXY_AUTHENTICATION_USER åå‘ä»£ç†è®¤è¯ç”¨æˆ·çš„ Header å­—æ®µå æœåŠ¡ (service) åç§° æè¿° ACTIVE_CODE_LIVE_MINUTES æ¿€æ´»ç çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºåˆ†é’Ÿ RESET_PASSWD_CODE_LIVE_MINUTES é‡ç½®å¯†ç çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºåˆ†é’Ÿ REGISTER_EMAIL_CONFIRM æ¿€æ´»è¯¥é€‰é¡¹æ¥è¦æ±‚æ³¨å†Œç”¨æˆ·å¿…é¡»éªŒè¯é‚®ç®±ï¼Œè¦æ±‚å·²å¯ç”¨ Mailer DISABLE_REGISTRATION æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼Œåªèƒ½ç”±ç®¡ç†å‘˜åˆ›å»ºå¸å· SHOW_REGISTRATION_BUTTON ç”¨äºæŒ‡ç¤ºæ˜¯å¦æ˜¾ç¤ºæ³¨å†ŒæŒ‰é’® REQUIRE_SIGNIN_VIEW æ¿€æ´»è¯¥é€‰é¡¹æ¥è¦æ±‚ç”¨æˆ·å¿…é¡»ç™»å½•æ‰èƒ½æµè§ˆä»»ä½•é¡µé¢ ENABLE_CACHE_AVATAR æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¼“å­˜ Gravatar çš„å¤´åƒ ENABLE_NOTIFY_MAIL æ¿€æ´»è¯¥é€‰é¡¹æ¥å‘é€é€šçŸ¥é‚®ä»¶ç»™å…³æ³¨è€…ï¼Œä¾‹å¦‚åˆ›å»º issue æ—¶ï¼Œè¦æ±‚å·²å¯ç”¨ Mailer ENABLE_REVERSE_PROXY_AUTHENTICATION æ¿€æ´»è¯¥é€‰é¡¹æ¥å¼€å¯åå‘ä»£ç†ç”¨æˆ·è®¤è¯ï¼Œè¯·ä» #165 äº†è§£æ›´å¤šä¿¡æ¯ ENABLE_REVERSE_PROXY_AUTO_REGISTRATION æ¿€æ´»è¯¥é€‰é¡¹æ¥å¼€å¯åå‘ä»£ç†ç”¨æˆ·è®¤è¯çš„è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½ DISABLE_MINIMUM_KEY_SIZE_CHECK æ¿€æ´»è¯¥é€‰é¡¹æ¥ç¦æ­¢æ£€æŸ¥å“åº”ç±»å‹çš„å¯†é’¥æœ€å°é•¿åº¦ ENABLE_CAPTCHA æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨ç”¨æˆ·æ³¨å†Œæ—¶è¦æ±‚è¾“å…¥éªŒè¯ç  Web é’©å­ (webhook) åç§° æè¿° TYPES å¯åŠ¨çš„ Web é’©å­ç±»å‹ï¼Œå¯ä»¥æ˜¯ gogsã€slackã€discordæˆ–dingtalk QUEUE_LENGTH Webé’©å­é˜Ÿåˆ—é•¿åº¦ï¼Œå¦‚æœå‘ç°éƒ¨åˆ†Webhookæœªèƒ½æˆåŠŸè§¦å‘ï¼Œå¯è€ƒè™‘å¢åŠ è¯¥å€¼ DELIVER_TIMEOUT å‘é€é€šçŸ¥çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ SKIP_TLS_VERIFY æŒ‡ç¤ºæ˜¯å¦å…è®¸å‘å…·æœ‰éä¿¡ä»»è¯ä¹¦çš„åœ°å€å‘é€é€šçŸ¥ PAGING_NUM Web é’©å­å†å²é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•° é‚®ä»¶ (mailer) åç§° æè¿° ENABLED å¯ç”¨è¯¥é€‰é¡¹ä»¥æ¿€æ´»é‚®ä»¶æœåŠ¡ SUBJECT_PREFIX é‚®ä»¶æ ‡é¢˜çš„å‰ç¼€ HOST SMTP ä¸»æœºåœ°å€ä¸ç«¯å£ DISABLE_HELO ç¦ç”¨ HELO æ“ä½œ HELO_HOSTNAME HELO æ“ä½œçš„è‡ªå®šä¹‰ä¸»æœºå SKIP_VERIFY ä¸éªŒè¯è‡ªç­¾å‘è¯ä¹¦çš„æœ‰æ•ˆæ€§ FROM é‚®ç®±çš„æ¥è‡ªåœ°å€ï¼Œéµå¾ª RFC 5322è§„èŒƒï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„é‚®ç®±åœ°å€æˆ–è€… &quot;åå­—&quot; &lt;email@example.com&gt; çš„å½¢å¼ USER é‚®ç®±ç”¨æˆ·å PASSWD é‚®ç®±å¯†ç  USE_PLAIN_TEXT ä½¿ç”¨ text/plain ä½œä¸ºé‚®ä»¶å†…å®¹æ ¼å¼ å¤‡æ³¨ï¼šGogs ä»…æ”¯æŒä½¿ç”¨ STARTTLS çš„ SMTP åè®® ç¼“å­˜ (cache) åç§° æè¿° ADAPTER ç¼“å­˜å¼•æ“é€‚é…å™¨ï¼Œå¯ä»¥ä¸º memoryã€Redis æˆ– memcacheã€‚å¦‚æœæ‚¨ä½¿ç”¨ Redis æˆ– memcacheï¼Œè¯·ç¡®ä¿ä½¿ç”¨ -tags é€‰é¡¹é‡æ–°æ„å»ºæ‰€æœ‰ä¾èµ–ï¼Œä¾‹å¦‚ï¼šgo build -tags=&#39;Redis&#39; INTERVAL ä»…é™å†…å­˜ç¼“å­˜ä½¿ç”¨ï¼ŒGC å‘¨æœŸï¼Œå•ä½ä¸ºç§’ HOST ä»…é™ Redis å’Œ memcache ä½¿ç”¨ï¼Œä¸»æœºåœ°å€å’Œç«¯å£å· - Redisï¼šnetwork=tcp,addr=127.0.0.1:6379,password=macaron,db=0,pool_size=100,idle_timeout=180 - Memacheï¼š127.0.0.1:9090;127.0.0.1:9091 ä¼šè¯ (session) åç§° æè¿° PROVIDER Session å¼•æ“æä¾›è€…ï¼Œå¯ä»¥æ˜¯ memoryã€fileã€Redis æˆ– mysql PROVIDER_CONFIG å¦‚æœæä¾›è€…ä¸º fileï¼Œåˆ™ä¸ºæ–‡ä»¶æ ¹ç›®å½•ï¼›å¦‚æœä¸ºå…¶å®ƒæä¾›è€…ï¼Œåˆ™ä¸ºä¸»æœºåœ°å€å’Œç«¯å£å· COOKIE_SECURE æ¿€æ´»è¯¥é€‰é¡¹ä»¥è¦æ±‚æ‰€æœ‰ session æ“ä½œå‡é€šè¿‡ HTTPS GC_INTERVAL_TIME GC å‘¨æœŸï¼Œå•ä½ä¸ºç§’ å›¾ç‰‡ (picture) åç§° æè¿° AVATAR_UPLOAD_PATH å­˜æ”¾ç”¨æˆ·ä¸Šä¼ å¤´åƒçš„ç›®å½• GRAVATAR_SOURCE å¯ä»¥æ˜¯ gravatarã€duoshuo æˆ–ä»»ä½• URLï¼Œä¾‹å¦‚ï¼šhttp://cn.gravatar.com/avatar/ DISABLE_GRAVATAR æ¿€æ´»è¯¥é€‰é¡¹æ¥ä»…ä½¿ç”¨æœ¬åœ°å¤´åƒ ENABLE_FEDERATED_AVATAR æ¿€æ´»è¯¥é€‰é¡¹æ¥å¯ç”¨ Federated å¤´åƒæœåŠ¡ï¼ˆhttp://www.libravatar.orgï¼‰ï¼Œå½“ Gravatar è¢«ç¦ç”¨æ—¶æ­¤é€‰é¡¹æ— æ³•ç”Ÿæ•ˆ é™„ä»¶ (attachment) åç§° æè¿° ENABLED æ¿€æ´»è¯¥é€‰é¡¹ä»¥å…è®¸ç”¨æˆ·ä¸Šä¼ é™„ä»¶ PATH å­˜æ”¾é™„ä»¶çš„è·¯å¾„ ALLOWED_TYPES å…è®¸ä¸Šä¼ çš„ MIME ç±»å‹ï¼Œä¾‹å¦‚ â€œimage/jpeg|image/pngâ€ï¼Œä½¿ç”¨ */* å…è®¸æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶ MAX_SIZE æœ€å¤§å…è®¸ä¸Šä¼ çš„é™„ä»¶ä½“ç§¯ï¼Œå•ä½ä¸º MBï¼Œä¾‹å¦‚ 4 MAX_FILES æœ€å¤§å…è®¸ä¸€æ¬¡æ€§ä¸Šä¼ çš„é™„ä»¶ä¸ªæ•°ï¼Œä¾‹å¦‚ 5 æ—¶é—´ (time) åç§° æè¿° FORMAT æŒ‡å®šæ—¥æœŸçš„è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤ä¸º RFC1123ï¼Œå…¶å®ƒå¯é€‰çš„æ ¼å¼ä¸º ANSICã€UnixDateã€RubyDateã€RFC822ã€RFC822Zã€RFC850ã€RFC1123ã€RFC1123Zã€RFC3339ã€RFC3339Nanoã€Kitchenã€Stampã€StampMilliã€StampMicro å’Œ StampNanoã€‚è®¿é—® http://golang.org/pkg/time/#pkg-constants æŸ¥çœ‹è¯¦æƒ… æ—¥å¿— (log) åç§° æè¿° ROOT_PATH æ—¥å¿—æ–‡ä»¶çš„æ ¹ç›®å½• MODE æ—¥å¿—è®°å½•æ¨¡å¼ï¼Œé»˜è®¤ä¸º consoleã€‚å¦‚æœæƒ³è¦å¼€å¯å¤šæ¨¡å¼ï¼Œè¯·ä½¿ç”¨é€—å·åˆ†å‰²ï¼Œä¾‹å¦‚ï¼š&quot;console, file&quot; LEVEL åŸºæœ¬æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ä¸º Trace æ—¥å¿— - æ§åˆ¶å° (log.console) åç§° æè¿° LEVEL æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼ æ—¥å¿— - æ–‡ä»¶ (log.file) åç§° æè¿° LEVEL æ–‡ä»¶æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼ LOG_ROTATE æ¿€æ´»è¯¥é€‰é¡¹ä»¥å¯ç”¨æ—¥å¿—æ–‡ä»¶è‡ªè½¬ DAILY_ROTATE æ¿€æ´»è¯¥é€‰é¡¹ä»¥è¿›è¡Œæ—¥å¸¸è‡ªè½¬ MAX_SIZE_SHIFT è‡ªè½¬éœ€è¦è¾¾åˆ°çš„æœ€å¤§æ–‡ä»¶ä½“ç§¯ï¼Œä½¿ç”¨ä½å·¦ç§»ï¼Œé»˜è®¤ä¸º 28 å³ 1 &lt;&lt; 28ï¼Œè¡¨ç¤º 256MB MAX_LINES è‡ªè½¬éœ€è¦è¾¾åˆ°çš„æœ€å¤§æ–‡ä»¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º 1000000 MAX_DAYS ä¿ç•™è‡ªè½¬æ–‡ä»¶çš„æœ€é•¿æœŸé™ï¼Œé»˜è®¤ä¸º 7 å¤©ååˆ é™¤ æ—¥å¿— - Slack (log.slack) åç§° æè¿° LEVEL Slack æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼ URL Slack Web é’©å­ URL æ—¥å¿— - Discord (log.discord) åç§° æè¿° LEVEL Discord æ—¥å¿—çº§åˆ«ï¼Œç•™ç©ºåˆ™ç»§æ‰¿çˆ¶å€¼ URL Discord Web é’©å­ URL USERNAME åœ¨ Web é’©å­ä¸­æ˜¾ç¤ºçš„ç”¨æˆ·å Cron (cron) åç§° æè¿° ENABLED æ¿€æ´»è¯¥é€‰é¡¹ä»¥å…è®¸å‘¨æœŸæ€§è¿è¡Œ Cron ä»»åŠ¡ RUN_AT_START æ¿€æ´»è¯¥é€‰é¡¹ä»¥å…è®¸åœ¨å¯åŠ¨æ—¶æ‰§è¡Œ Cron ä»»åŠ¡ Cron - æ›´æ–°é•œåƒ (cron.update_mirrors) åç§° æè¿° SCHEDULE å®šæ—¶æ›´æ–°ä»“åº“é•œåƒçš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š@every 1h Cron - ä»“åº“å¥åº·æ£€æŸ¥ (cron.repo_health_check) åç§° æè¿° SCHEDULE å®šæ—¶è¿›è¡Œä»“åº“å¥åº·æ£€æŸ¥çš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š@every 24h TIMEOUT ä»“åº“å¥åº·æ£€æŸ¥è¶…æ—¶çš„å®šä¹‰è¯­æ³•ï¼Œä¾‹å¦‚ï¼š60s ARGS git fsck å‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š--unreachable --tags Cron - ä»“åº“ç»Ÿè®¡æ£€æŸ¥ (cron.check_repo_stats) åç§° æè¿° RUN_AT_START æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä»“åº“ç»Ÿè®¡æ£€æŸ¥ SCHEDULE å®šæ—¶è¿›è¡Œä»“åº“ç»Ÿè®¡æ£€æŸ¥çš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š@every 24h Cron - ä»“åº“å½’æ¡£æ¸…ç† (cron.repo_archive_cleanup) åç§° æè¿° RUN_AT_START æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä»“åº“å½’æ¡£æ¸…ç† SCHEDULE å®šæ—¶è¿›è¡Œä»“åº“å½’æ¡£æ¸…ç†çš„ Cron è¯­æ³•ï¼Œä¾‹å¦‚ï¼š@every 24h OLDER_THAN ä»“åº“å½’æ¡£çš„æ–‡ä»¶æœ‰æ•ˆæœŸï¼Œè¿‡æœŸçš„å½’æ¡£å°†è¢«æ¸…ç†ï¼Œä¾‹å¦‚ï¼š24h Git (git) åç§° æè¿° DISABLE_DIFF_HIGHLIGHT æ¿€æ´»è¯¥é€‰é¡¹ä»¥ç¦ç”¨è¡Œå†…å·®å¼‚é«˜äº® MAX_GIT_DIFF_LINES å·®å¼‚å¯¹æ¯”é¡µé¢å•ä¸ªæ–‡ä»¶æ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•° MAX_GIT_DIFF_LINE_CHARACTERS å·®å¼‚å¯¹æ¯”é¡µé¢å•è¡Œæ˜¾ç¤ºçš„æœ€å¤§å­—ç¬¦æ•° MAX_GIT_DIFF_FILES å·®å¼‚å¯¹æ¯”é¡µé¢æ–‡ä»¶æ˜¾ç¤ºçš„æœ€å¤šä¸ªæ•° GC_ARGS git gc å‘½ä»¤çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š--aggressive --auto Git - è¶…æ—¶ (git.timeout) åç§° æè¿° MIGRATE ä»“åº“è¿ç§»æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º 600 ç§’ MIRROR ä»“åº“é•œåƒåŒæ­¥æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º 300 ç§’ CLONE ä»“åº“å…‹éš†æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º 300 ç§’ PULL ä»“åº“æ‹‰å–æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º 300 ç§’ GC ä»“åº“åƒåœ¾å›æ”¶æ“ä½œè¶…æ—¶ï¼Œé»˜è®¤ä¸º 60 ç§’ UI (ui) åç§° æè¿° EXPLORE_PAGING_NUM æ¢ç´¢é¡µé¢æ¯é¡µæ˜¾ç¤ºä»“åº“çš„æ•°é‡ ISSUE_PAGING_NUM æ¯é¡µæ˜¾ç¤ºå·¥å•ï¼ˆIssueï¼‰çš„æ•°é‡ï¼ˆåº”ç”¨åˆ°æ‰€æœ‰ä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºå·¥å•çš„é¡µé¢ï¼‰ FEED_MAX_COMMIT_NUM ä¸€æ¡æœ€æ–°æ´»åŠ¨ä¸­æ˜¾ç¤ºä»£ç æäº¤ï¼ˆCommitï¼‰çš„æœ€å¤§æ•°é‡ THEME_COLOR_META_TAG è¢«ç”¨äº Android &gt;= 5.0 ç‰ˆæœ¬ â€œtheme-colorâ€ æ ‡è®°çš„å€¼ï¼Œæ— æ•ˆçš„å€¼å°†è¢«å¿½ç•¥å¹¶ä½¿ç”¨é»˜è®¤å€¼ï¼ˆæŸ¥çœ‹è¯¦æƒ…ï¼‰ MAX_DISPLAY_FILE_SIZE æ˜¾ç¤ºåˆ°é¡µé¢çš„æœ€å¤§æ–‡ä»¶ä½“ç§¯ï¼ˆByteï¼‰ UI - Admin (ui.admin) åç§° æè¿° USER_PAGING_NUM ç”¨æˆ·ç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•° REPO_PAGING_NUM ä»“åº“ç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•° NOTICE_PAGING_NUM ç³»ç»Ÿæç¤ºç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•° ORG_PAGING_NUM ç»„ç»‡ç®¡ç†é¡µé¢æ¯é¡µæ˜¾ç¤ºè®°å½•æ¡æ•° Prometheus (prometheus) åç§° æè¿° ENABLED æ¿€æ´»è¯¥é€‰é¡¹ä»¥å¯ç”¨ Prometheus ç›‘æ§ä¿¡æ¯ï¼Œé»˜è®¤ä¸º true ENABLE_BASIC_AUTH æ¿€æ´»è¯¥é€‰é¡¹ä»¥å¯ç”¨ HTTP åŸºæœ¬è®¤è¯ä¿æŠ¤ç›‘æ§ä¿¡æ¯æ•°æ®ï¼Œé»˜è®¤ä¸º false BASIC_AUTH_USERNAME HTTP åŸºæœ¬è®¤è¯çš„ç”¨æˆ·å BASIC_AUTH_PASSWORD HTTP åŸºæœ¬è®¤è¯çš„å¯†ç  å…¶ä»– (other) åç§° æè¿° SHOW_FOOTER_BRANDING æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨é¡µè„šæ˜¾ç¤º Gogs æ¨å¹¿ä¿¡æ¯ SHOW_FOOTER_VERSION æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨é¡µè„šæ˜¾ç¤º Gogs ç‰ˆæœ¬ä¿¡æ¯ SHOW_FOOTER_TEMPLATE_LOAD_TIME æ¿€æ´»è¯¥é€‰é¡¹ä»¥åœ¨é¡µè„šæ˜¾ç¤º Gogs æ¨¡æ¿åŠ è½½æ—¶é—´","tags":["Docker","CI","gogs"],"categories":["CI"]},{"title":"åˆ©ç”¨consul+nginx-upsyncå®ç°åŠ¨æ€è´Ÿè½½","path":"/2019/12/01/212/","content":"å½“ Nginx é‡åˆ°å¤§æµé‡å’Œé«˜è´Ÿè½½ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶é‡å¯ç•¥æ˜¾ç¹çï¼Œå› ä¸ºæ¢å¤Nginxå¹¶é‡è½½é…ç½®ä¼šè¿›ä¸€æ­¥å¢åŠ ç³»ç»Ÿè´Ÿè½½ï¼Œå¹¶å¾ˆå¯èƒ½çŸ­æš‚é™ä½æ€§èƒ½ï¼Œè€Œä¸€ä¸ªä¸ªä¿®æ”¹é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å‡ºé”™å’Œè´¹æ—¶é—´çš„æ“ä½œï¼Œè¿™æ—¶å€™ä¸å¦¨è¯•è¯•consul+nginx-upsync-moduleå®ç°Nginxçš„åŠ¨æ€è´Ÿè½½ã€‚ nginx-upsync-modulenginx-upsync-module æä¾›äº†åŠ¨æ€çš„è´Ÿè½½å‡è¡¡ï¼Œå®ƒå¯ä»¥ä»consulæˆ–etcdåŒæ­¥upstreamsï¼ŒåŠ¨æ€ä¿®æ”¹åç«¯æœåŠ¡å™¨å±æ€§ï¼Œè€Œä¸éœ€è¦é‡æ–°åŠ è½½nginxã€‚è¿™æ ·æˆ‘ä»¬é€šè¿‡å®ƒå®ç°å¹³æ»‘ä¼¸ç¼©ï¼Œè€Œä¸ä¸¥é‡åœ°å½±å“æ€§èƒ½ã€‚ åˆ©ç”¨dockerå®‰è£…æˆ‘å·²ç»åŸºäºcentos7æ„å»ºäº†ä¸€ä¸ªé•œåƒ puresai/nginx-lua-upsync ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ä¸€ä¸ªå®¹å™¨ docker run -itd â€“name=nginx-upsync -p 8008:80 -p 9501:9501 -p 9502:9502 -p 9503:9503 -p 8500:8500 puresai/nginx-lua-upsync å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨dockerè‡ªè¡Œæ­å»ºï¼Œæ·»åŠ nginx-upsync-moduleæ¨¡å—å¯ä»¥å‚è€ƒnginxæ¨¡å—luaæ¨¡å—ã€‚ nginx-upsync-moduleçš„gitåœ°å€ è¿›å…¥å®¹å™¨é…ç½® docker exec -it nginx-upsync /bin/bash cd /usr/local/nginx/conf echo â€œserver host.docker.internal:9501 weight=1 fail_timeout=10 max_fails=3;â€ &gt;&gt; servers.conf vi nginx.conf #nginx.conf ä¸»è¦é…ç½®...upstream puresai&#123; upsync 192.168.65.2:8500/v1/kv/upstreams/test-server upsync_timeout=6m upsync_interval=500ms upsync_type=consul strong_dependency=off; upsync_dump_path /usr/local/nginx/conf/servers.conf; include /usr/local/nginx/conf/servers.conf;&#125;server &#123; listen 80; location / &#123; proxy_pass http://puresai; &#125; ... &#125; ç›¸å…³è¯­æ³•è¯´æ˜ upsync å®šä¹‰ä»consul/etcdæ‹‰å–æœ€æ–°çš„upstreamä¿¡æ¯å¹¶å­˜åˆ°æœ¬åœ°çš„æ“ä½œ upsync_timeout å®šä¹‰ä»consul/etcdæ‹‰å–é…ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 6m upsync_interval å®šä¹‰ä»consul/etcæ‹‰å–é…ç½®çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤ 5s upsync_type å®šä¹‰ä½¿ç”¨é…ç½®æœåŠ¡ç±»å‹ consul/etcd strong_dependency å¯åŠ¨æ—¶æ˜¯å¦å¼ºåˆ¶ä¾èµ–é…ç½®æœåŠ¡å™¨ï¼Œå¦‚æœé…ç½®ä¸ºon,åˆ™æ‹‰å–å¤±è´¥ï¼ŒnginxåŒæ ·ä¼šå¯ç”¨å¤±è´¥ upsync_dump_path å®šä¹‰ä»consul/etcdæ‹‰å–é…ç½®åæŒä¹…åŒ–åˆ°çš„æœ¬åœ°çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™æ ·å³ä½¿ consul/etcdå‡ºé—®é¢˜äº†ï¼Œæœ¬åœ°åŒæ ·ä¼šæœ‰å¤‡ä»½æ–‡ä»¶ æ³¨æ„ upsync_dump_path æŒ‡å®šè¿™ä¸ªæ–‡ä»¶å¿…é¡»è¦æœ‰ï¼Œå¦åˆ™Nginxå¯åŠ¨ä¼šæŠ¥é”™ã€‚æ–‡ä»¶è·¯å¾„å’Œåç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œnginx-upsync-moduleä¼šå°†è´Ÿè½½ä¿¡æ¯ç¼“å­˜åˆ°æ­¤æ–‡ä»¶ #servers.confï¼Œ192.168.x.xxxæ˜¯æˆ‘çš„å®¿ä¸»æœºipserver 192.168.x.xxx:9501 weight=20 max_fails=1 fail_timeout=5s; é‡å¯nginx /usr/local/nginx/sbin/nginx -t /usr/local/nginx/sbin/nginx -s reload è¿™é‡Œè™½ç„¶æˆ‘ä»¬è¿˜æœªå¯åŠ¨consulï¼Œä½†æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œupsyncä¼šå»æ‹‰å–ï¼Œä¹Ÿå¿…ç„¶ä¼šå¤±è´¥ï¼Œservers.conf å°±ä¸ä¼šæ›´æ–°ï¼ŒNginxçš„ error æ—¥å¿—ä¼šæœ‰ä¿¡æ¯ã€‚ åˆ©ç”¨swooleå¯åŠ¨3ä¸ªhttpæœåŠ¡// å¯å¯åŠ¨3ä¸ªserverï¼Œç«¯å£åˆ†åˆ«ä¸º9501ï¼Œ9502ï¼Œ9503ï¼Œè¾“å‡ºä¹Ÿåšå¯¹åº”ä¿®æ”¹$http = new Swoole\\Http\\Server(&quot;127.0.0.1&quot;, 9501);$http-&gt;on(&#x27;request&#x27;, function ($request, $response) &#123; $response-&gt;end(&quot;9501&quot;);&#125;); consulå®‰è£… è¿™é‡Œconsulåªåšä¸€ä¸ªkvå­˜å‚¨ï¼Œæˆ‘è‡ªå·±ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼Œå°±ä¸å»åšè¿‡å¤šä»‹ç»äº†ã€‚ ä¸‹è½½åœ°å€ è§£å‹åˆ°ä½ éœ€è¦çš„ç›®å½•ï¼Œä¸»è¦ä¹Ÿå°±æ˜¯ä¸€ä¸ªconsulå¯æ‰§è¡Œæ–‡ä»¶ã€‚ï¼ˆè¿™é‡Œæˆ‘è£…åœ¨æˆ‘çš„ç”µè„‘ï¼Œè€Œä¸æ˜¯åˆšæ‰çš„dockerå®¹å™¨ï¼‰ å‘½ä»¤å¯çœ‹æ–‡æ¡£ï¼šConsul ç®€ä»‹å’Œå¿«é€Ÿå…¥é—¨ å¯åŠ¨ï¼š nohup ./consul agent -dev &amp; ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¯åŠ¨é›†ç¾¤ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨consulé›†ç¾¤ã€‚ UIæŸ¥çœ‹ http://127.0.0.1:8500/ æŸ¥çœ‹èŠ‚ç‚¹ ./consul members curl 127.0.0.1:8500/v1/catalog/nodes æŸ¥çœ‹kvå€¼ curl -v http://127.0.0.1:8500/v1/kv/\\?recurse æ·»åŠ  curl -X PUT -d â€˜{â€œweightâ€:20,â€max_failsâ€:2,â€fail_timeoutâ€:5}â€™ http://127.0.0.1:8500/v1/kv/upstreams/test-server/192.168.x.xxx:9502 æ­¤å¤„192.168.x.xxxæ˜¯å› ä¸ºæˆ‘åˆ›å»ºçš„dockerå®¹å™¨çš„å®¿ä¸»æœºipã€‚ åˆ é™¤ curl -X DELETE http://127.0.0.1:8500/v1/kv/upstreams/test-server/192.168.x.xxx:9502 æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å’Œåˆ é™¤æ¥æµ‹è¯•ï¼ŒæŸ¥çœ‹ http://127.0.0.1:8008/ æ¥æŸ¥çœ‹è¾“å‡ºï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹Nginxé‡Œçš„é…ç½®æ–‡ä»¶servers.confï¼Œä½ ä¼šçœ‹åˆ°ä½ æ“ä½œconsulï¼Œä¼šåŠ¨æ€æ”¹å˜Nginxçš„upstreamï¼Œè¿™æ ·å°±å®ç°äº†Nginxçš„åŠ¨æ€æ‰©å®¹ï¼Œç›¸æ¯”ä¸€ä¸ªä¸ªæ”¹é…ç½®è¦è½»æ¾ä¸€ç‚¹ã€‚","tags":["consul","SLB"],"categories":["Nginx"]},{"title":"Nginxé…ç½®å¸¸ç”¨å‚æ•°","path":"/2019/11/22/Nginx6/","content":"æœ€è¿‘åœ¨å…¨é¢å­¦ä¹ Nginxï¼Œå½“ä½œç¬”è®°äº†ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºæˆ–æ·±å…¥äº¤æµã€‚ ä¸»æ¨¡å—# é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚#user www www; #Nginxå¼€å¯çš„workerè¿›ç¨‹æ•°ï¼Œå»ºè®®ä¸ºCPUçš„æ ¸æ•°#worker_processes 2; #æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€#pid /nginx/pid/nginx.pid;#æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ã€httpå—ã€serverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emergerror_log log/error.log debug; #å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä½¿ç”¨includeæŒ‡ä»¤å®ç°é…ç½®æ–‡ä»¶çš„åŒ…å«ï¼Œç±»ä¼¼äºapacheä¸­çš„includeæ–¹æ³•ï¼Œå¯å‡å°‘ä¸»é…ç½®æ–‡ä»¶é•¿åº¦ã€‚include vhosts/*.conf; äº‹ä»¶æ¨¡å—events &#123; #è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon accept_mutex on; #é»˜è®¤: 500ms å¦‚æœä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰äº’æ–¥é”ï¼Œå®ƒå°†å»¶è¿Ÿè‡³å°‘å¤šé•¿æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿæ˜¯500ms ã€‚ accept_mutex_delay 100ms; #è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff multi_accept on; #äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventportï¼Œä¸å»ºè®®è®¾ç½®ï¼Œnginxä¼šè‡ªè¡Œé€‰æ‹© #use epoll; #æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512 worker_connections 1024;&#125; httpéƒ¨åˆ†http &#123; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ include mime.types; # é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain default_type application/octet-stream; #å–æ¶ˆæœåŠ¡æ—¥å¿— #access_log off; #å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚ sendfile on; #æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚ sendfile_max_chunk 100k; #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚ keepalive_timeout 65; #å¼€å¯gzipèµ„æºå‹ç¼© gzip on; # è´Ÿè½½å‡è¡¡ï¼Œè¯¦ç»†å¯çœ‹äº†ä¸€ç¯‡æ–‡ç« ï¼šhttps://learnku.com/articles/36737 upstream blog &#123; server 192.167.20.19:8081; server 192.168.10.121:8080 weight=5; &#125; #è®¾å®šè¯·æ±‚ç¼“å†² client_header_buffer_size 128k; large_client_header_buffers 4 128k; #ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶ é»˜è®¤1m client_max_body_size 8m; server &#123; #å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚ keepalive_requests 120; #ç›‘å¬ç«¯å£ listen 80; #ç›‘å¬åœ°å€ server_name blog.puresai.com; #è®¾å®šæ—¥å¿—æ ¼å¼ log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27; &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27; &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;; access_log /data/logs/access.log main; # æ ¹ç›®å½• root /www/web/public; # å®šä¹‰é”™è¯¯æç¤ºé¡µé¢ error_page 500 502 503 504 /50x.html; location /static/ &#123; #rootä¸aliasä¸»è¦åŒºåˆ«åœ¨äºnginxå¦‚ä½•è§£é‡Šlocationåé¢çš„uriï¼Œè¿™ä¼šä½¿ä¸¤è€…åˆ†åˆ«ä»¥ä¸åŒçš„æ–¹å¼å°†è¯·æ±‚æ˜ å°„åˆ°æœåŠ¡å™¨æ–‡ä»¶ä¸Šã€‚ #rootçš„å¤„ç†ç»“æœæ˜¯ï¼šrootè·¯å¾„ï¼‹locationè·¯å¾„ #aliasçš„å¤„ç†ç»“æœæ˜¯ï¼šä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„ alias /www/static/; #è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹,å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚ expires 30d; &#125; # å¤„ç†phpè¯·æ±‚åˆ°fpmç«¯å£ location ~ \\.php$ &#123; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; &#125; location / &#123; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_pass http://blog; #è¯·æ±‚è½¬å‘blog å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ &#125; #ç¦æ­¢è®¿é—®æ–‡ä»¶ location ~ /.git &#123; deny all; allow 127.0.0.1; #å…è®¸çš„ip &#125; &#125;&#125; éƒ¨åˆ†å‚æ•°è¯¦ç»†è¯´æ˜server_name1.é¦–å…ˆé€‰æ‹©æ‰€æœ‰å­—ç¬¦ä¸²å®Œå…¨åŒ¹é…çš„server_nameï¼Œå¦‚ blog.puresai.com ã€‚2.å…¶æ¬¡é€‰æ‹©é€šé…ç¬¦åœ¨å‰é¢çš„server_nameï¼Œå¦‚ *.puresai.comã€‚3.å†æ¬¡é€‰æ‹©é€šé…ç¬¦åœ¨åé¢çš„server_nameï¼Œå¦‚www.puresai.* ã€‚ 4.æœ€åé€‰æ‹©ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ‰åŒ¹é…çš„server_nameï¼Œå¦‚ ~^\\.sai\\.com$å¦‚æœéƒ½ä¸åŒ¹é…1ã€ä¼˜å…ˆé€‰æ‹©listené…ç½®é¡¹åæœ‰defaultæˆ–default_serverçš„ 2ã€æ‰¾åˆ°åŒ¹é…listenç«¯å£çš„ç¬¬ä¸€ä¸ªserverå— locationlocationè¯­æ³•: location[=|~|~*|^~|@]/uri/&#123;...&#125;é…ç½®å—: server locationä¼šå°è¯•æ ¹æ®ç”¨æˆ·è¯·æ±‚ä¸­çš„URIæ¥åŒ¹é…ä¸Šé¢çš„/uriè¡¨è¾¾å¼ï¼Œå¦‚æœå¯ä»¥åŒ¹é…ï¼Œå°±é€‰æ‹© location&#123;&#125;å—ä¸­çš„é…ç½®æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚ locationè¡¨è¾¾å¼ç±»å‹ ~ è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼ŒåŒºåˆ†å¤§å°å†™;~* è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ªæ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™;^~ è¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†åŒ¹é…å…¶ä»–location; = è¿›è¡Œæ™®é€šå­—ç¬¦ç²¾ç¡®åŒ¹é…ã€‚ä¹Ÿå°±æ˜¯å®Œå…¨åŒ¹é…;@ å®ƒå®šä¹‰ä¸€ä¸ªå‘½åçš„ locationï¼Œä½¿ç”¨åœ¨å†…éƒ¨å®šå‘æ—¶ï¼Œä¾‹å¦‚ error_page, try_files ä¼˜å…ˆçº§: ç­‰å·ç±»å‹(=)çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†æŸ¥æ‰¾å…¶ä»–åŒ¹é…é¡¹ å‰ç¼€æ™®é€šåŒ¹é…(^~)ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ï¼Œå¦‚æœæœ‰å¤šä¸ªlocationåŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ª æ­£åˆ™è¡¨è¾¾å¼ç±»å‹(~ ~*)çš„ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†æŸ¥æ‰¾å…¶ä»–åŒ¹é…é¡¹ å¸¸è§„å­—ç¬¦ä¸²åŒ¹é…ï¼Œå¦‚æœæœ‰å¤šä¸ªlocationåŒ¹é…çš„è¯ï¼Œåˆ™ä½¿ç”¨è¡¨è¾¾å¼æœ€é•¿çš„é‚£ä¸ª (location =) &gt; (location å®Œæ•´è·¯å¾„) &gt; (location ^~ è·¯å¾„) &gt; (location ,* æ­£åˆ™é¡ºåº) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) returnè¯­æ³•:return code [text] return code URL;return URL;é…ç½®å—:serverï¼Œlocationï¼Œifè¯¥æŒ‡ä»¤ç”¨äºç»“æŸè§„åˆ™çš„æ‰§è¡Œå¹¶è¿”å›çŠ¶æ€å—ç»™å®¢æˆ·ç«¯ã€‚çŠ¶æ€ç åŒ…æ‹¬:204(No Content)ã€400(Bad Request)ã€402(Payment Required)ã€403(Forbidden) 404(Not Found)ã€405(Method Not Allowed)ã€406(Not Acceptable)ã€ 408(Request Timeout)ã€410(Gone)ã€411(Length Required)ã€413(Request Entity Too Large)ã€416(Requested Range Not Satisfiable)ã€ 500(Internal Server Error)ã€501(Not Implemented)ã€502(Bad Gateway)ã€ 503(Service Unavailable)504(Gateway Timeout)ã€‚ä¾‹å¦‚ï¼Œç¤ºä¾‹ï¼Œå¦‚æœè®¿é—®çš„URLä»¥.sh .bash ç»“å°¾ï¼Œè¿”å›çŠ¶æ€ç 403 location ~ .*\\.(sh|bash)?$ &#123;\treturn 403;&#125; rewriteæ‰§è¡Œé¡ºåºï¼š1. æ‰§è¡Œserverå—çš„rewriteæŒ‡ä»¤(è¿™é‡Œçš„å—æŒ‡çš„æ˜¯serverå…³é”®å­—å&#123;&#125;åŒ…å›´çš„åŒºåŸŸï¼Œå…¶å®ƒxxå—ç±»ä¼¼)2. æ‰§è¡ŒlocationåŒ¹é…3. æ‰§è¡Œé€‰å®šçš„locationä¸­çš„rewriteæŒ‡ä»¤å¦‚æœå…¶ä¸­æŸæ­¥URIè¢«é‡å†™ï¼Œåˆ™é‡æ–°å¾ªç¯æ‰§è¡Œ1-3ï¼Œç›´åˆ°æ‰¾åˆ°çœŸå®å­˜åœ¨çš„æ–‡ä»¶å¦‚æœå¾ªç¯è¶…è¿‡10æ¬¡ï¼Œåˆ™è¿”å›500 Internal Server Erroré”™è¯¯è¯­æ³•:rewrite regex replacement [flag]; é»˜è®¤å€¼:â€”é…ç½®å—:server, location, ifrewriteæ˜¯å®ç°URLé‡å†™çš„å…³é”®æŒ‡ä»¤ï¼Œæ ¹æ®regex(æ­£åˆ™è¡¨è¾¾å¼)éƒ¨åˆ†å†…å®¹ï¼Œé‡å®šå‘åˆ°replacementï¼Œç»“å°¾æ˜¯flagæ ‡è®°ã€‚ æ­£åˆ™:perlå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼è¯­å¥è¿›è¡Œè§„åˆ™åŒ¹é…æ›¿ä»£å†…å®¹:å°†æ­£åˆ™åŒ¹é…çš„å†…å®¹æ›¿æ¢æˆreplacementflagæ ‡è®°:rewriteæ”¯æŒçš„flagæ ‡è®° ifæŒ‡ä»¤è¯­æ³•ï¼šif(condition)&#123;...&#125;é»˜è®¤å€¼ï¼šæ— é…ç½®å—ï¼šserver,locationå¯¹ç»™å®šçš„æ¡ä»¶conditionè¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœä¸ºçœŸï¼Œå¤§æ‹¬å·å†…çš„rewriteæŒ‡ä»¤å°†è¢«æ‰§è¡Œã€‚ifæ¡ä»¶(conditon)å¯ä»¥æ˜¯å¦‚ä¸‹ä»»ä½•å†…å®¹:ä¸€ä¸ªå˜é‡åï¼›falseå¦‚æœè¿™ä¸ªå˜é‡æ˜¯ç©ºå­—ç¬¦ä¸²æˆ–è€…ä»¥0å¼€å§‹çš„å­—ç¬¦ä¸²ï¼›ä½¿ç”¨= ,!= æ¯”è¾ƒçš„ä¸€ä¸ªå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯ç”¨~ï¼Œ ~*ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å˜é‡ï¼Œå¦‚æœè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ…å«&#125;ï¼Œ;åˆ™æ•´ä¸ªè¡¨è¾¾å¼éœ€è¦ç”¨&quot; æˆ–&#x27; åŒ…å›´ä½¿ç”¨-f ï¼Œ!-f æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨-d, !-d æ£€æŸ¥ä¸€ä¸ªç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨-e ï¼Œ!-e æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶ã€ç›®å½•ã€ç¬¦å·é“¾æ¥æ˜¯å¦å­˜åœ¨ä½¿ç”¨-x ï¼Œ !-x æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ ifå®ä¾‹if ($http_user_agent~*(mobile|nokia|iphone|ipad|android|samsung|htc|blackberry)) &#123; rewrite ^.+ /mobile last; ï¼ƒè·³è½¬åˆ°æ‰‹æœºç«™&#125;if ($request_method = POST) &#123; return 405;&#125;if ($slow) &#123; limit_rate 10k;&#125;if ($invalid_referer) &#123; return 403;&#125; last &amp; breakï¼ˆ1ï¼‰last å’Œ break å½“å‡ºç°åœ¨location ä¹‹å¤–æ—¶ï¼Œä¸¤è€…çš„ä½œç”¨æ˜¯ä¸€è‡´çš„æ²¡æœ‰ä»»ä½•å·®å¼‚ã€‚æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼Œä»–ä»¬ä¼šè·³è¿‡æ‰€æœ‰çš„åœ¨ä»–ä»¬ä¹‹åçš„rewrite æ¨¡å—ä¸­çš„æŒ‡ä»¤ï¼Œå»é€‰æ‹©è‡ªå·±åŒ¹é…çš„locationï¼ˆ2ï¼‰last å’Œ break å½“å‡ºç°åœ¨location å†…éƒ¨æ—¶ï¼Œä¸¤è€…å°±å­˜åœ¨äº†å·®å¼‚-- last: ä½¿ç”¨äº†last æŒ‡ä»¤ï¼Œrewrite åä¼šè·³å‡ºlocation ä½œç”¨åŸŸï¼Œé‡æ–°å¼€å§‹å†èµ°ä¸€æ¬¡åˆšåˆšçš„è¡Œä¸º-- break: ä½¿ç”¨äº†break æŒ‡ä»¤ï¼Œrewriteåä¸ä¼šè·³å‡ºlocation ä½œç”¨åŸŸã€‚å®ƒçš„ç”Ÿå‘½ä¹Ÿåœ¨è¿™ä¸ªlocationä¸­ç»ˆç»“ã€‚è§£é‡Šé€šä¿—æ˜“æ‡‚ï¼šlastï¼š é‡æ–°å°†rewriteåçš„åœ°å€åœ¨serveræ ‡ç­¾ä¸­æ‰§è¡Œbreakï¼š å°†rewriteåçš„åœ°å€åœ¨å½“å‰locationæ ‡ç­¾ä¸­æ‰§è¡Œ permanent &amp; redirect:permanent: æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º301redirect:ä¸´æ—¶é‡å®šå‘ã€‚è¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º302 ä»å®ç°åŠŸèƒ½çš„è§’åº¦ä¸Šå»çœ‹ï¼Œpermanent å’Œ redirect æ˜¯ä¸€æ ·çš„ã€‚ä¸å­˜åœ¨å¥½åã€‚ä¹Ÿä¸å­˜åœ¨ä»€ä¹ˆæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ä½†æ˜¯å¯¹seoä¼šæœ‰å½±å“ï¼Œè¿™é‡Œè¦æ ¹æ®éœ€è¦åšå‡ºé€‰æ‹©åœ¨ permanent å’Œ redirect ä¸­æåˆ°äº† çŠ¶æ€ç  301 å’Œ 302ã€‚ è®°ä½ï¼šlast å’Œ break æƒ³å¯¹äºçš„è®¿é—®æ—¥å¿—çš„è¯·æ±‚çŠ¶æ€ç ä¸º200 å½“ä½ æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼ŒåŒæ—¶æ‰“å¼€debug æ¨¡å¼æ—¶ï¼Œä¼šå‘ç°301 å’Œ 302 æ—¶çš„è¡Œä¸ºæ˜¯è¿™æ ·çš„ã€‚ ç¬¬ä¸€ä¸ªè¯·æ±‚301 æˆ–è€… 302 åï¼Œæµè§ˆå™¨é‡æ–°è·å–äº†ä¸€ä¸ªæ–°çš„URL ï¼Œç„¶åä¼šå¯¹è¿™ä¸ªæ–°çš„URL é‡æ–°è¿›è¡Œè®¿é—®ã€‚æ‰€ä»¥å½“ä½ é…ç½®çš„æ˜¯permanent å’Œ redirect ,ä½ å¯¹ä¸€ä¸ªURL çš„è®¿é—®è¯·æ±‚ï¼Œè½åˆ°æœåŠ¡å™¨ä¸Šè‡³å°‘ä¸º2æ¬¡ï¼›è€Œå½“ä½ é…ç½®äº†last æˆ–è€…æ˜¯break æ—¶ï¼Œä½ æœ€ç»ˆçš„URL ç¡®å®šä¸‹æ¥åï¼Œä¸ä¼šå°†è¿™ä¸ªURLè¿”å›ç»™æµè§ˆå™¨ï¼Œè€Œæ˜¯å°†å…¶æ‰”ç»™äº†fastcgi_passæˆ–è€…æ˜¯proxy_passæŒ‡ä»¤å»å¤„ç†ã€‚è¯·æ±‚ä¸€ä¸ªURL ï¼Œè½åˆ°æœåŠ¡å™¨ä¸Šçš„æ¬¡æ•°å°±ä¸º1æ¬¡ã€‚ æ³¨æ„ï¼šé…ç½®last åœ¨è·¨åŸŸçš„æ—¶å€™æ•ˆæœå’Œredirectä¸€è‡´ï¼Œéƒ½æ˜¯è¿”å›302çŠ¶æ€ç ï¼Œè¯·æ±‚åœ°å€ä¹Ÿå‘ç”Ÿæ”¹å˜ åº”ç”¨ä¼°ç®—å¹¶å‘nginxä½œä¸ºhttpæœåŠ¡å™¨çš„æ—¶å€™ï¼š max_clients = worker_processes * worker_connections/2 nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨çš„æ—¶å€™ï¼š max_clients = worker_processes * worker_connections/4 é™åˆ¶æ¯ä¸ªIPçš„å¹¶å‘è¿æ¥æ•°demo:å®šä¹‰ä¸€ä¸ªå«â€œtwoâ€çš„è®°å½•åŒºï¼Œæ€»å®¹é‡ä¸º 10Mï¼ˆè¶…è¿‡å¤§å°å°†è¯·æ±‚å¤±è´¥ï¼Œä»¥å˜é‡ $binary_remote_addr ä½œä¸ºä¼šè¯çš„åˆ¤æ–­åŸºå‡†ï¼ˆå³ä¸€ä¸ªåœ°å€ä¸€ä¸ªä¼šè¯ï¼‰ã€‚ é™åˆ¶ /download/ ç›®å½•ä¸‹ï¼Œä¸€ä¸ªä¼šè¯åªèƒ½è¿›è¡Œä¸€ä¸ªè¿æ¥ã€‚ ç®€å•ç‚¹ï¼Œå°±æ˜¯é™åˆ¶ /download/ ç›®å½•ä¸‹ï¼Œä¸€ä¸ªIPåªèƒ½å‘èµ·ä¸€ä¸ªè¿æ¥ï¼Œå¤šè¿‡ä¸€ä¸ªï¼Œä¸€å¾‹503ã€‚ http &#123; ... limit_conn_zone $binary_remote_addr zone=two:10m; server &#123; ... location /download &#123; limit_conn two 1; &#125; &#125;&#125; é™æµdemo:å®šä¹‰ä¸€ä¸ªå«â€œoneâ€çš„è®°å½•åŒºï¼Œå ç”¨ç©ºé—´å¤§å°ä¸º10mï¼ˆè¶…è¿‡å¤§å°å°†è¯·æ±‚å¤±è´¥ï¼‰ï¼Œå¹³å‡å¤„ç†çš„è¯·æ±‚é¢‘ç‡ä¸èƒ½è¶…è¿‡æ¯ç§’ä¸€æ¬¡ï¼Œä¹Ÿå¯ä»¥è®¾ç½®åˆ†é’Ÿé€Ÿç‡ http &#123; ... limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; server &#123; ... location / &#123; #ç¼“å­˜åŒºé˜Ÿåˆ—burst=5ä¸ª,nodelayè¡¨ç¤ºä¸å»¶æœŸ(è¶…è¿‡çš„è¯·æ±‚å¤±è´¥)ï¼Œå³æ¯ç§’æœ€å¤šå¯å¤„ç†rate+burstä¸ª,åŒæ—¶å¤„ç†rateä¸ªã€‚ limit_req zone=one burst=5 nodelay; &#125; &#125;&#125; ç™½åå•http&#123; ... #åˆ¤æ–­å®¢æˆ·ç«¯çš„ipåœ°å€æ˜¯å¦åœ¨ç™½åå•åˆ—è¡¨å½“ä¸­,å¦‚æœè¿”å›ä¸º0,åˆ™åœ¨ç™½åå•åˆ—è¡¨å½“ä¸­,å¦åˆ™è¿”å›ä¸º1 geo $whiteIpList &#123; default 1; 118.24.109.254 0; 47.98.147.0/24 1; #å¯ä»¥å¼•å…¥ä¸€äº›ç™½åå•é…ç½® include &#x27;whiteIP.conf&#x27; &#125; #å¦‚æœä¸åœ¨ç™½åå•ä¹‹å†…,è¿”å›å®¢æˆ·ç«¯çš„äºŒè¿›åˆ¶çš„ipåœ°å€ map $whiteIpList $limit &#123; default &quot;&quot;; 1 $binary_remote_addr; 0 &quot;&quot;; &#125; #å¦‚æœè¿”å›çš„æ˜¯ç©ºå­—ç¬¦ä¸²é‚£ä¹ˆé€Ÿç‡é™åˆ¶ä¼šå¤±æ•ˆ limit_req_zone $limit zone=test:2m rate=1r/m; ...&#125; é˜²ç›—é“¾http &#123; ... server &#123; ... location ~* \\.(gif|jpg|png|swf|flv)$ &#123; valid_referers none blocked *.puresai.com; if ($invalid_referer) &#123; rewrite ^/ blog.puresai.com &#125; &#125; &#125;&#125;","tags":["Nginx"],"categories":["Nginx"]},{"title":"Nginxä»£ç†ç¼“å­˜","path":"/2019/11/22/Nginx1/","content":"Nginxçš„ç¼“å­˜å¯ä»¥ç®€å•åˆ†æˆwebç¼“å­˜å’Œä»£ç†ç¼“å­˜ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä»£ç†ç¼“å­˜ã€‚ webç¼“å­˜Nginxæä¾›äº†expiresã€etagã€if-modified-sinceæŒ‡ä»¤æ¥å®ç°æµè§ˆå™¨ç¼“å­˜æ§åˆ¶ã€‚ è¿™ä¸ªé…ç½®æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬å¯ä»¥ç¼“å­˜ä¸€äº›jsã€cssç­‰é™æ€æ–‡ä»¶ã€‚ å¯¹äºè¿™å‡ ä¸ªä¸æƒ³åšè¿‡å¤šè¯´æ˜ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸¤å¼ å›¾ï¼Œç®€å•ç†è§£ä¸‹ã€‚ ä»£ç†ç¼“å­˜ä»£ç†ç¼“å­˜ä¸»è¦ç”¨åˆ°proxyæ¨¡å—ä¸­çš„proxy_cacheã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªdemoã€‚ upstream puresai&#123; server 127.0.0.1:9501 weight=10;&#125;#è‡ªå®šä¹‰ç¼“å­˜ç›®å½•,ç¼“å­˜æ–‡ä»¶å¤§å°proxy_cache_path /usr/local/etc/nginx/cache levels=1:2 keys_zone=sai_cache:10m max_size=200m inactive=10m use_temp_path=off;server &#123; listen 80; server_name nginx-t.com; location / &#123; proxy_next_upstream error http_503; proxy_pass http://puresai; #å¯ç”¨ç¼“å­˜sai_cache proxy_cache sai_cache; #å®šä¹‰å¦‚ä½•ç”Ÿæˆç¼“å­˜çš„é”® proxy_cache_key $scheme$proxy_host$uri$is_args$args; #é’ˆå¯¹å¤šç§è¯·æ±‚æ–¹æ³•ç¼“å­˜ï¼Œé»˜è®¤GET HEAD proxy_cache_methods GET HEAD POST; #ä¸ºä¸åŒçš„å“åº”çŠ¶æ€ç è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ã€‚ proxy_cache_valid 200 302 10m; proxy_cache_valid 404 1m; #è®¾ç½®å“åº”è¢«ç¼“å­˜çš„æœ€å°è¯·æ±‚æ¬¡æ•°,æœ€å°‘2æ¬¡æ‰ä¼šç¼“å­˜ proxy_cache_min_uses 1; #å¼€å¯æ­¤åŠŸèƒ½æ—¶ï¼Œå¯¹äºç›¸åŒçš„è¯·æ±‚ï¼ŒåŒæ—¶åªå…è®¸ä¸€ä¸ªè¯·æ±‚å‘å¾€åç«¯ proxy_cache_lock on; #ä¸ºproxy_cache_lockæŒ‡ä»¤è®¾ç½®é”çš„è¶…æ—¶5s proxy_cache_lock_timeout 5s; #å¿½ç•¥æœåŠ¡å™¨ä¸ç¼“å­˜çš„è¦æ±‚ proxy_ignore_headers Cache-Control; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; &#125;&#125; æµ‹è¯•æ•ˆæœ// server1.php&lt;?php$http = new Swoole\\Http\\Server(&quot;127.0.0.1&quot;, 9501);$http-&gt;on(&#x27;request&#x27;, function ($request, $response) &#123; echo &quot;no cache&quot;.PHP_EOL; $response-&gt;end(&quot;&lt;h1&gt;9501&lt;/h1&gt;&quot;);&#125;);$http-&gt;start(); php server1.php #æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º å‘é€getå’Œpostè¯·æ±‚ ab -n10 -c10 http://nginx-t.com/v\\=get ab -p â€˜data.jsonâ€™ -n10 -c10 http://nginx-t.com/v\\=post é‡å¤æäº¤å‡ æ¬¡putè¯·æ±‚ curl -X PUT http://nginx-t.com/v\\=put ä¸‹é¢æ˜¯æˆ‘çš„æµ‹è¯•ç»“æœæˆªå›¾ï¼ˆä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œæˆ‘åœ¨getå’Œpostè¯·æ±‚ä¹‹å‰æ•²äº†å‡ ä¸ªç©ºè¡Œï¼‰ ä¸‹é¢è¯´æ˜å‡ ä¸ªå‚æ•°ï¼š proxy_cache_pathè¯­æ³•:\tproxy_cache_path path [levels=levels] keys_zone=name:size [inactive=time] [max_size=size] [loader_files=number] [loader_sleep=time] [loader_threshold=time];é»˜è®¤å€¼:\tâ€”ä¸Šä¸‹æ–‡:\thttp pathï¼šç¼“å­˜æ•°æ®æ˜¯ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„ï¼Œç¼“å­˜çš„é”®å’Œæ–‡ä»¶åéƒ½æ˜¯åœ¨ä»£ç†URLä¸Šæ‰§è¡ŒMD5çš„ç»“æœã€‚ levelsï¼šå®šä¹‰äº†ç¼“å­˜çš„å±‚æ¬¡ç»“æ„ #å½“levels=1:2æ—¶ï¼Œè¡¨ç¤ºæ˜¯ä¸¤çº§ç›®å½•ï¼Œ1å’Œ2è¡¨ç¤ºç”¨1ä½å’Œ2ä½16è¿›åˆ¶æ¥å‘½åç›®å½•åç§°ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œç¬¬ä¸€çº§ç›®å½•ç”¨1ä½16è¿›åˆ¶å‘½åï¼Œå¦‚bï¼›ç¬¬äºŒçº§ç›®å½•ç”¨2ä½16è¿›åˆ¶å‘½åï¼Œå¦‚2cã€‚æ‰€ä»¥æ­¤ä¾‹ä¸­ä¸€çº§ç›®å½•æœ‰16ä¸ªï¼ŒäºŒçº§ç›®å½•æœ‰16*16=256ä¸ªï¼šcache/b/2c/c75ad5e343f042f52e875343425e51b key_zone:åœ¨å…±äº«å†…å­˜ä¸­è®¾ç½®ä¸€å—å­˜å‚¨åŒºåŸŸæ¥å­˜æ”¾ç¼“å­˜çš„keyå’Œmetadata(ç±»ä¼¼ä½¿ç”¨æ¬¡æ•°)ï¼Œè¿™æ ·nginxå¯ä»¥å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªrequestæ˜¯å¦å‘½ä¸­æˆ–è€…æœªå‘½ä¸­ç¼“ å­˜ï¼Œ1må¯ä»¥å­˜å‚¨8000ä¸ªkeyï¼Œ10må¯ä»¥å­˜å‚¨80000ä¸ªkeyã€‚ max_size:æœ€å¤§cacheç©ºé—´ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œä¼šä½¿ç”¨æ‰æ‰€æœ‰disk spaceï¼Œå¦‚æœè¶…è¿‡max_sizeå‚æ•°è®¾ç½®çš„æœ€å¤§å€¼ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤ç¼“å­˜æ•°æ® inactive:æœªè¢«è®¿é—®æ–‡ä»¶åœ¨ç¼“å­˜ä¸­ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤æ˜¯10åˆ†é’Ÿã€‚æŒ‡å®šæ—¶é—´å†…æœªè¢«è®¿é—®çš„ç¼“å­˜æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚ loader_files:æ¯æ¬¡æœ€å¤šåŠ è½½çš„æ•°é‡ loader_sleeps:æ¯æ¬¡åŠ è½½çš„å»¶æ—¶ loader_threshold:æŒ‡å®šæ¯æ¬¡åŠ è½½æ‰§è¡Œçš„æ—¶é—´ proxy_cache_lockå¼€å¯æ­¤åŠŸèƒ½æ—¶ï¼Œå¯¹äºç›¸åŒçš„è¯·æ±‚ï¼ŒåŒæ—¶åªå…è®¸ä¸€ä¸ªè¯·æ±‚å‘å¾€åç«¯ï¼Œå¹¶æ ¹æ®proxy_cache_keyæŒ‡ä»¤çš„è®¾ç½®åœ¨ç¼“å­˜ä¸­æ¤å…¥ä¸€ä¸ªæ–°æ¡ç›®ã€‚å…¶ä»–è¯·æ±‚ç›¸åŒæ¡ç›®çš„è¯·æ±‚å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ç¼“å­˜ä¸­å‡ºç°ç›¸åº”çš„å†…å®¹ï¼Œæˆ–è€…é”åœ¨proxy_cache_lock_timeoutæŒ‡ä»¤è®¾ç½®çš„è¶…æ—¶åè¢«é‡Šæ”¾ã€‚ proxy_cache_validå¦‚æœä»…ä»…æŒ‡å®šäº†timeï¼Œ proxy_cache_valid 5m; é‚£ä¹ˆåªæœ‰çŠ¶æ€ç ä¸º200ã€300å’Œ302çš„å“åº”ä¼šè¢«ç¼“å­˜ã€‚ å¦‚æœä½¿ç”¨äº†anyå‚æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¼“å­˜ä»»ä½•å“åº”ï¼š proxy_cache_valid any 1m; proxy_ignore_headersè¯­æ³•:\tproxy_ignore_headers field ...;é»˜è®¤å€¼:\tâ€”ä¸Šä¸‹æ–‡:\thttp, server, location ä¸å¤„ç†åç«¯æœåŠ¡å™¨è¿”å›çš„æŒ‡å®šå“åº”å¤´ã€‚ä¸‹é¢çš„å“åº”å¤´å¯ä»¥è¢«è®¾ç½®ï¼š â€œX-Accel-Redirectâ€ï¼Œâ€œX-Accel-Expiresâ€ï¼Œâ€œX-Accel-Limit-Rateâ€ ï¼Œâ€œX-Accel-Bufferingâ€ ï¼Œ â€œX-Accel-Charsetâ€ï¼Œâ€œExpiresâ€ï¼Œâ€œCache-Controlâ€ï¼Œå’Œâ€œSet-Cookieâ€ ã€‚ æ­¤å‚æ•°ä¸å»ºè®®è®¾ç½®ï¼ŒåŸåˆ™ä¸Šè¿™äº›ç¼“å­˜åº”å½“åç«¯ä»£ç å¤„ç†ã€‚ proxy_cache_use_staleè¯­æ³•:\tproxy_cache_use_stale error | timeout | invalid_header | updating | http_500 | http_502 | http_503 | http_504 | http_404 | off ...;é»˜è®¤å€¼:\tproxy_cache_use_stale off;ä¸Šä¸‹æ–‡:\thttp, server, location å¦‚æœåç«¯æœåŠ¡å™¨å‡ºç°çŠ¶å†µï¼Œnginxæ˜¯å¯ä»¥ä½¿ç”¨è¿‡æœŸçš„å“åº”ç¼“å­˜çš„ã€‚è¿™æ¡æŒ‡ä»¤å°±æ˜¯å®šä¹‰ä½•ç§æ¡ä»¶ä¸‹å…è®¸å¼€å¯æ­¤æœºåˆ¶ã€‚è¿™æ¡æŒ‡ä»¤çš„å‚æ•°ä¸proxy_next_upstreamæŒ‡ä»¤çš„å‚æ•°ç›¸åŒã€‚ proxy_cache_bypassä¸proxy_no_cacheè¯­æ³•:\tproxy_cache_bypass string ...;é»˜è®¤å€¼:\tâ€”ä¸Šä¸‹æ–‡:\thttp, server, location å®šä¹‰nginxä¸ä»ç¼“å­˜å–å“åº”çš„æ¡ä»¶ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªå­—ç¬¦ä¸²æ¡ä»¶éç©ºè€Œä¸”éâ€œ0â€ï¼Œnginxå°±ä¸ä¼šä»ç¼“å­˜ä¸­å»å–å“åº”ï¼š proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;proxy_cache_bypass $http_pragma $http_authorization; æœ¬æŒ‡ä»¤å¯å’Œä¸proxy_no_cacheä¸€èµ·ä½¿ç”¨ã€‚ è¯­æ³•:\tproxy_no_cache string ...;é»˜è®¤å€¼:\tâ€”ä¸Šä¸‹æ–‡:\thttp, server, location å®šä¹‰nginxä¸å°†å“åº”å†™å…¥ç¼“å­˜çš„æ¡ä»¶ã€‚å¦‚æœè‡³å°‘ä¸€ä¸ªå­—ç¬¦ä¸²æ¡ä»¶éç©ºè€Œä¸”éâ€œ0â€ï¼Œnginxå°±ä¸å°†å“åº”å­˜å…¥ç¼“å­˜ï¼š proxy_no_cache $cookie_nocache $arg_nocache$arg_comment;proxy_no_cache $http_pragma $http_authorization; proxy_cache_methodsè¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®ç¼“å­˜å“ªäº›HTTPæ–¹æ³•,é»˜è®¤ç¼“å­˜HTTP GET/HEADæ–¹æ³•,ä¸ç¼“å­˜HTTP POST æ–¹æ³•ã€‚ æœ‰äº†ä»£ç†ç¼“å­˜ï¼Œé‚£ä¹ˆæ¸…é™¤ç¼“å­˜å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ æ¸…é™¤ç¼“å­˜ åˆ é™¤ç¼“å­˜ç›®å½•çš„æ–‡ä»¶ ä½¿ç”¨ngx_cache_purgeæ¨¡å—ï¼Œå¯æŸ¥çœ‹è¿™ç¯‡æ–‡ç« Nginxç¼“å­˜é…ç½®åŠnginx ngx_cache_purgeæ¨¡å—çš„ä½¿ç”¨ æ¨èç¬¬äºŒç§æ–¹æ³•ã€‚","tags":["Nginx"],"categories":["Nginx"]},{"title":"Nginxå†…åµŒå˜é‡","path":"/2019/11/22/Nginx5/","content":"Nginxå†…åµŒå˜é‡æ˜¯éå¸¸å¸¸ç”¨çš„ï¼Œè®°å½•ä¸‹å¤‡æŸ¥ã€‚ Nginxå†…åµŒå˜é‡ç”± ngx_http_core_module æ¨¡å—æ”¯æŒï¼Œå˜é‡åä¸ApacheæœåŠ¡å™¨å¯¹åº”ï¼Œè¿™äº›å˜é‡å¯ä»¥è¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´å­—æ®µï¼Œè¯¸å¦‚$http_user_agentã€$http_cookieç­‰ç­‰ã€‚ nginxä¹Ÿæ”¯æŒå…¶ä»–å˜é‡ï¼š å‚æ•°åç§° è¯´æ˜ $arg_name è¯·æ±‚ä¸­çš„çš„å‚æ•°åï¼Œå³â€œ?â€åé¢çš„arg_name=arg_valueå½¢å¼çš„arg_nameï¼Œå¦‚/index.php?www=www.puresai.comï¼Œå¯ä»¥ç”¨$arg_wwwå°±æ˜¯www.puresai.com $args è¯·æ±‚ä¸­çš„å‚æ•°å€¼ $binary_remote_addr å®¢æˆ·ç«¯åœ°å€çš„äºŒè¿›åˆ¶å½¢å¼, å›ºå®šé•¿åº¦ä¸º4ä¸ªå­—èŠ‚ $body_bytes_sent ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œå“åº”å¤´ä¸è®¡ç®—åœ¨å†…ï¼›è¿™ä¸ªå˜é‡å’ŒApacheçš„mod_log_configæ¨¡å—ä¸­çš„â€œ%Bâ€å‚æ•°ä¿æŒå…¼å®¹ $bytes_sent ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•° $connection TCPè¿æ¥çš„åºåˆ—å· $connection_requests TCPè¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡ $content_length â€œContent-Lengthâ€ è¯·æ±‚å¤´å­—æ®µ $content_type â€œContent-Typeâ€ è¯·æ±‚å¤´å­—æ®µ $cookie_name cookieåç§° $document_root å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«å $document_uri åŒ $uri $host ä¼˜å…ˆçº§å¦‚ä¸‹ï¼šHTTPè¯·æ±‚è¡Œçš„ä¸»æœºå&gt;â€HOSTâ€è¯·æ±‚å¤´å­—æ®µ&gt;ç¬¦åˆè¯·æ±‚çš„æœåŠ¡å™¨å $hostname ä¸»æœºå $http_name åŒ¹é…ä»»æ„è¯·æ±‚å¤´å­—æ®µï¼› å˜é‡åä¸­çš„ååŠéƒ¨åˆ†â€œnameâ€å¯ä»¥æ›¿æ¢æˆä»»æ„è¯·æ±‚å¤´å­—æ®µï¼Œå¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦è·å–httpè¯·æ±‚å¤´ï¼šâ€œAccept-Languageâ€ï¼Œé‚£ä¹ˆå°†â€œï¼â€æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå¤§å†™å­—æ¯æ›¿æ¢ä¸ºå°å†™ï¼Œå½¢å¦‚ï¼š$http_accept_languageå³å¯ã€‚ $https å¦‚æœå¼€å¯äº†SSLå®‰å…¨æ¨¡å¼ï¼Œå€¼ä¸ºâ€œonâ€ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ $is_args å¦‚æœè¯·æ±‚ä¸­æœ‰å‚æ•°ï¼Œå€¼ä¸ºâ€œ?â€ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ $limit_rate ç”¨äºè®¾ç½®å“åº”çš„é€Ÿåº¦é™åˆ¶ï¼Œè¯¦è§ limit_rateã€‚ $msec å½“å‰çš„Unixæ—¶é—´æˆ³ (1.3.9, 1.2.6) $nginx_version nginxç‰ˆæœ¬ $pid å·¥ä½œè¿›ç¨‹çš„PID $pipe å¦‚æœè¯·æ±‚æ¥è‡ªç®¡é“é€šä¿¡ï¼Œå€¼ä¸ºâ€œpâ€ï¼Œå¦åˆ™ä¸ºâ€œ.â€ (1.3.12, 1.2.7) $proxy_protocol_addr è·å–ä»£ç†è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åœ°å€ï¼Œå¦‚æœæ˜¯ç›´æ¥è®¿é—®ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚(1.5.12) $query_string åŒ $argsï¼Œç„¶è€Œ $query_stringæ˜¯åªè¯»çš„ä¸ä¼šæ”¹å˜ $realpath_root å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«åçš„çœŸå®è·¯å¾„ï¼Œä¼šå°†æ‰€æœ‰ç¬¦å·è¿æ¥è½¬æ¢ä¸ºçœŸå®è·¯å¾„ã€‚ $remote_addr å®¢æˆ·ç«¯åœ°å€ $remote_port å®¢æˆ·ç«¯ç«¯å£ $remote_user ç”¨äºHTTPåŸºç¡€è®¤è¯æœåŠ¡çš„ç”¨æˆ·å $request ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚åœ°å€ $request_body å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸»ä½“,æ­¤å˜é‡å¯åœ¨locationä¸­ä½¿ç”¨ï¼Œå°†è¯·æ±‚ä¸»ä½“é€šè¿‡proxy_pass, fastcgi_pass, uwsgi_pass, å’Œ scgi_passä¼ é€’ç»™ä¸‹ä¸€çº§çš„ä»£ç†æœåŠ¡å™¨ã€‚ $request_body_file è¯·æ±‚æ­£æ–‡çš„ä¸´æ—¶æ–‡ä»¶åã€‚å¤„ç†å®Œæˆæ—¶ï¼Œä¸´æ—¶æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚ å¦‚æœå¸Œæœ›æ€»æ˜¯å°†è¯·æ±‚æ­£æ–‡å†™å…¥æ–‡ä»¶ï¼Œéœ€è¦å¼€å¯client_body_in_file_onlyã€‚ å¦‚æœåœ¨è¢«ä»£ç†çš„è¯·æ±‚æˆ–FastCGIè¯·æ±‚ä¸­ä¼ é€’ä¸´æ—¶æ–‡ä»¶åï¼Œå°±åº”è¯¥ç¦æ­¢ä¼ é€’è¯·æ±‚æ­£æ–‡æœ¬èº«ã€‚ ä½¿ç”¨proxy_pass_request_body offæŒ‡ä»¤ å’Œfastcgi_pass_request_body offæŒ‡ä»¤ åˆ†åˆ«ç¦æ­¢åœ¨ä»£ç†å’ŒFastCGIä¸­ä¼ é€’è¯·æ±‚æ­£æ–‡ã€‚ $request_completion å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå€¼ä¸ºâ€OKâ€ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯ä¸€ä¸ªèŒƒå›´è¯·æ±‚çš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ™ä¸ºç©ºã€‚ $request_filename å½“å‰è¿æ¥è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚ $request_length è¯·æ±‚çš„é•¿åº¦ (åŒ…æ‹¬è¯·æ±‚çš„åœ°å€, httpè¯·æ±‚å¤´å’Œè¯·æ±‚ä¸»ä½“) $request_method HTTPè¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸ä¸ºâ€œGETâ€æˆ–â€œPOSTâ€ $request_time å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨çš„æ—¶é—´; ä»è¯»å–å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹è®¡æ—¶ã€‚ $request_uri è¿™ä¸ªå˜é‡ç­‰äºåŒ…å«ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œå®ƒæ— æ³•ä¿®æ”¹ï¼Œè¯·æŸ¥çœ‹$uriæ›´æ”¹æˆ–é‡å†™URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚ï¼šâ€/sai/test.php?arg=wwwâ€ã€‚ $scheme è¯·æ±‚ä½¿ç”¨çš„Webåè®®, â€œhttpâ€ æˆ– â€œhttpsâ€ $sent_http_name å¯ä»¥è®¾ç½®ä»»æ„httpå“åº”å¤´å­—æ®µï¼› å˜é‡åä¸­çš„ååŠéƒ¨åˆ†â€œnameâ€å¯ä»¥æ›¿æ¢æˆä»»æ„å“åº”å¤´å­—æ®µï¼Œå¦‚éœ€è¦è®¾ç½®å“åº”å¤´Content-lengthï¼Œé‚£ä¹ˆå°†â€œï¼â€æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå¤§å†™å­—æ¯æ›¿æ¢ä¸ºå°å†™ï¼Œå½¢å¦‚ï¼š$sent_http_content_length 4096å³å¯ã€‚ $server_addr æœåŠ¡å™¨ç«¯åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ºäº†é¿å…è®¿é—®linuxç³»ç»Ÿå†…æ ¸ï¼Œåº”å°†ipåœ°å€æå‰è®¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚ $server_name æœåŠ¡å™¨å $server_port æœåŠ¡å™¨ç«¯å£ $server_protocol æœåŠ¡å™¨çš„HTTPç‰ˆæœ¬, é€šå¸¸ä¸º â€œHTTP/1.0â€ æˆ– â€œHTTP/1.1â€ $status HTTPå“åº”ä»£ç  $time_iso8601 æœåŠ¡å™¨æ—¶é—´çš„ISO 8610æ ¼å¼ $time_local æœåŠ¡å™¨æ—¶é—´ï¼ˆLOG Format æ ¼å¼ï¼‰ ï¼Œnginxå¤„ç†å®Œæˆæ‰“å°æ—¥å¿—çš„æ—¶é—´ï¼Œä¸æ˜¯è¯·æ±‚å‘å‡ºçš„æ—¶é—´ $uri è¯·æ±‚ä¸­çš„å½“å‰URI(ä¸å¸¦è¯·æ±‚å‚æ•°ï¼Œå‚æ•°ä½äº$args)ï¼Œå¯ä»¥ä¸åŒäºæµè§ˆå™¨ä¼ é€’çš„$request_uriçš„å€¼ï¼Œå®ƒå¯ä»¥é€šè¿‡å†…éƒ¨é‡å®šå‘ï¼Œæˆ–è€…ä½¿ç”¨indexæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚ apacheæœåŠ¡å™¨å˜é‡å¯çœ‹[å¤‡å¿˜] apacheæœåŠ¡ç«¯å˜é‡ å‚è€ƒï¼š ä¸­æ–‡æ–‡æ¡£ Nginx ç›¸å…³æ–‡ç« ï¼š Nginx è´Ÿè½½å‡è¡¡ Nginx æ·»åŠ  lua æ¨¡å— Nginx é…ç½®å¸¸ç”¨å‚æ•°ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† Nginx ä»£ç†ç¼“å­˜","tags":["Nginx"],"categories":["Nginx"]},{"title":"Nginxæ·»åŠ lua-nginxæ¨¡å—","path":"/2019/11/20/Nginx9/","content":"ngx_luaæ˜¯Nginxçš„ä¸€ä¸ªæ¨¡å—ï¼Œå°†LuaåµŒå…¥åˆ°Nginxä¸­ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨Luaæ¥ç¼–å†™è„šæœ¬ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨Luaç¼–å†™åº”ç”¨è„šæœ¬ï¼Œéƒ¨ç½²åˆ°Nginxä¸­è¿è¡Œï¼Œå³Nginxå˜æˆäº†ä¸€ä¸ªWebå®¹å™¨ï¼›è¿™æ ·å¼€å‘äººå‘˜å°±å¯ä»¥ä½¿ç”¨Luaè¯­è¨€å¼€å‘é«˜æ€§èƒ½Webåº”ç”¨äº†ã€‚ å®‰è£…luawget http://luajit.org/download/LuaJIT-2.0.5.tar.gz tar -zxvf LuaJIT-2.0.5.tar.gzcd LuaJIT-2.0.5make &amp;&amp; make install PREFIX=/usr/local/LuaJIT etc/profileåŠ å…¥# luaexport LUAJIT_LIB=/usr/local/LuaJIT/lib export LUAJIT_INC=/usr/local/LuaJIT/include/luajit-2.0 source etc/profile ä¸‹è½½ngx_devel_kitæ¨¡å—wget https://github.com/simpl/ngx_devel_kit/archive/v0.3.0.tar.gz NDK(nginx development kit)æ¨¡å—æ˜¯ä¸€ä¸ªæ‹“å±•nginxæœåŠ¡å™¨æ ¸å¿ƒåŠŸèƒ½çš„æ¨¡å—ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘å¯ä»¥åŸºäºå®ƒæ¥å¿«é€Ÿå®ç°ã€‚ NDKæä¾›å‡½æ•°å’Œå®å¤„ç†ä¸€äº›åŸºæœ¬ä»»åŠ¡ï¼Œ å‡è½»ç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘çš„ä»£ç é‡ ä¸‹è½½lua-nginx-moduleæ¨¡å—wget https://github.com/openresty/lua-nginx-module/archive/v0.10.9rc7.tar.gz lua-nginx-module æ¨¡å—ä½¿nginxä¸­èƒ½ç›´æ¥è¿è¡Œlua æŸ¥çœ‹åŸå§‹ç¼–è¯‘ nginx -V å¦‚ï¼šconfigure arguments: --user=www --group=www --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --with-http_sub_module --with-http_v2_module è¿›å…¥nginxåŸå§‹ç›®å½•ï¼š ./configure --user=www --group=www --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_gzip_static_module --with-http_sub_module --with-http_v2_module --add-module=/root/lua-nginx-module-0.10.9rc7/ --add-module=/root/ngx_devel_kit-0.3.0 åªmakeï¼Œä¸æ‰§è¡Œmake installã€‚ ç¼–è¯‘æŠ¥é”™åº”è¯¥å°±æ˜¯luaç¯å¢ƒå˜é‡ä¸å¯¹ã€‚ nginx -V å‘½ä»¤æŠ¥é”™./nginx: error while loading shared libraries: libluajit-5.1.so.2: cannot open shared object file: No such file or directoryè§£å†³ï¼šecho &quot;/usr/local/LuaJIT/lib&quot; &gt;&gt; /etc/ld.so.confldconfig æˆåŠŸä¹‹åå¯ä»¥nginx -VæŸ¥çœ‹ï¼Œæ— æŠ¥é”™å³å¯ã€‚ æŠŠåŸæ¥çš„nginxå¤‡ä»½ä¸ºnginx_old cp objs/nginxåˆ°åŸæ¥çš„nginxå¹¶è¦†ç›–ã€‚ åœ¨ç¼–è¯‘ç›®å½•æ‰§è¡Œ make upgrade æµ‹è¯•ï¼š server&#123; ... location /lua &#123; default_type &#x27;text/html&#x27;; content_by_lua &#x27; ngx.say(&quot;hello, lua!&quot;) &#x27;; &#125; ...&#125; æµè§ˆå™¨æ‰“å¼€ï¼š http://blog.puresai.com/lua å¯ä»¥çœ‹åˆ°hello, lua! æ­¤å®‰è£…æ–¹æ³•ä¹Ÿé€‚ç”¨äºNginxå…¶ä»–moduleå®‰è£…ã€‚","tags":["Nginx"],"categories":["Nginx"]},{"title":"gitå›é€€è¿œç¨‹åˆ†æ”¯ç‰ˆæœ¬","path":"/2019/10/29/201/","content":"å¶å°”ä¼šæœ‰ä»£ç æäº¤é”™è¯¯ï¼Œåˆæäº¤åˆ°è¿œç¨‹åˆ†æ”¯äº†ï¼Œæ€ä¹ˆå›é€€å‘¢ï¼Ÿ å¼ºåˆ¶å›é€€# æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰¾åˆ°å¯¹åº”çš„commit idgit loggit reset --hard å›é€€çš„ç‰ˆæœ¬idgit push -f origin åˆ†æ”¯å è¿™æ ·å›é€€æ˜¯æ¸…é™¤äº†å›é€€çš„ç‰ˆæœ¬idä¹‹åçš„æäº¤ï¼Œè¿æ—¥å¿—éƒ½æ²¡æœ‰äº†ã€‚ å›é€€ç‰ˆæœ¬# æŸ¥çœ‹æ—¥å¿—ï¼Œæ‰¾åˆ°å¯¹åº”çš„commit idgit loggit reset --soft å›é€€çš„ç‰ˆæœ¬idgit commit è¿™æ ·å›é€€æ˜¯æ”¹å›å›é€€çš„ç‰ˆæœ¬idä¹‹åçš„æäº¤ï¼Œæ—¥å¿—ä»ç„¶å­˜åœ¨ã€‚","tags":["git"],"categories":["CI"]},{"title":"php+nginxä¸Šä¼ æ–‡ä»¶413","path":"/2019/10/09/200/","content":"æœ€è¿‘åœ¨é¡¹ç›®ä¸­ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸Šä¼ å‡ºé”™ï¼Œè¿”å›413 Request Entity Too Large è§£å†³æ–¹æ³•ï¼šï¼ˆå…·ä½“å¤§å°è§†ä¸šåŠ¡è€Œå®šï¼‰ ä»¥ä¸‹ä»£ç åŠ å…¥ nginx.conf æ–‡ä»¶ä¸­çš„ http{ â€¦ } å—ä¸­ client_max_body_size 32M; PHP è®¾ç½®ä¸Šä¼ å¤§å° æ‰“å¼€php.ini æ–‡ä»¶ä¸­ ä¿®æ”¹ä»¥ä¸‹å‡ ä¸ªå‚æ•° memory_limit = 32Mupload_max_filesize = 8Mpost_max_size = 16M é‡å¯nginxï¼Œfpmå³å¯ã€‚","tags":["PHP","Nginx"],"categories":["PHP"]},{"title":"é€šè¿‡mysqlbinlogæ¢å¤è¯¯æ“ä½œæ¸…ç©ºçš„è¡¨","path":"/2019/09/08/198/","content":"ä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«é€šè¿‡mysqlbinlogæ¢å¤è¯¯æ“ä½œæ¸…ç©ºçš„è¡¨ï¼Œåˆ†äº«æ¥æºäºå‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„çœŸå®äº‹ä»¶ã€‚ èƒŒæ™¯æŸä¸ªæœˆé»‘é£é«˜çš„å¤œæ™šï¼Œæœ‹å‹å¾®ä¿¡æ‰¾åˆ°æˆ‘è¯´ï¼Œæ•°æ®åº“ä¸­æŸä¸ªè¡¨è¢«å¼€å‘äººå‘˜è¯¯åˆ äº†ï¼Œè€æ¿è¿˜åœ¨æ­£åœ¨æµ‹è¯•åŠŸèƒ½ï¼Œå¼€å‘å­¦è‰ºä¸ç²¾ï¼Œæ…Œäº†ï¼Œä¸çŸ¥é“æ€ä¹ˆåŠäº†ã€‚ æˆ‘é—®ä»–æ˜¯å¦å¼€å¯äº†binlogï¼Œå¹¶æŠŠä»¥ä¸‹å‘½ä»¤å‘ç»™ä»–ã€‚ show variables like â€˜log_binâ€™; å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œä»–ä»¬çš„ç”Ÿäº§æ•°æ®åº“å¼€äº†binlogã€‚ç„¶åè·Ÿä»–è¯´äº†ä¸‹å¯ä»¥æ¢å¤ï¼Œå¹¶åˆ†äº«äº†æ–‡ç« è®©é‚£è¾¹å¼€å‘äººå‘˜æ“ä½œä¸€ä¸‹ã€‚ ç»“æœåŠå°æ—¶ä¹‹åï¼Œæœ‹å‹é—®æˆ‘èƒ½ä¸èƒ½å¸®å¿™æ“ä½œï¼Œå…¶å®æˆ‘å†…å¿ƒæ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºä¸æƒ³ç»™è‡ªå·±æ‰¾éº»çƒ¦ï¼Œä½†æƒ³åˆ°æˆ‘è²Œä¼¼æ²¡æœ‰çº¿ä¸Šå®æ“è¿‡ï¼Œè¯´æ˜é¡¾è™‘åŠå®‰å…¨æ€§é—®é¢˜åï¼Œå¯¹æ–¹åŒæ„ä¾¿å†³å®šå°è¯•ä¸€ä¸‹ã€‚ æ¢å¤æ­¥éª¤æ“ä½œæ­¥éª¤å¦‚ä¸‹: æ‰¾åˆ°å­˜æ”¾binlogçš„ç›®å½•ï¼Œä½¿ç”¨ mysqlbinlog mysqlbinlog mysql-bin.000011 &gt; bak.log æ‰¾åˆ°åˆ é™¤çš„è¯­å¥æ—¶é—´ï¼Œä½¿ç”¨çš„æ˜¯truncateï¼Œå› ä¸ºé¡¹ç›®æœªä¸Šçº¿ï¼Œlog ä¸å¤§ï¼Œç›´æ¥ grep å³å¯ å†æ¬¡åˆ©ç”¨ mysqlbinlog å¯¼å‡ºsql è¯­å¥ï¼Œæ–¹ä¾¿åç»­å¿«é€Ÿå¯¼å…¥ mysqlbinlog â€“stop-datetime=â€2019-09-07 17:30:31â€ mysql-bin.000011 &gt;all.sql stop-datetimeåº”è¯¥æ˜¯è¯¯åˆ æ“ä½œå‰ä¸€åˆ»æ—¶é—´ã€‚ ä¸‹è½½ all.sql å€’å…¥æœ¬åœ°æ•°æ®åº“ï¼Œæ£€æŸ¥æ— å¼‚å¸¸ï¼Œå¯¼å‡ºè¯¯åˆ è¡¨ï¼Œç›´æ¥å°†è¯¯åˆ è¡¨å¯¼å…¥ç”Ÿäº§æ•°æ®åº“ã€‚ å‘ŠçŸ¥å¯¹æ–¹æ£€æµ‹ç”Ÿäº§æ•°æ®åº“ è¿™ä¸ªäº‹æƒ…å°±è¿™ä¹ˆå‘Šä¸€æ®µè½äº†ï¼Œæ²¡æœ‰ä»»ä½•é…¬åŠ³ï¼ŒçœŸå°æ°”ã€‚ã€‚ã€‚ åæ€æ™šä¸Šæˆ‘åæ€äº†ä¸€ä¸‹ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š æ•°æ®åº“é‡è¦æ•°æ®å°½é‡ä¸€å¤©ä¸€å¤‡ä»½ï¼Œç„¶åå¼€å¯binlogï¼Œä¸ºäº†å‡å°‘ç¡¬ç›˜ç©ºé—´å ç”¨ï¼Œè®¾ç½®expire_logs_days ç”Ÿäº§æ•°æ®åº“ä¸ä½¿ç”¨rootç”¨æˆ·ï¼Œæ–°å»ºç”¨æˆ·ï¼Œé™åˆ¶dropï¼Œtruncateç­‰å±é™©æ“ä½œæƒé™ é‡äº‹åˆ«æ…Œï¼Œè‡ªå·±å°è¯•è§£å†³ï¼Œè§£å†³ä¸äº†è¯·æ•™åˆ«äººï¼Œå¿«é€Ÿè§£å†³é—®é¢˜æ‰æ˜¯å…³é”® å¸®å¿™å¯ä»¥å¸®ï¼Œä½†è¦è¯´æ¸…æ¥šï¼Œåˆ«è¢«å‘äº† å¯¼å‡ºsqlæ—¶åº”è¯¥æŒ‡å®šæ•°æ®åº“ï¼Œæ¯”å¦‚ mysqlbinlog â€“stop-datetime=â€2022-09-07 17:30:31â€ â€“database=test mysql-bin.000893 &gt;all.sql å‚è€ƒ mysqlbin","tags":["MySQL"],"categories":["db"]},{"title":"laravelé»˜è®¤åˆ†é¡µå¸¦å‚","path":"/2019/09/02/196/","content":"é»˜è®¤çš„laravelåˆ†é¡µæ˜¯åªå¸¦åˆ†é¡µå‚æ•°çš„ï¼Œé‚£ä¹ˆå¦‚ä½•åŠ å…¥å…¶å®ƒå‚æ•°å‘¢ï¼Ÿæ¯”å¦‚æœç´¢é¡¹ã€‚ åç«¯å¸¦å‚ $list = $model::paginate(2);$list-&gt;appends([ name=&gt;$name, city=&gt;$city,])-&gt;render();return view(admin, [ list =&gt; $list]);// bladeä½¿ç”¨&#123;&#123; $list-&gt;links() &#125;&#125; å‰ç«¯å¸¦å‚ $list = $model::paginate(2);return view(admin.apply.apply, [ list =&gt; $list, name =&gt; $name, city =&gt; $city]);//å‰ç«¯&#123;&#123; $list-&gt;appends([name=&gt;$name, city =&gt; $city])-&gt;links() &#125;&#125; ä¸¤ç§æ–¹æ³•å‡å¯ï¼","tags":["Laravel"],"categories":["PHP"]},{"title":"å­¦ä¹ goé‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œæ¦‚å¿µæ±‡æ€»","path":"/2019/08/25/195/","content":"go getå®‰è£…x/syså¤±è´¥çš„è§£å†³// $GOPATHè¿™æ®µåœ°å€è¯·è‡ªè¡Œä¿®æ”¹ï¼Œä¸‹è½½åˆ°gorootå’Œgopathå¯¹åº”ä½ç½®å³å¯ï¼Œä¸åŒç³»ç»Ÿç•¥æœ‰ä¸åŒgit clone https://github.com/golang/net.git $GOPATH/src/github.com/golang/netgit clone https://github.com/golang/sys.git $GOPATH/src/github.com/golang/sysgit clone https://github.com/golang/tools.git $GOPATH/src/github.com/golang/toolsln -s $GOPATH/src/github.com/golang $GOPATH/src/golang.org/x go getå‘½ä»¤å®‰è£…golang.orgæ¯”è¾ƒæ…¢çš„è¯ï¼Œä¸€èˆ¬éƒ½å¯ä»¥åœ¨github.comæ‰¾åˆ°å¯¹åº”çš„packageï¼Œä¸‹è½½åæ”¾åˆ°å¯¹åº”çš„ç›®å½•å³å¯ goçš„ç¯å¢ƒå˜é‡è®¾ç½®åœ¨/etc/profileæœ€ä¸‹é¢åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š # å¯è‡ªè¡Œæ”¹æˆä½ çš„ç›®å½•export GO_INSTALL_DIR=$HOMEexport GOROOT=$GO_INSTALL_DIR/goexport GOPATH=$HOME/mygoexport PATH=$GOPATH/bin:$PATH:$GO_INSTALL_DIR/go/bin import import _ æ‰§è¡Œinitå‡½æ•°ï¼Œä½†ä¸éœ€è¦åŒ…æ‰€æœ‰å‡½æ•° import . è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ &amp;å’Œ* &amp;ç¬¦å·çš„æ„æ€æ˜¯å¯¹å˜é‡å–åœ°å€ï¼Œå¦‚ï¼šå˜é‡açš„åœ°å€æ˜¯&amp;aç¬¦å·çš„æ„æ€æ˜¯å¯¹æŒ‡é’ˆå–å€¼ï¼Œå’Œè½&amp;è½å¯ä»¥äº’ç›¸æŠµæ¶ˆ,åŒæ—¶æ³¨æ„ï¼Œ*&amp;å¯ä»¥æŠµæ¶ˆæ‰ï¼Œä½†&amp;*æ˜¯ä¸å¯ä»¥æŠµæ¶ˆçš„ åˆ‡ç‰‡å®¹é‡ å®¹é‡å½“åšæˆæ€»é•¿åº¦å‡å»å·¦æŒ‡é’ˆèµ°è¿‡çš„å…ƒç´ å€¼ ä¸€æ—¦ä¸€ä¸ªåˆ‡ç‰‡æ— æ³•å®¹çº³æ›´å¤šçš„å…ƒç´ ï¼ŒGoè¯­è¨€å°±ä¼šæƒ³åŠæ³•æ‰©å®¹ã€‚ä½†å®ƒå¹¶ä¸ä¼šæ”¹å˜åŸæ¥çš„åˆ‡ç‰‡ï¼Œè€Œæ˜¯ä¼šç”Ÿæˆä¸€ä¸ªå®¹é‡æ›´å¤§çš„åˆ‡ç‰‡ï¼Œç„¶åå°†æŠŠåŸæœ‰çš„å…ƒç´ å’Œæ–°å…ƒç´ ä¸€å¹¶æ‹·è´åˆ°æ–°åˆ‡ç‰‡ä¸­ã€‚åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ç®€å•åœ°è®¤ä¸ºæ–°åˆ‡ç‰‡çš„å®¹é‡ï¼ˆä»¥ä¸‹ç®€ç§°æ–°å®¹é‡ï¼‰å°†ä¼šæ˜¯åŸåˆ‡ç‰‡å®¹é‡ï¼ˆä»¥ä¸‹ç®€ç§°åŸå®¹é‡ï¼‰çš„2å€ã€‚ä½†æ˜¯ï¼Œå½“åŸåˆ‡ç‰‡çš„é•¿åº¦ï¼ˆä»¥ä¸‹ç®€ç§°åŸé•¿åº¦ï¼‰å¤§äºæˆ–ç­‰äº1024æ—¶ï¼ŒGoè¯­è¨€å°†ä¼šä»¥åŸå®¹é‡çš„1.25å€ä½œä¸ºæ–°å®¹é‡çš„åŸºå‡†ï¼ˆä»¥ä¸‹æ–°å®¹é‡åŸºå‡†ï¼‰ã€‚æ–°å®¹é‡åŸºå‡†ä¼šè¢«è°ƒæ•´ï¼ˆä¸æ–­åœ°ä¸1.25ç›¸ä¹˜ï¼‰ï¼Œç›´åˆ°ç»“æœä¸å°äºåŸé•¿åº¦ä¸è¦è¿½åŠ çš„å…ƒç´ æ•°é‡ä¹‹å’Œï¼ˆä»¥ä¸‹ç®€ç§°æ–°é•¿åº¦ï¼‰ã€‚æœ€ç»ˆï¼Œæ–°å®¹é‡å¾€å¾€ä¼šæ¯”æ–°é•¿åº¦å¤§ä¸€äº›ï¼Œå½“ç„¶ï¼Œç›¸ç­‰ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä¸€æ¬¡è¿½åŠ çš„å…ƒç´ è¿‡å¤šï¼Œä»¥è‡³äºä½¿æ–°é•¿åº¦æ¯”åŸå®¹é‡çš„2å€è¿˜è¦å¤§ï¼Œé‚£ä¹ˆæ–°å®¹é‡å°±ä¼šä»¥æ–°é•¿åº¦ä¸ºåŸºå‡†ã€‚ å¤§å°å†™ åœ¨Goè¯­è¨€ä¸­ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªæ–¹æ³•ã€å‡½æ•°æˆ–è€…ç±»å‹æ˜¯å¦ä¸ºå…¬å¼€çš„ï¼ŒGoè¯­è¨€æä¾›çš„æ˜¯ä»¥å¤§å°å†™çš„æ–¹å¼è¿›è¡ŒåŒºåˆ†çš„ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„åå­—æ˜¯ä»¥å¤§å†™å¼€å¤´ï¼Œé‚£ä¹ˆå…¶ä»–åŒ…å°±å¯ä»¥è®¿é—®ï¼›å¦‚æœä»¥å°å†™å¼€å¤´ï¼Œå…¶ä»–åŒ…å°±ä¸èƒ½è®¿é—®ã€‚ goçš„å¹¶å‘ æ¦‚å¿µ è¯´æ˜ è¿›ç¨‹ ä¸€ä¸ªç¨‹åºå¯¹åº”ä¸€ä¸ªç‹¬ç«‹ç¨‹åºç©ºé—´ çº¿ç¨‹ ä¸€ä¸ªæ‰§è¡Œç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ é€»è¾‘å¤„ç†å™¨ æ‰§è¡Œåˆ›å»ºçš„goroutineï¼Œç»‘å®šä¸€ä¸ªçº¿ç¨‹ è°ƒåº¦å™¨ Goè¿è¡Œæ—¶ä¸­çš„ï¼Œåˆ†é…goroutineç»™ä¸åŒçš„é€»è¾‘å¤„ç†å™¨ å…¨å±€è¿è¡Œé˜Ÿåˆ— æ‰€æœ‰åˆšåˆ›å»ºçš„goroutineéƒ½ä¼šæ”¾åˆ°è¿™é‡Œ æœ¬åœ°è¿è¡Œé˜Ÿåˆ— é€»è¾‘å¤„ç†å™¨çš„goroutineé˜Ÿåˆ— å¹¶å‘çš„æ¦‚å¿µå’Œå¹¶è¡Œä¸ä¸€æ ·ï¼Œå¹¶è¡ŒæŒ‡çš„æ˜¯åœ¨ä¸åŒçš„ç‰©ç†å¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œä¸åŒçš„ä»£ç ç‰‡æ®µï¼Œå¹¶è¡Œå¯ä»¥åŒæ—¶åšå¾ˆå¤šäº‹æƒ…ï¼Œè€Œå¹¶å‘æ˜¯åŒæ—¶ç®¡ç†å¾ˆå¤šäº‹æƒ…ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„æ€»èµ„æºæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¹¶å‘çš„æ•ˆæœè¦æ¯”å¹¶è¡Œå¥½çš„å¤šï¼Œä½¿ç”¨è¾ƒå°‘çš„èµ„æºåšæ›´å¤šçš„äº‹æƒ…ï¼Œä¹Ÿæ˜¯Goè¯­è¨€æå€¡çš„ã€‚ é€šé“h:=make(chan int)é€šé“ç±»å‹å’ŒMapè¿™äº›ç±»å‹ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„makeå‡½æ•°å£°æ˜åˆå§‹åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬åˆå§‹åŒ–äº†ä¸€ä¸ªchan intç±»å‹çš„é€šé“ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å¾€è¿™ä¸ªé€šé“é‡Œå‘é€intç±»å‹çš„æ•°æ®ï¼Œå½“ç„¶æ¥æ”¶ä¹Ÿåªèƒ½æ˜¯intç±»å‹çš„æ•°æ®ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œé€šé“æ˜¯ç”¨äºåœ¨goroutineä¹‹é—´é€šä¿¡çš„ï¼Œå®ƒå…·æœ‰å‘é€å’Œæ¥æ”¶ä¸¤ä¸ªæ“ä½œï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæ“ä½œçš„è¿ç®—ç¬¦éƒ½æ˜¯&lt;-ã€‚ch &lt;- 2 //å‘é€æ•°å€¼2ç»™è¿™ä¸ªé€šé“x:=&lt;-ch //ä»é€šé“é‡Œè¯»å–å€¼ï¼Œå¹¶æŠŠè¯»å–çš„å€¼èµ‹å€¼ç»™xå˜é‡&lt;-ch //ä»é€šé“é‡Œè¯»å–å€¼ï¼Œç„¶åå¿½ç•¥çœ‹ä¾‹å­ï¼Œæ…¢æ…¢ç†è§£å‘é€å’Œæ¥æ”¶çš„ç”¨æ³•ã€‚å‘é€æ“ä½œ&lt;-åœ¨é€šé“çš„åé¢ï¼Œçœ‹ç®­å¤´æ–¹å‘ï¼Œè¡¨ç¤ºæŠŠæ•°å€¼2å‘é€åˆ°é€šé“ché‡Œï¼›æ¥æ”¶æ“ä½œ&lt;-åœ¨é€šé“çš„å‰é¢ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªä¸€å…ƒæ“ä½œç¬¦ï¼Œçœ‹ç®­å¤´æ–¹å‘ï¼Œè¡¨ç¤ºä»é€šé“ché‡Œè¯»å–æ•°æ®ã€‚è¯»å–çš„æ•°æ®å¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥ã€‚é€šé“æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å†…ç½®çš„closeå‡½æ•°å…³é—­ã€‚close(ch) æ— ç¼“å†²çš„é€šé“æ— ç¼“å†²çš„é€šé“æŒ‡çš„æ˜¯é€šé“çš„å¤§å°ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§ç±»å‹çš„é€šé“åœ¨æ¥æ”¶å‰æ²¡æœ‰èƒ½åŠ›ä¿å­˜ä»»ä½•å€¼ï¼Œå®ƒè¦æ±‚å‘é€goroutineå’Œæ¥æ”¶goroutineåŒæ—¶å‡†å¤‡å¥½ï¼Œæ‰å¯ä»¥å®Œæˆå‘é€å’Œæ¥æ”¶æ“ä½œã€‚ ä»ä¸Šé¢æ— ç¼“å†²çš„é€šé“å®šä¹‰æ¥çœ‹ï¼Œå‘é€goroutineå’Œæ¥æ”¶gouroutineå¿…é¡»æ˜¯åŒæ­¥çš„ï¼ŒåŒæ—¶å‡†å¤‡åï¼Œå¦‚æœæ²¡æœ‰åŒæ—¶å‡†å¤‡å¥½çš„è¯ï¼Œå…ˆæ‰§è¡Œçš„æ“ä½œå°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªç›¸å¯¹åº”çš„æ“ä½œå‡†å¤‡å¥½ä¸ºæ­¢ã€‚è¿™ç§æ— ç¼“å†²çš„é€šé“æˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸ºåŒæ­¥é€šé“ã€‚ func main() &#123; ch := make(chan int) go func() &#123; var sum int = 0 for i := 0; i &lt; 10; i++ &#123; sum += i &#125; ch &lt;- sum &#125;() fmt.Println(&lt;-ch)&#125; æœ‰ç¼“å†²çš„é€šé“æœ‰ç¼“å†²é€šé“ï¼Œå…¶å®æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨makeå‡½æ•°åˆ›å»ºé€šé“æ—¶ï¼Œé€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„ã€‚ ch := make(chan int, 3)è¿™é‡Œåˆ›å»ºå®¹é‡ä¸º3çš„ï¼Œæœ‰ç¼“å†²çš„é€šé“ã€‚å¯¹äºæœ‰ç¼“å†²çš„é€šé“ï¼Œå‘å…¶å‘é€æ“ä½œå°±æ˜¯å‘é˜Ÿåˆ—çš„å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œæ¥æ”¶æ“ä½œåˆ™æ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›è¿™ä¸ªåˆšåˆšåˆ é™¤çš„å…ƒç´ ã€‚ å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå‘é€æ“ä½œä¼šé˜»å¡ï¼›å½“é˜Ÿåˆ—ç©ºçš„æ—¶å€™ï¼Œæ¥å—æ“ä½œä¼šé˜»å¡ã€‚æœ‰ç¼“å†²çš„é€šé“ï¼Œä¸è¦æ±‚å‘é€å’Œæ¥æ”¶æ“ä½œæ—¶åŒæ­¥çš„ï¼Œç›¸åå¯ä»¥è§£è€¦å‘é€å’Œæ¥æ”¶æ“ä½œã€‚ æƒ³çŸ¥é“é€šé“çš„å®¹é‡ä»¥åŠé‡Œé¢æœ‰å‡ ä¸ªå…ƒç´ æ•°æ®æ€ä¹ˆåŠï¼Ÿå…¶å®å’Œmapä¸€æ ·ï¼Œä½¿ç”¨capå’Œlenå‡½æ•°å°±å¯ä»¥äº†ã€‚ cap(ch)len(ch) capå‡½æ•°è¿”å›é€šé“çš„æœ€å¤§å®¹é‡ï¼Œlenå‡½æ•°è¿”å›ç°åœ¨é€šé“é‡Œæœ‰å‡ ä¸ªå…ƒç´ ã€‚ func mirroredQuery() string &#123; responses := make(chan string, 3) go func() &#123; responses &lt;- request(&quot;asia.gopl.io&quot;) &#125;() go func() &#123; responses &lt;- request(&quot;europe.gopl.io&quot;) &#125;() go func() &#123; responses &lt;- request(&quot;americas.gopl.io&quot;) &#125;() return &lt;-responses // return the quickest response&#125;func request(hostname string) (response string) &#123; /* ... */ &#125; å•å‘é€šé“æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œæ¯”å¦‚é™åˆ¶ä¸€ä¸ªé€šé“åªå¯ä»¥æ¥æ”¶ï¼Œä½†æ˜¯ä¸èƒ½å‘é€ï¼›æœ‰æ—¶å€™é™åˆ¶ä¸€ä¸ªé€šé“åªèƒ½å‘é€ï¼Œä½†æ˜¯ä¸èƒ½æ¥æ”¶ï¼Œè¿™ç§é€šé“æˆ‘ä»¬ç§°ä¸ºå•å‘é€šé“ã€‚è¿™ä¸ªåœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…å¾ˆå®ç”¨ã€‚ å®šä¹‰å•å‘é€šé“ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œå¸¦ä¸Š&lt;-å³å¯ã€‚ var send chan&lt;- int //åªèƒ½å‘é€var receive &lt;-chan int //åªèƒ½æ¥æ”¶","tags":["go"],"categories":["go"]},{"title":"åˆ©ç”¨jenkinså‘å¸ƒä»£ç ","path":"/2019/07/31/194/","content":"å®‰è£…jenkinsdocker run \\ -u root \\ --rm \\ -d \\ -p 8090:8080 \\ -p 50000:50000 \\ -v jenkins-data:/var/jenkins_home \\ -v /var/run/docker.sock:/var/run/docker.sock \\ jenkinsci/blueocean è¿›å…¥å®¹å™¨æŸ¥çœ‹å¯†ç ï¼š docker exec -it 6d1a7f988069 /bin/bash å¯†ç å­˜å‚¨è·¯å¾„ /var/jenkins_home/secrets/initialAdminPassword jenkinså…³è”gitï¼Œæ‹‰å–æ— éœ€å¯†ç éªŒè¯// äº§ç”Ÿå…¬é’¥ä¸ç§é’¥å¯¹.ssh-keygen// ç”¨ssh-copy-idå°†å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨ä¸­(gitlabç­‰)ssh-copy-id -i .ssh/id_rsa.pub git@xxx.com jenkinså…³è”ä»£ç æœåŠ¡å™¨ï¼ŒåŒæ­¥æ— éœ€å¯†ç éªŒè¯// å°½é‡ä½¿ç”¨å†…ç½‘ipscp -p .ssh/id_rsa.pub www@172.17.158.15:/home/www/.ssh/authorized_keys æ–°å»ºé¡¹ç›® é€‰æ‹©è‡ªç”±é£æ ¼é¡¹ç›® Source Code Managementå¡«å†™gitåœ°å€ Buildæ‰§è¡Œshellè„šæœ¬ shell demo #!/bin/bashecho $&#123;BUILD_USER&#125;SOURCE_DIR=/var/jenkins_home/workspace/$&#123;JOB_NAME&#125;/DEST_DIR=/usr/local/nginx/html/jenkinsREMOTE_IP=172.17.158.15scp -r $SOURCE_DIR www@$REMOTE_IP:$DEST_DIR ä¿å­˜åç‚¹å‡»æ„å»ºã€‚åŸç†ï¼šjenkinsæ‹‰å–gitä»£ç jenkinsæœåŠ¡å™¨ï¼ŒscpåŒæ­¥ä»£ç åˆ°ä»£ç æœåŠ¡å™¨ã€‚ æ˜“å‡ºé”™ç‚¹ï¼š æœåŠ¡å™¨ç›®å½•æƒé™é—®é¢˜ gitæ‹‰å–sshéªŒè¯ ç›®å½• æ„å»ºæ—¶å¯æŸ¥çœ‹Console Outputä¿¡æ¯ï¼Œèƒ½çœ‹å‡ºå“ªä¸€æ­¥é”™è¯¯ï¼Œç„¶åå¤„ç†å³å¯ã€‚","tags":["jenkins"],"categories":["CI"]},{"title":"nginxæ—¥å¿—æŒ‰æ—¥é…ç½®","path":"/2019/07/23/Nginx8/","content":"è€å®è¯´ï¼Œæˆ‘è§‰å¾—nginxæ²¡æœ‰æ—¥å¿—æŒ‰æ—¥é…ç½®åŠŸèƒ½ç¼ºå¤±æœ‰ç‚¹è´¹è§£ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç å®ç°ã€‚é…ç½®å¦‚ä¸‹ï¼š if ($time_iso8601 ~ &quot;^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;)&quot;) &#123; set $day $1$2$3;&#125;access_log logs/access-$day.log main;","tags":["Nginx"],"categories":["Nginx"]},{"title":"lua+nginxå®ç°é»‘åå•ç¦æ­¢è®¿é—®","path":"/2019/07/16/192/","content":"Lua æ˜¯å¯ä»¥å¾ˆå¥½åœ°å’ŒNginxé…åˆä½¿ç”¨çš„ï¼Œå¸¦ç›´æ¥ä½¿ç”¨ Nginx æ˜¯éœ€è¦å®‰è£…æ‰©å±•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åŠ›æ±‚ç®€å•ï¼Œçœå»å®‰è£…ï¼Œä½¿ç”¨OpenRestyï¼ˆåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼‰ï¼Œåœ°å€:OpenRestyåœ°å€ è¯´æ˜ï¼šæˆ‘æ˜¯åœ¨windows7ç”µè„‘ä¸Šæµ‹è¯•ä½¿ç”¨ ä¸»è¦é…ç½®ä»£ç å¦‚ä¸‹ï¼š lua_shared_dict ip_blacklist 1m;server &#123; listen 80; server_name localhost; root E:/www/web/test; access_log logs/host.access.log ; error_log logs/host.error.log; location / &#123; access_by_lua_file ../lua/black.lua; index index.html index.htm; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; location ~ \\.php$ &#123; access_by_lua_file &quot;D:\\openresty-1.15.8.1-win64/lua/black.lua&quot;; fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; &#125;&#125; ç®€è¦è¯´æ˜: lua_shared_dict åˆ†é…ç»™ip_blacklistçš„å†…å­˜ï¼Œå¯æ ¹æ®ä¸šåŠ¡é‡è‡ªè¡Œå†³å®šaccess_by_lua_file æŒ‡å®š lua æ–‡ä»¶ black.lua ä»£ç å¦‚ä¸‹[è¯´æ˜è¾ƒå¤šï¼Œç›´æ¥æ”¾æ³¨é‡Šäº†]: local Redis_host = &quot;127.0.0.1&quot; -- Redisçš„IPåœ°å€local Redis_port = &quot;6379&quot;-- è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½msï¼Œä¸å»ºè®®è®¾ç½®å¤ªé«˜local Redis_connection_timeout = 1000local Redis_key = &quot;ip_blacklist&quot;-- ç¼“å­˜æ—¶é—´ï¼Œå•ä½ slocal cache_ttl = 100-- ä»¥ä¸Šæ˜¯é…ç½®local ip = ngx.var.remote_addrlocal ip_blacklist = ngx.shared.ip_blacklistlocal last_update_time = ip_blacklist:get(&quot;last_update_time&quot;);-- å½“ç¼“å­˜æ—¶é—´åˆ°æœŸæ›´æ–°blacklistif last_update_time == nil or last_update_time &lt; ( ngx.now() - cache_ttl ) then local Redis = require &quot;resty.Redis&quot;; local red = Redis:new(); red:set_timeout(Redis_connect_timeout); local ok, err = red:connect(Redis_host, Redis_port); if not ok then ngx.say(&quot;Redis connect failed: &quot;, err) ngx.log(ngx.DEBUG, &quot;Redis connection error while retrieving ip_blacklist: &quot; .. err); return ngx.exit(ngx.HTTP_INTERNAL_SERVER_ERROR) else -- local res, err = red:auth(&quot;foobared&quot;) -- é…ç½®Redisçš„å¯†ç ï¼Œæˆ‘æµ‹è¯•æœªè®¾ç½®å¯†ç ï¼Œä»£ç æ³¨é‡Š --if not res then --ngx.say(&quot;Redis auth is error: &quot;, err) --return --end red:select(0) local new_ip_blacklist, err = red:smembers(Redis_key); if err then ngx.log(ngx.DEBUG, &quot;Redis read error while retrieving ip_blacklist: &quot; .. err); else -- æƒ…å†µæœ¬åœ°å­˜å‚¨ ip_blacklist:flush_all(); for index, banned_ip in ipairs(new_ip_blacklist) do ip_blacklist:set(banned_ip, true); end -- æ›´æ–°æ—¶é—´ ip_blacklist:set(&quot;last_update_time&quot;, ngx.now()); end endendif ip_blacklist:get(ip) then --ngx.say(ip) ngx.log(ngx.DEBUG, &quot;Banned IP detected and refused access: &quot; .. ip); return ngx.exit(ngx.HTTP_FORBIDDEN);end è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªé»‘åå•åŠŸèƒ½å®Œæˆã€‚ å½“ç„¶äº†ï¼Œè¿™åªæ˜¯ä¸ªåŸºç¡€ç‰ˆæœ¬ï¼Œä½ å¯ä»¥è®©è¿™ä¸ªç¦æ­¢è®¿é—®åŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ¯”å¦‚å¢åŠ å¯ç–‘ipå†™å…¥ï¼Œæ¯”å¦‚å¢åŠ ipé™æµç­‰ç­‰ã€‚","tags":["Linux"],"categories":["linux"]},{"title":"Laravelç®¡ç†æ—¥å¿—","path":"/2019/07/04/191/","content":"æ—¥å¿—æ˜¯å¾ˆé‡è¦çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå¦‚ä½•é…ç½®èƒ½è®©Laravelæ›´å¥½ç®¡ç†å’ŒæŸ¥çœ‹å‘¢ï¼Ÿ æŒ‰æ—¥æŸ¥çœ‹è®¾ç½®ç®€å•ï¼Œåœ¨.envåŠ å…¥APP_LOG=dailyï¼Œå¦å¤–å¯å®šä¹‰æœ€å¤§æ—¥å¿—ä¿å­˜å¤©æ•°åœ¨é…ç½®æ–‡ä»¶config/app.phpä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼šlog_max_files=&gt;30 æ”¶é›†é‡è¦æ—¥å¿—Log::useFiles(storage_path(logs/important.log));// æŒ‰æ—¥ï¼Œå­˜å‚¨30å¤©çš„Log::useDailyFiles(storage_path(logs/importantDaily.log, 30));","tags":["Laravel"],"categories":["PHP"]},{"title":"Laravelæ¨¡æ¿æ¸²æŸ“çš„é—®é¢˜","path":"/2019/05/22/189/","content":"1. laravelæ¨¡æ¿å˜é‡ç¬¦æ›´æ”¹å‰å‡ å¤©æ”¹ç‰ˆæ—¶ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯ä½¿ç”¨äº†art-templateï¼Œåˆšå¥½æœ‰å’ŒLaravelé»˜è®¤çš„å˜é‡ç¬¦å·ï¼Œå°±å‘ç°äº†ç‚¹é—®é¢˜ã€‚ è§£å†³æ–¹æ³•ï¼š å‰ç«¯ä¿®æ”¹art-templateçš„ç¬¦å·ï¼Œé˜²æ­¢å’ŒLaravelå†²çªï¼› ä¿®æ”¹Laravelæ¨¡æ¿å˜é‡ç¬¦-åŒå¤§æ‹¬å· å¯ä»¥åœ¨æ§åˆ¶å™¨è°ƒç”¨viewæ–¹æ³•ä¹‹å‰åŠ å…¥ Blade::setContentTags([[, ]]);Blade::setEscapedContentTags(&#123;[@, @]&#125;); ä¾¿å¯ä»¥ç”¨{[@, @]}æ›¿ä»£åŸæ¥çš„åŒå¤§æ‹¬å·ã€‚ 2. åŠ è½½htmlä¸ä½¿ç”¨bladeæ¨¡æ¿å¼•æ“é™¤äº†è¿™ä¸ªè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚å‰åç«¯åˆ†ç¦»çš„æ—¶å€™ï¼Œæˆ‘åªæƒ³åŠ è½½htmlï¼Œä¸éœ€è¦æ¸²æŸ“æ›¿æ¢ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿ Route::get(/, function () &#123; \\View::addExtension(html, php); return view()-&gt;file(index.html);//æ³¨æ„æ­¤å¤„è·¯å¾„æ˜¯public&#125;); å°±è¿™æ ·åŠ è½½å°±ok äº†ã€‚","tags":["Laravel"],"categories":["PHP"]},{"title":"Linuxçš„topå‘½ä»¤è¯¦è§£","path":"/2019/04/26/186/","content":"topå‘½ä»¤æ˜¯Linuxä¸‹å¸¸ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­å„ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨çŠ¶å†µï¼Œå¸¸ç”¨äºæœåŠ¡ç«¯æ€§èƒ½åˆ†æã€‚ ç»Ÿè®¡ä¿¡æ¯åŒºå‰äº”è¡Œæ˜¯ç³»ç»Ÿæ•´ä½“çš„ç»Ÿè®¡ä¿¡æ¯ã€‚å…·ä½“å¦‚ä¸‹ï¼š ç¬¬ä¸€è¡ŒæœåŠ¡å™¨è¿è¡Œä¿¡æ¯ï¼š09:46:41 å½“å‰æ—¶é—´up 71daysï¼Œ16:51 ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œæ ¼å¼ä¸ºå¤©ï¼Œæ—¶:åˆ†2 users å½“å‰ç™»å½•ç”¨æˆ·æ•°load average: 0.00, 0.00, 0.00 ç³»ç»Ÿè´Ÿè½½ï¼Œå³ä»»åŠ¡é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦ã€‚ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå‰åˆ°ç°åœ¨çš„å¹³å‡å€¼ã€‚ ç¬¬äºŒè¡Œä¸ºè¿›ç¨‹ä¿¡æ¯Tasks:total è¿›ç¨‹æ€»æ•°running æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°sleeping ç¡çœ çš„è¿›ç¨‹æ•°stopped åœæ­¢çš„è¿›ç¨‹æ•°zombie åƒµå°¸è¿›ç¨‹æ•°ç¬¬ä¸‰è¡ŒCPUä¿¡æ¯Cpu(s): 0.5% us ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.3% sy å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.0% ni ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”99.0% id ç©ºé—²CPUç™¾åˆ†æ¯”0.0% wa ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”0.2%hiï¼šç¡¬ä»¶CPUä¸­æ–­å ç”¨ç™¾åˆ†æ¯”0.0%siï¼šè½¯ä¸­æ–­å ç”¨ç™¾åˆ†æ¯”0.0%stï¼šè™šæ‹Ÿæœºå ç”¨ç™¾åˆ†æ¯” ç¬¬å››è¡ŒMemå†…å­˜ä¿¡æ¯:8189652k total ç‰©ç†å†…å­˜æ€»é‡7885740k used ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡303912k free ç©ºé—²å†…å­˜æ€»é‡566272k buffers ç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡ç¬¬äº”è¡Œswapäº¤æ¢åˆ†åŒºä¿¡æ¯: 4194300k total äº¤æ¢åŒºæ€»é‡15544k used ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡4178756k free ç©ºé—²äº¤æ¢åŒºæ€»é‡1318852k cached ç¼“å­˜çš„äº¤æ¢åŒºæ€»é‡ï¼Œå³å¯ç”¨äº¤æ¢åŒºå†…å­˜ å½“ç„¶ï¼Œä¹Ÿæ¨èä½¿ç”¨å…¶ä»–è¿è¡Œåˆ†æå¯è§†åŒ–å·¥å…·ï¼Œå¦‚htopï¼ŒåŠŸèƒ½ç›¸æ¯”topæ›´ä¸ºå¼ºå¤§ã€‚","tags":["Linux"],"categories":["linux"]},{"title":"windowsä¸‹çš„elasticsearchå°è¯•","path":"/2019/04/10/183/","content":"ç¯å¢ƒï¼šwindows7 64ä½ ElasticSearchï¼ˆåé¢ç®€ç§°esï¼‰åŸºäºjavaï¼Œæ‰€ä»¥åŠ¡å¿…å…ˆå®‰è£…javaï¼Œjavaå®‰è£…çœç•¥ï¼Œå»ºè®®å®‰è£…æœ€æ–°çš„ç¨³å®šç‰ˆã€‚ å®‰è£…esesä¸‹è½½ è§£å‹åè¿›å…¥ç›®å½•ï¼Œå¯åŠ¨bin/elasticsearch.bat è®¿é—®ï¼š http://localhost:9200/ å¯ä»¥çœ‹åˆ°ä¸€äº›ä¿¡æ¯ï¼Œç‰ˆæœ¬ç­‰ï¼Œå°±è¡¨æ˜å·²ç»å®‰è£…ç—…å¯åŠ¨æˆåŠŸï¼ å®‰è£…HEADæ’ä»¶ git clone git://github.com/mobz/elasticsearch-head.gitcd elasticsearch-headnpm installnpm run start æµè§ˆå™¨æ‰“å¼€ï¼Œ http://localhost:9100/ï¼Œå¯ä»¥çœ‹åˆ°åˆšå¼€å¯åŠ¨çš„ESå®ä¾‹ã€‚ ä¼ªé›†ç¾¤æ‰“å¼€configä¸‹å¾—elasticsearch.yml åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š # è‡ªå®šä¹‰é…ç½®cluster.name: sai_esnode.name: es0node.master: truehttp.port: 9200 å¤åˆ¶esæ–‡ä»¶å¤¹åˆ°es1,es2,ä¿®æ”¹é…ç½®: es1:# è‡ªå®šä¹‰é…ç½®cluster.name: sai_esnode.name: es1node.master: falsehttp.port: 9201discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1&quot;]es2:# è‡ªå®šä¹‰é…ç½®cluster.name: sai_esnode.name: es2node.master: falsehttp.port: 9202discovery.zen.ping.unicast.hosts: [&quot;127.0.0.1&quot;] æ³¨æ„ï¼Œæ­¤æ—¶è¦ä¿è¯es1ï¼Œes2ä¸‹é¢dataç›®å½•ä¸ºç©ºï¼Œå¦åˆ™å¯åŠ¨æ—¶ä¼šå› ä¸ºå†²çªidè¿æ¥ä¸ä¸Šes0ã€‚ ç„¶åå¯åŠ¨es1ï¼Œes2ï¼Œé€šè¿‡headæ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é›†ç¾¤æ­å»ºå®Œæˆï¼sai_esé›†ç¾¤ä¸‹æœ‰3ä¸ªå®ä¾‹ï¼šes0ï¼Œes1ï¼Œes2ã€‚ é›†ç¾¤æ­å»ºæˆåŠŸï¼","tags":["ElasticSearch"],"categories":["ElasticSearch"]},{"title":"Redisé›†ç¾¤é…ç½®","path":"/2019/03/29/182/","content":"Redis Cluster æ˜¯ä»€ä¹ˆRedis Cluster æ˜¯ Redis çš„åˆ†å¸ƒå¼å®ç°ï¼Œå®˜ç½‘è¯´æ˜ä¸­é˜è¿°äº†ä»¥ä¸‹å‡ ç‚¹ç›®æ ‡ï¼š é«˜æ€§èƒ½å’Œçº¿æ€§å¯æ‰©å±•æ€§é«˜è¾¾ 1000 ä¸ªèŠ‚ç‚¹ã€‚æ²¡æœ‰ä»£ç†ï¼Œä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œä¸å¯¹å€¼æ‰§è¡Œåˆå¹¶æ“ä½œã€‚ å¯æ¥å—çš„å†™å…¥å®‰å…¨ç¨‹åº¦ï¼šç³»ç»Ÿå°è¯•ï¼ˆä»¥æœ€å¤§åŠªåŠ›çš„æ–¹å¼ï¼‰ä¿ç•™æ‰€æœ‰æ¥è‡ªä¸å¤§å¤šæ•°ä¸»èŠ‚ç‚¹è¿æ¥çš„å®¢æˆ·ç«¯çš„å†™å…¥ã€‚é€šå¸¸æœ‰ä¸€äº›å°çª—å£ï¼Œå…¶ä¸­ç¡®è®¤çš„å†™å…¥å¯èƒ½ä¼šä¸¢å¤±ã€‚å½“å®¢æˆ·ç«¯ä½äºå°‘æ•°åˆ†åŒºä¸­æ—¶ï¼Œä¸¢å¤±å·²ç¡®è®¤å†™å…¥çš„çª—å£æ›´å¤§ã€‚ å¯ç”¨æ€§ï¼šRedis é›†ç¾¤èƒ½å¤Ÿåœ¨å¤§å¤šæ•°ä¸»èŠ‚ç‚¹å¯è®¿é—®çš„åˆ†åŒºä¸­å­˜æ´»ä¸‹æ¥ï¼Œå¹¶ä¸”æ¯ä¸ªä¸å†å¯è®¿é—®çš„ä¸»èŠ‚ç‚¹è‡³å°‘æœ‰ä¸€ä¸ªå¯è®¿é—® ç¯å¢ƒ centos7.5ï¼ŒRedis5.0.0 Redis ä¸‹è½½åå®‰è£…åœ¨åˆé€‚çš„ç›®å½•ï¼Œæˆ‘æ˜¯å®‰è£…åœ¨/usr/local/Redis-5.0.0ä¸‹ï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚ã€å®˜ç½‘æåŠ3.0ä¹‹åçš„ç‰ˆæœ¬å³å¯æ”¯æŒé›†ç¾¤æ“ä½œã€‘ é…ç½®åŒçº§ä¸‹æ–°å»ºclusteræ–‡ä»¶å¤¹ï¼Œæ‹·è´ redis.conf æ–‡ä»¶è¿›æ¥ï¼Œcopy 4ä¸ªæ–‡ä»¶Redis_2001.confã€Redis_2002.confã€Redis_2003.confã€Redis_2004.confï¼Œä¿®æ”¹å¯¹åº”é…ç½®ï¼Œä¸»è¦æ˜¯ç«¯å£ï¼ŒèŠ‚ç‚¹é…ç½® rdb aof ç­‰ã€‚ å¯å‚è€ƒé…ç½®å¦‚ä¸‹ï¼š # ç«¯å£å·port 2001# åå°å¯åŠ¨daemonize yes# å¼€å¯é›†ç¾¤cluster-enabled yes# é›†ç¾¤èŠ‚ç‚¹é…ç½®æ–‡ä»¶cluster-config-file nodes-2001.conf# è¿›ç¨‹pidçš„æ–‡ä»¶ä½ç½®pidfile /var/run/Redis-2001.pid# æŒä¹…åŒ–é…ç½®# å¼€å¯aofappendonly yes# aofæ–‡ä»¶è·¯å¾„appendfilename &quot;appendonly-2001.aof&quot;# rdbæ–‡ä»¶è·¯å¾„dbfilename dump-2001.rdb å¯åŠ¨æ ¹æ®ä¸Šè¿°é…ç½®æ–‡ä»¶ä¾æ¬¡å¯åŠ¨Redisè¿›ç¨‹ redis-server cluster/Redis-2001.confredis-server cluster/Redis-2002.confredis-server cluster/Redis-2003.confredis-server cluster/Redis-2004.conf å¯åŠ¨å®Œæˆåï¼Œç…§ç€æŸä¸ªæ–‡ç« è¯´æ˜è¿æ¥æ„å»ºRedisé›†ç¾¤: ./Redis-trib.rb create â€“replicas 1 127.0.0.1:2001 127.0.0.1:2002 127.0.0.1:2003 127.0.0.1:2004 æŠ›å‡ºè­¦å‘Šï¼š WARNING: Redis-trib.rb is not longer available! æŸ¥çœ‹æ–‡æ¡£å‘ç°ï¼šRedisÂ 5.0å½»åº•æŠ›å¼ƒäº†rubyã€ä¼˜å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¼˜å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¼˜å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ã€‘ You should use redis-cli instead. è¡Œï¼Œæ¢redis-cliï¼š redis-cli â€“cluster create 127.0.0.1:2001 127.0.0.1:2002 127.0.0.1:2003 127.0.0.1:2004 â€“cluster-replicas 1 åˆæœ‰é”™è¯¯ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š *** ERROR: Invalid configuration for cluster creation.*** Redis Cluster requires at least 3 master nodes.*** This is not possible with 4 nodes and 1 replicas per node.*** At least 6 nodes are required. å› ä¸ºæ˜¯å•æœºæµ‹è¯•è€Œå·²ï¼Œå»æ‰å¤åˆ¶ï¼Œè‡³å°‘6ä¸ªèŠ‚ç‚¹ æˆ‘ä»¬å…ˆå¿½ç•¥ã€‚ Redis-cli â€“cluster create 127.0.0.1:2001 127.0.0.1:2002 127.0.0.1:2003 127.0.0.1:2004 ç„¶åæœ‰ä¸ªä¿å­˜é…ç½®çš„ç¡®è®¤ï¼Œyesä¹‹åå¯åŠ¨æˆåŠŸï¼ [OK] All nodes agree about slots configuration.&gt;&gt;&gt; Check for open slots...&gt;&gt;&gt; Check slots coverage...[OK] All 16384 slots covered. è¿›å…¥å®¢æˆ·ç«¯ redis-cli -p 2001 æŸ¥çœ‹èŠ‚ç‚¹: cluster nodes 90a734c7716a00060584acb82cb3dd7e437a5459 127.0.0.1:2003@12003 master - 0 1541042930063 3 connected 8192-122877ac1fab72c275ba9549a9da71245fdd29a3920a6 127.0.0.1:2002@12002 master - 0 1541042930563 2 connected 4096-8191490035c372472798a224b6d00c249d8b41508b78 127.0.0.1:2001@12001 myself,master - 0 1541042928000 1 connected 0-40959101d285b991c6dcb086cf3da4cd0eae7777ece0 127.0.0.1:2004@12004 master - 0 1541042929563 4 connected 12288-16383 å¯ä»¥çœ‹å‡ºé›†ç¾¤å·²æ­å»ºæˆåŠŸï¼ä½ å¯ä»¥è¿›è¡Œæµ‹è¯•äº†ã€‚ å½“ç„¶éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™åªæ˜¯æˆ‘ä»¬è‡ªå·±æµ‹è¯•ç”¨ï¼Œäº§çº¿ä¸Šè¿˜æ˜¯éœ€è¦å¼€å¯å¤åˆ¶ï¼Œä¸”æŒ‰éœ€é…ç½®èŠ‚ç‚¹ï¼Œè‡³å°‘ 6 ä¸ªï¼Œä¸ç„¶å«å•¥é«˜å¯ç”¨ï¼Œè¿˜ä¸å¦‚å•æœºä½¿ç”¨ã€‚","tags":["Redis"],"categories":["Redis"]},{"title":"phpå°è¯•rabbitmq","path":"/2019/03/29/181/","content":"RabbitMQ is lightweight and easy to deploy on premises and in the cloud. It supports multiple messaging protocols. RabbitMQ can be deployed in distributed and federated configurations to meet high-scale, high-availability requirements. 1. å®‰è£…ï¼šwindowså®‰è£…ååˆ†ç®€å•ï¼Œå°è±¡ä¸­è£…çš„è¿‡ç¨‹å‡ ä¹æ— éšœç¢ï¼Œå¿½ç•¥ã€‚ centos7å®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š ä¾èµ–å®‰è£… yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel unixODBC-devel socat å®‰è£…erlangï¼ŒåŠ¡å¿…åœ¨ä¸‹é¢çš„åœ°å€ä¸‹è½½ï¼Œä¹‹å‰åœ¨å®˜ç½‘ä¸‹è½½ï¼Œå®‰è£…æ€»æ˜¯æœ‰é—®é¢˜ï¼Œæµªè´¹äº†å¤§æŠŠæ—¶é—´ã€‚ https://dl.bintray.com/rabbitmq/rpm/erlang/20/el/7/ å®˜ç½‘ä¸‹è½½rabiitmqï¼Œrpmå®‰è£… rpm -ivh (rpmåŒ…) 2. é…ç½®å¯åŠ¨rabbitmq /bin/systemctl start rabbitmq-server.service ç‰‡åˆ»ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹çŠ¶æ€æ˜¯å¦active bin/systemctl status rabbitmq-server.service cp rabbitmq.config.example /etc/rabbitmq/cd /etc/rabbitmq/mv rabbitmq.config.example rabbitmq.config ä¿®æ”¹æˆä½ æƒ³è¦çš„é…ç½®ï¼Œç„¶åé‡å¯ã€‚ 3. UIå¯åŠ¨ rabbitmq-plugins enable rabbitmq_management ç„¶åæ ¹æ®é…ç½®æ‰“å¼€ç•Œé¢ å®‰å…¨æ€§é—®é¢˜ï¼Œå¯ä»¥ç¦æ­¢å¤–éƒ¨guestè®¿é—®ï¼Œæ–°å»ºè´¦æˆ· rabbitmqctl add_user puresai 12345678rabbitmqctl set_user_tags puresai administrator å¹¶ä¿®æ”¹é…ç½®ï¼š {loopback_users, [&lt;&lt;â€guestâ€&gt;&gt;]} é‡å¯rabbitmqæœåŠ¡ã€‚ 4. ç®€å•å®ä¾‹ç”Ÿäº§è€…ï¼š &lt;?php/** * Created by PhpStorm. * User: puresai * Date: 2018/11/5 * Time: 10:39 */// é…ç½®ä¿¡æ¯$config = [ host =&gt; localhost, port =&gt; 5672, login =&gt; sai, password =&gt; 123456, vhost=&gt;/];$exName = changes; //äº¤æ¢æœºå$route = key; //è·¯ç”±key// åˆ›å»ºè¿æ¥å’Œchannel$conn = new AMQPConnection($config);if (!$conn-&gt;connect()) &#123; die(&quot;è¿æ¥å¤±è´¥&quot;);&#125;$channel = new AMQPChannel($conn);//æ¶ˆæ¯å†…å®¹$message = &quot;æ¶ˆæ¯æµ‹è¯•&quot;;//åˆ›å»ºäº¤æ¢æœº$ex = new AMQPExchange($channel);$ex-&gt;setName($exName);//å‘é€æ¶ˆæ¯ï¼Œæ³¨æ„æŒä¹…åŒ–ä¹Ÿè¦è®¾ç½®[delivery_mode =&gt; AMQP_DURABLE]for($i=0; $i&lt;5; $i++)&#123; echo &quot;Send Message:&quot;.$ex-&gt;publish($i.:.$message, $route, AMQP_DURABLE, [delivery_mode =&gt; AMQP_DURABLE]).&quot;&quot;;&#125;$conn-&gt;disconnect(); æ¶ˆè´¹è€…ï¼š &lt;?php/** * Created by PhpStorm. * User: puresai * Date: 2018/11/5 * Time: 10:39 */$config = [ host =&gt; localhost, port =&gt; 5672, login =&gt; sai, password =&gt; 123456, vhost=&gt;/];$exName = changes; //äº¤æ¢æœºå$queueMame = queue1; //é˜Ÿåˆ—å$route = key; //è·¯ç”±key// åˆ›å»ºè¿æ¥å’Œchannel$conn = new AMQPConnection($config);if (!$conn-&gt;connect()) &#123; die(&quot;è¿æ¥å¤±è´¥&quot;);&#125;$channel = new AMQPChannel($conn);// åˆ›å»ºäº¤æ¢æœº$ex = new AMQPExchange($channel);$ex-&gt;setName($exName);$ex-&gt;setType(AMQP_EX_TYPE_DIRECT); //directç±»å‹$ex-&gt;setFlags(AMQP_DURABLE); //æŒä¹…åŒ–ï¼Œå¾ˆé‡è¦echo &quot;Exchange Status:&quot;.$ex-&gt;declare().&quot;&quot;;// åˆ›å»ºé˜Ÿåˆ—$queue = new AMQPQueue($channel);$queue-&gt;setName($queueMame);$queue-&gt;setFlags(AMQP_DURABLE); //æŒä¹…åŒ–echo &quot;Message Total:&quot;.$queue-&gt;declare().&quot;&quot;;//ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ï¼Œå¹¶æŒ‡å®šè·¯ç”±é”®echo Queue Bind: .$queue-&gt;bind($exName, $route).&quot;&quot;;//é˜»å¡æ¨¡å¼æ¥æ”¶æ¶ˆæ¯echo &quot;Message:&quot;;while(True)&#123; $queue-&gt;consume(processMessage);&#125;$conn-&gt;disconnect();/** * æ¶ˆè´¹å›è°ƒå‡½æ•° * å¤„ç†æ¶ˆæ¯ */function processMessage($envelope, $queue) &#123; $msg = $envelope-&gt;getBody(); echo $msg.&quot;&quot;; //å¤„ç†æ¶ˆæ¯ $queue-&gt;ack($envelope-&gt;getDeliveryTag()); //æ‰‹åŠ¨å‘é€ACKåº”ç­”&#125; èŠ±äº†äº›æ—¶é—´ï¼Œä¸è¿‡å¼„å‡ºæ¥è¿˜æ˜¯æ„Ÿè§‰ä¸é”™çš„ã€‚","tags":["RabbitMQ"],"categories":["MQ"]},{"title":"LNMPè®¾ç½®å¼€æœºè‡ªå¯åŠ¨","path":"/2019/03/29/180/","content":"æœåŠ¡å™¨é‡å¯åï¼Œä¸€æ­¥æ­¥å¯åŠ¨å„ç§ç¨‹åºæ˜¯ä¸ªéå¸¸éº»çƒ¦ä¹Ÿæ˜¯å®¹æ˜“å‡ºé”™çš„äº‹æƒ…ï¼Œé‡åˆ°è¿‡ä¸æ­¢ä¸€æ¬¡ï¼Œæœ‰æŸä¸ªæœåŠ¡å¿˜è®°èµ·æ¥çš„æƒ…å†µï¼Œå¿…é¡»å¾—å½»åº•è§£å†³è¿™ç§é—®é¢˜ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥å°è¯•é…ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚ ç¯å¢ƒcentos 7.5 æˆ‘çš„ç‰ˆæœ¬è·Ÿä½ç‰ˆæœ¬æœ‰å¾ˆå¤šä¸åŒï¼Œä¸èƒ½é€šè¿‡chkconfig addå‘½ä»¤åŠ å…¥è‡ªå¯åŠ¨ï¼Œæˆ‘ä»¬å…ˆè¿›å…¥ç›®å½• /lib/systemd/system ä¾æ¬¡æ–°å»ºè‹¥å¹²ä¸ªæœåŠ¡ï¼š mysqld.service [Unit]Description=mysqlAfter=network.target[Service]Type=forkingExecStart=/usr/bin/mysql.serverExecReload=/bin/systemctl restart mysqld.serviceExecStop=/bin/systemctl stop mysqld.servicePrivateTmp=true[Install]WantedBy=multi-user.target nginx.service[Unit]Description=nginxAfter=network.target[Service]Type=forkingExecStart=/usr/bin/nginxExecReload=/usr/bin/nginx -s reloadExecStop=/usr/bin/nginx -s quitPrivateTmp=true[Install]WantedBy=multi-user.target php-fpm.service[Unit]Description=php-fpmAfter=network.target[Service]Type=forkingExecStart=/usr/bin/php-fpmExecReload=ps -ef|grep php-fpm|awk -F &#123;print &#125;|xargs kill -USR2ExecStop=ps -ef|grep php-fpm|awk -F &#123;print &#125;|xargs kill -INTPrivateTmp=true[Install]WantedBy=multi-user.target Redis.service[Unit]Description=RedisAfter=network.target[Service]Type=forkingExecStart=/usr/bin/Redis-server /usr/local/Redis-5.0.0/Redis.confExecStop=/usr/local/Redis-5.0.0/Redis-cli shutdownPrivateTmp=true[Install]WantedBy=multi-user.target ExecStart, ExecStop, ExecReloadå„æœ‰ä¸åŒï¼Œå¯æ ¹æ®ä¸šåŠ¡è‡ªè¡Œä¿®æ”¹ å¹¶ä¸”æŠŠå°šéœ€å‡ ä¸ªæœåŠ¡ systemctl enable å¯åŠ¨ã€‚ æµ‹è¯•å®Œæˆåæˆ‘ä»¬é‡å¯æœºå™¨ï¼š reboot æµ‹è¯•ä¸€ä¸‹ã€åˆ«å†ç”Ÿäº§éšæ„rebootå“Ÿã€‘ï¼Œå‡ ä¸ªå®šä¹‰çš„æœåŠ¡éƒ½é™†ç»­å¯åŠ¨æˆåŠŸã€‚ å‚æ•°è¯´æ˜ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰éƒ¨åˆ† [unit] :å®šä¹‰ä¸Unitç±»å‹æ— å…³çš„é€šç”¨é€‰é¡¹ï¼›ç”¨äºæä¾›unitçš„æè¿°ä¿¡æ¯ã€ unitè¡Œä¸ºåŠä¾èµ–å…³ç³»ç­‰ [Service]ï¼šä¸ç‰¹å®šç±»å‹ç›¸å…³çš„ä¸“ç”¨é€‰é¡¹ï¼›æ­¤å¤„ä¸ºServiceç±»å‹ [Install]ï¼šå®šä¹‰ç”±â€œ systemctl enableâ€ä»¥åŠâ€systemctl disableâ€œå‘½ä»¤åœ¨å®ç°æœåŠ¡å¯ç”¨æˆ–ç¦ç”¨æ—¶ç”¨åˆ°çš„ä¸€äº›é€‰é¡¹ Serviceå‚æ•°ï¼š EnvironmentFileï¼šç¯å¢ƒé…ç½®æ–‡ä»¶ ExecStartï¼šæŒ‡æ˜å¯åŠ¨unitè¦è¿è¡Œå‘½ä»¤æˆ–è„šæœ¬çš„ç»å¯¹è·¯å¾„ ExecStartPreï¼š ExecStartå‰è¿è¡Œ ExecStartPostï¼š ExecStartåè¿è¡Œ ExecRsload: é‡å¯å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ ExecStopPostï¼šåœæ­¢å½“å‰æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ ExecStartSecï¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡é—´éš”çš„ç§’æ•° ExecStopï¼šæŒ‡æ˜åœæ­¢unitè¦è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ Restartï¼šå½“è®¾å®šRestart=1æ—¶ï¼Œåˆ™å½“æ¬¡daemonæœåŠ¡æ„å¤–ç»ˆæ­¢åï¼Œä¼šå†æ¬¡è‡ªåŠ¨å¯åŠ¨æ­¤æœåŠ¡ã€‚ TimeoutSecï¼šå®šä¹‰ Systemd åœæ­¢å½“å‰æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•°ã€‚ Environmentï¼šæŒ‡å®šç¯å¢ƒå˜é‡ã€‚ Installå‚æ•°ï¼š Aliasï¼šåˆ«åï¼Œå¯ä½¿ç”¨systemctl command Alias.service RequiredByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼ºä¾èµ– WantedByï¼šè¢«å“ªäº›unitsæ‰€ä¾èµ–ï¼Œå¼±ä¾èµ– Alsoï¼šå®‰è£…æœ¬æœåŠ¡çš„æ—¶å€™è¿˜è¦å®‰è£…åˆ«çš„ç›¸å…³æœåŠ¡ å‚è€ƒ åœ¨linuxä¸‹åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡ linuxä¸­çš„unitçš„é…ç½®æ–‡ä»¶","tags":["Linux"],"categories":["linux"]},{"title":"2018,è¿™ä¸€å¹´","path":"/2019/02/04/2018/","content":"å¤§å®¶ï¼Œè¿‡å¹´å¥½å•Šï¼ ä»Šå¤©æ˜¯é™¤å¤•ï¼Œçª—å¤–è¿˜æœ‰ä¸€é˜µé˜µçš„é­ç‚®å£°ï¼Œç°åœ¨åƒå®Œåˆé¥­ä¸ä¹…ï¼Œçˆ¸å¦ˆä¹°ä¸œè¥¿å»äº†ï¼Œä¸€äººåœ¨å®¶ï¼Œæš‚æ—¶æ— äº‹ï¼Œå†™ä¸‹è¿™ç¯‡å¹´ç»ˆæ€»ç»“ã€‚ å·¥ä½œä»Šå¹´å·¥ä½œçš„ä¸»é¢˜è¯åº”è¯¥æ˜¯â€”â€”åŠ ç­ã€‚ ä¸€å¹´çš„èŠ‚å¥æ˜¯ä»æ˜¥èŠ‚åçš„æ¸…é—²åˆ°å››æœˆä»½çš„å¶å°”åŠ ç­åˆ°å¤å­£çš„æ¥è¿ä¸¤ä¸ªé¡¹ç›®çš„996ï¼Œå†åˆ°10æœˆä»½æ–°å…¥èŒåçš„ç¼“æ…¢çš„ç†Ÿæ‚‰ï¼Œæœ€ååˆæ˜¯é¡¹ç›®é‡æ„çš„996â€¦â€¦ ä»Šå¹´çš„æŠ€æœ¯æˆé•¿æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä»ç®€å•çš„ä¸šåŠ¡å®ç°åˆ°è¿½æ±‚ä¸šåŠ¡æ•ˆç‡å†åˆ°å¹´æœ«é«˜å¯ç”¨çš„ç ”ç©¶ã€‚å­¦ä¹ ã€äº†è§£å¾ˆå¤šä¹‹å‰ä»æ²¡ç”¨è¿‡çš„æŠ€æœ¯ï¼Œä¹Ÿå°è¯•äº†ä¸€äº›æ›´æ·±å…¥çš„æºç çº§åˆ«çš„æ¢ç´¢ã€‚è™½ç„¶è‡ªå·±æ£é¼“çš„è¿™äº›ä¸ä¸€å®šå¯¹æœªæ¥çš„å·¥ä½œæœ‰ç”¨ï¼Œä½†å…´è‡´ç›ç„¶ï¼Œä¸€å¦‚ä¸ƒæœˆä»½å†™ã€Šé­æ™‹å²è¯ã€‹çš„çƒ­æƒ…ã€‚ é™¤äº†æŠ€æœ¯ä¸Šçš„ï¼Œå¿ƒæ€è§’åº¦ä¸Šä¹Ÿæœ‰äº†å˜åŒ–ï¼Œä¼šæœ‰è‡ªå·±çœ‹å¾…é—®é¢˜å’Œå¤„ç†é—®é¢˜çš„æ–¹å¼ï¼Œå³ä¾¿æˆ‘ä¸çŸ¥é“è¿™äº›è½¬å˜æ˜¯å¥½æ˜¯åï¼Œæˆ–è€…è¯´æˆ‘æ— æ³•å»è¯„åˆ¤è¿™äº›æ˜¯å¥½æ˜¯åã€‚åªæ˜¯è½¬å˜ä¼¼ä¹èƒ½è‡ªå·±å·¥ä½œåœ°æ›´ä¸ºè½»æ¾é¡ºç•…ï¼Œä¸å®¹æ˜“å‡ºç°å€¦æ€ æ„Ÿã€‚ æˆé•¿å›ºç„¶å¯å–œï¼Œç„¶è€Œå­¦æ— æ¶¯çŸ¥äº¦æ— æ¶¯ã€‚éšç€å­¦ä¹ å’Œå·¥ä½œçš„æ·±å…¥ï¼Œè®¤è¯†åˆ°è‡ªå·±å¯ä»¥å»ç ”ç©¶æ›´å¤šæ›´é«˜æ•ˆæ›´å…ˆè¿›çš„ä¸­é—´ä»¶ã€è®¾è®¡æ¨¡å¼ã€æŠ€æœ¯æ ˆï¼Œä»¥åŠå¯èƒ½æ¯”æŠ€æœ¯å¯èƒ½æ›´æœ‰åŠ›çš„ä¸äººåä½œæ²Ÿé€šçš„â€œtipsâ€ã€‚ ç”Ÿæ´»å·¥ä½œæ˜¯ä¸€ä»¶é‡è¦çš„äº‹ï¼Œç„¶è€Œè¿‡å¥½è‡ªå·±çš„ç”Ÿæ´»æ›´æ˜¯ä¸€ä»¶é‡è¦çš„äº‹ã€‚ ç”Ÿæ´»çš„ä¸»é¢˜è¯æ˜¯â€”â€“è´¨æ„Ÿã€‚ ä»¥ä¸‹æ®µè½æ¯«æ— è¿è´¯æ€§å¯è¨€ï¼Œé¢„è­¦ã€‚ ä¸ƒæœˆä»½å†™ã€Šé­æ™‹å²è¯ã€‹çš„ã€Šå…«ç‹ä¹‹ä¹±ã€‹çœŸçš„æ˜¯ä¸€ä»¶ç‰¹åˆ«æœ‰è¶£çš„äº‹æƒ…ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯ä¸€ä»¶è€—è´¹å¿ƒåŠ›çš„äº‹ã€‚å…¨æ–‡äº”åƒå¤šå­—ï¼ŒèŠ±äº†å‰ååå¤©ï¼Œå¢åˆ æ”¹næ¬¡ï¼Œå®Œæˆçš„æ»¡æ„åº¦å¾ˆé«˜ã€‚ä½†ä¹Ÿå› æ­¤è®©è¿™ä¸ªç³»åˆ—å¤­æŠ˜ï¼ˆâ€œå‡ºé“å³å·…å³°â€ï¼Œæ„Ÿè§‰åé¢å‹æ ¹å†™ä¸å‡ºæ¥èƒ½ç›–è¿‡è¿™ç¯‡é£å¤´çš„äº†ï¼‰ã€‚ è¿‘ä¸¤å¹´æ„Ÿè§‰èº«ä½“çŠ¶å†µå’Œæ´»åŠ¨é‡è¿œä¸æ¯”å¤§å­¦æ—¶æœŸï¼Œæ°å¥½æ–°ä½å¤„ç¦»å¥èº«æˆ¿å¾ˆè¿‘ï¼ŒåŠ ç­ä¹‹åå»å¥èº«æˆ¿åˆæ²¡ä»€ä¹ˆæ¿€æƒ…ï¼Œä¾¿æ—©èµ·å¥èº«ï¼Œ11æœˆä¸­æ—¬ä¸€ç›´åšæŒäº†åˆ°å‡æœŸå‰ï¼Œè™½ç„¶ä½“é‡å˜åŒ–å¾ˆå°ï¼Œä½†ä½“è„‚ç‡æœ‰å°å¹…ä¸‹é™ï¼Œç™½å¤©å·¥ä½œçš„ç²¾ç¥çŠ¶æ€è¦æ¯”ä¹‹å‰å¥½å¾ˆå¤šã€‚ æ¢å·¥ä½œååŒä¼‘ï¼Œåˆæƒ³èµ·äº†è¿‘ä¸€å¹´æ²¡å»ä¸Šè¯¾çš„ä¹å™¨è¯¾ç¨‹ï¼Œä¾¿ç»§ç»­å»å­¦ä¹ å‰©ä½™è¯¾ç¨‹ï¼Œç°åœ¨è‡ªå·±ä¹Ÿèƒ½ä¿è¯å¹³å‡ä¸¤å¤©ä¸€æ¬¡çš„ç»ƒä¹ ï¼Œè¯¾ä¸Šä¹Ÿä¸å†æ‹˜è°¨ï¼Œä¹Ÿèƒ½è·Ÿè€å¸ˆå” å” å—‘ï¼Œè¯´è¯´ç¬‘ã€‚ å¾ˆé—æ†¾çš„æ˜¯ï¼Œç›¸æœºç”¨çš„æ¬¡æ•°å±ˆæŒ‡å¯æ•°ï¼Œæ‰€ä»¥æ°´å¹³å¯æƒ³è€ŒçŸ¥ï¼Œçœ‹äº†ä¸€äº›æ‘„å½±æŠ€å·§å’Œæ„å›¾çš„ä¹¦ï¼Œç„¶è€Œæ›´åº”è¯¥å»å®è·µä¸å°è¯•ã€‚ çœ‹ç”µå½±ä¾æ—§æ˜¯æœ€å¤§çš„å¨±ä¹æ´»åŠ¨ï¼Œä¼šå»åšä¸€äº›è¯„ä»·ï¼Œæ¼”æŠ€ã€é•œå¤´ã€é…ä¹ï¼Œè¿˜æœ‰å‰§æƒ…ã€‚çœ‹ç‰‡é‡ä¸åŠå»å¹´ï¼Œä½†ä¹Ÿçœ‹äº†å‡ éƒ¨å¥½ç”µå½±ã€‚ ä¹¦ç±æ–¹é¢ï¼Œæ–‡å­¦æ–¹é¢çš„ä¹¦çœ‹å¾—å¾ˆå°‘äº†ï¼Œå°è±¡ä¸­æœ‰æ¯›å§†çš„ã€Šæœˆäº®ä¸å…­ä¾¿å£«ã€‹å’Œå¡å°”ç»´è¯ºçš„ã€Šæ ‘ä¸Šçš„ç”·çˆµã€‹ï¼Œå…¶ä»–çš„æˆ‘æœ‰ç‚¹æƒ³ä¸èµ·äº†ã€‚æ›´å¤šæ˜¯æŠ€æœ¯æ–¹é¢çš„ä¹¦ï¼Œä¸ä¼šé€šç¯‡è¯»å®Œï¼Œä¸€èˆ¬éƒ½æ˜¯è¯»æ„Ÿå…´è¶£çš„ç‚¹ã€‚ å…¶ä»–çš„ï¼Œè¿˜æœ‰ä¹ˆï¼Ÿ å…¶ä»–ç¢ç¢å¿µ æ€»æ˜¯å¯¹æ—¶ä¸‹æœ‰çƒ­åº¦çš„äº‹ç‰©æœ‰æ‰€æŠµè§¦ï¼Œæ¯”å¦‚å¤§çƒ­çš„å‰§ï¼Œå¤§çƒ­çš„ä½œè€…ï¼Œå¤§çƒ­çš„ç§‘æŠ€äº§å“ã€‚å”¯ç‹¬é™¤äº†å¤§çƒ­çš„ç”µå½±ï¼Œæˆ‘ä¸çŸ¥é“æ˜¯ä¸ºäº†å‡¸æ˜¾ä¸ªäººç«‹åœºè¿˜æ˜¯å…¶ä»–ä»€ä¹ˆï¼Œæ€»è§‰å¾—ï¼Œæ—¶ä¸‹å¤§çƒ­çš„æ€»è¦ç»è¿‡æ—¶é—´çš„é€‰æ‹©ã€‚è‹¥çœŸçš„é‚£ä¹ˆå¥½ï¼Œæˆ‘å€’æ˜¯ä¹æ„å»è¯•è¯•çœ‹ã€‚ç¤¾ä¼šå¾ˆæµ®åï¼Œå¦‚ä»Šæˆ‘ä¹Ÿå¾ˆæµ®èºï¼Œåªå¸Œæœ›å¾ˆå¤šæ—¶å€™ï¼Œçº¯ç²¹ä¸€ç‚¹ï¼Œéšæ€§ä¸€ç‚¹ï¼Œè™½ç„¶å¾ˆå¤šæ—¶å€™å¾ˆéš¾ï¼Œä½†ç»ˆç©¶è¿˜æœ‰äº›è®¸å†…ç«‹çš„åº¦ä¸ä¸è¢«å¤–åŒ–çš„äº›è®¸æŠµæŠ—ã€‚ â€“ 2018-07-10 æ—…è¡Œèƒ½å¸¦ç»™æˆ‘çš„æ˜¯ä»€ä¹ˆï¼Œå¹¶æ²¡æœ‰é‚£ä¹ˆç•…å¿«ï¼Œæ˜¯å› ä¸ºç‹¬è‡ªçš„åŸå› ï¼Ÿæˆ‘æƒ³ä¹Ÿä¸æ˜¯ï¼Œæ˜¯å»çš„åœ°æ–¹ä¸å¤Ÿè§¦åŠ¨æˆ‘çš„å¿ƒä¹ˆï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚ æ—…è¡Œèƒ½å¸¦æ¥çš„å¹¶æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œå¹¶æ²¡æœ‰è®©è‡ªå·±å¿ƒé™ï¼Œä¹Ÿæ²¡æœ‰å¸¦æ¥é‚£ä¹ˆå¤šç²¾ç¥æ–¹é¢çš„ï¼Œå¤šè¯»äº›ä¹¦å§ï¼Œå¤šå¬ç‚¹å¥½éŸ³ä¹ï¼Œå¤šçœ‹å¥½ç”µå½±ã€‚â€“ 2018-09-23 æœ€åä¾æ—§æ”¹å´æ–‡è‹±çš„åŠé˜™è¯ç¥å¤§å®¶é™¤å¤•å¿«ä¹ï¼Œæ–°å¹´é¡ºæ„ã€‚ è‡ªå”±æ–°è¯é€å²åã€‚äº²å‹ä¼´æˆ‘é†‰ç”Ÿæ¶¯ã€‚åå¹´å¯»æ¢¦ç»ˆå½’å¤„ï¼Œå‡ åº¦æ–°æ˜¥å…±ç¹åã€‚ 2019/02/04æˆŠæˆŒé™¤å¤•è®°at å®‰åº†","tags":["oneyear"],"categories":["oneyear"]},{"title":"å¦‚ä½•æ¢å¤è¯¯åˆ çš„æ•°æ®åº“","path":"/2019/01/11/176/","content":"å‰æ®µæ—¶é—´ï¼ŒæŸå¼€å‘äººå‘˜è¯¯åˆ äº†ä¸€ä¸ªæ•°æ®åº“ï¼Œå¯¼è‡´æˆ‘ä»¬çš„æœåŠ¡ï¼Œæœ€åæ˜¯æ¢å¤äº†ï¼Œè¿‡ç¨‹æˆ‘å¹¶ä¸æ¸…æ¥šï¼Œä½†å¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚å› ä¸ºè¯¯æ“ä½œçœŸçš„æ˜¯å¾ˆéš¾é¿å…çš„ï¼Œå¼€å‘äººå‘˜é‚£ä¹ˆå¤šï¼Œä¸€ä¸ªä¸å°å¿ƒï¼Œå°±å¯èƒ½å½±å“äº†å…¶ä»–äººçš„ä½¿ç”¨ï¼Œæ‰€ä»¥æ…é‡æ“ä½œï¼Œæœ€å¥½èƒ½ç¦ç”¨ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚dropï¼ é‚£ä¹ˆå¦‚ä½•æ¥æ¢å¤å‘¢ï¼Ÿ å¦‚æœæœ‰å¤‡ä»½çš„è¯ï¼Œå½“ç„¶å»å¯»æ‰¾æœ€æ–°çš„ï¼Œç„¶åæ¢å¤ï¼Œå¦‚æœä¸åœ¨æ„æ–°å¢çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™æ ·å°±è¶³å¤Ÿäº†ã€‚ æ¥çœ‹ä¸€ä¸‹å¤‡ä»½ï¼Œ // å¤‡ä»½æŸä¸ªæ•°æ®åº“æŸäº›è¡¨mysqldump [options] db_name [tbl_name ...] &gt; bak.sql// å¤‡ä»½å¤šä¸ªæ•°æ®åº“mysqldump [options] --databases db_name ...&gt; bak.sql// å¤‡ä»½æ‰€æœ‰æ•°æ®åº“mysqldump [options] --all-databases&gt; bak.sql ä¸ªäººå»ºè®®å•ä¸ªå¤‡ä»½ï¼Œå¥½ç‹¬ç«‹æ“ä½œã€‚ äº†è§£æ›´å¤šè¯·çœ‹ï¼šmysqldump æ¢å¤æ“ä½œï¼ˆä»¥å•ä¸ªæ•°æ®åº“ä¸ºä¾‹ï¼‰ mysql -h127.0.0.1 -uroot -p del &lt; bak.sql æ“ä½œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ é‚£ä¹ˆå¦‚æœæ²¡æœ‰å¤‡ä»½æ€ä¹ˆåŠå‘¢ï¼Ÿ ç¬¬äºŒç§æ“ä½œå‰ææ˜¯å¼€å¯äº†binlogï¼Œé€šè¿‡logæ¢å¤ã€‚ è¯¯åˆ åå¯ä»¥ä¿å­˜ä¸‹binlog mysqlbinlog mysql-bin.000011 &gt; del.log æ‰“å¼€æ–‡ä»¶ï¼Œå»æ‰dropæ“ä½œå¹¶ä¿å­˜ã€‚ mysql -h127.0.0.1 -uroot -p &lt;del.log å½“ç„¶ï¼Œæ¯”è¾ƒå»ºè®®é€šè¿‡dumpå…¨å¤‡ä»½æ“ä½œï¼Œç„¶åæ‰¾å‡ºå¤‡ä»½åˆ°dropçš„posã€‚ é€šè¿‡mysqlbinlog çš„start-positionå’Œstop-positionç”Ÿæˆsqlåæ¢å¤ã€‚è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹mysqlbinlog å¥½äº†ï¼Œå°±è¯´åˆ°è¿™é‡Œï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚","tags":["MySQL"],"categories":["db"]},{"title":"MySQLé«˜å¯ç”¨æ¢è®¨ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰","path":"/2018/12/30/175/","content":"ä¸Šä¸€ç¯‡æˆ‘ä»¬èŠåˆ°TPåšè¯»å†™åˆ†ç¦»çš„åº•å±‚å®ç°ï¼Œç›¸å¯¹æ¥è¯´ï¼Œå…¶å®æ€è·¯æ˜¯æ¸…æ™°ç®€å•çš„ï¼Œä½†è¿™äº›å…¶å®éƒ½æ˜¯åŸºäºæ•°æ®åº“å·²ç»åšåˆ°äº†ä¸»ä»é…ç½®ã€‚ å¦‚æœä½ ä¸çŸ¥é“ï¼Œå¯ä»¥mysqlä¸»ä»å®æˆ˜ å»ºè®®ç»™ä»åº“å•ç‹¬å¼€ä¸ªè´¦å·åªæˆæƒè¯»çš„æƒé™ï¼Œè€Œä¸æ˜¯è®¾ç½®slaveä¸ºread_onlyï¼ˆæˆ‘é…ç½®äº†ï¼Œbutæ²¡å•¥ç”¨ï¼‰ ä½†æˆ‘ä»¬ç¨å¾®æ·±å…¥æ€è€ƒä¸€ä¸‹ï¼ŒPHPæ¡†æ¶é‡Œæœ‰åšåˆ°é«˜å¯ç”¨å—ï¼ŸåŠ å…¥ä»åº“å…¶ä¸­ä¸€ä¸ªæŒ‚äº†ï¼Œç…§ç€TPçš„æ€è·¯ï¼Œä¾æ—§æœ‰å¯èƒ½å»è¿™ä¸ªä»åº“è¯»å–æ•°æ®ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸èƒ½æ¥å—çš„ã€‚ ä¸€ä¸»ä¸€ä»ç”šè‡³ä¸€ä¸»å¤šä»çš„æ¶æ„æ˜¾ç„¶åªèƒ½æ»¡è¶³è¯»å†™æ€§èƒ½ï¼Œè€Œä¸èƒ½ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚æˆ‘ä»¬çŸ¥é“ä»»ä½•ä¸€ä¸ªæœåŠ¡æŒ‚æ‰çš„å¯èƒ½æ€§éƒ½æ˜¯å­˜åœ¨çš„ï¼Œæˆ‘ä»¬è¯´çš„é«˜å¯ç”¨åªèƒ½æ˜¯å°½å¯èƒ½å°çš„é¿å…æ•´ä¸ªæœåŠ¡æŒ‚æ‰çš„å¯èƒ½ã€‚ç”±æ­¤ä½ åº”è¯¥èƒ½æƒ³åˆ°å¤šä¸»å¤šä»ï¼Œè¿™ä¸ªä»…ä»…æ–‡ç« é‡Œçš„é…ç½®æ˜¯å®Œæˆä¸äº†çš„ï¼ŒPHPæ¡†æ¶ä¹Ÿæ˜¯æ£€æµ‹ä¸äº†çš„ã€‚ æˆ‘è§‰å¾—PHPæ¡†æ¶æ¥åšè¯»å†™åˆ†ç¦»æ˜¯ä¸ç§‘å­¦çš„ï¼Œå› ä¸ºå¢åŠ äº†ä»£ç çš„å¤æ‚åº¦ï¼Œæˆ‘è®¤ä¸ºè¿™äº›åº”è¯¥äº¤ç»™æ•°æ®åº“æ¥åšï¼Œæˆ–è€…æ•°æ®åº“ä¸­é—´ä»¶æ¥åšï¼Œå„å¸å…¶èŒå—ã€‚ æˆ‘ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¾ˆå¤šäººä¼šæƒ³åˆ°mysql_proxyï¼Œç„¶è€Œå®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œæ¨èä½¿ç”¨mysql_routerï¼Œæœ‰åœ¨è‡ªå·±çš„ECSä¸Šå°è¯•äº†ä¸€ä¸‹ï¼Œé…ç½®ç›¸å¯¹è¿˜æ˜¯ç®€å•çš„ï¼Œæ²¡æµ‹è¯•æ€§èƒ½ï¼Œä½†ç¡®å®å®ç°äº†ä¸€å®šç¨‹åº¦çš„é«˜å¯ç”¨ã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥å»ä½¿ç”¨å˜å½¢è™«ç­‰ä¸­é—´ä»¶ï¼Œä»–ä»¬çš„åŠŸèƒ½ç›¸æ¯”mysql_routeræ›´ä¸ºå¼ºå¤§ã€‚ æ­¤ç¯‡æ²¡æœ‰å¹²è´§ï¼Œåªæ˜¯çº¯æŠ€æœ¯æ¢è®¨ï¼Œæˆ‘ä¸è¿‡æ˜¯åœ¨å—äº¬å—ç«™ï¼Œæ²¡äº‹ç ç å­—ç½¢äº†ï¼","tags":["sql"],"categories":["db"]},{"title":"ThinkPHPè¯»å†™åˆ†ç¦»çš„å†…éƒ¨å®ç°","path":"/2018/12/17/174/","content":"åˆ†æçš„ç‰ˆæœ¬æ˜¯TP3.2.3 æ­¤ç‰ˆæœ¬å·²ç»æ”¯æŒmysqlæ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œé…ç½®æ¯”è¾ƒç®€å•ï¼Œå…·ä½“å¯çœ‹åˆ†å¸ƒå¼æ•°æ®åº“æ”¯æŒ æˆ‘ä»¬å°è¯•åˆ†æä¸‹æºç å®ç°ï¼š ä¸å¦¨å…ˆyyä¸€ä¸‹ï¼Œåœ¨å†™æ“ä½œå’Œè¯»æ“ä½œæ—¶åŒºåˆ†å¼€æ•°æ®åº“è¿æ¥åˆ†åˆ«è¿æ¥masterå’Œslaveã€‚ æˆ‘ä»¬å¯ä»¥çœ‹è§Model.class.phpçš„dbåˆå§‹åŒ– public function db($linkNum = , $config = , $force = false) &#123; if ( === $linkNum &amp;&amp; $this-&gt;db) &#123; return $this-&gt;db; &#125; if (! isset ( $this-&gt;_db [$linkNum] ) || $force) &#123; // åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ if (! empty ( $config ) &amp;&amp; is_string ( $config ) &amp;&amp; false === strpos ( $config, / )) &#123; // æ”¯æŒè¯»å–é…ç½®å‚æ•° $config = C ( $config ); &#125; $this-&gt;_db [$linkNum] = Db::getInstance ( $config ); &#125; elseif (NULL === $config) &#123; $this-&gt;_db [$linkNum]-&gt;close (); // å…³é—­æ•°æ®åº“è¿æ¥ unset ( $this-&gt;_db [$linkNum] ); return; &#125; // åˆ‡æ¢æ•°æ®åº“è¿æ¥ $this-&gt;db = $this-&gt;_db [$linkNum]; $this-&gt;_after_db (); // å­—æ®µæ£€æµ‹ if (! empty ( $this-&gt;name ) &amp;&amp; $this-&gt;autoCheckFields) $this-&gt;_checkTableInfo (); return $this;&#125; æ¥ç€çœ‹DBå•ä¾‹ï¼Œ static public function getInstance($config = array()) &#123; $md5 = md5 ( serialize ( $config ) ); if (! isset ( self::$instance [$md5] )) &#123; // è§£æè¿æ¥å‚æ•° æ”¯æŒæ•°ç»„å’Œå­—ç¬¦ä¸² $options = self::parseConfig ( $config ); // å…¼å®¹mysqli if (mysqli == $options [type]) $options [type] = mysql; // å¦‚æœé‡‡ç”¨liteæ–¹å¼ ä»…æ”¯æŒåŸç”ŸSQL åŒ…æ‹¬queryå’Œexecuteæ–¹æ³• $class = $options [lite] ? ThinkDbLite : Think\\Db\\Driver\\ . ucwords ( strtolower ( $options [type] ) ); if (class_exists ( $class )) &#123; self::$instance [$md5] = new $class ( $options ); &#125; else &#123; // ç±»æ²¡æœ‰å®šä¹‰ E ( L ( _NO_DB_DRIVER_ ) . : . $class ); &#125; &#125; self::$_instance = self::$instance [$md5]; return self::$_instance;&#125; æ¥ç€çœ‹è§mysqlé©±åŠ¨ç»§æ‰¿äº†æŠ½è±¡ç±»Driverã€‚ ä¸å¦¨æ‰¾ä¸¤ä¸ªModelæ“ä½œè¯»ï¼ˆfindï¼‰å’Œå†™(add): public function find($options = array()) &#123; ... $resultSet = $this-&gt;db-&gt;select ( $options ); ...&#125;public function add($data = , $options = array(), $replace = false) &#123; ... $result = $this-&gt;db-&gt;insert ( $data, $options, $replace ); ...&#125; æˆ‘ä»¬åªèšç„¦å…³é”®ä»£ç select å’Œinsert ã€‚ç„¶åå»æŸ¥çœ‹æ•°æ®åº“é©±åŠ¨ç±»ä»£ç ï¼š public function select($options = array()) &#123; ... $result = $this-&gt;query ( $sql, ! empty ( $options [fetch_sql] ) ? true : false ); ...&#125;public function insert($data, $options = array(), $replace = false) &#123; ... return $this-&gt;execute ( $sql, ! empty ( $options [fetch_sql] ) ? true : false );&#125; ç»§ç»­å¯»æ ¹ï¼Œæˆ‘ä»¬çœ‹è§ /** * æ‰§è¡ŒæŸ¥è¯¢ è¿”å›æ•°æ®é›† */public function query($str, $fetchSql = false) &#123; $this-&gt;initConnect ( false ); ...&#125;/** * æ‰§è¡Œè¯­å¥ */public function execute($str, $fetchSql = false) &#123; $this-&gt;initConnect ( true ); ...&#125; æˆ‘ä»¬ç»ˆäºæ‰¾åˆ°äº†æ ¹æœ¬ï¼Œ /** * åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ * * @access protected * @param boolean $master * ä¸»æœåŠ¡å™¨ * @return void */\tprotected function initConnect($master = true) &#123; if (! empty ( $this-&gt;config [deploy] )) // é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ $this-&gt;_linkID = $this-&gt;multiConnect ( $master ); else // é»˜è®¤å•æ•°æ®åº“ if (! $this-&gt;_linkID) $this-&gt;_linkID = $this-&gt;connect ();\t&#125; /** * è¿æ¥åˆ†å¸ƒå¼æœåŠ¡å™¨ * * @access protected * @param boolean $master * ä¸»æœåŠ¡å™¨ * @return void */\tprotected function multiConnect($master = false) &#123; // åˆ†å¸ƒå¼æ•°æ®åº“é…ç½®è§£æ $_config [username] = explode ( ,, $this-&gt;config [username] ); $_config [password] = explode ( ,, $this-&gt;config [password] ); $_config [hostname] = explode ( ,, $this-&gt;config [hostname] ); $_config [hostport] = explode ( ,, $this-&gt;config [hostport] ); $_config [database] = explode ( ,, $this-&gt;config [database] ); $_config [dsn] = explode ( ,, $this-&gt;config [dsn] ); $_config [charset] = explode ( ,, $this-&gt;config [charset] ); $m = floor ( mt_rand ( 0, $this-&gt;config [master_num] - 1 ) ); // æ•°æ®åº“è¯»å†™æ˜¯å¦åˆ†ç¦» if ($this-&gt;config [rw_separate]) &#123; // ä¸»ä»å¼é‡‡ç”¨è¯»å†™åˆ†ç¦» if ($master) // ä¸»æœåŠ¡å™¨å†™å…¥ $r = $m; else &#123; if (is_numeric ( $this-&gt;config [slave_no] )) &#123; // æŒ‡å®šæœåŠ¡å™¨è¯» $r = $this-&gt;config [slave_no]; &#125; else &#123; // è¯»æ“ä½œè¿æ¥ä»æœåŠ¡å™¨ $r = floor ( mt_rand ( $this-&gt;config [master_num], count ( $_config [hostname] ) - 1 ) ); // æ¯æ¬¡éšæœºè¿æ¥çš„æ•°æ®åº“ &#125; &#125; &#125; else &#123; // è¯»å†™æ“ä½œä¸åŒºåˆ†æœåŠ¡å™¨ $r = floor ( mt_rand ( 0, count ( $_config [hostname] ) - 1 ) ); // æ¯æ¬¡éšæœºè¿æ¥çš„æ•°æ®åº“ &#125; if ($m != $r) &#123; $db_master = array ( username =&gt; isset ( $_config [username] [$m] ) ? $_config [username] [$m] : $_config [username] [0], password =&gt; isset ( $_config [password] [$m] ) ? $_config [password] [$m] : $_config [password] [0], hostname =&gt; isset ( $_config [hostname] [$m] ) ? $_config [hostname] [$m] : $_config [hostname] [0], hostport =&gt; isset ( $_config [hostport] [$m] ) ? $_config [hostport] [$m] : $_config [hostport] [0], database =&gt; isset ( $_config [database] [$m] ) ? $_config [database] [$m] : $_config [database] [0], dsn =&gt; isset ( $_config [dsn] [$m] ) ? $_config [dsn] [$m] : $_config [dsn] [0], charset =&gt; isset ( $_config [charset] [$m] ) ? $_config [charset] [$m] : $_config [charset] [0] ); &#125; $db_config = array ( username =&gt; isset ( $_config [username] [$r] ) ? $_config [username] [$r] : $_config [username] [0], password =&gt; isset ( $_config [password] [$r] ) ? $_config [password] [$r] : $_config [password] [0], hostname =&gt; isset ( $_config [hostname] [$r] ) ? $_config [hostname] [$r] : $_config [hostname] [0], hostport =&gt; isset ( $_config [hostport] [$r] ) ? $_config [hostport] [$r] : $_config [hostport] [0], database =&gt; isset ( $_config [database] [$r] ) ? $_config [database] [$r] : $_config [database] [0], dsn =&gt; isset ( $_config [dsn] [$r] ) ? $_config [dsn] [$r] : $_config [dsn] [0], charset =&gt; isset ( $_config [charset] [$r] ) ? $_config [charset] [$r] : $_config [charset] [0] ); return $this-&gt;connect ( $db_config, $r, $r == $m ? false : $db_master );\t&#125; å…¶å®å°±æ˜¯é€šè¿‡ä¼ å…¥initConnectæ¥åŒºåˆ†è¯»å†™æ“ä½œï¼Œå¹¶æ ¹æ®é…ç½®å»è¿æ¥æ“ä½œã€‚ ä»Šå¤©åˆ†æå°±åˆ°è¿™é‡Œäº†ï¼Œå…¶å®ä¸æˆ‘ä»¬yyçš„åŸºæœ¬ä¸€è‡´ã€‚","tags":["ThinkPHP"],"categories":["PHP"]},{"title":"swooleå‘é‚®ä»¶","path":"/2018/11/29/171/","content":"Swooleï¼šé¢å‘ç”Ÿäº§ç¯å¢ƒçš„ PHP å¼‚æ­¥ç½‘ç»œé€šä¿¡å¼•æ“ å¾ˆæ—©å°±çŸ¥é“äº†swooleï¼Œä½†ä¸€ç›´æ²¡æœ‰å®é™…ç”¨åˆ°ç”Ÿäº§ä¸­ï¼Œæœ€è¿‘åœ¨é‡æ„åšå®¢ï¼Œå°±æƒ³ç€åšç‚¹ä¸œè¥¿ï¼Œå…ˆswooleå‘é‚®ä»¶ç»ƒç»ƒæ‰‹ã€‚ å›é¡¾ä¸‹å‘é‚®ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨PHPMaileræ¥å‘é€ã€‚ &lt;?php/** * Created by PhpStorm. * User: puresai * Date: 2018/11/29 * Time: 11:16 */require &#x27;../vendor/autoload.php&#x27;;use PHPMailer\\PHPMailer\\PHPMailer;use PHPMailer\\PHPMailer\\Exception;$mail = new PHPMailer(true);try &#123; //Server settings // $mail-&gt;SMTPDebug = 2; // Enable verbose debug output $mail-&gt;isSMTP(); // Set mailer to use SMTP $mail-&gt;Host = &#x27;smtp.163.com&#x27;; // Specify main and backup SMTP servers $mail-&gt;SMTPAuth = true; // Enable SMTP authentication $mail-&gt;Username = &#x27;sai@163.com&#x27;; // SMTP username $mail-&gt;Password = &#x27;*&#x27;; // SMTP password $mail-&gt;SMTPSecure = &#x27;tls&#x27;; // Enable TLS encryption, ssl also accepted $mail-&gt;Port = 25; // TCP port to connect to //æ”¶ä»¶äºº $mail-&gt;setFrom(&#x27;sai@163.com&#x27;, &#x27;puresai&#x27;); $mail-&gt;addAddress(&#x27;957042781@qq.com&#x27;); // Name is optional $mail-&gt;addReplyTo(&#x27;957042781@qq.com&#x27;, &#x27;Information&#x27;);// $mail-&gt;addCC(&#x27;cc@example.com&#x27;);// $mail-&gt;addBCC(&#x27;bcc@example.com&#x27;); //é™„ä»¶ $mail-&gt;addAttachment(&#x27;/var/file.tar.gz&#x27;); // Add attachments $mail-&gt;addAttachment(&#x27;/tmp/image.jpg&#x27;, &#x27;new.jpg&#x27;); // Optional name //html $mail-&gt;isHTML(true); $mail-&gt;Subject = &#x27;Here is the subject&#x27;; $mail-&gt;Body = &#x27;This is the HTML message body &lt;b&gt;in bold!&lt;/b&gt;&#x27;; $mail-&gt;AltBody = &#x27;This is the body in plain text for non-HTML mail clients&#x27;; $mail-&gt;send(); echo &#x27;Message has been sent&#x27;;&#125; catch (Exception $e) &#123; echo &#x27;Message could not be sent.&#x27;; echo &#x27;Mailer Error: &#x27; . $mail-&gt;ErrorInfo;&#125; è¿è¡Œå‘é€ï¼Œæ”¶åˆ°é‚®ä»¶ã€‚ ä¸»ç¨‹åº&lt;?php/** Created by PhpStorm. User: puresai Date: 2018/11/29 Time: 14:06/require dirname(DIR).&#x27;/vendor/autoload.php&#x27;;use PHPMailer\\PHPMailer\\PHPMailer;use PHPMailer\\PHPMailer\\Exception;class Mailer&#123; protected $server; protected $host = &#x27;127.0.0.1&#x27;; protected $port = 9502; // è¿›ç¨‹åç§° protected $taskName = &#x27;swooleMailer&#x27;; // PIDè·¯å¾„ protected $pidPath = &#x27;/run/swooleMail.pid&#x27;; // è®¾ç½®è¿è¡Œæ—¶å‚æ•° protected $options = [ &#x27;worker_num&#x27; =&gt; 4, //workerè¿›ç¨‹æ•°,ä¸€èˆ¬è®¾ç½®ä¸ºCPUæ•°çš„1-4å€ &#x27;daemonize&#x27; =&gt; true, //å¯ç”¨å®ˆæŠ¤è¿›ç¨‹ &#x27;log_file&#x27; =&gt; &#x27;/data/logs/swoole.log&#x27;, //æŒ‡å®šswooleé”™è¯¯æ—¥å¿—æ–‡ä»¶ &#x27;log_level&#x27; =&gt; 0, //æ—¥å¿—çº§åˆ« èŒƒå›´æ˜¯0-5ï¼Œ0-DEBUGï¼Œ1-TRACEï¼Œ2-INFOï¼Œ3-NOTICEï¼Œ4-WARNINGï¼Œ5-ERROR &#x27;dispatch_mode&#x27; =&gt; 1, //æ•°æ®åŒ…åˆ†å‘ç­–ç•¥,1-è½®è¯¢æ¨¡å¼ &#x27;task_worker_num&#x27; =&gt; 4, //taskè¿›ç¨‹çš„æ•°é‡ &#x27;task_ipc_mode&#x27; =&gt; 3, //ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ï¼Œå¹¶è®¾ç½®ä¸ºäº‰æŠ¢æ¨¡å¼ //&#x27;heartbeat_idle_time&#x27; =&gt; 600, //ä¸€ä¸ªè¿æ¥å¦‚æœ600ç§’å†…æœªå‘æœåŠ¡å™¨å‘é€ä»»ä½•æ•°æ®ï¼Œæ­¤è¿æ¥å°†è¢«å¼ºåˆ¶å…³é—­ //&#x27;heartbeat_check_interval&#x27; =&gt; 60, //å¯ç”¨å¿ƒè·³æ£€æµ‹ï¼Œæ¯éš”60sè½®å¾ªä¸€æ¬¡ ]; // é‚®ä»¶æœåŠ¡å™¨é…ç½® protected $mailConfig = [ &#x27;smtp_host&#x27; =&gt; &#x27;smtp.163.com&#x27;, &#x27;username&#x27; =&gt; &#x27;sai0556@163.com&#x27;, &#x27;password&#x27; =&gt; &#x27;xmw1015&#x27;,// SMTP å¯†ç /å£ä»¤ &#x27;secure&#x27; =&gt; &#x27;ssl&#x27;, //Enable TLS encryption, ssl also accepted &#x27;port&#x27; =&gt; 465, // tcpé‚®ä»¶æœåŠ¡å™¨ç«¯å£ ]; public function __construct($mailConfig, $options = []) &#123; // æ„å»ºServerå¯¹è±¡ï¼Œç›‘å¬ç«¯å£ $this-&gt;server = new swoole_server($this-&gt;host, $this-&gt;port); if (!empty($options)) &#123; $this-&gt;options = array_merge($this-&gt;options, $options); &#125; $this-&gt;server-&gt;set($this-&gt;options); $this-&gt;mailConfig = $mailConfig; // æ³¨å†Œäº‹ä»¶ $this-&gt;server-&gt;on(&#x27;Start&#x27;, [$this, &#x27;onStart&#x27;]); $this-&gt;server-&gt;on(&#x27;Connect&#x27;, [$this, &#x27;onConnect&#x27;]); $this-&gt;server-&gt;on(&#x27;Receive&#x27;, [$this, &#x27;onReceive&#x27;]); $this-&gt;server-&gt;on(&#x27;Task&#x27;, [$this, &#x27;onTask&#x27;]); $this-&gt;server-&gt;on(&#x27;Finish&#x27;, [$this, &#x27;onFinish&#x27;]); $this-&gt;server-&gt;on(&#x27;Close&#x27;, [$this, &#x27;onClose&#x27;]); // å¯åŠ¨æœåŠ¡ //$this-&gt;server-&gt;start(); &#125; protected function init() &#123; // &#125; public function start() &#123; // Run worker $this-&gt;server-&gt;start(); &#125; public function onStart($server) &#123; // è®¾ç½®è¿›ç¨‹å cli_set_process_title($this-&gt;taskName); //è®°å½•è¿›ç¨‹id,è„šæœ¬å®ç°è‡ªåŠ¨é‡å¯ $pid = &quot;&#123;$server-&gt;master_pid&#125;&#123;$server-&gt;manager_pid&#125;&quot;; file_put_contents($this-&gt;pidPath, $pid); &#125; //ç›‘å¬è¿æ¥è¿›å…¥äº‹ä»¶ public function onConnect($server, $fd, $from_id) &#123; $server-&gt;send($fd, &quot;Hello &#123;$fd&#125;!&quot; ); &#125; // ç›‘å¬æ•°æ®æ¥æ”¶äº‹ä»¶ public function onReceive(swoole_server $server, $fd, $from_id, $data) &#123; $res[&#x27;result&#x27;] = &#x27;success&#x27;; $server-&gt;send($fd, json_encode($res)); // åŒæ­¥è¿”å›æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ $server-&gt;task($data); // æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ &#125; /* @param $server swoole_server swoole_serverå¯¹è±¡ @param $task_id int ä»»åŠ¡id @param $from_id int æŠ•é€’ä»»åŠ¡çš„worker_id @param $data string æŠ•é€’çš„æ•°æ® / public function onTask(swoole_server $server, $task_id, $from_id, $data) &#123; $res[&#x27;result&#x27;] = &#x27;failed&#x27;; $req = json_decode($data, true); $action = $req[&#x27;action&#x27;]; echo date(&#x27;Y-m-d H:i:s&#x27;).&quot; onTask: [&quot;.$action.&quot;].&quot;; switch ($action) &#123; case &#x27;sendMail&#x27;: //å‘é€å•ä¸ªé‚®ä»¶ $mailData = [ &#x27;emailAddress&#x27; =&gt; $req[&#x27;to&#x27;], //æ¥æ”¶æ–¹ï¼Œæ”¹æˆè‡ªå·±çš„é‚®ç®±å¯ä»¥æµ‹è¯•æ¥æ”¶é‚®ä»¶ &#x27;subject&#x27; =&gt; $req[&#x27;subject&#x27;], &#x27;body&#x27; =&gt; $req[&#x27;body&#x27;], ]; $this-&gt;sendMail($mailData); break; default: break; &#125; &#125; /* @param $server swoole_server swoole_serverå¯¹è±¡ @param $task_id int ä»»åŠ¡id @param $data string ä»»åŠ¡è¿”å›çš„æ•°æ® */ public function onFinish(swoole_server $server, $task_id, $data) &#123; // &#125; // ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶ public function onClose($server, $fd, $from_id) &#123; echo &quot;Client &#123;$fd&#125; close connection&quot;; &#125; public function stop() &#123; $this-&gt;server-&gt;stop(); &#125; private function sendMail($mailData = []) &#123; $mail = new PHPMailer(true); try &#123; $mailConfig = $this-&gt;mailConfig; $mail-&gt;isSMTP(); // TCP port to connect to $mail-&gt;Host = $mailConfig[&#x27;smtp_host&#x27;]; // SMTPæœåŠ¡ $mail-&gt;SMTPAuth = true; // Enable SMTP authentication $mail-&gt;Username = $mailConfig[&#x27;username&#x27;]; // SMTP ç”¨æˆ·å $mail-&gt;Password = $mailConfig[&#x27;password&#x27;]; // SMTP å¯†ç /å£ä»¤ $mail-&gt;SMTPSecure = $mailConfig[&#x27;secure&#x27;]; // Enable TLS encryption, ssl also accepted $mail-&gt;Port = $mailConfig[&#x27;port&#x27;]; // TCP ç«¯å£ //Recipients $mail-&gt;setFrom(&#x27;sai0556@163.com&#x27;, &#x27;puresai&#x27;); $mail-&gt;addAddress(&#x27;957042781@qq.com&#x27;); // Name is optional $mail-&gt;addReplyTo(&#x27;957042781@qq.com&#x27;, &#x27;Information&#x27;); //Content $mail-&gt;isHTML(true); // Set email format to HTML $mail-&gt;Subject = &#x27;Here is the subject&#x27;; $mail-&gt;Body = &#x27;This is the HTML message body &lt;b&gt;in bold!&lt;/b&gt;&#x27;; $mail-&gt;AltBody = &#x27;This is the body in plain text for non-HTML mail clients&#x27;; $mail-&gt;send(); echo &#x27;Message has been sent&#x27;; &#125; catch (Exception $e) &#123; echo &#x27;Message could not be sent.&#x27;; echo &#x27;Mailer Error: &#x27; . $mail-&gt;ErrorInfo; &#125; try &#123; $mailConfig = $this-&gt;mailConfig; $mail-&gt;isSMTP(); // Set mailer to use SMTP $mail-&gt;Host = $mailConfig[&#x27;smtp_host&#x27;]; // SMTPæœåŠ¡ $mail-&gt;SMTPAuth = true; // Enable SMTP authentication $mail-&gt;Username = $mailConfig[&#x27;username&#x27;]; // SMTP ç”¨æˆ·å $mail-&gt;Password = $mailConfig[&#x27;password&#x27;]; // SMTP å¯†ç /å£ä»¤ $mail-&gt;SMTPSecure = $mailConfig[&#x27;secure&#x27;]; // Enable TLS encryption, ssl also accepted $mail-&gt;Port = $mailConfig[&#x27;port&#x27;]; // TCP ç«¯å£ $mail-&gt;CharSet = &quot;UTF-8&quot;; //å­—ç¬¦é›† $mail-&gt;setFrom($mailConfig[&#x27;username&#x27;], &#x27;puresai&#x27;); //å‘ä»¶äººåœ°å€ï¼Œåç§° $mail-&gt;addAddress($mailData[&#x27;emailAddress&#x27;], &#x27;äº²&#x27;); // æ”¶ä»¶äººåœ°å€å’Œåç§° //$mail-&gt;addCC(&#x27;hellowebanet@163.com&#x27;); // æŠ„é€ if (isset($mailData[&#x27;attach&#x27;])) &#123; $mail-&gt;addAttachment($mailData[&#x27;attach&#x27;]); // æ·»åŠ é™„ä»¶ &#125; //$mail-&gt;addAttachment(&#x27;/tmp/image.jpg&#x27;, &#x27;new.jpg&#x27;); // Optional name //Content $mail-&gt;isHTML(true); // Set email format to HTML $mail-&gt;Subject = $mailData[&#x27;subject&#x27;]; $mail-&gt;Body = $mailData[&#x27;body&#x27;]; $mail-&gt;send(); return true; &#125; catch (\\Exception $e) &#123; echo &#x27;Message could not be sent. Mailer Error: &#x27;. $mail-&gt;ErrorInfo; return false; &#125; &#125;&#125; æœåŠ¡ï¼š&lt;?php/* Created by PhpStorm. User: puresai Date: 2018/11/29 Time: 14:09 /require DIR . &#x27;/Mailer.php&#x27;;$config = [ &#x27;smtp_host&#x27; =&gt; &#x27;smtp.163.com&#x27;, &#x27;username&#x27; =&gt; &#x27;sai@163.com&#x27;, &#x27;password&#x27; =&gt; &#x27;&#x27;, &#x27;secure&#x27; =&gt; &#x27;ssl&#x27;, &#x27;port&#x27; =&gt; 465];$server = new Mailer($config);$server-&gt;start(); å‘é€&lt;?php/** Created by PhpStorm. User: puresai Date: 2018/11/29 Time: 14:14 /class Client&#123; private $client; public function __construct() &#123; $this-&gt;client = new swoole_client(SWOOLE_SOCK_TCP); &#125; public function send() &#123; if( !$this-&gt;client-&gt;connect(&quot;127.0.0.1&quot;, 9502 , 1) ) &#123; echo &quot;Error: &#123;$this-&gt;client-&gt;errMsg&#125;[&#123;$this-&gt;client-&gt;errCode&#125;]&quot;; &#125; $action = &#x27;sendMail&#x27;; $time = time(); $data = [ &#x27;action&#x27; =&gt; $action, &#x27;to&#x27; =&gt; &#x27;957042781@qq.com&#x27;, &#x27;subject&#x27; =&gt; &#x27;wow&#x27;, &#x27;body&#x27; =&gt; &#x27;hello, puresai!&#x27; ]; $msg = json_encode($data); $this-&gt;client-&gt;send( $msg ); $message = $this-&gt;client-&gt;recv(); echo &quot;Get Message From Server:&#123;$message&#125;&quot;; &#125;&#125;$client = new Client();$client-&gt;send(); æµ‹è¯•é€šè¿‡ï¼ æ³¨æ„ï¼š æ­¤å¤„æˆ‘ç”¨äº†25ç«¯å£ï¼Œéƒ¨ç½²åˆ°Linuxæ—¶ä¸Šå‘é€é‚®ä»¶å‘ä¸å‡ºå»ï¼ŒæŠŠPHPMailerçš„é”™è¯¯è¯´æ˜æŸ¥äº†ä¸ªéï¼Œwrongï¼Œç«¯å£æ”¹ä¸º465ï¼Œä½¿ç”¨sslå‘é€ï¼Œokï¼ å¿ƒç´¯ã€‚","tags":["swoole"],"categories":["PHP"]},{"title":"nginxå¥åº·æ£€æŸ¥","path":"/2018/10/19/Nginx4/","content":"é¢è¯•è¢«é—®åˆ°å¥åº·æ£€æµ‹ï¼Œè‡ªå·±ä¸äº†è§£ï¼Œä¾¿æœ‰äº†ä¸‹æ–‡ã€‚ å½“é¡¹ç›®è®¿é—®é‡æ¯”è¾ƒå¤§æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨nginxåšè´Ÿè½½å‡è¡¡ã€‚ å¦‚ä¸‹ï¼š #è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒhttp &#123; #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰ include /etc/nginx/mime.types; default_type application/octet-stream; #è®¾å®šæ—¥å¿—æ ¼å¼ access_log /var/log/nginx/access.log; #çœç•¥ä¸Šæ–‡æœ‰çš„ä¸€äº›é…ç½®èŠ‚ç‚¹ #ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ #è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨ upstream sai&#123; #weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ server 192.168.8.1:3128 weight=5; #æœ¬æœºä¸Šçš„Squidå¼€å¯3128ç«¯å£,ä¸æ˜¯å¿…é¡»è¦squid server 192.168.8.2:80 weight=1; server 192.168.8.3:80 weight=6; &#125; #ç¬¬ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨ server &#123; #ä¾¦å¬192.168.8.xçš„80ç«¯å£ listen 80; server_name www.puresai.com; #å¯¹aspxåç¼€çš„è¿›è¡Œè´Ÿè½½å‡è¡¡è¯·æ±‚ location ~ .*.php$ &#123; #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½® root /root; #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§° index index.php index.html index.htm; #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ proxy_pass http://sai; #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤. proxy_redirect off; #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_max_body_size 10m; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œ client_body_buffer_size 128k; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶) proxy_connect_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) proxy_read_timeout 90; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffer_size 4k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½® proxy_buffers 4 32k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ proxy_busy_buffers_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼  proxy_temp_file_write_size 64k; &#125; &#125;&#125; è¿™æ˜¯nginxä¸­æ–‡ç½‘ä¸Šçš„ä¸€ä¸ªå®ä¾‹ï¼ˆæœ‰åˆ æ”¹ï¼‰ï¼Œè¿™æ ·å¤„ç†åˆ†å‘æœåŠ¡å™¨ï¼Œæˆ‘ä»¬åŠ å…¥äº†ä¸‰å°æœºå™¨ï¼Œä¿è¯äº†é¡¹ç›®çš„è´Ÿè½½é‡ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬å¸¸å¸¸å¿½ç•¥å¦ä¸€ä»¶äº‹ï¼Œå°±æ˜¯å¥åº·æ£€æŸ¥ã€‚ï¼ˆå¥½å§ï¼Œå…¶å®æˆ‘ä¹Ÿå¿½ç•¥äº†è¿™ä¸ªé—®é¢˜ï¼Œé¢è¯•è¢«é—®åˆ°ï¼Œä¸€è„¸æ‡µï¼ï¼ï¼ï¼‰ ä½•ä¸ºå¥åº·ç›‘æµ‹ï¼Ÿ å‡å¦‚æˆ‘ä»¬åŠ å…¥çš„3å°æœºå™¨ä¸­æœ‰ä¸€å°å› ä¸ºå…¶ä»–åŸå› æŒ‚æ‰äº†ï¼Œä½†åˆ†å‘çš„æœåŠ¡å™¨æ˜¯ä¸çŸ¥é“çš„ï¼Œä¾æ—§æ­£å¸¸åˆ†å‘è¯·æ±‚ï¼Œå¿…ç„¶å°±å¯¼è‡´éƒ¨åˆ†ç”¨æˆ·è®¿é—®å¤±è´¥ï¼Œè¿™æ˜¯å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°å¥åº·æ£€æŸ¥äº†ã€‚ ä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸¤ç§å¥åº·æ£€æŸ¥ï¼š è¢«åŠ¨æ£€æŸ¥ï¼š å¦‚æœ Nginx åœ¨ 10 ç§’å†…æœ‰ 2 ä¸ªè¯·æ±‚å‘é€å¤±è´¥æˆ–æ²¡æœ‰æ¥æ”¶åˆ°å“åº”ï¼Œåˆ™æ ‡è®°æœåŠ¡å™¨ä¸ºä¸å¯ç”¨ upstream sai&#123; server 192.168.8.1:3128 max_fails=2 fail_timeout=10s weight=5; server 192.168.8.2:80 max_fails=2 fail_timeout=10s weight=1; server 192.168.8.3:80 max_fails=2 fail_timeout=10s weight=6;&#125;Copy ä¸»åŠ¨æ£€æŸ¥ï¼š éœ€è¦å…ˆå¼€å¯health_check upstream sai&#123; zone sai 64k; server 192.168.8.1:3128 max_fails=2 fail_timeout=10s weight=5; server 192.168.8.2:80 max_fails=2 fail_timeout=10s weight=1; server 192.168.8.3:80 max_fails=2 fail_timeout=10s weight=6;&#125;location ~ .*.php$ &#123; #å…¶ä»–çœç•¥ â€¦ proxy_pass http://sai; health_check interval=10 fails=3 passes=2; # ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤ç§ï¼ŒæŒ‡å®šç‰¹å®šæ¥å£ health_check uri=/some/path;&#125;Copy é…ç½®èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ proxy_next_upstream# å¼€å¯proxy_next_upstream proxy_next_upstream onupstream proxy_web&#123; server 192.168.1.120:7851 weight=2 max_fails=3 fail_timeout=100s; server 192.168.1.121:7851 weight=2 max_fails=3 fail_timeout=100s;&#125;server &#123; listen 80; server_name blog.puresai.com; root /www; index index.html; location /sys &#123; proxy_pass http://proxy_web; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\t// 502,404,errorè‡ªåŠ¨ä»£ç†åˆ°ä¸‹ä¸€ä¸ªserver proxy_next_upstream http_502 http_504 error timeout invalid_header; &#125;&#125; å¦‚è¦äº†è§£æ›´å¤šå¯ä»¥æŸ¥çœ‹nginxæ‰‹å†Œï¼š nginxå¥åº·ç›‘æµ‹","tags":["Nginx"],"categories":["Nginx"]},{"title":"åŸºäºRedisçš„ç§’æ€","path":"/2018/08/09/165/","content":"éšç€ç”µå•†ä¸šåŠ¡çš„å‘å±•ï¼Œç§’æ€æ˜¯ä¸ªååˆ†å¸¸è§çš„åœºæ™¯ï¼Œä»Šå¤©æˆ‘ä»¬æ¥åˆ©ç”¨Rediså®ç°ä¸€ä¸ªç®€å•çš„ç§’æ€ç³»ç»Ÿã€‚ å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªå•†å“idä¸º1ï¼Œç§’æ€æ•°é‡æ˜¯5ã€‚ ä¸€èˆ¬åœºæ™¯ï¼š include &#x27;db.php&#x27;;$db = new db([ &#x27;database_type&#x27; =&gt; &#x27;mysql&#x27;, &#x27;database_name&#x27; =&gt; &#x27;test&#x27;, &#x27;server&#x27; =&gt; &#x27;www.puresai.com&#x27;, &#x27;username&#x27; =&gt; &#x27;puresai&#x27;, &#x27;password&#x27; =&gt; &#x27;*&#x27;, &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;]);$stock_num= $db-&gt;get(&#x27;goods&#x27;, &#x27;stock_num&#x27;, [&#x27;id&#x27; =&gt; 1]);// æ£€æµ‹åº“å­˜if ($stock_num&gt; 0) &#123; sleep(1); //æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ $db-&gt;update(&#x27;goods&#x27;, [&quot;stock_num[-]&quot; =&gt; 1], [&#x27;id&#x27; =&gt; 1]); print_r(&#x27;ok&#x27;)&#125; else &#123; print_r(&#x27;sorry&#x27;)&#125; æˆ‘ä»¬å°è¯•æ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ï¼Œä½¿ç”¨abå‹æµ‹å·¥å…·ï¼Œ ab -n 500 -c 500 http://www.puresai.com/test/miaosha.php è¿è¡Œåå‘ç°åº“å­˜stock_numå¾ˆå¯èƒ½å·²ç»å˜æˆè´Ÿæ•°äº†ï¼Œå‡ºç°äº†è¶…å–é—®é¢˜ã€‚ å¼•å…¥Redis //å®ä¾‹åŒ–Redis$Redis = new Redis();//è¿æ¥$Redis-&gt;connect(&#x27;127.0.0.1&#x27;, 6379);$key = &#x27;sale&#x27;;//æ£€æµ‹æ˜¯å¦è¿æ¥æˆåŠŸ// echo &quot;Server is running: &quot; . $Redis-&gt;ping();$Redis-&gt;setnx($key, 0);$Redis-&gt;watch($key); //ç›‘æµ‹ä¸€ä¸ªkeyçš„å€¼æ˜¯å¦è¢«æ›´æ”¹$sale_num = $Redis-&gt;get($key);if ($sale_num &gt; 4) &#123; exit();&#125;$Redis-&gt;multi(); //æ ‡è®°äº‹åŠ¡$Redis-&gt;incr($key); //é”€é‡+1sleep(1); //æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ$ret = $Redis-&gt;exec(); // äº‹åŠ¡å—å†…æ‰€æœ‰å‘½ä»¤çš„è¿”å›å€¼ï¼ŒæŒ‰å‘½ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºæ’åˆ—ã€‚if ($ret) &#123; include &#x27;db.php&#x27;; $db = new db([ &#x27;database_type&#x27; =&gt; &#x27;mysql&#x27;, &#x27;database_name&#x27; =&gt; &#x27;test&#x27;, &#x27;server&#x27; =&gt; &#x27;www.puresai.com&amp;#39;, &#x27;username&#x27; =&gt; &#x27;puresai&#x27;, &#x27;password&#x27; =&gt; &#x27;*&#x27;, &#x27;charset&#x27; =&gt; &#x27;utf8&#x27; ]); $db-&gt;update(&#x27;goods&#x27;, [&quot;stock_num[-]&quot; =&gt; 1], [&#x27;id&#x27; =&gt; 1]);&#125; é‡æ–°å¢åŠ åº“å­˜åˆ°5ï¼Œå¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°åº“å­˜å¹¶æ— å‡ºç°è´Ÿæ•°æƒ…å†µï¼Œæµ‹è¯•é€šè¿‡ã€‚","tags":["Redis"],"categories":["Redis"]},{"title":"ä¸¤ä¸ªå…³äºLinuxçš„é—®é¢˜","path":"/2018/07/06/163/","content":"æœ€è¿‘æœ‰ç‚¹å¿™ï¼Œä¸€ä¼šä¸‹ç­ï¼Œä¹Ÿä¸æƒ³æ•²ä»£ç äº†ï¼Œå†™å†™å‰æ®µæ—¶é—´é‡åˆ°çš„ä¸¤ä¸ªå…³äºLinuxçš„é—®é¢˜ã€‚è™½ç„¶ä¸¤ä¸ªé—®é¢˜éƒ½æ˜¯åŒäº‹è§£å†³çš„ï¼Œä½†æœ‰å¿…è¦åˆ†äº«ä¸€ä¸‹ã€‚ OOM OOM killerï¼ˆOut-Of-Memory killerï¼‰ï¼Œè¯¥æœºåˆ¶ä¼šç›‘æ§é‚£äº›å ç”¨å†…å­˜è¿‡å¤§ï¼Œå°¤å…¶æ˜¯ç¬é—´å¾ˆå¿«æ¶ˆè€—å¤§é‡å†…å­˜çš„è¿›ç¨‹ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜è€—å°½è€Œå†…æ ¸ä¼šæŠŠè¯¥è¿›ç¨‹æ€æ‰ã€‚ èµ·å› ï¼šå¯¼å‡ºç›¸å½“å¤§çš„æ•°æ®æ—¶å¯¼è‡´å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼ŒæœåŠ¡å™¨è´Ÿè½½å¾ˆå¤§ï¼Œç„¶åOOMè¿™ä¸ªè¿›ç¨‹æ¯æ¬¡å°±æŠŠæˆ‘å¯¼å‡ºçš„è¿›ç¨‹å¹²è¶´ä¸‹äº†ã€‚ æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°ulimit -n //æŸ¥çœ‹æ–‡ä»¶æœ€å¤§æ‰“å¼€æ•°lsof |wc -l //å½“å‰æ–‡ä»¶æ‰“å¼€æ•°é‡ èµ·å› ï¼šå®ˆæŠ¤è¿›ç¨‹é‡Œæœ‰ä¸ªç¨‹åºï¼Œä¸€ç›´åœ¨fopenï¼Œå¯¼è‡´æ–‡ä»¶æ‰“å¼€æ•°è¿‡å¤§ï¼ŒæœåŠ¡å™¨æŒ‚æ‰äº†ã€‚ è§£å†³æ–¹æ¡ˆæ¯”è¾ƒç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ã€‚","tags":["Linux"],"categories":["linux"]},{"title":"å…³äºå¤§è¡¨æŸ¥è¯¢æœ€åå‡ é¡µè¿‡æ…¢çš„åŸå› ","path":"/2018/05/31/157/","content":"mysqlæ•°æ®é‡å¾ˆå¤§ä½¿ç”¨limitæŸ¥è¯¢æœ€åå‡ é¡µå¾ˆæ…¢ï¼Œä½ çŸ¥é“åŸå› ä¹ˆï¼Ÿ æˆ‘ä»¬ä¸å¦¨å…ˆæ¥çœ‹çœ‹å‡ æ¡æŸ¥è¯¢è¯­å¥ä¸ç»“æœã€‚ select * from test_user where id&gt;9900000 limit 0,10;select * from test_user limit 9900000,10;select * from test_user where id in (select b.id from (select id from test_user where id&gt;9900000 limit 0,10) as b); //å­æŸ¥è¯¢ [SQL]select * from test_user where id&gt;9900000 limit 0,10;å—å½±å“çš„è¡Œ: 0æ—¶é—´: 0.019s[SQL]select * from test_user limit 9900000,10;å—å½±å“çš„è¡Œ: 0æ—¶é—´: 1.147s[SQL]select * from test_user where id in (select b.id from (select id from test_user where id&gt;9900000 limit 0,10) as b);å—å½±å“çš„è¡Œ: 0æ—¶é—´: 0.001s å…¶å®ï¼ŒåŸå› å°±åœ¨äºï¼š limit10000,20çš„æ„æ€æ‰«ææ»¡è¶³æ¡ä»¶çš„10020è¡Œï¼Œæ‰”æ‰å‰é¢çš„10000è¡Œï¼Œè¿”å›æœ€åçš„20è¡Œï¼Œé—®é¢˜å°±åœ¨è¿™é‡Œã€‚ è§£å†³æ–¹æ¡ˆï¼š è¿‡ä¸€åŠæ•°æ®é‡‡ç”¨å€’åºæŸ¥è¯¢ è¿ç”¨å­æŸ¥è¯¢","tags":["MySQL"],"categories":["db"]},{"title":"gitè§£å†³æ€»è¦è¾“å…¥å¯†ç çš„é—®é¢˜","path":"/2018/05/09/153/","content":"ä¹‹å‰æ¯æ¬¡pullå’Œpushæ€»è¦è¾“å…¥å¯†ç ï¼Œç¹çã€‚æ“ä½œä¸¤æ­¥ï¼Œè§£å†³é—®é¢˜ï¼ç”Ÿæˆå…¬é’¥cd&nbsp;~/.ssh ssh-keygen&nbsp;-t&nbsp;rsa&nbsp;-C&nbsp;&quot;æ³¨é‡Š&quot;æ‹·è´å…¬é’¥åˆ°è¿œç¨‹ä¸»æœºssh-copy-id&nbsp;git@xxx.comokï¼","tags":["git"],"categories":["CI"]},{"title":"MySQLè§¦å‘å™¨","path":"/2018/04/18/152/","content":"å»å¹´å¹´åº•åšæ–°åŠŸèƒ½æ—¶è€ƒè™‘ä½¿ç”¨è§¦å‘å™¨ï¼Œæ¥èŠèŠè§¦å‘å™¨ã€‚ è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œåœ¨æ»¡è¶³å®šä¹‰æ¡ä»¶æ—¶è§¦å‘ï¼Œå¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„è¯­å¥é›†åˆã€‚è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚ DELIMITER;;//å®šä¹‰ç»“æŸç¬¦ CREATE TRIGGER `updateData` AFTER UPDATE ON `buyer` FOR EACH ROW begin set @phone = right(new.phone,11); // å–æ‰‹æœºå· set @main_id = (select id from main where u_id = new.u_id); // ä»è¡¨mainå–id set @new_last_trade_time = IF( UNIX_TIMESTAMP(new.last_trade_time) &amp;gt; @old_last_trade_time, UNIX_TIMESTAMP(new.last_trade_time), @old_last_trade_time); set @add_trade_count = (new.trade_count - old.trade_count); set @add_trade_amount = (new.trade_amount - old.trade_amount); // æ›´æ–°æ“ä½œ update member set trade_count=trade_count+@add_trade_count, trade_amount=trade_amount+@add_trade_amount, last_trade_time=@new_last_trade_time where main_id = @main_id and phone = @phone; end ;; DELIMITER ; æ€§èƒ½é—®é¢˜ï¼š é€šè¿‡æµ‹è¯•ï¼Œè‹¥æˆ‘æ¯ç§’é’Ÿå‘æ•°æ®åº“ä¸­æ’å…¥700æ¡å·¦å³çš„å‘Šè­¦ä¿¡æ¯ï¼Œæ­¤æ—¶è‹¥ä½¿ç”¨è§¦å‘å™¨ï¼Œæ¯ç§’ä¸­åªä¼šæ’å…¥æ•°æ®åº“ä¸­50å·¦å³ï¼Œè‹¥ä¸å¼€å¯è§¦å‘å™¨ï¼Œé‚£ä¹ˆ700æ¡å…¨éƒ¨å¯ä»¥æ’å…¥æ•°æ®åº“ä¸­ã€‚ï¼ˆæ¥è‡ªç½‘ç»œï¼‰","tags":["mysql"],"categories":["MySQL"]},{"title":"2017,è¿™ä¸€å¹´","path":"/2018/02/13/2017/","content":"å¤§å®¶è¿‡å¹´å¥½ï¼ ä¼¼æ°´æµå¹´æ˜¯ä¸€ä¸ªäººæ‰€æœ‰çš„ä¸€åˆ‡ï¼Œåªæœ‰è¿™ä¸ªä¸œè¥¿ï¼Œæ‰çœŸæ­£å½’ä½ æ‰€æœ‰ã€‚ å…¶ä½™çš„ä¸€ åˆ‡ï¼Œéƒ½æ˜¯ç‰‡åˆ»çš„æ¬¢å¨±å’Œä¸å¹¸ï¼Œ è½¬çœ¼é—´å°±å·²è·‘åˆ°é‚£ä¼¼æ°´æµå¹´é‡Œå»äº†ã€‚â€”â€”ç‹å°æ³¢ ä¸Šå­¦æ—¶å¹´ç»ˆæ€»ç»“æ˜¯ä¸ªçƒ¦äººçš„ä¸œè¥¿ï¼Œå·¥ä½œååå€’ä¼šè‡ªè§‰åœ°å†™ä¸€å†™ï¼ŒçœŸæ˜¯å¥‡æ€ªã€‚è‡ªå·±çš„æ€»ç»“å˜›ï¼Œéšæ„ä¸€ç‚¹ã€‚ å·¥ä½œå¦‚æœè¦ç»™è¿™ä¸€å¹´çš„å·¥ä½œå®šä¸ªä¸»é¢˜è¯ï¼Œæˆ‘æƒ³æ˜¯â€”â€”æµªè¡ã€‚ æ·±åˆ‡è®¤è¯†åˆ°è‡ªå·±èƒ½åŠ›ä¸è¶³ï¼Œæœ‰ç‚¹åŒå€¦åå¤çš„å·¥ä½œï¼Œäº8æœˆåˆç¦»å¼€å¾…äº†ä¸€å¹´å¤šä¸”å¾ˆæœ‰æ„Ÿæƒ…çš„å…¬å¸ã€‚ 9æœˆåˆå…¥èŒæ–°å…¬å¸ï¼Œå¾…äº†ä¸¤ä¸ªæœˆï¼Œå·¥ä½œéæˆ‘æƒ³ï¼Œå®Œå…¨ä¸åœ¨çŠ¶æ€ï¼Œ10æœˆåº•è¾èŒã€‚ 11æœˆåˆåˆ°ç°åœ¨çš„å…¬å¸ï¼Œå‰ä¸ä¹…åˆšè½¬æ­£ï¼Œç®—æ˜¯ç¨³å®šä¸‹æ¥äº†ã€‚æ–°å…¬å¸æ°›å›´ä¸é”™ï¼Œå¾ˆæœ‰æ´»åŠ›ï¼Œèƒ½å­¦åˆ°äº›ä¹‹å‰æƒ³å­¦çš„ä¸œè¥¿ï¼Œè›®å¥½ï¼Œå·¥èµ„ç¦åˆ©æ–¹é¢è¿˜ç®—æ»¡æ„ã€‚ å·¥ä½œç›¸å…³æŠ€æœ¯æ–¹é¢ï¼Œæœ‰æ‰€æé«˜ï¼Œä½†ä»éœ€ç»§ç»­åŠªåŠ›ã€‚ ç”Ÿæ´»ç”Ÿæ´»çš„ä¸»é¢˜è¯ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯â€”â€”å°è¯•ã€‚ å¹´åˆå®šçš„7ä¸ªå°ç›®æ ‡ï¼Œå®Œæˆäº†4.25ï¼Œè¿˜ç®—æ»¡æ„ã€‚ å¼€å§‹æ³¨æ„å¥åº·ï¼Œæ³¨æ„ä½“é‡ï¼Œæ³¨æ„é¥®é£Ÿï¼Œä¸æš´é¥®æš´é£Ÿï¼Œè¾£å£æœ‰æ„è¯†å°‘åƒï¼Œæ—©ç¡æ—©èµ·è€Œä¸€ç›´æ²¡æˆåŠŸè¿›è¡Œã€‚ ä½œä¸ºæœåŠ¡è¡Œä¸šå·¥ä½œè€…ï¼Œç”Ÿæ´»ä¸­ä¹Ÿå¼€å§‹æ³¨æ„æœåŠ¡çš„ä½“éªŒï¼Œå¼€å§‹å¯¹ä¸å¥½çš„æœåŠ¡say noï¼Œå¼€å§‹æ³¨é‡ç”Ÿæ´»çš„è´¨æ„Ÿã€‚ çœ‹äº†å‡ æœ¬é—²ä¹¦ï¼Œçœ‹äº†å‡ éƒ¨è€ç”µè§†å‰§ï¼Œçœ‹äº†20å¤šéƒ¨ç”µå½±ã€‚ å¹´åº•å¼€å§‹å­¦ç´ï¼Œæœ€è¿‘å¤ªå¿™ï¼Œå‡ å‘¨æ²¡å»ä¸Šè¯¾ï¼Œä¹Ÿæ²¡å»ç»ƒç´äº†ï¼ŒæŠ€æœ¯ç°åœ¨å¤§æ¦‚èƒ½æ‹‰å°æ˜Ÿæ˜Ÿå§ï¼ 7æœˆä»½ç”³è¯·äº†ä¸ªäººå…¬ä¼—å·ï¼Œåˆ°ç°åœ¨å†™äº†åå¤šç¯‡æ–‡ç« ï¼Œ12æœˆä»½å¼€å¿ƒåœ°è¢«æ·»åŠ åŸåˆ›ã€‚ ä¸¤æ¬¡æ—…è¡Œï¼Œä¸€æ¬¡ä¹åå±±å®¶åº­æ—…è¡Œï¼Œä¸€æ¬¡æ¡‚æ—äº”æ—¥æ¸¸ã€‚æ—…è¡Œå‰ï¼Œä¹°äº†ä¸ª750ï¼Œå¶å°”ä¹Ÿä¼šå»æ‹æ‹ç…§ï¼Œåªæ˜¯æŠ€æœ¯èœäº†ç‚¹ï¼Œæ²¡æœ‰å¤šå°‘å¥½ç…§ç‰‡ã€‚ æ­¤å¤–ï¼Œå¯¹äºä»¥å‰çœ‹ä¸æƒ¯çš„äººï¼Œå°è¯•ä¿æŒå¼€æ”¾çš„å¿ƒæ€ï¼Œä¸å»æŒ‡ç‚¹ã€‚å¯¹äºä»¥å‰å¾ˆåœ¨æ„çš„äº‹ï¼Œå°è¯•ä¿æŒåˆå¿ƒï¼Œä¸å»äº‰ã€‚ äººä¹‹æ‰€ä»¥ç—›è‹¦ï¼Œåœ¨äºè¿½æ±‚é”™è¯¯çš„ä¸œè¥¿ã€‚å¦‚æœä½ ä¸ç»™è‡ªå·±çƒ¦æ¼ï¼Œåˆ«äººä¹Ÿæ°¸è¿œä¸å¯èƒ½ç»™ä½ çƒ¦æ¼ã€‚å› ä¸ºä½ è‡ªå·±çš„å†…å¿ƒï¼Œä½ æ”¾ä¸ä¸‹ã€‚å¥½å¥½çš„ç®¡æ•™ä½ è‡ªå·±ï¼Œä¸è¦ç®¡åˆ«äººã€‚â€”â€”è·¯é¥ æ€»ç»“å¦‚æœç»™è¿™ä¸€å¹´æ‰“ä¸ªåˆ†ï¼Œæˆ‘ä¼šæ‰“8åˆ†ã€‚æˆé•¿å’Œè½¬å˜æ˜¯å¯å–œçš„ï¼Œä½†èµ°äº†ä¸å°‘å†¤æ‰è·¯ï¼Œè€Œä¸€äº›å°è¯•ä¹Ÿæ˜¯çƒ§é’±çš„ï¼Œæ‰€ä»¥æˆäº†æœˆå…‰æ—ã€‚ å¸Œæœ›æ–°çš„ä¸€å¹´ï¼Œç»§ç»­å¿ äºè‡ªæˆ‘çš„è®¤çŸ¥ï¼Œæœ‰è¶£åœ°ç”Ÿæ´»ï¼Œå¼€å¿ƒåœ°å·¥ä½œã€‚ å‡ ä¹é™„ä¸Š2018çš„todolistï¼š å†™ä¸€å†™é­æ™‹çš„æ–‡ç« ï¼Œå¥½å¥½ç»è¥å…¬ä¼—å· ç»§ç»­å­¦ä¹ çˆ¬è™«æŠ€èƒ½ï¼Œåšä¸€ä¸ªçˆ¬å–çš„æ•°æ®ç›¸å…³APP ç»ƒå‡ºè…¹è‚Œ æé«˜æ‘„å½±æŠ€å·§ï¼Œæ‹ä¸€äº›å¥½ç…§ç‰‡ ç†è´¢&amp;å­˜é’± æ—©ç¡&amp;ä¸‰é¤è§„å¾‹ ä½“éªŒè¹¦æ æ”¹ä¸€é¦–èµµé•¿å¿çš„ã€Šæ¢æ˜¥ä»¤ã€‹ä»¥ä½œç»“å°¾ æ¼‚æ³ŠåŠè½½æ°å¦‚æ„ã€‚æ–°æ˜¥ä¼´å¿ƒæ€¡ã€‚ä¸‡é‡Œæ™´ç©ºï¼Œç‚ŠçƒŸç»†ç»†ã€‚å’Œæ°”å…¥ï¼Œä¸œé£é‡Œã€‚ç´ æ‰‹çº¢çœ·åœ¨å‘½ç†ã€‚ç¼˜æ¥ä¾¿çŸ¥ä¼Šã€‚ä¸è§æ™¨é›¾èµ·ï¼ŒæˆŠæˆŒå‰åˆ©ï¼Œç™¾äº‹çš†å¦‚æ„ã€‚ ä¸é…‰è…Šæœˆå»¿å…«è®°at æ­å·2018-02-13","tags":["oneyear"],"categories":["oneyear"]},{"title":"selfå’Œstatic","path":"/2017/12/07/142/","content":"PHPå®˜æ–¹ä¹Ÿè¯´è¿‡ï¼Œå¤§æ¦‚æ˜¯è¯´selfè°ƒç”¨çš„å°±æ˜¯æœ¬èº«ä»£ç ç‰‡æ®µè¿™ä¸ªç±»ï¼Œè€Œstaticè°ƒç”¨çš„æ˜¯ä»å †å†…å­˜ä¸­æå–å‡ºæ¥ï¼Œè®¿é—®çš„æ˜¯å½“å‰å®ä¾‹åŒ–çš„é‚£ä¸ªç±»ï¼Œé‚£ä¹ˆ static ä»£è¡¨çš„å°±æ˜¯é‚£ä¸ªç±»ã€‚ class A &#123; protected static $str = &quot;This is class A&quot;; public static function getStr() &#123; echo self::$str; &#125;&#125;class B extends A&#123; protected static $str = &quot;This is class B&quot;;&#125;B::getStr();// è¾“å‡ºThis is class Aclass A &#123; protected static $str = &quot;This is class A&quot;; public static function getStr() &#123; echo static::$str; &#125;&#125;class B extends A&#123; protected static $str = &quot;This is class B&quot;;&#125;B::getStr();// è¾“å‡ºThis is class B self - å°±æ˜¯è¿™ä¸ªç±»ï¼Œæ˜¯ä»£ç æ®µé‡Œé¢çš„è¿™ä¸ªç±»ã€‚static - PHP 5.3æ–°ç‰¹æ€§ã€‚å½“å‰è¿™ä¸ªç±»ï¼Œæœ‰ç‚¹åƒ$thisçš„æ„æ€ï¼Œä»å †å†…å­˜ä¸­æå–å‡ºæ¥ï¼Œè®¿é—®çš„æ˜¯å½“å‰å®ä¾‹åŒ–çš„é‚£ä¸ªç±»ï¼Œé‚£ä¹ˆ static ä»£è¡¨çš„å°±æ˜¯é‚£ä¸ªç±»ã€‚ class A&#123; public function getSelf() &#123; return new self(); &#125; public function getStatic() &#123; return new static(); &#125;&#125;$f = new A();print get_class($f-&gt;getSelf());print get_class($f-&gt;getStatic());class B extends A&#123; public function getSelf2() &#123; return new self(); &#125; public function getStatic2() &#123; return new static(); &#125;&#125;$f = new B();print get_class($f-&gt;getSelf());print get_class($f-&gt;getStatic());print get_class($f-&gt;getSelf2());print get_class($f-&gt;getStatic2());// è¾“å‡ºAAABBB","tags":["PHP"],"categories":["PHP"]},{"title":"Gitå¸¸ç”¨å‘½ä»¤","path":"/2017/11/17/141/","content":"ä¹‹å‰æ²¡ç”¨è¿‡gitï¼Œè¿˜åœ¨æŒç»­è¸©å‘ä¸­ï¼Œåç»­ç»§ç»­æ›´æ–°ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ åˆ—å‡ºtag git tag # åœ¨æ§åˆ¶å°æ‰“å°å‡ºå½“å‰ä»“åº“çš„æ‰€æœ‰tag&gt; git tag -l â€˜v0.1.*â€™ # æœç´¢ç¬¦åˆæ¨¡å¼çš„Tag æ‰“tag git tagåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šè½»é‡tagå’Œé™„æ³¨tagã€‚è½»é‡tagæ˜¯æŒ‡å‘æäº¤å¯¹è±¡çš„å¼•ç”¨ï¼Œé™„æ³¨Tagåˆ™æ˜¯ä»“åº“ä¸­çš„ä¸€ä¸ªç‹¬ç«‹å¯¹è±¡ã€‚å»ºè®®ä½¿ç”¨é™„æ³¨Tagã€‚ åˆ›å»ºè½»é‡Tag git tag v0.1.2-light åˆ›å»ºé™„æ³¨Tag git tag -a v0.1.2 -m â€œ0.1.2ç‰ˆæœ¬â€ åˆ›å»ºè½»é‡Tagä¸éœ€è¦ä¼ é€’å‚æ•°ï¼Œç›´æ¥æŒ‡å®šTagåç§°å³å¯ã€‚ åˆ›å»ºé™„æ³¨Tagæ—¶ï¼Œå‚æ•°aå³annotatedçš„ç¼©å†™ï¼ŒæŒ‡å®šTagç±»å‹ï¼Œåé™„Tagåã€‚å‚æ•°mæŒ‡å®šTagè¯´æ˜ï¼Œè¯´æ˜ä¿¡æ¯ä¼šä¿å­˜åœ¨Tagå¯¹è±¡ä¸­ã€‚ åˆ‡æ¢åˆ°Tagä¸åˆ‡æ¢åˆ†æ”¯å‘½ä»¤ç›¸åŒï¼Œç”¨ git checkout [tagname] æŸ¥çœ‹Tagä¿¡æ¯ç”¨git showå‘½ä»¤å¯ä»¥æŸ¥çœ‹Tagçš„ç‰ˆæœ¬ä¿¡æ¯ï¼š git show v0.1.2 åˆ é™¤Tagè¯¯æ‰“æˆ–éœ€è¦ä¿®æ”¹Tagæ—¶ï¼Œéœ€è¦å…ˆå°†Tagåˆ é™¤ï¼Œå†æ‰“æ–°Tagã€‚ git tag -d v0.1.2 # åˆ é™¤Tag å‚æ•°då³deleteçš„ç¼©å†™ï¼Œæ„ä¸ºåˆ é™¤å…¶åæŒ‡å®šçš„Tagã€‚ ç»™æŒ‡å®šçš„commitæ‰“Tag æ‰“Tagä¸å¿…è¦åœ¨headä¹‹ä¸Šï¼Œä¹Ÿå¯åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸Šæ‰“ï¼Œè¿™éœ€è¦ä½ çŸ¥é“æŸä¸ªæäº¤å¯¹è±¡çš„æ ¡éªŒå’Œï¼ˆé€šè¿‡git logè·å–ï¼‰ã€‚ è¡¥æ‰“Tag git tag -a v0.1.1 9fbc3d0 Tagæ¨é€åˆ°æœåŠ¡å™¨ é€šå¸¸çš„git pushä¸ä¼šå°†Tagå¯¹è±¡æäº¤åˆ°gitæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ˜¾å¼çš„æ“ä½œï¼š git push origin v0.1.2 # å°†v0.1.2 Tagæäº¤åˆ°gitæœåŠ¡å™¨&gt; git push origin â€“-tags # å°†æœ¬åœ°æ‰€æœ‰Tagä¸€æ¬¡æ€§æäº¤åˆ°gitæœåŠ¡å™¨ æ³¨æ„ï¼šå¦‚æœæƒ³çœ‹ä¹‹å‰æŸä¸ªTagçŠ¶æ€ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·æ“ä½œ git tag æŸ¥çœ‹å½“å‰åˆ†æ”¯ä¸‹çš„Tag git checkout v0.21 æ­¤æ—¶ä¼šæŒ‡å‘æ‰“v0.21 Tagæ—¶çš„ä»£ç çŠ¶æ€ï¼Œï¼ˆä½†ç°åœ¨å¤„äºä¸€ä¸ªç©ºçš„åˆ†æ”¯ä¸Šï¼‰ åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtagåœ¨Git v1.7.0 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push origin â€“delete åˆ é™¤tagè¿™ä¹ˆç”¨ï¼š git push origin â€“delete tag å¦åˆ™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºåˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œå…¶å®å°±ç›¸å½“äºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push origin : è¿™æ˜¯åˆ é™¤tagçš„æ–¹æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºtagåˆ°è¿œç¨‹tagï¼š git tag -d &gt; git push origin :refs/tags/ é‡å‘½åè¿œç¨‹åˆ†æ”¯åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š git push â€“delete origin devel é‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼š git branch -m devel develop æ¨é€æœ¬åœ°åˆ†æ”¯ï¼š git push origin develop æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹ git push â€“tags # æ¨é€æ‰€æœ‰tag&gt; git push origin :tag # æ¨é€tag â€”â€” 2017/12/04 å·¥ä½œåŒºï¼ˆWorking Directoryï¼‰ å°±æ˜¯ä½ åœ¨ç”µè„‘é‡Œèƒ½çœ‹åˆ°çš„ç›®å½•ï¼Œæ¯”å¦‚æˆ‘çš„gitæ–‡ä»¶å¤¹å°±æ˜¯ä¸€ä¸ªå·¥ä½œåŒºã€‚ ç‰ˆæœ¬åº“ï¼ˆRepositoryï¼‰ å·¥ä½œåŒºæœ‰ä¸€ä¸ªéšè—ç›®å½•.gitï¼Œè¿™ä¸ªä¸ç®—å·¥ä½œåŒºï¼Œè€Œæ˜¯Gitçš„ç‰ˆæœ¬åº“ã€‚ æš‚å­˜åŒº Gitçš„ç‰ˆæœ¬åº“é‡Œå­˜äº†å¾ˆå¤šä¸œè¥¿ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ç§°ä¸ºstageï¼ˆæˆ–è€…å«indexï¼‰çš„æš‚å­˜åŒºï¼Œè¿˜æœ‰Gitä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„ç¬¬ä¸€ä¸ªåˆ†æ”¯masterï¼Œä»¥åŠæŒ‡å‘masterçš„ä¸€ä¸ªæŒ‡é’ˆå«HEADã€‚ git addæŠŠæ–‡ä»¶æ·»åŠ è¿›å»ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠæ–‡ä»¶ä¿®æ”¹æ·»åŠ åˆ°æš‚å­˜åŒºï¼› git commitæäº¤æ›´æ”¹ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠæš‚å­˜åŒºçš„æ‰€æœ‰å†…å®¹æäº¤åˆ°å½“å‰åˆ†æ”¯ã€‚ å‘½ä»¤è¯´æ˜git cloneå…‹éš†git branch (åˆ†æ”¯å)åˆ›å»ºåˆ†æ”¯ -Dåˆ é™¤åˆ†æ”¯git checkout (åˆ†æ”¯å)åˆ‡æ¢åˆ†æ”¯ -båˆ›å»ºå¹¶åˆ‡æ¢git checkout (æ–‡ä»¶å)æ’¤é”€æ­¤æ–‡ä»¶ä¿®æ”¹git addå°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜git statusæŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰ä¿®æ”¹git commitå°†ç¼“å­˜åŒºå†…å®¹æ·»åŠ åˆ°ä»“åº“ä¸­git diffæ¥æŸ¥çœ‹æ‰§è¡Œ git status çš„ç»“æœçš„è¯¦ç»†ä¿¡æ¯git reset HEADå‘½ä»¤ç”¨äºå–æ¶ˆå·²ç¼“å­˜çš„å†…å®¹git rm æ–‡ä»¶åˆ é™¤æ–‡ä»¶-få¼ºåˆ¶åˆ é™¤git mvç§»åŠ¨æ–‡ä»¶git mergeåˆå¹¶åˆ†æ”¯git fetchä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°git push :å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœºgit push origin --delete teståˆ é™¤è¿œç¨‹åˆ†æ”¯testgit pull :å°†è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­git rebaseå‘½ä»¤åœ¨å¦ä¸€ä¸ªåˆ†æ”¯åŸºç¡€ä¹‹ä¸Šé‡æ–°åº”ç”¨ï¼Œç”¨äºæŠŠä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚git logå‘½ä»¤ç”¨äºæ˜¾ç¤ºæäº¤æ—¥å¿—ä¿¡æ¯ã€‚git reflogæ˜¾ç¤ºæ¯ä¸€æ¬¡å‘½ä»¤git revertç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤é”€æŸæ¬¡æäº¤ï¼Œæ­¤æ¬¡æäº¤ä¹‹å‰çš„commitéƒ½ä¼šè¢«ä¿ç•™git reset HEAD å¦‚æœå‘ç°é”™è¯¯çš„å°†ä¸æƒ³æš‚å­˜çš„æ–‡ä»¶è¢«git addè¿›å…¥ç´¢å¼•ä¹‹åï¼Œæƒ³å›é€€å–æ¶ˆï¼Œåˆ™å¯ä»¥ä½¿ç”¨ è®¾ç½®ç”¨æˆ·åé‚®ç®±ï¼š git config â€“global user.name â€œpuresaiâ€ git config â€“global user.email â€œ&#x39;&#53;&#55;&#48;&#x34;&#x32;&#x37;&#56;&#49;&#64;&#113;&#x71;&#46;&#x63;&#x6f;&#x6d;â€œ fatal: No configured push destination.è§£å†³ï¼š$ git remote add -f -t master -m master origin git://example.com/git.git/fatal: The current branch test has no upstream branch.è§£å†³ï¼šgit push --set-upstream origin testæ¨¡ä»¿ git cloneï¼Œä½†åªè·Ÿè¸ªé€‰å®šçš„åˆ†æ”¯$ mkdir project.git$ cd project.git$ git init$ git remote add -f -t master -m master origin git://example.com/git.git/$ git merge originfatalï¼šUnable to create &#x27;E:/project/scrm/.git/index.lock&#x27;: File exists.rm -f ./.git/index.lock git log-p æŸ¥çœ‹å·®å¼‚-n(nä¸ºæ­£æ•´æ•°) æŸ¥çœ‹æœ€è¿‘næ¬¡çš„æäº¤--pretty æŒ‰æŒ‡å®šæ ¼å¼æ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯,å¯é€‰é¡¹æœ‰ï¼šoneline,short,medium,full,fuller,email,rawä»¥åŠformat:&lt;string&gt;,é»˜è®¤ä¸ºmediumï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥æŒ‡å®šé»˜è®¤çš„æ–¹å¼ã€‚e.g. git log (--pretty=)oneline--stat åˆ—å‡ºæ–‡ä»¶çš„ä¿®æ”¹è¡Œæ•°--sortstat åªæ˜¾ç¤º--statä¸­æœ€åè¡Œæ•°ä¿®æ”¹æ·»åŠ ç§»é™¤çš„ç»Ÿè®¡--graph ä»¥ç®€å•çš„å›¾å½¢æ–¹å¼åˆ—å‡ºæäº¤è®°å½•--abbrev-commit ä»…æ˜¾ç¤º SHA-1 çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œè€Œéæ‰€æœ‰çš„ 40 ä¸ªå­—ç¬¦ã€‚--relative-date ä½¿ç”¨è¾ƒçŸ­çš„ç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆæ¯”å¦‚ï¼Œâ€œ2 weeks agoâ€ï¼‰ã€‚--name-only ä»…åœ¨æäº¤ä¿¡æ¯åæ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•ã€‚--name-status æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶æ¸…å•ã€‚ â€”â€”2017/12/01 å‘½ä»¤ è¯´æ˜ git clone å…‹éš† git branch (åˆ†æ”¯å) åˆ›å»ºåˆ†æ”¯ -Dåˆ é™¤åˆ†æ”¯ git checkout (åˆ†æ”¯å) åˆ‡æ¢åˆ†æ”¯ -båˆ›å»ºå¹¶åˆ‡æ¢ git add å°†è¯¥æ–‡ä»¶æ·»åŠ åˆ°ç¼“å­˜ git status æŸ¥çœ‹åœ¨ä½ ä¸Šæ¬¡æäº¤ä¹‹åæ˜¯å¦æœ‰ä¿®æ”¹ git commit å°†ç¼“å­˜åŒºå†…å®¹æ·»åŠ åˆ°ä»“åº“ä¸­ git diff æ¥æŸ¥çœ‹æ‰§è¡Œ git status çš„ç»“æœçš„è¯¦ç»†ä¿¡æ¯ git reset HEAD å‘½ä»¤ç”¨äºå–æ¶ˆå·²ç¼“å­˜çš„å†…å®¹ git rm æ–‡ä»¶ åˆ é™¤æ–‡ä»¶-få¼ºåˆ¶åˆ é™¤ git mv ç§»åŠ¨æ–‡ä»¶ git merge åˆå¹¶åˆ†æ”¯ git fetch ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ° git push : å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœº git push origin --delete test åˆ é™¤è¿œç¨‹åˆ†æ”¯test git pull : å°†è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­ git rebase å‘½ä»¤åœ¨å¦ä¸€ä¸ªåˆ†æ”¯åŸºç¡€ä¹‹ä¸Šé‡æ–°åº”ç”¨ï¼Œç”¨äºæŠŠä¸€ä¸ªåˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚ fatal: No configured push destination.è§£å†³ï¼š$ git remote add -f -t master -m master origin git://example.com/git.git/fatal: The current branch test has no upstream branch.è§£å†³ï¼šgit push --set-upstream origin testæ¨¡ä»¿ git cloneï¼Œä½†åªè·Ÿè¸ªé€‰å®šçš„åˆ†æ”¯$ mkdir project.git$ cd project.git$ git init$ git remote add -f -t master -m master origin git://example.com/git.git/$ git merge origin","tags":["git"],"categories":["CI"]},{"title":"åˆè¯†gulp","path":"/2017/11/12/140/","content":"ä½¿ç”¨ gulp ä¹‹å‰è¯·å®‰è£…å¥½nodeå’Œnpmï¼Œä¸ºäº†é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨cnpmã€‚ å…¨å±€å®‰è£… cnpm install gulp -g glup -v // è¾“å…¥ç‰ˆæœ¬ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚ æ–°å»ºpackage.json&#123;\t&quot;name&quot;: &quot;sai&quot;,\t&quot;version&quot;: &quot;1.0&quot;,\t&quot;description&quot;: &quot;gulp css!&quot;,\t&quot;author&quot;: &#123; &quot;name&quot;: &quot;puresai&quot;, &quot;email&quot;: &quot;95742781@qq.com&quot;\t&#125;,\t&quot;license&quot;: &quot;MIT&quot;,\t&quot;devDependencies&quot;: &#123; &quot;gulp&quot;: &quot;^3.9.1&quot;, &quot;gulp-minify-css&quot;: &quot;^1.2.4&quot;\t&#125;&#125; æœ¬åœ°å®‰è£…gulpï¼Œgulp-minify-cssã€‚cnpm install gulp --save-dev cnpm install gulp-minify-css --save-dev æ–°å»ºgulpfile.jsvar gulp = require(&#x27;gulp&#x27;), mincss = require(&#x27;gulp-minify-css&#x27;);//å®šä¹‰ä¸€ä¸ªsaiä»»åŠ¡gulp.task(&#x27;sai&#x27;, function () &#123; gulp.src(&#x27;assets/css/*.css&#x27;) //è¯¥ä»»åŠ¡é’ˆå¯¹çš„æ–‡ä»¶ .pipe(mincss()) //è¯¥ä»»åŠ¡è°ƒç”¨çš„æ¨¡å— .pipe(gulp.dest(&#x27;assets/mini&#x27;)); //å°†ä¼šåœ¨assets/miniä¸‹ç”Ÿæˆcss&#125;); gulp.task(&#x27;default&#x27;,[&#x27;sai&#x27;]); //å®šä¹‰é»˜è®¤ä»»åŠ¡ cmdæ‰§è¡Œgulp gulp ä¼šçœ‹åˆ°ä»»åŠ¡saiå¼€å§‹ï¼Œå®Œæˆï¼Œè¿™æ ·å°±å®Œæˆäº†gulpå‹ç¼©cssã€‚ æ­¤å¤–ï¼Œgulpè¿˜å¯ä»¥å‹ç¼©jsï¼Œimgã€‚","tags":["gulp"],"categories":["js"]},{"title":"SVNæœåŠ¡å™¨ä¸webç«™ç‚¹ä»£ç åŒæ­¥æ›´æ–°","path":"/2017/10/09/138/","content":"å› ä¸ºSVNæœåŠ¡å™¨ä¸webç«™ç‚¹ä»£ç æ˜¯æ”¾åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•æ¥åšä¸€ä¸ªåŒæ­¥æ›´æ–°ã€‚ ä½†æ˜¯æ–‡ä»¶ä¸Šä¼ åˆ°SVNç‰ˆæœ¬åº“å,ä¸Šä¼ çš„æ–‡ä»¶ä¸å†ä»¥æ–‡ä»¶åŸæ¥çš„æ ¼å¼å­˜å‚¨,è€Œæ˜¯è¢«svnä»¥å®ƒè‡ªå®šä¹‰çš„æ ¼å¼å‹ç¼©æˆç‰ˆæœ¬åº“æ•°æ®,å­˜æ”¾åœ¨ç‰ˆæœ¬åº“ä¸­ã€‚ è¿™æ ·æˆ‘ä»¬å°±é€‰æ‹©ä½¿ç”¨SVNè‡ªå¸¦çš„hooksæ¥åšwebç«™ç‚¹ä»£ç æ›´æ–°ã€‚ è¿›å…¥å¯¹åº”ç‰ˆæœ¬åº“ä¸‹çš„hooksç›®å½•ï¼Œå¤åˆ¶ post-commit.tmplä¸ºpost-commitã€‚ æ‰“å¼€ï¼Œä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š export.UTF-8 REPOS=&quot;$1&quot; REV=&quot;$2&quot; SVN_PATH=/usr/bin/svn #æ³¨æ„ï¼Œæ­¤å¤„æ˜¯svnå‘½ä»¤ç›®å½• WEB_PATH=/web/trunk #ç«™ç‚¹ç›®å½• LOG_PATH=/home/svn/trunk/svn.log echo &quot;##########å¼€å§‹æäº¤ &quot; `date &quot;+%Y-%m-%d %H:%M:%S&quot;` &#x27;##################&#x27; &gt;&gt; $LOG_PATH $SVN_PATH update --username puresai --password 123456 $WEB_PATH --no-auth-cache &gt;&gt; $LOG_PATH è®°å¾—è¦ä¿®æ”¹ä¸‹post-commitçš„æ‰§è¡Œæƒé™ï¼Œç„¶åæµ‹è¯•ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œé‚£æ­å–œä½ ï¼","tags":["svn"],"categories":["CI"]},{"title":"linuxæ­å»ºsvnæœåŠ¡å™¨","path":"/2017/10/09/137/","content":"ç¯å¢ƒï¼šcentos6.3å®‰è£…svn yum install subversion åˆ›å»ºç‰ˆæœ¬åº“ svnadmin create /home/repo //æ–‡ä»¶ç›®å½•è‡ªå·±è®¾ç½® é…ç½® cd /home/repo/conf // è¿›å…¥ç›®å½• é…ç½®ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶ authz æƒé™passwd è´¦å·å¯†ç svnserve.conf ç‰ˆæœ¬åº“é…ç½® ç¼–è¾‘ç”¨æˆ·æ–‡ä»¶passwdï¼Œæ–°å¢ä¸¤ä¸ªç”¨æˆ·ï¼šadminå’Œguestã€‚ [users]admin = 111111guest = 123456 ç¼–è¾‘æƒé™æ–‡ä»¶authzï¼Œç”¨æˆ·adminè®¾ç½®å¯è¯»å†™æƒé™ï¼Œguestè®¾ç½®åªè¯»æƒé™ã€‚ [/]admin = rwguest = r ç¼–è¾‘svnserve.confï¼š [general]anon-access = none #æ§åˆ¶éé‰´æƒç”¨æˆ·è®¿é—®ç‰ˆæœ¬åº“çš„æƒé™auth-access = write #æ§åˆ¶é‰´æƒç”¨æˆ·è®¿é—®ç‰ˆæœ¬åº“çš„æƒé™password-db = passwd #æŒ‡å®šç”¨æˆ·åå£ä»¤æ–‡ä»¶åauthz-db = authz #æŒ‡å®šæƒé™é…ç½®æ–‡ä»¶årealm = repo #æŒ‡å®šç‰ˆæœ¬åº“çš„è®¤è¯åŸŸï¼Œå³åœ¨ç™»å½•æ—¶æç¤ºçš„è®¤è¯åŸŸåç§° é…ç½®ipï¼Œæ‰“å¼€3369ç«¯å£å¹¶é‡å¯å¯åŠ¨svn svnserve -d -r /home/repo æœ¬åœ°æµ‹è¯•cmdè¾“å…¥svn checkout svn://***/repoï¼ŒåŠ å…¥æç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œå¹¶èƒ½ç”¨ä¹‹å‰è´¦å·ç™»å½•ï¼Œå°±è¡¨ç¤ºé…ç½®æˆåŠŸã€‚ å¦‚æœæœ¬åœ°è£…äº†ç±»ä¼¼TortoiseSVNè½¯ä»¶ï¼Œå¯ä»¥æ–°å»ºæ–‡ä»¶å¤¹ï¼Œç„¶åcheckoutï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œæµ‹è¯•æˆåŠŸï¼","tags":["SVN"],"categories":["CI"]},{"title":"é˜¿é‡Œäº‘èº«ä»½è¯å®åè®¤è¯","path":"/2017/07/25/130/","content":"ç›´æ¥ä¸Šä»£ç ï¼Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„æ¥å£ã€‚ /* * èº«ä»½è¯æ ¡éªŒ * */function sfz_verify($idcard, $name)&#123; $host = &quot;http://idcard.market.alicloudapi.com&quot;; $path = &quot;/lianzhuo/idcard&quot;; $method = &quot;GET&quot;; $appcode = z_get_config(&#x27;sfz_appcode&#x27;); $headers = array(); array_push($headers, &quot;Authorization:APPCODE &quot; . $appcode); $querys = &quot;cardno=$idcard&amp;name=$name&quot;; $bodys = &quot;&quot;; $url = $host . $path . &quot;?&quot; . $querys; $curl = curl_init(); curl_setopt($curl, CURLOPT_CUSTOMREQUEST, $method); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_HTTPHEADER, $headers); curl_setopt($curl, CURLOPT_FAILONERROR, false); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl, CURLOPT_HEADER, true); if (1 == strpos(&quot;$&quot;.$host, &quot;https://&quot;))&#123; curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false); &#125; $output = curl_exec($curl); if (curl_getinfo($curl, CURLINFO_HTTP_CODE) == &#x27;200&#x27;) &#123; list($header, $body) = explode(&quot;\\r \\r &quot;, $output, 2); &#125; //dump($output); curl_close($curl); return $body;&#125; æ­£ç¡®è¿”å›å€¼å¦‚ä¸‹ï¼š &#123; &quot;resp&quot;: &#123; &quot;code&quot;: 0, &quot;desc&quot;: &quot;åŒ¹é…&quot; &#125;, &quot;data&quot;: &#123; &quot;sex&quot;: &quot;ç”·&quot;, &quot;address&quot;: &quot;å¹¿ä¸œçœæ¸…è¿œå¸‚æ¸…æ–°å¿&quot;, &quot;birthday&quot;: &quot;1989-05-25&quot; &#125;&#125;","tags":["PHP"],"categories":["PHP"]},{"title":"ueditorè¿œç¨‹å›¾ç‰‡æœ¬åœ°åŒ–çš„å®ç°","path":"/2017/07/13/127/","content":"å‰ä¸ä¹…å®¢æˆ·åé¦ˆè¯´ï¼Œåœ¨ç§€ç±³ç½‘ä¸Šç¼–è¾‘å¥½æ–‡ç« ï¼Œå‘å¸ƒåˆ°æˆ‘ä»¬åå°ï¼Œå‰å°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºï¼Œæœ€å…ˆæƒ³åˆ°çš„æ˜¯å›¾ç‰‡åŸŸåé™åˆ¶ã€‚å‘é‚®ä»¶ç»™ç§€ç±³ï¼Œç§€ç±³ç»™å‡ºçš„å»ºè®®æ˜¯ç±»ä¼¼å¾®ä¿¡åå°åšå›¾ç‰‡æœ¬åœ°åŒ–ã€‚å¼€å‘ç»„å†…éƒ¨è®¨è®ºåï¼Œçœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼ŒUEditorç¼–è¾‘å™¨å¦‚ä½•å…³é—­æŠ“å–è¿œç¨‹å›¾ç‰‡æœ¬åœ°åŒ–åŠŸèƒ½ï¼Œso easy?æŒ‰æ–‡ç« è¯´æ˜è®¾ç½®ï¼Œæµ‹è¯•,å¤±è´¥ï¼ç™¾åº¦çœ‹äº†ä¸‹ï¼Œå¤§éƒ½æ˜¯è¿™æ ·è§£ç­”ï¼Œè¯´æ˜åº”è¯¥æ˜¯æœ‰äººå®ç°äº†ï¼Œç§€ç±³ç¼–è¾‘å™¨æ ¸å¿ƒä»£ç ä¹Ÿæ­£æ˜¯ueditoræ ¸å¿ƒä»£ç ï¼Œé‚£å°±åªèƒ½è‡ªå·±æ£é¼“äº†ã€‚å…·ä½“æ£é¼“è¿‡ç¨‹å¦‚ä¸‹ï¼šæ³¨æ„ï¼šæ£é¼“å‰å…ˆå¤‡ä»½ä¸‹ï¼Œä»¥å¤‡ä¿®æ”¹é”™è¯¯å¯¼è‡´å…¶ä»–é—®é¢˜æ‰“å¼€ueditor.config.jsï¼Œåœ¨é…ç½®é¡¹ä¸­åŠ å…¥,catchRemoteImageEnable:trueæ‰“å¼€ueditor.config.jsï¼Œæœç´¢catchremoteimageï¼Œåœ¨åŠ å…¥console.warn(url)ï¼Œçœ‹çœ‹ä¸Šä¼ åœ°å€ã€‚å‰å°æµ‹è¯•åçœ‹åˆ°/Skin/public/ueditor/php/controller.php?action=catchimageæ‰“å¼€php/controller.php å¯ä»¥çœ‹åˆ°case&nbsp;&#39;catchimage&#39;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;include(&quot;action_crawler.php&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;æ¥ç€æ‰“å¼€ç»Ÿè®¡ç›®å½•ä¸‹action_crawler.phpinclude(&quot;Uploader.class.php&quot;); $item&nbsp;=&nbsp;new&nbsp;Uploader($imgUrl,&nbsp;$config,&nbsp;&quot;remote&quot;);çœ‹åˆ°è¿™ä¸¤æ®µä»£ç ã€‚ç»§ç»­æ‰“å¼€ç»Ÿè®¡ç›®å½•ä¸‹Uploader.class.php//æ„é€ å‡½æ•°å¦‚ä¸‹ public&nbsp;function&nbsp;__construct($fileField,&nbsp;$config,&nbsp;$type&nbsp;=&nbsp;&quot;upload&quot;) &nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileField&nbsp;=&nbsp;$fileField;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;config&nbsp;=&nbsp;$config;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;type&nbsp;=&nbsp;$type; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($type&nbsp;==&nbsp;&quot;remote&quot;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;saveRemote(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if($type&nbsp;==&nbsp;&quot;base64&quot;)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;upBase64(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;upFile(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateMap[&#39;ERROR_TYPE_NOT_ALLOWED&#39;]&nbsp;=&nbsp;iconv(&#39;unicode&#39;,&nbsp;&#39;utf-8&#39;,&nbsp;$this-&gt;stateMap[&#39;ERROR_TYPE_NOT_ALLOWED&#39;]); &nbsp;&nbsp;&nbsp;&nbsp;}æœç´¢saveRemoteï¼Œä¸»è¦ä¿®å¤fileTypeä¸oriNameä¸¤å—ã€‚/** &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ‹‰å–è¿œç¨‹å›¾ç‰‡ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;mixed &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/ &nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;saveRemote() &nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$imgUrl&nbsp;=&nbsp;htmlspecialchars($this-&gt;fileField); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$imgUrl&nbsp;=&nbsp;str_replace(&quot;&amp;amp;&quot;,&nbsp;&quot;&amp;&quot;,&nbsp;$imgUrl); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//httpå¼€å¤´éªŒè¯&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strpos($imgUrl,&nbsp;&quot;http&quot;)&nbsp;!==&nbsp;0)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_HTTP_LINK&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preg_match(&#39;/(^https*://[^:/]+)/&#39;,&nbsp;$imgUrl,&nbsp;$matches);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host_with_protocol&nbsp;=&nbsp;count($matches)&nbsp;&gt;&nbsp;1&nbsp;?&nbsp;$matches[1]&nbsp;:&nbsp;&#39;&#39;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•&nbsp;url&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!filter_var($host_with_protocol,&nbsp;FILTER_VALIDATE_URL))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;INVALID_URL&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preg_match(&#39;/^https*://(.+)/&#39;,&nbsp;$host_with_protocol,&nbsp;$matches);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$host_without_protocol&nbsp;=&nbsp;count($matches)&nbsp;&gt;&nbsp;1&nbsp;?&nbsp;$matches[1]&nbsp;:&nbsp;&#39;&#39;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æ­¤æ—¶æå–å‡ºæ¥çš„å¯èƒ½æ˜¯&nbsp;ip&nbsp;ä¹Ÿæœ‰å¯èƒ½æ˜¯åŸŸåï¼Œå…ˆè·å–&nbsp;ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ip&nbsp;=&nbsp;gethostbyname($host_without_protocol);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;åˆ¤æ–­æ˜¯å¦æ˜¯ç§æœ‰&nbsp;ip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!filter_var($ip,&nbsp;FILTER_VALIDATE_IP,&nbsp;FILTER_FLAG_NO_PRIV_RANGE))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;INVALID_IP&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//è·å–è¯·æ±‚å¤´å¹¶æ£€æµ‹æ­»é“¾&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$heads&nbsp;=&nbsp;get_headers($imgUrl,&nbsp;1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(stristr($heads[0],&nbsp;&quot;200&quot;)&nbsp;&amp;&amp;&nbsp;stristr($heads[0],&nbsp;&quot;OK&quot;)))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_DEAD_LINK&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ ¼å¼éªŒè¯(æ‰©å±•åéªŒè¯å’ŒContent-TypeéªŒè¯)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileType&nbsp;=&nbsp;strtolower(strrchr($imgUrl,&nbsp;&#39;.&#39;));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//puresai&nbsp;20170712&nbsp;&nbsp;ç§€ç±³ç½‘é“¾æ¥æ¥å¦‚ä¸‹http://img.xiumi.us/xmi/ua/h4qG/i/b8f2af6986e8dba51615a9d85cc82f3b-sz_1952250.JPG?x-oss-process=style/xm&nbsp;ï¼Œæˆ‘ä»¬å®Œå–„ä¸‹&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fileType&nbsp;=&nbsp;(strpos($fileType,&nbsp;&#39;?&#39;)&nbsp;&gt;&nbsp;0)?&nbsp;strtolower(substr($fileType,0,strpos($fileType,&#39;?&#39;)))&nbsp;:&nbsp;strtolower($fileType);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;$fileType;die();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!in_array($fileType,&nbsp;$this-&gt;config[&#39;allowFiles&#39;])&nbsp;||&nbsp;!isset($heads[&#39;Content-Type&#39;])&nbsp;||&nbsp;!stristr($heads[&#39;Content-Type&#39;],&nbsp;&quot;image&quot;))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_HTTP_CONTENTTYPE&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ‰“å¼€è¾“å‡ºç¼“å†²åŒºå¹¶è·å–è¿œç¨‹å›¾ç‰‡&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob_start();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$context&nbsp;=&nbsp;stream_context_create(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(&#39;http&#39;&nbsp;=&gt;&nbsp;array(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;follow_location&#39;&nbsp;=&gt;&nbsp;false&nbsp;//&nbsp;don&#39;t&nbsp;follow&nbsp;redirects&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readfile($imgUrl,&nbsp;false,&nbsp;$context);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$img&nbsp;=&nbsp;ob_get_contents();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ob_end_clean();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//puresai&nbsp;20170712&nbsp;&nbsp;æ­¤å¤„æ­£åˆ™æœ‰é—®é¢˜ï¼Œä¿®æ”¹å¦‚ä¸‹&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//preg_match(&quot;//[.]?[^./]*$/&quot;,&nbsp;$imgUrl,&nbsp;$m);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;preg_match(&quot;//[A-za-z0-9-]+.&quot;.$fileType.&quot;/&quot;,&nbsp;strtolower($imgUrl),&nbsp;$m);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//var_dump($m);die(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;oriName&nbsp;=&nbsp;$m&nbsp;?&nbsp;ltrim($m[0],&#39;/&#39;):&quot;&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//$this-&gt;oriName&nbsp;=&nbsp;$m&nbsp;?&nbsp;$m[1]:&quot;&quot;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//echo&nbsp;$this-&gt;oriName;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//die();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileSize&nbsp;=&nbsp;strlen($img);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileType&nbsp;=&nbsp;$this-&gt;getFileExt();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fullName&nbsp;=&nbsp;$this-&gt;getFullName();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;filePath&nbsp;=&nbsp;$this-&gt;getFilePath();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;fileName&nbsp;=&nbsp;$this-&gt;getFileName();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dirname&nbsp;=&nbsp;dirname($this-&gt;filePath); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…å‡ºé™åˆ¶&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$this-&gt;checkSize())&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_SIZE_EXCEED&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//åˆ›å»ºç›®å½•å¤±è´¥&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!file_exists($dirname)&nbsp;&amp;&amp;&nbsp;!mkdir($dirname,&nbsp;0777,&nbsp;true))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_CREATE_DIR&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(!is_writeable($dirname))&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_DIR_NOT_WRITEABLE&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//ç§»åŠ¨æ–‡ä»¶&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(file_put_contents($this-&gt;filePath,&nbsp;$img)&nbsp;&amp;&amp;&nbsp;file_exists($this-&gt;filePath)))&nbsp;{&nbsp;//ç§»åŠ¨å¤±è´¥&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;getStateInfo(&quot;ERROR_WRITE_CONTENT&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;//ç§»åŠ¨æˆåŠŸ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;stateInfo&nbsp;=&nbsp;$this-&gt;stateMap[0];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;}æ‰“å¼€php/config.jsonï¼Œä¿®æ”¹å¤§å°ã€æ ¼å¼ã€å­˜å‚¨è·¯å¾„ç­‰å‚æ•°/&nbsp;æŠ“å–è¿œç¨‹å›¾ç‰‡é…ç½®&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherLocalDomain&quot;:&nbsp;[&quot;127.0.0.1&quot;,&nbsp;&quot;localhost&quot;,&nbsp;&quot;img.baidu.com&quot;],&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherActionName&quot;:&nbsp;&quot;catchimage&quot;,&nbsp;/&nbsp;æ‰§è¡ŒæŠ“å–è¿œç¨‹å›¾ç‰‡çš„actionåç§°&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherFieldName&quot;:&nbsp;&quot;source&quot;,&nbsp;/&nbsp;æäº¤çš„å›¾ç‰‡åˆ—è¡¨è¡¨å•åç§°&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherPathFormat&quot;:&nbsp;&quot;/Upload/ueditor/image/{yyyy}{mm}{dd}/{time}{rand:6}&quot;,&nbsp;/&nbsp;ä¸Šä¼ ä¿å­˜è·¯å¾„,å¯ä»¥è‡ªå®šä¹‰ä¿å­˜è·¯å¾„å’Œæ–‡ä»¶åæ ¼å¼&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherUrlPrefix&quot;:&nbsp;&quot;&quot;,&nbsp;/&nbsp;å›¾ç‰‡è®¿é—®è·¯å¾„å‰ç¼€&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherMaxSize&quot;:&nbsp;20480000,&nbsp;/&nbsp;ä¸Šä¼ å¤§å°é™åˆ¶ï¼Œå•ä½B&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&quot;catcherAllowFiles&quot;:&nbsp;[&quot;.png&quot;,&nbsp;&quot;.jpg&quot;,&nbsp;&quot;.jpeg&quot;,&nbsp;&quot;.gif&quot;,&nbsp;&quot;.bmp&quot;],&nbsp;/&nbsp;æŠ“å–å›¾ç‰‡æ ¼å¼æ˜¾ç¤º&nbsp;/5.ä¿å­˜ä¿®æ”¹ä¸Šä¼ ï¼Œæµ‹è¯•æˆåŠŸï¼","tags":["ueditor"],"categories":["web"]},{"title":"pythonçˆ¬è™«","path":"/2017/01/14/98/","content":"æœ€è¿‘åœ¨ç©Pythonï¼Œè‡ªå·±å¹³æ—¶å–œæ¬¢å’ŒåŒäº‹çœ‹ç”µå½±ï¼Œå°±å¯»æ€å†™äº†ä¸ªçˆ¬è™«æ¥å®šæ—¶çˆ¬å–ä¼˜æƒ ç”µå½±ã€‚ # author: puresai # code: utf-8 from urllib.request import urlopen from bs4 import BeautifulSoup import re import datetime now = datetime.datetime.now() week = now.weekday() if week &lt; 5: week = 4 - week else: week = 12 - week delta = datetime.timedelta(days=week) n_days = now + delta nowtime = n_days.strftime(&#x27;%Y-%m-%d&#x27;) # æ¯å‘¨äº” jiage = int(30) #ä»·æ ¼ url_gwl = urlopen(&quot;http://www.gewara.com/cinema/ajax/getOpiItemPage.xhtml?cid=cinemaid&amp;mid=&amp;fyrq=&quot;+nowtime).read().decode(&quot;utf-8&quot;) soupurl_gwl = BeautifulSoup(url_gwl,&quot;html.parser&quot;) ids_gwl = soupurl_gwl.findAll(&quot;a&quot;,attrs =&#123;&quot;href&quot;:&quot;javascript:void(0);&quot;&#125;) str = &#x27;&#x27; str1 = &#x27;&#x27; str2 = &#x27;&#x27; for idattr_gwl in ids_gwl: res_gwl = urlopen(&quot;http://www.gewara.com/movie/ajax/getOpiItemNew.xhtml?movieid=&quot;+idattr_gwl[&#x27;id&#x27;]+&quot;&amp;fyrq=&quot;+nowtime+&quot;&amp;cid=cinemaid&quot;).read().decode(&quot;utf-8&quot;) soup_gwl = BeautifulSoup(res_gwl,&quot;html.parser&quot;) # print(soup) links_gwl = soup_gwl.findAll(&quot;span&quot;,attrs =&#123;&quot;class&quot;:&quot;opiPrice&quot;&#125;) arrtime_gwl = soup_gwl.findAll(&quot;span&quot;,attrs =&#123;&quot;class&quot;:&quot;opitime&quot;&#125;) for i in range(0,len(links_gwl)): if links_gwl[i].find(&quot;b&quot;) != None: if int(links_gwl[i].find(&quot;b&quot;).get_text()) &lt; jiage: str1 = str1+&quot;&lt;p&gt;&quot;+arrtime_gwl[i].get_text()+&quot;ç¥¨ä»·ï¼š&quot;+links_gwl[i].find(&quot;b&quot;).get_text()+idattr_gwl.find(&#x27;img&#x27;)[&#x27;alt&#x27;]+&quot;&lt;a href=&#x27;http://www.gewara.com/movie/ajax/getOpiItemNew.xhtml?movieid=&quot;+idattr_gwl[&#x27;id&#x27;]+&quot;&amp;fyrq=&quot;+nowtime+&quot;&amp;cid=cinemaid&#x27;&gt;ç‚¹å‡»æŸ¥çœ‹&lt;/a&gt;&lt;/p&gt;&quot; url_tb = urlopen(&quot;http://dianying.taobao.com/showList.htm?spm=a1z21.3046609.w2.3.9ilG5t&amp;n_s=new&quot;).read().decode(&quot;utf-8&quot;) soupurl_tb = BeautifulSoup(url_tb,&quot;html.parser&quot;) ids_tb = soupurl_tb.findAll(&quot;a&quot;,attrs =&#123;&quot;class&quot;:&quot;movie-card&quot;&#125;) for idattr_tb in ids_tb: pattern = re.compile(r&quot;showId=(\\d+)&quot;) id_group_tb = pattern.search(idattr_tb[&#x27;href&#x27;]) if id: res_tb = urlopen(&quot;http://dianying.taobao.com/cinemaDetailSchedule.htm?cinemaId=cinemaid&amp;activityId=&amp;fCode=&amp;showId=&quot;+id_group_tb.group(1)+&quot;&amp;showDate=&quot;+nowtime).read().decode(&quot;utf-8&quot;) soup_tb = BeautifulSoup(res_tb,&quot;html.parser&quot;) # print(soup) links_tb = soup_tb.findAll(&quot;td&quot;,attrs =&#123;&quot;class&quot;:&quot;hall-price&quot;&#125;) arrtime_tb = soup_tb.findAll(&quot;td&quot;,attrs =&#123;&quot;class&quot;:&quot;hall-time&quot;&#125;) for i in range(0,len(links_tb)): if links_tb[i].find(&quot;em&quot;) != None: if float(links_tb[i].find(&quot;em&quot;).get_text()) &lt; jiage: name_tb = idattr_tb.find(&#x27;span&#x27;,attrs=&#123;&quot;class&quot;:&quot;bt-l&quot;&#125;) str2 = str2+&quot;&lt;p&gt;&quot;+arrtime_tb[i].get_text()+&quot;ç¥¨ä»·ï¼š&quot;+links_tb[i].find(&quot;em&quot;).get_text()+name_tb.get_text()+&quot;&lt;a href=&#x27;http://dianying.taobao.com/cinemaDetailSchedule.htm?cinemaId=cinemaid&amp;activityId=&amp;fCode=&amp;showId=&quot;+id_group_tb.group(1)+&quot;&amp;showDate=&quot;+nowtime+&quot;&#x27;&gt;ç‚¹å‡»æŸ¥çœ‹&lt;/a&gt;&lt;/p&gt;&quot; str1 = str1.strip() str2 = str2.strip() if str1 != &#x27;&#x27; or str2 != &#x27;&#x27;: from email import encoders from email.header import Header from email.mime.text import MIMEText from email.utils import parseaddr, formataddr import smtplib # ç¬¬ä¸‰æ–¹ SMTP æœåŠ¡ mail_host=&quot;smtp.qq.com&quot; #è®¾ç½®æœåŠ¡å™¨ mail_user=&quot;@&quot; #ç”¨æˆ·å mail_pass=&quot;@&quot; #å£ä»¤,QQé‚®ç®±æ˜¯è¾“å…¥æˆæƒç  sender = &#x27;@&#x27; receivers = [&#x27;@&#x27;] # æ¥æ”¶é‚®ä»¶ï¼Œå¯è®¾ç½®ä¸ºä½ çš„QQé‚®ç®±æˆ–è€…å…¶ä»–é‚®ç®± if str1 != &#x27;&#x27;: str = &quot;æ ¼ç“¦æ‹‰ï¼š&lt;br/&gt;&quot;+str1+&quot;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&quot; if str2 != &#x27;&#x27;: str = str+&quot;æ·˜ç¥¨ç¥¨ï¼š&lt;br/&gt;&quot;+str2+&quot;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;&quot; message = MIMEText(str, &#x27;html&#x27;, &#x27;utf-8&#x27;) message[&#x27;From&#x27;] = Header(&quot;@&quot;, &#x27;utf-8&#x27;) message[&#x27;To&#x27;] = Header(&quot;@&quot;, &#x27;utf-8&#x27;) subject = &#x27;ä¼˜æƒ ç”µå½±&#x27; message[&#x27;Subject&#x27;] = Header(subject, &#x27;utf-8&#x27;) try: smtpObj = smtplib.SMTP_SSL(mail_host, 465) smtpObj.login(mail_user,mail_pass) smtpObj.sendmail(sender, receivers, message.as_string()) smtpObj.quit() print(&quot;é‚®ä»¶å‘é€æˆåŠŸ&quot;) except smtplib.SMTPException: print(smtplib.SMTPException) else: print(&quot;æš‚æ— ä¼˜æƒ ç”µå½±&quot;)","tags":["python","çˆ¬è™«"],"categories":["python"]},{"title":"windows7åˆ›å»ºä»»åŠ¡è®¡åˆ’","path":"/2017/01/05/95/","content":"æœ€è¿‘åœ¨åšä¸ªç¨‹åºï¼Œçˆ¬å–ä¼˜æƒ ç”µå½±ç¥¨çš„ç¨‹åºï¼Œç¨‹åºå­˜åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡éœ€è¦cmdè¿è¡Œä¸‹ï¼Œæœ‰ç‚¹éº»çƒ¦ï¼Œæœ‰æ—¶å€™ä¼šå¿˜è®°ï¼Œå› ä¸ºè€ƒè™‘åˆ›å»ºä»»åŠ¡è®¡åˆ’ã€‚åˆ›å»ºå…¶å®å¾ˆç®€å•ï¼Œç¬¬ä¸€æ­¥ï¼Œè¿›å…¥ä»»åŠ¡è®¡åˆ’ç®¡ç†ï¼ˆæ§åˆ¶é¢æ¿æˆ–è€…ç›´æ¥æœç´¢ç¨‹åºï¼‰ä½ å¯ä»¥çœ‹è§æœ¬æœºçš„ä»»åŠ¡è®¡åˆ’åˆ—è¡¨ã€‚ç‚¹å‡»å³ä¾§åˆ›å»ºåŸºæœ¬ä»»åŠ¡ï¼Œåç§°æè¿°è§¦å‘æ—¶é—´å°±ç”±ä½ å®šï¼Œé€‰æ‹©å¯åŠ¨ç¨‹åºï¼Œç¨‹åºè„šæœ¬å†™åœ¨ä¸Šé¢ï¼Œèµ·å§‹äºå†™å…¥æ”¹ç¨‹åºæ‰€åœ¨ç›®å½•ã€‚ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç‚¹å‡»å®Œæˆï¼Œè¿™æ ·å°±å®Œæˆäº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚","tags":["windows"],"categories":["windows"]},{"title":"background-imageçš„urlå±æ€§ä¸ºç©º","path":"/2016/10/11/76/","content":"å‰å¤©åŒäº‹å¼€å‘æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªè¯¡å¼‚çš„é—®é¢˜ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œæµè§ˆé‡ä¼šåŠ 2ï¼Œè€Œä¸æ˜¯æƒ³è¦çš„åŠ 1ã€‚ æ£€æŸ¥äº†ä»£ç æ§åˆ¶å™¨ï¼Œæ²¡æœ‰ä¸æ¯«é—®é¢˜ï¼Œä¸Šæ¬¡å‡ºç°æµè§ˆé‡ä¼šåŠ 2çš„æƒ…å†µæ˜¯å› ä¸ºå¤šå†™äº†ä¸€æ¬¡displayï¼Œåªèƒ½å»å¤´å»å°¾ï¼Œä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†æ’æŸ¥ï¼Œæœ€åå‘ç°æ˜¯å¤´éƒ¨ç”¨äº†ä¸ªbackgroundï¼Œé‡Œé¢çš„urlæ˜¯ç©ºå€¼ï¼Œå»æ‰ï¼Œæ­£å¸¸ã€‚ åˆšæŸ¥äº†ä¸‹ç½‘ä¸Šç¡®å®æœ‰å‡ºç°background-imageçš„urlå±æ€§ä¸ºç©ºå¯¼è‡´äºŒæ¬¡æäº¤çš„æƒ…å†µï¼ŒåŒäº‹å‡ºç°æµè§ˆé‡åŠ 2ä¹Ÿæ˜¯å› æ­¤å¯¼è‡´ã€‚ è¯´æ˜ï¼š æ”¹å˜ä»£ç ä¹ æƒ¯ã€‚ä¸¥ç¦ä»£ç ä¸­ï¼Œurl/href/src å€¼ä¸ºç©ºæˆ– # . è¿™åº”è¯¥æ˜¯ç›®å‰æœ€å¥½çš„ä¸€ç§æ–¹å¼ã€‚ é¿å…ç©ºé“¾æ¥å±æ€§ç©ºçš„é“¾æ¥å±æ€§æ˜¯æŒ‡imgã€linkã€scriptã€ifrrameå…ƒç´ çš„srcæˆ–hrefå±æ€§è¢«è®¾ç½®äº†ï¼Œä½†æ˜¯å±æ€§å´ä¸ºç©ºã€‚æ—©äº›ç‰ˆæœ¬çš„Webkitå†…æ ¸æµè§ˆå™¨ ä¸Firefox ä¼šæŠŠç©ºåœ°å€è§£æä¸ºå½“å‰é¡µé¢çš„åœ°å€ã€‚å¦‚æœé¡µé¢å†…æœ‰å¤šä¸ªç©ºé“¾æ¥å±æ€§å…ƒç´ ï¼Œå½“å‰é¡µé¢çš„æœåŠ¡å™¨åˆ™ä¼šè¢«è¯·æ±‚å¤šæ¬¡ï¼Œå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½ã€‚ç›¸è¾ƒæ¡Œé¢æµè§ˆå™¨å¯¹å†…æ ¸çš„æ›´æ–°å‡çº§è¾ƒç§¯æï¼Œè¿™ä¸ªé—®é¢˜åœ¨ç§»åŠ¨æµè§ˆå™¨ä¸Šé—®é¢˜å¯èƒ½è¾ƒä¸¥é‡ã€‚ å¹¸è¿çš„æ˜¯æ‰€æœ‰ä¸»æµæµè§ˆå™¨é¢å¯¹iframeçš„srcå±æ€§ä¸ºç©ºæ—¶ï¼Œä¼šæŠŠç©ºåœ°å€è§£æä¸ºabout:blankåœ°å€ï¼Œè€Œä¸ä¼šå‘æœåŠ¡å™¨å‘å‡ºé¢å¤–çš„è¯·æ±‚ã€‚å› æ­¤é“¾æ¥é¿å…ä¸äº†å‡ºç°ç©ºçš„æƒ…å†µï¼Œå¯ä»¥ç”¨aboutï¼šblankæ¥ä»£æ›¿ç©ºçš„æƒ…å†µã€‚ è´´ä¸Šæ–‡ç« : ç©ºè·¯å¾„å¯¹é¡µé¢æ€§èƒ½çš„å½±å“","tags":["html"],"categories":["web"]},{"title":"å¤šç§font-family","path":"/2016/04/06/38/","content":"ä¿®æ”¹ä¸€ä¸ªä¸­è‹±æ–‡æ··åˆcsséœ€æ±‚æ—¶ï¼Œçœ‹åˆ°äº†ä»¥ä¸‹æ ·å¼ã€‚ font: 12px/25px &quot;Microsoft Yahei&quot;, &quot;å¾®è½¯é›…é»‘&quot;, &quot;å®‹ä½“&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; å±…ç„¶è®¾ç½®äº†è¿™ä¹ˆå¤šå­—ä½“ã€‚ç„¶åå°±æŸ¥äº†æŸ¥ï¼Œè´´ä¸Šæ¥ã€‚ font-familyçš„è°ƒç”¨æ–¹æ³•: ä»£ç å¦‚ä¸‹: div &#123; font-family:Arial,&#x27;Times New Roman&#x27;,&#x27;Microsoft YaHei&#x27;,SimHei; font:bold 12px/0.75em Arial,&#x27;Times New Roman&#x27;,&#x27;Microsoft YaHei&#x27;,SimHei; &#125; font-family å¯ä»¥æŠŠå¤šä¸ªå­—ä½“åç§°ä½œä¸ºä¸€ä¸ªâ€œå›é€€â€ç³»ç»Ÿæ¥ä¿å­˜ã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒç¬¬ä¸€ä¸ªå­—ä½“ï¼Œåˆ™ä¼šå°è¯•ä¸‹ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfont-family å±æ€§çš„å€¼æ˜¯ç”¨äºæŸä¸ªå…ƒç´ çš„å­—ä½“æ—åç§°æˆ–/åŠç±»æ—åç§°çš„ä¸€ä¸ªä¼˜å…ˆè¡¨ã€‚æµè§ˆå™¨ä¼šä½¿ç”¨å®ƒå¯è¯†åˆ«çš„ç¬¬ä¸€ä¸ªå€¼ã€‚ æ ¹æ®font-familyçš„å­—ä½“è°ƒç”¨åŸåˆ™æˆ‘ä»¬å¯ä»¥ä¸ºè‹±æ–‡,ä¸­æ–‡,ç­‰ä¸¤ç§å­—ä½“è°ƒç”¨ä¸åŒçš„å­—ä½“æ¥æ¸²æŸ“ã€‚ å¦‚:Arial,â€™Times New Romanâ€™è¿™ä¸¤ç§å­—ä½“ä¸è®¤è¯†ä¸­æ–‡,åªè®¤è¯†è‹±æ–‡,æ‰€ä»¥,è¿™ä¸¤ç§å­—ä½“åªèƒ½æ¸²æŸ“è‹±æ–‡æ•°å­—å’Œä¸€äº›ç‰¹æ®Šç¬¦å·,è€Œé¡µé¢ä¸­çš„ä¸­æ–‡å°±ä¼šè‡ªåŠ¨è°ƒç”¨ç¬¬ä¸‰ç§å­—ä½“Microsoft YaHei(PS:å‡å¦‚å­˜åœ¨è¿™ç§å­—ä½“çš„è¯)ã€‚ æ‰€ä»¥,åœ¨å®šä¹‰å­—ä½“çš„æ—¶å€™æŠŠè‹±æ–‡çš„å­—ä½“å†™åœ¨å‰é¢æŠŠä¸­æ–‡çš„å†™åœ¨åé¢ã€‚è¿™æ ·ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨æŒ‰é¡ºåºä¾æ¬¡ç»™å­—ç”¨å­—ä½“ï¼Œå¦‚æœå½“å‰å­—ä½“ä¸æ”¯æŒæ–‡æœ¬ï¼Œè‡ªåŠ¨æ¢ç”¨åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå­—ä½“ã€‚ ç»è¿‡æµ‹è¯•ï¼ŒIE9ã€IE9å…¼å®¹æ¨¡å¼ï¼ˆå…¼å®¹IE8ï¼‰ã€Chromeæµè§ˆå™¨æœ€æ–°ç‰ˆæœ¬ï¼ˆ34.0ï¼‰ã€ Firefoxæµè§ˆå™¨æœ€æ–°ç‰ˆæœ¬ï¼ˆ29.0ï¼‰æ”¯æŒè¯¥font-familyå±æ€§ï¼›ä½†æ˜¯æŸäº›ç‰ˆæœ¬çš„IEæµè§ˆå™¨ï¼ˆIE7ã€IE8ï¼‰æ— æ³•å®ç°è¯¥font-familyå±æ€§çš„è¦æ±‚ï¼Œè¿˜ä¼šæš´éœ²å‡ºä¸€äº›å¥‡æ€ªçš„ bugã€‚å¦‚åœ¨è¿™äº›ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸‹ä½¿ç”¨ä¸­æ–‡å­—ä½“ï¼ˆæ¯”å¦‚å¾®è½¯é›…é»‘ï¼‰ï¼Œéœ€è¦æŠŠè¯¥ä¸­æ–‡å­—ä½“æ”¾åˆ°font-familyå±æ€§çš„é¦–ä½ï¼Œä½†æ˜¯ä¼šå¯¼è‡´è‹±æ–‡å­—ä½“ä¹Ÿä¼šä½¿ç”¨è¯¥ä¸­ æ–‡å­—ä½“æ¸²æŸ“ã€‚å³åœ¨è¿™äº›æµè§ˆå™¨ï¼ˆIE7ã€IE8ï¼‰ä¸‹ä¸æ”¯æŒåœ¨font-familyå±æ€§ä¸­ä¸ºè‹±æ–‡å’Œä¸­æ–‡å­—ä½“åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„å­—ä½“ã€‚ æˆ‘æ”¹æˆè¿™æ ·ï¼Œ font: 12px/25px &quot;Times New Roman&quot;, &quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; ç”¨360å…¼å®¹æ¨¡å¼æµ‹äº†ä¸‹ï¼ŒIE7ï¼Œ8éƒ½æ²¡å‘ç°æ–‡ç« ä¸­è¯´çš„é—®é¢˜ã€‚","tags":["css"],"categories":["css"]},{"title":"å»æ‰å—çŠ¶å…ƒç´ ä¸imgä¹‹é—´é—´éš™","path":"/2015/12/22/7/","content":"é€ æˆå›¾ç‰‡ä¸å®¹å™¨ä¸‹è¾¹ç•Œæœ‰ç©ºéš™çš„åŸå›  åœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ï¼Œ å›¾ç‰‡æ–‡å­—ç­‰inlineå…ƒç´ é»˜è®¤æ˜¯å’Œçˆ¶çº§å…ƒç´ çš„baselineå¯¹é½çš„ï¼Œè€Œbaselineåˆå’Œçˆ¶çº§åº•è¾¹æœ‰ä¸€å®šè·ç¦»ï¼ˆè¿™ä¸ªè·ç¦»å’Œ font-sizeï¼Œfont-family ç›¸å…³ï¼Œä¸ä¸€å®šæ˜¯ 3pxï¼‰ï¼Œæ‰€ä»¥è®¾ç½® vertical-align:top/bottom/text-top/text-bottom éƒ½å¯ä»¥é¿å…è¿™ç§æƒ…å†µå‡ºç°ã€‚è€Œä¸”ä¸å…‰liï¼Œå…¶ä»–çš„blockå…ƒç´ ä¸­åŒ…å«imgä¹Ÿä¼šæœ‰è¿™ä¸ªç°è±¡ã€‚ åªè¦vertical-alignä¸å–baselineï¼Œè¿™ä¸ªç©ºéš™å°±æ¶ˆå¤±äº†ã€‚ è¯·çœ‹å¦‚ä¸‹å®ä¾‹(æ³¨æ„::æµ‹è¯•å·¥å…·ï¼šffï¼Œchromeï¼Œ360â€“æ”¯æŒIE7+) &lt;style&gt;#l1 &#123;float:left;background:#000;&#125;#l1 ul li &#123;list-style:none;padding:0;margin:0&#125;img &#123;height:100px;&#125;&lt;/style&gt;&lt;div id=&quot;l1&quot;&gt; &lt;ul&gt; &lt;li&gt;&lt;img src=&quot;30-023131_451.jpg&quot; /&gt;&lt;/li&gt; &lt;li&gt;&lt;img src=&quot;30-023131_451.jpg&quot; /&gt;&lt;/li&gt; &lt;li&gt;&lt;img src=&quot;30-023131_451.jpg&quot; /&gt;&lt;/li&gt; &lt;/ul&gt;&lt;/div&gt; æˆ‘ä»¬ä¼šå‘ç°liåº•éƒ¨ä¸imgåº•éƒ¨æœ‰é—´éš™ï¼Œso badï¼ ç¬¬ä¸€ï¼Œç»™å›¾ç‰‡imgæ ‡ç­¾display:blockã€‚ å…¼å®¹æ€§IE8+ï¼Œfirefoxï¼Œchrome ç¬¬äºŒï¼Œå®šä¹‰å®¹å™¨é‡Œçš„å­—ä½“å¤§å°ä¸º0ã€‚font-size:0 å…¼å®¹æ€§IE8+ï¼Œfirefoxï¼Œchrome ç¬¬ä¸‰ï¼Œå®šä¹‰å›¾ç‰‡imgæ ‡ç­¾vertical-align:bottomï¼Œvertical-align:middleï¼Œvertical-align:top img&#123;vertical-align:bottom&#125; å…¼å®¹æ€§IE7+ï¼Œfirefoxï¼Œchrome ç¬¬å››ï¼Œç»™liåŠ é«˜åº¦ å…¼å®¹æ€§IE7+ï¼Œfirefoxï¼Œchrome æµ‹è¯•å‘ç°ï¼Œç»™imgåŠ vertical-alignæ•ˆæœæœ€ä½³","tags":["css"],"categories":["web"]},{"title":"puresai","path":"/about/index.html","content":"Over 10 years of hands-on development experience, 2 years of project management and side venture exploration, and 2 years of remote work experience. Skills: BackEnd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Frontend &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DevOps &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"},{"title":"puresai çš„é˜…è¯»å•","path":"/collect/index.html","content":"goLinux"}]